<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Path Sum</title>
      <link href="/programming/leetcode/path-sum/"/>
      <url>/programming/leetcode/path-sum/</url>
      
        <content type="html"><![CDATA[<h1 id="path-sum-i">Path Sum I</h1><p>Given a binary tree and a sum, determine if the tree has a root-to-leaf path such that adding up all the values along the path equals the given sum.</p><p>Note: A leaf is a node with no children.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given the below binary tree and sum = 22,</span><br><span class="line"></span><br><span class="line">      5</span><br><span class="line">     / \</span><br><span class="line">    4   8</span><br><span class="line">   /   / \</span><br><span class="line">  11  13  4</span><br><span class="line"> /  \      \</span><br><span class="line">7    2      1</span><br><span class="line">return true, as there exist a root-to-leaf path 5-&gt;4-&gt;11-&gt;2 which sum is 22.</span><br></pre></td></tr></table></figure><h2 id="bfs">BFS</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasPathSum</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        queue = deque([(root, <span class="number">0</span>), ])</span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            node, sm = queue.popleft()  <span class="comment"># it's BFS when popleft, DFS when popright</span></span><br><span class="line">            sm += node.val</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.left <span class="keyword">and</span> <span class="keyword">not</span> node.right:  <span class="comment"># is leaf node</span></span><br><span class="line">                <span class="keyword">if</span> sm == sum:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                queue.append((node.left, sm))</span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                queue.append((node.right, sm))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="recursion">Recursion</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n), worst case, tree is a list.</span></span><br><span class="line"><span class="comment">#   Average O(log(n)), is tree's height.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasPathSum</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root.left <span class="keyword">and</span> <span class="keyword">not</span> root.right:</span><br><span class="line">            <span class="keyword">return</span> root.val == sum</span><br><span class="line">        sum -= root.val</span><br><span class="line">        <span class="keyword">return</span> self.hasPathSum(root.left, sum) <span class="keyword">or</span> \</span><br><span class="line">               self.hasPathSum(root.right, sum)</span><br></pre></td></tr></table></figure><h1 id="path-sum-ii">Path Sum II</h1><p>Given a binary tree and a sum, find all root-to-leaf paths where each path's sum equals the given sum.</p><p>Note: A leaf is a node with no children.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given the below binary tree and sum = 22,</span><br><span class="line"></span><br><span class="line">      5</span><br><span class="line">     / \</span><br><span class="line">    4   8</span><br><span class="line">   /   / \</span><br><span class="line">  11  13  4</span><br><span class="line"> /  \    / \</span><br><span class="line">7    2  5   1</span><br><span class="line">Return:</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">   [5,4,11,2],</span><br><span class="line">   [5,8,4,5]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="bfs-1">BFS</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pathSum</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        stack = deque([(root, <span class="number">0</span>, []), ])</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            node, sm, path = stack.pop()</span><br><span class="line">            sm += node.val</span><br><span class="line">            path.append(node.val)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.left <span class="keyword">and</span> <span class="keyword">not</span> node.right:</span><br><span class="line">                <span class="keyword">if</span> sm == sum:</span><br><span class="line">                    res.append(path)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                stack.append((node.right, sm, path[:]))</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                stack.append((node.left, sm, path[:]))</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="recursion-1">Recursion</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pathSum</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; list:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node, sm, path, res)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            path.append(node.val)  <span class="comment"># tracing path</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node.left <span class="keyword">and</span> <span class="keyword">not</span> node.right:  <span class="comment"># leaf node</span></span><br><span class="line">                <span class="keyword">if</span> node.val == sm:</span><br><span class="line">                    res.append(path[:])</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                helper(node.left, sm - node.val, path, res)</span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                helper(node.right, sm - node.val, path, res)</span><br><span class="line">            <span class="keyword">del</span> path[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">        r = []</span><br><span class="line">        helper(root, sum, [], r)</span><br><span class="line">        <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure><h1 id="path-sum-iii">Path Sum III</h1><p>You are given a binary tree in which each node contains an integer value.</p><p>Find the number of paths that sum to a given value.</p><p>The path does not need to start or end at the root or a leaf, but it must go downwards (traveling only from parent nodes to child nodes).</p><p>The tree has no more than 1,000 nodes and the values are in the range -1,000,000 to 1,000,000.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root = [10,5,-3,3,2,null,11,3,-2,null,1], sum = 8</span><br><span class="line"></span><br><span class="line">      10</span><br><span class="line">     /  \</span><br><span class="line">    5   -3</span><br><span class="line">   / \    \</span><br><span class="line">  3   2   11</span><br><span class="line"> / \   \</span><br><span class="line">3  -2   1</span><br><span class="line"></span><br><span class="line">Return 3. The paths that sum to 8 are:</span><br><span class="line"></span><br><span class="line">1.  5 -&gt; 3</span><br><span class="line">2.  5 -&gt; 2 -&gt; 1</span><br><span class="line">3. -3 -&gt; 11</span><br></pre></td></tr></table></figure><h2 id="double-recursion">Double Recursion</h2><p>Double recursion is easy to understand. Since we don't know which node could be the start node, we simply check each node.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2), not surely, but it's very slow compared to second solution.</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="comment"># check paths from root</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pathSumHelper</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        sum -= root.val</span><br><span class="line">        <span class="keyword">return</span> int(<span class="number">0</span> == sum) + \</span><br><span class="line">               self.pathSumHelper(root.left, sum) + \</span><br><span class="line">               self.pathSumHelper(root.right, sum)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pathSum</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self.pathSumHelper(root, sum) + \</span><br><span class="line">               self.pathSum(root.left, sum) + \</span><br><span class="line">               self.pathSum(root.right, sum)</span><br></pre></td></tr></table></figure><h2 id="single-recursion">ðŸŒŸSingle Recursion</h2><p>This is a smarter way. Through an example to see how it works.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">      10</span><br><span class="line">     /  \</span><br><span class="line">    5   -3</span><br><span class="line">   / \    \</span><br><span class="line">  3   2   11</span><br><span class="line"> / \   \</span><br><span class="line">3  -2   1</span><br></pre></td></tr></table></figure><p>Keep a variable <code>curSum = 0</code>. First, check the node root, <code>curSum += 10</code>. It's not what we want. Then, we <strong>take a memo</strong> (<code>map[10] = map.get(10, 0) + 1</code>), which means <strong>there is a path with sum 10</strong>. Then, go to check it's chidren. We check node 5, <code>curSum += 5</code>, now <code>curSum = 15</code>...</p><p>Check node 3, now <code>curSum = 18</code>. Here, we find that <code>map[18 - 8] = map[10] = 1</code>, means there exist a path with sum 10, and if we remove that path from current path, we get a path with sum 8.</p><p>Be careful about that we need decrease <code>map[10]</code> by 1 after we explored it's descendants.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pathSum</span><span class="params">(self, root: TreeNode, sum: int)</span> -&gt; int:</span></span><br><span class="line">        hashMap = defaultdict(int)</span><br><span class="line">        hashMap[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(root, curSum)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            curSum += root.val</span><br><span class="line">            hashMap[curSum] += <span class="number">1</span>  <span class="comment"># current path's sum</span></span><br><span class="line">            leftCount = helper(root.left, curSum)</span><br><span class="line">            rightCount = helper(root.right, curSum)</span><br><span class="line">            hashMap[curSum] -= <span class="number">1</span>  <span class="comment"># backtracking</span></span><br><span class="line">            count = hashMap[curSum - sum]</span><br><span class="line">            <span class="keyword">return</span> count + leftCount + rightCount</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(root, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> DFS </tag>
            
            <tag> recursion </tag>
            
            <tag> binary tree </tag>
            
            <tag> BFS </tag>
            
            <tag> path </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Check Completeness of a Binary Tree</title>
      <link href="/programming/leetcode/check-completeness-of-a-binary-tree/"/>
      <url>/programming/leetcode/check-completeness-of-a-binary-tree/</url>
      
        <content type="html"><![CDATA[<p>Given a binary tree, determine if it is a complete binary tree.</p><p>Definition of a complete binary tree from <a href="http://en.wikipedia.org/wiki/Binary_tree#Types_of_binary_trees" target="_blank" rel="noopener">Wikipedia</a>:</p><blockquote><p>In a complete binary tree every level, except possibly the last, is completely filled, and all nodes in the last level are as far left as possible. It can have between 1 and 2^h nodes inclusive at the last level h.</p></blockquote><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,4,5,6]</span><br><span class="line">     1</span><br><span class="line">   /   \</span><br><span class="line">  2     3</span><br><span class="line"> / \   /</span><br><span class="line">4   5 6</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,4,5,null,7]</span><br><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \   \</span><br><span class="line">4   5   7</span><br><span class="line">Output: false</span><br><span class="line">Explanation: The node with value 7 isn&apos;t as far left as possible.</span><br></pre></td></tr></table></figure><p>Note: The tree will have between 1 and 100 nodes.</p><h1 id="bfs">BFS</h1><p>Accroding complete tree's definition.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isCompleteTree</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        queue = deque([root])</span><br><span class="line">        prev = root</span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            node = queue.popleft()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> prev <span class="keyword">and</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> node:</span><br><span class="line">                queue.append(node.left)</span><br><span class="line">                queue.append(node.right)</span><br><span class="line">            prev = node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="attach-indices">Attach indices</h1><p>At the root node, we will associate it with the code <code>1</code>. Then, for each node with code <code>v</code>, we will associate its left child with code <code>2 * v</code>, and its right child with code <code>2 * v + 1</code>. (Like heap, heap is a complete tree)</p><a id="more"></a><p>We can find the codes of every node in the tree in &quot;reading order&quot; (top to bottom, left to right) sequence using a breadth first search. (We could also use a depth first search and sort the codes later.)</p><p>Then, we check that the codes are the sequence <code>1, 2, 3, ...</code> with no gaps. Actually, we only need to check that the last code is correct, since the last code is the largest value.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isCompleteTree</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        nodes = [(root, <span class="number">1</span>)]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; len(nodes):</span><br><span class="line">            node, v = nodes[i]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> node:  <span class="comment"># if there is a None, the indices will be orderless</span></span><br><span class="line">                nodes.append((node.left, <span class="number">2</span> * v))</span><br><span class="line">                nodes.append((node.right, <span class="number">2</span> * v + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  nodes[<span class="number">-1</span>][<span class="number">1</span>] == len(nodes)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> binary tree </tag>
            
            <tag> BFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Merge Sorted Array</title>
      <link href="/programming/leetcode/merge-sorted-array/"/>
      <url>/programming/leetcode/merge-sorted-array/</url>
      
        <content type="html"><![CDATA[<p>Given two sorted integer arrays nums1 and nums2, merge nums2 into nums1 as one sorted array.</p><p>Note:</p><p>The number of elements initialized in nums1 and nums2 are m and n respectively. You may assume that nums1 has enough space (size that is equal to m + n) to hold additional elements from nums2.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">nums1 = [1,2,3,0,0,0], m = 3</span><br><span class="line">nums2 = [2,5,6],       n = 3</span><br><span class="line"></span><br><span class="line">Output: [1,2,2,3,5,6]</span><br></pre></td></tr></table></figure><p>Constraints:</p><ul><li><code>-10^9 &lt;= nums1[i], nums2[i] &lt;= 10^9</code></li><li><code>nums1.length == m + n</code></li><li><code>nums2.length == n</code></li></ul><h1 id="two-pointers-backward">Two Pointers: backward</h1><p>Merge array in-place.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(m + n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, nums1: <span class="string">'List[int]'</span>, m: int, nums2: <span class="string">'List[int]'</span>, n: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        i, j = m - <span class="number">1</span>, n - <span class="number">1</span></span><br><span class="line">        t = m + n - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> j &gt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> i &gt;= <span class="number">0</span> <span class="keyword">and</span> nums1[i] &gt; nums2[j]:</span><br><span class="line">                nums1[t] = nums1[i]</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nums1[t] = nums2[j]</span><br><span class="line">                j -= <span class="number">1</span></span><br><span class="line">            t -= <span class="number">1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> array </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Longest Substrings Without Repeating Characters</title>
      <link href="/programming/leetcode/longest-substrings-without-repeating-characters/"/>
      <url>/programming/leetcode/longest-substrings-without-repeating-characters/</url>
      
        <content type="html"><![CDATA[<p>Given a string, find the length of the longest substring without repeating characters.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;abcabcbb&quot;</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: The answer is &quot;abc&quot;, with the length of 3.</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;bbbbb&quot;</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: The answer is &quot;b&quot;, with the length of 1.</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;pwwkew&quot;</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: The answer is &quot;wke&quot;, with the length of 3.</span><br><span class="line">             Note that the answer must be a substring,</span><br><span class="line">             &quot;pwke&quot; is a subsequence and not a substring.</span><br></pre></td></tr></table></figure><h1 id="slinding-window">Slinding Window</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(min(n, m)), m is the size of the charset/alphabet.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        left = right = res = <span class="number">0</span></span><br><span class="line">        hSet = set()</span><br><span class="line">        <span class="keyword">while</span> right &lt; len(s):</span><br><span class="line">            <span class="keyword">if</span> s[right] <span class="keyword">not</span> <span class="keyword">in</span> hSet:</span><br><span class="line">                hSet.add(s[right])</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">                res = max(res, len(hSet))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                hSet.remove(s[left])</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="sliding-window-optimized">Sliding Window Optimized</h1><p>The above solution requires at most 2n steps. In fact, it could be optimized to require only n steps. Instead of using a set to tell if a character exists or not, we could define a mapping of the characters to its index. Then we can skip the characters immediately when we found a repeated character.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(min(n, m)), m is the size of the charset/alphabet.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        left = res = <span class="number">0</span></span><br><span class="line">        hMap = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> right, c <span class="keyword">in</span> enumerate(s):</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">in</span> hMap <span class="keyword">and</span> hMap[c] &gt;= left:  <span class="comment"># hMap[c] &gt;= left</span></span><br><span class="line">                left = hMap[c] + <span class="number">1</span></span><br><span class="line">            res = max(res, right - left + <span class="number">1</span>)</span><br><span class="line">            hMap[c] = right</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> hash table </tag>
            
            <tag> string </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Binary Tree Maximum Path Sum</title>
      <link href="/programming/leetcode/binary-tree-maximum-path-sum/"/>
      <url>/programming/leetcode/binary-tree-maximum-path-sum/</url>
      
        <content type="html"><![CDATA[<p>Given a <strong>non-empty</strong> binary tree, find the maximum path sum.</p><p>For this problem, a path is defined as any sequence of nodes from some starting node to any node in the tree <strong>along the parent-child connections</strong>. The path must contain <strong>at least one node</strong> and does not need to go through the root.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3]</span><br><span class="line"></span><br><span class="line">       1</span><br><span class="line">      / \</span><br><span class="line">     2   3</span><br><span class="line"></span><br><span class="line">Output: 6</span><br><span class="line">Explanation: sum of path 2 - 1 - 3</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [-10,9,20,null,null,15,7]</span><br><span class="line"></span><br><span class="line">   -10</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line"></span><br><span class="line">Output: 42</span><br><span class="line">Explanation: sum of path 15 - 20 - 7</span><br></pre></td></tr></table></figure><h1 id="before-coding">Before coding</h1><p>From examples, we know that the maximum path sum have two cases:</p><ol type="1"><li>connected a node with it's left or right child. (<code>a -&gt; a.left</code> or <code>a -&gt; a.right</code>)</li><li>connected a node with it's both left and right child. (<code>a.left -&gt; a -&gt; a.right</code>)</li></ol><p>The key difference between 1 and 2 is case 1 can connect <code>a</code> with it's parent (if exists), but 2 can't.</p><p>Take away the case 2. It would be much easier to design an algorithm solving it. Here gives the recursion algrithm.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>  <span class="comment"># return 0 when node is None</span></span><br><span class="line">    left_sum = max(helper(node.left), <span class="number">0</span>)  <span class="comment"># recursively</span></span><br><span class="line">    right_sum = max(helper(node.right), <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># the max path sum start from node downward to it's child</span></span><br><span class="line">    case1 = node.val + max(left_sum, right_sum)</span><br><span class="line">    <span class="comment"># record result (max path sum)</span></span><br><span class="line">    res = max(res, case1)</span><br><span class="line">    <span class="keyword">return</span> case1</span><br></pre></td></tr></table></figure><p>By recursion, each node is visited once and calculated the max path sum from it. Then greater one is saved to <code>res</code>.</p><h1 id="recursion">Recursion</h1><p>Now, what if put case 2 back. Obviously, we need consider one more case: <code>a.left -&gt; a -&gt; a.right</code>. Luckily, it's max path sum can be calculated by <code>left_sum + node.val + right_sum</code>. There is the revised algorithm.</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>  <span class="comment"># return 0 when node is None</span></span><br><span class="line">    left_sum = max(helper(node.left), <span class="number">0</span>)  <span class="comment"># recursively</span></span><br><span class="line">    right_sum = max(helper(node.right), <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># the max path sum start from node downward to it's child</span></span><br><span class="line">    case1 = node.val + max(left_sum, right_sum)</span><br><span class="line">    <span class="comment"># record result (max path sum)</span></span><br><span class="line">    res = max(res, case1)</span><br><span class="line">    <span class="comment"># ----- case 3 here ---------</span></span><br><span class="line">    case2 = node.val + left_sum + right_sum</span><br><span class="line">    res = max(res, case2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> case1</span><br></pre></td></tr></table></figure><p><strong>It also return <code>node.val + max(left_sum, right_sum)</code>, the max path sum of case 1.</strong> And, we found <code>case2 &gt;= case1</code>, so two lines can be eliminated in the function.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxPathSum</span><span class="params">(self, root: TreeNode)</span> -&gt; int:</span></span><br><span class="line">        max_sum = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node)</span>:</span></span><br><span class="line">            <span class="string">"""Return the max path sum start from node downward to it's child."""</span></span><br><span class="line">            <span class="keyword">nonlocal</span> max_sum</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>  <span class="comment"># None</span></span><br><span class="line">            left_sum = max(helper(node.left), <span class="number">0</span>)</span><br><span class="line">            right_sum = max(helper(node.right), <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># case 1: node.left -&gt; node -&gt; node.right</span></span><br><span class="line">            max_sum = max(max_sum, node.val + left_sum + right_sum)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># case 2: node -&gt; node.left or node -&gt; node.right</span></span><br><span class="line">            <span class="keyword">return</span> node.val + max(left_sum, right_sum)</span><br><span class="line"></span><br><span class="line">        helper(root)</span><br><span class="line">        <span class="keyword">return</span> max_sum</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> binary tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3 Sum Closest</title>
      <link href="/programming/leetcode/3-sum-closest/"/>
      <url>/programming/leetcode/3-sum-closest/</url>
      
        <content type="html"><![CDATA[<p>Given an array nums of n integers and an integer target, find three integers in nums such that the sum is closest to target. Return the sum of the three integers. You may assume that each input would have exactly one solution.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: nums = [-1,2,1,-4], target = 1</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: The sum that is closest to the target is 2. (-1 + 2 + 1 = 2).</span><br></pre></td></tr></table></figure><p>Constraints:</p><ul><li><code>3 &lt;= nums.length &lt;= 10^3</code></li><li><code>-10^3 &lt;= nums[i] &lt;= 10^3</code></li><li><code>-10^4 &lt;= target &lt;= 10^4</code></li></ul><h1 id="sorting-two-pointers">Sorting + Two Pointers</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(log(n)) to O(n),</span></span><br><span class="line"><span class="comment">#   depending on the implementation of the sorting algorithm.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSumClosest</span><span class="params">(self, nums: <span class="string">'List[int]'</span>, target: int)</span> -&gt; int:</span></span><br><span class="line">        nums.sort()  <span class="comment"># O(n log(n))</span></span><br><span class="line">        best = float(<span class="string">'inf'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums) - <span class="number">2</span>):  <span class="comment"># O(n^2)</span></span><br><span class="line">            l, r = i + <span class="number">1</span>, len(nums) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> l &lt; r:</span><br><span class="line">                sum_ = nums[i] + nums[l] + nums[r]</span><br><span class="line">                <span class="keyword">if</span> sum_ == target:  <span class="comment"># target found</span></span><br><span class="line">                    <span class="keyword">return</span> target</span><br><span class="line">                <span class="keyword">if</span> abs(best - target) &gt; abs(sum_ - target):</span><br><span class="line">                    best = sum_</span><br><span class="line">                <span class="keyword">if</span> sum_ &gt; target:</span><br><span class="line">                    r -= <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> l &lt; r <span class="keyword">and</span> nums[r] == nums[r + <span class="number">1</span>]:  <span class="comment"># skip equal num (optional)</span></span><br><span class="line">                        r -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    l += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> l &lt; r <span class="keyword">and</span> nums[l] == nums[l - <span class="number">1</span>]:</span><br><span class="line">                        l += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> best</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> array </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Min Stack</title>
      <link href="/programming/leetcode/min-stack/"/>
      <url>/programming/leetcode/min-stack/</url>
      
        <content type="html"><![CDATA[<p>Design a stack that supports push, pop, top, and retrieving the minimum element in constant time.</p><ul><li><code>push(x)</code> -- Push element x onto stack.</li><li><code>pop()</code> -- Removes the element on top of the stack.</li><li><code>top()</code> -- Get the top element.</li><li><code>getMin()</code> -- Retrieve the minimum element in the stack.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">[&quot;MinStack&quot;,&quot;push&quot;,&quot;push&quot;,&quot;push&quot;,&quot;getMin&quot;,&quot;pop&quot;,&quot;top&quot;,&quot;getMin&quot;]</span><br><span class="line">[[],[-2],[0],[-3],[],[],[],[]]</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">[null,null,null,null,-3,null,0,-2]</span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">MinStack minStack = new MinStack();</span><br><span class="line">minStack.push(-2);</span><br><span class="line">minStack.push(0);</span><br><span class="line">minStack.push(-3);</span><br><span class="line">minStack.getMin(); // return -3</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();    // return 0</span><br><span class="line">minStack.getMin(); // return -2</span><br></pre></td></tr></table></figure><p><strong>Constraints</strong>: Methods pop, top and getMin operations will always be called on non-empty stacks.</p><h1 id="two-stacks">Two stacks</h1><p>One stack to store values. To get min in constant time, we need another stack to store min values of current stack. (Or we can save (val, min) in one stack).</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">push  3, 2, 4, 1, 5, 0</span><br><span class="line"></span><br><span class="line">stack         min_stack</span><br><span class="line">3             3</span><br><span class="line">3,2           3,2</span><br><span class="line">3,2,4         3,2,2    &lt;- push 2</span><br><span class="line">3,2,4,1       3,2,2,1</span><br><span class="line">3,2,4,1,5     3,2,2,1,1</span><br><span class="line">3,2,4,1,5,0   3,2,2,1,1,0</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.stack = []</span><br><span class="line">        self.min_stack = [float(<span class="string">'inf'</span>)]  <span class="comment"># careful about IndexError</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, x: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.stack.append(x)</span><br><span class="line">        self.min_stack.append(min(x, self.getMin()))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.stack.pop()</span><br><span class="line">        self.min_stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.min_stack[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><h1 id="min-value-variable">Min value variable</h1><p>In previous approach if we push values which are greater than min value <code>n</code> times, we also need push min value <code>n</code> times too.</p><ul><li>Push: We can use a variable recode current min value. If a greater value pushed, we won't push min value again.</li><li>Pop: When poped a value, we compare it with current min value, pop min stack if and only if they are equal.</li></ul><p>However, when pushing values which are equal to min value many times, wo also need push min value repeatedly. Otherwise, we can't preserve the min value after pop a value.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">push  4, 1, 3, 9</span><br><span class="line">stack         min_stack      min_value</span><br><span class="line">4             4              4</span><br><span class="line">4,1           4,1            1</span><br><span class="line">4,1,3         4,1            1</span><br><span class="line">4,1,3,9       4,1            1</span><br><span class="line"></span><br><span class="line">pop  9, 3, 1, 4</span><br><span class="line">stack         min_stack      min_value</span><br><span class="line">4,1,3         4,1            1</span><br><span class="line">4,1           4,1            1</span><br><span class="line">4             4              4</span><br><span class="line">_             _              _</span><br><span class="line"></span><br><span class="line">======================================</span><br><span class="line"></span><br><span class="line">push  2, 2, 2</span><br><span class="line">stack         min_stack      min_value</span><br><span class="line">2             2              2</span><br><span class="line">2,2           2,2            2</span><br><span class="line">2,2,2         2,2,2          2</span><br><span class="line"></span><br><span class="line">pop  2, 2, 2</span><br><span class="line">stack         min_stack      min_value</span><br><span class="line">2,2           2,2            2</span><br><span class="line">2             2              2</span><br><span class="line">_             _              _</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.stack = []</span><br><span class="line">        self.min_stack = [float(<span class="string">'inf'</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, x: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.stack.append(x)</span><br><span class="line">        <span class="keyword">if</span> x &lt;= self.min_stack[<span class="number">-1</span>]:</span><br><span class="line">            self.min_stack.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        v = self.stack.pop()</span><br><span class="line">        <span class="keyword">if</span> v == self.min_stack[<span class="number">-1</span>]:</span><br><span class="line">            self.min_stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.min_stack[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Continuous Subarray Sum</title>
      <link href="/programming/leetcode/continuous-subarray-sum/"/>
      <url>/programming/leetcode/continuous-subarray-sum/</url>
      
        <content type="html"><![CDATA[<p>Given a list of <strong>non-negative</strong> numbers and a target integer <code>k</code>, write a function to check if the array has a continuous subarray of size at least 2 that sums up to a multiple of <code>k</code>, that is, sums up to <code>n*k</code> where <code>n</code> is also an integer.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [23, 2, 4, 6, 7],  k=6</span><br><span class="line">Output: True</span><br><span class="line">Explanation: Because [2, 4] is a continuous subarray of size 2 and sums up to 6.</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [23, 2, 6, 4, 7],  k=6</span><br><span class="line">Output: True</span><br><span class="line">Explanation: Because [23, 2, 6, 4, 7] is an continuous subarray of size 5 and sums up to 42.</span><br></pre></td></tr></table></figure><p><strong>Constraints</strong>:</p><ul><li>The length of the array won't exceed 10,000.</li><li>You may assume the sum of all the numbers is in the range of a signed 32-bit integer.</li></ul><h1 id="broute-forse-optimized">Broute Forse Optimized</h1><p>Enumerate all subarray <code>a[i .. j]</code>. Calculate sum... By calcualte accumulated sum of array, we can get sum of any subarray in O(1). See problem <a href="/programming/leetcode/range-sum-query/" title="Range Sum Query">Range Sum Query</a>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSubarraySum</span><span class="params">(self, nums: <span class="string">'List[int]'</span>, k: int)</span> -&gt; bool:</span></span><br><span class="line">        accumulated = [<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            accumulated.append(accumulated[<span class="number">-1</span>] + num)</span><br><span class="line">        n = len(nums)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, n):  <span class="comment"># ensure j &gt; i</span></span><br><span class="line">                <span class="comment"># sum of nums[i .. j], at least two elements</span></span><br><span class="line">                sum_ = accumulated[j + <span class="number">1</span>] - accumulated[i]</span><br><span class="line">                <span class="keyword">if</span> sum_ == k <span class="keyword">or</span> (k != <span class="number">0</span> <span class="keyword">and</span> sum_ % k == <span class="number">0</span>):</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="hash-table">Hash Table</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Define nums[i .. j] as the sum of nums[i:j+1].</span><br><span class="line"></span><br><span class="line">If nums[i .. j] % k = 0, then:</span><br><span class="line">nums[0 .. j] % k = (nums[0 .. i-1] + nums[i .. j]) % k</span><br><span class="line">                 = nums[0 .. i-1] % k + nums[i .. j] % k</span><br><span class="line">                 = nums[0 .. i-1] % k + 0</span><br></pre></td></tr></table></figure><a id="more"></a><p>So, there is the algorithm to solve this problem using above property.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(min(n, k))</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSubarraySum</span><span class="params">(self, nums: <span class="string">'List[int]'</span>, k: int)</span> -&gt; bool:</span></span><br><span class="line">        sum_ = <span class="number">0</span></span><br><span class="line">        hMap = &#123;<span class="number">0</span>: <span class="number">-1</span>&#125;  <span class="comment"># special for the case that subarray start from 0</span></span><br><span class="line">        <span class="keyword">for</span> i, n <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            sum_ += n</span><br><span class="line">            <span class="keyword">if</span> k != <span class="number">0</span>:</span><br><span class="line">                sum_ %= k</span><br><span class="line">            <span class="keyword">if</span> sum_ <span class="keyword">in</span> hMap:</span><br><span class="line">                <span class="keyword">if</span> i - hMap[sum_] &gt; <span class="number">1</span>:  <span class="comment"># at least 2 elements</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># if not in, record it in map</span></span><br><span class="line">                hMap[sum_] = i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> array </tag>
            
            <tag> hash table </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Merge Intervals</title>
      <link href="/programming/leetcode/merge-intervals/"/>
      <url>/programming/leetcode/merge-intervals/</url>
      
        <content type="html"><![CDATA[<p>Given a collection of intervals, merge all overlapping intervals.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [[1,3],[2,6],[8,10],[15,18]]</span><br><span class="line">Output: [[1,6],[8,10],[15,18]]</span><br><span class="line">Explanation: Since intervals [1,3] and [2,6] overlaps, merge them into [1,6].</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [[1,4],[4,5]]</span><br><span class="line">Output: [[1,5]]</span><br><span class="line">Explanation: Intervals [1,4] and [4,5] are considered overlapping.</span><br></pre></td></tr></table></figure><h1 id="sorting">Sorting</h1><p>If we sort the intervals by their start value, then each set of intervals that can be merged will appear as a contiguous &quot;run&quot; in the sorted list.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:  [(1, 9), (2, 5), (19, 20), (10, 11), (12, 20), (0, 3), (0, 1), (0, 2)]</span><br><span class="line">Sorted: [(0, 3), (0, 1), (0, 2), (1, 9), (2, 5), (10, 11), (12, 20), (19, 20)]</span><br><span class="line">         --------------------------------------  --------  ------------------</span><br><span class="line">        [                (0, 9),                 (10, 11),       (12, 20)    ]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n log(n))</span></span><br><span class="line"><span class="comment"># Space: O(1) or O(n), depending on sort algorithm</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, intervals: <span class="string">'List[List[int]]'</span>)</span> -&gt; 'List[List[int]]':</span></span><br><span class="line">        intervals.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> intervals:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> res <span class="keyword">or</span> res[<span class="number">-1</span>][<span class="number">1</span>] &lt; x[<span class="number">0</span>]:</span><br><span class="line">                res.append(x)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res[<span class="number">-1</span>][<span class="number">1</span>] = max(res[<span class="number">-1</span>][<span class="number">1</span>], x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="counting-sort">Counting Sort</h1><p>This approach works like counting sort. Create a long enough array <code>a</code>:</p><ol type="1"><li>Scan each interval, for start value, <code>a[start] += 1</code>; for end value, <code>a[end] -= 1</code>.</li><li>Calculate accumulated sum of <code>a</code>. The merged interval always end at <code>j</code> where <code>a[j] == 0</code>. However, it can start from <code>i</code> where <code>a[i] == 0</code> also. That's a special interval we need to consider.</li></ol><a id="more"></a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">         Overlapping                Containing   Special</span><br><span class="line">Input:  [[3,5],[4,6], [0,1],[1,2], [7,10],[8,9], [11,11]]</span><br><span class="line"></span><br><span class="line">index:  0  1  2  3  4  5  6  7  8  9  10  11</span><br><span class="line">array:  x  x  x  x  x  x  x  x  x  x   x   x   # x means no value</span><br><span class="line"> scan:  1  0 -1  1  1 -1 -1  1  1 -1  -1   0</span><br><span class="line"> accu:  1  1  0  1  2  1  0  1  2  1   0   0</span><br><span class="line">        &lt;     &gt;  &lt;        &gt;  &lt;         &gt;   &lt;&gt;</span><br><span class="line">merge: [ [0,2],    [3,6],     [7,10],      [11,11]  ]</span><br></pre></td></tr></table></figure><p><strong>This variation only works with non-negative values</strong>, you know the reason.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(max(n, m)), m is the greatest end-value of all intervals</span></span><br><span class="line"><span class="comment"># Space: O(m)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, intervals: <span class="string">'List[List[int]]'</span>)</span> -&gt; 'List[List[int]]':</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> intervals <span class="keyword">or</span> len(intervals) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> intervals</span><br><span class="line">        <span class="comment"># find max end, or pre-define a large enough value</span></span><br><span class="line">        max_bd = max(end <span class="keyword">for</span> _, end <span class="keyword">in</span> intervals)  <span class="comment"># &lt;-- O(n)</span></span><br><span class="line"></span><br><span class="line">        arr = [<span class="literal">None</span>] * (max_bd + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># a helper function return 0 when value is None</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">read_arr</span><span class="params">(i)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> arr[i] <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> arr[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># scan</span></span><br><span class="line">        <span class="keyword">for</span> start, end <span class="keyword">in</span> intervals:  <span class="comment"># &lt;-- O(n)</span></span><br><span class="line">            arr[start] = read_arr(start) + <span class="number">1</span></span><br><span class="line">            arr[end] = read_arr(end) - <span class="number">1</span></span><br><span class="line">        <span class="comment"># accumulate</span></span><br><span class="line">        acc = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(arr):  <span class="comment"># &lt;-- O(m)</span></span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                acc += x</span><br><span class="line">                arr[i] = acc</span><br><span class="line">        <span class="comment"># merge</span></span><br><span class="line">        res = []</span><br><span class="line">        i = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(arr)):  <span class="comment"># &lt;-- O(m)</span></span><br><span class="line">            <span class="keyword">if</span> arr[j] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> i <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    i = j</span><br><span class="line">                <span class="keyword">if</span> arr[j] == <span class="number">0</span>:</span><br><span class="line">                    res.append([i, j])</span><br><span class="line">                    i = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="counting-sort-using-dict">Counting Sort using Dict</h1><p>Using dict instead of list, the above method can process negative values. However, can't process decimal values.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(max(n, m)), m is the greatest end-value of all intervals</span></span><br><span class="line"><span class="comment"># Space: O(min(2n, p)), p = len(set(v for v in itv for itv in intervals)),</span></span><br><span class="line"><span class="comment">#        i.e., p is the number of distinct values</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, intervals: <span class="string">'List[List[int]]'</span>)</span> -&gt; 'List[List[int]]':</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> intervals <span class="keyword">or</span> len(intervals) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> intervals</span><br><span class="line"></span><br><span class="line">        arr = &#123;&#125;</span><br><span class="line">        min_bd, max_bd = float(<span class="string">'inf'</span>), float(<span class="string">'-inf'</span>)</span><br><span class="line">        <span class="comment"># scan</span></span><br><span class="line">        <span class="keyword">for</span> start, end <span class="keyword">in</span> intervals:  <span class="comment"># &lt;-- O(n)</span></span><br><span class="line">            arr[start] = arr.get(start, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">            arr[end] = arr.get(end, <span class="number">0</span>) - <span class="number">1</span></span><br><span class="line">            min_bd = min(min_bd, start)</span><br><span class="line">            max_bd = max(max_bd, end)</span><br><span class="line">        <span class="comment"># accumulate</span></span><br><span class="line">        acc = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(min_bd, max_bd + <span class="number">1</span>):  <span class="comment"># &lt;-- O(m)</span></span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> arr:</span><br><span class="line">                acc += arr[i]</span><br><span class="line">                arr[i] = acc</span><br><span class="line">        <span class="comment"># merge</span></span><br><span class="line">        res = []</span><br><span class="line">        i = min_bd</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(min_bd, max_bd + <span class="number">1</span>):  <span class="comment"># &lt;-- O(m)</span></span><br><span class="line">            <span class="keyword">if</span> j <span class="keyword">in</span> arr:</span><br><span class="line">                <span class="keyword">if</span> i <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    i = j  <span class="comment"># j not +1 in this case</span></span><br><span class="line">                <span class="keyword">if</span> arr[j] == <span class="number">0</span>:</span><br><span class="line">                    res.append([i, j])</span><br><span class="line">                    i = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="summary">Summary</h1><table style="width:100%;"><colgroup><col style="width: 16%"><col style="width: 16%"><col style="width: 16%"><col style="width: 16%"><col style="width: 16%"><col style="width: 16%"></colgroup><thead><tr class="header"><th>Method or Algorithm</th><th>Time</th><th>Space</th><th>Can process<br>non-negative values?</th><th>Can process<br>negative values?</th><th>Can process<br>decimal values?</th></tr></thead><tbody><tr class="odd"><td>Sorting</td><td><code>O(n log(n))</code></td><td><code>O(1) or O(n)</code></td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr class="even"><td>Counting Sort</td><td><code>O(max(n, m))</code></td><td><code>O(m)</code></td><td>Yes</td><td>No</td><td>No</td></tr><tr class="odd"><td>Counting Sort using Dict</td><td><code>O(max(n, m))</code></td><td><code>O(min(2n, p))</code></td><td>No</td><td>No</td><td>No</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> sort </tag>
            
            <tag> counting sort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kth Largest Element in an Array</title>
      <link href="/programming/leetcode/kth-largest-element-in-an-array/"/>
      <url>/programming/leetcode/kth-largest-element-in-an-array/</url>
      
        <content type="html"><![CDATA[<p>Find the kth largest element in an unsorted array. Note that it is the kth largest element in the sorted order, not the kth distinct element.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [3,2,1,5,6,4] and k = 2</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [3,2,3,1,2,4,5,5,6] and k = 4</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><p>Note: You may assume k is always valid, <code>1 &lt;= k &lt;= array.length</code>.</p><h1 id="quick-sort">Quick Sort</h1><p>kth largest is the (n-k)th element in ordered array.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(log(n))</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, nums, left, right)</span>:</span></span><br><span class="line">        pivot = nums[right]</span><br><span class="line">        i, j = left, right - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># i &lt; hi, j &gt;= lo, can avoid the case i == j after loops</span></span><br><span class="line">            <span class="comment"># i == j will cause infinite loop</span></span><br><span class="line">            <span class="keyword">while</span> i &lt; right <span class="keyword">and</span> nums[i] &lt;= pivot:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> j &gt;= left <span class="keyword">and</span> nums[j] &gt;= pivot:</span><br><span class="line">                j -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i &gt; j:</span><br><span class="line">                nums[i], nums[right] = nums[right], nums[i]</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">            nums[i], nums[j] = nums[j], nums[i]</span><br><span class="line">        <span class="comment"># There is another variation of partition,</span></span><br><span class="line">        <span class="comment"># which is eaiser but not as efficiently as above.</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        pivot, i = a[right], left</span></span><br><span class="line"><span class="string">        for j in range(left, right):</span></span><br><span class="line"><span class="string">            if a[j] &lt; pivot:</span></span><br><span class="line"><span class="string">                a[i], a[j] = a[j], a[i]</span></span><br><span class="line"><span class="string">                i += 1</span></span><br><span class="line"><span class="string">        a[i], a[right] = a[right], a[i]</span></span><br><span class="line"><span class="string">        return i</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">randomizedPartition</span><span class="params">(self, nums, lo, hi)</span>:</span></span><br><span class="line">        i = randint(lo, hi)</span><br><span class="line">        nums[i], nums[hi] = nums[hi], nums[i]</span><br><span class="line">        <span class="keyword">return</span> self.partition(nums, lo, hi)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quickSelect</span><span class="params">(self, nums, lo, hi, t)</span>:</span></span><br><span class="line">        q = self.randomizedPartition(nums, lo, hi)</span><br><span class="line">        <span class="keyword">if</span> q == t:</span><br><span class="line">            <span class="keyword">return</span> nums[t]</span><br><span class="line">        <span class="keyword">elif</span> q &lt; t:</span><br><span class="line">            <span class="keyword">return</span> self.quickSelect(nums, q + <span class="number">1</span>, hi, t)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># q &gt; k</span></span><br><span class="line">            <span class="keyword">return</span> self.quickSelect(nums, lo, q - <span class="number">1</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span><span class="params">(self, nums: list, k: int)</span> -&gt; int:</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        <span class="keyword">return</span> self.quickSelect(nums, <span class="number">0</span>, n - <span class="number">1</span>, n - k)</span><br></pre></td></tr></table></figure><h1 id="heap">Heap</h1><p>Using a max heap, pop k-1 times from heap, the current top element is the kth largest element.</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(nlog(n))</span></span><br><span class="line"><span class="comment"># Space: O(log(n)), recursion stack during sift_down</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sift_down</span><span class="params">(self, nums, heap_size, i)</span>:</span></span><br><span class="line">        l, r = (i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>, (i &lt;&lt; <span class="number">1</span>) + <span class="number">2</span></span><br><span class="line">        largest = i</span><br><span class="line">        <span class="keyword">if</span> l &lt; heap_size <span class="keyword">and</span> nums[l] &gt; nums[largest]:</span><br><span class="line">            largest = l</span><br><span class="line">        <span class="keyword">if</span> r &lt; heap_size <span class="keyword">and</span> nums[r] &gt; nums[largest]:</span><br><span class="line">            largest = r</span><br><span class="line">        <span class="keyword">if</span> largest != i:</span><br><span class="line">            nums[largest], nums[i] = nums[i], nums[largest]</span><br><span class="line">            self.sift_down(nums, heap_size, largest)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">heapify</span><span class="params">(self, nums, heap_size)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(heap_size &lt;&lt; <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            self.sift_down(nums, heap_size, i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKthLargest</span><span class="params">(self, nums: list, k: int)</span> -&gt; int:</span></span><br><span class="line">        size = len(nums)</span><br><span class="line">        self.heapify(nums, size)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(k - <span class="number">1</span>):</span><br><span class="line">            nums[<span class="number">0</span>], nums[size - <span class="number">1</span>] = nums[size - <span class="number">1</span>], nums[<span class="number">0</span>]</span><br><span class="line">            size -= <span class="number">1</span></span><br><span class="line">            self.sift_down(nums, size, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> array </tag>
            
            <tag> recursion </tag>
            
            <tag> heap </tag>
            
            <tag> quick sort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lowest Common Ancestor</title>
      <link href="/programming/leetcode/lowest-common-ancestor/"/>
      <url>/programming/leetcode/lowest-common-ancestor/</url>
      
        <content type="html"><![CDATA[<h1 id="lca-of-a-binary-tree">LCA of a Binary Tree</h1><p>Given a binary tree, find the lowest common ancestor (LCA) of two given nodes in the tree.</p><p>According to the <a href="https://en.wikipedia.org/wiki/Lowest_common_ancestor" target="_blank" rel="noopener">definition of LCA on Wikipedia</a>: â€œThe lowest common ancestor is defined between two nodes <code>p</code> and <code>q</code> as the lowest node in <code>T</code> that has both <code>p</code> and <code>q</code> as descendants (where we <strong>allow a node to be a descendant of itself</strong>).â€</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given the following binary tree: root = [3,5,1,6,2,0,8,null,null,7,4]</span><br><span class="line"></span><br><span class="line">     3</span><br><span class="line">   /    \</span><br><span class="line">  5      1</span><br><span class="line"> / \    / \</span><br><span class="line">6   2  0   8</span><br><span class="line">   / \</span><br><span class="line">  7   4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Example 1:</span><br><span class="line"></span><br><span class="line">Input: p = 5, q = 1</span><br><span class="line">Output: 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Example 2:</span><br><span class="line"></span><br><span class="line">Input: p = 5, q = 4</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><p>Note:</p><ul><li>All of the nodes' values will be unique.</li><li><code>p</code> and <code>q</code> are different and both values will exist in the binary tree.</li></ul><h2 id="resursion">Resursion</h2><ul><li><code>left = True</code> if <code>p</code> or <code>q</code> in it's left subtree.</li><li><code>right = True</code> if <code>p</code> or <code>q</code> in it's right subtree.</li><li><code>mid = True</code> if itself is <code>p</code> or <code>q</code></li></ul><p>A node is a LCA of <code>p</code> and <code>q</code> if <code>left + right + mid == 2</code> (two of three become True).</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">     3</span><br><span class="line">   /    \</span><br><span class="line">  5      1</span><br><span class="line"> / \    / \</span><br><span class="line">6   2  0   8</span><br><span class="line">   / \</span><br><span class="line">  7   4</span><br><span class="line"></span><br><span class="line">3 is LCA of 5 and 1.      (left == right == True)</span><br><span class="line">5 is LCA of 5 and 4.      (mid == right == True)</span><br><span class="line">5 is LCA of 5 and 6.      (mid == left == True)</span><br><span class="line">5 is not LCA of 2 and 4.  (right == True)</span><br><span class="line"></span><br><span class="line">left == right == mid == Ture never happens.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n), maximum recursion stack</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        ans = root</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node)</span>:</span></span><br><span class="line">            <span class="keyword">nonlocal</span> ans</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="comment"># Left recursion.</span></span><br><span class="line">            left = helper(node.left)</span><br><span class="line">            <span class="comment"># Right recursion.</span></span><br><span class="line">            right = helper(node.right)</span><br><span class="line">            mid = node <span class="keyword">in</span> (p, q)</span><br><span class="line">            <span class="comment"># If any two of the three flags left, right or mid become True.</span></span><br><span class="line">            <span class="keyword">if</span> left + mid + right &gt;= <span class="number">2</span>:</span><br><span class="line">                ans = node</span><br><span class="line">            <span class="keyword">return</span> left <span class="keyword">or</span> mid <span class="keyword">or</span> right</span><br><span class="line"></span><br><span class="line">        helper(root)</span><br><span class="line">        <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="iterative-using-parent-pointers">Iterative using parent pointers</h2><p>In recursion, the recursion stack let us go back to parent when children are visited. In iteration, we using parent pointers.</p><p>The procedure of iteration:</p><ol type="1"><li>Find path's from root to <code>p</code> and from root to <code>q</code>.</li><li>Backtracking from <code>p</code> to root using parent pointers.</li><li>Backtracking from <code>q</code> to root, the first common node is LCA of <code>p</code> and <code>q</code>.</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        stack, parent = [root], &#123;root: <span class="literal">None</span>&#125;</span><br><span class="line">        <span class="comment"># find paths</span></span><br><span class="line">        <span class="keyword">while</span> p <span class="keyword">not</span> <span class="keyword">in</span> parent <span class="keyword">or</span> q <span class="keyword">not</span> <span class="keyword">in</span> parent:</span><br><span class="line">            node = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                stack.append(node.right)</span><br><span class="line">                parent[node.right] = node</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                stack.append(node.left)</span><br><span class="line">                parent[node.left] = node</span><br><span class="line">        <span class="comment"># backtracking p ~&gt; root</span></span><br><span class="line">        ancestors = set()</span><br><span class="line">        <span class="keyword">while</span> p:</span><br><span class="line">            ancestors.add(p)</span><br><span class="line">            p = parent[p]</span><br><span class="line">        <span class="comment"># backtracking q ~&gt; root</span></span><br><span class="line">        <span class="keyword">while</span> q <span class="keyword">not</span> <span class="keyword">in</span> ancestors:</span><br><span class="line">            q = parent[q]</span><br><span class="line">        <span class="keyword">return</span> q</span><br></pre></td></tr></table></figure><h2 id="without-parent-pointers">Without parent pointers</h2><p>When we find one node of <code>p</code> or <code>q</code>, tracking a variable <code>lca</code> to indicate the node where we &quot;split&quot; our path.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">     3</span><br><span class="line">   /    \</span><br><span class="line">  5      1</span><br><span class="line"> / \    / \</span><br><span class="line">6   2  0   8</span><br><span class="line">   / \</span><br><span class="line">  7   4</span><br><span class="line"></span><br><span class="line">Input: p = 6, q = 4</span><br><span class="line"></span><br><span class="line">3 -&gt; 5 -&gt; 6.       One node found. lca = 6</span><br><span class="line">3 -&gt; 5             Backtracking.  lca = 5  (lca only move left along the path)</span><br><span class="line">3 -&gt; 5 -&gt; 2 -&gt; 7.</span><br><span class="line">3 -&gt; 5 -&gt; 2</span><br><span class="line">3 -&gt; 5 -&gt; 2 -&gt; 4.  Another node found. return lca = 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Input: p = 5, q = 4</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">3 -&gt; 5 -&gt; 2 -&gt; 4.  One node found. lca = 4</span><br><span class="line">3 -&gt; 5 -&gt; 2.       Backtracking. lca = 2</span><br><span class="line">3 -&gt; 5.            Another node found. lca = 5</span><br></pre></td></tr></table></figure><h3 id="iteration">Iteration</h3><p>To do this, we need a &quot;path&quot; save the nodes from root to current. We made a little change with stack: add a flag to represent current node's visit state.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        PENDING, HALF_DONE, DONE = <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        stack = [(root, PENDING)]</span><br><span class="line">        one_found, lca_ind = <span class="literal">False</span>, <span class="number">-1</span></span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            node, state = stack[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> state != DONE:</span><br><span class="line">                <span class="keyword">if</span> state == PENDING:  <span class="comment"># PENDING</span></span><br><span class="line">                    <span class="keyword">if</span> node <span class="keyword">in</span> (p, q):</span><br><span class="line">                        <span class="keyword">if</span> one_found:</span><br><span class="line">                            <span class="keyword">return</span> stack[lca_ind][<span class="number">0</span>]</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            one_found = <span class="literal">True</span></span><br><span class="line">                            lca_ind = len(stack) - <span class="number">1</span></span><br><span class="line">                    child = node.left</span><br><span class="line">                <span class="keyword">else</span>:  <span class="comment"># HALF_DONE</span></span><br><span class="line">                    child = node.right</span><br><span class="line"></span><br><span class="line">                <span class="comment"># update state</span></span><br><span class="line">                stack.pop()</span><br><span class="line">                stack.append((node, state - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> child:</span><br><span class="line">                    stack.append((child, PENDING))</span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># DONE</span></span><br><span class="line">                stack.pop()  <span class="comment"># backtracking on path</span></span><br><span class="line">                <span class="keyword">if</span> one_found <span class="keyword">and</span> lca_ind == len(stack):  <span class="comment"># need move left</span></span><br><span class="line">                    lca_ind -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><h3 id="recursion">Recursion</h3><p>It's easier to keep a path during recursive DFS:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        find_another, lca = <span class="literal">False</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node, path)</span>:</span></span><br><span class="line">            <span class="keyword">nonlocal</span> find_another, lca</span><br><span class="line"></span><br><span class="line">            path.append(node)  <span class="comment"># add current node</span></span><br><span class="line">            <span class="keyword">if</span> node <span class="keyword">in</span> (p, q):</span><br><span class="line">                find_another = <span class="keyword">not</span> find_another</span><br><span class="line">                <span class="keyword">if</span> find_another:</span><br><span class="line">                    lca = path[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                helper(node.left, path)  <span class="comment"># go deeper</span></span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                helper(node.right, path)</span><br><span class="line">            backed = path.pop()  <span class="comment"># remove current node</span></span><br><span class="line">            <span class="keyword">if</span> find_another <span class="keyword">and</span> lca == backed:</span><br><span class="line">                lca = path[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">        helper(root, [])</span><br><span class="line">        <span class="keyword">return</span> lca</span><br></pre></td></tr></table></figure><h1 id="lca-of-binary-search-tree">LCA of Binary Search Tree</h1><p>Given a binary search tree (BST), find the lowest common ancestor (LCA) of two given nodes in the BST.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given binary search tree: root = [6,2,8,0,4,7,9,null,null,3,5]</span><br><span class="line"></span><br><span class="line">     6</span><br><span class="line">   /    \</span><br><span class="line">  2      8</span><br><span class="line"> / \    / \</span><br><span class="line">0   4  7   9</span><br><span class="line">   / \</span><br><span class="line">  3   5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Example 1:</span><br><span class="line"></span><br><span class="line">Input: p = 2, q = 8</span><br><span class="line">Output: 6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Example 2:</span><br><span class="line"></span><br><span class="line">Input: p = 2, q = 4</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p><strong>Constraints</strong>:</p><ul><li>All of the nodes' values will be unique.</li><li><code>p</code> and <code>q</code> are different and both values will exist in the BST.</li></ul><h2 id="before-coding">Before coding</h2><p>We can solve this using the approaches to find LCA in a binary tree.</p><p>But, binary search tree's property could be utilized, to come up with a better algorithm.</p><p>Lets review properties of a BST:</p><blockquote><ol type="1"><li>Left subtree of a node N contains nodes whose values are lesser than or equal to node N's value.</li><li>Right subtree of a node N contains nodes whose values are greater than node N's value.</li><li>Both left and right subtrees are also BSTs.</li></ol></blockquote><p>The LCA's position:</p><ol type="1"><li>If current node's value lesser than value of <code>p</code> and <code>q</code>, the LCA must exist in current node's right subtree.</li><li>If current node's value greater than value of <code>p</code> and <code>q</code>, the LCA must exist in current node's left subtree.</li><li>If both 1 and 2 are not True, the current node is the LCA.</li></ol><p>The algorithm is based on an important constraint: <code>p</code> and <code>q</code> are different and both values will exist in the BST.</p><h2 id="recursion-1">Recursion</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        min_, max_ = min(p.val, q.val), max(p.val, q.val)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">lca</span><span class="params">(node)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> node.val &gt; max_:</span><br><span class="line">                <span class="keyword">return</span> lca(node.left)</span><br><span class="line">            <span class="keyword">if</span> node.val &lt; min_:</span><br><span class="line">                <span class="keyword">return</span> lca(node.right)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> lca(root)</span><br></pre></td></tr></table></figure><h2 id="iteration-1">Iteration</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        min_, max_ = min(p.val, q.val), max(p.val, q.val)</span><br><span class="line">        node = root</span><br><span class="line">        <span class="keyword">while</span> node:</span><br><span class="line">            <span class="keyword">if</span> node.val &gt; max_:</span><br><span class="line">                node = node.left</span><br><span class="line">            <span class="keyword">elif</span> node.val &lt; min_:</span><br><span class="line">                node = node.right</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> node</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> binary tree </tag>
            
            <tag> BST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Coin Change</title>
      <link href="/programming/leetcode/coin-change/"/>
      <url>/programming/leetcode/coin-change/</url>
      
        <content type="html"><![CDATA[<p>You are given coins of different denominations and a total amount of money amount. Write a function to compute the fewest number of coins that you need to make up that amount. If that amount of money cannot be made up by any combination of the coins, return -1.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: coins = [1, 2, 5], amount = 11</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: 11 = 5 + 5 + 1</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: coins = [2], amount = 3</span><br><span class="line">Output: -1</span><br></pre></td></tr></table></figure><p>Note: You may assume that you have an infinite number of each kind of coin.</p><h1 id="bottom-up-dp">Bottom-Up DP</h1><p>Let's define <code>dp[s]</code> as the minimum number of coins needed to make change for amount <code>s</code> using coins <code>c</code>.</p><p>Base case: <code>dp[0] = 0</code>.</p><p>Induction rule: <code>dp[s] = ?</code>. If we take a coin <code>c[i]</code> first, then we need <code>dp[s - c[i]] + 1</code> coins. So, <code>dp[s] = min(dp[s - c[i]] | i = 0, 1, ..., n - 1) + 1</code>, i.e., we try every coin.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n * s), n = len(coins), s = amount</span></span><br><span class="line"><span class="comment"># Space: O(s)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">coinChange</span><span class="params">(self, coins: list, amount: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> amount &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        dp = [float(<span class="string">'inf'</span>)] * (amount + <span class="number">1</span>)</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> coin <span class="keyword">in</span> coins:</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(coin, amount + <span class="number">1</span>):  <span class="comment"># x start from coin</span></span><br><span class="line">                dp[x] = min(dp[x], dp[x - coin] + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[amount] <span class="keyword">if</span> dp[amount] != float(<span class="string">'inf'</span>) <span class="keyword">else</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="top-down-dp">Top-Down DP</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n * s), n = len(coins), s = amount</span></span><br><span class="line"><span class="comment"># Space: O(s)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">coinChange</span><span class="params">(self, coins: list, amount: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> amount &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(x: int, dp: list)</span> -&gt; int:</span></span><br><span class="line">            <span class="keyword">if</span> x == <span class="number">0</span> <span class="keyword">or</span> dp[x] != <span class="number">0</span>:  <span class="comment"># base case</span></span><br><span class="line">                <span class="keyword">return</span> dp[x]</span><br><span class="line">            <span class="comment"># induction rule</span></span><br><span class="line">            dp[x] = float(<span class="string">'inf'</span>)</span><br><span class="line">            <span class="keyword">for</span> coin <span class="keyword">in</span> coins:</span><br><span class="line">                <span class="keyword">if</span> x &gt;= coin:</span><br><span class="line">                    dp[x] = min(dp[x], helper(x - coin, dp) + <span class="number">1</span>)</span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">            dp[x] = min((helper(x - coin, dp) + 1 for coin in coins</span></span><br><span class="line"><span class="string">                        if x &gt;= coin), default=float('inf'))</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line">            <span class="keyword">return</span> dp[x]</span><br><span class="line"></span><br><span class="line">        dp = [<span class="number">0</span>] * (amount + <span class="number">1</span>)</span><br><span class="line">        helper(amount, dp)</span><br><span class="line">        <span class="keyword">return</span> dp[amount] <span class="keyword">if</span> dp[amount] != float(<span class="string">'inf'</span>) <span class="keyword">else</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Add Strings</title>
      <link href="/programming/leetcode/add-strings/"/>
      <url>/programming/leetcode/add-strings/</url>
      
        <content type="html"><![CDATA[<p>Given two non-negative integers num1 and num2 represented as string, return the sum of num1 and num2.</p><p><strong>Note</strong>:</p><ul><li>The length of both num1 and num2 is &lt; 5100.</li><li>Both num1 and num2 contains only digits 0-9.</li><li>Both num1 and num2 does not contain any leading zero.</li><li>You must not use any built-in BigInteger library or convert the inputs to integer directly.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(max(n1, n2)), n1, n2 are the length of num1, num2</span></span><br><span class="line"><span class="comment"># Space: O(max(n1, n2))</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addStrings</span><span class="params">(self, num1: str, num2: str)</span> -&gt; str:</span></span><br><span class="line">        res = []</span><br><span class="line">        i, j, carry = len(num1) - <span class="number">1</span>, len(num2) - <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &gt;= <span class="number">0</span> <span class="keyword">or</span> j &gt;= <span class="number">0</span>:</span><br><span class="line">            n1 = int(num1[i]) <span class="keyword">if</span> i &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            n2 = int(num2[j]) <span class="keyword">if</span> j &gt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            tmp = n1 + n2 + carry</span><br><span class="line">            carry = tmp // <span class="number">10</span></span><br><span class="line">            res.append(tmp % <span class="number">10</span>)</span><br><span class="line">            i, j = i - <span class="number">1</span>, j - <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> carry &gt; <span class="number">0</span>:</span><br><span class="line">            res.append(carry)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(str(x) <span class="keyword">for</span> x <span class="keyword">in</span> reversed(res))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Longest Chunked Palindrome Decomposition</title>
      <link href="/programming/leetcode/longest-chunked-palindrome-decomposition/"/>
      <url>/programming/leetcode/longest-chunked-palindrome-decomposition/</url>
      
        <content type="html"><![CDATA[<p>Return the largest possible <code>k</code> such that there exists <code>a_1, a_2, ..., a_k</code> such that:</p><ul><li>Each <code>a_i</code> is a non-empty string;</li><li>Their concatenation <code>a_1 + a_2 + ... + a_k</code> is equal to text;</li><li>For all <code>1 &lt;= i &lt;= k</code>, <code>a_i = a_{k+1 - i}</code>.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: text = &quot;ghiabcdefhelloadamhelloabcdefghi&quot;</span><br><span class="line">Output: 7</span><br><span class="line">Explanation: We can split the string on &quot;(ghi)(abcdef)(hello)(adam)(hello)(abcdef)(ghi)&quot;.</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: text = &quot;merchant&quot;</span><br><span class="line">Output: 1</span><br><span class="line">Explanation: We can split the string on &quot;(merchant)&quot;.</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: text = &quot;antaprezatepzapreanta&quot;</span><br><span class="line">Output: 11</span><br><span class="line">Explanation: We can split the string on &quot;(a)(nt)(a)(pre)(za)(tpe)(za)(pre)(a)(nt)(a)&quot;.</span><br></pre></td></tr></table></figure><p>Example 4:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: text = &quot;aaa&quot;</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: We can split the string on &quot;(a)(a)(a)&quot;.</span><br></pre></td></tr></table></figure><p>Constraints:</p><ul><li>text consists only of lowercase English characters.</li><li><code>1 &lt;= text.length &lt;= 1000</code></li></ul><h1 id="greedy">Greedy</h1><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: abcdefabc</span><br><span class="line"></span><br><span class="line">1. is a == c ? No</span><br><span class="line">2. is ab == bc ? No</span><br><span class="line">3. is abc == abc ? Yes, res += 2</span><br><span class="line">4. is d == f ? No</span><br><span class="line">5. is de == ef ? No</span><br><span class="line">6. is def == def ? Yes, res += 1</span><br><span class="line"></span><br><span class="line">We must be careful about the case that</span><br><span class="line">a substring crossing the middle point.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n), the max length of substring we compared can be n/2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestDecomposition</span><span class="params">(self, text: str)</span> -&gt; int:</span></span><br><span class="line">        n = len(text)</span><br><span class="line">        i = res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n // <span class="number">2</span>):  <span class="comment"># move forward end point</span></span><br><span class="line">            <span class="keyword">if</span> text[i:j + <span class="number">1</span>] == text[n - j - <span class="number">1</span>:n - i]:</span><br><span class="line">                res += <span class="number">2</span></span><br><span class="line">                i = j + <span class="number">1</span>  <span class="comment"># new start point</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">2</span> * i &lt; n:  <span class="comment"># middle chunk</span></span><br><span class="line">            res += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="recursion">Recursion</h1><p>Same procedure implemented by recursion.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n), as much as n/2 recursion depth</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestDecomposition</span><span class="params">(self, text: str)</span> -&gt; int:</span></span><br><span class="line">        n = len(text)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n // <span class="number">2</span> + <span class="number">1</span>):  <span class="comment"># j is the length of substrings we compared</span></span><br><span class="line">            <span class="keyword">if</span> text[<span class="number">0</span>:j] == text[n - j:n]:</span><br><span class="line">                <span class="keyword">if</span> <span class="number">2</span> * j &lt; n:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">2</span> + self.longestDecomposition(text[j:n-j])</span><br><span class="line">                <span class="keyword">elif</span> <span class="number">2</span> * j == n:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">                <span class="keyword">else</span>:  <span class="comment"># 2 * j &gt; n, substring crossed middle point</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>  <span class="comment"># not matched</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> palindrome </tag>
            
            <tag> greedy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œå±‚</title>
      <link href="/notes/computer-networking/network-layer/"/>
      <url>/notes/computer-networking/network-layer/</url>
      
        <content type="html"><![CDATA[<p>ç½‘ç»œå±‚å‘ä¸Šåªæä¾›ç®€å•çµæ´»çš„ã€æ— è¿žæŽ¥çš„ã€å°½æœ€å¤§åŠªåŠ›äº¤ä»˜çš„æ•°æ®æŠ¥æœåŠ¡ã€‚ç½‘ç»œå±‚ä¸æä¾›æœåŠ¡è´¨é‡çš„æ‰¿è¯ºã€‚å¦‚æžœä¸»æœºä¸­çš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡éœ€è¦æ˜¯å¯é çš„ï¼Œé‚£ä¹ˆå°±ç”±ç½‘ç»œçš„ä¸»æœºä¸­çš„è¿è¾“å±‚è´Ÿè´£ï¼ˆåŒ…æ‹¬å·®é”™å¤„ç†ã€æµé‡æŽ§åˆ¶ï¼‰ã€‚é‡‡ç”¨è¿™ç§è®¾è®¡æ€è·¯çš„å¥½å¤„æ˜¯ï¼šç½‘ç»œé€ ä»·å¤§å¤§é™ä½Žï¼Œè¿è¡Œæ–¹å¼çµæ´»ï¼Œèƒ½å¤Ÿé€‚åº”å¤šç§åº”ç”¨ã€‚</p><h1 id="ç½‘é™…åè®®-ip">ç½‘é™…åè®® IP</h1><p>ä¸Ž IP åè®®é…å¥—ä½¿ç”¨çš„è¿˜æœ‰ä¸‰ä¸ªåè®®ï¼š</p><ul><li>åœ°å€è§£æžåè®® ARPï¼ˆAddress Resolution Protocolï¼‰</li><li>ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMPï¼ˆInternet Control Message Protocolï¼‰</li><li>ç½‘é™…ç»„ç®¡ç†åè®®ï¼ˆInternet Group Management Protocolï¼‰</li></ul><p>IP åè®®ä½¿ç”¨ ARP åè®®ã€‚ICMP å’Œ IGMP ä½¿ç”¨ IP åè®®ã€‚</p><p>å°†ç½‘ç»œäº’ç›¸è¿žæŽ¥èµ·æ¥è¦ä½¿ç”¨ä¸€äº›<strong>ä¸­é—´è®¾å¤‡</strong>ã€‚æ ¹æ®ä¸­é—´è®¾å¤‡æ‰€åœ¨çš„å±‚æ¬¡ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å››ç§ä¸åŒçš„ä¸­é—´è®¾å¤‡ï¼š</p><ol type="1"><li>ç‰©ç†å±‚ä½¿ç”¨çš„ä¸­é—´è®¾å¤‡å«åš<strong>è½¬å‘å™¨</strong>ï¼ˆrepeaterï¼‰ã€‚</li><li>æ•°æ®é“¾è·¯å±‚ä½¿ç”¨çš„ä¸­é—´è®¾å¤‡å«åš<strong>ç½‘æ¡¥</strong>æˆ–<strong>æ¡¥æŽ¥å™¨</strong>ï¼ˆbridgeï¼‰ã€‚</li><li>ç½‘ç»œå±‚ä½¿ç”¨çš„ä¸­é—´è®¾å¤‡å«åš<strong>è·¯ç”±å™¨</strong>ï¼ˆrouterï¼‰ã€‚</li><li>åœ¨ç½‘ç»œå±‚ä»¥ä¸Šä½¿ç”¨çš„ä¸­é—´è®¾å¤‡å«åš<strong>ç½‘å…³</strong>ï¼ˆgatewayï¼‰ã€‚ç”¨ç½‘å…³è¿žæŽ¥ä¸¤ä¸ªä¸å…¼å®¹çš„ç³»ç»Ÿéœ€è¦åœ¨é«˜å±‚è¿›è¡Œåè®®çš„è½¬æ¢ã€‚</li></ol><p>å½“ä¸­é—´è®¾å¤‡æ˜¯è½¬å‘å™¨æˆ–ç½‘æ¡¥æ—¶ï¼Œè¿™ä»…ä»…æ˜¯æŠŠä¸€ä¸ªç½‘ç»œæ‰©å¤§äº†ï¼Œè€Œä»Žç½‘ç»œå±‚çš„è§’åº¦çœ‹ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªç½‘ç»œï¼Œä¸€èˆ¬å¹¶ä¸ç§°ä¸ºç½‘ç»œäº’è¿žã€‚ç½‘å…³ç”±äºŽæ¯”è¾ƒå¤æ‚ï¼Œç›®å‰ä½¿ç”¨å¾—è¾ƒå°‘ã€‚å› æ­¤è®¨è®ºç½‘ç»œäº’è¿žæ—¶ï¼Œéƒ½æ˜¯æŒ‡ç”¨è·¯ç”±å™¨è¿›è¡Œç½‘ç»œäº’è¿žå’Œè·¯ç”±é€‰æ‹©ã€‚è·¯ç”±å™¨å…¶å®žå°±æ˜¯ä¸€å°ä¸“ç”¨è®¡ç®—æœºï¼Œç”¨æ¥åœ¨äº’è”ç½‘ä¸­è¿›è¡Œè·¯ç”±é€‰æ‹©ã€‚ç”±äºŽåŽ†å²çš„åŽŸå› ï¼Œè®¸å¤šæœ‰å…³ TCP/IP çš„æ–‡çŒ®æ›¾ç»æŠŠç½‘ç»œå±‚ä½¿ç”¨çš„è·¯ç”±å™¨ç§°ä¸ºç½‘å…³ï¼Œæœ¬ä¹¦æœ‰æ—¶ä¹Ÿè¿™æ ·ç”¨ã€‚</p><h1 id="ip-åœ°å€">IP åœ°å€</h1><p>æ•´ä¸ªçš„äº’è”ç½‘å°±æ˜¯ä¸€ä¸ªå•ä¸€çš„ã€æŠ½è±¡çš„ç½‘ç»œã€‚IP åœ°å€å°±æ˜¯ç»™äº’è”ç½‘ä¸Šçš„æ¯ä¸€å°ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰çš„æ¯ä¸€ä¸ªæŽ¥å£åˆ†é…ä¸€ä¸ªåœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…å”¯ä¸€çš„ 32 ä½çš„æ ‡è¯†ç¬¦ã€‚IP åœ°å€çš„ç¼–å€æ–¹å¼ç»è¿‡äº†ä¸‰ä¸ªåŽ†å²é˜¶æ®µã€‚</p><ol type="1"><li>åˆ†ç±»çš„ IP åœ°å€ã€‚æœ€åŸºæœ¬çš„ç¼–å€æ–¹æ³•ã€‚</li><li>å­ç½‘çš„åˆ’åˆ†ã€‚å¯¹æœ€åŸºæœ¬çš„ç¼–å€æ–¹æ³•çš„æ”¹è¿›ã€‚</li><li>æž„æˆè¶…ç½‘ã€‚æ— åˆ†é…ç¼–å€æ–¹æ³•ã€‚å·²è¢«å¹¿æ³›ä½¿ç”¨ã€‚</li></ol><h1 id="åˆ†ç±»çš„-ip-åœ°å€">åˆ†ç±»çš„ IP åœ°å€</h1><table><tr><th>ç½‘ç»œç±»åˆ«</th><th>ç±»åˆ«ä½</th><th>ç½‘ç»œå·</th><th>ä¸»æœºå·</th></tr><tr><td>A</td><td>0</td><td>8 ä½</td><td>24 ä½</td></tr><tr><td>B</td><td>10</td><td>16 ä½</td><td>16 ä½</td></tr><tr><td>C</td><td>110</td><td>24 ä½</td><td>8 ä½</td></tr><tr><td>D</td><td>1110</td><td colspan="2" style="text-align: center;">å¤šæ’­åœ°å€</td></tr><tr><td>E</td><td>1111</td><td colspan="2" style="text-align: center;">ä¿ç•™ä¸ºä»ŠåŽä½¿ç”¨</td></tr></table><a id="more"></a><p>ç”³è¯· IP åœ°å€æ—¶ï¼Œå®žé™…ä¸Šæ˜¯èŽ·å¾—äº†å…·æœ‰åŒæ ·ç½‘ç»œå·çš„ä¸€å—åœ°å€ã€‚å…¶ä¸­å…·ä½“çš„å„å°ä¸»æœºå·åˆ™ç”±å•ä½è‡ªè¡Œåˆ†é…ï¼Œåªè¦åšåˆ°åœ¨è¯¥å•ä½ç®¡è¾–çš„èŒƒå›´å†…æ— é‡å¤çš„ä¸»æœºå·å³å¯ã€‚</p><p>A ç±»åœ°å€çš„ç½‘ç»œå·çš„ç¬¬ä¸€ä½å›ºå®šä¸º 0ï¼Œå› æ­¤ A ç±»åœ°å€ç©ºé—´å…±æœ‰ 2^31 ä¸ªåœ°å€ï¼Œå æ•´ä¸ª IP åœ°å€ç©ºé—´çš„ 50%ã€‚åŒç†ï¼ŒB ç±»å  25%ï¼ŒC ç±»å  12.5%ã€‚</p><p>å…¨ 0 çš„ä¸»æœºå·å­—æ®µè¡¨ç¤ºè¯¥ IP åœ°å€æ˜¯â€œæœ¬ä¸»æœºâ€æ‰€è¿žæŽ¥åˆ°çš„<strong>ä¸€ä¸ªç½‘ç»œçš„åœ°å€</strong>ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸»æœºçš„ IP åœ°å€ä¸º 5.6.7.8ï¼Œåˆ™è¯¥ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œåœ°å€å°±æ˜¯ 5.0.0.0ï¼‰ï¼Œè€Œå…¨ 1 è¡¨ç¤ºâ€œ<strong>æ‰€æœ‰çš„</strong>â€ï¼Œå…¨ 1 çš„ä¸»æœºå·å­—æ®µè¡¨ç¤ºè¯¥ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºã€‚</p><table><thead><tr class="header"><th>ç½‘ç»œç±»åˆ«</th><th>æœ€å¤§å¯æŒ‡æ´¾ç½‘ç»œæ•°</th><th>ä¸æŒ‡æ´¾ç½‘ç»œå·</th><th>ç¬¬ä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·</th><th>æœ€åŽä¸€ä¸ªå¯æŒ‡æ´¾çš„ç½‘ç»œå·</th><th>æœ€å¤§ä¸»æœºæ•°</th></tr></thead><tbody><tr class="odd"><td>A</td><td>2^7 - 2</td><td>0 å’Œ 127</td><td>1</td><td>126</td><td>2^24 - 2</td></tr><tr class="even"><td>B</td><td>2^14 - 1</td><td>128.0</td><td>128.1</td><td>191.255</td><td>2^16 - 2</td></tr><tr class="odd"><td>C</td><td>2^21 - 1</td><td>192.0.0</td><td>192.0.1</td><td>223.255.255</td><td>2^8 - 2</td></tr></tbody></table><p>A ç±»åœ°å€çš„ç½‘ç»œå·æœ‰ 7 ä½å¯ç”¨ï¼Œä½†å¯æŒ‡æ´¾çš„ç½‘ç»œå·æ˜¯ 2^7 - 2 = 126 ä¸ªã€‚å‡ 2 çš„åŽŸå› æ˜¯ï¼šç¬¬ä¸€ï¼Œç½‘ç»œå·å­—æ®µå…¨ 0 çš„ IP åœ°å€æ˜¯ä¸ªä¿ç•™åœ°å€ï¼Œæ„æ€æ˜¯â€<strong>æœ¬ç½‘ç»œ</strong>â€œï¼›ç¬¬äºŒï¼Œç½‘ç»œå·ä¸º 127ï¼ˆå³ 01111111ï¼‰ä¿ç•™ä½œä¸ºæœ¬åœ°è½¯ä»¶<strong>çŽ¯å›žæµ‹è¯•</strong>ï¼ˆloopback testï¼‰æœ¬ä¸»æœºçš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¹‹ç”¨ã€‚è‹¥ä¸»æœºå‘é€ä¸€ä¸ªç›®çš„åœ°å€ä¸ºçŽ¯å›žåœ°å€ï¼ˆä¾‹å¦‚ 127.0.0.1ï¼‰çš„ IP æ•°æ®æŠ¥ï¼Œåˆ™æœ¬ä¸»æœºä¸­çš„åè®®è½¯ä»¶å°±ä¼šå¤„ç†æ•°æ®æŠ¥ä¸­çš„æ•°æ®ï¼Œè€Œä¸ä¼šæŠŠæ•°æ®æŠ¥å‘é€åˆ°ä»»ä½•ç½‘ç»œã€‚ç›®çš„åœ°å€ä¸ºçŽ¯å›žåœ°å€çš„ IP æ•°æ®æŠ¥æ°¸è¿œä¸ä¼šå‡ºçŽ°åœ¨ä»»ä½•ç½‘ç»œä¸Šï¼Œå› ä¸ºç½‘ç»œå·ä¸º 127 çš„åœ°å€æ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªç½‘ç»œåœ°å€ã€‚</p><p>IP åœ°å€å…·æœ‰ä»¥ä¸‹ä¸€äº›é‡è¦ç‰¹ç‚¹ã€‚</p><ol type="1"><li>æ¯ä¸€ä¸ª IP åœ°å€éƒ½ç”±ç½‘ç»œå·å’Œä¸»æœºå·ä¸¤éƒ¨åˆ†ç»„æˆã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼šç¬¬ä¸€ï¼Œ<strong>æ–¹ä¾¿ IP åœ°å€çš„ç®¡ç†</strong>ï¼ŒIP åœ°å€ç®¡ç†æœºæž„åœ¨åˆ†é… IP åœ°å€æ—¶åªåˆ†é…ç½‘ç»œå·ï¼Œè€Œä¸»æœºå·ç”±å•ä½è‡ªè¡Œåˆ†é…ã€‚ç¬¬äºŒï¼Œè·¯ç”±å™¨ä»…<strong>æ ¹æ®ç›®çš„ä¸»æœºæ‰€è¿žæŽ¥çš„ç½‘ç»œå·æ¥è½¬å‘åˆ†ç»„</strong>ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿è·¯ç”±è¡¨ä¸­çš„é¡¹ç›®æ•°å¤§å¹…åº¦å‡å°‘ï¼Œä»Žè€Œå‡å°äº†è·¯ç”±è¡¨æ‰€å çš„å­˜å‚¨ç©ºé—´ä»¥åŠæŸ¥æ‰¾è·¯ç”±è¡¨çš„æ—¶é—´ã€‚</li><li>å®žé™…ä¸Š IP åœ°å€æ˜¯æ ‡å¿—ä¸€å°ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰å’Œä¸€æ¡é“¾è·¯çš„<strong>æŽ¥å£</strong>ã€‚å½“ä¸€å°ä¸»æœºåŒæ—¶è¿žæŽ¥åˆ°ä¸¤ä¸ªç½‘ç»œä¸Šæ—¶ï¼Œè¯¥ä¸»æœºå°±å¿…é¡»åŒæ—¶å…·æœ‰ä¸¤ä¸ªç›¸åº”çš„ IP åœ°å€ï¼Œå…¶ç½‘ç»œå·å¿…é¡»æ˜¯ä¸åŒçš„ã€‚è¿™ç§ä¸»æœºç§°ä¸º<strong>å¤šå½’å±žä¸»æœº</strong>ï¼ˆmultihomed hostï¼‰ã€‚<strong>ç”±äºŽä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“è¿žæŽ¥åˆ°ä¸¤ä¸ªç½‘ç»œï¼Œå› æ­¤ä¸€ä¸ªè·¯ç”±å™¨è‡³å°‘åº”å½“æœ‰ä¸¤ä¸ªä¸åŒçš„ IP åœ°å€</strong>ã€‚</li><li>æŒ‰ç…§äº’è”ç½‘çš„è§‚ç‚¹ï¼Œä¸€ä¸ªç½‘ç»œæ˜¯æŒ‡å…·æœ‰ç›¸åŒç½‘ç»œå·çš„ä¸»æœºçš„é›†åˆã€‚å› æ­¤ï¼Œç”¨è½¬å‘å™¨æˆ–ç½‘æ¡¥è¿žæŽ¥èµ·æ¥çš„è‹¥å¹²ä¸ªå±€åŸŸç½‘ä»ä¸ºä¸€ä¸ªç½‘ç»œã€‚å…·æœ‰ä¸åŒç½‘ç»œå·çš„å±€åŸŸç½‘å¿…é¡»ä½¿ç”¨è·¯ç”±å™¨è¿›è¡Œè¿žæŽ¥ã€‚</li><li>åœ¨ IP åœ°å€ä¸­ï¼Œæ‰€æœ‰åˆ†é…åˆ°ç½‘ç»œå·çš„ç½‘ç»œéƒ½æ˜¯<strong>å¹³ç­‰</strong>çš„ã€‚æ‰€è°“å¹³ç­‰ï¼Œåªæ˜¯äº’è”ç½‘åŒç­‰å¯¹å¾…æ¯ä¸€ä¸ª IP åœ°å€ã€‚</li></ol><h2 id="ip-åœ°å€å’Œç¡¬ä»¶åœ°å€">IP åœ°å€å’Œç¡¬ä»¶åœ°å€</h2><p>ç¡¬ä»¶åœ°å€ï¼ˆç‰©ç†åœ°å€ï¼ŒMAC åœ°å€ï¼‰æ˜¯æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ä½¿ç”¨çš„åœ°å€ï¼Œè€Œ IP åœ°å€æ˜¯ç½‘ç»œå±‚å’Œä»¥ä¸Šå„å±‚ä½¿ç”¨çš„åœ°å€ï¼Œæ˜¯ä¸€ç§é€»è¾‘åœ°å€ï¼Œæ˜¯ç”¨è½¯ä»¶å®žçŽ°çš„ã€‚</p><p><img src="/uploads/image/computer-networking/ip-address-and-hardware-address.jpeg"></p><p>è·¯ç”±å™¨åŒæ—¶è¿žæŽ¥åˆ°ä¸¤ä¸ªç½‘ç»œä¸Šæ—¶ï¼Œå¿…é¡»å…·æœ‰ä¸¤ä¸ªä¸åŒçš„ IP åœ°å€ï¼Œä¹Ÿè¦æœ‰ä¸¤ä¸ªç¡¬ä»¶åœ°å€ã€‚</p><p>åœ¨ç½‘ç»œå±‚åªèƒ½çœ‹åˆ° IP æ•°æ®æŠ¥ï¼Œæ•°æ®æŠ¥è¢«è½¬å‘æ—¶ï¼Œé¦–éƒ¨ä¸­çš„æºåœ°å€å’Œç›®çš„åœ°å€å§‹ç»ˆä¸å˜ã€‚åœ¨é“¾è·¯å±‚åªèƒ½çœ‹åˆ° MAC å¸§ï¼ŒIP æ•°æ®æŠ¥è¢«å°è£…åœ¨ MAC å¸§ä¸­ã€‚MAC å¸§åœ¨ä¸åŒçš„ç½‘ç»œä¸Šä¼ é€æ—¶ï¼Œå…¶é¦–éƒ¨ä¸­çš„æºåœ°å€å’Œç›®çš„åœ°å€è¦å‘ç”Ÿå˜åŒ–ã€‚</p><h2 id="åœ°å€è§£æžåè®®-arp">åœ°å€è§£æžåè®® ARP</h2><p>ç”±äºŽæ˜¯ IP åœ°å€ä½¿ç”¨äº† ARP åè®®ï¼Œå› æ­¤é€šå¸¸å°±æŠŠ ARP åè®®åˆ’å½’ç½‘ç»œå±‚ã€‚</p><p>æ¯ä¸€å°ä¸»æœºéƒ½è®¾æœ‰ä¸€ä¸ª ARP é«˜é€Ÿç¼“å­˜ï¼Œé‡Œé¢æœ‰<strong>æœ¬å±€åŸŸç½‘</strong>ä¸Šçš„å„ä¸»æœºå’Œè·¯ç”±å™¨çš„ IP åœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„è¡¨ã€‚æ³¨æ„ï¼ŒARP æ˜¯è§£å†³åŒä¸€ä¸ªå±€åŸŸç½‘ä¸Šçš„ä¸»æœºå’Œè·¯ç”±å™¨çš„ IP åœ°å€å’Œç¡¬ä»¶åœ°å€çš„æ˜ å°„é—®é¢˜ã€‚ä¸»æœºä¸éœ€è¦çŸ¥é“è¿œç¨‹ä¸»æœºçš„ç¡¬ä»¶åœ°å€ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„ IP åœ°å€ã€‚IP æ•°æ®æŠ¥é€šè¿‡è¿žåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘çš„è·¯ç”±å™¨æ¥è½¬å‘ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„è·¯ç”±å™¨ä¸Šï¼Œå†ç”¨ç±»ä¼¼æ–¹æ³•è§£æžå‡ºç›®çš„ä¸»æœºçš„ç¡¬ä»¶åœ°å€å¹¶äº¤ä»˜ã€‚</p><p>å½“ä¸»æœº A è¦å‘<strong>æœ¬å±€åŸŸç½‘</strong>ä¸Šçš„ä¸»æœº B å‘é€ IP æ•°æ®æŠ¥æ—¶ï¼Œå…ˆåœ¨ ARP é«˜é€Ÿç¼“å­˜ä¸­æŸ¥çœ‹æœ‰æ— ä¸»æœº B çš„ IP åœ°å€ã€‚å¦‚æœ‰ï¼Œå°±æŸ¥å‡ºå…¶å¯¹åº”çš„ç¡¬ä»¶åœ°å€ï¼Œå†æŠŠè¿™ä¸ªç¡¬ä»¶åœ°å€å†™å…¥ MAC å¸§ï¼Œç„¶åŽé€šè¿‡å±€åŸŸç½‘å‘é€è¯¥ MAC å¸§ã€‚è‹¥æ— ï¼Œä¸»æœº A æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰¾å‡ºä¸»æœº B çš„ç¡¬ä»¶åœ°å€ã€‚</p><ol type="1"><li>åœ¨æœ¬å±€åŸŸç½‘ä¸Š<strong>å¹¿æ’­</strong>å‘é€ä¸€ä¸ª ARP è¯·æ±‚åˆ†ç»„ï¼Œä¸»è¦å†…å®¹æ˜¯ï¼šâ€œæˆ‘çš„ IP åœ°å€æ˜¯ ... ç¡¬ä»¶åœ°å€æ˜¯ ... æˆ‘æƒ³çŸ¥é“ IP åœ°å€ä¸º .. çš„ä¸»æœºçš„ç¡¬ä»¶åœ°å€ã€‚â€œ</li><li>åœ¨æœ¬å±€åŸŸç½‘ä¸Šçš„æ‰€æœ‰ä¸»æœºéƒ½æ”¶åˆ°æ­¤ ARP è¯·æ±‚åˆ†ç»„ã€‚è‹¥ä¸»æœºçš„ IP åœ°å€ä¸Ž ARP è¯·æ±‚åˆ†ç»„ä¸­è¦æŸ¥è¯¢çš„ IP åœ°å€ä¸ä¸€è‡´ï¼Œå°±ä¸ç†ç¬è¿™ä¸ªè¯·æ±‚åˆ†ç»„ã€‚ï¼ˆä¹Ÿæœ‰å¯èƒ½ç†ç¬ä¸€ä¸‹ï¼Œæ›´æ–°è‡ªå·±çš„ ARP ç¼“å­˜ï¼Œå†™å…¥ä¸»æœº A çš„ IP åœ°å€å’Œç¡¬ä»¶åœ°å€ï¼‰</li><li>ä¸»æœº B çš„ IP åœ°å€ä¸Žè¯·æ±‚åˆ†ç»„ä¸­è¦æŸ¥è¯¢çš„ IP åœ°å€ä¸€è‡´ï¼Œå°±æ”¶ä¸‹è¿™ä¸ªè¯·æ±‚åˆ†ç»„ï¼ˆåŒæ—¶æ›´æ–° ARP ç¼“å­˜å†™å…¥ä¸»æœº A çš„ IP åœ°å€å’Œç¡¬ä»¶åœ°å€ï¼‰ï¼Œå¹¶å‘ä¸»æœº A å‘é€ ARP å“åº”åˆ†ç»„ï¼ˆ<strong>å•æ’­</strong>ï¼‰ï¼Œåœ¨è¿™ä¸ªå“åº”åˆ†ç»„ä¸­å†™å…¥è‡ªå·±çš„ç¡¬ä»¶åœ°å€ã€‚</li><li>ä¸»æœº A æ”¶åˆ°å“åº”åˆ†ç»„åŽï¼Œå°±åœ¨å…¶ ARP é«˜é€Ÿç¼“å­˜ä¸­å†™å…¥ä¸»æœº B çš„ IP åœ°å€åˆ°ç¡¬ä»¶åœ°å€çš„æ˜ å°„ã€‚</li></ol><p>ARP å¯¹ä¿å­˜åœ¨é«˜é€Ÿç¼“å­˜ä¸­çš„æ¯ä¸€ä¸ªæ˜ å°„åœ°å€éƒ½è®¾ç½®<strong>ç”Ÿå­˜æ—¶é—´</strong>ã€‚å½“ç¡¬ä»¶åœ°å€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œèƒ½é€šè¿‡ ARP å†æ¬¡æŸ¥è¯¢æ–°çš„åœ°å€ã€‚</p><h2 id="ip-æ•°æ®æŠ¥çš„æ ¼å¼">IP æ•°æ®æŠ¥çš„æ ¼å¼</h2><p><img src="/uploads/image/computer-networking/ip-header.jpeg"></p><ul><li>ç‰ˆæœ¬ï¼š4ï¼ˆIPv4ï¼‰æˆ– 6ï¼ˆIPv6ï¼‰</li><li>é¦–éƒ¨é•¿åº¦ï¼šå•ä½æ˜¯ 4 å­—èŠ‚ï¼Œå› æ­¤æœ€å°å€¼æ˜¯ 5ï¼ˆåªæœ‰å›ºå®šé¦–éƒ¨ï¼Œæ²¡æœ‰æ•°æ®ï¼‰ï¼Œæœ€å¤§å€¼ 15ï¼Œå³ 60 å­—èŠ‚ã€‚å½“é¦–éƒ¨é•¿åº¦ä¸æ˜¯ 4 å­—èŠ‚çš„æ•´æ•°å€æ—¶ï¼Œå¿…é¡»åˆ©ç”¨å¡«å……å­—æ®µåŠ ä»¥å¡«å……ï¼ˆå…¨ 0ï¼‰ã€‚</li><li><p>æ€»é•¿åº¦ï¼šå•ä½æ˜¯å­—èŠ‚ï¼Œå› æ­¤æ•°æ®æŠ¥çš„æœ€å¤§é•¿åº¦ä¸º 2^16 - 1 = 65535 å­—èŠ‚ã€‚ç„¶è€Œä¼ é€è¿™æ ·é•¿çš„æ•°æ®æŠ¥åœ¨çŽ°å®žä¸­æžå°‘é‡åˆ°ã€‚IP å±‚ä¸‹é¢çš„æ¯ä¸€ç§æ•°æ®é“¾è·¯å±‚åè®®éƒ½è§„å®šäº†ä¸€ä¸ªæ•°æ®å¸§ä¸­çš„<strong>æ•°æ®å­—æ®µçš„æœ€å¤§é•¿åº¦</strong>ï¼Œç§°ä¸º<strong>æœ€å¤§ä¼ é€å•å…ƒ</strong> MTUï¼ˆMaximum Transfer Unitï¼‰ã€‚å½“ä¸€ä¸ª IP æ•°æ®æŠ¥å°è£…æˆé“¾è·¯å±‚çš„å¸§æ—¶ï¼Œæ€»é•¿åº¦ä¸èƒ½è¶…è¿‡ MTUï¼Œå¦åˆ™å¿…é¡»æŠŠè¿‡é•¿çš„æ•°æ®æŠ¥è¿›è¡Œåˆ†ç‰‡å¤„ç†ã€‚</p><p>ä½¿ç”¨å°½å¯èƒ½é•¿çš„ IP æ•°æ®æŠ¥ä¼šä½¿ä¼ è¾“æ•ˆçŽ‡å¾—åˆ°æé«˜ï¼Œä½†æ•°æ®æŠ¥çŸ­äº›ä¹Ÿæœ‰å¥½å¤„ã€‚æ¯ä¸€ä¸ª IP æ•°æ®æŠ¥è¶ŠçŸ­ï¼Œè·¯ç”±å™¨è½¬å‘çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚ä¸ºæ­¤ï¼Œ IP åè®®è§„å®šï¼Œåœ¨äº’è”ç½‘ä¸­æ‰€æœ‰çš„ä¸»æœºå’Œè·¯ç”±å™¨ï¼Œå¿…é¡»èƒ½å¤ŸæŽ¥å—é•¿åº¦ä¸è¶…è¿‡ 576 å­—èŠ‚çš„æ•°æ®æŠ¥ã€‚è¿™æ˜¯å‡å®šä¸Šå±‚äº¤ä¸‹æ¥çš„æ•°æ®é•¿åº¦æœ‰ 512 å­—èŠ‚ï¼ˆåˆç†çš„é•¿åº¦ï¼‰ï¼ŒåŠ ä¸Šæœ€é•¿çš„ IP é¦–éƒ¨ 60 å­—èŠ‚ï¼Œå†åŠ ä¸Š 4 å­—èŠ‚çš„å¯Œä½™é‡ï¼Œå°±å¾—åˆ° 576 å­—èŠ‚ã€‚å½“ä¸»æœºéœ€è¦å‘é€é•¿åº¦è¶…è¿‡ 576 å­—èŠ‚çš„æ•°æ®æŠ¥æ—¶ï¼Œåº”å½“å…ˆäº†è§£ä¸€ä¸‹ï¼Œç›®çš„ä¸»æœºèƒ½å¦æŽ¥å—æ‰€è¦å‘é€çš„æ•°æ®æŠ¥é•¿åº¦ã€‚å¦åˆ™ï¼Œå°±è¦è¿›è¡Œåˆ†ç‰‡ã€‚</p></li><li><p>æ ‡è¯†ã€æ ‡å¿—ã€ç‰‡åç§»ï¼šè¿™ä¸‰ä¸ªå­—æ®µä¸Žåˆ†ç‰‡æœ‰å…³ã€‚</p><p>æ ‡è¯†ï¼šIP è½¯ä»¶åœ¨å­˜å‚¨å™¨ä¸­ç»´æŒä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯äº§ç”Ÿä¸€ä¸ªæ•°æ®æŠ¥ï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼Œå¹¶å°†æ­¤å€¼èµ‹ç»™æ ‡è¯†å­—æ®µã€‚</p><p>æ ‡å¿—ï¼šMFï¼ˆMore Fragmentï¼‰ï¼ŒMF = 1 è¡¨ç¤ºåŽé¢è¿˜æœ‰åˆ†ç‰‡çš„æ•°æ®æŠ¥ã€‚MF = 0 è¡¨ç¤ºè¿™å·²ç»æ˜¯æœ€åŽä¸€ä¸ªåˆ†ç‰‡ã€‚DFï¼ˆDon't Fragmentï¼‰ï¼ŒDF = 1 è¡¨ç¤ºä¸è¦åˆ†ç‰‡ã€‚åªæœ‰å½“ DF = 0 æ—¶æ‰å…è®¸åˆ†ç‰‡ã€‚</p><p>ç‰‡åç§»ï¼šä»¥ 8 ä¸ªå­—èŠ‚ä¸ºåç§»å•ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåˆ†ç‰‡çš„é•¿åº¦ä¸€å®šæ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚</p><table><thead><tr class="header"><th></th><th>æ€»é•¿åº¦ï¼ˆ20 å­—èŠ‚é¦–éƒ¨ï¼‰</th><th>æ ‡è¯†</th><th>MF</th><th>DF</th><th>ç‰‡åç§»</th></tr></thead><tbody><tr class="odd"><td>åŽŸå§‹æ•°æ®æŠ¥</td><td>3820</td><td>12345</td><td>0</td><td>0</td><td>0</td></tr><tr class="even"><td>æ•°æ®æŠ¥ç‰‡ 1</td><td>1420</td><td>12345</td><td>1</td><td>0</td><td>0</td></tr><tr class="odd"><td>æ•°æ®æŠ¥ç‰‡ 2</td><td>1420</td><td>12345</td><td>1</td><td>0</td><td>175</td></tr><tr class="even"><td>æ•°æ®æŠ¥ç‰‡ 3</td><td>1020</td><td>12345</td><td>0</td><td>0</td><td>350</td></tr></tbody></table></li><li>ç”Ÿå­˜æ—¶é—´ï¼šTTLï¼ˆTime To Liveï¼‰ï¼ŒçŽ°åœ¨æŒ‡<strong>è·³æ•°</strong>ï¼Œè¡¨æ˜Žæ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­çš„å¯¿å‘½ï¼Œé˜²æ­¢æ— æ³•äº¤ä»˜çš„æ•°æ®æŠ¥æ— é™åˆ¶åœ°åœ¨äº’è”ç½‘ä¸­å…œåœˆå­ã€‚è‹¥ TTL = 1ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªæ•°æ®æŠ¥åªèƒ½åœ¨æœ¬å±€åŸŸç½‘ä¸­ä¼ é€ã€‚</li><li><p>åè®®ï¼šæŒ‡å‡ºæ­¤æ•°æ®æŠ¥æºå¸¦çš„æ•°æ®æ˜¯ä½¿ç”¨ä½•ç§åè®®ï¼Œä»¥ä¾¿ä½¿ç›®çš„ä¸»æœºçš„ IP å±‚çŸ¥é“åº”å°†æ•°æ®éƒ¨åˆ†ä¸Šäº¤ç»™å“ªä¸ªåè®®è¿›è¡Œå¤„ç†ã€‚</p><table><thead><tr class="header"><th>åè®®å</th><th>ICMP</th><th>IGMP</th><th>IP</th><th>TCP</th><th>EGP</th><th>IGP</th><th>UDP</th><th>IPv6</th><th>ESP</th><th>OSPF</th></tr></thead><tbody><tr class="odd"><td>åè®®å­—æ®µå€¼</td><td>1</td><td>2</td><td>4</td><td>6</td><td>8</td><td>9</td><td>17</td><td>41</td><td>50</td><td>89</td></tr></tbody></table></li><li><p>é¦–éƒ¨æ£€éªŒå’Œï¼šåªæ£€éªŒæ•°æ®æŠ¥é¦–éƒ¨ï¼Œæ•°æ®æŠ¥æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œè·¯ç”±å™¨éƒ½è¦é‡æ–°è®¡ç®—ä¸€ä¸‹é¦–éƒ¨æ£€éªŒå’Œï¼ˆä¸€äº›å­—æ®µï¼Œå¦‚ç”Ÿå­˜æ—¶é—´ã€æ ‡å¿—ã€ç‰‡åç§»ç­‰éƒ½å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼‰ã€‚</p><p><img src="/uploads/image/computer-networking/ip-header-validation.jpeg"></p></li></ul><h2 id="è½¬å‘åˆ†ç»„çš„æµç¨‹">è½¬å‘åˆ†ç»„çš„æµç¨‹</h2><p>åœ¨äº’è”ç½‘ä¸Šè½¬å‘åˆ†ç»„æ—¶ï¼Œæ˜¯ä»Žä¸€ä¸ªè·¯ç”±å™¨è½¬å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚</p><p>åœ¨è·¯ç”±è¡¨ä¸­ï¼Œå¯¹æ¯ä¸€æ¡è·¯ç”±æœ€é‡è¦çš„æ˜¯ä»¥ä¸‹ä¸¤ä¸ªä¿¡æ¯ï¼š(ç›®çš„ç½‘ç»œåœ°å€ï¼Œä¸‹ä¸€è·³åœ°å€)</p><p>è™½ç„¶äº’è”ç½‘æ‰€æœ‰çš„åˆ†ç»„è½¬å‘éƒ½æ˜¯<strong>åŸºäºŽç›®çš„ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œ</strong>*ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å…è®¸æœ‰è¿™æ ·çš„ç‰¹ä¾‹ï¼Œå³å¯¹ç‰¹å®šçš„ç›®çš„ä¸»æœºæŒ‡æ˜Žä¸€ä¸ªè·¯ç”±ã€‚è¿™ç§è·¯ç”±å«åš<strong>ç‰¹å®šä¸»æœºè·¯ç”±</strong>ã€‚é‡‡ç”¨ç‰¹å®šä¸»æœºè·¯ç”±å¯ä½¿ç½‘ç»œç®¡ç†äººå‘˜æ›´<strong>æ–¹ä¾¿åœ°æŽ§åˆ¶ç½‘ç»œå’Œæµ‹è¯•ç½‘ç»œ</strong>ï¼ˆå¯¹ç½‘ç»œçš„è¿žæŽ¥æˆ–è·¯ç”±è¡¨è¿›è¡ŒæŽ’é”™ï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¯åœ¨éœ€è¦<strong>è€ƒè™‘æŸç§å®‰å…¨é—®é¢˜</strong>æ—¶é‡‡ç”¨è¿™ç§ç‰¹å®šä¸»æœºè·¯ç”±ã€‚</p><p>è·¯ç”±å™¨è¿˜å¯é‡‡ç”¨<strong>é»˜è®¤è·¯ç”±</strong>ï¼ˆdefault routeï¼‰ä»¥å‡å°è·¯ç”±è¡¨æ‰€å ç”¨çš„ç©ºé—´å’Œæœç´¢è·¯ç”±è¡¨æ‰€ç”¨çš„æ—¶é—´ã€‚è¿™ç§è½¬å‘æ–¹å¼åœ¨ä¸€ä¸ªç½‘ç»œåªæœ‰å¾ˆå°‘çš„å¯¹å¤–è¿žæŽ¥æ—¶æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸»æœºåœ¨å‘é€æ¯ä¸€ä¸ª IP æ•°æ®æŠ¥æ—¶éƒ½è¦æŸ¥æ‰¾è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œå¦‚æžœä¸€å°ä¸»æœºè¿žæŽ¥åœ¨ä¸€ä¸ªå°ç½‘ç»œä¸Šï¼Œè€Œè¿™ä¸ªç½‘ç»œåªç”¨ä¸€ä¸ªè·¯ç”±å™¨å’Œäº’è”ç½‘è¿žæŽ¥ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤è·¯ç”±æ˜¯éžå¸¸åˆé€‚çš„ã€‚</p><p><img src="/uploads/image/computer-networking/ip-default-route.jpeg"></p><p>IP æ•°æ®æŠ¥ä¸­æ²¡æœ‰ä¸‹ä¸€è·³è·¯ç”±å™¨çš„ IP åœ°å€ï¼Œé‚£ä¹ˆå¾…è½¬å‘çš„æ•°æ®æŠ¥æ€Žæ ·èƒ½å¤Ÿæ‰¾åˆ°ä¸‹ä¸€è·³è·¯ç”±å™¨å‘¢ï¼Ÿ</p><p>å½“è·¯ç”±å™¨æ”¶åˆ°ä¸€ä¸ªå¾…è½¬å‘çš„æ•°æ®æŠ¥ï¼Œä»Žè·¯ç”±è¡¨ä¸­å¾—å‡ºä¸‹ä¸€è·³è·¯ç”±å™¨çš„ IP åœ°å€åŽï¼Œä¸æ˜¯æŠŠè¿™ä¸ªåœ°å€å¡«å…¥ IP æ•°æ®æŠ¥ï¼Œè€Œæ˜¯<strong>é€äº¤æ•°æ®é“¾è·¯å±‚çš„ç½‘ç»œæŽ¥å£è½¯ä»¶</strong>ã€‚ç½‘ç»œæŽ¥å£è½¯ä»¶è´Ÿè´£æŠŠä¸‹ä¸€è·³è·¯ç”±å™¨çš„ IP åœ°å€è½¬æ¢æˆç¡¬ä»¶åœ°å€ï¼ˆä½¿ç”¨ ARPï¼‰ï¼Œå¹¶å°†æ­¤ç¡¬ä»¶åœ°å€æ”¾åœ¨é“¾è·¯å±‚çš„ MAC å¸§çš„é¦–éƒ¨ï¼Œç„¶åŽæ ¹æ®è¿™ä¸ªç¡¬ä»¶åœ°å€æ‰¾åˆ°ä¸‹ä¸€è·³è·¯ç”±å™¨ã€‚</p><p>åˆ†ç»„è½¬å‘ç®—æ³•å¦‚ä¸‹ï¼š</p><ol type="1"><li>ä»Žæ•°æ®æŠ¥é¦–éƒ¨æå–ç›®çš„ä¸»æœºçš„ IP åœ°å€ Dï¼Œå¾—å‡ºç›®çš„ç½‘ç»œåœ°å€ Nã€‚</li><li>è‹¥ç½‘ç»œ N ä¸Žæ­¤è·¯ç”±å™¨ç›´æŽ¥ç›¸è¿žï¼Œåˆ™è¿›è¡Œ<strong>ç›´æŽ¥äº¤ä»˜</strong>ï¼ŒæŠŠæ•°æ®æŠ¥äº¤ä»˜ç›®çš„ä¸»æœºï¼ˆæŸ¥æ‰¾ D çš„ç¡¬ä»¶åœ°å€ï¼Œå°è£… MAC å¸§ï¼Œå‘é€ï¼‰ã€‚å¦åˆ™å°±æ˜¯<strong>é—´æŽ¥äº¤ä»˜</strong>ã€‚</li><li>è‹¥è·¯ç”±è¡¨ä¸­æœ‰ D çš„ç‰¹å®šä¸»æœºè·¯ç”±ï¼Œåˆ™äº¤ä»˜ç‰¹å®šè·¯ç”±æŒ‡æ˜Žçš„ä¸‹ä¸€è·³è·¯ç”±å™¨ã€‚</li><li>è‹¥è·¯ç”±è¡¨ä¸­æœ‰ N çš„è·¯ç”±ï¼Œäº¤ä»˜ç»™æŒ‡å®šçš„ä¸‹ä¸€è·³è·¯ç”±å™¨ã€‚</li><li>è‹¥è·¯ç”±è¡¨ä¸­æœ‰ é»˜è®¤è·¯ç”±ï¼Œäº¤ä»˜ç»™é»˜è®¤è·¯ç”±å™¨ã€‚</li><li>å¦åˆ™ï¼ŒæŠ¥å‘Šè½¬å‘åˆ†ç»„å‡ºé”™ã€‚</li></ol><h1 id="åˆ’åˆ†å­ç½‘">åˆ’åˆ†å­ç½‘</h1><h2 id="ä»Žä¸¤çº§-ip-åˆ°ä¸‰çº§-ip">ä»Žä¸¤çº§ IP åˆ°ä¸‰çº§ IP</h2><ol type="1"><li>IP åœ°å€ç©ºé—´çš„åˆ©ç”¨çŽ‡æœ‰æ—¶å¾ˆä½Žã€‚æœ‰çš„å•ä½ç”³è¯·åˆ°äº†ä¸€ä¸ª B ç±»åœ°å€ï¼Œä½†æ‰€è¿žæŽ¥çš„ä¸»æœºæ•°å¹¶ä¸å¤šï¼Œå¯æ˜¯åˆä¸æ„¿æ„ç”³è¯·ä¸€ä¸ªè¶³å¤Ÿä½¿ç”¨çš„ C ç±»åœ°å€ï¼Œç†ç”±æ˜¯è€ƒè™‘åˆ°ä»ŠåŽå¯èƒ½çš„æ‰©å±•ã€‚IP åœ°å€çš„æµªè´¹ï¼Œä½¿ IP åœ°å€ç©ºé—´çš„èµ„æºè¿‡æ—©åœ°è¢«ç”¨å®Œã€‚</li><li>ç»™æ¯ä¸€ä¸ªç‰©ç†ç½‘ç»œåˆ†é…ä¸€ä¸ªç½‘ç»œå·ä¼š<strong>ä½¿è·¯ç”±è¡¨å˜å¾—å¤ªå¤§</strong>ï¼ˆéœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼‰å› è€Œä½¿ç½‘ç»œæ€§èƒ½å˜åï¼ˆæŸ¥æ‰¾è·¯ç”±è€—è´¹æ›´å¤šçš„æ—¶é—´ï¼‰ã€‚</li><li>ä¸¤çº§ IP åœ°å€ä¸å¤Ÿçµæ´»ã€‚ä¸€ä¸ªå•ä½éœ€è¦åœ¨æ–°çš„åœ°ç‚¹å¼€é€šä¸€ä¸ªæ–°çš„ç½‘ç»œã€‚ä½†æ˜¯åœ¨ç”³è¯·åˆ°ä¸€ä¸ªæ–°çš„ IP åœ°å€ä¹‹å‰ï¼Œæ–°å¢žåŠ çš„ç½‘ç»œæ˜¯ä¸å¯èƒ½è¿žæŽ¥åˆ°äº’è”ç½‘ä¸Šå·¥ä½œçš„ã€‚æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ç§æ–¹æ³•ï¼Œä½¿ä¸€ä¸ªå•ä½èƒ½éšæ—¶çµæ´»åœ°å¢žåŠ æœ¬å•ä½çš„ç½‘ç»œï¼Œè€Œä¸å¿…åŽ»ç”³è¯·æ–°çš„ç½‘ç»œå·ã€‚</li></ol><p>ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä»Ž 1985 å¹´èµ·åœ¨ IP åœ°å€ä¸­åˆå¢žåŠ äº†ä¸€ä¸ªâ€œå­ç½‘å·å­—æ®µâ€ï¼Œä½¿ä¸¤çº§ IP åœ°å€å˜ä¸ºä¸‰çº§ IP åœ°å€ï¼ˆç½‘ç»œå·ï¼Œå­ç½‘å·ï¼Œä¸»æœºå·ï¼‰ã€‚å­ç½‘å·æ˜¯ä»ŽåŽŸæ¥çš„ä¸»æœºå·å€Ÿç”¨è‹¥å¹²ä½ï¼Œè€ŒåŽŸæ¥çš„ä¸»æœºå·ç›¸åº”å‡å°‘äº†åŒæ ·çš„ä½æ•°ã€‚</p><p>ä»Žå…¶ä»–ç½‘ç»œå‘é€ç»™æœ¬ç½‘ç»œæŸå°ä¸»æœºçš„ IP æ•°æ®æŠ¥ï¼Œä»ç„¶æ˜¯æ ¹æ®<strong>ç½‘ç»œå·</strong>æ‰¾åˆ°è¿žæŽ¥åœ¨æœ¬ç½‘ç»œä¸Šçš„è·¯ç”±å™¨ã€‚ä½†æ­¤è·¯ç”±å™¨åœ¨æ”¶åˆ° IP æ•°æ®æŠ¥åŽï¼Œå†æŒ‰<strong>å­ç½‘å·</strong>æ‰¾åˆ°ç›®çš„å­ç½‘ï¼Œäº¤ä»˜ç›®çš„ä¸»æœºï¼ˆå­ç½‘ä¸Žè¯¥è·¯ç”±å™¨ç›´æŽ¥ç›¸è¿žï¼‰æˆ–ä¸Žå­ç½‘è¿žæŽ¥çš„è·¯ç”±å™¨ã€‚</p><h2 id="å­ç½‘æŽ©ç ">å­ç½‘æŽ©ç </h2><p>çŽ°åœ¨å‰©ä¸‹çš„é—®é¢˜æ˜¯ï¼Œè·¯ç”±å™¨æ— æ³•çœ‹å‡ºå­ç½‘å·æœ‰å‡ ä½ã€‚IP åœ°å€æœ¬èº«ä»¥åŠæ•°æ®æŠ¥é¦–éƒ¨éƒ½æ²¡æœ‰å…³äºŽå­ç½‘åˆ’åˆ†çš„ä¿¡æ¯ã€‚å› æ­¤å¿…é¡»å¦å¤–æƒ³åŠžæ³•ï¼Œè¿™å°±æ˜¯ä½¿ç”¨å­ç½‘æŽ©ç ï¼ˆsubnet maskï¼‰ã€‚</p><p><img src="/uploads/image/computer-networking/ip-subnet-mask.jpeg"></p><p>è™½ç„¶æ²¡æœ‰è§„å®šå­ç½‘æŽ©ç ä¸­çš„ä¸€ä¸² 1 å¿…é¡»æ˜¯è¿žç»­çš„ï¼Œä½†å´æžåŠ›æŽ¨èåœ¨å­ç½‘æŽ©ç ä¸­é€‰ç”¨è¿žç»­çš„ 1ï¼Œä»¥å…å‡ºçŽ°å·®é”™ã€‚</p><p>ä½¿ç”¨å­ç½‘æŽ©ç çš„å¥½å¤„æ˜¯ï¼šä¸ç®¡ç½‘ç»œæœ‰æ²¡æœ‰åˆ’åˆ†å­ç½‘ï¼Œåªè¦æŠŠå­ç½‘æŽ©ç å’Œ IP åœ°å€è¿›è¡Œâ€œä¸Žâ€è¿ç®—ï¼Œå°±ç«‹å³å¾—å‡ºç½‘ç»œåœ°å€æ¥ã€‚è¿™æ ·åœ¨è·¯ç”±å™¨å¤„ç†åˆ°æ¥çš„åˆ†ç»„æ—¶å°±å¯é‡‡ç”¨åŒæ ·çš„ç®—æ³•ã€‚</p><p>çŽ°åœ¨äº’è”ç½‘çš„æ ‡å‡†è§„å®šï¼šæ‰€æœ‰çš„ç½‘ç»œéƒ½å¿…é¡»ä½¿ç”¨å­ç½‘æŽ©ç ï¼ˆä¾¿äºŽæŸ¥æ‰¾è·¯ç”±è¡¨ï¼‰ï¼ŒåŒæ—¶<strong>åœ¨è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¸­ä¹Ÿå¿…é¡»æœ‰å­ç½‘æŽ©ç è¿™ä¸€æ </strong>ã€‚å¦‚æžœä¸€ä¸ªç½‘ç»œä¸åˆ’åˆ†å­ç½‘ï¼Œé‚£ä¹ˆè¯¥ç½‘ç»œçš„å­ç½‘æŽ©ç å°±ä½¿ç”¨é»˜è®¤å­ç½‘æŽ©ç ã€‚é»˜è®¤å­ç½‘æŽ©ç ä¸­ 1 çš„ä½ç½®å’Œ IP åœ°å€ä¸­çš„ç½‘ç»œå·å­—æ®µæ­£å¥½ç›¸å¯¹åº”ã€‚A ç±»ï¼š255.0.0.0ã€‚ B ç±»ï¼š255.255.0.0ã€‚ C ç±»ï¼š255.255.255.0ã€‚</p><p>è·¯ç”±å™¨åœ¨å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢è·¯ç”±ä¿¡æ¯æ—¶ï¼Œå¿…é¡»æŠŠè‡ªå·±æ‰€åœ¨ç½‘ç»œï¼ˆæˆ–å­ç½‘ï¼‰çš„å­ç½‘æŽ©ç å‘Šè¯‰ç›¸é‚»è·¯ç”±å™¨ã€‚åœ¨è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¸­çš„æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œé™¤äº†è¦ç»™å‡ºç›®çš„ç½‘ç»œåœ°å€å¤–ï¼Œè¿˜å¿…é¡»åŒæ—¶ç»™å‡ºè¯¥ç½‘ç»œçš„å­ç½‘æŽ©ç ã€‚è‹¥ä¸€ä¸ªè·¯ç”±å™¨è¿žæŽ¥åœ¨ä¸¤ä¸ªå­ç½‘ä¸Šå°±æ‹¥æœ‰ä¸¤ä¸ªç½‘ç»œåœ°å€å’Œä¸¤ä¸ªå­ç½‘æŽ©ç ã€‚</p><p>åˆ’åˆ†å­ç½‘å¢žåŠ äº†çµæ´»æ€§ï¼Œä½†å´å‡å°‘äº†ç½‘ç»œä¸Šèƒ½è¿žæŽ¥çš„æœ€å¤§ä¸»æœºæ€»æ•°ã€‚</p><h2 id="ä½¿ç”¨å­ç½‘æ—¶åˆ†ç»„çš„è½¬å‘">ä½¿ç”¨å­ç½‘æ—¶åˆ†ç»„çš„è½¬å‘</h2><p>ä½¿ç”¨å­ç½‘åŽï¼Œè·¯ç”±è¡¨å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸‰é¡¹å†…å®¹ï¼šï¼ˆç›®çš„ç½‘ç»œåœ°å€ï¼Œå­ç½‘æŽ©ç ï¼Œä¸‹ä¸€è·³åœ°å€ï¼‰ã€‚</p><ol type="1"><li>ä»Žæ”¶åˆ°çš„æ•°æ®æŠ¥é¦–éƒ¨æå–ç›®çš„ IP åœ°å€ Dã€‚</li><li>åˆ¤æ–­æ˜¯å¦å¯ä»¥ç›´æŽ¥äº¤ä»˜ï¼šå¯¹è·¯ç”±å™¨ç›´æŽ¥è¿žæŽ¥çš„ç½‘ç»œé€ä¸ªè¿›è¡Œæ£€æŸ¥ï¼Œç”¨å„ç½‘ç»œçš„å­ç½‘æŽ©ç å’Œ D ç›¸ä¸Žï¼Œçœ‹ç»“æžœæ˜¯å¦å’Œç›¸åº”çš„ç½‘ç»œåœ°å€åŒ¹é…ã€‚è‹¥åŒ¹é…ï¼Œåˆ™ç›´æŽ¥äº¤ä»˜ï¼ˆæŸ¥æ‰¾ç‰©ç†åœ°å€ï¼Œå°è£…æˆå¸§ï¼Œå‘é€ï¼‰ã€‚å¦åˆ™æ˜¯é—´æŽ¥äº¤ä»˜ã€‚</li><li>è‹¥æœ‰ç›®çš„åœ°å€ä¸º D çš„ç‰¹å®šä¸»æœºè·¯ç”±ï¼Œäº¤ä»˜ä¸‹ä¸€è·³è·¯ç”±ã€‚</li><li>å¯¹è·¯ç”±è¡¨ä¸­æ¯ä¸€è¡Œï¼Œç”¨ D ä¸Žå­ç½‘æŽ©ç ç›¸ä¸Žï¼Œå…¶ç»“æžœä¸º Nã€‚è‹¥ N ä¸Žç›®çš„ç½‘ç»œåœ°å€åŒ¹é…ï¼Œäº¤ä»˜ä¸‹ä¸€è·³è·¯ç”±å™¨ã€‚</li><li>è‹¥æœ‰é»˜è®¤è·¯ç”±ï¼Œäº¤ä»˜é»˜è®¤è·¯ç”±å™¨ã€‚</li><li>æŠ¥å‘Šè½¬å‘åˆ†ç»„å‡ºé”™ã€‚</li></ol><h1 id="æ— åˆ†ç±»ç¼–å€æž„é€ è¶…ç½‘">æ— åˆ†ç±»ç¼–å€ï¼ˆæž„é€ è¶…ç½‘ï¼‰</h1><h2 id="ç½‘ç»œå‰ç¼€">ç½‘ç»œå‰ç¼€</h2><p>æ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹© CIDRï¼ˆClassless Inter-Domain Routingï¼Œè¯»éŸ³æ˜¯ â€œsiderâ€ï¼‰æœ€ä¸»è¦çš„ç‰¹ç‚¹æœ‰ä¸¤ä¸ªï¼š</p><ol type="1"><li><p>CIDR æ¶ˆé™¤äº†ä¼ ç»Ÿçš„ Aã€Bã€C ç±»åœ°å€ä»¥åŠåˆ’åˆ†å­ç½‘çš„æ¦‚å¿µï¼Œèƒ½æ›´åŠ æœ‰æ•ˆåœ°åˆ†é… IPv4 çš„åœ°å€ç©ºé—´ã€‚</p><p>CIDR ä½¿ IP åœ°å€åˆå›žåˆ°äº†ä¸¤çº§ç¼–å€ï¼šï¼ˆç½‘ç»œå‰ç¼€ï¼Œä¸»æœºå·ï¼‰ã€‚</p><p>CIDR ä½¿ç”¨æ–œçº¿è®°æ³•ï¼Œåœ¨ IP åœ°å€åŽé¢åŠ ä¸Šæ–œçº¿ â€œ/â€ï¼Œç„¶åŽå†™ä¸Šç½‘ç»œå‰ç¼€æ‰€å çš„ä½æ•°ã€‚</p></li><li><p>CIDR æŠŠç½‘ç»œå‰ç¼€éƒ½ç›¸åŒçš„è¿žç»­çš„ IP åœ°å€ç»„æˆä¸€ä¸ªâ€œCIDR åœ°å€å—â€ã€‚åªè¦çŸ¥é“åœ°å€å—ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ°å€ï¼Œå°±å¯ä»¥çŸ¥é“è¿™ä¸ªåœ°å€å—çš„èµ·å§‹åœ°å€ï¼ˆå³æœ€å°åœ°å€ï¼‰å’Œæœ€å¤§åœ°å€ï¼Œä»¥åŠåœ°å€å—ä¸­çš„åœ°å€æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œ128.14.35.7/20ï¼Œå‰ 20 ä½æ˜¯ç½‘ç»œå‰ç¼€ï¼Œå³å­ç½‘æŽ©ç çš„å‰ 20 ä½æ˜¯ 1ï¼ŒåŽ 16 ä½æ˜¯ 0ã€‚</p><p>128.14.35.7/20 = <u>10000000 00001110 0010</u>0011 00000111</p><p>æœ€å°åœ°å€ï¼š128.14.32.0 = <u>10000000 00001110 0010</u>0000 00000000</p><p>æœ€å¤§åœ°å€ï¼š128.14.47.255 = <u>10000000 00001110 0010</u>1111 11111111</p><p>å½“ç„¶ï¼Œä¸€èˆ¬å¹¶ä¸ä½¿ç”¨ä»¥ä¸Šè¿™ä¸¤ä¸ªç‰¹æ®Šçš„ä¸»æœºå·ã€‚ä¸Šé¢çš„åœ°å€å—å¯è®°ä¸º 128.14.32.0/20ã€‚</p></li></ol><p>â€œCIDR ä¸ä½¿ç”¨å­ç½‘â€æ˜¯æŒ‡ CIDR å¹¶æ²¡æœ‰åœ¨ 32 ä½åœ°å€ä¸­æŒ‡æ˜Žè‹¥å¹²ä½ä½œä¸ºå­ç½‘å­—æ®µã€‚ä½†åˆ†é…åˆ°ä¸€ä¸ª CIDR åœ°å€å—çš„å•ä½ï¼Œä»ç„¶å¯ä»¥æ ¹æ®éœ€è¦åˆ’åˆ†å‡ºä¸€äº›å­ç½‘ã€‚è¿™äº›å­ç½‘ä¹Ÿéƒ½åªæœ‰ä¸€ä¸ªç½‘ç»œå‰ç¼€å’Œä¸€ä¸ªä¸»æœºå·ï¼Œä½†å­ç½‘çš„ç½‘ç»œå‰ç¼€æ¯”åœ°å€å—çš„ç½‘ç»œå‰ç¼€è¦é•¿äº›ã€‚</p><p>ç”±äºŽä¸€ä¸ª CIDR åœ°å€å—ä¸­æœ‰å¾ˆå¤šåœ°å€ï¼Œæ‰€ä»¥åœ¨è·¯ç”±è¡¨ä¸­å°±åˆ©ç”¨ CIDR åœ°å€å—æ¥æŸ¥æ‰¾ç›®çš„ç½‘ç»œã€‚è¿™ç§åœ°å€çš„èšåˆå¸¸ç§°ä¸º<strong>è·¯ç”±èšåˆ</strong>ï¼ˆroute aggregationï¼‰ï¼Œå®ƒä½¿å¾—è·¯ç”±è¡¨ä¸­çš„ä¸€ä¸ªé¡¹ç›®å¯ä»¥è¡¨ç¤ºä¼ ç»Ÿåˆ†ç±»åœ°å€çš„å¾ˆå¤šä¸ªè·¯ç”±ã€‚</p><p>å¸¸ç”¨çš„ CIDR åœ°å€å—</p><table><colgroup><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"></colgroup><thead><tr class="header"><th>CIDR å‰ç¼€é•¿åº¦</th><th>ç‚¹åˆ†åè¿›åˆ¶</th><th>åŒ…å«çš„åœ°å€æ•°</th><th>ç›¸å½“äºŽ</th></tr></thead><tbody><tr class="odd"><td>/13</td><td>255.248.0.0</td><td>512 K ~ 2^(32 - 13) ä¸ª</td><td>8 ä¸ª B ç±»ï¼ˆ2^16 ä¸ªåœ°å€ï¼‰æˆ– 2048 ä¸ª C ç±»ï¼ˆ2^8 ä¸ªåœ°å€ï¼‰</td></tr><tr class="even"><td>/14</td><td>255.252.0.0</td><td>256 K</td><td>4 ä¸ª B ç±»æˆ– 1024 ä¸ª C ç±»</td></tr><tr class="odd"><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr class="even"><td>/23</td><td>255.255.254.0</td><td>512</td><td>2 ä¸ª C ç±»</td></tr><tr class="odd"><td>/24</td><td>255.255.255.0</td><td>256</td><td>1 ä¸ª C ç±»</td></tr><tr class="even"><td>/25</td><td>255.255.255.128</td><td>128</td><td>1/2 ä¸ª C ç±»</td></tr><tr class="odd"><td>/26</td><td>255.255.255.192</td><td>64</td><td>1/4 ä¸ª C ç±»</td></tr><tr class="even"><td>/27</td><td>255.255.255.224</td><td>32</td><td>1/8 ä¸ª C ç±»</td></tr></tbody></table><p>è·¯ç”±èšåˆä¹Ÿç§°ä¸º<strong>æž„æˆè¶…ç½‘</strong>ï¼ˆsupernettingï¼‰ã€‚é™¤æœ€åŽå‡ è¡Œå¤–ï¼ŒCIDR åœ°å€å—éƒ½åŒ…å«äº†å¤šä¸ª C ç±»åœ°å€ï¼Œè¿™å°±æ˜¯â€œæž„æˆè¶…ç½‘â€è¿™ä¸€åæ¬¡çš„æ¥æºã€‚</p><p>ä½¿ç”¨ CIDR çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥æ›´åŠ æœ‰æ•ˆåœ°åˆ†é… IPv4 çš„åœ°å€ç©ºé—´ï¼Œå¯æ ¹æ®å®¢æˆ·çš„éœ€è¦åˆ†é…é€‚å½“å¤§å°çš„åœ°å€å—ã€‚è€Œåœ¨åˆ†ç±»åœ°å€ä¸­ï¼Œåªèƒ½ä»¥ /8ï¼ˆA ç±»ï¼‰ï¼Œ/16ï¼ˆB ç±»ï¼‰ï¼Œ/24ï¼ˆC ç±»ï¼‰æ¥åˆ†é…ï¼Œå¾ˆä¸çµæ´»ã€‚</p><h2 id="æœ€é•¿å‰ç¼€åŒ¹é…">æœ€é•¿å‰ç¼€åŒ¹é…</h2><p>åœ¨ä½¿ç”¨ CIDR æ—¶ï¼ŒæŸ¥æ‰¾è·¯ç”±è¡¨æ—¶å¯èƒ½ä¼šå¾—åˆ°ä¸æ­¢ä¸€ä¸ªåŒ¹é…ç»“æžœï¼Œ<strong>åº”å½“ä»ŽåŒ¹é…ç»“æžœä¸­é€‰æ‹©å…·æœ‰æœ€é•¿ç½‘ç»œå‰ç¼€çš„è·¯ç”±</strong>ã€‚è¿™å«åš<strong>æœ€é•¿å‰ç¼€åŒ¹é…</strong>ï¼ˆlongest-perfix matchingï¼‰ã€‚å› ä¸ºç½‘ç»œå‰ç¼€è¶Šé•¿ï¼Œè·¯ç”±å°±è¶Šå…·ä½“ã€‚</p><p>ä¾‹å¦‚ï¼Œè·¯ç”±è¡¨ä¸­æœ‰ä»¥ä¸‹ä¸¤ä¸ªé¡¹ç›®ï¼š206.0.68.0/22 å’Œ 206.0.71.128/25ã€‚çŽ°åœ¨å‡å®šæ”¶åˆ°ä¸€ä¸ªæ•°æ®æŠ¥ï¼Œå…¶ç›®çš„ IP åœ°å€ä¸º D=206.0.71.130ã€‚D ä¸Žè¿™ä¸¤ä¸ªç›®çš„ç½‘ç»œéƒ½åŒ¹é…ï¼Œæ ¹æ®æœ€é•¿å‰ç¼€åŒ¹é…ï¼Œåº”å½“é€‰æ‹©åŽè€…ã€‚å› ä¸º 206.0.71.128/25 æ˜¯ 206.0.68.0/22 çš„å­ç½‘ï¼Œå®ƒæ›´å…·ä½“ã€‚</p><p>é‡‡ç”¨ CIDRï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ç½‘ç»œæ‰€åœ¨çš„åœ°ç†ä½ç½®æ¥åˆ†é…åœ°å€å—ï¼Œè¿™æ ·å°±å¯å¤§å¤§å‡å°‘è·¯ç”±è¡¨ä¸­çš„è·¯ç”±é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ä¸–ç•Œåˆ’åˆ†ä¸ºå››å¤§åœ°åŒºï¼Œæ¯ä¸€åœ°åŒºåˆ†é…ä¸€ä¸ª CIDR åœ°å€å—ï¼š</p><ul><li>åœ°å€å— 194/7ï¼ˆ194.0.0.0 è‡³ 195.255.255.255ï¼‰åˆ†é…ç»™æ¬§æ´²ã€‚</li><li>åœ°å€å— 198/7ï¼ˆ198.0.0.0 è‡³ 199.255.255.255ï¼‰åˆ†é…ç»™åŒ—ç¾Žæ´²ã€‚</li><li>åœ°å€å— 200/7ï¼ˆ200.0.0.0 è‡³ 201.255.255.255ï¼‰åˆ†é…ç»™ä¸­ç¾Žæ´²å’Œå—ç¾Žæ´²ã€‚</li><li>åœ°å€å— 202/7ï¼ˆ202.0.0.0 è‡³ 203.255.255.255ï¼‰åˆ†é…ç»™äºšæ´²å’Œå¤ªå¹³æ´‹åœ°åŒºã€‚</li></ul><p>ä¸Šé¢çš„æ¯ä¸€ä¸ªåœ°å€å—åŒ…å«çº¦ 3200 ä¸‡ä¸ªåœ°å€ã€‚å‡¡æ˜¯å‘å¾€åŒ—ç¾Žçš„ IP æ•°æ®æŠ¥ï¼ˆç›®çš„ IP åœ°å€çš„å‰ 7 ä½æ˜¯åè¿›åˆ¶ 194ï¼‰éƒ½å…ˆé€äº¤ä½äºŽç¾Žå›½çš„ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå› æ­¤åœ¨è·¯ç”±è¡¨ä¸­ä½¿ç”¨ä¸€ä¸ªé¡¹ç›®å°±è¡Œäº†ã€‚</p><h2 id="ä½¿ç”¨äºŒå‰çº¿ç´¢æŸ¥æ‰¾è·¯ç”±">ä½¿ç”¨äºŒå‰çº¿ç´¢æŸ¥æ‰¾è·¯ç”±</h2><p>ä½¿ç”¨ CIDR åŽï¼Œç”±äºŽè¦å¯»æ‰¾æœ€é•¿å‰ç¼€åŒ¹é…ï¼Œä½¿è·¯ç”±è¡¨çš„æŸ¥æ‰¾è¿‡ç¨‹å˜å¾—æ›´åŠ å¤æ‚äº†ã€‚ä¸ºäº†è¿›è¡Œæ›´åŠ æœ‰æ•ˆçš„æŸ¥æ‰¾ï¼Œé€šå¸¸æ˜¯æŠŠæ— åˆ†ç±»ç¼–å€çš„è·¯ç”±è¡¨æ”¾åœ¨ä¸€ç§å±‚æ¬¡çš„æ•°æ®ç»“æž„ä¸­ï¼Œç„¶åŽè‡ªä¸Šè€Œä¸‹åœ°æŒ‰å±‚æ¬¡è¿›è¡ŒæŸ¥æ‰¾ã€‚è¿™é‡Œæœ€å¸¸ç”¨çš„å°±æ˜¯<strong>äºŒå‰çº¿ç´¢</strong>ï¼ˆbinary trieï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šç»“æž„çš„æ ‘ã€‚IP åœ°å€ä¸­ä»Žå·¦åˆ°åŽçš„æ¯”ç‰¹å€¼å†³å®šäº†ä»Žæ ¹èŠ‚ç‚¹é€å±‚å‘ä¸‹å±‚å»¶ä¼¸çš„è·¯å¾„ã€‚</p><p>ä¸ºäº†ç®€åŒ–äºŒå‰çº¿ç´¢çš„ç»“æž„ï¼Œå¯ä»¥å…ˆæ‰¾å‡ºå¯¹åº”ä¸Žæ¯ä¸€ä¸ª IP åœ°å€çš„<strong>å”¯ä¸€å‰ç¼€</strong>ï¼ˆunique prefixï¼‰ã€‚æ‰€è°“å”¯ä¸€å‰ç¼€å°±æ˜¯åœ¨è¡¨ä¸­æ‰€æœ‰çš„ IP åœ°å€ä¸­ï¼Œè¯¥å‰ç¼€æ˜¯å”¯ä¸€çš„ã€‚è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œåªè¦èƒ½å¤Ÿå’Œå”¯ä¸€å‰ç¼€ç›¸åŒ¹é…å°±è¡Œäº†ã€‚</p><p><img src="/uploads/image/computer-networking/ip-binary-trie.jpeg"></p><p>ç”±äºŽå”¯ä¸€å‰ç¼€ä¸€èˆ¬éƒ½å°äºŽ 32 ä½ï¼Œå› æ­¤ç”¨å”¯ä¸€å‰ç¼€æž„é€ çš„äºŒå‰çº¿ç´¢çš„æ·±åº¦å¾€å¾€ä¸åˆ° 32 å±‚ã€‚äºŒå‰çº¿ç´¢çš„æ¯ä¸ªå¶èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå”¯ä¸€å‰ç¼€ã€‚ä¾‹å¦‚æœ‰ä¸€ä¸ªåœ°å€æ˜¯ 10011011 ...ï¼Œéœ€è¦æŸ¥æ‰¾è¯¥åœ°å€æ˜¯å¦åœ¨æ­¤äºŒå‰çº¿ç´¢ä¸­ã€‚ä»Žå·¦è¾¹å¼€å§‹æŸ¥èµ·ï¼ŒæŸ¥åˆ°ç¬¬ä¸‰ä¸ªå­—ç¬¦æ—¶ï¼Œæ‰¾ä¸åˆ°åŒ¹é…çš„ï¼Œè¯´æ˜Žè¿™ä¸ªåœ°å€ä¸åœ¨è¿™ä¸ªäºŒå‰çº¿ç´¢ä¸­ã€‚</p><p>ç›®çš„åœ°å€<strong>ä¸ŽæŸä¸€å‰ç¼€åŒ¹é…ä¸æ„å‘³ç€ä¸€å®šä¸Žç½‘ç»œå‰ç¼€åŒ¹é…</strong>ã€‚è¦å°†äºŒå‰çº¿ç´¢ç”¨äºŽè·¯ç”±è¡¨ä¸­ï¼Œè¿˜å¿…é¡»ä½¿æ¯ä¸€ä¸ªå¶èŠ‚ç‚¹åŒ…å«æ‰€å¯¹åº”çš„ç½‘ç»œå‰ç¼€å’Œå­ç½‘æŽ©ç ã€‚å½“æœç´¢åˆ°ä¸€ä¸ªå¶èŠ‚ç‚¹æ—¶ï¼Œå°±å¿…é¡»å°†ç›®çš„åœ°å€å’Œå­ç½‘æŽ©ç è¿›è¡Œâ€œä¸Žâ€è¿ç®—ï¼Œçœ‹ç»“æžœæ˜¯å¦ä¸Žå¯¹åº”çš„ç½‘ç»œå‰ç¼€ç›¸åŒ¹é…ã€‚è‹¥åŒ¹é…ï¼Œå°±æŒ‰ä¸‹ä¸€è·³çš„æŽ¥å£è½¬å‘åˆ†ç»„ã€‚å¦åˆ™ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ã€‚</p><p>ä¸ºäº†æé«˜äºŒå‰çº¿ç´¢çš„æŸ¥æ‰¾é€Ÿåº¦ï¼Œå¹¿æ³›ä½¿ç”¨äº†å„ç§<strong>åŽ‹ç¼©æŠ€æœ¯</strong>ã€‚ä¾‹å¦‚ï¼Œå›¾ä¸­çš„æœ€åŽä¸¤ä¸ªåœ°å€ï¼Œå…¶æœ€å‰é¢ 4 ä½éƒ½æ˜¯ 1011.å› æ­¤ï¼Œåªè¦æœ‰ä¸€ä¸ªåœ°å€çš„å‰ 4 ä½æ˜¯ 1011ï¼Œå°±å¯ä»¥è·³è¿‡å‰é¢ 4 ä½ï¼ˆå³åŽ‹ç¼©äº† 4 ä¸ªå±‚æ¬¡ï¼‰è€Œç›´æŽ¥ä»Žç¬¬ 5 ä½å¼€å§‹æ¯”è¾ƒã€‚å½“ç„¶ï¼Œåˆ¶ä½œç»è¿‡åŽ‹ç¼©çš„äºŒå‰çº¿ç´¢éœ€è¦æ›´å¤šçš„è®¡ç®—ï¼Œä½†ç”±äºŽæ¯ä¸€æ¬¡æŸ¥æ‰¾è·¯ç”±æ—¶éƒ½å¯ä»¥æé«˜æŸ¥æ‰¾é€Ÿåº¦ï¼Œè¿™æ ·åšè¿˜æ˜¯å€¼å¾—çš„ã€‚</p><h1 id="ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®®-icmp">ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMP</h1><p>ä¸ºäº†æ›´æœ‰æ•ˆåœ°è½¬å‘ IP æ•°æ®æŠ¥å’Œæé«˜äº¤ä»˜æˆåŠŸçš„æœºä¼šï¼Œåœ¨ç½‘é™…å±‚ä½¿ç”¨äº† ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMPï¼ˆInternet Control Message Protocolï¼‰ã€‚ICMP å…è®¸ä¸»æœºæˆ–è·¯ç”±å™¨æŠ¥å‘Šå·®é”™æƒ…å†µå’Œæä¾›æœ‰å…³å¼‚å¸¸æƒ…å†µçš„æŠ¥å‘Šã€‚</p><p>ICMP æŠ¥æ–‡æ˜¯<strong>å°åœ¨ IP æ•°æ®æŠ¥</strong>ä¸­ï¼Œä½œä¸ºå…¶ä¸­çš„æ•°æ®éƒ¨åˆ†ã€‚çœ‹èµ·æ¥åƒé«˜å±‚åè®®ï¼Œå…¶å®žä¸æ˜¯ï¼Œè€Œæ˜¯ IP å±‚çš„åè®®ã€‚</p><p>ICMP æŠ¥æ–‡æœ‰ä¸¤ç§ï¼š<strong>ICMP å·®é”™æŠ¥å‘ŠæŠ¥æ–‡</strong> å’Œ <strong>ICMP è¯¢é—®æŠ¥æ–‡</strong>ã€‚</p><p>ICMP æŠ¥æ–‡çš„å‰ 4 ä¸ªå­—èŠ‚æ˜¯ç»Ÿä¸€çš„æ ¼å¼ï¼Œç±»åž‹ï¼ˆ1ï¼‰ã€ä»£ç ï¼ˆ1ï¼‰å’Œæ£€éªŒå’Œï¼ˆ2ï¼‰ã€‚æŽ¥ç€çš„ 4 ä¸ªå­—èŠ‚çš„å†…å®¹ä¸Ž ICMP çš„ç±»åž‹æœ‰å…³ã€‚æœ€åŽé¢æ˜¯æ•°æ®å­—æ®µã€‚</p><table><tr><th>ICMP æŠ¥æ–‡ç§ç±»</th><th>ç±»åž‹çš„å€¼</th><th>ç±»åž‹</th></tr><tr><td rowspan="4">å·®é”™æŠ¥å‘ŠæŽ§åˆ¶æŠ¥æ–‡</td><td>3</td><td>ç»ˆç‚¹ä¸å¯è¾¾</td></tr><tr><td>11</td><td>æ—¶é—´è¶…è¿‡</td></tr><tr><td>12</td><td>å‚æ•°é—®é¢˜</td></tr><tr><td>5</td><td>æ”¹å˜è·¯ç”±ï¼ˆRedirectï¼‰</td></tr><tr><td rowspan="2">è¯¢é—®æŠ¥æ–‡</td><td>8 æˆ– 0</td><td>å›žé€ï¼ˆEchoï¼‰è¯·æ±‚æˆ–å›žç­”</td></tr><tr><td>13 æˆ– 14</td><td>æ—¶é—´æˆ³ï¼ˆTimestampï¼‰è¯·æ±‚æˆ–å›žç­”</td></tr></table><h2 id="å·®é”™æŠ¥å‘ŠæŠ¥æ–‡">å·®é”™æŠ¥å‘ŠæŠ¥æ–‡</h2><ul><li>ç»ˆç‚¹ä¸å¯è¾¾ï¼šå½“è·¯ç”±å™¨æˆ–ä¸»æœºä¸èƒ½äº¤ä»˜æ•°æ®æŠ¥æ—¶ï¼Œå‘æºç‚¹å‘é€æ­¤æŠ¥æ–‡ã€‚</li><li>æ—¶é—´è¶…è¿‡ï¼šå½“è·¯ç”±å™¨æ”¶åˆ°ç”Ÿå­˜æ—¶é—´ä¸ºé›¶çš„æ•°æ®æŠ¥æ—¶ï¼Œé™¤ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ä»¥å¤–ï¼Œè¿˜è¦å‘æºç‚¹å‘é€æ­¤æŠ¥æ–‡ã€‚å½“ç»ˆç‚¹åœ¨è§„å®šæ—¶é—´å†…ä¸èƒ½æ”¶åˆ°ä¸€ä¸ªæ•°æ®æŠ¥çš„å…¨éƒ¨æ•°æ®æŠ¥ç‰‡æ—¶ï¼Œå°±æŠŠå·²æ”¶åˆ°çš„éƒ½ä¸¢å¼ƒï¼Œå¹¶å‘æºç‚¹å‘é€æ­¤æŠ¥æ–‡ã€‚</li><li>å‚æ•°é—®é¢˜ï¼šå½“è·¯ç”±å™¨æˆ–ä¸»æœºæ”¶åˆ°çš„æ•°æ®æŠ¥çš„é¦–éƒ¨ä¸­æœ‰çš„å­—æ®µçš„å€¼ä¸æ­£ç¡®æ—¶ï¼Œå°±ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œå¹¶å‘æºç‚¹å‘é€æ­¤æŠ¥æ–‡ã€‚</li><li><p>æ”¹å˜è·¯ç”±ï¼šè·¯ç”±å™¨æŠŠæ”¹å˜è·¯ç”±æŠ¥æ–‡å‘é€ç»™ä¸»æœºï¼Œè®©ä¸»æœºçŸ¥é“ä¸‹æ¬¡åº”å°†æ•°æ®æŠ¥å‘é€ç»™å¦å¤–çš„è·¯ç”±å™¨ï¼ˆå¯é€šè¿‡æ›´å¥½çš„è·¯ç”±ï¼‰ã€‚</p><p>åœ¨äº’è”ç½‘çš„ä¸»æœºä¸­ä¹Ÿè¦æœ‰ä¸€ä¸ªè·¯ç”±è¡¨ã€‚å½“ä¸»æœºè¦å‘é€æ•°æ®æŠ¥æ—¶ï¼Œé¦–å…ˆè¦æŸ¥æ‰¾ä¸»æœºè‡ªå·±çš„è·¯ç”±è¡¨ï¼Œçœ‹åº”å½“ä»Žå“ªä¸€ä¸ªæŽ¥å£æŠŠæ•°æ®æŠ¥å‘é€å‡ºåŽ»ã€‚åœ¨äº’è”ç½‘ä¸­ï¼Œä¸»æœºçš„æ•°é‡è¿œå¤§äºŽè·¯ç”±å™¨çš„æ•°é‡ï¼Œå‡ºäºŽæ•ˆçŽ‡çš„è€ƒè™‘ï¼Œè¿™äº›ä¸»æœºä¸å’Œè·¯ç”±å™¨å®šæœŸäº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚åœ¨ä¸»æœºåˆšå¼€å§‹å·¥ä½œæ—¶ï¼Œä¸€èˆ¬éƒ½åœ¨è·¯ç”±è¡¨ä¸­è®¾ç½®ä¸€ä¸ªé»˜è®¤è·¯ç”±å™¨çš„ IP åœ°å€ã€‚è¿™ä¸ªé»˜è®¤è·¯ç”±å™¨ï¼ˆé€šè¿‡å’Œå…¶ä»–è·¯ç”±å™¨äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼‰çŸ¥é“åˆ°æ¯ä¸€ä¸ªç›®çš„åœ°å€çš„æœ€ä½³è·¯ç”±ã€‚å¦‚æžœé»˜è®¤è·¯ç”±å™¨å‘çŽ°ä¸»æœºå‘å¾€æŸä¸ªç›®çš„åœ°å€çš„æ•°æ®æŠ¥çš„æœ€ä½³è·¯ç”±åº”å½“ç»è¿‡ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªè·¯ç”±å™¨æ—¶ï¼Œå°±ç”¨æ”¹å˜è·¯ç”±æŠ¥æ–‡æŠŠè¿™æƒ…å†µå‘Šè¯‰ä¸»æœºã€‚äºŽæ˜¯ï¼Œè¯¥ä¸»æœºå°±åœ¨å…¶è·¯ç”±è¡¨ä¸­å¢žåŠ ä¸€ä¸ªé¡¹ç›®ï¼šåˆ°æŸç›®çš„åœ°å€åº”ç»è¿‡æŸè·¯ç”±å™¨ï¼ˆè€Œä¸æ˜¯é»˜è®¤è·¯ç”±å™¨ï¼‰ã€‚</p></li></ul><p>æ‰€æœ‰çš„ ICMP å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ä¸­çš„æ•°æ®å­—æ®µéƒ½å…·æœ‰åŒæ ·çš„æ ¼å¼ã€‚</p><p><img src="/uploads/image/computer-networking/icmp-data.jpeg"></p><p>æå–æ”¶åˆ°çš„æ•°æ®æŠ¥çš„æ•°æ®å­—èŠ‚çš„å‰ 8 ä¸ªå­—èŠ‚ï¼ˆTCP æˆ– UDP çš„é¦–éƒ¨çš„å‰ 8 ä¸ªå­—èŠ‚ï¼‰æ˜¯ä¸ºäº†å¾—åˆ°è¿è¾“å±‚çš„ç«¯å£å·ï¼ˆå¯¹äºŽ TCP å’Œ UDPï¼‰ä»¥åŠè¿è¾“å±‚æŠ¥æ–‡çš„å‘é€åºå·ï¼ˆå¯¹äºŽ TCPï¼‰ã€‚æ•´ä¸ª ICMP æŠ¥æ–‡ä½œä¸º IP æ•°æ®æŠ¥çš„æ•°æ®å­—æ®µå‘é€ç»™æºç‚¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸åº”è¯¥å‘é€ ICMP å·®é”™æŠ¥å‘ŠæŠ¥æ–‡çš„å‡ ç§æƒ…å†µã€‚</p><ul><li>å¯¹ ICMP å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ï¼Œä¸å†å‘é€ ICMP å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚</li><li>å¯¹ç¬¬ä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®æŠ¥ç‰‡çš„æ‰€æœ‰åŽç»­æ•°æ®æŠ¥ç‰‡ï¼Œéƒ½ä¸å‘é€ã€‚</li><li>å¯¹å…·æœ‰å¤šæ’­åœ°å€çš„æ•°æ®æŠ¥ï¼Œéƒ½ä¸å‘é€ã€‚</li><li>å¯¹å…·æœ‰ç‰¹æ®Šåœ°å€ï¼ˆå¦‚ 127.0.0.0 æˆ– 0.0.0.0ï¼‰çš„æ•°æ®æŠ¥ï¼Œä¸å‘é€ã€‚</li></ul><h2 id="è¯¢é—®æŠ¥æ–‡">è¯¢é—®æŠ¥æ–‡</h2><ul><li>å›žé€è¯·æ±‚å’Œå›žç­”ï¼šç”±ä¸»æœºæˆ–è·¯ç”±å™¨å‘ä¸€ä¸ªç‰¹å®šçš„ç›®çš„ä¸»æœºå‘å‡ºè¯¢é—®ï¼Œæ”¶åˆ°æ­¤æŠ¥æ–‡çš„ä¸»æœºå¿…é¡»ç»™æºä¸»æœºæˆ–è·¯ç”±å™¨å‘é€ ICMP å›žé€å›žç­”æŠ¥æ–‡ã€‚è¿™ç§è¯¢é—®æŠ¥æ–‡ç”¨æ¥<strong>æµ‹è¯•ç›®çš„ç«™æ˜¯å¦å¯è¾¾</strong>ä»¥åŠ<strong>äº†è§£æœ‰å…³çŠ¶æ€</strong>ã€‚</li><li>æ—¶é—´æˆ³è¯·æ±‚å’Œå›žç­”ï¼šè¯·æŸå°ä¸»æœºæˆ–è·¯ç”±å™¨å›žç­”å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚å¯ç”¨äºŽæ—¶é’ŸåŒæ­¥å’Œæ—¶é—´æµ‹é‡ã€‚</li></ul><h2 id="icmp-åº”ç”¨ä¸¾ä¾‹">ICMP åº”ç”¨ä¸¾ä¾‹</h2><ul><li><p>åˆ†ç»„ç½‘é—´æŽ¢æµ‹ PINGï¼ˆPacket InterNet Groperï¼‰ï¼Œç”¨æ¥æµ‹è¯•ä¸¤å°ä¸»æœºä¹‹é—´çš„è¿žé€šæ€§ã€‚</p><p>PING ä½¿ç”¨ ICMP å›žé€è¯·æ±‚å’Œå›žé€å›žç­”æŠ¥æ–‡ï¼ˆ<strong>ICMP è¯¢é—®æŠ¥æ–‡</strong>ï¼‰ã€‚<strong>PING æ˜¯åº”ç”¨å±‚ç›´æŽ¥ä½¿ç”¨ç½‘ç»œå±‚ ICMP çš„ä¸€ä¸ªä¾‹å­ã€‚å®ƒæ²¡æœ‰é€šè¿‡è¿è¾“å±‚çš„ TCP æˆ– UDP</strong>ã€‚</p></li><li><p>tracerouteï¼ˆè¿™æ˜¯ UNIX æ“ä½œç³»ç»Ÿä¸­çš„åå­—ï¼‰æˆ– tracertï¼ˆWindows æ“ä½œç³»ç»Ÿä¸­çš„åå­—ï¼‰ï¼Œç”¨æ¥è·Ÿè¸ªä¸€ä¸ªåˆ†ç»„ä»Žæºç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ã€‚</p><p>traceroute ä»Žæºä¸»æœºå‘ç›®çš„ä¸»æœºå‘é€ä¸€è¿žä¸²çš„ IP æ•°æ®æŠ¥ï¼Œæ•°æ®æŠ¥ä¸­<strong>å°è£…çš„æ˜¯æ— æ³•äº¤ä»˜ï¼ˆä½¿ç”¨äº†éžæ³•çš„ç«¯å£ï¼‰çš„ UDP ç”¨æˆ·æ•°æ®æŠ¥</strong>ã€‚ç¬¬ä¸€ä¸ªæ•°æ®æŠ¥çš„ç”Ÿå­˜æ—¶é—´ TTL è®¾ç½®ä¸º 1ã€‚è·¯ç”±å™¨æ”¶ä¸‹åŽæŠŠ TTL çš„å€¼å‡ 1ï¼Œç”±äºŽ TTL ç­‰äºŽ 0 äº†ï¼Œå°±ä¸¢å¼ƒæŠ¥æ–‡å¹¶å‘æºä¸»æœºå‘é€ä¸€ä¸ª <strong>ICMP æ—¶é—´è¶…è¿‡</strong>å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚</p><p>æºä¸»æœºæŽ¥ç€å‘é€ç¬¬äºŒä¸ªæ•°æ®æŠ¥ï¼Œå¹¶æŠŠ TTL è®¾ç½®ä¸º 2 ... è¿™æ ·ä¸€ç›´ç»§ç»­ä¸‹åŽ»ï¼Œå½“æœ€åŽä¸€ä¸ªæ•°æ®æŠ¥åˆšåˆšåˆ°è¾¾ç›®çš„ä¸»æœºæ—¶ï¼Œæ•°æ®æŠ¥çš„ TTL æ˜¯ 1ã€‚ä¸»æœºä¸è½¬å‘æ•°æ®æŠ¥ï¼Œä½†å›  IP æ•°æ®æŠ¥ä¸­å°è£…çš„æ˜¯æ— æ³•äº¤ä»˜çš„ UDP ç”¨æˆ·æ•°æ®æŠ¥ï¼Œå› æ­¤ç›®çš„ä¸»æœºè¦å‘æºç‚¹å‘é€ <strong>ICMP ç»ˆç‚¹ä¸å¯è¾¾</strong>å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ã€‚</p></li></ul><h1 id="è·¯ç”±é€‰æ‹©åè®®">è·¯ç”±é€‰æ‹©åè®®</h1><p>è·¯ç”±è¡¨ä¸­çš„è·¯ç”±ï¼ˆè¡Œï¼‰æ˜¯æ€Žæ ·å¾—å‡ºçš„ã€‚</p><h2 id="ç†æƒ³çš„è·¯ç”±ç®—æ³•">ç†æƒ³çš„è·¯ç”±ç®—æ³•</h2><ol type="1"><li>æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚æ­£ç¡®çš„å«ä¹‰æ˜¯ï¼šæ²¿ç€å„è·¯ç”±è¡¨æ‰€æŒ‡å¼•çš„è·¯ç”±ï¼Œåˆ†ç»„ä¸€å®šèƒ½å¤Ÿæœ€ç»ˆåˆ°è¾¾ç›®çš„ç½‘ç»œå’Œç›®çš„ä¸»æœºã€‚</li><li>è®¡ç®—ä¸Šåº”ç®€å•ï¼Œä¸åº”ä½¿ç½‘ç»œå¢žåŠ å¤ªå¤šçš„é¢å¤–å¼€é”€ã€‚</li><li>è‡ªé€‚åº”æ€§ï¼Œèƒ½é€‚åº”é€šä¿¡é‡å’Œç½‘ç»œæ‹“æ‰‘çš„å˜åŒ–ã€‚ä¹Ÿç§°ç¨³å¥æ€§ï¼ˆrobustnessï¼‰ã€‚</li><li>ç¨³å®šæ€§ï¼Œç®—æ³•åº”æ”¶æ•›äºŽä¸€ä¸ªå¯ä»¥æŽ¥å—çš„è§£ï¼Œè€Œä¸åº”ä½¿å¾—è·¯ç”±ä¸åœåœ°å˜åŒ–ã€‚</li><li>å…¬å¹³æ€§ï¼Œå¯¹æ‰€æœ‰ç”¨æˆ·ï¼ˆé™¤å¯¹å°‘æ•°ä¼˜å…ˆçº§é«˜çš„ç”¨æˆ·ï¼‰éƒ½æ˜¯å¹³ç­‰çš„ã€‚</li><li>æœ€ä½³çš„ï¼Œä½¿å¾—åˆ†ç»„å¹³å‡æ—¶å»¶æœ€å°è€Œç½‘ç»œçš„åžåé‡æœ€å¤§ã€‚è™½ç„¶æˆ‘ä»¬å¸Œæœ›å¾—åˆ°â€æœ€ä½³â€œçš„ç®—æ³•ï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯æœ€é‡è¦çš„ã€‚å¯¹äºŽæŸäº›ç½‘ç»œï¼Œç½‘ç»œçš„å¯é æ€§æœ‰æ—¶è¦æ¯”æœ€å°çš„åˆ†ç»„å¹³å‡æ—¶å»¶æˆ–æœ€å¤§åžåé‡æ›´åŠ é‡è¦ã€‚å› æ­¤ï¼Œæ‰€è°“æœ€ä½³åªèƒ½æ˜¯ç›¸å¯¹äºŽæŸä¸€ç§ç‰¹å®šè¦æ±‚ä¸‹å¾—å‡ºçš„è¾ƒä¸ºåˆç†çš„é€‰æ‹©è€Œå·²ã€‚</li></ol><p>è‹¥ä»Žè·¯ç”±ç®—æ³•èƒ½å¦è™½ç½‘ç»œçš„é€šä¿¡é‡æˆ–æ‹“æ‰‘è‡ªé€‚åº”åœ°è¿›è¡Œè°ƒæ•´æ¥åŒºåˆ†ï¼Œåˆ™åªæœ‰ä¸¤å¤§ç±»ï¼š</p><ul><li>é™æ€è·¯ç”±é€‰æ‹©ç­–ç•¥ï¼Œä¹Ÿå«åšéžè‡ªé€‚åº”è·¯ç”±é€‰æ‹©ã€‚å…¶ç‰¹ç‚¹æ˜¯ç®€å•å’Œå¼€é”€å°ï¼Œä½†ä¸èƒ½åŠæ—¶é€‚åº”ç½‘ç»œçŠ¶æ€çš„å˜åŒ–ã€‚å¯¹äºŽå¾ˆç®€å•çš„å°ç½‘ç»œï¼Œå®Œå…¨å¯ä»¥é‡‡ç”¨é™æ€è·¯ç”±é€‰æ‹©ï¼Œç”¨äººå·¥é…ç½®æ¯ä¸€æ¡è·¯ç”±ã€‚</li><li>åŠ¨æ€è·¯ç”±é€‰æ‹©ç­–ç•¥ï¼Œä¹Ÿå«åšè‡ªé€‚åº”è·¯ç”±é€‰æ‹©ã€‚å…¶ç‰¹ç‚¹æ˜¯èƒ½è¾ƒå¥½åœ°é€‚åº”ç½‘ç»œçŠ¶æ€çš„å˜åŒ–ï¼Œä½†å®žçŽ°èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Œå¼€é”€ä¹Ÿæ¯”è¾ƒå¤§ã€‚å› æ­¤ï¼ŒåŠ¨æ€è·¯ç”±é€‰æ‹©é€‚ç”¨äºŽè¾ƒå¤æ‚çš„å¤§ç½‘ç»œã€‚</li></ul><h2 id="åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®®">åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®®</h2><p>äº’è”ç½‘é‡‡ç”¨çš„ä¸»è¦æ˜¯<strong>è‡ªé€‚åº”çš„ã€åˆ†å¸ƒå¼</strong>è·¯ç”±é€‰æ‹©åè®®ã€‚è€Œé‡‡ç”¨åˆ†å±‚æ¬¡çš„è·¯ç”±é€‰æ‹©åè®®æœ‰ä»¥ä¸‹ä¸¤ä¸ªåŽŸå› ï¼š</p><ol type="1"><li>äº’è”ç½‘çš„è§„æ¨¡éžå¸¸å¤§ã€‚å¦‚æžœè®©æ‰€æœ‰çš„è·¯ç”±å™¨çŸ¥é“æ‰€æœ‰çš„ç½‘ç»œåº”æ€Žæ ·åˆ°è¾¾ï¼Œåˆ™è¿™ç§è·¯ç”±è¡¨å°†éžå¸¸å¤§ï¼Œå¤„ç†èµ·æ¥ä¹Ÿå¤ªèŠ±æ—¶é—´ã€‚è€Œæ‰€æœ‰è¿™äº›è·¯ç”±å™¨ä¹‹é—´äº¤æ¢è·¯ç”±ä¿¡æ¯æ‰€éœ€çš„å¸¦å®½å°±ä¼šä½¿äº’è”ç½‘çš„é€šä¿¡é“¾è·¯é¥±å’Œã€‚</li><li>è®¸å¤šå•ä½ä¸æ„¿æ„å¤–ç•Œäº†è§£è‡ªå·±å•ä½ç½‘ç»œçš„å¸ƒå±€ç»†èŠ‚å’Œæœ¬éƒ¨é—¨æ‰€é‡‡ç”¨çš„è·¯ç”±é€‰æ‹©åè®®ï¼Œä½†åŒæ—¶è¿˜å¸Œæœ›è¿žæŽ¥åˆ°äº’è”ç½‘ä¸Šã€‚</li></ol><p>ä¸ºæ­¤ï¼Œå¯ä»¥æŠŠæ•´ä¸ªäº’è”ç½‘åˆ’åˆ†ä¸ºè®¸å¤šè¾ƒå°çš„<strong>è‡ªæ²»ç³»ç»Ÿ</strong> ASï¼ˆautonomous systemï¼‰ã€‚AS æ˜¯åœ¨å•ä¸€æŠ€æœ¯ç®¡ç†ä¸‹çš„ä¸€ç»„è·¯ç”±å™¨ï¼Œè¿™äº›è·¯ç”±å™¨ä½¿ç”¨ä¸€ç§è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„è·¯ç”±é€‰æ‹©åè®®å’Œå…±åŒçš„åº¦é‡ã€‚ä¸€ä¸ª AS å¯¹å…¶ä»– AS è¡¨çŽ°å‡ºçš„æ˜¯<strong>ä¸€ä¸ªå•ä¸€çš„å’Œä¸€è‡´çš„è·¯ç”±é€‰æ‹©ç­–ç•¥</strong>ã€‚</p><p>äº’è”ç½‘æŠŠè·¯ç”±é€‰æ‹©åè®®åˆ’åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><ol type="1"><li><strong>å†…éƒ¨ç½‘å…³åè®®</strong> IGPï¼ˆInterior Gateway Protocolï¼‰ å³åœ¨ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„è·¯ç”±é€‰æ‹©åè®®ã€‚ç›®å‰è¿™ç±»è·¯ç”±é€‰æ‹©åè®®ä½¿ç”¨å¾—æœ€å¤šï¼Œå¦‚ RIP å’Œ OSPF åè®®ã€‚</li><li><strong>å¤–éƒ¨ç½‘å…³åè®®</strong> EGPï¼ˆExternal Gateway Protocolï¼‰ è‹¥æºä¸»æœºå’Œç›®çš„ä¸»æœºå¤„åœ¨ä¸åŒçš„è‡ªæ²»ç³»ç»Ÿä¸­ï¼ˆè¿™ä¸¤ä¸ªè‡ªæ²»ç³»ç»Ÿå¯èƒ½ä½¿ç”¨ä¸åŒçš„å†…éƒ¨ç½‘å…³åè®®ï¼‰ï¼Œå½“æ•°æ®æŠ¥ä¼ åˆ°ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿçš„è¾¹ç•Œæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ä¸€ç§åè®®å°†è·¯ç”±é€‰æ‹©ä¿¡æ¯ä¼ é€’åˆ°å¦ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿä¸­ã€‚è¿™æ ·çš„åè®®å°±æ˜¯å¤–éƒ¨ç½‘å…³åè®® EGPã€‚ç›®å‰ä½¿ç”¨æœ€å¤šçš„å¤–éƒ¨ç½‘å…³åè®®æ˜¯ BGP-4ï¼ˆBGPçš„ç‰ˆæœ¬ 4ï¼‰ã€‚</li></ol><p>æ¯ä¸ªè‡ªæ²»ç³»ç»Ÿè‡ªå·±å†³å®šåœ¨æœ¬è‡ªæ²»ç³»ç»Ÿå†…éƒ¨è¿è¡Œå“ªä¸€ä¸ªå†…éƒ¨è·¯ç”±é€‰æ‹©åè®®ï¼ˆRIP æˆ– OSPFï¼‰ã€‚ä½†æ¯ä¸ªè‡ªæ²»ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè·¯ç”±å™¨é™¤è¿è¡Œæœ¬ç³»ç»Ÿçš„å†…éƒ¨è·¯ç”±é€‰æ‹©åè®®ä¹‹å¤–ï¼Œè¿˜è¦è¿è¡Œè‡ªæ²»ç³»ç»Ÿé—´çš„è·¯ç”±é€‰æ‹©åè®®ï¼ˆBGP-4ï¼‰ã€‚</p><p>ç½‘å…³æ˜¯æ—§ç§°ï¼Œå°±æ˜¯ç½‘ç»œå±‚çš„è·¯ç”±å™¨ã€‚å› æ­¤æœ‰çš„ä¹¦æŠŠ IGP å’Œ EGP åˆ†åˆ«æ”¹ä¸º IRP å’Œ ERPã€‚</p><h2 id="å†…éƒ¨ç½‘å…³åè®®-rip">å†…éƒ¨ç½‘å…³åè®® RIP</h2><p>RIPï¼ˆRouting Information Protocolï¼‰æ˜¯å†…éƒ¨ç½‘å…³åè®® IGP ä¸­æœ€å…ˆå¾—åˆ°å¹¿æ³›ä½¿ç”¨çš„åè®®ã€‚RIP æ˜¯ä¸€ç§<strong>åˆ†å¸ƒå¼çš„åŸºäºŽè·ç¦»å‘é‡</strong>çš„è·¯ç”±é€‰æ‹©åè®®ï¼Œå…¶æœ€å¤§çš„ä¼˜ç‚¹æ˜¯<strong>ç®€å•</strong>ã€‚</p><p>RIP åè®®è¦æ±‚ç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªè·¯ç”±å™¨éƒ½è¦ç»´æŠ¤ä»Žå®ƒè‡ªå·±åˆ°å…¶ä»–æ¯ä¸€ä¸ªç›®çš„ç½‘ç»œçš„è·ç¦»è®°å½•ï¼ˆå› æ­¤ï¼Œè¿™æ˜¯ä¸€ç»„è·ç¦»ï¼Œå³â€œè·ç¦»å‘é‡â€ï¼‰ã€‚RIP åè®®çš„â€œè·ç¦»â€ä¹Ÿç§°â€œè·³æ•°â€ï¼ˆhop countï¼‰ï¼Œå› ä¸ºæ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œè·³æ•°å°±åŠ  1ã€‚RIP è®¤ä¸ºå¥½çš„è·¯ç”±å°±æ˜¯å®ƒé€šè¿‡çš„è·¯ç”±å™¨çš„æ•°ç›®å°‘ï¼Œå³â€œè·ç¦»çŸ­â€ã€‚RIP å…è®¸ä¸€æ¡è·¯å¾„æœ€å¤šåªèƒ½åŒ…å« 15 ä¸ªè·¯ç”±å™¨ï¼Œå› æ­¤â€œè·ç¦»â€ç­‰äºŽ 16 æ—¶å³ç›¸å½“äºŽä¸å¯è¾¾ã€‚å¯è§ RIP åªé€‚ç”¨äºŽå°åž‹äº’è”ç½‘ã€‚</p><p>RIP ä¸èƒ½åœ¨ä¸¤ä¸ªç½‘ç»œä¹‹é—´ä½¿ç”¨å¤šæ¡è·¯ç”±ã€‚RIP é€‰æ‹©ä¸€æ¡å…·æœ‰æœ€å°‘è·¯ç”±å™¨çš„è·¯ç”±ï¼Œå“ªæ€•è¿˜å­˜åœ¨å¦ä¸€æ¡é«˜é€Ÿï¼ˆä½Žæ—¶å»¶ï¼‰ä½†è·¯ç”±å™¨è¾ƒå¤šçš„è·¯ç”±ã€‚</p><p>æˆ‘ä»¬ä¸€å®šè¦å¼„æ¸…ä»¥ä¸‹ä¸‰ä¸ªè¦ç‚¹ï¼Œå³<strong>å’Œå“ªäº›è·¯ç”±å™¨äº¤æ¢ä¿¡æ¯ï¼Ÿäº¤æ¢ä»€ä¹ˆä¿¡æ¯ï¼Ÿåœ¨ä»€ä¹ˆæ—¶å€™äº¤æ¢</strong>ï¼Ÿ</p><p>RIP åè®®çš„ç‰¹ç‚¹æ˜¯ï¼š</p><ol type="1"><li>ä»…å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢ä¿¡æ¯ã€‚å¦‚æžœä¸¤ä¸ªè·¯ç”±å™¨ä¹‹é—´çš„é€šä¿¡ä¸éœ€è¦ç»è¿‡å¦ä¸€ä¸ªè·¯ç”±å™¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªè·¯ç”±å™¨å°±æ˜¯ç›¸é‚»çš„ã€‚ä¸ç›¸é‚»çš„è·¯ç”±å™¨ä¸äº¤æ¢ä¿¡æ¯ã€‚</li><li>äº¤æ¢çš„ä¿¡æ¯æ˜¯å½“å‰æœ¬è·¯ç”±å™¨æ‰€çŸ¥é“çš„å…¨éƒ¨ä¿¡æ¯ï¼Œå³è‡ªå·±çŽ°åœ¨çš„è·¯ç”±è¡¨ã€‚</li><li>æŒ‰å›ºå®šçš„æ—¶é—´é—´éš”äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ¯éš” 30 ç§’ã€‚</li></ol><h3 id="è·ç¦»å‘é‡ç®—æ³•">è·ç¦»å‘é‡ç®—æ³•</h3><p>è·ç¦»å‘é‡ç®—æ³•çš„åŸºç¡€æ˜¯ Bellman-Ford ç®—æ³•ï¼ŒåŽŸç†æ˜¯æœ€çŸ­è·¯å¾„å…·æœ‰æœ€ä¼˜å­ç»“æž„æ€§è´¨ã€‚</p><p>å¯¹æ¯ä¸€ä¸ªç›¸é‚»è·¯ç”±å™¨å‘é€è¿‡æ¥çš„ RIP æŠ¥æ–‡ï¼Œè¿›è¡Œä»¥ä¸‹æ­¥éª¤ã€‚</p><ol type="1"><li><p>å¯¹åœ°å€ä¸º X çš„ç›¸é‚»è·¯ç”±å™¨å‘æ¥çš„ RIP æŠ¥æ–‡ï¼Œå…ˆä¿®æ”¹æ­¤æŠ¥æ–‡ä¸­çš„æ‰€æœ‰é¡¹ç›®ï¼šæŠŠâ€œä¸‹ä¸€è·³â€å­—æ®µä¸­çš„åœ°å€éƒ½æ”¹ä¸º Xï¼Œå¹¶æŠŠæ‰€æœ‰çš„â€œè·ç¦»â€å­—æ®µçš„å€¼éƒ½åŠ  1ã€‚ä¿®æ”¹åŽæ¯ä¸€ä¸ªé¡¹ç›®éƒ½ç”±ä¸‰ä¸ªå…³é”®æ•°æ®ï¼Œå³ï¼šç›®çš„ç½‘ç»œ Nï¼Œè·ç¦» dï¼Œä¸‹ä¸€è·³è·¯ç”±å™¨ Xã€‚ï¼ˆå³ X æŠŠå®ƒçš„è·¯ç”±è¡¨ä¼ ç»™æˆ‘äº†ï¼Œæˆ‘è¦æ¯”è¾ƒæˆ‘çš„è·¯ç”±è¡¨å’Œå®ƒçš„è·¯ç”±è¡¨ï¼Œçœ‹çœ‹åº”è¯¥æŒ‰æˆ‘çš„è·¯ç”±è¡¨ä¼ ï¼Œè¿˜æ˜¯å®ƒçš„ã€‚è¿™ä¸€æ­¥çš„ä¿®æ”¹åŠ¨ä½œå°±æ˜¯ä¸ºæŽ¥ä¸‹æ¥çš„æ¯”è¾ƒåšå‡†å¤‡ï¼ŒN æ˜¯ç›®çš„ç½‘ç»œï¼Œd å°±æ˜¯æˆ‘æŠŠåˆ†ç»„ä¼ ç»™ X å†ç”± X ç»­ä¼ åˆ° N çš„æ€»è·ç¦»ï¼‰</p></li><li><p>å¯¹ä¿®æ”¹åŽçš„æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>è‹¥è·¯ç”±è¡¨ä¸­æ²¡æœ‰ç›®çš„ç½‘ç»œ Nï¼Œæ·»åŠ è¯¥é¡¹ç›®åˆ°è·¯ç”±è¡¨ä¸­ã€‚å¦åˆ™ï¼Œè·¯ç”±è¡¨ä¸­æœ‰ç½‘ç»œ Nï¼Œå°±è¦æ¯”è¾ƒè·ç¦»äº†ï¼š<ul><li>è‹¥ä¸‹ä¸€è·³è·¯ç”±å™¨åœ°å€ä¹Ÿæ˜¯ Xï¼Œåˆ™æ›´æ–°è·ç¦» dã€‚ï¼ˆæ³¨æ„ï¼Œæ˜¯æ›´æ–°ã€‚å› ä¸ºç½‘ç»œçš„è·ç¦»æ˜¯å¯èƒ½å‘ç”Ÿå˜åŒ–çš„ï¼Œè¦ä»¥æœ€æ–°çš„æ¶ˆæ¯ä¸ºå‡†ï¼‰</li><li>è‹¥ä¸‹ä¸€è·³è·¯ç”±å™¨çš„åœ°å€ä¸æ˜¯ Xï¼Œåˆ™ä¿ç•™è·ç¦»è¾ƒå°çš„é‚£ä¸€é¡¹ã€‚</li></ul></li><li><p>è‹¥ 3 åˆ†é’Ÿè¿˜æ²¡æœ‰æ”¶åˆ°ç›¸é‚»è·¯ç”±å™¨çš„æ›´æ–°è·¯ç”±è¡¨ï¼Œåˆ™æŠŠæ­¤ç›¸é‚»è·¯ç”±å™¨è®°ä¸ºä¸å¯è¾¾è·¯ç”±å™¨ï¼Œå³æŠŠè·ç¦»ç½®ä¸º 16ã€‚</p></li></ol><h3 id="rip-åè®®çš„æŠ¥æ–‡æ ¼å¼">RIP åè®®çš„æŠ¥æ–‡æ ¼å¼</h3><p>ä¸‹å›¾æ˜¯ RIP2ï¼ˆç‰ˆæœ¬ 2ï¼‰çš„æŠ¥æ–‡æ ¼å¼ã€‚</p><p><img src="/uploads/image/computer-networking/rip-header.jpeg"></p><p>RIP åè®®ä½¿ç”¨è¿è¾“å±‚çš„ UDP è¿›è¡Œä¼ é€ï¼Œä½¿ç”¨çš„ç«¯å£æ˜¯ 520ã€‚å‘½ä»¤å­—æ®µæŒ‡å‡ºæŠ¥æ–‡çš„æ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œ 1 è¡¨ç¤ºè¯·æ±‚è·¯ç”±ä¿¡æ¯ï¼Œ2 è¡¨ç¤ºå¯¹ 1 çš„å“åº”æˆ–ä¸»åŠ¨å‘å‡ºçš„è·¯ç”±æ›´æ–°æŠ¥æ–‡ã€‚é¦–éƒ¨çš„â€œå¿…ä¸º 0â€æ˜¯å¡«å……å­—æ®µï¼Œä¸ºäº† 4 å­—èŠ‚çš„å¯¹é½ã€‚</p><p>RIP2 å…·æœ‰ç®€å•çš„é‰´åˆ«åŠŸèƒ½ã€‚è‹¥ä½¿ç”¨é‰´åˆ«åŠŸèƒ½ï¼Œåˆ™å°†åŽŸæ¥å†™å…¥ç¬¬ä¸€ä¸ªè·¯ç”±ä¿¡æ¯çš„ä½ç½®ç”¨ä½œé‰´åˆ«ã€‚è¿™æ—¶åº”å°†åœ°å€æ—æ ‡è¯†ç¬¦ç½®ä¸ºå…¨ 1ï¼Œè€Œè·¯ç”±æ ‡è®°å†™å…¥é‰´åˆ«ç±»åž‹ï¼Œå‰©ä¸‹çš„ 16 å­—èŠ‚ä¸ºé‰´åˆ«æ•°æ®ã€‚åœ¨é‰´åˆ«æ•°æ®ä¹‹åŽæ‰å†™å…¥è·¯ç”±ä¿¡æ¯ï¼Œä½†è¿™æ—¶æœ€å¤šåªèƒ½å†æ”¾å…¥ 24 ä¸ªè·¯ç”±ä¿¡æ¯ã€‚</p><p>RIP å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯<strong>å½“ç½‘ç»œå‡ºçŽ°æ•…éšœæ—¶ï¼Œè¦ç»è¿‡æ¯”è¾ƒé•¿çš„æ—¶é—´æ‰èƒ½å°†æ­¤ä¿¡æ¯ä¼ é€åˆ°æ‰€æœ‰çš„è·¯ç”±å™¨</strong>ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">N1 ----- R1 ------------ R2 ----- N2</span><br><span class="line">    N1, 1, ç›´æŽ¥       N1, 2, R1</span><br><span class="line"></span><br><span class="line">N1 -xxx- R1 ------------ R2 ----- N2</span><br><span class="line">    N1, 16, ç›´æŽ¥      N1, 2, R1</span><br></pre></td></tr></table></figure><p>çŽ°åœ¨å‡å®š R1 åˆ° N1 çš„é“¾è·¯é™¤äº†æ•…éšœã€‚äºŽæ˜¯ R1 æ›´æ–°è‡ªå·±çš„è·¯ç”±è¡¨ä¸º N1, 16, ç›´æŽ¥ã€‚ä½†æ˜¯ï¼Œå¾ˆå¯èƒ½è¦ç»è¿‡ 30 ç§’åŽæ‰æŠŠæ›´æ–°åŽçš„ä¿¡æ¯å‘ç»™ R2ã€‚ï¼ˆè¿™ä¹ˆæ†¨çš„å—ï¼Ÿä¸èƒ½ç«‹å³å‘é€å—ï¼Ÿï¼‰ç„¶è€Œï¼ŒR1 åœ¨å‘é€ä¹‹å‰æ”¶åˆ°äº†æ¥è‡ª R2 çš„æ›´æ–°ä¿¡æ¯ã€‚æ ¹æ®ç®—æ³•ï¼ŒR1 éœ€è¦æ›´æ–°è‡ªå·±çš„è·¯ç”±ä¸º N1, 2, R2ã€‚å³ R1 è¯¯ä»¥ä¸ºå¯ä»¥é€šè¿‡ R2 å°†åˆ°è¾¾ N1ã€‚R1 ç»è¿‡ä¸€æ®µæ—¶é—´ï¼Œå°† N1, 2, R2 å‘é€ç»™ R2ï¼ŒR2 æ ¹æ®ç®—æ³•å°†è‡ªå·±çš„è·¯ç”±è¡¨æ›´æ–°ä¸º N1, 3, R1ã€‚ï¼ˆä½ ä¹Ÿè¿™ä¹ˆæ†¨çš„å—ï¼Ÿæ›´æ–°å‰ä¸çœ‹çœ‹å‘æ¥çš„è·¯ç”±çš„ä¸‹ä¸€è·³å°±æ˜¯è‡ªå·±ï¼‰â€¦â€¦è¿™æ ·çš„æ›´æ–°ä¸€ç›´æŒç»­ä¸‹åŽ»ï¼Œç›´åˆ°è·ç¦»å¢žå¤§åˆ° 16 ä¸ºæ­¢ï¼ŒR1 å’Œ R2 æ‰çŸ¥é“ N1 æ˜¯ä¸å¯è¾¾çš„ã€‚RIP åè®®çš„è¿™ä¸€ç‰¹ç‚¹å«åšï¼š<strong>å¥½æ¶ˆæ¯ä¼ æ’­å¾—å¿«ï¼Œè€Œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢ã€‚</strong>ä½†å¦‚æžœä¸€ä¸ªè·¯ç”±å™¨å‘çŽ°äº†æ›´çŸ­çš„è·¯ç”±ï¼Œé‚£ä¹ˆè¿™ç§æ›´æ–°ä¿¡æ¯å°±ä¼ æ’­å¾—å¾ˆå¿«ã€‚</p><p>æ€»ä¹‹ï¼ŒRIP åè®®æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯<strong>å®žçŽ°ç®€å•ï¼Œå¼€é”€è¾ƒå°</strong>ã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆå¤šã€‚</p><ul><li>é¦–å…ˆï¼ŒRIP é™åˆ¶äº†ç½‘ç»œçš„è§„æ¨¡ï¼Œå®ƒèƒ½ä½¿ç”¨çš„æœ€å¤§è·ç¦»ä¸º 15ã€‚</li><li>å…¶æ¬¡ï¼Œè·¯ç”±å™¨ä¹‹é—´äº¤æ¢çš„è·¯ç”±ä¿¡æ¯æ˜¯è·¯ç”±å™¨ä¸­çš„å®Œæ•´è·¯ç”±è¡¨ï¼Œå› è€Œéšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§ï¼Œå¼€é”€ä¹Ÿå°±å¢žåŠ ã€‚</li><li>æœ€åŽï¼Œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢ï¼Œä½¿æ›´æ–°è¿‡ç¨‹çš„æ”¶æ•›æ—¶é—´è¿‡é•¿ã€‚</li></ul><p>å› æ­¤ï¼Œå¯¹äºŽè§„æ¨¡è¾ƒå¤§çš„ç½‘ç»œå°±åº”å½“ä½¿ç”¨ OSPF åè®®ã€‚ç„¶è€Œç›®å‰åœ¨è§„æ¨¡è¾ƒå°çš„ç½‘ç»œä¸­ï¼Œä½¿ç”¨ RIP åè®®çš„ä»å å¤šæ•°ã€‚</p><h2 id="å†…éƒ¨ç½‘å…³åè®®-ospf">å†…éƒ¨ç½‘å…³åè®® OSPF</h2><p>è¿™ä¸ªåè®®çš„åå­—æ˜¯<strong>å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ</strong> OSPFï¼ˆOpen Shortest Path Firstï¼‰ï¼Œæ˜¯ä¸ºäº†å…‹æœ RIP çš„ç¼ºç‚¹è¢«å¼€å‘å‡ºæ¥çš„ã€‚â€å¼€æ”¾â€œæŒ‡çš„æ˜¯ OSPF åè®®ä¸æ˜¯å—æŸä¸€å®¶åŽ‚å•†æŽ§åˆ¶ï¼Œè€Œæ˜¯å…¬å¼€å‘è¡¨çš„ã€‚â€æœ€çŸ­è·¯å¾„ä¼˜å…ˆâ€œæ˜¯å› ä¸ºä½¿ç”¨äº† Dijkstra æå‡ºçš„<strong>æœ€çŸ­è·¯å¾„ç®—æ³•</strong>ã€‚è¯·æ³¨æ„ï¼šOSPF åªæ˜¯ä¸€ä¸ªåè®®çš„åå­—ï¼Œå¹¶ä¸è¡¨ç¤ºå…¶ä»–çš„è·¯ç”±é€‰æ‹©åè®®ä¸æ˜¯â€æœ€çŸ­è·¯å¾„ä¼˜å…ˆâ€œã€‚å®žé™…ä¸Šï¼Œæ‰€æœ‰çš„åœ¨è‡ªæ²»ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„è·¯ç”±é€‰æ‹©åè®®éƒ½æ˜¯è¦å¯»æ‰¾ä¸€æ¡æœ€çŸ­çš„è·¯å¾„ã€‚</p><p>OSPF æœ€ä¸»è¦çš„ç‰¹å¾å°±æ˜¯ä½¿ç”¨åˆ†å¸ƒå¼çš„<strong>é“¾è·¯çŠ¶æ€åè®®</strong>ï¼ˆlink state protocolï¼‰ï¼Œè€Œä¸æ˜¯åƒ RIP é‚£æ ·çš„è·ç¦»å‘é‡åè®®ã€‚OSPF åè®®çš„ä¸‰ä¸ªè¦ç‚¹å’Œ RIP çš„éƒ½ä¸ä¸€æ ·ï¼š</p><ol type="1"><li>å‘æœ¬è‡ªæ²»ç³»ç»Ÿä¸­<strong>æ‰€æœ‰è·¯ç”±å™¨</strong>å‘é€ä¿¡æ¯ã€‚ä½¿ç”¨çš„æ˜¯<strong>æ´ªæ³›æ³•</strong>ï¼ˆfloodingï¼‰ï¼šè·¯ç”±å™¨é€šè¿‡æ‰€æœ‰è¾“å‡ºç«¯å£å‘æ‰€æœ‰ç›¸é‚»çš„è·¯ç”±å™¨å‘é€ä¿¡æ¯ã€‚è€Œæ¯ä¸€ä¸ªç›¸é‚»çš„è·¯ç”±å™¨åˆå†å°†æ­¤ä¿¡æ¯å‘å¾€å…¶æ‰€æœ‰çš„ç›¸é‚»è·¯ç”±å™¨ï¼ˆä½†ä¸å‘ç»™å‘æ¥ä¿¡æ¯çš„é‚£ä¸ªè·¯ç”±å™¨ï¼‰ã€‚è¿™æ ·ï¼Œæœ€ç»ˆæ•´ä¸ªåŒºåŸŸä¸­æ‰€æœ‰çš„è·¯ç”±å™¨éƒ½å¾—åˆ°äº†è¿™ä¸ªä¿¡æ¯çš„ä¸€ä¸ªå‰¯æœ¬ã€‚</li><li>å‘é€çš„ä¿¡æ¯æ˜¯<strong>ä¸Žæœ¬è·¯ç”±å™¨ç›¸é‚»çš„æ‰€æœ‰è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€</strong>ï¼Œä½†è¿™åªæ˜¯è·¯ç”±å™¨æ‰€çŸ¥é“çš„<strong>éƒ¨åˆ†ä¿¡æ¯</strong>ã€‚æ‰€è°“é“¾è·¯çŠ¶æ€å°±æ˜¯è¯´æ˜Žæœ¬è·¯ç”±å™¨å’Œå“ªäº›è·¯ç”±å™¨ç›¸é‚»ï¼Œä»¥åŠè¯¥é“¾è·¯çš„<strong>åº¦é‡</strong>ï¼ˆmetricï¼‰ã€‚åº¦é‡ï¼ˆè´¹ç”¨ã€è·ç¦»ã€æ—¶å»¶ã€å¸¦å®½ç­‰ç­‰ï¼‰ç”±ç½‘ç»œç®¡ç†äººå‘˜æ¥å†³å®šï¼Œå› æ­¤è¾ƒä¸ºçµæ´»ã€‚</li><li>åªæœ‰å½“é“¾è·¯çŠ¶æ€<strong>å‘ç”Ÿå˜åŒ–</strong>æ—¶ï¼Œè·¯ç”±å™¨æ‰å‘æ‰€æœ‰è·¯ç”±å™¨ç”¨æ´ªæ³›æ³•å‘é€æ­¤ä¿¡æ¯ã€‚</li></ol><h3 id="å…³äºŽ-rip-å’Œ-ospf-ä¸‰ä¸ªè¦ç‚¹çš„æ€»ç»“">å…³äºŽ RIP å’Œ OSPF ä¸‰ä¸ªè¦ç‚¹çš„æ€»ç»“</h3><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th></th><th>RIP</th><th>OSPF</th></tr></thead><tbody><tr class="odd"><td>å‘è°å‘é€ï¼Ÿ</td><td>ç›¸é‚»è·¯ç”±å™¨</td><td>å…¨éƒ¨è·¯ç”±å™¨ï¼ˆæ´ªæ³›æ³•ï¼Œå¯ä»¥çœ‹åšé€’å½’å¼åœ°å‘ç›¸é‚»è·¯ç”±å™¨å‘é€ï¼‰</td></tr><tr class="even"><td>å‘é€ä»€ä¹ˆï¼Ÿ</td><td>æœ¬è·¯ç”±å™¨çš„è·¯ç”±è¡¨ï¼ˆæœ¬è·¯ç”±å™¨çŸ¥é“çš„å…¨éƒ¨ä¿¡æ¯ï¼‰</td><td>ä¸Žæœ¬è·¯ç”±å™¨ç›¸é‚»çš„è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ï¼ˆæœ¬è·¯ç”±å™¨çŸ¥é“çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰ï¼Œé“¾è·¯çŠ¶æ€å¯ä»¥ç­‰æ•ˆçœ‹ä½œæ˜¯è‡ªå®šä¹‰çš„è·¯ç”±è¡¨çš„è¡¨é¡¹</td></tr><tr class="odd"><td>ä½•æ—¶å‘é€ï¼Ÿ</td><td>å®šæœŸå‘é€ï¼ˆå¦‚ 30 ç§’ï¼‰</td><td>é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å‘é€</td></tr></tbody></table><p>æ‰€æœ‰çš„è·¯ç”±å™¨æœ€ç»ˆéƒ½èƒ½å»ºç«‹ä¸€ä¸ª<strong>é“¾è·¯çŠ¶æ€æ•°æ®åº“</strong>ï¼ˆlink-state databaseï¼‰ï¼Œè¿™ä¸ªæ•°æ®åº“å®žé™…ä¸Šå°±æ˜¯<strong>å…¨ç½‘çš„æ‹“æ‰‘ç»“æž„å›¾</strong>ã€‚è¿™ä¸ªæ‹“æ‰‘ç»“æž„å›¾åœ¨å…¨ç½‘èŒƒå›´å†…æ˜¯ä¸€è‡´çš„ï¼ˆè¿™ç§°ä¸ºé“¾è·¯çŠ¶æ€æ•°æ®åº“çš„åŒæ­¥ï¼‰ã€‚æ¯ä¸€ä¸ªè·¯ç”±å™¨ä½¿ç”¨é“¾è·¯çŠ¶æ€æ•°æ®åº“ï¼Œæž„é€ å‡ºè‡ªå·±çš„è·¯ç”±è¡¨ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ Dijkstra çš„æœ€çŸ­è·¯å¾„è·¯ç”±ç®—æ³•ï¼‰ã€‚</p><p>OSPF çš„é“¾è·¯çŠ¶æ€æ•°æ®åº“èƒ½è¾ƒå¿«åœ°è¿›è¡Œæ›´æ–°ï¼Œ<strong>æ›´æ–°è¿‡ç¨‹æ”¶æ•›å¾—å¿«</strong>æ˜¯å…¶é‡è¦ä¼˜ç‚¹ã€‚</p><h3 id="ospf-çš„åŒºåŸŸåˆ’åˆ†">OSPF çš„åŒºåŸŸåˆ’åˆ†</h3><p>ä¸ºäº†ä½¿ OSPF èƒ½å¤Ÿç”¨äºŽè§„æ¨¡å¾ˆå¤§çš„ç½‘ç»œï¼ŒOSPF å°†ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿå†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ›´å°çš„èŒƒå›´ï¼Œå«åš<strong>åŒºåŸŸ</strong>ï¼ˆareaï¼‰ï¼Œæ¯ä¸€ä¸ªåŒºåŸŸéƒ½ç”±ä¸€ä¸ª 32 ä½çš„åŒºåŸŸæ ‡è¯†ç¬¦ï¼ˆç”¨ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºï¼Œå’Œ IPv4 ç±»ä¼¼ï¼Œä½†ä¸æ˜¯ IPv4ï¼‰ã€‚ä¸€ä¸ªåŒºåŸŸä¸èƒ½å¤ªå¤§ï¼Œåœ¨ä¸€ä¸ªåŒºåŸŸå†…çš„è·¯ç”±å™¨æœ€å¥½ä¸è¶…è¿‡ 200 ä¸ªã€‚åˆ’åˆ†åŒºåŸŸçš„å¥½å¤„æ˜¯<strong>æŠŠåˆ©ç”¨æ´ªæ³›æ³•äº¤æ¢é“¾è·¯çŠ¶æ€ä¿¡æ¯çš„èŒƒå›´å±€é™äºŽæ¯ä¸€ä¸ªåŒºåŸŸè€Œä¸æ˜¯æ•´ä¸ªçš„è‡ªæ²»ç³»ç»Ÿ</strong>ï¼Œè¿™å°±å‡å°‘äº†æ•´ä¸ªç½‘ç»œä¸Šçš„é€šä¿¡é‡ã€‚åœ¨ä¸€ä¸ªåŒºåŸŸå†…éƒ¨çš„è·¯ç”±å™¨åªçŸ¥é“æœ¬åŒºåŸŸçš„å®Œæ•´ç½‘ç»œæ‹“æ‰‘ï¼Œè€Œä¸çŸ¥é“å…¶ä»–åŒºåŸŸçš„ç½‘ç»œæ‹“æ‰‘çš„æƒ…å†µã€‚</p><p>ä¸ºäº†ä½¿æ¯ä¸€ä¸ªåŒºåŸŸèƒ½å¤Ÿå’Œæœ¬åŒºåŸŸä»¥å¤–çš„åŒºåŸŸè¿›è¡Œé€šä¿¡ï¼ŒOSPF ä½¿ç”¨<strong>å±‚æ¬¡ç»“æž„çš„åŒºåŸŸåˆ’åˆ†</strong>ã€‚åœ¨ä¸Šå±‚çš„åŒºåŸŸå«åš<strong>ä¸»å¹²åŒºåŸŸ</strong>ï¼ˆbackbone areaï¼‰ï¼Œæ ‡è¯†ç¬¦è§„å®šä¸º 0.0.0.0ã€‚ä¸»å¹²åŒºåŸŸçš„ä½œç”¨æ˜¯è¿žé€šå…¶ä»–åœ¨ä¸‹å±‚çš„åŒºåŸŸã€‚åœ¨ä¸»å¹²åŒºåŸŸå†…çš„è·¯ç”±å™¨å«åš<strong>ä¸»å¹²è·¯ç”±å™¨</strong>ï¼ˆbackbone routerï¼‰ã€‚åŒæ—¶è¿žæŽ¥ä¸»å¹²åŒºåŸŸå’Œå…¶ä»–åŒºåŸŸçš„è·¯ç”±å™¨å«åš<strong>åŒºåŸŸè¾¹ç•Œè·¯ç”±å™¨</strong>ï¼ˆarea border routerï¼‰ã€‚ä¸»å¹²åŒºåŸŸå†…è¿˜è¦æœ‰ä¸€ä¸ªè·¯ç”±å™¨ä¸“é—¨å’Œæœ¬è‡ªæ²»ç³»ç»Ÿä»¥å¤–çš„çš„å…¶ä»–è‡ªæ²»ç³»ç»Ÿäº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚è¿™æ ·çš„è·¯ç”±å™¨å«åš<strong>è‡ªæ²»ç³»ç»Ÿè¾¹ç•Œè·¯ç”±å™¨</strong>ã€‚</p><p>é‡‡ç”¨åˆ†å±‚æ¬¡åˆ’åˆ†åŒºåŸŸçš„æ–¹æ³•ï¼Œ</p><ul><li>ç¼ºç‚¹æ˜¯ï¼Œä½¿äº¤æ¢ä¿¡æ¯çš„ç§ç±»å¢žå¤šäº†ï¼ŒåŒæ—¶ä¹Ÿä½¿ OSPF åè®®æ›´åŠ å¤æ‚äº†ã€‚</li><li>ä¼˜ç‚¹æ˜¯ï¼Œä½¿æ¯ä¸€ä¸ªåŒºåŸŸå†…éƒ¨äº¤æ¢è·¯ç”±ä¿¡æ¯çš„é€šä¿¡é‡å¤§å¤§å‡å°ï¼Œå› è€Œèƒ½ç”¨äºŽè§„æ¨¡å¾ˆå¤§çš„è‡ªæ²»ç³»ç»Ÿä¸­ã€‚</li></ul><h3 id="ospf-åè®®çš„æŠ¥æ–‡æ ¼å¼">OSPF åè®®çš„æŠ¥æ–‡æ ¼å¼</h3><p>OSPF ä¸ç”¨ UDP è€Œæ˜¯<strong>ç›´æŽ¥ç”¨ IP æ•°æ®æŠ¥ä¼ é€</strong>ï¼Œè¿™æ ·åšå¯å‡å°‘è·¯ç”±ä¿¡æ¯çš„é€šä¿¡é‡ã€‚æ•°æ®æŠ¥çŸ­çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯ä»¥ä¸å¿…å°†é•¿çš„æ•°æ®æŠ¥åˆ†ç‰‡ä¼ é€ã€‚åˆ†ç‰‡ä¼ é€çš„æ•°æ®æŠ¥åªè¦ä¸¢å¤±ä¸€ä¸ªï¼Œå°±æ— æ³•ç»„è£…æˆåŽŸæ¥çš„æ•°æ®æŠ¥ï¼Œè€Œæ•´ä¸ªæ•°æ®æŠ¥å°±å¿…é¡»é‡ä¼ ã€‚</p><p><img src="/uploads/image/computer-networking/ospf-header.jpeg"></p><p>OSPF ä½¿ç”¨ 24 å­—èŠ‚çš„å›ºå®šé•¿åº¦é¦–éƒ¨ï¼š</p><ul><li>ç‰ˆæœ¬ï¼šå½“å‰çš„ç‰ˆæœ¬å·æ˜¯ 2ã€‚</li><li>ç±»åž‹ï¼šå¯ä»¥æ˜¯ 5 ç§ç±»åž‹åˆ†ç»„ä¸­çš„ä¸€ç§ã€‚<ul><li>é—®å€™ï¼ˆHelloï¼‰åˆ†ç»„ï¼Œç”¨æ¥å‘çŽ°å’Œç»´æŒé‚»ç«™çš„å¯è¾¾æ€§ã€‚</li><li>æ•°æ®åº“æè¿°ï¼ˆDatabase Descriptionï¼‰åˆ†ç»„ï¼Œå‘é‚»ç«™ç»™å‡ºè‡ªå·±çš„é“¾è·¯çŠ¶æ€æ•°æ®åº“çš„æ‘˜è¦ä¿¡æ¯ã€‚</li><li>é“¾è·¯çŠ¶æ€è¯·æ±‚ï¼ˆLink State Requestï¼‰åˆ†ç»„ï¼Œå‘å¯¹æ–¹è¯·æ±‚å‘é€æŸäº›é“¾è·¯çŠ¶æ€é¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li>é“¾è·¯çŠ¶æ€æ›´æ–°ï¼ˆLink State Updateï¼‰åˆ†ç»„ï¼Œç”¨æ´ªæ³›æ³•å¯¹å…¨ç½‘æ›´æ–°é“¾è·¯çŠ¶æ€ã€‚è¿™ç§åˆ†ç»„æ˜¯æœ€å¤æ‚çš„ï¼Œä¹Ÿæ˜¯ OSPF åè®®æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚</li><li>é“¾è·¯çŠ¶æ€ç¡®è®¤ï¼ˆLink State Acknowledgementï¼‰åˆ†ç»„ï¼Œå¯¹é“¾è·¯æ›´æ–°åˆ†ç»„çš„ç¡®è®¤ã€‚</li></ul></li><li>åˆ†ç»„é•¿åº¦ï¼šåŒ…æ‹¬é¦–éƒ¨åœ¨å†…çš„åˆ†ç»„é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</li><li>è·¯ç”±å™¨æ ‡è¯†ç¬¦ï¼šå‘é€è¯¥åˆ†ç»„çš„è·¯ç”±å™¨çš„æŽ¥å£çš„ IP åœ°å€ã€‚</li><li>é‰´åˆ«ç±»åž‹ï¼š0ï¼ˆä¸ç”¨ï¼‰å’Œ 1ï¼ˆå£ä»¤ï¼‰</li><li>é‰´åˆ«ï¼šé‰´åˆ«ç±»åž‹ä¸º 0 æ—¶å°±å¡«å…¥ 0ï¼Œé‰´åˆ«ç±»åž‹ä¸º 1 æ—¶åˆ™å¡«å…¥ 8 ä¸ªå­—ç¬¦çš„å£ä»¤ã€‚</li></ul><p>OSPF çš„ç‰¹ç‚¹ï¼š</p><ul><li>å…è®¸ç®¡ç†å‘˜ç»™æ¯æ¡è·¯ç”±æŒ‡æ´¾ä¸åŒçš„ä»£ä»·ï¼ˆ1 è‡³ 65535ï¼‰ã€‚å•†ç”¨çš„ç½‘ç»œåœ¨ä½¿ç”¨ OSPF æ—¶ï¼Œé€šå¸¸æ ¹æ®é“¾è·¯å¸¦å®½æ¥è®¡ç®—é“¾è·¯çš„ä»£ä»·ã€‚è¿™ç§çµæ´»æ€§æ˜¯ RIP æ‰€æ²¡æœ‰çš„ã€‚</li><li>å¦‚æžœåˆ°åŒä¸€ä¸ªç›®çš„ç½‘ç»œæœ‰å¤šæ¡ç›¸åŒä»£ä»·çš„è·¯å¾„ï¼Œé‚£ä¹ˆå¯ä»¥å°†é€šä¿¡é‡åˆ†é…ç»™è¿™å‡ æ¡è·¯å¾„ã€‚è¿™å«åšå¤šè·¯å¾„é—´çš„<strong>è´Ÿè½½å¹³è¡¡</strong>ï¼ˆload balancingï¼‰ã€‚åœ¨ä»£ä»·ç›¸åŒçš„å¤šæ¡è·¯å¾„ä¸Šåˆ†é…é€šä¿¡é‡æ˜¯é€šä¿¡é‡å·¥ç¨‹ä¸­çš„ç®€å•å½¢å¼ã€‚RIP åªèƒ½æ‰¾å‡ºåˆ°æŸä¸ªç½‘ç»œçš„ä¸€æ¡è·¯å¾„ã€‚</li><li>åœ¨ OSPF è·¯ç”±å™¨ä¹‹é—´äº¤æ¢çš„åˆ†ç»„éƒ½å…·æœ‰é‰´åˆ«çš„åŠŸèƒ½ï¼Œä¿è¯äº†ä»…åœ¨å¯ä¿¡èµ–çš„è·¯ç”±å™¨ä¹‹é—´äº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚ï¼ˆRIP ä¹Ÿå…·æœ‰ç®€å•çš„é‰´åˆ«åŠŸèƒ½ï¼‰</li><li>OSPF æ”¯æŒå¯å˜é•¿åº¦çš„å­ç½‘åˆ’åˆ†å’Œæ— åˆ†ç±»çš„ç¼–å€ CIDRã€‚ï¼ˆRIP2 ä¹Ÿæ”¯æŒï¼‰</li><li>ç”±äºŽç½‘ç»œä¸­çš„é“¾è·¯çŠ¶æ€å¯èƒ½ç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ OSPF è®©æ¯ä¸€ä¸ªé“¾è·¯çŠ¶æ€éƒ½å¸¦ä¸Šä¸€ä¸ª 32 ä½çš„åºå·ï¼Œåºå·è¶Šå¤§çŠ¶æ€å°±è¶Šæ–°ã€‚OSPF è§„å®šï¼Œé“¾è·¯çŠ¶æ€åºå·å¢žé•¿çš„é€ŸçŽ‡ä¸å¾—è¶…è¿‡ 5 ç§’é’Ÿ 1 æ¬¡ã€‚è¿™æ ·ï¼Œå…¨éƒ¨åºå·ç©ºé—´åœ¨ 600 å¹´å†…ä¸ä¼šäº§ç”Ÿé‡å¤åºå·ã€‚</li></ul><h3 id="ospf-çš„å·¥ä½œè¿‡ç¨‹">OSPF çš„å·¥ä½œè¿‡ç¨‹</h3><p>OSPF è§„å®šï¼Œæ¯ä¸¤ä¸ªç›¸é‚»çš„è·¯ç”±å™¨æ¯éš” 10 ç§’é’Ÿè¦äº¤æ¢ä¸€æ¬¡ã€Œé—®å€™åˆ†ç»„ã€ï¼Œè¿™æ ·å°±èƒ½ç¡®çŸ¥å“ªäº›é‚»ç«™æ˜¯å¯è¾¾çš„ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œç½‘ç»œä¸­ä¼ é€çš„ç»å¤§å¤šæ•° OSPF åˆ†ç»„éƒ½æ˜¯é—®å€™åˆ†ç»„ã€‚è‹¥æœ‰ 40 ç§’é’Ÿæ²¡æœ‰æ”¶åˆ°æŸä¸ªç›¸é‚»è·¯ç”±å™¨å‘æ¥çš„é—®å€™åˆ†ç»„ï¼Œåˆ™å¯è®¤ä¸ºè¯¥ç›¸é‚»è·¯ç”±å™¨æ˜¯ä¸å¯è¾¾çš„ï¼Œåº”ç«‹å³ä¿®æ”¹é“¾è·¯çŠ¶æ€æ•°æ®åº“ï¼Œå¹¶é‡æ–°è®¡ç®—è·¯ç”±è¡¨ã€‚</p><p>å…¶ä»–çš„å››ç§åˆ†ç»„éƒ½æ˜¯ç”¨æ¥è¿›è¡Œé“¾è·¯çŠ¶æ€æ•°æ®åº“çš„åŒæ­¥ã€‚æ‰€è°“<strong>åŒæ­¥</strong>å°±æ˜¯æŒ‡ä¸åŒè·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€æ•°æ®åº“çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚</p><p>å½“ä¸€ä¸ªè·¯ç”±å™¨å¼€å§‹å·¥ä½œæ—¶ï¼Œå®ƒåªèƒ½é€šè¿‡é—®å€™åˆ†ç»„å¾—çŸ¥å®ƒæœ‰å“ªäº›ç›¸é‚»çš„è·¯ç”±å™¨åœ¨å·¥ä½œï¼Œä»¥åŠå°†æ•°æ®å‘å¾€ç›¸é‚»è·¯ç”±å™¨æ‰€éœ€çš„â€ä»£ä»·â€œã€‚å¦‚æžœæ‰€æœ‰çš„è·¯ç”±å™¨éƒ½æŠŠè‡ªå·±çš„æœ¬åœ°é“¾è·¯çŠ¶æ€ä¿¡æ¯å¯¹å…¨ç½‘è¿›è¡Œå¹¿æ’­ï¼Œé‚£ä¹ˆå„è·¯ç”±å™¨åªè¦å°†è¿™äº›ä¿¡æ¯ç»¼åˆèµ·æ¥å°±å¯å¾—å‡ºé“¾è·¯çŠ¶æ€æ•°æ®åº“ã€‚ä½†è¿™æ ·åšå¼€é”€å¤ªå¤§ï¼Œå› æ­¤ OSPF é‡‡ç”¨ä¸‹é¢çš„åŠžæ³•ã€‚</p><p>OSPF è®©æ¯ä¸€ä¸ªè·¯ç”±å™¨ç”¨ã€Œæ•°æ®åº“æè¿°åˆ†ç»„ã€å’Œç›¸é‚»è·¯ç”±å™¨äº¤æ¢æœ¬æ•°æ®åº“ä¸­å·²æœ‰çš„é“¾è·¯çŠ¶æ€æ‘˜è¦ä¿¡æ¯ã€‚æ‘˜è¦ä¿¡æ¯ä¸»è¦å°±æ˜¯æŒ‡å‡ºæœ‰å“ªäº›è·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€ä¿¡æ¯ï¼ˆä»¥åŠå…¶åºå·ï¼‰å·²ç»å†™å…¥äº†æ•°æ®åº“ã€‚ä¹‹åŽï¼Œè·¯ç”±å°±ä½¿ç”¨ã€Œé“¾è·¯çŠ¶æ€è¯·æ±‚åˆ†ç»„ã€å‘å¯¹æ–¹è¯·æ±‚è‡ªå·±æ‰€ç¼ºå°‘çš„æŸäº›é“¾è·¯çŠ¶æ€é¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡ä¸€ç³»åˆ—çš„è¿™ç§åˆ†ç»„äº¤æ¢ï¼Œå…¨ç½‘åŒæ­¥çš„é“¾è·¯æ•°æ®åº“å°±å»ºç«‹äº†ã€‚</p><p>åœ¨ç½‘ç»œè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œåªè¦ä¸€ä¸ªè·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œè¯¥è·¯ç”±å™¨å°±è¦ä½¿ç”¨ã€Œé“¾è·¯çŠ¶æ€æ›´æ–°åˆ†ç»„ã€ï¼Œç”¨æ´ªæ³›æ³•å‘å…¨ç½‘æ›´æ–°é“¾è·¯çŠ¶æ€ã€‚OSPF ä½¿ç”¨çš„æ˜¯<strong>å¯é çš„æ´ªæ³›æ³•</strong>ï¼Œå¯é çš„æ´ªæ³›æ³•æ˜¯åœ¨æ”¶åˆ°æ›´æ–°åˆ†ç»„åŽè¦å‘é€ç¡®è®¤ï¼ˆæ”¶åˆ°é‡å¤çš„æ›´æ–°åˆ†ç»„åªéœ€è¦å‘é€ä¸€æ¬¡ç¡®è®¤ï¼‰ã€‚</p><p><img src="/uploads/image/computer-networking/ospf-reliable-flooding.jpeg"></p><p>ä¸ºäº†ç¡®ä¿é“¾è·¯çŠ¶æ€æ•°æ®åº“ä¸Žå…¨ç½‘çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼ŒOSPF è¿˜è§„å®šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå¦‚ 30 åˆ†é’Ÿï¼Œè¦åˆ·æ–°ä¸€æ¬¡æ•°æ®åº“ä¸­çš„é“¾è·¯çŠ¶æ€ã€‚</p><p>ç”±äºŽä¸€ä¸ªè·¯ç”±å™¨çš„é“¾è·¯çŠ¶æ€åªæ¶‰åŠåˆ°ä¸Žç›¸é‚»è·¯ç”±å™¨çš„è¿žé€šçŠ¶æ€ï¼Œå› è€Œä¸Žæ•´ä¸ªäº’è”ç½‘çš„è§„æ¨¡å¹¶æ— ç›´æŽ¥å…³ç³»ã€‚å› æ­¤ï¼Œå½“äº’è”ç½‘è§„æ¨¡å¾ˆå¤§æ—¶ï¼ŒOSPF åè®®è¦æ¯”è·ç¦»å‘é‡åè®® RIP å¥½å¾—å¤šã€‚</p><p>è‹¥ N ä¸ªè·¯ç”±å™¨è¿žæŽ¥åœ¨ä¸€ä¸ªä»¥å¤ªç½‘ä¸Šï¼Œåˆ™æ¯ä¸ªè·¯ç”±å™¨è¦å‘å…¶ä»– N-1 ä¸ªè·¯ç”±å™¨å‘é€é“¾è·¯çŠ¶æ€ä¿¡æ¯ï¼Œå› è€Œå…±æœ‰ N(N-1) ä¸ªé“¾è·¯çŠ¶æ€è¦åœ¨è¿™ä¸ªä»¥å¤ªç½‘ä¸Šä¼ é€ã€‚OSPF åè®®å¯¹è¿™ç§å¤šç‚¹æŽ¥å…¥çš„å±€åŸŸç½‘é‡‡ç”¨äº†<strong>æŒ‡å®šçš„è·¯ç”±å™¨</strong>ï¼ˆdesignated routerï¼‰çš„æ–¹æ³•ï¼Œä½¿å¹¿æ’­çš„ä¿¡æ¯é‡å¤§å¤§å‡å°‘ã€‚æŒ‡å®šçš„è·¯ç”±å™¨ä»£è¡¨è¯¥å±€åŸŸç½‘ä¸Šæ‰€æœ‰çš„é“¾è·¯ï¼Œå‘è¿žæŽ¥åˆ°è¯¥ç½‘ç»œä¸Šçš„å„è·¯ç”±å™¨å‘é€çŠ¶æ€ä¿¡æ¯ï¼ˆ?ï¼‰ã€‚</p><h2 id="å¤–éƒ¨ç½‘å…³åè®®-bgp">å¤–éƒ¨ç½‘å…³åè®® BGP</h2><p>åœ¨ä¸åŒçš„ AS ä¹‹é—´ä¸èƒ½ä½¿ç”¨å†…éƒ¨ç½‘å…³åè®®ï¼ˆRIP æˆ– OSPFï¼‰ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŽŸå› ï¼š</p><ol type="1"><li><strong>äº’è”ç½‘çš„è§„æ¨¡å¤ªå¤§</strong>ï¼Œä½¿å¾— AS ä¹‹é—´çš„è·¯ç”±é€‰æ‹©éžå¸¸å›°éš¾ã€‚è¿žæŽ¥åœ¨äº’è”ç½‘ä¸»å¹²ç½‘ä¸Šçš„è·¯ç”±å™¨ï¼Œå¿…é¡»å¯¹ä»»ä½•æœ‰æ•ˆçš„ IP åœ°å€éƒ½èƒ½åœ¨è·¯ç”±è¡¨ä¸­æ‰¾åˆ°åŒ¹é…çš„ç›®çš„ç½‘ç»œã€‚å¦‚æžœä½¿ç”¨é“¾è·¯çŠ¶æ€åè®®ï¼ˆå¦‚ OSPFï¼‰ï¼Œåˆ™æ¯ä¸€ä¸ªè·¯ç”±å™¨å¿…é¡»ç»´æŒä¸€ä¸ªå¾ˆå¤§çš„é“¾è·¯çŠ¶æ€æ•°æ®åº“ã€‚å¯¹äºŽè¿™æ ·å¤§çš„ä¸»å¹²ç½‘ç”¨ Dijkstra ç®—æ³•è®¡ç®—æœ€çŸ­è·¯å¾„æ—¶èŠ±è´¹çš„æ—¶é—´ä¹Ÿå¤ªé•¿ã€‚å¦å¤–ï¼Œç”±äºŽ AS ä½¿ç”¨çš„è·¯å¾„åº¦é‡ï¼ˆä»£ä»·ï¼‰å¯èƒ½ä¸åŒï¼Œå› æ­¤ï¼Œå½“ä¸€æ¡è·¯å¾„é€šè¿‡å‡ ä¸ªä¸åŒçš„ AS æ—¶ï¼Œè¦è®¡ç®—å‡ºæœ‰æ„ä¹‰çš„ä»£ä»·æ˜¯ä¸å¤ªå¯èƒ½çš„ã€‚æ¯”è¾ƒåˆç†çš„åšæ³•æ˜¯åœ¨ AS ä¹‹é—´äº¤æ¢â€œå¯è¾¾æ€§â€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œâ€œåˆ°è¾¾ç›®çš„ç½‘ç»œ N å¯ç»è¿‡è‡ªæ²»ç³»ç»Ÿ ASxâ€ã€‚</li><li><strong>AS ä¹‹é—´çš„è·¯ç”±é€‰æ‹©å¿…é¡»è€ƒè™‘æœ‰å…³ç­–ç•¥</strong>ã€‚è¿™äº›ç­–ç•¥åŒ…æ‹¬æ”¿æ²»ã€å®‰å…¨æˆ–ç»æµŽæ–¹é¢çš„è€ƒè™‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘å›½å›½å†…ç«™ç‚¹åœ¨äº’ç›¸ä¼ é€æ•°æ®æŠ¥æ—¶ä¸åº”ç»è¿‡å›½å¤–å…œåœˆå­ï¼Œç‰¹åˆ«æ˜¯ï¼Œä¸è¦ç»è¿‡æŸäº›å¯¹æˆ‘å›½çš„å®‰å…¨æœ‰å¨èƒçš„å›½å®¶ã€‚è¿™äº›ç­–ç•¥éƒ½æ˜¯ç”±ç½‘ç»œç®¡ç†äººå‘˜å¯¹æ¯ä¸€ä¸ªè·¯ç”±å™¨è¿›è¡Œè®¾ç½®çš„ã€‚</li></ol><p>ç”±äºŽä¸Šè¿°æƒ…å†µï¼Œè¾¹ç•Œç½‘å…³åè®® BGP åªèƒ½æ˜¯åŠ›æ±‚å¯»æ‰¾ä¸€æ¡èƒ½å¤Ÿåˆ°è¾¾ç›®çš„ç½‘ç»œä¸”æ¯”è¾ƒå¥½çš„è·¯ç”±ï¼Œè€Œå¹¶éžè¦å¯»æ‰¾ä¸€æ¡æœ€ä½³è·¯ç”±ã€‚</p><h3 id="bgp-åè®®çš„ä¸‰è¦ç‚¹">BGP åè®®çš„ä¸‰è¦ç‚¹</h3><p>åœ¨é…ç½® BGP æ—¶ï¼Œæ¯ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿçš„ç®¡ç†å‘˜è¦é€‰æ‹©è‡³å°‘ä¸€ä¸ªè·¯ç”±å™¨ä½œä¸ºè¯¥è‡ªæ²»ç³»ç»Ÿçš„â€œBGP å‘è¨€äººâ€ã€‚BGP å‘è¨€äººå¾€å¾€å°±æ˜¯ BGP è¾¹ç•Œè·¯ç”±å™¨ï¼ˆä½†ä¹Ÿå¯ä»¥ä¸æ˜¯ï¼‰ï¼Œæ¯ä¸€ä¸ª BGP å‘è¨€äººé™¤äº†å¿…é¡»è¿è¡Œ BGP åè®®å¤–ï¼Œè¿˜å¿…é¡»è¿è¡Œè¯¥è‡ªæ²»ç³»ç»Ÿæ‰€ä½¿ç”¨çš„å†…éƒ¨ç½‘å…³åè®®ï¼ˆå¦‚ RIP æˆ– OSPFï¼‰ã€‚</p><p>ä¸€ä¸ª BGP å‘è¨€äººä¸Žå…¶ä»– AS çš„ BGP å‘è¨€äººè¦äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼ˆå› æ­¤ï¼ŒBGP åè®®äº¤æ¢è·¯ç”±ä¿¡æ¯çš„ç»“ç‚¹æ•°é‡çº§æ˜¯è‡ªæ²»ç³»ç»Ÿä¸ªæ•°çš„é‡çº§ï¼Œè¿™è¦æ¯”è¿™äº›è‡ªæ²»ç³»ç»Ÿä¸­çš„ç½‘ç»œæ•°å°‘å¾ˆå¤šï¼‰ï¼Œè¦å…ˆå»ºç«‹ TCP è¿žæŽ¥ï¼ˆç«¯å£ 179ï¼‰ï¼Œç„¶åŽåœ¨æ­¤è¿žæŽ¥ä¸Šäº¤æ¢ BGP æŠ¥æ–‡ä»¥å»ºç«‹ BGP ä¼šè¯ï¼ˆsessionï¼‰ï¼Œåˆ©ç”¨ BGP ä¼šè¯äº¤æ¢è·¯ç”±ä¿¡æ¯ï¼Œå¦‚å¢žåŠ äº†æ–°çš„è·¯ç”±ï¼Œæˆ–æ’¤é”€è¿‡æ—¶çš„è·¯ç”±ï¼Œä»¥åŠæŠ¥å‘Šå‡ºå·®é”™çš„æƒ…å†µç­‰ç­‰ã€‚ä½¿ç”¨ TCP è¿žæŽ¥èƒ½æä¾›å¯é çš„æœåŠ¡ï¼Œä¹Ÿç®€åŒ–äº†è·¯ç”±é€‰æ‹©åè®®ã€‚ä½¿ç”¨ TCP è¿žæŽ¥äº¤æ¢è·¯ç”±ä¿¡æ¯çš„ä¸¤ä¸ª BGP å‘è¨€äººï¼Œå½¼æ­¤æˆä¸ºå¯¹æ–¹çš„<strong>é‚»ç«™</strong>ï¼ˆneighborï¼‰æˆ–<strong>å¯¹ç­‰ç«™</strong>ï¼ˆpeerï¼‰ã€‚</p><p>åœ¨ BGP åˆšå¼€å§‹è¿è¡Œæ—¶ï¼ŒBGP çš„é‚»ç«™æ˜¯äº¤æ¢æ•´ä¸ªçš„ BGP è·¯ç”±è¡¨ã€‚ä½†ä»¥åŽåªéœ€è¦åœ¨å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°æœ‰å˜åŒ–çš„éƒ¨åˆ†ã€‚è¿™æ ·åšå¯¹èŠ‚çœç½‘ç»œå¸¦å®½å’Œå‡å°‘è·¯ç”±å™¨çš„å¤„ç†å¼€é”€æ–¹é¢éƒ½æœ‰å¥½å¤„ã€‚</p><p>BGP é‡‡ç”¨äº†<strong>è·¯å¾„å‘é‡è·¯ç”±é€‰æ‹©åè®®</strong>ï¼Œå®ƒä¸Žè·ç¦»å‘é‡åè®®ï¼ˆå¦‚ RIPï¼‰å’Œé“¾è·¯çŠ¶æ€åè®®ï¼ˆå¦‚ OSPFï¼‰éƒ½æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚ä¸‹å›¾ç»™å‡ºä¸€ä¸ª BGP å‘è¨€äººäº¤æ¢è·¯å¾„å‘é‡çš„ä¾‹å­ã€‚AS2 çš„ BGP å‘è¨€äººé€šè¿‡ä¸»å¹²ç½‘çš„ BGP å‘è¨€äººï¼šâ€œè¦åˆ°è¾¾ç½‘ç»œ N1ï¼ŒN2ï¼ŒN3 å’Œ N4 å¯ç»è¿‡ AS2ã€‚â€œä¸»å¹²ç½‘åœ¨æ”¶åˆ°è¿™ä¸ªé€šçŸ¥åŽï¼Œå°±å‘å‡ºé€šçŸ¥ï¼šâ€è¦åˆ°è¾¾ç½‘ç»œ N1ï¼ŒN2ï¼ŒN3 å’Œ N4 å¯æ²¿è·¯å¾„ï¼ˆAS1, AS2ï¼‰ã€‚â€œ</p><p><img src="/uploads/image/computer-networking/bgp-path-vector-example.jpeg"></p><p>BGP æ”¯æŒæ— åˆ†ç±»åŸŸé—´è·¯ç”±é€‰æ‹© CIDRï¼Œå› æ­¤ BGP çš„è·¯ç”±è¡¨åº”å½“åŒ…æ‹¬<strong>ç›®çš„ç½‘ç»œå‰ç¼€ã€ä¸‹ä¸€è·³è·¯ç”±å™¨ï¼Œä»¥åŠåˆ°è¾¾è¯¥ç›®çš„ç½‘ç»œæ‰€è¦ç»è¿‡çš„è‡ªæ²»ç³»ç»Ÿåºåˆ—</strong>ã€‚ç”±äºŽä½¿ç”¨äº†è·¯å¾„å‘é‡ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°é¿å…ä¼šå…œåœˆå­çš„è·¯ç”±ï¼šå¦‚æžœä¸€ä¸ª BGP å‘è¨€äººæ”¶åˆ°äº†ä¸€ä¸ªè·¯å¾„é€šçŸ¥ï¼Œå®ƒè¦æ£€æŸ¥ä¸€ä¸‹æœ¬è‡ªæ²»ç³»ç»Ÿæ˜¯å¦åœ¨æ­¤é€šçŸ¥çš„è·¯å¾„ä¸­ã€‚å¦‚æžœåœ¨è¿™æ¡è·¯å¾„ä¸­ï¼Œå°±ä¸èƒ½é‡‡ç”¨è¿™æ¡è·¯å¾„ï¼ˆå› ä¸ºä¼šå…œåœˆå­ï¼‰ã€‚</p><p>BGP å¯ä»¥å¾ˆå®¹æ˜“åœ°è§£å†³è·ç¦»å‘é‡è·¯ç”±é€‰æ‹©ç®—æ³•ä¸­çš„â€œåæ¶ˆæ¯ä¼ æ’­å¾—æ…¢â€è¿™ä¸€é—®é¢˜ã€‚ä½†æŸä¸ªè·¯ç”±å™¨æˆ–é“¾è·¯å‡ºæ•…éšœæ—¶ï¼Œç”±äºŽ BGP å‘è¨€äººå¯ä»¥ä»Žä¸æ­¢ä¸€ä¸ªé‚»ç«™èŽ·å¾—è·¯ç”±ä¿¡æ¯ï¼Œå› æ­¤å¾ˆå®¹æ˜“é€‰æ‹©å‡ºæ–°çš„è·¯ç”±ã€‚</p><h3 id="bgp-åè®®çš„æŠ¥æ–‡æ ¼å¼">BGP åè®®çš„æŠ¥æ–‡æ ¼å¼</h3><p>é€šç”¨é¦–éƒ¨ï¼š</p><p><img src="/uploads/image/computer-networking/bgp-path-vector-example.jpeg"></p><ul><li>æ ‡è®°ï¼šç”¨æ¥é‰´åˆ«æ”¶åˆ°çš„ BGP æŠ¥æ–‡ï¼Œå½“ä¸ä½¿ç”¨é‰´åˆ«æ—¶è¦ç½®ä¸ºå…¨ 1ã€‚</li><li>é•¿åº¦ï¼šä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œæœ€å°å€¼æ˜¯ 19ï¼ˆåªæœ‰é¦–éƒ¨ï¼‰ï¼Œæœ€å¤§å€¼æ˜¯ 4096ã€‚</li><li>ç±»åž‹ï¼š1 åˆ° 4ï¼Œåˆ†åˆ«å¯¹åº” 4 ç§æŠ¥æ–‡ã€‚<ul><li>OPEN æŠ¥æ–‡ï¼Œç”¨æ¥ä¸Žç›¸é‚»çš„å¦ä¸€ä¸ª BGP å‘è¨€äººå»ºç«‹å…³ç³»ï¼Œä½¿é€šä¿¡åˆå§‹åŒ–ã€‚å¦‚æžœå¯¹æ–¹æŽ¥å—ï¼Œå°±ç”¨ KEEPALIVE æŠ¥æ–‡å“åº”ï¼Œè¿™æ ·ï¼Œä¸¤ä¸ª BGP å‘è¨€äººçš„é‚»ç«™å…³ç³»å°±å»ºç«‹äº†ã€‚</li><li>UPDATE æŠ¥æ–‡ï¼ŒBGP åè®®çš„æ ¸å¿ƒå†…å®¹ï¼ŒBGP å‘è¨€äººå¯ä»¥ç”¨ UPDATE æŠ¥æ–‡æ’¤é”€å®ƒä»¥å‰é€šçŸ¥è¿‡çš„è·¯ç”±ï¼Œä¹Ÿå¯ä»¥å®£å¸ƒå¢žåŠ æ–°çš„è·¯ç”±ã€‚æ’¤é”€è·¯ç”±å¯ä»¥ä¸€æ¬¡æ’¤é”€è®¸å¤šæ¡ï¼Œä½†å¢žåŠ æ–°è·¯ç”±æ—¶ï¼Œæ¯ä¸ªæ›´æ–°æŠ¥æ–‡åªèƒ½å¢žåŠ ä¸€æ¡ã€‚</li><li>KEEPALIVE æŠ¥æ–‡ï¼Œç”¨æ¥å‘¨æœŸæ€§åœ°ï¼ˆä¸€èˆ¬æ˜¯ 30 ç§’ï¼‰è¯å®žé‚»ç«™çš„è¿žé€šæ€§ã€‚KEEPALIVE æŠ¥æ–‡åªæœ‰ 19 å­—èŠ‚ï¼ˆé¦–éƒ¨ï¼‰ï¼Œå› æ­¤ä¸ä¼šé€ æˆç½‘ç»œä¸Šå¤ªå¤§çš„å¼€é”€ã€‚</li><li>NOTIFICATION æŠ¥æ–‡ï¼Œç”¨æ¥å‘é€æ£€æµ‹åˆ°çš„é”™è¯¯ã€‚</li></ul></li></ul><p>æŠ¥æ–‡ä¸»ä½“ï¼š</p><ul><li>OPENï¼š6 ä¸ªå­—æ®µï¼Œç‰ˆæœ¬ã€æœ¬è‡ªæ²»ç³»ç»Ÿå·ã€ä¿æŒæ—¶é—´ï¼ˆç§’ï¼‰ã€BGP æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸å°±æ˜¯è¯¥è·¯ç”±å™¨çš„ IP åœ°å€ï¼‰ã€å¯é€‰å‚æ•°é•¿åº¦ å’Œ å¯é€‰å‚æ•°ã€‚</li><li>UPDATEï¼š5 ä¸ªå­—æ®µï¼Œä¸å¯è¡Œè·¯ç”±é•¿åº¦ï¼ˆæŒ‡æ˜Žä¸‹ä¸€å­—æ®µçš„é•¿åº¦ï¼‰ã€æ’¤é”€çš„è·¯ç”±ã€è·¯å¾„å±žæ€§æ€»é•¿åº¦ï¼ˆæŒ‡æ˜Žä¸‹ä¸€å­—æ®µçš„é•¿åº¦ï¼‰ã€è·¯å¾„å±žæ€§ å’Œ ç½‘ç»œå±‚å¯è¾¾æ€§ä¿¡æ¯ï¼ˆå®šä¹‰å‘å‡ºæ­¤æŠ¥æ–‡çš„ç½‘ç»œï¼ŒåŒ…æ‹¬ç½‘ç»œå‰ç¼€çš„ä½æ•°ã€IP åœ°å€å‰ç¼€ï¼‰ã€‚</li><li>KEEPALIVEï¼šæ— å­—æ®µï¼Œåªæœ‰é¦–éƒ¨ã€‚</li><li>NOTIFICATIONï¼š 3 ä¸ªå­—æ®µï¼Œå·®é”™ä»£ç ã€å·®é”™å­ä»£ç  å’Œ å·®é”™æ•°æ®ã€‚</li></ul><h1 id="è·¯ç”±å™¨çš„æž„æˆ">è·¯ç”±å™¨çš„æž„æˆ</h1><p>è·¯ç”±å™¨æ˜¯ä¸€ç§å…·æœ‰å¤šä¸ªè¾“å…¥ç«¯å£å’Œå¤šä¸ªè¾“å‡ºç«¯å£çš„ä¸“ç”¨è®¡ç®—æœºï¼Œå…¶ä»»åŠ¡æ˜¯è½¬å‘åˆ†ç»„ã€‚è·¯ç”±å™¨çš„è½¬å‘åˆ†ç»„æ­£æ˜¯ç½‘ç»œå±‚çš„ä¸»è¦å·¥ä½œã€‚</p><p><img src="/uploads/image/computer-networking/router-structure.jpeg"></p><p>æ•´ä¸ªè·¯ç”±å™¨ç»“æž„å¯åˆ’åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š<strong>è·¯ç”±é€‰æ‹©</strong>éƒ¨åˆ†å’Œ<strong>åˆ†ç»„è½¬å‘</strong>éƒ¨åˆ†ã€‚è·¯ç”±é€‰æ‹©éƒ¨åˆ†ä¹Ÿå«åšæŽ§åˆ¶éƒ¨åˆ†ï¼Œå…¶æ ¸å¿ƒæž„ä»¶æ˜¯è·¯ç”±é€‰æ‹©å¤„ç†æœºã€‚è·¯ç”±é€‰æ‹©å¤„ç†æœºçš„ä»»åŠ¡æ˜¯æ ¹æ®æ‰€é€‰å®šçš„åè®®æž„é€ è·¯ç”±è¡¨ï¼Œå¹¶æ›´æ–°å’Œç»´æŠ¤è·¯ç”±è¡¨ã€‚ï¼ˆå¦‚å‰é¢ä»‹ç»çš„é‚£æ ·ï¼‰æœ¬èŠ‚è®¨è®ºåˆ†ç»„è½¬å‘éƒ¨åˆ†ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<strong>äº¤æ¢ç»“æž„</strong>ã€ä¸€ç»„<strong>è¾“å…¥ç«¯å£</strong>å’Œä¸€ç»„<strong>è¾“å‡ºç«¯å£</strong>ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ç¡¬ä»¶ç«¯å£ï¼‰ã€‚</p><p>â€œè½¬å‘â€å’Œâ€œè·¯ç”±é€‰æ‹©â€æ˜¯æœ‰åŒºåˆ«çš„ã€‚â€œè½¬å‘â€å°±æ˜¯è·¯ç”±å™¨æ ¹æ®è½¬å‘è¡¨æŠŠæ”¶åˆ°çš„ IP æ•°æ®æŠ¥ä»Žåˆé€‚çš„ç«¯å£è½¬å‘å‡ºåŽ»ï¼Œä»…ä»…æ¶‰åŠåˆ°ä¸€ä¸ªè·¯ç”±å™¨ã€‚ä½†â€œè·¯ç”±é€‰æ‹©â€åˆ™æ¶‰åŠåˆ°å¾ˆå¤šè·¯ç”±å™¨ï¼Œè·¯ç”±è¡¨åˆ™æ˜¯è®¸å¤šè·¯ç”±å™¨ååŒå·¥ä½œçš„ç»“æžœã€‚</p><p>â€œè½¬å‘è¡¨â€œå’Œâ€è·¯ç”±è¡¨â€œä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚â€è·¯ç”±è¡¨â€œä¸€èˆ¬åŒ…å«ä»Žç›®çš„ç½‘ç»œåˆ°ä¸‹ä¸€è·³ï¼ˆç”¨ IP åœ°å€è¡¨ç¤ºï¼‰çš„æ˜ å°„ï¼Œè€Œâ€è½¬å‘è¡¨â€œæ˜¯ä»Žè·¯ç”±è¡¨å¾—å‡ºçš„ï¼ŒåŒ…å«å®Œæˆè½¬å‘åŠŸèƒ½æ‰€å¿…éœ€çš„ä¿¡æ¯ï¼šä»Žç›®çš„ç½‘ç»œåˆ°è¾“å‡ºç«¯å£å’ŒæŸäº› MAC åœ°å€ä¿¡æ¯çš„æ˜ å°„ï¼ˆå¦‚ä¸‹ä¸€è·³çš„ä»¥å¤ªç½‘åœ°å€ï¼‰ã€‚å°†è½¬å‘è¡¨å’Œè·¯ç”±è¡¨ç”¨ä¸åŒçš„æ•°æ®ç»“æž„å®žçŽ°ä¼šå¸¦æ¥ä¸€äº›å¥½å¤„ï¼Œå› ä¸ºåœ¨è½¬å‘åˆ†ç»„æ—¶ï¼Œè½¬å‘è¡¨çš„ç»“æž„åº”å½“ä½¿æŸ¥æ‰¾è¿‡ç¨‹æœ€ä¼˜åŒ–ï¼Œä½†è·¯ç”±è¡¨åˆ™éœ€è¦å¯¹ç½‘ç»œæ‹“æ‰‘å˜åŒ–çš„è®¡ç®—æœ€ä¼˜åŒ–ã€‚è·¯ç”±è¡¨æ€»æ˜¯ç”¨è½¯ä»¶å®žçŽ°çš„ï¼Œä½†è½¬å‘è¡¨ç”šè‡³å¯ä»¥ç”¨ç‰¹æ®Šçš„ç¡¬ä»¶æ¥å®žçŽ°ã€‚è¯·æ³¨æ„ï¼Œ<strong>åœ¨è®¨è®ºè·¯ç”±é€‰æ‹©çš„åŽŸç†æ—¶ï¼Œå¾€å¾€ä¸åŽ»åŒºåˆ†è½¬å‘è¡¨å’Œè·¯ç”±è¡¨çš„åŒºåˆ«ï¼Œç¬¼ç»Ÿåœ°ä½¿ç”¨è·¯ç”±è¡¨è¿™ä¸€åè¯</strong>ã€‚</p><p>è¾“å…¥ç«¯å£å’Œè¾“å‡ºç«¯å£é‡Œçš„æ–¹æ¡† 1ã€2 å’Œ 3 åˆ†åˆ«ä»£è¡¨ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚å’Œç½‘ç»œå±‚çš„å¤„ç†æ¨¡å—ã€‚</p><ul><li>ç‰©ç†å±‚è¿›è¡Œæ¯”ç‰¹çš„æŽ¥æ”¶ã€‚</li><li>æ•°æ®é“¾è·¯å±‚åˆ™æŒ‰ç…§é“¾è·¯å±‚åè®®æŽ¥æ”¶å¸§ã€‚åœ¨æŠŠå¸§çš„é¦–éƒ¨å’Œå°¾éƒ¨å‰¥åŽ»åŽï¼Œåˆ†ç»„å°±è¢«é€å…¥ç½‘ç»œå±‚çš„å¤„ç†æ¨¡å—ã€‚</li><li>è‹¥æŽ¥æ”¶åˆ°çš„æ˜¯äº¤æ¢è·¯ç”±ä¿¡æ¯çš„åˆ†ç»„ï¼ˆå¦‚ RIP æˆ– OSPF åˆ†ç»„ç­‰ï¼‰ï¼Œåˆ™äº¤ç»™è·¯ç”±é€‰æ‹©å¤„ç†æœºã€‚è‹¥æŽ¥æ”¶åˆ°çš„æ˜¯æ•°æ®åˆ†ç»„ï¼Œåˆ™æŒ‰ç…§åˆ†ç»„é¦–éƒ¨ä¸­çš„ç›®çš„åœ°å€æŸ¥æ‰¾è½¬å‘è¡¨ï¼Œæ ¹æ®å¾—åˆ°çš„ç»“æžœï¼Œåˆ†ç»„å°±ç»è¿‡äº¤æ¢ç»“æž„åˆ°è¾¾åˆé€‚çš„è¾“å‡ºç«¯å£ã€‚</li></ul><p>è·¯ç”±å™¨å¿…é¡»ä»¥å¾ˆé«˜çš„é€ŸçŽ‡è½¬å‘åˆ†ç»„ã€‚åˆ†ç»„åœ¨è¾“å…¥ç«¯å£å’Œè¾“å‡ºç«¯å£éƒ½å¯èƒ½ä¼šåœ¨é˜Ÿåˆ—ä¸­æŽ’é˜Ÿç­‰å€™å¤„ç†ã€‚è‹¥åˆ†ç»„å¤„ç†çš„é€ŸçŽ‡èµ¶ä¸ä¸Šåˆ†ç»„è¿›å…¥é˜Ÿåˆ—çš„é€ŸçŽ‡ï¼Œåˆ™é˜Ÿåˆ—çš„å­˜å‚¨ç©ºé—´æœ€ç»ˆå¿…å®šå‡å°‘åˆ°é›¶ï¼Œè¿™å°±ä½¿åŽé¢å†è¿›å…¥é˜Ÿåˆ—çš„åˆ†ç»„è¢«ä¸¢å¼ƒã€‚ä»¥å‰è®¨è®ºçš„åˆ†ç»„ä¸¢å¤±å°±æ˜¯å‘ç”Ÿåœ¨è·¯ç”±å™¨ä¸­çš„è¾“å…¥å’Œè¾“å‡ºé˜Ÿåˆ—äº§ç”Ÿæº¢å‡ºçš„æ—¶å€™ã€‚å½“ç„¶ï¼Œè®¾å¤‡æˆ–çº¿è·¯å‡ºæ•…éšœä¹Ÿå¯èƒ½ä½¿åˆ†ç»„ä¸¢å¤±ã€‚</p><p><img src="/uploads/image/computer-networking/router-forwarding.jpeg"></p><p>äº¤æ¢ç»“æž„æ˜¯è·¯ç”±å™¨çš„å…³é”®æž„ä»¶ã€‚æ­£æ˜¯è¿™ä¸ªäº¤æ¢ç»“æž„æŠŠåˆ†ç»„ä»Žä¸€ä¸ªè¾“å…¥ç«¯å£è½¬ç§»åˆ°æŸä¸ªåˆé€‚çš„è¾“å‡ºç«¯å£ã€‚ä¸‹å›¾ç»™å‡ºäº†ä¸‰ç§å¸¸ç”¨çš„äº¤æ¢æ–¹æ³•ã€‚</p><p><img src="/uploads/image/computer-networking/router-switching-fabric.jpeg"></p><ul><li>å­˜å‚¨å™¨ï¼šæœ€æ—©ä½¿ç”¨çš„è·¯ç”±å™¨å°±æ˜¯åˆ©ç”¨æ™®é€šçš„è®¡ç®—æœºï¼Œç”¨ CPU ä½œä¸ºè·¯ç”±å™¨çš„è·¯ç”±é€‰æ‹©å¤„ç†æœºã€‚åˆ†ç»„ä»Žè¾“å…¥ç«¯å£å¤åˆ¶åˆ°å­˜å‚¨å™¨ä¸­ï¼Œè·¯ç”±å™¨å¤„ç†æœºä»Žåˆ†ç»„é¦–éƒ¨æå–ç›®çš„åœ°å€ï¼ŒæŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œå†å°†åˆ†ç»„å¤åˆ¶åˆ°åˆé€‚çš„è¾“å‡ºç«¯å£çš„ç¼“å­˜ä¸­ã€‚è‹¥å­˜å‚¨å™¨çš„å¸¦å®½ï¼ˆè¯»æˆ–å†™ï¼‰ä¸ºæ¯ç§’ M ä¸ªåˆ†ç»„ï¼Œé‚£ä¹ˆè·¯ç”±å™¨çš„äº¤æ¢é€ŸçŽ‡ä¸€å®šå°äºŽ M/2ã€‚å› ä¸ºå­˜å‚¨å™¨å¯¹åˆ†ç»„çš„è¯»å’Œå†™éœ€è¦èŠ±è´¹çš„æ—¶é—´æ˜¯åŒä¸€ä¸ªé‡çº§ã€‚è®¸å¤šçŽ°ä»£çš„è·¯ç”±å™¨ä¹Ÿé€šè¿‡å­˜å‚¨å™¨è¿›è¡Œäº¤æ¢ï¼Œä¸åŒçš„æ˜¯ï¼Œç›®çš„åœ°å€çš„æŸ¥æ‰¾å’Œåˆ†ç»„åœ¨å­˜å‚¨å™¨ä¸­çš„ç¼“å­˜éƒ½æ˜¯åœ¨è¾“å…¥ç«¯å£è¿›è¡Œçš„ã€‚</li><li>æ€»çº¿ï¼šæ•°æ®æŠ¥ä»Žè¾“å…¥ç«¯å£é€šè¿‡å…±äº«çš„æ€»çº¿ç›´æŽ¥ä¼ é€åˆ°åˆé€‚çš„è¾“å‡ºç«¯å£ï¼Œè€Œä¸éœ€è¦è·¯ç”±é€‰æ‹©å¤„ç†æœºçš„å¹²é¢„ï¼ˆå¤åˆ¶ï¼‰ã€‚ä½†æ˜¯ï¼Œç”±äºŽæ€»çº¿æ˜¯å…±äº«çš„ï¼Œå› æ­¤åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªåˆ†ç»„åœ¨æ€»çº¿ä¸Šä¼ é€ã€‚è·¯ç”±å™¨çš„è½¬å‘å¸¦å®½å—æ€»çº¿é€ŸçŽ‡çš„é™åˆ¶ã€‚</li><li><p>äº’è¿žç½‘ç»œï¼šé€šè¿‡çºµæ¨ªäº¤æ¢ç»“æž„ï¼ˆcrossbar switch fabricï¼‰è¿›è¡Œäº¤æ¢ï¼Œå®ƒæœ‰ 2N æ¡æ€»çº¿ï¼Œå¯ä»¥ä½¿ N ä¸ªè¾“å…¥ç«¯å£å’Œ N ä¸ªè¾“å‡ºç«¯å£ç›¸è¿žæŽ¥ï¼Œè¿™å–å†³äºŽç›¸åº”çš„äº¤å‰èŠ‚ç‚¹æ˜¯ä½¿æ°´å¹³æ€»çº¿å’Œåž‚ç›´æ€»çº¿è¿žé€šè¿˜æ˜¯æ–­å¼€ã€‚</p><p>å½“è¾“å…¥ç«¯å£æ”¶åˆ°ä¸€ä¸ªåˆ†ç»„æ—¶ï¼Œå°±å°†å®ƒå‘é€åˆ°ä¸Žè¯¥è¾“å…¥ç«¯å£ç›¸è¿žçš„æ°´å¹³æ€»çº¿ä¸Šã€‚è‹¥é€šå‘æ‰€è¦è½¬å‘çš„è¾“å‡ºç«¯å£çš„åž‚ç›´æ€»çº¿æ˜¯ç©ºé—²çš„ï¼Œåˆ™åœ¨è¿™ä¸ªç»“ç‚¹å°†åž‚ç›´æ€»çº¿ä¸Žæ°´å¹³æ€»çº¿æŽ¥é€šï¼Œç„¶åŽå°†è¯¥åˆ†ç»„è½¬å‘åˆ°è¿™ä¸ªè¾“å‡ºç«¯å£ã€‚è‹¥åž‚ç›´æ€»çº¿è¢«å ç”¨ï¼Œåˆ™è¢«é˜»å¡žï¼Œå¿…é¡»åœ¨è¾“å…¥ç«¯å£æŽ’é˜Ÿã€‚</p></li></ul><h1 id="ipv6">IPv6</h1><p>IPv6 ä»æ”¯æŒæ— è¿žæŽ¥çš„ä¼ é€ï¼Œä½†å°†åè®®æ•°æ®å•å…ƒ PDU ç§°ä¸ºåˆ†ç»„ï¼Œè€Œä¸æ˜¯ IPv4 çš„æ•°æ®æŠ¥ã€‚æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œä»é‡‡ç”¨æ•°æ®æŠ¥è¿™ä¸€åè¯ã€‚</p><p>IPv6 å¼•è¿›åˆ°ä¸»è¦å˜åŒ–ï¼š</p><ul><li>æ›´å¤§çš„åœ°å€ç©ºé—´ã€‚ä»Ž IPv4 çš„ 32 ä½ å¢žå¤§åˆ° 128 ä½ã€‚</li><li>æ‰©å±•çš„åœ°å€å±‚æ¬¡ç»“æž„ã€‚ç”±äºŽåœ°å€ç©ºé—´å¾ˆå¤§ï¼Œå› æ­¤å¯ä»¥åˆ’åˆ†æ›´å¤šçš„å±‚æ¬¡ã€‚</li><li>çµæ´»çš„é¦–éƒ¨æ ¼å¼ã€‚IPv6 çš„é¦–éƒ¨ä¸Ž IPv4 çš„å¹¶ä¸å…¼å®¹ã€‚IPv6 å®šä¹‰äº†è®¸å¤šå¯é€‰çš„æ‰©å……é¦–éƒ¨ã€‚</li><li>æ”¹è¿›çš„é€‰é¡¹ã€‚IPv6 çš„é¦–éƒ¨é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œé€‰é¡¹æ”¾åœ¨æœ‰æ•ˆè½½è·ä¸­ã€‚</li><li>å…è®¸åè®®ç»§ç»­æ‰©å……ã€‚</li><li>æ”¯æŒå³æ’å³ç”¨ã€‚å› æ­¤ IPv6 ä¸éœ€è¦ä½¿ç”¨ DHCPã€‚</li><li>æ”¯æŒèµ„æºçš„é¢„åˆ†é…ã€‚</li><li>é¦–éƒ¨æ”¹ä¸º 8 å­—èŠ‚å¯¹é½ã€‚IPv4 æ˜¯ 4 å­—èŠ‚å¯¹é½ã€‚</li></ul><h2 id="åŸºæœ¬é¦–éƒ¨">åŸºæœ¬é¦–éƒ¨</h2><p>IPv6 æ•°æ®æŠ¥ç”±ä¸¤å¤§éƒ¨åˆ†ç»„æˆï¼Œå³<strong>åŸºæœ¬é¦–éƒ¨</strong>ï¼ˆbase headerï¼‰å’Œ<strong>æœ‰æ•ˆè½½è·</strong>ï¼ˆpayloadï¼‰ã€‚æœ‰æ•ˆè½½è·å…è®¸æœ‰é›¶ä¸ªæˆ–å¤šä¸ª<strong>æ‰©å±•é¦–éƒ¨</strong>ï¼ˆextension headerï¼‰ï¼Œå†åŽé¢æ˜¯æ•°æ®éƒ¨åˆ†ã€‚æ³¨æ„ï¼Œæ‰©å±•é¦–éƒ¨å¹¶ä¸å±žäºŽ IPv6 æ•°æ®æŠ¥çš„é¦–éƒ¨ã€‚</p><p><img src="/uploads/image/computer-networking/ipv6-header.jpg"></p><p>ä¸Ž IPv4 ç›¸æ¯”ï¼ŒIPv6 å¯¹é¦–éƒ¨ä¸­çš„æŸäº›å­—æ®µè¿›è¡Œäº†å¦‚ä¸‹çš„æ›´æ”¹ï¼š</p><ul><li>å–æ¶ˆäº†é¦–éƒ¨é•¿åº¦å­—æ®µï¼Œå› ä¸ºå®ƒçš„é¦–éƒ¨é•¿åº¦æ˜¯å›ºå®šçš„ï¼ˆ40 å­—èŠ‚ï¼‰ã€‚</li><li>å–æ¶ˆäº†æœåŠ¡ç±»åž‹å­—æ®µï¼Œä¼˜å…ˆçº§å’Œæµæ ‡å·å­—æ®µå®žçŽ°äº†æœåŠ¡ç±»åž‹çš„åŠŸèƒ½ã€‚</li><li>å–æ¶ˆäº†æ€»é•¿åº¦å­—æ®µï¼Œæ”¹ç”¨æœ‰æ•ˆè½½è·é•¿åº¦å­—æ®µã€‚</li><li>å–æ¶ˆäº†æ ‡è¯†ã€æ ‡å¿—å’Œç‰‡åç§»å­—æ®µï¼Œè¿™äº›åŠŸèƒ½åŒ…å«åœ¨åˆ†ç‰‡æ‰©å±•é¦–éƒ¨ä¸­ã€‚</li><li>æŠŠ TTL å­—æ®µæ”¹ç§°ä¸ºè·³æ•°é™åˆ¶å­—æ®µï¼Œæ„ä¹‰ä¸å˜ã€‚</li><li>å–æ¶ˆäº†åè®®å­—æ®µï¼Œæ”¹ç”¨ä¸‹ä¸€ä¸ªé¦–éƒ¨å­—æ®µã€‚</li><li>å–æ¶ˆäº†æ£€éªŒå’Œå­—æ®µï¼Œä¸è¿›è¡Œå·®é”™æ£€æµ‹ã€‚</li><li>å–æ¶ˆäº†é€‰é¡¹å­—æ®µï¼Œç”¨æ‰©å±•é¦–éƒ¨å®žçŽ°é€‰é¡¹åŠŸèƒ½ã€‚</li></ul><p>åŸºæœ¬é¦–éƒ¨ï¼š</p><ul><li>ç‰ˆæœ¬ï¼š6ã€‚</li><li>é€šä¿¡é‡ç±»ï¼šåŒºåˆ†ä¸åŒçš„ IPv6 æ•°æ®æŠ¥çš„ç±»åˆ«æˆ–ä¼˜å…ˆçº§ã€‚</li><li>æµæ ‡å·ï¼šIPv6 çš„ä¸€ä¸ªæ–°çš„æœºåˆ¶æ˜¯<strong>æ”¯æŒèµ„æºé¢„åˆ†é…</strong>ï¼Œå¹¶ä¸”å…è®¸è·¯ç”±å™¨æŠŠæ¯ä¸€ä¸ªæ•°æ®æŠ¥ä¸Žä¸€ä¸ªç»™å®šçš„èµ„æºåˆ†é…ç›¸è”ç³»ã€‚IPv6 æå‡ºæµï¼ˆflowï¼‰çš„æŠ½è±¡æ¦‚å¿µã€‚æ‰€è°“<strong>æµå°±æ˜¯äº’è”ç½‘ä¸Šä»Žç‰¹å®šæºç‚¹åˆ°ç‰¹å®šç»ˆç‚¹ï¼ˆå•æ’­æˆ–å¤šæ’­ï¼‰çš„ä¸€ç³»åˆ—æ•°æ®æŠ¥ï¼ˆå¦‚å®žæ—¶éŸ³é¢‘æˆ–è§†é¢‘ä¼ è¾“ï¼‰ï¼Œè€Œåœ¨è¿™ä¸ªæµæ‰€ç»è¿‡çš„è·¯å¾„ä¸Šçš„è·¯ç”±å™¨éƒ½ä¿è¯æŒ‡æ˜Žçš„æœåŠ¡è´¨é‡</strong>ã€‚æ‰€æœ‰å±žäºŽåŒä¸€ä¸ªæµçš„æ•°æ®æŠ¥éƒ½å…·æœ‰åŒæ ·çš„æµæ ‡å·ã€‚å› æ­¤ï¼Œæµæ ‡å·å¯¹å®žæ—¶éŸ³é¢‘/è§†é¢‘æ•°æ®çš„ä¼ é€ç‰¹åˆ«æœ‰ç”¨ã€‚å¯¹äºŽä¼ ç»Ÿçš„éžå®žæ—¶æ•°æ®ï¼ˆå¦‚ç”µå­é‚®ä»¶ï¼‰ï¼Œæµæ ‡å·åˆ™æ²¡æœ‰ç”¨å¤„ï¼ŒæŠŠå®ƒç½® 0 å³å¯ã€‚</li><li>æœ‰æ•ˆè½½è·é•¿åº¦ï¼šé™¤åŸºæœ¬é¦–éƒ¨ä»¥å¤–çš„å­—èŠ‚æ•°ã€‚æœ€å¤§å€¼æ˜¯ 64 KBï¼ˆ65535 å­—èŠ‚ï¼‰ã€‚</li><li>ä¸‹ä¸€ä¸ªé¦–éƒ¨ï¼šå½“æ²¡æœ‰æ‰©å±•é¦–éƒ¨æ—¶ï¼Œå®ƒçš„å€¼æŒ‡å‡ºäº†é¦–éƒ¨åŽé¢çš„æ•°æ®åº”äº¤ä»˜ IP å±‚ä¸Šé¢çš„å“ªä¸€ä¸ªé«˜å±‚åè®®ï¼ˆä¾‹å¦‚ï¼š6 æˆ– 17 åˆ†åˆ«è¡¨ç¤ºäº¤ä»˜ TCP æˆ– UDPï¼‰ã€‚å½“æœ‰æ‰©å±•é¦–éƒ¨æ—¶ï¼Œå®ƒçš„å€¼æ ‡è¯†ç¬¬ä¸€ä¸ªæ‰©å±•é¦–éƒ¨çš„ç±»åž‹ã€‚</li><li>è·³æ•°é™åˆ¶ï¼šæœ€å¤§ 255 è·³ã€‚</li></ul><p>æ‰©å±•é¦–éƒ¨ï¼š6 ç§ã€‚ï¼ˆ1ï¼‰é€è·³é€‰é¡¹ï¼›ï¼ˆ2ï¼‰è·¯ç”±é€‰æ‹©ï¼›ï¼ˆ3ï¼‰åˆ†ç‰‡ï¼›ï¼ˆ4ï¼‰é‰´åˆ«ï¼›ï¼ˆ5ï¼‰å°è£…å®‰å…¨æœ‰æ•ˆè½½è·ï¼›ï¼ˆ6ï¼‰ç›®çš„ç«™é€‰é¡¹ã€‚æ¯ä¸€ä¸ªæ‰©å±•é¦–éƒ¨éƒ½ç”±è‹¥å¹²ä¸ªå­—æ®µç»„æˆï¼Œå®ƒä»¬çš„é•¿åº¦ä¹Ÿå„ä¸åŒã€‚ä½†æ‰€æœ‰æ‰©å±•é¦–éƒ¨çš„ç¬¬ä¸€ä¸ªå­—æ®µéƒ½æ˜¯ 8 ä½çš„â€œä¸‹ä¸€ä¸ªé¦–éƒ¨â€å­—æ®µã€‚å½“ä½¿ç”¨å¤šä¸ªæ‰©å±•é¦–éƒ¨æ—¶ï¼Œåº”æŒ‰ä»¥ä¸Šçš„é¡ºåºå‡ºçŽ°ã€‚é«˜å±‚é¦–éƒ¨æ€»æ˜¯æ”¾åœ¨æœ€åŽé¢ã€‚</p><p>IPv4 çš„æ•°æ®æŠ¥å¦‚æžœåœ¨é¦–éƒ¨ä¸­ä½¿ç”¨äº†é€‰é¡¹ï¼Œé‚£ä¹ˆæ²¿ç€æ•°æ®æŠ¥ä¼ é€çš„è·¯å¾„ä¸Šçš„æ¯ä¸€ä¸ªè·¯ç”±å™¨éƒ½å¿…é¡»å¯¹è¿™äº›é€‰é¡¹ä¸€ä¸€è¿›è¡Œæ£€æŸ¥ï¼Œè¿™å°±é™ä½Žäº†è·¯ç”±å™¨å¤„ç†æ•°æ®æŠ¥çš„é€Ÿåº¦ã€‚ç„¶è€Œå®žé™…ä¸Šå¾ˆå¤šçš„é€‰é¡¹åœ¨é€”ä¸­çš„è·¯ç”±å™¨ä¸Šæ˜¯ä¸éœ€è¦æ£€æŸ¥çš„ï¼ˆå› ä¸ºä¸éœ€è¦ä½¿ç”¨è¿™äº›é€‰é¡¹çš„ä¿¡æ¯ï¼‰ã€‚<strong>IPv6 æŠŠé€‰é¡¹çš„åŠŸèƒ½éƒ½æ”¾åœ¨æ‰©å±•é¦–éƒ¨ä¸­ï¼Œå¹¶æŠŠæ‰©å±•é¦–éƒ¨ç•™ç»™è·¯å¾„ä¸¤ç«¯çš„æºç‚¹å’Œç»ˆç‚¹çš„ä¸»æœºæ¥å¤„ç†</strong>ï¼Œè€Œæ•°æ®æŠ¥é€”ä¸­ç»è¿‡çš„è·¯ç”±å™¨ä¸å¤„ç†è¿™äº›æ‰©å±•é¦–éƒ¨ï¼ˆåªæœ‰ä¸€ä¸ªé¦–éƒ¨ä¾‹å¤–ï¼Œå³é€è·³é€‰é¡¹æ‰©å±•é¦–éƒ¨ï¼‰ï¼Œè¿™æ ·å°±<strong>å¤§å¤§æé«˜äº†è·¯ç”±å™¨çš„å¤„ç†æ•ˆçŽ‡</strong>ã€‚</p><h2 id="ipv6-åœ°å€">IPv6 åœ°å€</h2><p>ä¸€èˆ¬æ¥è®²ï¼Œä¸€ä¸ª IPv6 æ•°æ®æŠ¥çš„ç›®çš„åœ°å€å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰ç§åŸºæœ¬ç±»åž‹åœ°å€ä¹‹ä¸€ï¼š</p><ol type="1"><li>å•æ’­ï¼ˆunicastï¼‰ ä¼ ç»Ÿçš„ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚</li><li>å¤šæ’­ï¼ˆmulticastï¼‰ ä¸€ç‚¹å¯¹å¤šç‚¹é€šä¿¡ï¼ŒIPv6 æ²¡æœ‰é‡‡ç”¨å¹¿æ’­çš„æœ¯è¯­ï¼Œè€Œæ˜¯å°†å¹¿æ’­çœ‹ä½œå¤šæ’­çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚</li><li>ä»»æ’­ï¼ˆanycastï¼‰ ä»»æ’­çš„ç»ˆç‚¹æ˜¯ä¸€ç»„è®¡ç®—æœºï¼Œä½†æ•°æ®æŠ¥åªäº¤ä»˜å…¶ä¸­çš„ä¸€ä¸ªï¼Œé€šå¸¸æ˜¯è·ç¦»æœ€è¿‘çš„ä¸€ä¸ªã€‚</li></ol><p>IPv6 æŠŠå®žçŽ° IPv6 çš„ä¸»æœºå’Œè·¯ç”±å™¨å‡ç§°ä¸º<strong>ç»“ç‚¹</strong>ã€‚ä¸€ä¸ªç»“ç‚¹å¯èƒ½æœ‰å¤šä¸ªä¸Žé“¾è·¯ç›¸è¿žçš„æŽ¥å£ï¼ŒIPv6 ç»™æ¯ä¸ªæŽ¥å£æŒ‡æ´¾ä¸€ä¸ª IP åœ°å€ã€‚ä¸€ä¸ªç»“ç‚¹å¯ä»¥æœ‰å¤šä¸ªå•æ’­åœ°å€ï¼Œè€Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªåœ°å€éƒ½å¯ä»¥å½“ä½œåˆ°è¾¾è¯¥ç»“ç‚¹çš„ç›®çš„åœ°å€ã€‚ï¼ˆIPv4 ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„å•Šï¼‰</p><p>IPv6 ä½¿ç”¨<strong>å†’å·åå…­è¿›åˆ¶è®°æ³•</strong>ï¼Œå®ƒæŠŠæ¯ä¸ª 16 ä½çš„å€¼ç”¨åå…­è¿›åˆ¶å€¼è¡¨ç¤ºï¼Œå„å€¼ä¹‹é—´ç”¨å†’å·åˆ†éš”ã€‚</p><ul><li>åœ¨åå…­è¿›åˆ¶è®°æ³•ä¸­ï¼Œå…è®¸æŠŠæ•°å­—å‰é¢çš„ 0 çœç•¥ã€‚ä¾‹å¦‚ï¼Œ<code>FF05:0:0:0:0:0:0:B3</code>ã€‚</li><li>å…è®¸é›¶åŽ‹ç¼©ï¼ˆzero compressionï¼‰ï¼Œä¸€è¿žä¸²è¿žç»­çš„é›¶å¯ä»¥ä¸ºä¸€å¯¹å†’å·å–ä»£ã€‚ä¸ºäº†ä¿è¯é›¶åŽ‹ç¼©æœ‰ä¸€ä¸ªä¸å«æ··çš„è§£é‡Šï¼Œè§„å®šåœ¨ä¸€ä¸ªåœ°å€ä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡é›¶åŽ‹ç¼©ã€‚ä¾‹å¦‚ï¼Œ<code>FF05::B3</code>ã€‚</li><li>å¯ç»“åˆä½¿ç”¨ç‚¹åˆ†åè¿›åˆ¶è®°æ³•çš„åŽç¼€ï¼ˆå†’å·åˆ†éš”çš„æ¯ä¸ªå€¼æ˜¯ä¸¤ä¸ªå­—èŠ‚çš„é‡ï¼Œç‚¹åˆ†éš”çš„æ¯ä¸ªå€¼æ˜¯ä¸€ä¸ªå­—èŠ‚çš„é‡ï¼‰ã€‚è¿™ç§ç»“åˆåœ¨ IPv4 å‘ IPv6 çš„è½¬æ¢é˜¶æ®µç‰¹åˆ«æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code>ï¼šï¼š128.10.2.1</code>ã€‚</li><li>CIDR çš„æ–œçº¿è®°æ³•ä»ç„¶å¯ç”¨ã€‚</li></ul><p>IPv6 çš„åœ°å€åˆ†ç±»</p><table><thead><tr class="header"><th>åœ°å€ç±»åž‹</th><th>äºŒè¿›åˆ¶å‰ç¼€</th></tr></thead><tbody><tr class="odd"><td>æœªæŒ‡æ˜Žåœ°å€ï¼ˆ1 ä¸ªï¼‰</td><td>00...0ï¼ˆ128 ä½ï¼‰ï¼Œ<code>::/128</code></td></tr><tr class="even"><td>çŽ¯å›žåœ°å€ï¼ˆ1 ä¸ªï¼‰</td><td>00...1ï¼ˆ128 ä½ï¼‰ï¼Œ<code>::1/128</code></td></tr><tr class="odd"><td>å¤šæ’­åœ°å€ï¼ˆåœ°å€æ€»æ•°çš„ 1/256ï¼‰</td><td>11111111ï¼ˆ8 ä½ï¼‰ï¼Œ<code>FF00::/8</code></td></tr><tr class="even"><td>æœ¬åœ°é“¾è·¯å•æ’­åœ°å€ï¼ˆåœ°å€æ€»æ•°çš„ 1/1024ï¼‰</td><td>1111111010ï¼ˆ10 ä½ï¼‰ï¼Œ<code>FE80::/10</code></td></tr><tr class="odd"><td>å…¨çƒå•æ’­åœ°å€</td><td>é™¤ä¸Šè¿°å››ç§ä»¥å¤–ï¼Œæ‰€æœ‰å…¶ä»–çš„äºŒè¿›åˆ¶å‰ç¼€</td></tr></tbody></table><p>æœ¬åœ°é“¾è·¯å•æ’­åœ°å€ï¼ˆLink-Local Unicast Addressï¼‰ æœ‰äº›å•ä½çš„ç½‘ç»œä½¿ç”¨ TCP/IP åè®®ï¼Œä½†å¹¶æ²¡æœ‰è¿žæŽ¥åˆ°äº’è”ç½‘ä¸Šã€‚è¿žæŽ¥åœ¨è¿™æ ·çš„ç½‘ç»œä¸Šçš„ä¸»æœºéƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æœ¬åœ°åœ°å€è¿›è¡Œé€šä¿¡ï¼Œä½†ä¸èƒ½å’Œäº’è”ç½‘ä¸Šçš„å…¶ä»–ä¸»æœºé€šä¿¡ã€‚</p><h2 id="ä»Ž-ipv4-å‘-ipv6-è¿‡æ¸¡">ä»Ž IPv4 å‘ IPv6 è¿‡æ¸¡</h2><p>å‘ IPv6 è¿‡æ¸¡åªèƒ½é‡‡ç”¨é€æ­¥æ¼”è¿›çš„æ–¹æ³•ã€‚</p><h3 id="åŒåè®®æ ˆ">åŒåè®®æ ˆ</h3><p>åŒåè®®æ ˆï¼ˆdual stackï¼‰æ˜¯æŒ‡åœ¨å®Œå…¨è¿‡æ¸¡åˆ° IPv6 ä¹‹å‰ï¼Œä½¿ä¸€éƒ¨åˆ†ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰è£…æœ‰åŒåè®®æ ˆï¼šä¸€ä¸ª IPv4 å’Œä¸€ä¸ª IPv6ã€‚åœ¨å’Œ IPv6 ä¸»æœºé€šä¿¡æ—¶é‡‡ç”¨ IPv6 åœ°å€ï¼Œè€Œå’Œ IPv4 ä¸»æœºé€šä¿¡æ—¶åˆ™é‡‡ç”¨ IPv4 åœ°å€ã€‚åŒåè®®æ ˆå¦‚ä½•çŸ¥é“ç›®çš„ä¸»æœºé‡‡ç”¨å“ªä¸€ç§åœ°å€å‘¢ï¼Ÿä½¿ç”¨åŸŸåç³»ç»Ÿ DNS æ¥æŸ¥è¯¢ã€‚è‹¥ DNS è¿”å›žçš„æ˜¯ IPv4 åœ°å€ï¼ŒåŒåè®®æ ˆçš„æºä¸»æœºå°±ä½¿ç”¨ IPv4 åœ°å€ã€‚å½“è¿”å›žçš„æ˜¯ IPv6 åœ°å€ï¼Œæºä¸»æœºå°±ä½¿ç”¨ IPv6 åœ°å€ã€‚</p><p>å›¾ç¤ºçš„æƒ…å†µæ˜¯ A å’Œ F éƒ½ä½¿ç”¨ IPv6ï¼Œæ‰€ä»¥ A å‘ F å‘é€ IPv6 æ•°æ®æŠ¥ï¼Œè·¯å¾„æ˜¯ <code>A -&gt; B -&gt; C -&gt; D -&gt; E -&gt; F</code>ã€‚ä½† B åˆ° E è¿™æ®µè·¯å¾„æ˜¯ IPv4 ç½‘ç»œï¼ŒB ä¸èƒ½å‘ C è½¬å‘ IPv6 æ•°æ®æŠ¥ã€‚å®ƒè¦æŠŠ IPv6 æ•°æ®æŠ¥é¦–éƒ¨è½¬æ¢ä¸º IPv4 æ•°æ®æŠ¥å†å‘é€ç»™ Cã€‚C å†è½¬å‘ç»™ Dã€‚D å°† IPv4 æ•°æ®æŠ¥æ¢å¤æˆ IPv6 æ•°æ®æŠ¥å†è½¬å‘ç»™ Eã€‚ä¸»è¦æ³¨æ„çš„æ˜¯ï¼ŒIPv6 <strong>é¦–éƒ¨ä¸­çš„æŸäº›å­—æ®µå´æ— æ³•æ¢å¤</strong>ã€‚è¿™ç§ä¿¡æ¯çš„æŸå¤±æ˜¯ä½¿ç”¨é¦–éƒ¨è½¬æ¢æ–¹æ³•æ‰€ä¸å¯é¿å…çš„ã€‚</p><p><img src="/uploads/image/computer-networking/ipv6-dual-stack.jpeg"></p><h3 id="éš§é“æŠ€æœ¯">éš§é“æŠ€æœ¯</h3><p>éš§é“æŠ€æœ¯ï¼ˆtunnelingï¼‰çš„è¦ç‚¹æ˜¯ï¼Œåœ¨ IPv6 æ•°æ®æŠ¥è¦è¿›å…¥ IPv4 ç½‘ç»œæ—¶ï¼ŒæŠŠ IPv6 æ•°æ®æŠ¥å°è£…æˆä¸º IPv4 æ•°æ®æŠ¥ã€‚æ•´ä¸ª IPv6 æ•°æ®æŠ¥å˜æˆäº† IPv4 æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ã€‚å½“ IPv4 æ•°æ®æŠ¥ç¦»å¼€ IPv4 ç½‘ç»œä¸­çš„éš§é“æ—¶ï¼Œå†æŠŠæ•°æ®éƒ¨åˆ†äº¤ç»™ä¸»æœºçš„ IPv6 åè®®æ ˆã€‚è¯·æ³¨æ„å›¾ä¸­ï¼Œåœ¨éš§é“ä¸­ä¼ é€çš„æ•°æ®æŠ¥çš„æºåœ°å€æ˜¯ B è€Œç›®çš„åœ°å€æ˜¯ Eã€‚</p><p>è¦ä½¿åŒåè®®æ ˆçš„ä¸»æœºçŸ¥é“ IPv4 æ•°æ®æŠ¥é‡Œå°è£…çš„æ˜¯ IPv6 æ•°æ®æŠ¥ï¼Œå¿…é¡»æŠŠ IPv4 é¦–éƒ¨çš„åè®®å­—æ®µç½®ä¸º 41ã€‚</p><p><img src="/uploads/image/computer-networking/ipv6-tunneling.jpeg"></p><h2 id="icmpv6">ICMPv6</h2><p>å’Œ IPv4 ä¸€æ ·ï¼ŒIPv6 ä¹Ÿä¸ä¿è¯æ•°æ®æŠ¥çš„å¯é äº¤ä»˜ï¼Œå› æ­¤ IPv6 ä¹Ÿéœ€è¦ä½¿ç”¨ ICMP æ¥åé¦ˆä¸€äº›å·®é”™ä¿¡æ¯ã€‚æ–°çš„ç‰ˆæœ¬ç§°ä¸º ICMPv6ï¼Œå®ƒæ¯” ICMPv4 è¦å¤æ‚å¾—å¤šã€‚<strong>åœ°å€è§£æžåè®® ARP å’Œç½‘é™…ç»„ç®¡ç†åè®® IGMP çš„åŠŸèƒ½éƒ½å·²è¢«åˆå¹¶åˆ° ICMPv6 ä¸­</strong>ã€‚ICMPv6 æ˜¯é¢å‘æŠ¥æ–‡çš„åè®®ï¼Œå®ƒåˆ©ç”¨æŠ¥æ–‡æ¥æŠ¥å‘Šå·®é”™ï¼ŒèŽ·å–ä¿¡æ¯ï¼ŒæŽ¢æµ‹é‚»ç«™æˆ–ç®¡ç†å¤šæ’­é€šä¿¡ã€‚</p><h1 id="ip-å¤šæ’­">IP å¤šæ’­</h1><p>ä¸Žå•æ’­ç›¸æ¯”ï¼Œåœ¨ä¸€å¯¹å¤šçš„é€šä¿¡ä¸­ï¼Œå¤šæ’­å¯å¤§å¤§èŠ‚çº¦ç½‘ç»œèµ„æºã€‚</p><p><img src="/uploads/image/computer-networking/ip-unicast-and-multicast.jpeg"></p><p>åœ¨äº’è”ç½‘èŒƒå›´çš„å¤šæ’­è¦é è·¯ç”±å™¨æ¥å®žçŽ°ï¼Œè¿™äº›è·¯ç”±å™¨å¿…é¡»å¢žåŠ ä¸€äº›èƒ½å¤Ÿè¯†åˆ«å¤šæ’­æ•°æ®æŠ¥çš„è½¯ä»¶ã€‚èƒ½å¤Ÿè¿è¡Œå¤šæ’­åè®®çš„è·¯ç”±å™¨ç§°ä¸º<strong>å¤šæ’­è·¯ç”±å™¨</strong>ï¼ˆmulticast routerï¼‰ã€‚</p><p>åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œå¤šæ’­å°±å«åš IP å¤šæ’­ã€‚IP å¤šæ’­æ‰€ä¼ é€çš„åˆ†ç»„éœ€è¦ä½¿ç”¨å¤šæ’­ IP åœ°å€ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªå¤šæ’­æ•°æ®æŠ¥çš„ç›®çš„åœ°å€ä¸€å®šä¸èƒ½å†™å…¥ä¸»æœºçš„ IP åœ°å€ã€‚è¿™æ˜¯å› ä¸ºåœ¨åŒä¸€æ—¶é—´å¯èƒ½æœ‰æˆåƒä¸Šä¸‡å°ä¸»æœºåŠ å…¥åˆ°åŒä¸€ä¸ªå¤šæ’­ç»„ã€‚å¤šæ’­æ•°æ®æŠ¥ä¸å¯èƒ½åœ¨å…¶é¦–éƒ¨å†™å…¥è¿™æ ·å¤šçš„ä¸»æœºçš„ IP åœ°å€ã€‚<strong>åœ¨å¤šæ’­æ•°æ®æŠ¥çš„ç›®çš„åœ°å€å†™å…¥çš„æ˜¯å¤šæ’­ç»„çš„æ ‡è¯†ç¬¦</strong>ï¼Œç„¶åŽè®¾æ³•è®©åŠ å…¥åˆ°è¿™ä¸ªå¤šæ’­ç»„çš„ä¸»æœºçš„ IP åœ°å€ä¸Žå¤šæ’­ç»„çš„æ ‡è¯†ç¬¦å…³è”èµ·æ¥ã€‚</p><p>å…¶å®žå¤šæ’­ç»„çš„æ ‡è¯†ç¬¦å°±æ˜¯ IP åœ°å€ä¸­çš„ D ç±»åœ°å€ï¼Œå‰å››ä½æ˜¯ 1110ï¼Œå› æ­¤èŒƒå›´æ˜¯ 224.0.0.0 åˆ° 239.255.255.255ã€‚è¿™æ ·ï¼ŒD ç±»åœ°å€å…±å¯æ ‡è¯† 2^28 ä¸ªå¤šæ’­ç»„ã€‚å¤šæ’­æ•°æ®æŠ¥ä¹Ÿæ˜¯â€œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜â€œï¼Œä¸ä¿è¯å¯é æ€§ã€‚å› æ­¤ï¼Œå¤šæ’­æ•°æ®æŠ¥å’Œä¸€èˆ¬çš„ IP æ•°æ®æŠ¥çš„åŒºåˆ«å°±æ˜¯å®ƒ<strong>ä½¿ç”¨ D ç±» IP åœ°å€ä½œä¸ºç›®çš„åœ°å€</strong>ï¼Œå¹¶ä¸”é¦–éƒ¨ä¸­çš„<strong>åè®®å€¼æ˜¯ 2ï¼Œè¡¨æ˜Žä½¿ç”¨ç½‘é™…ç»„ç®¡ç†åè®® IGMP</strong>ã€‚</p><p>æ˜¾ç„¶ï¼Œ<strong>å¤šæ’­åœ°å€åªèƒ½ç”¨äºŽç›®çš„åœ°å€ï¼Œè€Œä¸èƒ½ç”¨äºŽæºåœ°å€</strong>ã€‚æ­¤å¤–ï¼Œ<strong>å¯¹å¤šæ’­æ•°æ®æŠ¥ä¸äº§ç”Ÿ ICMP å·®é”™æŠ¥æ–‡</strong>ã€‚å› æ­¤ï¼Œè‹¥åœ¨ PING å‘½ä»¤åŽé¢é”®å…¥å¤šæ’­åœ°å€ï¼Œå°†æ°¸è¿œä¸ä¼šæ”¶åˆ°å“åº”ã€‚</p><p>IP å¤šæ’­å¯ä»¥åˆ†ä¸ºä¸¤ç§ã€‚ä¸€ç§æ˜¯åªåœ¨æœ¬åœ°å±€åŸŸç½‘ä¸Šè¿›è¡Œç¡¬ä»¶å¤šæ’­ï¼Œå¦ä¸€ç§åˆ™æ˜¯åœ¨äº’è”ç½‘çš„èŒƒå›´è¿›è¡Œå¤šæ’­ã€‚å‰ä¸€ç§è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†å¾ˆé‡è¦ï¼Œå› ä¸ºçŽ°åœ¨å¤§éƒ¨åˆ†ä¸»æœºéƒ½æ˜¯é€šè¿‡å±€åŸŸç½‘æŽ¥å…¥åˆ°äº’è”ç½‘çš„ã€‚åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œå¤šæ’­çš„æœ€åŽé˜¶æ®µï¼Œè¿˜æ˜¯è¦æŠŠå¤šæ’­æ•°æ®æŠ¥åœ¨å±€åŸŸç½‘ä¸Šç”¨ç¡¬ä»¶å¤šæ’­äº¤ä»˜å¤šæ’­ç»„çš„æ‰€æœ‰æˆå‘˜ã€‚</p><h2 id="ç¡¬ä»¶å¤šæ’­">ç¡¬ä»¶å¤šæ’­</h2><p>ä»¥å¤ªç½‘åœ°å€å—çš„é«˜ 24 ä½ä¸º <code>00-00-5E</code>ï¼Œå› æ­¤ TCP/IP åè®®ä½¿ç”¨çš„ä»¥å¤ªç½‘å¤šæ’­åœ°å€å—çš„èŒƒå›´æ˜¯ä»Ž <code>00-00-5E-00-00-00</code> åˆ° <code>00-00-5E-FF-FF-FF</code>ã€‚<strong>ä»¥å¤ªç½‘ç¡¬ä»¶åœ°å€å­—æ®µä¸­çš„ç¬¬ 1 å­—èŠ‚çš„æœ€ä½Žä½ä¸º 1 æ—¶å³ä¸ºå¤šæ’­åœ°å€</strong>ã€‚å› æ­¤ï¼Œä»¥å¤ªç½‘å¤šæ’­åœ°å€çš„èŒƒå›´æ˜¯ä»Ž <code>01-00-5E-00-00-00</code> åˆ° <code>01-00-5E-7F-FF-FF</code>ï¼ˆç¬¬ 25 ä½çš„ 0 å“ªæ¥çš„ï¼Ÿï¼‰ã€‚</p><p><img src="/uploads/image/computer-networking/ip-hardware-multicast.jpeg"></p><p>åœ¨æ¯ä¸€ä¸ªåœ°å€ä¸­ï¼Œåªæœ‰ 23 ä½å¯ç”¨ä½œå¤šæ’­ï¼Œè¿™åªèƒ½å’Œ D ç±» IP åœ°å€ä¸­çš„ 23 ä½æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚D ç±» IP åœ°å€å¯ä¾›åˆ†é…çš„æœ‰ 28 ä½ï¼Œå¯è§å‰ 5 ä½ä¸èƒ½ç”¨æ¥æž„æˆä»¥å¤ªç½‘ç¡¬ä»¶åœ°å€ã€‚ä¾‹å¦‚ï¼ŒIP å¤šæ’­åœ°å€ 224.128.64.32ï¼ˆå³ <code>E0-80-40-20</code>ï¼‰å’Œ 224.0.64.32ï¼ˆå³ <code>E0-00-40-20</code>ï¼‰è½¬æ¢æˆä»¥å¤ªç½‘çš„ç¡¬ä»¶å¤šæ’­åœ°å€éƒ½æ˜¯ <code>01-00-5E-00-40-20</code>ã€‚ç”±äºŽå¤šæ’­ IP åœ°å€ä¸Žä»¥å¤ªç½‘ç¡¬ä»¶åœ°å€çš„æ˜ å°„å…³ç³»ä¸æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤æ”¶åˆ°å¤šæ’­æ•°æ®æŠ¥çš„ä¸»æœºï¼Œè¿˜è¦åœ¨ IP å±‚åˆ©ç”¨è½¯ä»¶è¿›è¡Œè¿‡æ»¤ï¼ŒæŠŠä¸æ˜¯æœ¬ä¸»æœºè¦æŽ¥æ”¶çš„æ•°æ®æŠ¥ä¸¢å¼ƒã€‚</p><h2 id="ç½‘é™…ç»„ç®¡ç†åè®®-igmp">ç½‘é™…ç»„ç®¡ç†åè®® IGMP</h2><p>ç½‘é™…ç»„ç®¡ç†åè®® IGMP å¹¶éžæ˜¯åœ¨äº’è”ç½‘èŒƒå›´å†…å¯¹æ‰€æœ‰å¤šæ’­ç»„æˆå‘˜è¿›è¡Œç®¡ç†çš„åè®®ã€‚IGMP ä¸çŸ¥é“ IP å¤šæ’­ç»„åŒ…å«çš„æˆå‘˜æ•°ï¼Œä¹Ÿä¸çŸ¥é“è¿™äº›æˆå‘˜éƒ½åˆ†å¸ƒåœ¨å“ªäº›ç½‘ç»œä¸Šï¼Œç­‰ç­‰ã€‚IGMP åè®®æ˜¯è®©<strong>è¿žæŽ¥åœ¨æœ¬åœ°å±€åŸŸç½‘</strong>ä¸Šçš„å¤šæ’­è·¯ç”±å™¨çŸ¥é“<strong>æœ¬å±€åŸŸç½‘ä¸Š</strong>æ˜¯å¦æœ‰ä¸»æœºï¼ˆä¸¥æ ¼æ¥è®²ï¼Œæ˜¯ä¸»æœºä¸Šçš„æŸä¸ªè¿›ç¨‹ï¼‰å‚åŠ æˆ–é€€å‡ºäº†æŸä¸ªå¤šæ’­ç»„ã€‚æ‰€ä»¥ï¼ŒIGMP çš„ä½¿ç”¨èŒƒå›´æ˜¯æœ¬åœ°å±€åŸŸç½‘ã€‚</p><p>ä»…æœ‰ IGMP åè®®æ˜¯ä¸èƒ½å®Œæˆå¤šæ’­ä»»åŠ¡çš„ã€‚è¿žæŽ¥åœ¨å±€åŸŸç½‘ä¸Šçš„å¤šæ’­è·¯ç”±å™¨è¿˜å¿…é¡»å’Œäº’è”ç½‘ä¸Šçš„å…¶ä»–å¤šæ’­è·¯ç”±å™¨ååŒå·¥ä½œï¼Œä»¥ä¾¿æŠŠå¤šæ’­æ•°æ®æŠ¥ç”¨æœ€å°ä»£ä»·ä¼ é€ç»™æ‰€æœ‰çš„ç»„æˆå‘˜ã€‚è¿™å°±éœ€è¦ä½¿ç”¨<strong>å¤šæ’­è·¯ç”±é€‰æ‹©åè®®</strong>ã€‚ç„¶è€Œå¤šæ’­è·¯ç”±é€‰æ‹©åè®®è¦æ¯”å•æ’­è·¯ç”±é€‰æ‹©åè®®å¤æ‚çš„å¤šã€‚</p><ul><li>å¤šæ’­è½¬å‘å¿…é¡»åŠ¨æ€åœ°é€‚åº”å¤šæ’­ç»„æˆå‘˜çš„å˜åŒ–ï¼ˆè¿™æ—¶ç½‘ç»œæ‹“æ‰‘å¹¶æœªå‘ç”Ÿå˜åŒ–ï¼‰ã€‚å•æ’­è·¯ç”±é€‰æ‹©é€šå¸¸æ˜¯åœ¨ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–æ—¶æ‰éœ€è¦æ›´æ–°è·¯ç”±ã€‚</li><li>å¤šæ’­è·¯ç”±å™¨åœ¨è½¬å‘å¤šæ’­æ•°æ®æŠ¥æ—¶ï¼Œä¸èƒ½ä»…ä»…æ ¹æ®å¤šæ’­æ•°æ®æŠ¥ä¸­çš„ç›®çš„åœ°å€ï¼Œè¿˜è¦è€ƒè™‘è¿™ä¸ªå¤šæ’­æ•°æ®æŠ¥ä»Žä»€ä¹ˆåœ°æ–¹æ¥å’Œè¦åˆ°ä»€ä¹ˆåœ°æ–¹åŽ»ã€‚åŽŸå› æ˜¯ï¼Œæ²¡æœ‰åŠ å…¥å¤šæ’­ç»„çš„ä¸»æœºã€åŠ å…¥å¤šæ’­ç»„ A çš„ä¸»æœºã€åŠ å…¥å¤šæ’­ç»„ B çš„ä¸»æœº<strong>éƒ½å¯ä»¥</strong>å‘å¤šæ’­ç»„ B å‘é€å¤šæ’­æ•°æ®æŠ¥ã€‚</li><li>å¤šæ’­æ•°æ®æŠ¥å¯ä»¥ç”±æ²¡æœ‰åŠ å…¥å¤šæ’­ç»„çš„ä¸»æœºå‘å‡ºï¼ˆåŒä¸Šï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ²¡æœ‰ç»„æˆå‘˜æŽ¥å…¥çš„ç½‘ç»œï¼ˆä¾‹å¦‚ï¼Œä¸¤ä¸ªç½‘è·¯è·ç¦»å¾ˆè¿œï¼Œå¿…é¡»é€šè¿‡ä¸­é—´ç½‘ç»œè½¬å‘ï¼‰ã€‚</li></ul><p>å’Œ ICMP ç›¸ä¼¼ï¼ŒIGMP ä½¿ç”¨ IP æ•°æ®æŠ¥ä¼ é€’å…¶æŠ¥æ–‡ï¼Œä½†å®ƒä¹Ÿå‘ IP æä¾›æœåŠ¡ã€‚</p><p>IGMP çš„å·¥ä½œå¯åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µã€‚</p><ol type="1"><li>å½“æŸå°ä¸»æœºåŠ å…¥æ–°çš„å¤šæ’­ç»„æ—¶ï¼Œè¯¥ä¸»æœºåº”å‘å¤šæ’­ç»„çš„å¤šæ’­åœ°å€å‘é€ä¸€ä¸ª IGMP æŠ¥æ–‡ï¼Œå£°æ˜Žè‡ªå·±è¦æˆä¸ºæ”¹ç»„çš„æˆå‘˜ã€‚æœ¬åœ°çš„å¤šæ’­è·¯ç”±å™¨æ”¶åˆ° IGMP æŠ¥æ–‡åŽï¼Œè¿˜è¦åˆ©ç”¨å¤šæ’­è·¯ç”±é€‰æ‹©åè®®æŠŠè¿™ç§ç»„æˆå‘˜å…³ç³»è½¬å‘ç»™äº’è”ç½‘ä¸Šçš„å…¶ä»–å¤šæ’­è·¯ç”±å™¨ã€‚</li><li>ç»„æˆå‘˜å…³ç³»æ˜¯åŠ¨æ€çš„ã€‚æœ¬åœ°å¤šæ’­è·¯ç”±å™¨è¦å‘¨æœŸæ€§åœ°æŽ¢è¯¢æœ¬åœ°å±€åŸŸç½‘ä¸Šçš„ä¸»æœºï¼Œä»¥ä¾¿çŸ¥é“è¿™äº›ä¸»æœºæ˜¯å¦è¿˜ç»§ç»­æ˜¯ç»„çš„æˆå‘˜ã€‚åªè¦æœ‰ä¸€å°ä¸»æœºå¯¹æŸä¸ªç»„å“åº”ï¼Œé‚£ä¹ˆå¤šæ’­è·¯ç”±å™¨å°±è®¤ä¸ºè¿™ä¸ªç»„æ˜¯æ´»è·ƒçš„ã€‚ä½†ä¸€ä¸ªç»„åœ¨ç»è¿‡å‡ æ¬¡çš„æŽ¢è¯¢åŽä»ç„¶æ²¡æœ‰ä¸€å°ä¸»æœºå“åº”ï¼Œå¤šæ’­è·¯ç”±å™¨å°±è®¤ä¸ºæœ¬ç½‘ç»œä¸Šçš„ä¸»æœºå·²ç»ç¦»å¼€äº†è¿™ä¸ªç»„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å†æŠŠè¿™ä¸ªç»„çš„æˆå‘˜å…³ç³»è½¬å‘ç»™å…¶ä»–çš„å¤šæ’­è·¯ç”±å™¨ã€‚</li></ol><p>IGMP è®¾è®¡å¾—å¾ˆä»”ç»†ï¼Œé¿å…äº†å¤šæ’­æŽ§åˆ¶ä¿¡æ¯ç»™ç½‘ç»œå¢žåŠ å¤§é‡çš„å¼€é”€ã€‚IGMP é‡‡ç”¨çš„ä¸€äº›å…·ä½“æŽªæ–½å¦‚ä¸‹ï¼š</p><ul><li>åœ¨ä¸»æœºå’Œå¤šæ’­è·¯ç”±å™¨ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡éƒ½æ˜¯ä½¿ç”¨ IP å¤šæ’­ã€‚åªè¦æœ‰å¯èƒ½ï¼Œæºå¸¦ IGMP æŠ¥æ–‡çš„æ•°æ®æŠ¥éƒ½ç”¨ç¡¬ä»¶å¤šæ’­æ¥ä¼ é€ã€‚</li><li>å¤šæ’­è·¯ç”±å™¨åœ¨æŽ¢è¯¢ç»„æˆå‘˜å…³ç³»æ—¶ï¼Œåªéœ€è¦å¯¹æ‰€æœ‰çš„ç»„å‘é€ä¸€ä¸ªè¯·æ±‚ä¿¡æ¯çš„è¯¢é—®æŠ¥æ–‡ï¼Œè€Œä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªç»„å‘é€ä¸€ä¸ªè¯¢é—®æŠ¥æ–‡ã€‚é»˜è®¤çš„è¯¢é—®é€ŸçŽ‡æ˜¯æ¯ 125 ç§’ä¸€æ¬¡ã€‚</li><li>å½“åŒä¸€ä¸ªç½‘ç»œä¸Šè¿žæŽ¥æœ‰å‡ ä¸ªå¤šæ’­è·¯ç”±å™¨æ—¶ï¼Œå®ƒä»¬èƒ½å¤Ÿè¿…é€Ÿå’Œæœ‰æ•ˆåœ°é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªæ¥æŽ¢è¯¢ä¸»æœºçš„æˆå‘˜å…³ç³»ã€‚</li><li>åœ¨ IGMP çš„è¯¢é—®æŠ¥æ–‡ä¸­æœ‰ä¸€ä¸ªæ•°å€¼ Nï¼Œå®ƒæŒ‡æ˜Žä¸€ä¸ªæœ€é•¿å“åº”æ—¶é—´ï¼ˆé»˜è®¤ 10 ç§’ï¼‰ã€‚å½“æ”¶åˆ°è¯¢é—®æ—¶ï¼Œä¸»æœºåœ¨ 0 åˆ° N ä¹‹é—´éšæœºé€‰æ‹©å‘é€å“åº”æ‰€éœ€ç»è¿‡çš„æ—¶å»¶ã€‚è‹¥ä¸€å°ä¸»æœºåŒæ—¶å‚åŠ äº†å‡ ä¸ªå¤šæ’­ç»„ï¼Œåˆ™ä¸»æœºå¯¹æ¯ä¸€ä¸ªå¤šæ’­ç»„é€‰æ‹©ä¸åŒçš„éšæœºæ•°ã€‚å¯¹åº”äºŽæœ€å°æ—¶å»¶çš„å“åº”æœ€å…ˆå‘é€ã€‚</li><li>åŒä¸€ä¸ªç»„å†…çš„æ¯ä¸€å°ä¸»æœºéƒ½è¦ç›‘å¬å“åº”ï¼ˆå“åº”æ˜¯ IP å¤šæ’­å‘é€çš„ï¼Œå› æ­¤åŒä¸€ä¸ªç»„å†…çš„æ‰€æœ‰æˆå‘˜éƒ½èƒ½æ”¶åˆ°ï¼‰ï¼Œåªè¦æœ‰æœ¬ç»„çš„å…¶ä»–ä¸»æœºå…ˆå‘é€äº†å“åº”ï¼Œè‡ªå·±å°±å¯ä»¥ä¸å†å‘é€å“åº”äº†ã€‚è¿™æ ·å°±æŠ‘åˆ¶äº†ä¸å¿…è¦çš„é€šä¿¡é‡ã€‚</li></ul><p>å¤šæ’­è·¯ç”±å™¨å¹¶ä¸éœ€è¦ä¿ç•™ç»„æˆå‘˜å…³ç³»çš„å‡†ç¡®è®°å½•ï¼Œå› ä¸ºå‘å±€åŸŸç½‘ä¸Šçš„ç»„æˆå‘˜è½¬å‘æ•°æ®æŠ¥æ˜¯ä½¿ç”¨ç¡¬ä»¶å¤šæ’­ã€‚å¤šæ’­è·¯ç”±å™¨åªéœ€è¦çŸ¥é“ç½‘ç»œä¸Šæ˜¯å¦æœ‰ä¸»æœºæ˜¯æœ¬ç»„æˆå‘˜å³å¯ã€‚</p><p>å¦‚æžœä¸€å°ä¸»æœºä¸Šæœ‰å¤šä¸ªè¿›ç¨‹éƒ½åŠ å…¥äº†æŸä¸ªå¤šæ’­ï¼Œé‚£ä¹ˆè¿™å°ä¸»æœºå¯¹å‘ç»™è¿™ä¸ªå¤šæ’­ç»„çš„æ¯ä¸ªå¤šæ’­æ•°æ®æŠ¥åªæŽ¥æ”¶ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åŽç»™ä¸»æœºä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªæœ¬åœ°å¤åˆ¶çš„å‰¯æœ¬ã€‚</p><p>æœ€åŽå¼ºè°ƒï¼Œå¤šæ’­æ•°æ®æŠ¥çš„å‘é€è€…å’ŒæŽ¥æ”¶è€…éƒ½ä¸çŸ¥é“ï¼ˆä¹Ÿæ— æ³•æ‰¾å‡ºï¼‰ä¸€ä¸ªå¤šæ’­ç»„çš„æˆå‘˜æœ‰å¤šå°‘ï¼Œä»¥åŠè¿™äº›æˆå‘˜æ˜¯å“ªäº›ä¸»æœºã€‚ä»»ä½•åº”ç”¨è¿›ç¨‹éƒ½å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å‘ä»»ä½•ä¸€ä¸ªå¤šæ’­ç»„å‘é€å¤šæ’­æ•°æ®æŠ¥ï¼Œè€Œå¹¶ä¸éœ€è¦åŠ å…¥è¿™ä¸ªå¤šæ’­ç»„ã€‚</p><h2 id="å¤šæ’­è·¯ç”±é€‰æ‹©åè®®">å¤šæ’­è·¯ç”±é€‰æ‹©åè®®</h2><p>å¤šæ’­åè®®å·²æˆä¸ºå»ºè®®æ ‡å‡†ï¼Œä½†å¤šæ’­è·¯ç”±é€‰æ‹©åè®®å°šæœªæ ‡å‡†åŒ–ã€‚</p><p>å¤šæ’­è·¯ç”±é€‰æ‹©å®žé™…ä¸Šå°±æ˜¯è¦æ‰¾å‡ºä»¥æºä¸»æœºä¸ºæ ¹èŠ‚ç‚¹çš„<strong>å¤šæ’­è½¬å‘æ ‘</strong>ã€‚å¯¹ä¸åŒçš„å¤šæ’­ç»„å¯¹åº”äºŽä¸åŒçš„å¤šæ’­è½¬å‘æ ‘ã€‚åŒä¸€ä¸ªå¤šæ’­ç»„ï¼Œå¯¹ä¸åŒçš„æºç‚¹ä¹Ÿä¼šæœ‰ä¸åŒçš„å¤šæ’­è½¬å‘æ ‘ã€‚</p><p>å·²æœ‰äº†å¤šç§å®žç”¨çš„å¤šæ’­è·¯ç”±é€‰æ‹©åè®®ï¼Œå®ƒä»¬åœ¨è½¬å‘å¤šæ’­æ•°æ®æŠ¥æ—¶ä½¿ç”¨äº†ä»¥ä¸‹çš„ä¸‰ç§æ–¹æ³•ï¼š</p><ol type="1"><li><p><strong>æ´ªæ³›ä¸Žå‰ªé™¤</strong>ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºŽè¾ƒå°çš„å¤šæ’­ç»„ï¼Œè€Œæ‰€æœ‰çš„ç»„æˆå‘˜æŽ¥å…¥çš„å±€åŸŸç½‘ä¹Ÿæ˜¯ç›¸é‚»çš„ã€‚</p><p>ä¸€å¼€å§‹ï¼Œè·¯ç”±è½¬å‘å¤šæ’­æ•°æ®æŠ¥ä½¿ç”¨æ´ªæ³›çš„æ–¹æ³•ï¼ˆå¹¿æ’­ï¼‰ã€‚ä¸ºäº†é¿å…å…œåœˆå­ï¼Œé‡‡ç”¨äº†<strong>åå‘è·¯å¾„å¹¿æ’­</strong> RPBï¼ˆReverse Path Broadcastingï¼‰çš„ç­–ç•¥ã€‚RPB çš„è¦ç‚¹æ˜¯ï¼šæ¯ä¸€ä¸ªè·¯ç”±å™¨åœ¨æ”¶åˆ°ä¸€ä¸ªå¤šæ’­æ•°æ®æŠ¥æ—¶ï¼Œå…ˆæ£€æŸ¥æ•°æ®æŠ¥æ˜¯å¦æ˜¯ä»Žæºç‚¹ç»æœ€çŸ­è·¯å¾„ä¼ é€æ¥çš„ã€‚è¿›è¡Œè¿™ç§æ£€æŸ¥å¾ˆå®¹æ˜“ï¼Œåªè¦å¯»æ‰¾ä»Žæœ¬è·¯ç”±å™¨åˆ°æºç‚¹çš„æœ€çŸ­è·¯å¾„ï¼ˆåå‘è·¯å¾„ï¼‰ä¸Šçš„ç¬¬ä¸€ä¸ªè·¯ç”±å™¨ã€‚è‹¥æ˜¯åˆšæ‰æŠŠå¤šæ’­æ•°æ®æŠ¥é€æ¥çš„è·¯ç”±å™¨ï¼Œå°±å‘æ‰€æœ‰å…¶ä»–æ–¹å‘è½¬å‘æ”¶åˆ°çš„å¤šæ’­æ•°æ®æŠ¥ã€‚è‹¥ä¸æ˜¯ï¼Œå°±ä¸¢å¼ƒã€‚å¦‚æžœæœ‰å¥½å‡ ä¸ªç›¸é‚»è·¯ç”±å™¨éƒ½å¤„åœ¨æœ€çŸ­è·¯å¾„ä¸Šï¼Œé‚£ä¹ˆåªèƒ½é€‰æ‹©ä¸€æ¡æœ€çŸ­è·¯å¾„ï¼Œé€‰æ‹©çš„å‡†åˆ™æ˜¯çœ‹è°çš„ IP æœ€å°ã€‚</p><p>å¦‚æžœåœ¨å¤šæ’­è½¬å‘æ ‘ä¸Šçš„æŸä¸ªè·¯ç”±å™¨å‘çŽ°å®ƒçš„ä¸‹æ¸¸æ ‘æžå·²æ²¡æœ‰è¯¥å¤šæ’­ç»„çš„æˆå‘˜ï¼Œå°±åº”æŠŠå®ƒå’Œä¸‹æ¸¸çš„æ ‘æžä¸€èµ·å‰ªé™¤ã€‚å½“æŸä¸ªæ ‘æžæœ‰æ–°å¢žåŠ çš„ç»„æˆå‘˜æ—¶ï¼Œå¯ä»¥å†æŽ¥å…¥åˆ°å¤šæ’­è½¬å‘æ ‘ä¸Šã€‚</p><p><img src="/uploads/image/computer-networking/ip-multicast-rpb.jpeg"></p></li><li><p><strong>éš§é“æŠ€æœ¯</strong>ï¼ˆtunnelingï¼‰ã€‚éš§é“æŠ€æœ¯é€‚ç”¨äºŽå¤šæ’­ç»„çš„ä½ç½®åœ¨åœ°ç†ä¸Šå¾ˆåˆ†æ•£çš„æƒ…å†µã€‚</p><p>è·¯ç”±å™¨å¯¹å¤šæ’­æ•°æ®æŠ¥è¿›è¡Œå†æ¬¡å°è£…ï¼Œå³åŠ ä¸Šæ™®é€šæ•°æ®æŠ¥çš„é¦–éƒ¨ï¼Œä½¿ä¹‹æˆä¸ºå‘å•ä¸€ç›®çš„ç«™å‘é€çš„å•æ’­ï¼ˆunicastï¼‰æ•°æ®æŠ¥ï¼Œç„¶åŽé€šè¿‡éš§é“å‘é€ã€‚</p><p>å•æ’­æ•°æ®æŠ¥åˆ°è¾¾ç›®çš„ç«™çš„è·¯ç”±å™¨åŽï¼Œå†å‰¥åŽ»é¦–éƒ¨ï¼Œæ¢å¤æˆåŽŸæ¥çš„æ•°æ®æŠ¥ï¼Œç»§ç»­å‘å¤šä¸ªç›®çš„ç«™è½¬å‘ã€‚</p><p><img src="/uploads/image/computer-networking/ip-multicast-tunneling.jpeg"></p></li><li><p><strong>åŸºäºŽæ ¸å¿ƒçš„å‘çŽ°æŠ€æœ¯</strong>ã€‚è¿™ç§æ–¹æ³•å¯¹äºŽå¤šæ’­ç»„çš„å¤§å°åœ¨è¾ƒå¤§èŒƒå›´å†…å˜åŒ–æ—¶éƒ½åˆé€‚ã€‚è¿™ç§æ–¹æ³•å¯¹æ¯ä¸€ä¸ªå¤šæ’­ç»„ G æŒ‡å®šä¸€ä¸ªæ ¸å¿ƒè·¯ç”±å™¨ï¼Œç»™å‡ºå®ƒçš„ IP å•æ’­åœ°å€ã€‚æ ¸å¿ƒè·¯ç”±å™¨åˆ›å»ºå‡ºå¯¹åº”äºŽå¤šæ’­ç»„ G çš„è½¬å‘æ ‘ã€‚å¦‚æžœæœ‰ä¸€ä¸ªè·¯ç”±å™¨ R1 å‘æ ¸å¿ƒè·¯ç”±å™¨ R2 å‘é€æ•°æ®æŠ¥ï¼Œè‹¥å‘é€çš„æ˜¯å¤šæ’­æ•°æ®æŠ¥ä¸”ç›®çš„åœ°å€æ˜¯ Gï¼Œåˆ™ R2 å°±è½¬å‘è¿™ä¸ªæ•°æ®æŠ¥ã€‚è‹¥å‘é€çš„æ˜¯è¯·æ±‚åŠ å…¥ G çš„æ•°æ®æŠ¥ï¼ŒR2 å°±æŠŠè¿™ä¸ªä¿¡æ¯åŠ åˆ°å®ƒçš„è·¯ç”±ä¸­ï¼Œå¹¶ç”¨éš§é“æŠ€æœ¯å‘ R1 è½¬å‘æ¯ä¸€ä¸ªå¤šæ’­æ•°æ®æŠ¥çš„å‰¯æœ¬ã€‚è¿™æ ·ï¼Œå‚åŠ åˆ°å¤šæ’­ç»„ G çš„è·¯ç”±å™¨å°±ä»Žæ ¸å¿ƒå‘å¤–å¢žå¤šäº†ï¼Œæ‰©å¤§äº†å¤šæ’­è½¬å‘æ ‘çš„è¦†ç›–èŒƒå›´ã€‚</p></li></ol><h1 id="vpn-å’Œ-nat">VPN å’Œ NAT</h1><h2 id="è™šæ‹Ÿä¸“ç”¨ç½‘-vpn">è™šæ‹Ÿä¸“ç”¨ç½‘ VPN</h2><p>å‡å®šåœ¨ä¸€ä¸ªæœºæž„å†…éƒ¨çš„è®¡ç®—æœºé€šä¿¡ä¹Ÿæ˜¯é‡‡ç”¨ TCP/IP åè®®ï¼Œé‚£ä¹ˆä»ŽåŽŸåˆ™ä¸Šè®²ï¼Œå¯¹äºŽè¿™äº›è®¡ç®—æœºå¯ä»¥ç”±è¯¥æœºæž„è‡ªè¡Œåˆ†é… IP åœ°å€ã€‚è®©è¿™äº›è®¡ç®—æœºä»…åœ¨æœ¬åœ°ä½¿ç”¨çš„æœ‰æ•ˆçš„ IP åœ°å€ç§°ä¸º<strong>æœ¬åœ°åœ°å€</strong>ï¼Œè€Œå‘äº’è”ç½‘çš„ç®¡ç†æœºæž„ç”³è¯·çš„å…¨çƒå”¯ä¸€çš„ IP åœ°å€ç§°ä¸º<strong>å…¨çƒåœ°å€</strong>ã€‚</p><p>ä½¿ç”¨æœ¬åœ°åœ°å€å¯ä»¥å¤§å¤§èŠ‚çº¦å®è´µçš„ IP åœ°å€èµ„æºã€‚ä½†æ˜¯ï¼Œå¦‚æžœä»»æ„é€‰æ‹©ä¸€äº› IP åœ°å€ä½œä¸ºæœ¬åœ°åœ°å€ï¼Œé‚£ä¹ˆåœ¨æŸç§æƒ…å†µä¸‹å¯èƒ½ä¼šå¼•èµ·ä¸€äº›éº»çƒ¦ã€‚ä¾‹å¦‚ï¼Œæœ‰æ—¶æœºæž„å†…éƒ¨çš„æŸå°ä¸»æœºéœ€è¦å’Œäº’è”ç½‘è¿žæŽ¥ï¼Œé‚£ä¹ˆè¿™ç§ä»…åœ¨å†…éƒ¨ä½¿ç”¨çš„æœ¬åœ°åœ°å€å°±æœ‰å¯èƒ½å’Œäº’è”ç½‘ä¸­æŸä¸ª IP åœ°å€é‡åˆã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒRFC 1918 æŒ‡æ˜Žäº†ä¸€äº›<strong>ä¸“ç”¨åœ°å€</strong>ï¼ˆprivate addressï¼‰ã€‚è¿™äº›åœ°å€åªèƒ½ç”¨äºŽä¸€ä¸ªæœºæž„çš„å†…éƒ¨é€šä¿¡ï¼Œè€Œä¸èƒ½ç”¨äºŽå’Œäº’è”ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡ã€‚åœ¨äº’è”ç½‘ä¸­çš„æ‰€æœ‰è·¯ç”±å™¨ï¼Œå¯¹ç›®çš„åœ°å€æ˜¯ä¸“ç”¨åœ°å€çš„æ•°æ®æŠ¥ä¸€å¾‹ä¸è¿›è¡Œè½¬å‘ã€‚</p><p>ä¸‰ä¸ªä¸“ç”¨åœ°å€å—åˆ†åˆ«æ˜¯ï¼š</p><ol type="1"><li>10.0.0.0 åˆ° 10.255.255.255 ï¼ˆæˆ–è®°ä¸º 10.0.0.0/8ï¼Œåˆç§°ä¸º 24 ä½å—ï¼Œç›¸å½“äºŽ 1 ä¸ª A ç±»ç½‘ç»œï¼‰</li><li>172.16.0.0 åˆ° 172.31.255.255ï¼ˆæˆ–è®°ä¸º 172.16.0.0/12ï¼Œåˆç§°ä¸º 20 ä½å—ï¼Œç›¸å½“äºŽ 16 ä¸ª B ç±»ç½‘ç»œï¼‰</li><li>192.168.0.0 åˆ° 192.168.255.255 ï¼ˆæˆ–è®°ä¸º 192.168.0.0/16ï¼Œåˆç§°ä¸º 16 ä½å—ï¼Œç›¸å½“äºŽ 256 ä¸ª C ç±»ç½‘ç»œï¼‰</li></ol><p>é‡‡ç”¨è¿™æ ·çš„ä¸“ç”¨ IP åœ°å€çš„äº’è”ç½‘ç»œç§°ä¸ºä¸“ç”¨äº’è”ç½‘æˆ–æœ¬åœ°äº’è”ç½‘ï¼Œç®€ç§°<strong>ä¸“ç”¨ç½‘</strong>ã€‚ä¸“ç”¨åœ°å€ä¹Ÿå«åš<strong>å¯é‡ç”¨åœ°å€</strong>ï¼ˆreusable addressï¼‰ã€‚</p><p>æœ‰æ—¶ä¸€ä¸ªå¾ˆå¤§çš„æœºæž„çš„è®¸å¤šéƒ¨é—¨åˆ†å¸ƒçš„èŒƒå›´å¾ˆå¹¿ï¼Œè¿™äº›éƒ¨åˆ†ç»å¸¸è¦äº’ç›¸äº¤æ¢ä¿¡æ¯ã€‚è¿™å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•ã€‚ï¼ˆ1ï¼‰ç§Ÿç”¨ç”µä¿¡å…¬å¸çš„é€šä¿¡çº¿è·¯ã€‚ç®€å•æ–¹ä¾¿ä½†ä»·æ ¼æ˜‚è´µã€‚ï¼ˆ2ï¼‰åˆ©ç”¨äº’è”ç½‘ä½œä¸ºæœ¬æœºæž„å„ä¸“ç”¨ç½‘ä¹‹é—´çš„é€šä¿¡è½½ä½“ï¼ˆåˆ©ç”¨ IP éš§é“æŠ€æœ¯ï¼‰ï¼Œè¿™æ ·çš„ä¸“ç”¨ç½‘åˆç§°ä¸º<strong>è™šæ‹Ÿä¸“ç”¨ç½‘</strong> VPNï¼ˆVirtual Private Networkï¼‰ã€‚è™šæ‹Ÿè¡¨ç¤ºâ€œå¥½åƒæ˜¯â€ï¼ŒVPN åªæ˜¯åœ¨æ•ˆæžœä¸Šå’ŒçœŸæ­£çš„ä¸“ç”¨ç½‘ä¸€æ ·ã€‚ä¸€ä¸ªæœºæž„è¦æž„å»ºè‡ªå·±çš„ VPN å°±å¿…é¡»ä¸ºå®ƒçš„æ¯ä¸€ä¸ªåœºæ‰€è´­ä¹°ä¸“é—¨çš„ç¡¬ä»¶å’Œè½¯ä»¶ï¼Œå¹¶è¿›è¡Œé…ç½®ï¼Œä½¿æ¯ä¸€ä¸ªåœºæ‰€çš„ VPN ç³»ç»Ÿéƒ½çŸ¥é“å…¶ä»–åœºæ‰€çš„åœ°å€ã€‚</p><p><img src="/uploads/image/computer-networking/ip-vpn.jpeg"></p><h2 id="ç½‘ç»œåœ°å€è½¬æ¢-nat">ç½‘ç»œåœ°å€è½¬æ¢ NAT</h2><p>ä¸‹é¢è®¨è®ºå¦ä¸€ç§æƒ…å†µï¼Œä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸€äº›ä¸»æœºæƒ³å’Œäº’è”ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡ã€‚</p><p>æœ€ç®€å•çš„åŠžæ³•å°±æ˜¯è®¾æ³•å†ç”³è¯·ä¸€äº›å…¨çƒ IP åœ°å€ã€‚ä½†è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯å¾ˆä¸å®¹æ˜“åšåˆ°çš„ã€‚ç›®å‰é‡‡ç”¨å¾—æœ€å¤šçš„æ–¹æ³•æ˜¯<strong>ç½‘ç»œåœ°å€è½¬æ¢</strong> NATï¼ˆNetwork Address Translationï¼‰ã€‚</p><p>è¿™ç§æ–¹æ³•éœ€è¦åœ¨ä¸“ç”¨ç½‘ç»œè¿žæŽ¥åˆ°äº’è”ç½‘çš„è·¯ç”±å™¨ä¸Šå®‰è£… NAT è½¯ä»¶ã€‚è£…æœ‰ NAT è½¯ä»¶çš„è·¯ç”±å™¨å«åš NAT è·¯ç”±å™¨ï¼Œå®ƒè‡³å°‘æœ‰ä¸€ä¸ªï¼ˆä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼‰æœ‰æ•ˆçš„å…¨çƒ IP åœ°å€ã€‚æ‰€æœ‰ä½¿ç”¨æœ¬åœ°åœ°å€çš„ä¸»æœºåœ¨å’Œå¤–ç•Œé€šä¿¡æ—¶ï¼Œéƒ½è¦åœ¨ NAT è·¯ç”±å™¨ä¸Šå°†å…¶æœ¬åœ°åœ°å€è½¬æ¢æˆå…¨çƒ IP åœ°å€ã€‚å½“ NAT è·¯ç”±å™¨å…·æœ‰ n ä¸ªå…¨çƒ IP åœ°å€æ—¶ï¼Œä¸“ç”¨ç½‘å†…éƒ¨æœ€å¤šå¯ä»¥åŒæ—¶æœ‰ n å°ä¸»æœºæŽ¥å…¥åˆ°äº’è”ç½‘ã€‚ä¸“ç”¨ç½‘å†…è¾ƒå¤šæ•°é‡çš„ä¸»æœºï¼Œå¯ä»¥è½®æµä½¿ç”¨ n ä¸ªå…¨çƒ IP åœ°å€ã€‚</p><p><img src="/uploads/image/computer-networking/ip-nat.jpeg"></p><p>æ˜¾ç„¶ï¼Œé€šè¿‡ NAT è·¯ç”±å™¨çš„é€šä¿¡å¿…é¡»ç”±ä¸“ç”¨ç½‘å†…çš„ä¸»æœºå‘èµ·ï¼ˆå› ä¸ºå†…éƒ¨ä¸»æœºæ²¡æœ‰å…¨çƒ IP åœ°å€ï¼Œè€Œè·¯ç”±å™¨ä¸è½¬å‘ç›®çš„åœ°å€ä¸ºæœ¬åœ°åœ°å€çš„æ•°æ®æŠ¥ï¼‰ã€‚å› æ­¤ï¼Œè¿™ç§ä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸»æœºä¸èƒ½å……å½“æœåŠ¡å™¨ç”¨ã€‚</p><p>ä¸ºäº†æ›´åŠ æœ‰æ•ˆåœ°åˆ©ç”¨ NAT è·¯ç”±å™¨ä¸Šçš„å…¨çƒ IP åœ°å€ï¼ŒçŽ°åœ¨å¸¸ç”¨çš„ NAT è½¬æ¢è¡¨æŠŠè¿è¾“å±‚çš„ç«¯å£å·ä¹Ÿåˆ©ç”¨ä¸Šã€‚è¿™æ ·ï¼Œå°±å¯ä»¥ä½¿å¤šä¸ªæ‹¥æœ‰æœ¬åœ°åœ°å€çš„ä¸»æœºï¼Œå…±ç”¨ä¸€ä¸ª NAT è·¯ç”±å™¨ä¸Šçš„å…¨çƒ IP åœ°å€ã€‚ä½¿ç”¨ç«¯å£å·çš„ NAT ä¹Ÿå«åš<strong>ç½‘ç»œåœ°å€ä¸Žç«¯å£è½¬æ¢</strong> NAPTï¼ˆNetwork Address and Port Translationï¼‰ï¼Œä½†åœ¨è®¸å¤šæ–‡çŒ®ä¸­ä¸åšåŒºåˆ†ï¼Œéƒ½ä½¿ç”¨ NATã€‚</p><p>ä»Žå±‚æ¬¡çš„è§’åº¦çœ‹ï¼ŒNAPT çš„æœºåˆ¶æœ‰äº›ç‰¹æ®Šã€‚æ™®é€šè·¯ç”±å™¨åœ¨è½¬å‘ IP æ•°æ®æŠ¥æ—¶ï¼Œå¯¹äºŽæº IP åœ°å€æˆ–ç›®çš„ IP åœ°å€éƒ½æ˜¯ä¸æ”¹å˜çš„ã€‚ä½† NAT è·¯ç”±å™¨åœ¨è½¬å‘ IP æ•°æ®æŠ¥æ—¶ï¼Œä¸€å®šè¦æ›´æ¢å…¶ IP åœ°å€ã€‚å…¶æ¬¡ï¼Œæ™®é€šè·¯ç”±å™¨åœ¨è½¬å‘åˆ†ç»„æ—¶ï¼Œæ˜¯å·¥ä½œåœ¨ç½‘ç»œå±‚ã€‚ä½† NAPT è·¯ç”±å™¨è¿˜è¦æŸ¥çœ‹å’Œè½¬æ¢è¿è¾“å±‚çš„ç«¯å£å·ï¼Œè€Œè¿™æœ¬æ¥åº”å½“å±žäºŽè¿è¾“å±‚çš„èŒƒç•´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer Networking </tag>
            
            <tag> IP </tag>
            
            <tag> ICMP </tag>
            
            <tag> IGMP </tag>
            
            <tag> ARP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Convert Sorted List to Binary Serch Tree</title>
      <link href="/programming/leetcode/convert-sorted-list-to-binary-search-tree/"/>
      <url>/programming/leetcode/convert-sorted-list-to-binary-search-tree/</url>
      
        <content type="html"><![CDATA[<h1 id="sorted-array-to-balanced-bst">Sorted Array to Balanced BST</h1><p>Given an array where elements are sorted in ascending order, convert it to a height balanced BST.</p><p>For this problem, a height-balanced binary tree is defined as a binary tree in which the depth of the two subtrees of every node never differ by more than 1.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given the sorted array: [-10,-3,0,5,9],</span><br><span class="line"></span><br><span class="line">One possible answer is: [0,-3,9,-10,null,5], which represents the following height balanced BST:</span><br><span class="line"></span><br><span class="line">      0</span><br><span class="line">     / \</span><br><span class="line">   -3   9</span><br><span class="line">   /   /</span><br><span class="line"> -10  5</span><br></pre></td></tr></table></figure><h2 id="recursion">Recursion</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n), visit each element once</span></span><br><span class="line"><span class="comment"># Space: O(log(n)), recursion stack depth</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedArrayToBST</span><span class="params">(self, nums: list)</span> -&gt; TreeNode:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(left, right)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> left &gt; right:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            mid = (left + right) // <span class="number">2</span></span><br><span class="line">            root = TreeNode(nums[mid])</span><br><span class="line">            root.left = helper(left, mid - <span class="number">1</span>)</span><br><span class="line">            root.right = helper(mid + <span class="number">1</span>, right)</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(<span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="sorted-list-to-balanced-bst">Sorted List to Balanced BST</h1><p>Given a singly linked list where elements are sorted in ascending order, convert it to a height balanced BST.</p><p>For this problem, a height-balanced binary tree is defined as a binary tree in which the depth of the two subtrees of every node never differ by more than 1.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given the sorted linked list: [-10,-3,0,5,9],</span><br><span class="line"></span><br><span class="line">One possible answer is: [0,-3,9,-10,null,5], which represents the following height balanced BST:</span><br><span class="line"></span><br><span class="line">      0</span><br><span class="line">     / \</span><br><span class="line">   -3   9</span><br><span class="line">   /   /</span><br><span class="line"> -10  5</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="recursion-1">Recursion</h2><p>Since we are given a linked list and not an array, we don't really have access to the elements of the list using indexes. We want to know the middle element of the linked list.</p><p>We can use the two pointer approach for finding out the middle element of a linked list. Essentially, we have two pointers called <code>slow_ptr</code> and <code>fast_ptr</code>. The <code>slow_ptr</code> moves one node at a time whereas the <code>fast_ptr</code> moves two nodes at a time. By the time the <code>fast_ptr</code> reaches the end of the linked list, the <code>slow_ptr</code> would have reached the middle element of the linked list. For an even sized list, any of the two middle elements can act as the root of the BST.</p><p>Once we have the middle element of the linked list, we disconnect the portion of the list to the left of the middle element. The way we do this is by keeping a <code>prev_ptr</code> as well which points to one node before the <code>slow_ptr</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n log(n)), O(n) to find mid</span></span><br><span class="line"><span class="comment"># Space: O(log(n)), recursion stack</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMiddle</span><span class="params">(self, head)</span>:</span></span><br><span class="line">        <span class="comment"># The pointer used to disconnect the left half from the mid node.</span></span><br><span class="line">        prevPtr = <span class="literal">None</span></span><br><span class="line">        slowPtr = head</span><br><span class="line">        fastPtr = head</span><br><span class="line">        <span class="comment"># Iterate until fastPr doesn't reach the end of the linked list.</span></span><br><span class="line">        <span class="keyword">while</span> fastPtr <span class="keyword">and</span> fastPtr.next:</span><br><span class="line">            prevPtr = slowPtr</span><br><span class="line">            slowPtr = slowPtr.next</span><br><span class="line">            fastPtr = fastPtr.next.next</span><br><span class="line">        <span class="comment"># Handling the case when slowPtr was equal to head.</span></span><br><span class="line">        <span class="keyword">if</span> prevPtr:</span><br><span class="line">            prevPtr.next = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> slowPtr</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedListToBST</span><span class="params">(self, head: ListNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="comment"># If the head doesn't exist, then the linked list is empty</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># Find the middle element for the list.</span></span><br><span class="line">        mid = self.findMiddle(head)</span><br><span class="line">        <span class="comment"># The mid becomes the root of the BST.</span></span><br><span class="line">        node = TreeNode(mid.val)</span><br><span class="line">        <span class="comment"># Base case when there is just one element in the linked list</span></span><br><span class="line">        <span class="keyword">if</span> head == mid:</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        <span class="comment"># Recursively form balanced BSTs using the left and right halves of the original list.</span></span><br><span class="line">        node.left = self.sortedListToBST(head)</span><br><span class="line">        node.right = self.sortedListToBST(mid.next)</span><br><span class="line">        <span class="keyword">return</span> node</span><br></pre></td></tr></table></figure><h2 id="recursion-conversion-to-array">Recursion + Conversion to Array</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n), array O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedArrayToBST</span><span class="params">(self, nums: list)</span> -&gt; TreeNode:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(left, right)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> left &gt; right:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            mid = (left + right) // <span class="number">2</span></span><br><span class="line">            root = TreeNode(nums[mid])</span><br><span class="line">            root.left = helper(left, mid - <span class="number">1</span>)</span><br><span class="line">            root.right = helper(mid + <span class="number">1</span>, right)</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(<span class="number">0</span>, len(nums) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapListToValues</span><span class="params">(self, head)</span>:</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">while</span> head:</span><br><span class="line">            res.append(head.val)</span><br><span class="line">            head = head.next</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedListToBST</span><span class="params">(self, head: ListNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">return</span> self.sortedArrayToBST(self.mapListToValues(head))</span><br></pre></td></tr></table></figure><h2 id="inorder-simulation">Inorder Simulation</h2><p>Elements processed in the inorder fashion on a binary search tree turn out to be sorted in ascending order.</p><p>The critical idea based on the inorder traversal that we will exploit to solve this problem, is:</p><p>We know that the leftmost element in the inorder traversal has to be the head of our given linked list. Similarly, the next element in the inorder traversal will be the second element in the linked list and so on. This is made possible because the initial list given to us is sorted in ascending order.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(log(n)), recursion stack</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findSize</span><span class="params">(self, head)</span>:</span></span><br><span class="line">        ptr = head</span><br><span class="line">        c = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> ptr:</span><br><span class="line">            ptr = ptr.next</span><br><span class="line">            c += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortedListToBST</span><span class="params">(self, head: ListNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        size = self.findSize(head)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(l, r)</span>:</span></span><br><span class="line">            <span class="keyword">nonlocal</span> head  <span class="comment"># point the node to process (visit)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Invalid case</span></span><br><span class="line">            <span class="keyword">if</span> l &gt; r:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="comment"># We don't really find out the middle node of the linked list.</span></span><br><span class="line">            <span class="comment"># We just have a variable telling us the index of the middle element.</span></span><br><span class="line">            <span class="comment"># We simply need this to make recursive calls on the two halves.</span></span><br><span class="line">            mid = (l + r) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">            left = convert(l, mid - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            node = TreeNode(head.val)  <span class="comment"># process current</span></span><br><span class="line">            node.left = left</span><br><span class="line">            head = head.next  <span class="comment"># process next</span></span><br><span class="line"></span><br><span class="line">            node.right = convert(mid + <span class="number">1</span>, r)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> convert(<span class="number">0</span>, size - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> linked list </tag>
            
            <tag> balanced binary tree </tag>
            
            <tag> BST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rotate List</title>
      <link href="/programming/leetcode/rotate-list/"/>
      <url>/programming/leetcode/rotate-list/</url>
      
        <content type="html"><![CDATA[<p>Given a linked list, rotate the list to the right by k places, where k is non-negative.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, k = 2</span><br><span class="line">Output: 4-&gt;5-&gt;1-&gt;2-&gt;3-&gt;NULL</span><br><span class="line">Explanation:</span><br><span class="line">rotate 1 steps to the right: 5-&gt;1-&gt;2-&gt;3-&gt;4-&gt;NULL</span><br><span class="line">rotate 2 steps to the right: 4-&gt;5-&gt;1-&gt;2-&gt;3-&gt;NULL</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 0-&gt;1-&gt;2-&gt;NULL, k = 4</span><br><span class="line">Output: 2-&gt;0-&gt;1-&gt;NULL</span><br><span class="line">Explanation:</span><br><span class="line">rotate 1 steps to the right: 2-&gt;0-&gt;1-&gt;NULL</span><br><span class="line">rotate 2 steps to the right: 1-&gt;2-&gt;0-&gt;NULL</span><br><span class="line">rotate 3 steps to the right: 0-&gt;1-&gt;2-&gt;NULL</span><br><span class="line">rotate 4 steps to the right: 2-&gt;0-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><ol type="1"><li>Connect the tail with head, <code>tail.next = head</code>.</li><li>From <code>head</code>, go forward <code>len - (k % len) - 1</code> steps. The next element is the new head.</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotateRight</span><span class="params">(self, head: ListNode, k: int)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        tail, n = head, <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> tail.next:</span><br><span class="line">            tail = tail.next</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line">        tail.next = head  <span class="comment"># connect</span></span><br><span class="line">        <span class="comment"># find (n - k % n - 1)th node</span></span><br><span class="line">        tail = head</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(n - k % n - <span class="number">1</span>):</span><br><span class="line">            tail = tail.next</span><br><span class="line">        new_head = tail.next</span><br><span class="line">        tail.next = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> new_head</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> linked list </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿è¾“å±‚</title>
      <link href="/notes/computer-networking/transport-layer/"/>
      <url>/notes/computer-networking/transport-layer/</url>
      
        <content type="html"><![CDATA[<p>åªæœ‰ä¸»æœºçš„åè®®æ ˆæ‰æœ‰è¿è¾“å±‚ï¼Œè€Œè·¯ç”±å™¨åœ¨è½¬å‘åˆ†ç»„æ—¶éƒ½åªç”¨åˆ°ä¸‹ä¸‰å±‚ï¼ˆç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚å’Œç½‘ç»œå±‚ï¼‰çš„åŠŸèƒ½ã€‚</p><p>ä»Žè¿è¾“å±‚çš„è§’åº¦æ¥çœ‹ï¼Œé€šä¿¡çš„çœŸæ­£ç«¯ç‚¹å¹¶ä¸æ˜¯ä¸»æœºè€Œæ˜¯ä¸»æœºä¸­çš„è¿›ç¨‹ã€‚IP åè®®è™½ç„¶èƒ½æŠŠåˆ†ç»„é€åˆ°ç›®çš„ä¸»æœºï¼Œä½†æ˜¯è¿™ä¸ªåˆ†ç»„æ²¡æœ‰äº¤ä»˜ä¸»æœºä¸­çš„åº”ç”¨è¿›ç¨‹ã€‚è¿™è¡¨æ˜Žï¼Œè¿è¾“å±‚æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½â€”â€”<strong>å¤ç”¨</strong>ï¼ˆmultiplexingï¼‰å’Œ<strong>åˆ†ç”¨</strong>ï¼ˆdemultiplexingï¼‰ã€‚å¤ç”¨æ˜¯æŒ‡åœ¨å‘é€æ–¹ä¸åŒçš„åº”ç”¨è¿›ç¨‹éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚åè®®ä¼ é€æ•°æ®ï¼ˆå½“ç„¶éœ€è¦åŠ ä¸Šé€‚å½“çš„é¦–éƒ¨ï¼‰ï¼Œè€Œåˆ†ç”¨æ˜¯æŒ‡æŽ¥æ”¶æ–¹çš„è¿è¾“å±‚åœ¨å‰¥åŽ»æŠ¥æ–‡çš„é¦–éƒ¨åŽèƒ½å¤ŸæŠŠè¿™äº›æ•°æ®æ­£ç¡®äº¤ä»˜ç›®çš„åº”ç”¨è¿›ç¨‹ã€‚</p><p>ç½‘ç»œå±‚ä¸ºä¸»æœºä¹‹é—´æä¾›é€»è¾‘é€šä¿¡ï¼Œè€Œè¿è¾“å±‚<strong>ä¸ºåº”ç”¨è¿›ç¨‹ä¹‹é—´æä¾›ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡</strong>ã€‚</p><p>è¿è¾“å±‚è¿˜è¦å¯¹æ”¶åˆ°çš„æŠ¥æ–‡è¿›è¡Œ<strong>å·®é”™æ£€æµ‹</strong>ã€‚åœ¨ç½‘ç»œå±‚ï¼ŒIP æ•°æ®æŠ¥é¦–éƒ¨ä¸­çš„æ£€éªŒå’Œå­—æ®µï¼Œåªæ£€éªŒé¦–éƒ¨è€Œä¸æ£€æŸ¥æ•°æ®éƒ¨åˆ†ã€‚</p><p>å½“è¿è¾“å±‚é‡‡ç”¨é¢å‘è¿žæŽ¥çš„ TCP åè®®æ—¶ï¼Œå°½ç®¡ä¸‹é¢çš„ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼ˆåªæä¾›å°½æœ€å¤§åŠªåŠ›æœåŠ¡ï¼‰ï¼Œä½†è¿™ç§é€»è¾‘é€šä¿¡ä¿¡é“å°±ç›¸å½“äºŽä¸€æ¡å…¨åŒå·¥çš„å¯é ä¿¡é“ã€‚ä½†å½“é‡‡ç”¨æ— è¿žæŽ¥çš„ UDP åè®®æ—¶ï¼Œè¿™ç§é€»è¾‘é€šä¿¡ä¿¡é“ä»ç„¶æ˜¯ä¸€æ¡ä¸å¯é ä¿¡é“ã€‚</p><p>ä¸¤ä¸ªè®¡ç®—æœºä¸­çš„è¿›ç¨‹è¦ç›¸äº’é€šä¿¡ï¼Œä¸ä»…å¿…é¡»çŸ¥é“å¯¹æ–¹çš„ IP åœ°å€ï¼ˆä¸ºäº†æ‰¾åˆ°å¯¹æ–¹çš„è®¡ç®—æœºï¼‰ï¼Œè€Œä¸”è¿˜è¦çŸ¥é“å¯¹æ–¹çš„ç«¯å£å·ï¼ˆä¸ºäº†æ‰¾åˆ°å¯¹æ–¹è®¡ç®—æœºä¸­çš„åº”ç”¨è¿›ç¨‹ï¼‰ã€‚TCP/IP çš„è¿è¾“å±‚ä½¿ç”¨ä¸€ä¸ª 16 ä½ï¼ˆå¯å…è®¸æœ‰ 65535 ä¸ªä¸åŒçš„ç«¯å£ï¼Œè¿™ä¸ªæ•°ç›®å¯¹ä¸€ä¸ªè®¡ç®—æœºæ¥è¯´æ˜¯è¶³å¤Ÿç”¨çš„ï¼‰ç«¯å£å·æ¥æ ‡å¿—ä¸€ä¸ªç«¯å£ã€‚</p><p>ç«¯å£å·åˆ†ä¸ºä¸‹é¢ä¸¤å¤§ç±»ï¼š</p><ul><li>æœåŠ¡å™¨æ®µä½¿ç”¨çš„ç«¯å£å·<ul><li>å­°çŸ¥ç«¯å£å·ï¼Œ0ï½ž1023ã€‚è¿™äº›ç«¯å£å·è¢«æŒ‡æ´¾ç»™äº† TCP/IP æœ€é‡è¦çš„ä¸€äº›åº”ç”¨ç¨‹åºã€‚</li><li>ç™»è®°ç«¯å£å·ï¼Œ1024ï½ž49151ã€‚ä½¿ç”¨è¿™ç±»ç«¯å£å·å¿…é¡»æŒ‰ç…§è§„å®šçš„æ‰‹ç»­ç™»è®°ï¼Œä»¥é˜²æ­¢é‡å¤ã€‚</li></ul></li><li>å®¢æˆ·ç«¯ä½¿ç”¨çš„ç«¯å£å·ï¼Œ49152ï½ž65535ã€‚è¿™ç±»ç«¯å£å·å°½åœ¨å®¢æˆ·è¿›ç¨‹è¿è¡Œæ—¶æ‰åŠ¨æ€é€‰æ‹©ï¼Œå› æ­¤åˆå«åšçŸ­æš‚ç«¯å£å·ã€‚</li></ul><table><thead><tr class="header"><th>åº”ç”¨ç¨‹åº</th><th>FTP</th><th>TELNET</th><th>SMTP</th><th>DNS</th><th>TFTP</th><th>HTTP</th><th>HTTPS</th></tr></thead><tbody><tr class="odd"><td>å­°çŸ¥ç«¯å£å·</td><td>21</td><td>23</td><td>25</td><td>53</td><td>69</td><td>80</td><td>443</td></tr></tbody></table><p>è¿è¾“å±‚çš„ä¸¤ä¸ªä¸»è¦åè®®ï¼š</p><ul><li>ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼ˆUser Datagram Protocolï¼‰<ul><li>é¢å‘è¿žæŽ¥ï¼Œå¯é </li><li>ä¸€å¯¹ä¸€ã€å…¨åŒå·¥çš„ï¼Œä¸æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡</li><li>é¢å‘å­—èŠ‚æµï¼Œæ ¹æ®å¯¹æ–¹ç»™å‡ºçš„çª—å£å€¼å’Œå½“å‰ç½‘ç»œæ‹¥å¡žçš„ç¨‹åº¦æ¥å†³å®šä¸€ä¸ªæŠ¥æ–‡æ®µåº”åŒ…å«å¤šå°‘å­—èŠ‚</li><li>æµé‡æŽ§åˆ¶ï¼Œæ‹¥å¡žæŽ§åˆ¶</li></ul></li><li>ä¼ è¾“æŽ§åˆ¶åè®® TCPï¼ˆTransmission Control Protocolï¼‰<ul><li>æ— è¿žæŽ¥çš„ï¼Œä¸å¯é ï¼Œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜</li><li>æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡</li><li>é¢å‘æŠ¥æ–‡ï¼Œå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†</li><li>æ²¡æœ‰æ‹¥å¡žæŽ§åˆ¶</li><li>é¦–éƒ¨å¼€é”€å°ï¼Œåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œæœ‰ 4 ä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µçš„é•¿åº¦éƒ½æ˜¯ä¸¤ä¸ªå­—èŠ‚<ol type="1"><li>æºç«¯å£ï¼Œåœ¨éœ€è¦å¯¹æ–¹å›žä¿¡æ—¶é€‰ç”¨ã€‚ä¸éœ€è¦æ—¶å¯å…¨ä¸º 0ã€‚</li><li>ç›®çš„ç«¯å£ï¼Œè‹¥ç«¯å£å·ä¸æ­£ç¡®ï¼Œå°±ä¸¢å¼ƒè¯¥æŠ¥æ–‡ï¼Œå¹¶ç”±ç½‘é™…æŽ§åˆ¶æŠ¥æ–‡åè®® ICMP å‘é€â€œç«¯å£ä¸å¯è¾¾â€å·®é”™æŠ¥æ–‡ç»™å‘é€æ–¹ã€‚</li><li>é•¿åº¦ï¼Œæœ€å°å€¼æ˜¯ 8ï¼ˆä»…æœ‰é¦–éƒ¨å­—æ®µï¼Œæ²¡æœ‰æ•°æ®å­—æ®µï¼‰</li><li>æ£€éªŒå’Œï¼Œæ£€æµ‹æ•°æ®æŠ¥åœ¨ä¼ è¾“ä¸­æ˜¯å¦æœ‰é”™ã€‚æœ‰é”™å°±ä¸¢å¼ƒã€‚</li></ol></li></ul></li></ul><a id="more"></a><h1 id="tcp-æŠ¥æ–‡æ®µ">TCP æŠ¥æ–‡æ®µ</h1><p><img src="/uploads/image/computer-networking/tcp-header.jpeg"></p><ul><li>æºç«¯å£å’Œç›®çš„ç«¯å£ï¼Œå„å  2 ä¸ªå­—èŠ‚ï¼Œä¸Ž UDP çš„åˆ†ç”¨ç±»ä¼¼ï¼ŒTCP çš„åˆ†ç”¨åŠŸèƒ½ä¹Ÿæ˜¯é€šè¿‡ç«¯å£å®žçŽ°çš„ã€‚</li><li>åºå·å’Œç¡®è®¤å·ï¼Œå„å  4 ä¸ªå­—èŠ‚ã€‚TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼Œä¼ é€çš„å­—èŠ‚æµä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ã€‚åºå·æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼›ç¡®è®¤å·æ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„åºå·ã€‚</li><li>æ•°æ®åç§»ï¼Œå  4 ä½ï¼Œæ•°æ®èµ·å§‹è·ç¦»æŠ¥æ–‡æ®µèµ·å§‹çš„åç§»ï¼Œå› æ­¤ä¹Ÿæ˜¯æŠ¥æ–‡æ®µçš„é¦–éƒ¨é•¿åº¦ã€‚ä½†åº”æ³¨æ„ï¼Œæ•°æ®åç§»çš„å•ä½æ˜¯ 32 ä½ï¼ˆå³ 4 å­—èŠ‚ï¼‰ã€‚ç”±äºŽ 4 ä½äºŒè¿›åˆ¶æ•°èƒ½å¤Ÿè¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°å­—æ˜¯ 15ï¼Œå› æ­¤æ•°æ®åç§»çš„æœ€å¤§å€¼æ˜¯ 60 å­—èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯ TCP é¦–éƒ¨çš„æœ€å¤§é•¿åº¦ï¼ˆå³é€‰é¡¹é•¿åº¦ä¸èƒ½è¶…è¿‡ 40 å­—èŠ‚ï¼‰ã€‚</li><li>6 ä¸ªæŽ§åˆ¶ä½ï¼šç´§æ€¥ URGï¼Œ<strong>ç¡®è®¤ ACK</strong>ï¼ŒæŽ¨é€ PSHï¼Œå¤ä½ RSTï¼Œ<strong>åŒæ­¥ SYN</strong>ï¼Œ<strong>ç»ˆæ­¢ FIN</strong>ã€‚<strong>åªæœ‰åœ¨ ACK = 1 æ—¶ç¡®è®¤å·å­—æ®µæ‰æœ‰æ„ä¹‰</strong>ã€‚</li><li>çª—å£ï¼Œå  2 ä¸ªå­—èŠ‚ï¼ŒæŒ‡å‡ºçŽ°åœ¨å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼ˆå› ä¸ºæŽ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼‰ã€‚çª—å£å€¼ç»å¸¸åœ¨åŠ¨æ€åœ°å˜åŒ–ç€ã€‚</li><li>æ£€éªŒå’Œï¼Œå  2 ä¸ªå­—èŠ‚ã€‚æ£€éªŒçš„èŒƒå›´åŒ…æ‹¬<strong>é¦–éƒ¨å’Œæ•°æ®</strong>ä¸¤éƒ¨åˆ†ã€‚</li><li>é€‰é¡¹ï¼Œé•¿åº¦å¯å˜ï¼Œæœ€é•¿ 40 ä¸ªå­—èŠ‚ã€‚TCP æœ€åˆåªè§„å®šäº†ä¸€ç§é€‰é¡¹ï¼Œå³<strong>æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦</strong> MSSï¼ˆMaximum Segment Sizeï¼‰ã€‚MSS æ˜¯<strong>æ•°æ®å­—æ®µçš„æœ€å¤§é•¿åº¦</strong>ï¼Œä¸åŒ…æ‹¬é¦–éƒ¨ã€‚éšç€äº’è”ç½‘çš„å‘å±•ï¼Œåˆé™†ç»­å¢žåŠ äº†å‡ ä¸ªé€‰é¡¹ï¼Œå¦‚<strong>çª—å£æ‰©å¤§</strong>é€‰é¡¹ã€<strong>æ—¶é—´æˆ³</strong>é€‰é¡¹ã€<strong>é€‰æ‹©ç¡®è®¤ï¼ˆSACKï¼‰</strong>ã€‚</li></ul><p>ä¸ºä»€ä¹ˆè¦è§„å®šä¸€ä¸ªæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ MSSï¼Ÿ</p><p>TCP æŠ¥æ–‡æ®µçš„æ•°æ®éƒ¨åˆ†ï¼Œè‡³å°‘è¦åŠ ä¸Š 40 å­—èŠ‚ï¼ˆTCP é¦–éƒ¨ 20 å­—èŠ‚å’Œ IPé¦–éƒ¨ 20 å­—èŠ‚ï¼‰ï¼Œæ‰èƒ½ç»„è£…æˆä¸€ä¸ª IP æ•°æ®æŠ¥ã€‚<strong>è‹¥é€‰æ‹©è¾ƒå°çš„ MSS å€¼ï¼Œç½‘ç»œçš„åˆ©ç”¨çŽ‡å°±é™ä½Ž</strong>ã€‚åè¿‡æ¥ï¼Œè‹¥ MSS éžå¸¸å¤§ï¼Œé‚£ä¹ˆåœ¨ IP å±‚ä¼ è¾“æ—¶å°±æœ‰å¯èƒ½è¦åˆ†è§£æˆå¤šä¸ªçŸ­æ•°æ®æŠ¥ç‰‡ã€‚åœ¨ç»ˆç‚¹è¦æŠŠæ”¶åˆ°çš„å„ä¸ªçŸ­æ•°æ®æŠ¥ç‰‡è£…é…æˆåŽŸæ¥çš„ TCP æŠ¥æ–‡æ®µã€‚å½“ä¼ è¾“å‡ºé”™æ—¶è¿˜è¦è¿›è¡Œé‡ä¼ ã€‚è¿™äº›ä¹Ÿéƒ½ä¼šä½¿å¼€é”€å¢žå¤§ã€‚æœ€ä½³çš„ MSS æ˜¯å¾ˆéš¾ç¡®å®šçš„ã€‚åœ¨è¿žæŽ¥å»ºç«‹çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹éƒ½æŠŠè‡ªå·±èƒ½å¤Ÿæ”¯æŒçš„ MSS å†™å…¥ï¼Œä¸¤ä¸ªä¼ é€æ–¹å‘å¯ä»¥æœ‰ä¸åŒçš„ MSS å€¼ã€‚è‹¥ä¸»æœºæœªå¡«å†™è¿™ä¸€é¡¹ï¼Œåˆ™ MSS çš„é»˜è®¤å€¼æ˜¯ 536 å­—èŠ‚ã€‚</p><h1 id="å¯é ä¼ è¾“">å¯é ä¼ è¾“</h1><h2 id="æ»‘åŠ¨çª—å£">æ»‘åŠ¨çª—å£</h2><p>å…¨åŒå·¥é€šä¿¡çš„åŒæ–¹æ—¢æ˜¯å‘é€æ–¹ä¹Ÿæ˜¯æŽ¥æ”¶æ–¹ã€‚å› æ­¤ï¼Œæ¯ä¸€æ–¹éƒ½æœ‰è‡ªå·±çš„å‘é€çª—å£å’ŒæŽ¥æ”¶çª—å£ã€‚</p><p>TCP çš„æ»‘åŠ¨çª—å£æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ã€‚</p><p>å‘é€æ–¹çš„å‘é€çª—å£å¤§å°ä¸èƒ½è¶…è¿‡æŽ¥æ”¶æ–¹çš„æŽ¥æ”¶çª—å£ï¼›å‘é€çª—å£å¤§å°è¿˜è¦å—åˆ°å½“æ—¶ç½‘ç»œæ‹¥å¡žç¨‹åº¦çš„åˆ¶çº¦ã€‚</p><p>å‘é€çª—å£åŒ…å«ï¼š</p><ol type="1"><li>å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„æ•°æ®</li><li>å…è®¸å‘é€ä½†å°šæœªå‘é€çš„æ•°æ®</li></ol><p>æŽ¥æ”¶çª—å£åŒ…å«ï¼š</p><ol type="1"><li>æœªæŒ‰åºæ”¶åˆ°çš„æ•°æ®ï¼ˆæŒ‰åºæ”¶åˆ°æ•°æ®æ—¶çª—å£ä¼šå‘å‰æ»‘åŠ¨ï¼Œå› æ­¤æŒ‰åºæ”¶åˆ°çš„æ•°æ®ä¸ä¼šåœ¨æŽ¥æ”¶çª—å£å†…ï¼‰</li><li>å…è®¸æŽ¥æ”¶çš„æ•°æ®</li></ol><p>å‘é€ç¼“å­˜åŒ…å«ï¼š</p><ol type="1"><li>å·²å‘é€ä½†å°šæœªæ”¶åˆ°ç¡®è®¤çš„æ•°æ®</li><li>å‡†å¤‡å‘é€çš„æ•°æ®ï¼ˆå¯èƒ½ä½äºŽå‘é€çª—å£å†…ï¼Œä¹Ÿå¯èƒ½ä¸åœ¨çª—å£å†…ï¼‰</li></ol><p>æŽ¥æ”¶ç¼“å­˜åŒ…å«ï¼š</p><ol type="1"><li>æœªæŒ‰åºæ”¶åˆ°çš„æ•°æ®</li><li>æŒ‰åºåˆ°è¾¾ï¼Œä½†å°šæœªè¢«æŽ¥æ”¶åº”ç”¨ç¨‹åºè¯»å–çš„æ•°æ®ï¼ˆä½äºŽæŽ¥æ”¶çª—å£å·¦ä¾§ï¼‰</li></ol><p>çª—å£é€šå¸¸åªæ˜¯ç¼“å­˜çš„ä¸€éƒ¨åˆ†ã€‚</p><ul><li>è™½ç„¶å‘é€çª—å£æ˜¯æ ¹æ®æŽ¥æ”¶çª—å£è®¾ç½®çš„ï¼Œä½†åœ¨åŒä¸€æ—¶åˆ»ï¼Œå®ƒä»¬å¹¶ä¸æ€»æ˜¯ä¸€æ ·å¤§ã€‚è¿™æ˜¯å› ä¸ºé€šè¿‡ç½‘ç»œä¼ é€çª—å£å€¼éœ€è¦ç»åŽ†ä¸€å®šçš„æ—¶é—´æ»žåŽï¼Œå¦å¤–ï¼Œå‘é€æ–¹è¿˜å¯èƒ½æ ¹æ®æ‹¥å¡žæƒ…å†µé€‚å½“å‡å°è‡ªå·±çš„å‘é€çª—å£å¤§å°ã€‚</li><li>å¯¹äºŽä¸æŒ‰åºåˆ°è¾¾çš„æ•°æ®åº”å¦‚ä½•å¤„ç†ï¼ŒTCP æ ‡å‡†å¹¶æ— æ˜Žç¡®è§„å®šã€‚å¦‚æžœä¸€å¾‹ä¸¢å¼ƒï¼Œé‚£ä¹ˆæŽ¥æ”¶çª—å£çš„ç®¡ç†å°†ä¼šæ¯”è¾ƒç®€å•ï¼Œä½†å¯¹ç½‘ç»œèµ„æºçš„åˆ©ç”¨ä¸åˆ©ã€‚å› æ­¤é€šå¸¸æ˜¯å…ˆä¸´æ—¶å­˜æ”¾åœ¨æŽ¥æ”¶çª—å£å†…ï¼Œç­‰ç¼ºå°‘çš„å­—èŠ‚æ”¶åˆ°åŽï¼Œå†æŒ‰åºäº¤ä»˜ä¸Šå±‚çš„åº”ç”¨è¿›ç¨‹ã€‚</li><li>TCP è¦æ±‚æŽ¥æ”¶æ–¹å¿…é¡»æœ‰<strong>ç´¯ç§¯ç¡®è®¤</strong>çš„åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥å‡å°ä¼ è¾“å¼€é”€ã€‚æŽ¥æ”¶æ–¹å¯ä»¥åœ¨<strong>åˆé€‚çš„æ—¶å€™</strong>å‘é€ç¡®è®¤ï¼Œä¹Ÿå¯ä»¥åœ¨å‘é€æ•°æ®æ—¶<strong>æŽå¸¦</strong>ç¡®è®¤ä¿¡æ¯ã€‚ä½†è¯·æ³¨æ„ä¸¤ç‚¹ã€‚ä¸€æ˜¯æŽ¥æ”¶æ–¹ä¸åº”è¿‡åˆ†æŽ¨è¿Ÿå‘é€ç¡®è®¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´å‘é€æ–¹ä¸å¿…è¦çš„é‡ä¼ ï¼Œåè€Œæµªè´¹äº†ç½‘ç»œçš„èµ„æºã€‚<strong>TCP æ ‡å‡†è§„å®šï¼Œç¡®è®¤æŽ¨è¿Ÿçš„æ—¶é—´ä¸åº”è¶…è¿‡ 0.5 ç§’ã€‚è‹¥æ”¶åˆ°ä¸€è¿žä¸²å…·æœ‰æœ€å¤§é•¿åº¦çš„æŠ¥æ–‡æ®µï¼Œåˆ™å¿…é¡»æ¯éš”ä¸€ä¸ªæŠ¥æ–‡æ®µå°±å‘é€ä¸€ä¸ªç¡®è®¤</strong>ã€‚äºŒæ˜¯æŽå¸¦ç¡®è®¤å®žé™…ä¸Šå¹¶ä¸ç»å¸¸å‘ç”Ÿï¼Œå› ä¸ºå¤§å¤šæ•°åº”ç”¨ç¨‹åºå¾ˆå°‘åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šå‘é€æ•°æ®ã€‚</li></ul><h2 id="è¶…æ—¶é‡ä¼ æ—¶é—´">è¶…æ—¶é‡ä¼ æ—¶é—´</h2><p>è¶…æ—¶é‡ä¼ æ—¶é—´å¤ªçŸ­ï¼Œå°±ä¼šå¼•èµ·å¾ˆå¤šä¸å¿…è¦çš„é‡ä¼ ï¼Œä½¿ç½‘ç»œè´Ÿè·å¢žå¤§ã€‚å¤ªé•¿ï¼Œåˆ™åˆä½¿ç½‘ç»œçš„ç©ºé—²æ—¶é—´å¢žå¤§ï¼Œé™ä½Žäº†ä¼ è¾“æ•ˆçŽ‡ã€‚TCP é‡‡ç”¨äº†ä¸€ç§<strong>è‡ªé€‚åº”ç®—æ³•</strong>ã€‚</p><p>TCP ä¿ç•™äº† RTT çš„ä¸€ä¸ªåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´ <span class="math inline">\(RTT_S\)</span>ï¼ˆS è¡¨ç¤º Smoothedï¼‰ã€‚</p><p><span class="math display">\[RTT_S^n=(1-\alpha)*RTT_S^{n-1}+\alpha*RTT^n\quad(0\le\alpha&lt;1)\]</span></p><p><span class="math inline">\(\alpha\)</span> æŽ¥è¿‘äºŽ 0ï¼Œåˆ™æ–°çš„ RTT æ ·æœ¬å½±å“ä¸å¤§ï¼Œ<span class="math inline">\(RTT_S\)</span> å€¼æ›´æ–°è¾ƒæ…¢ã€‚æŽ¨èçš„ <span class="math inline">\(\alpha\)</span> å€¼ä¸º 1/8ï¼Œå³ 0.125ã€‚</p><p><strong>è¶…æ—¶é‡ä¼ æ—¶é—´</strong> RTOï¼ˆRetransmission Time-Outï¼‰åº”ç•¥å¤§äºŽ <span class="math inline">\(RTT_S\)</span>ï¼Œå»ºè®®çš„å…¬å¼ä¸ºï¼š</p><p><span class="math display">\[RTO=RTT_S+4*RTT_D\]</span></p><p><span class="math inline">\(RTT_D\)</span> æ˜¯ RTT çš„åå·®çš„åŠ æƒå¹³å‡å€¼ã€‚<span class="math inline">\(\beta\)</span> çš„æŽ¨èå€¼æ˜¯ 1/4ï¼Œå³ 0.25ã€‚</p><p><span class="math display">\[RTT_D^n=\begin{cases}0.5*RTT^1,\quad n=1\\ (1-\beta)*RTT_D^{n-1}+\beta*|RTT_S^n-RTT^n|,\quad n&gt;1\end{cases}\]</span></p><p>å¾€è¿”æ—¶é—´çš„æµ‹é‡å®žçŽ°èµ·æ¥ç›¸å½“å¤æ‚ã€‚è¯•æƒ³ï¼Œå‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œé‡ä¼ æ—¶é—´åˆ°äº†è¿˜æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼ŒäºŽæ˜¯é‡ä¼ æŠ¥æ–‡æ®µã€‚ç»è¿‡ä¸€æ®µæ—¶é—´åŽï¼Œæ”¶åˆ°äº†ç¡®è®¤æŠ¥æ–‡æ®µã€‚çŽ°åœ¨çš„é—®é¢˜æ˜¯ï¼šæ­¤æŠ¥æ–‡æ®µæ˜¯å¯¹å…ˆå‘é€çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œè¿˜æ˜¯å¯¹é‡ä¼ çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Ÿæ­£ç¡®çš„åˆ¤æ–­å¯¹ç¡®å®š <span class="math inline">\(RTT_S\)</span> çš„å€¼å…³ç³»å¾ˆå¤§ã€‚</p><p>Karn æå‡ºä¸€ä¸ªç®—æ³•ï¼Œåªè¦æŠ¥æ–‡æ®µé‡ä¼ äº†ï¼Œå°±ä¸é‡‡ç”¨å…¶å¾€è¿”æ—¶é—´æˆæœ¬ã€‚ä½†è¿™æ ·ï¼Œç½‘ç»œæ—¶å»¶çªç„¶å¢žå¤§æ—¶ï¼Œè¶…æ—¶é‡ä¼ æ—¶é—´å°±æ— æ³•æ›´æ–°ã€‚è¾ƒä¸ºåˆç†çš„ç­–ç•¥æ˜¯ï¼š<strong>æŠ¥æ–‡æ®µæ¯é‡ä¼ ä¸€æ¬¡ï¼Œå°±æŠŠè¶…æ—¶é‡ä¼ æ—¶é—´å¢žå¤§ä¸€äº›ï¼ˆå…¸åž‹åšæ³•æ˜¯ç¿»å€ï¼‰ã€‚å½“ä¸å†å‘ç”Ÿé‡ä¼ æ—¶ï¼Œæ‰æ ¹æ®ä¸Šé¢çš„å…¬å¼è®¡ç®—è¶…æ—¶é‡ä¼ æ—¶é—´</strong>ã€‚</p><h2 id="é€‰æ‹©ç¡®è®¤-sack">é€‰æ‹©ç¡®è®¤ SACK</h2><p>è‹¥æ”¶åˆ°çš„æŠ¥æ–‡æ®µæ— å·®é”™ï¼Œåªæ˜¯æœªæŒ‰åºå·ï¼Œé€‰æ‹©ç¡®è®¤ï¼ˆSelective ACKï¼‰è®¾æ³•è®©å‘é€æ–¹åªä¼ é€ç¼ºå°‘çš„æ•°æ®è€Œä¸é‡ä¼ å·²ç»æ­£ç¡®åˆ°è¾¾æŽ¥æ”¶æ–¹çš„æ•°æ®ã€‚</p><p>æŽ¥æ”¶åˆ°çš„æ•°æ®å­—èŠ‚æµçš„åºå·ä¸è¿žç»­ï¼Œå°±ä¼šå½¢æˆä¸€äº›ä¸è¿žç»­çš„å­—èŠ‚å—ã€‚æŽ¥æ”¶æ–¹è¦æŠŠè¿™äº›ä¿¡æ¯ï¼ˆå­—èŠ‚å—çš„è¾¹ç•Œï¼‰å‡†ç¡®åœ°å‘Šè¯‰å‘é€æ–¹ï¼Œä½¿å‘é€æ–¹ä¸è¦å†é‡å¤å‘é€è¿™äº›æ•°æ®ã€‚</p><p>å¦‚æžœè¦ä½¿ç”¨é€‰æ‹©ç¡®è®¤ï¼Œé‚£ä¹ˆåœ¨å»ºç«‹ TCP è¿žæŽ¥æ—¶ï¼Œå°±è¦åœ¨ TCP é¦–éƒ¨çš„é€‰é¡¹ä¸­åŠ ä¸Šâ€œå…è®¸ SACKâ€é€‰é¡¹ï¼Œè€ŒåŒæ–¹å¿…é¡»éƒ½äº‹å…ˆå•†å®šå¥½ã€‚é€‰é¡¹ä¸­åªèƒ½æŠ¥å‘Šæœ€å¤š 4 ä¸ªå­—èŠ‚å—çš„è¾¹ç•Œä¿¡æ¯ã€‚ä¸€ä¸ªè¾¹ç•Œä¿¡æ¯å  4 å­—èŠ‚ï¼Œå…± 8 ä¸ªè¾¹ç•Œã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ 1 ä¸ªå­—èŠ‚æŒ‡æ˜Žæ˜¯ SACK é€‰é¡¹å’Œ 1 å­—èŠ‚æŒ‡æ˜Žè¿™ä¸ªé€‰é¡¹è¦å ç”¨å¤šå°‘å­—èŠ‚ã€‚æ€»å…± 34 å­—èŠ‚ã€‚TCP é¦–éƒ¨é€‰é¡¹çš„é•¿åº¦æœ€å¤šåªæœ‰ 40 å­—èŠ‚ã€‚</p><h1 id="æµé‡æŽ§åˆ¶">æµé‡æŽ§åˆ¶</h1><h2 id="åˆ©ç”¨æ»‘åŠ¨çª—å£">åˆ©ç”¨æ»‘åŠ¨çª—å£</h2><p>TCP é€šè¿‡è®©å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªç§°ä¸ºæŽ¥æ”¶çª—å£çš„å˜é‡ rwndï¼ˆreceive windowï¼‰æ¥æä¾›æµé‡æŽ§åˆ¶ï¼ˆflow controlï¼‰ã€‚rwnd ç”¨äºŽç»™å‘é€æ–¹ï¼ˆSï¼‰ä¸€ä¸ªæŒ‡ç¤ºâ€”â€”æŽ¥æ”¶æ–¹ï¼ˆRï¼‰è¿˜æœ‰å¤šå°‘å¯ç”¨çš„ç¼“å­˜ç©ºé—´ã€‚</p><p>S é€šè¿‡å°†æœªç¡®è®¤çš„æ•°æ®é‡æŽ§åˆ¶åœ¨ rwnd ä»¥å†…ï¼Œå°±å¯ä»¥ä¿è¯ R çš„æŽ¥æ”¶ç¼“å­˜ä¸ä¼šæº¢å‡ºã€‚çŽ°åœ¨æœ‰ä¸€ä¸ªå°å°çš„é—®é¢˜ï¼Œå‡è®¾ R çš„æŽ¥æ”¶ç¼“å­˜å·²æ»¡ï¼Œä½¿å¾— rwnd = 0ã€‚R åœ¨å°† rwmd = 0 é€šå‘Šç»™ S ä¹‹åŽï¼Œè¿˜è¦å‡è®¾ R æ²¡æœ‰ä»»ä½•æ•°æ®è¦å‘ç»™ Sã€‚ä¸€æ®µæ—¶é—´åŽï¼ŒR ä¸Šçš„åº”ç”¨è¿›ç¨‹å°†ç¼“å­˜æ¸…ç©ºï¼Œä½† TCP ä»…åœ¨ R æœ‰æ•°æ®æˆ–è€…æœ‰ç¡®è®¤è¦å‘æ—¶æ‰ä¼šå‘é€æŠ¥æ–‡æ®µç»™ Sï¼Œè¿™æ ·ï¼ŒS ä¸å¯èƒ½çŸ¥é“ R çš„æŽ¥æ”¶ç¼“å­˜å·²ç»æœ‰æ–°çš„ç©ºé—´äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCP è§„èŒƒè¦æ±‚ï¼šå½“ S æ”¶åˆ° R çš„é›¶çª—å£é€šçŸ¥ï¼Œå°±å¯åŠ¨è®¡æ—¶å™¨ã€‚è‹¥è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´åˆ°æœŸï¼Œå°±å‘é€ä¸€ä¸ªé›¶çª—å£<strong>æŽ¢æµ‹æŠ¥æ–‡æ®µ</strong>ï¼ˆåªæœ‰ä¸€ä¸ªå­—èŠ‚æ•°æ®çš„æŠ¥æ–‡æ®µï¼‰ï¼ŒR åœ¨ç¡®è®¤è¿™ä¸ªæŠ¥æ–‡æ®µæ—¶ç»™å‡ºæ–°çš„ rwndã€‚</p><p>TCP è§„å®šï¼Œå³ä½¿è®¾ç½®ä¸ºé›¶çª—å£ï¼Œä¹Ÿå¿…é¡»æŽ¥æ”¶ä»¥ä¸‹å‡ ç§æŠ¥æ–‡æ®µï¼šé›¶çª—å£æŽ¢æµ‹æŠ¥æ–‡æ®µã€ç¡®è®¤æŠ¥æ–‡æ®µå’Œæºå¸¦ç´§æ€¥æ•°æ®çš„æŠ¥æ–‡æ®µã€‚</p><h2 id="ä¼ è¾“æ•ˆçŽ‡">ä¼ è¾“æ•ˆçŽ‡</h2><p>åº”ç”¨è¿›ç¨‹æŠŠæ•°æ®ä¼ é€åˆ° TCP çš„å‘é€ç¼“å­˜åŽï¼Œå‰©ä¸‹çš„å‘é€ä»»åŠ¡å°±ç”± TCP æ¥æŽ§åˆ¶äº†ã€‚å¯ä»¥ç”¨ä¸åŒçš„æœºåˆ¶æ¥æŽ§åˆ¶ TCP æŠ¥æ–‡æ®µçš„å‘é€æ—¶æœºã€‚ ç¬¬ä¸€ç§æœºåˆ¶ï¼Œç¼“å­˜ä¸­å­˜æ”¾çš„æ•°æ®è¾¾åˆ° MSS å­—èŠ‚æ—¶ï¼Œå°±ç»„è£…æˆä¸€ä¸ª TCP æŠ¥æ–‡æ®µå‘é€ã€‚ç¬¬äºŒç§æœºåˆ¶ï¼Œç”±åº”ç”¨è¿›ç¨‹æŒ‡æ˜Žè¦æ±‚å‘é€æŠ¥æ–‡æ®µï¼Œå³ TCP æ”¯æŒçš„<strong>æŽ¨é€</strong>ï¼ˆpushï¼‰æ“ä½œã€‚ç¬¬ä¸‰ç§æœºåˆ¶ï¼Œç»´æŒä¸€ä¸ªå®šæ—¶å™¨ï¼ŒæœŸé™åˆ°äº†ï¼Œå°±æŠŠå½“å‰å·²æœ‰çš„ç¼“å­˜æ•°æ®è£…å…¥æŠ¥æ–‡æ®µï¼ˆä½†é•¿åº¦ä¸èƒ½è¶…è¿‡ MSSï¼‰å‘é€å‡ºåŽ»ã€‚</p><p>åœ¨ TCP çš„å®žçŽ°ä¸­å¹¿æ³›ä½¿ç”¨ Nagle ç®—æ³•ã€‚ç®—æ³•å¦‚ä¸‹ï¼šè‹¥å‘é€åº”ç”¨è¿›ç¨‹è¦æŠŠæ•°æ®<strong>é€ä¸ªå­—èŠ‚åœ°å‘é€åˆ° TCP çš„å‘é€ç¼“å­˜</strong>ï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªäº¤äº’å¼ç”¨æˆ·ä½¿ç”¨ä¸€æ¡ TELNET è¿žæŽ¥ï¼‰ï¼Œåˆ™å‘é€æ–¹å°±æŠŠç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚å…ˆå‘é€å‡ºåŽ»ï¼ŒæŠŠåŽé¢åˆ°è¾¾çš„æ•°æ®å­—èŠ‚éƒ½ç¼“å­˜èµ·æ¥ã€‚å½“å‘é€æ–¹æ”¶åˆ°å¯¹ç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„ç¡®è®¤åŽï¼Œå†æŠŠå‘é€ç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ç»„è£…æˆä¸€ä¸ªæŠ¥æ–‡æ®µå‘é€å‡ºåŽ»ï¼ŒåŒæ—¶ç»§ç»­å¯¹åŽç»­åˆ°è¾¾çš„æ•°æ®è¿›è¡Œç¼“å­˜ã€‚åªæœ‰åœ¨æ”¶åˆ°å¯¹å‰ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¡®è®¤åŽæ‰ç»§ç»­å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚Nagle ç®—æ³•è¿˜è§„å®šï¼Œå½“åˆ°è¾¾çš„æ•°æ®å·²è¾¾åˆ°å‘é€çª—å£å¤§å°çš„ä¸€åŠæˆ–å·²è¾¾åˆ°æŠ¥æ–‡æ®µçš„æœ€å¤§é•¿åº¦æ—¶ï¼Œå°±ç«‹å³å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚å½“æ•°æ®åˆ°è¾¾è¾ƒå¿«è€Œç½‘ç»œé€ŸçŽ‡è¾ƒæ…¢æ—¶ï¼Œç”¨è¿™æ ·çš„æ–¹æ³•å¯ä»¥æ˜Žæ˜¾åœ°å‡å°‘æ‰€ç”¨çš„ç½‘ç»œå¸¦å®½ã€‚</p><p>è¯•æƒ³å¦ä¸€ç§æƒ…å†µï¼šæŽ¥æ”¶æ–¹çš„ç¼“å­˜å·²æ»¡ï¼Œè€Œäº¤äº’å¼çš„<strong>åº”ç”¨è¿›ç¨‹ä¸€æ¬¡åªä»ŽæŽ¥æ”¶ç¼“å­˜è¯»å–ä¸€ä¸ªå­—èŠ‚</strong>ï¼Œç„¶åŽå‘å‘é€æ–¹å‘é€ç¡®è®¤ï¼Œå¹¶æŠŠçª—å£è®¾ç½®ä¸º 1 ä¸ªå­—èŠ‚ã€‚æŽ¥ç€ï¼Œå‘é€æ–¹åˆå‘æ¥ 1 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ˆæ³¨æ„ï¼ŒIP æ•°æ®æŠ¥æ˜¯ 41 å­—èŠ‚ï¼‰ã€‚è¿™æ ·è¿›è¡Œä¸‹åŽ»ï¼Œä½¿ç½‘ç»œçš„æ•ˆçŽ‡å¾ˆä½Žã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®©æŽ¥æ”¶æ–¹ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä½¿å¾—æŽ¥æ”¶ç¼“å­˜å·²æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³ä¸€ä¸ªæœ€é•¿çš„æŠ¥æ–‡æ®µï¼Œæˆ–è€…ç­‰åˆ°æŽ¥æ”¶ç¼“å­˜å·²æœ‰ä¸€åŠç©ºé—²çš„ç©ºé—´ï¼Œå†å‘å‡ºç¡®è®¤æŠ¥æ–‡å¹¶é€šçŸ¥å½“å‰çš„çª—å£å¤§å°ã€‚æŽ¥æ”¶æ–¹åº” <strong>1. é€‚å½“æŽ¨è¿Ÿå‘å›žç¡®è®¤æŠ¥æ–‡ã€‚ 2. å°½é‡ä½¿ç”¨æŽå¸¦ç¡®è®¤ã€‚</strong></p><p>ä¸Šè¿°ä¸¤ç§æ–¹æ³•å¯é…åˆä½¿ç”¨ã€‚</p><h1 id="æ‹¥å¡žæŽ§åˆ¶">æ‹¥å¡žæŽ§åˆ¶</h1><p>åœ¨æŸæ®µæ—¶é—´ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦å˜åã€‚è¿™ç§æƒ…å†µå°±å«åš<strong>æ‹¥å¡ž</strong>ï¼ˆcongestionï¼‰ã€‚</p><p>æ‹¥å¡žå¸¸å¸¸è¶‹äºŽæ¶åŒ–ã€‚å¦‚æžœä¸€ä¸ªè·¯ç”±å™¨æ²¡æœ‰è¶³å¤Ÿçš„ç¼“å­˜ç©ºé—´ï¼Œå®ƒå°±ä¼šä¸¢å¼ƒä¸€äº›æ–°åˆ°çš„åˆ†ç»„ã€‚ä½†å½“åˆ†ç»„è¢«ä¸¢å¼ƒæ—¶ï¼Œå‘é€è¿™ä¸€åˆ†ç»„çš„æºç‚¹å°±ä¼šé‡ä¼ è¿™ä¸€åˆ†ç»„ï¼Œç”šè‡³å¯èƒ½è¿˜è¦é‡ä¼ å¤šæ¬¡ã€‚è¿™æ ·ä¼šå¼•èµ·æ›´å¤šçš„åˆ†ç»„æµå…¥ç½‘ç»œå’Œè¢«ç½‘ç»œä¸­çš„è·¯ç”±å™¨ä¸¢å¼ƒã€‚å¯è§<strong>æ‹¥å¡žå¼•èµ·çš„é‡ä¼ å¹¶ä¸ä¼šç¼“è§£æ‹¥å¡žï¼Œåè€Œä¼šåŠ å‰§æ‹¥å¡ž</strong>ã€‚</p><p>æ‹¥å¡žæŽ§åˆ¶ä¸Žæµé‡æŽ§åˆ¶çš„å…³ç³»å¯†åˆ‡ï¼Œä½†å­˜åœ¨ä¸€äº›å·®åˆ«ã€‚æ‹¥å¡žæŽ§åˆ¶å°±æ˜¯<strong>é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½</strong>ã€‚æ‹¥å¡žæŽ§åˆ¶æ˜¯ä¸€ä¸ª<strong>å…¨å±€æ€§çš„è¿‡ç¨‹</strong>ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºã€æ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸Žé™ä½Žç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚ç›¸åï¼Œæµé‡æŽ§åˆ¶æ˜¯æŒ‡<strong>ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æŽ§åˆ¶</strong>ï¼Œæ˜¯ä¸ª<strong>ç«¯åˆ°ç«¯</strong>çš„é—®é¢˜ã€‚æµé‡æŽ§åˆ¶è¦åšçš„æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€ŸçŽ‡ï¼Œä»¥ä¾¿ä½¿æŽ¥æ”¶ç«¯æ¥å¾—åŠæŽ¥æ”¶ã€‚</p><p>æ‹¥å¡žæŽ§åˆ¶æ˜¯å¾ˆéš¾è®¾è®¡çš„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŠ¨æ€çš„é—®é¢˜ã€‚åˆ†ç»„çš„ä¸¢å¤±æ˜¯ç½‘ç»œå‘ç”Ÿæ‹¥å¡žçš„å¾å…†è€Œä¸æ˜¯åŽŸå› ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œç”šè‡³æ­£æ˜¯æ‹¥å¡žæŽ§åˆ¶æœºåˆ¶æœ¬èº«æˆä¸ºå¼•èµ·ç½‘ç»œæ€§èƒ½æ¶åŒ–ç”šè‡³å‘ç”Ÿæ­»é”ï¼ˆç½‘ç»œåžåé‡ä¸‹é™åˆ°é›¶ï¼Œæ— æ³•å·¥ä½œï¼‰çš„åŽŸå› ã€‚</p><p>ä»Žå¤§çš„æ–¹é¢çœ‹ï¼Œæ‹¥å¡žæŽ§åˆ¶å¯ä»¥åˆ†ä¸º<strong>å¼€çŽ¯æŽ§åˆ¶å’Œé—­çŽ¯æŽ§åˆ¶</strong>ä¸¤ç§æ–¹æ³•ã€‚å¼€çŽ¯æŽ§åˆ¶å°±æ˜¯åœ¨è®¾è®¡ç½‘ç»œæ—¶äº‹å…ˆå°†æœ‰å…³å‘ç”Ÿæ‹¥å¡žçš„å› ç´ è€ƒè™‘å‘¨åˆ°ï¼ŒåŠ›æ±‚ç½‘ç»œåœ¨å·¥ä½œæ—¶ä¸äº§ç”Ÿæ‹¥å¡žã€‚ä½†ä¸€æ—¦æ•´ä¸ªç³»ç»Ÿè¿è¡Œèµ·æ¥ï¼Œå°±ä¸å†ä¸­é€”è¿›è¡Œæ”¹æ­£äº†ã€‚é—­çŽ¯æŽ§åˆ¶æ˜¯åŸºäºŽ<strong>åé¦ˆçŽ¯è·¯</strong>çš„æ¦‚å¿µï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æŽªæ–½ï¼š</p><ol type="1"><li>æ£€æµ‹ç½‘ç»œç³»ç»Ÿä»¥ä¾¿æ£€æµ‹åˆ°æ‹¥å¡žåœ¨ä½•å¤„ã€ä½•æ—¶å‘ç”Ÿã€‚</li><li>æŠŠæ‹¥å¡žå‘ç”Ÿçš„ä¿¡æ¯ä¼ é€åˆ°å¯é‡‡å–è¡ŒåŠ¨çš„åœ°æ–¹ã€‚</li><li>è°ƒæ•´ç½‘ç»œç³»ç»Ÿçš„è¿è¡Œä»¥è§£å†³å‡ºçŽ°çš„é—®é¢˜ã€‚</li></ol><h2 id="tcp-çš„æ‹¥å¡žæŽ§åˆ¶æ–¹æ³•">TCP çš„æ‹¥å¡žæŽ§åˆ¶æ–¹æ³•</h2><p>ä¸‹é¢è®¨è®ºçš„æ‹¥å¡žæŽ§åˆ¶ä¹Ÿå«åš<strong>åŸºäºŽçª—å£</strong>çš„æ‹¥å¡žæŽ§åˆ¶ã€‚å‘é€æ–¹ç»´æŒä¸€ä¸ªå«åš<strong>æ‹¥å¡žçª—å£</strong> cwndï¼ˆcongestion windowï¼‰çš„çŠ¶æ€å˜é‡ï¼Œå¤§å°å–å†³äºŽç½‘ç»œçš„æ‹¥å¡žç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€åœ°åœ¨å˜åŒ–ã€‚<strong>å®žé™…ä¸Š TCP æ˜¯ç”¨å­—èŠ‚æ•°ä½œä¸ºçª—å£å¤§å°çš„å•ä½</strong>ã€‚ä½†ä¸ºå™è¿°æ–¹ä¾¿èµ·è§ï¼Œä¸‹é¢ç”¨æŠ¥æ–‡æ®µçš„ä¸ªæ•°ä½œä¸ºçª—å£å¤§å°çš„å•ä½ã€‚</p><p>TCP è¿›è¡Œæ‹¥å¡žæŽ§åˆ¶çš„ç®—æ³•æœ‰å››ç§ï¼Œå³<strong>æ…¢å¼€å§‹</strong>ï¼ˆslow-startï¼‰ã€<strong>æ‹¥å¡žé¿å…</strong>ï¼ˆcongestion avoidanceï¼‰ã€<strong>å¿«é‡ä¼ </strong>ï¼ˆfast retransmitï¼‰å’Œ<strong>å¿«æ¢å¤</strong>ï¼ˆfast recoveryï¼‰ã€‚</p><h2 id="æ…¢å¼€å§‹">æ…¢å¼€å§‹</h2><p>å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œç”±äºŽå¹¶ä¸æ¸…æ¥šç½‘ç»œçš„è´Ÿè·æƒ…å†µï¼Œæ‰€ä»¥å¦‚æžœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥ç½‘ç»œï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¼•èµ·ç½‘ç»œå‘ç”Ÿæ‹¥å¡žã€‚ç»éªŒè¯æ˜Žï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæŽ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢žå¤§å‘é€çª—å£ã€‚</p><p>åœ¨ä¸€å¼€å§‹å‘é€æ–¹å…ˆè®¾ç½® cwnd = 1ï¼Œå‘é€ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µ M1ï¼ŒæŽ¥æ”¶æ–¹æ”¶åˆ°åŽç¡®è®¤ M1ã€‚å‘é€æ–¹æ”¶åˆ°ç¡®è®¤åŽï¼ŒæŠŠ cwnd ä»Ž 1 å¢žå¤§åˆ° 2ï¼ŒäºŽæ˜¯å‘é€æ–¹æŽ¥ç€å‘é€ M2 å’Œ M3ã€‚<strong>å‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼ˆé‡ä¼ çš„ä¸ç®—åœ¨å†…ï¼‰å°±ä½¿æ‹¥å¡žçª—å£åŠ  1</strong>ï¼Œå› æ­¤å‘é€æ–¹åœ¨æ”¶åˆ°ä¸¤ä¸ªç¡®è®¤åŽï¼Œcwnd å°±ä»Ž 2 å¢žå¤§åˆ° 4ã€‚å› æ­¤ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•åŽï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡žçª—å£å°±åŠ å€ã€‚ï¼ˆåœ¨ TCP çš„å®žé™…è¿è¡Œä¸­ï¼Œå‘é€æ–¹åªè¦æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°æŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œå…¶æ‹¥å¡žçª—å£å°±ç«‹å³åŠ  1ï¼Œå¹¶å¯ä»¥ç«‹å³å‘é€æ–°çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸éœ€è¦ç­‰å¾…è¿™ä¸ªè½®æ¬¡ä¸­æ‰€æœ‰çš„ç¡®è®¤éƒ½æ”¶åˆ°åŽå†å‘é€æ–°çš„æŠ¥æ–‡æ®µã€‚ï¼‰</p><h2 id="æ‹¥å¡žé¿å…">æ‹¥å¡žé¿å…</h2><p>ä¸ºäº†é˜²æ­¢æ‹¥å¡žçª—å£å¢žé•¿è¿‡å¤§å¼•èµ·ç½‘ç»œæ‹¥å¡žï¼Œè¿˜éœ€è¦è®¾ç½®ä¸€ä¸ª<strong>æ…¢å¼€å§‹é—¨é™</strong> ssthreshï¼šå½“ cwnd &lt; ssthres hæ—¶ï¼Œä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼›å½“ cwnd &gt; ssthreshæ—¶ï¼Œè¯¥ç”¨æ‹¥å¡žé¿å…ç®—æ³•ï¼›å½“ cwnd = ssthresh æ—¶ï¼Œæ—¢å¯ä»¥ä½¿ç”¨æ…¢å¼€å§‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¥å¡žé¿å…ç®—æ³•ã€‚</p><p>æ‹¥å¡žé¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡žçª—å£ç¼“æ…¢åœ°å¢žå¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ª RTT å°±æŠŠæ‹¥å¡žçª—å£åŠ  1ï¼Œè€Œä¸æ˜¯åŠ å€å¢žé•¿ã€‚å½“ç½‘ç»œå‡ºçŽ°äº†è¶…æ—¶ï¼Œå‘é€æ–¹åˆ¤æ–­ä¸ºç½‘ç»œæ‹¥å¡žï¼Œè°ƒæ•´é—¨é™å€¼ ssthresh = cwnd / 2ï¼ŒåŒæ—¶è®¾ç½®æ‹¥å¡žçª—å£ cwnd = 1ï¼Œè¿›å…¥æ…¢å¼€å§‹é˜¶æ®µã€‚</p><p>æ‹¥å¡žé¿å…å¹¶éžèƒ½å¤Ÿé¿å…äº†æ‹¥å¡žï¼Œè€Œæ˜¯æŠŠæ‹¥å¡žçª—å£æŽ§åˆ¶ä¸ºæŒ‰çº¿æ€§è§„å¾‹å¢žé•¿ï¼Œä½¿ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºçŽ°æ‹¥å¡žã€‚</p><h2 id="å¿«é‡ä¼ ">å¿«é‡ä¼ </h2><p>æœ‰æ—¶ï¼Œä¸ªåˆ«æŠ¥æ–‡æ®µä¼šåœ¨ç½‘ç»œä¸­ä¸¢å¤±ï¼Œä½†å®žé™…ä¸Šç½‘ç»œå¹¶æœªå‘ç”Ÿæ‹¥å¡žã€‚å¦‚æžœå‘é€æ–¹è¿Ÿè¿Ÿæ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±ä¼šè¯¯è®¤ä¸ºç½‘ç»œå‘ç”Ÿäº†æ‹¥å¡žã€‚è¿™å°±å¯¼è‡´å‘é€æ–¹é”™è¯¯åœ°å¯åŠ¨æ…¢å¼€å§‹ï¼Œé™ä½Žäº†ä¼ è¾“æ•ˆçŽ‡ã€‚</p><p>é‡‡ç”¨å¿«é‡ä¼ ç®—æ³•å¯ä»¥è®©å‘é€æ–¹<strong>å°½æ—©çŸ¥é“å‘ç”Ÿäº†ä¸ªåˆ«æŠ¥æ–‡æ®µçš„ä¸¢å¤±</strong>ã€‚å¿«é‡ä¼ ç®—æ³•é¦–å…ˆè¦æ±‚æŽ¥æ”¶æ–¹ä¸è¦ç­‰å¾…è‡ªå·±å‘é€æ•°æ®æ—¶æ‰è¿›è¡ŒæŽå¸¦ç¡®è®¤ï¼Œè€Œæ˜¯è¦<strong>ç«‹å³å‘é€ç¡®è®¤</strong>ï¼Œå³ä½¿æ”¶åˆ°äº†å¤±åºçš„æŠ¥æ–‡æ®µä¹Ÿè¦ç«‹å³å‘å‡ºå¯¹å·²æ”¶åˆ°çš„æŠ¥æ–‡æ®µçš„<strong>é‡å¤ç¡®è®¤</strong>ã€‚æ¯”å¦‚ï¼ŒæŽ¥æ”¶æ–¹æ”¶åˆ° M2ï¼Œä½†æ²¡æ”¶åˆ° M3ã€‚åŽç»­åˆæ”¶åˆ°äº†å¤±åºæŠ¥æ–‡ M4ï½žM6ï¼Œæœ¬æ¥ï¼ŒæŽ¥æ”¶æ–¹å¯ä»¥ç›´æŽ¥ä¸¢å¼ƒå¤±åºæŠ¥æ–‡ã€‚ä½†æŒ‰ç…§å¿«é‡ä¼ ç®—æ³•ï¼ŒæŽ¥æ”¶æ–¹å¿…é¡»ç«‹å³å‘é€å¯¹ M2 çš„é‡å¤ç¡®è®¤ï¼Œä»¥ä¾¿è®©å‘é€æ–¹åŠæ—©çŸ¥é“æŽ¥æ”¶æ–¹æ²¡æœ‰æ”¶åˆ°æŠ¥æ–‡æ®µ M3ã€‚å¿«é‡ä¼ ç®—æ³•è§„å®šï¼Œå‘é€æ–¹åªè¦<strong>ä¸€è¿žæ”¶åˆ° 3 ä¸ªé‡å¤ç¡®è®¤</strong>ï¼Œåº”ç«‹å³è¿›è¡Œé‡ä¼ ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºçŽ°è¶…æ—¶ï¼Œå‘é€æ–¹ä¹Ÿå°±ä¸ä¼šè¯¯è®¤ä¸ºå‡ºçŽ°äº†ç½‘ç»œæ‹¥å¡žã€‚</p><h2 id="å¿«æ¢å¤">å¿«æ¢å¤</h2><p>å¿«é‡ä¼ å‘ç”Ÿæ—¶ï¼Œå‘é€æ–¹çŸ¥é“çŽ°åœ¨åªæ˜¯ä¸¢å¤±äº†ä¸ªåˆ«çš„æŠ¥æ–‡æ®µã€‚äºŽæ˜¯ä¸å¯åŠ¨æ…¢å¼€å§‹ï¼Œè€Œæ˜¯æ‰§è¡Œå¿«æ¢å¤ç®—æ³•ï¼šè°ƒæ•´é—¨é™å€¼ ssthresh = cwnd / 2ï¼ŒåŒæ—¶è®¾ç½®æ‹¥å¡žçª—å£ cwnd = ssthreshï¼Œå¹¶å¼€å§‹æ‰§è¡Œæ‹¥å¡žé¿å…ç®—æ³•ã€‚</p><p>ä¹Ÿæœ‰çš„å¿«æ¢å¤å®žçŽ°æ˜¯ä»¤ cwnd = ssthresh + 3 x MSSã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼šæ—¢ç„¶å‘é€æ–¹æ”¶åˆ° 3 ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œå°±è¡¨æ˜Žæœ‰ 3 ä¸ªåˆ†ç»„å·²ç»åˆ°è¾¾æŽ¥æ”¶æ–¹çš„ç¼“å­˜ä¸­ï¼Œå¯è§çŽ°åœ¨ç½‘ç»œä¸­å‡å°‘äº† 3 ä¸ªåˆ†ç»„ã€‚å› æ­¤å¯ä»¥é€‚å½“æŠŠæ‹¥å¡žçª—å£æ‰©å¤§äº›ã€‚</p><p>åœ¨æ‹¥å¡žé¿å…é˜¶æ®µï¼Œæ‹¥å¡žçª—å£æ˜¯æŒ‰ç…§çº¿æ€§è§„å¾‹å¢žå¤§çš„ï¼Œè¿™å¸¸ç§°ä¸º<strong>åŠ æ³•å¢žå¤§</strong> AIï¼ˆAdditive Increaseï¼‰ã€‚è€Œä¸€æ—¦å‡ºçŽ°è¶…æ—¶æˆ– 3 ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œå°±è¦æŠŠé—¨é™å€¼è®¾ç½®ä¸ºå½“å‰æ‹¥å¡žçª—å£å€¼çš„ä¸€åŠï¼Œå¹¶å¤§å¤§å‡å°æ‹¥å¡žçª—å£çš„æ•°å€¼ï¼Œè¿™å¸¸ç§°ä¸º<strong>ä¹˜æ³•å‡å°</strong> MDï¼ˆMultiplicative Decreaseï¼‰ã€‚äºŒè€…åˆåœ¨ä¸€èµ·å°±æ˜¯æ‰€è°“çš„ <strong>AIMD</strong> ç®—æ³•ã€‚</p><h2 id="ç»“åˆæµé‡æŽ§åˆ¶">ç»“åˆæµé‡æŽ§åˆ¶</h2><p>ä¸Šé¢çš„è®¨è®ºåŸºäºŽæŽ¥æ”¶æ–¹æ€»æ˜¯æœ‰è¶³å¤Ÿå¤§çš„ç¼“å­˜ç©ºé—´çš„å‡å®šï¼Œä½†å®žé™…ä¸ŠæŽ¥æ”¶æ–¹çš„ç¼“å­˜ç©ºé—´æ€»æ˜¯æœ‰é™çš„ã€‚å¦‚æžœæŠŠæ‹¥å¡žæŽ§åˆ¶å’Œæµé‡æŽ§åˆ¶ä¸€èµ·è€ƒè™‘ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œå‘é€æ–¹çš„çª—å£çš„ä¸Šé™å€¼åº”å½“å–æŽ¥æ”¶æ–¹çª—å£ rwnd å’Œæ‹¥å¡žçª—å£ cwnd ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚</p><h2 id="å…¨å±€åŒæ­¥">å…¨å±€åŒæ­¥</h2><p>ä¸ŠèŠ‚è®¨è®ºçš„æ‹¥å¡žæŽ§åˆ¶å¹¶æ²¡æœ‰å’Œç½‘ç»œå±‚é‡‡å–çš„ç­–ç•¥è”ç³»èµ·æ¥ã€‚ç½‘ç»œå±‚çš„ç­–ç•¥å¯¹æ‹¥å¡žæŽ§åˆ¶å½±å“æœ€å¤§çš„å°±æ˜¯<strong>è·¯ç”±å™¨çš„åˆ†ç»„ä¸¢å¼ƒç­–ç•¥</strong>ã€‚</p><p>åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œè·¯ç”±å™¨çš„é˜Ÿåˆ—é€šå¸¸éƒ½æ˜¯æŒ‰ç…§â€œå…ˆè¿›å…ˆå‡ºâ€ FIFOï¼ˆFirst In First Outï¼‰çš„è§„åˆ™å¤„ç†åˆ°æ¥çš„åˆ†ç»„ã€‚å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œä»¥åŽå†åˆ°è¾¾çš„åˆ†ç»„éƒ½å°†è¢«ä¸¢å¼ƒï¼Œè¿™å«åšâ€œå°¾éƒ¨ä¸¢å¼ƒç­–ç•¥â€ï¼ˆtail-drop policyï¼‰ã€‚å°¾éƒ¨ä¸¢å¼ƒå¾€å¾€ä¼šå¯¼è‡´ä¸€è¿žä¸²åˆ†ç»„çš„ä¸¢å¤±ï¼Œè¿™å°±ä½¿å‘é€æ–¹å‡ºçŽ°è¶…æ—¶é‡ä¼ ï¼Œä½¿ TCP è¿›å…¥æ…¢å¼€å§‹çŠ¶æ€ã€‚æ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œåœ¨ç½‘ç»œä¸­é€šå¸¸æœ‰å¾ˆå¤š TCP è¿žæŽ¥ï¼Œè¿™äº›è¿žæŽ¥ä¸­çš„æŠ¥æ–‡æ®µé€šå¸¸æ˜¯å¤ç”¨åœ¨ç½‘ç»œå±‚ä¸­çš„ IP æ•°æ®æŠ¥ä¸­ä¼ é€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè‹¥å‘ç”Ÿäº†å°¾éƒ¨ä¸¢å¼ƒï¼Œå°±å¯èƒ½ä¼šåŒæ—¶å½±å“åˆ°å¾ˆå¤šæ¡ TCP è¿žæŽ¥ï¼Œç»“æžœä½¿è¿™äº›è¿žæŽ¥åœ¨<strong>åŒä¸€æ—¶é—´</strong>çªç„¶éƒ½è¿›å…¥æ…¢å¼€å§‹çŠ¶æ€ã€‚è¿™åœ¨ TCP æœ¯è¯­ä¸­ç§°ä¸º<strong>å…¨å±€åŒæ­¥</strong>ï¼ˆglobal synchronizationï¼‰ã€‚å…¨å±€åŒæ­¥ä½¿å¾—å…¨ç½‘çš„é€šä¿¡é‡çªç„¶ä¸‹é™äº†å¾ˆå¤šï¼Œè€Œåœ¨ç½‘ç»œæ¢å¤æ­£å¸¸åŽï¼Œå…¶é€šä¿¡é‡åˆçªç„¶å¢žå¤§å¾ˆå¤šã€‚</p><h2 id="ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç†-aqm">ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç† AQM</h2><p>ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç†ï¼ˆActive Queue Managementï¼‰ï¼Œæ‰€è°“â€œä¸»åŠ¨â€å°±æ˜¯ä¸è¦ç­‰åˆ°è·¯ç”±å™¨çš„é˜Ÿåˆ—é•¿åº¦å·²ç»è¾¾åˆ°æœ€å¤§å€¼æ—¶æ‰ä¸å¾—ä¸ä¸¢å¼ƒåŽé¢åˆ°è¾¾çš„åˆ†ç»„ã€‚åº”å½“åœ¨é˜Ÿåˆ—é•¿åº¦åˆ°è¾¾æŸä¸ªå€¼å¾—è­¦æƒ•çš„æ•°å€¼æ—¶ï¼ˆå³å½“ç½‘ç»œæ‹¥å¡žæœ‰äº†æŸäº›å¾å…†æ—¶ï¼‰ï¼Œå°±ä¸»åŠ¨ä¸¢å¼ƒåˆ°è¾¾çš„åˆ†ç»„ã€‚è¿™æ ·å°±æé†’äº†å‘é€æ–¹æ”¾æ…¢å‘é€çš„é€ŸçŽ‡ï¼Œå› è€Œæœ‰å¯èƒ½ä½¿ç½‘ç»œæ‹¥å¡žçš„ç¨‹åº¦å‡è½»ï¼Œç”šè‡³ä¸å‡ºçŽ°ã€‚</p><p>AQM å¯ä»¥æœ‰ä¸åŒçš„å®žçŽ°æ–¹æ³•ï¼Œæ›¾æµè¡Œå¤šå¹´çš„å°±æ˜¯<strong>éšæœºæ—©æœŸæ£€æµ‹</strong> REDï¼ˆRandom Early Detectionï¼‰ã€‚å®žçŽ° RED æ—¶éœ€è¦è·¯ç”±å™¨ç»´æŒä¸¤ä¸ªå‚æ•°ï¼Œå³é˜Ÿåˆ—é•¿åº¦çš„æœ€å°é—¨é™å’Œæœ€å¤§é—¨é™ã€‚å½“æ¯ä¸€ä¸ªåˆ†ç»„åˆ°è¾¾æ—¶ï¼Œå°±æŒ‰ç…§è§„å®šçš„ç®—æ³•è®¡ç®—å½“å‰çš„å¹³å‡é˜Ÿåˆ—é•¿åº¦ï¼Œè‹¥å¹³å‡é˜Ÿåˆ—é•¿åº¦</p><ol type="1"><li>å°äºŽæœ€å°é—¨é™ï¼ŒæŽ¥æ”¶æ–°åˆ°è¾¾çš„åˆ†ç»„</li><li>å¤§äºŽæœ€å¤§é—¨é™ï¼Œä¸¢å¼ƒæ–°åˆ°è¾¾çš„åˆ†ç»„</li><li>ä»‹äºŽä¸¤è€…ä¹‹é—´ï¼ŒæŒ‰ç…§æŸä¸€ä¸¢å¼ƒæ¦‚çŽ‡ p ä¸¢å¼ƒæ–°åˆ°è¾¾çš„åˆ†ç»„</li></ol><p>åœ¨ RED çš„æ“ä½œä¸­ï¼Œæœ€éš¾å¤„ç†çš„å°±æ˜¯ä¸¢å¼ƒæ¦‚çŽ‡ p çš„é€‰æ‹©ï¼Œå› ä¸º p å¹¶ä¸æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å¯¹æ¯ä¸€ä¸ªåˆ°è¾¾çš„åˆ†ç»„ï¼Œéƒ½å¿…é¡»è®¡ç®— p çš„æ•°å€¼ã€‚å¤šå¹´çš„å®žè·µè¯æ˜Žï¼Œ<strong>RED çš„ä½¿ç”¨æ•ˆæžœå¹¶ä¸å¤ªç†æƒ³</strong>ã€‚ç›®å‰è¿˜æ²¡æœ‰ä¸€ç§ç®—æ³•èƒ½å¤Ÿæˆä¸º IEFT æ ‡å‡†ã€‚</p><h1 id="è¿žæŽ¥ç®¡ç†">è¿žæŽ¥ç®¡ç†</h1><p>è¿è¾“è¿žæŽ¥æœ‰ä¸‰ä¸ªé˜¶æ®µï¼š<strong>è¿žæŽ¥å»ºç«‹</strong>ã€<strong>æ•°æ®ä¼ é€</strong>å’Œ<strong>è¿žæŽ¥é‡Šæ”¾</strong>ã€‚åœ¨ TCP è¿žæŽ¥å»ºç«‹è¿‡ç¨‹ä¸­è¦è§£å†³ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol type="1"><li>è¦ä½¿æ¯ä¸€æ–¹éƒ½èƒ½ç¡®çŸ¥å¯¹æ–¹çš„å­˜åœ¨</li><li>è¦å…è®¸åŒæ–¹åå•†ä¸€äº›å‚æ•°ï¼ˆå¦‚æœ€å¤§çª—å£å€¼ï¼Œæ˜¯å¦ä½¿ç”¨çª—å£æ‰©å¤§é€‰é¡¹å’Œæ—¶é—´æˆ³é€‰é¡¹ä»¥åŠæœåŠ¡è´¨é‡ç­‰ï¼‰</li><li>èƒ½å¤Ÿå¯¹è¿è¾“å®žä½“èµ„æºï¼ˆå¦‚ç¼“å­˜å¤§å°ã€è¿žæŽ¥è¡¨ä¸­çš„é¡¹ç›®ç­‰ï¼‰è¿›è¡Œåˆ†é…</li></ol><h2 id="è¿žæŽ¥å»ºç«‹">è¿žæŽ¥å»ºç«‹</h2><p>ä¸‰æ¬¡æ¡æ‰‹ã€‚æ¡æ‰‹å¼€å§‹å‰ï¼ŒæœåŠ¡å™¨éœ€å¤„äºŽ LISTEN çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿žæŽ¥è¯·æ±‚ã€‚</p><p><img src="/uploads/image/computer-networking/three-way-handshake.jpg"></p><ol type="1"><li>å®¢æˆ·å‘å‡ºè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œå¹¶è¿›å…¥ SYN-SENT çŠ¶æ€ã€‚è¯·æ±‚æŠ¥æ–‡ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—ä¸€ä¸ªåºå· xã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚åŒæ„å»ºç«‹è¿žæŽ¥ï¼Œåˆ™å‘é€ç¡®è®¤æŠ¥æ–‡å¹¶è¿›å…¥ SYN-RCVD çŠ¶æ€ã€‚ç¡®è®¤æŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå· yã€‚</li><li>å®¢æˆ·æ”¶åˆ°ç¡®è®¤åŽï¼Œè¿˜è¦å‘é€å¯¹ç¡®è®¤çš„ç¡®è®¤ï¼Œä¹‹åŽè¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡å¯ä»¥æºå¸¦æ•°æ®ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°ç¡®è®¤çš„ç¡®è®¤åŽï¼Œä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚</li></ol><p><strong>æ³¨æ„</strong>ï¼šç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·å¯ä»¥æºå¸¦æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸æºå¸¦æ•°æ®ã€‚ä½†å¦‚æžœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ï¼Œä¸‹ä¸€ä¸ªæ•°æ®æŠ¥æ–‡æ®µçš„åºå·ä»æ˜¯ seq = x + 1ã€‚æºå¸¦æ•°æ®ï¼Œåˆ™æŒ‰ç…§æ•°æ®é•¿åº¦è®¡ç®—ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ã€‚</p><p>ä¸ºä»€ä¹ˆæœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿè¿™ä¸»è¦æ˜¯ä¸ºäº†<strong>é˜²æ­¢å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨</strong>ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯ã€‚è€ƒè™‘ä¸€ç§æƒ…å†µï¼šC å‘å‡ºè¿žæŽ¥è¯·æ±‚ï¼Œä½†è¿Ÿè¿Ÿæ²¡æœ‰æ”¶åˆ° S çš„ç¡®è®¤ã€‚äºŽæ˜¯ C é‡ä¼ ä¸€æ¬¡è¯·æ±‚ï¼ŒéšåŽæ”¶åˆ°äº†ç¡®è®¤ï¼Œå»ºç«‹äº†è¿žæŽ¥ã€‚æ•°æ®ä¼ è¾“å®Œæ¯•åŽï¼Œå°±é‡Šæ”¾äº†è¿žæŽ¥ã€‚çŽ°åœ¨å‡å®š C çš„ç¬¬ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡æ®µå¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æŸäº›ç½‘ç»œç»“ç‚¹é•¿æ—¶é—´æ»žç•™äº†ï¼Œä»¥è‡´å»¶è¯¯åˆ°è¿žæŽ¥é‡Šæ”¾ä»¥åŽçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾ Sã€‚æœ¬æ¥è¿™åº”æ˜¯ä¸€ä¸ªå¤±æ•ˆçš„è¯·æ±‚ï¼Œä½† S æ”¶åˆ°åŽå°±è¯¯ä»¥ä¸º C åˆå‘èµ·ä¸€æ¬¡æ–°çš„è¿žæŽ¥è¯·æ±‚ï¼ŒäºŽæ˜¯å‘ C å‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ„å»ºç«‹è¿žæŽ¥ã€‚å¦‚æžœæ²¡æœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ–°çš„è¿žæŽ¥å°±å·²ç»å»ºç«‹äº†ã€‚ç”±äºŽ C æ²¡æœ‰å‘å‡ºæ–°çš„è¯·æ±‚ï¼Œå› æ­¤ä¼šä¸¢å¼ƒç¡®è®¤æŠ¥æ–‡ã€‚ä½† S å´ä»¥ä¸ºæ–°çš„è¿žæŽ¥å·²ç»å»ºç«‹äº†ï¼Œå¹¶ä¸€ç›´åœ¨ç­‰å¾… C å‘æ¥æ•°æ®ã€‚S çš„è®¸å¤šèµ„æºå°±è¿™æ ·ç™½ç™½æµªè´¹äº†ã€‚</p><h2 id="è¿žæŽ¥é‡Šæ”¾">è¿žæŽ¥é‡Šæ”¾</h2><p>å››æ¬¡æŒ¥æ‰‹</p><p><img src="/uploads/image/computer-networking/four-way-handshake.jpg"></p><p>æ•°æ®ä¼ è¾“ç»“æŸåŽï¼ŒåŒæ–¹éƒ½å¯é‡Šæ”¾è¿žæŽ¥ï¼Œä¸‹é¢å‡è®¾å®¢æˆ·å…ˆå‘èµ·è¿žæŽ¥é‡Šæ”¾ã€‚</p><ol type="1"><li>å®¢æˆ·å‘é€é‡Šæ”¾æŠ¥æ–‡ï¼ˆFIN = 1ï¼‰ï¼Œè¿›å…¥ FIN-WAIT-1 çŠ¶æ€ã€‚FIN æŠ¥æ–‡å¯ä»¥æºå¸¦æ•°æ®ã€‚å³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°åŽå‘å‡ºç¡®è®¤ï¼Œè¿›å…¥ CLOSE-WAIT çŠ¶æ€ã€‚è¿™æ—¶ TCP å¤„äºŽåŠå…³é—­çŠ¶æ€ã€‚ä»ŽæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„è¿žæŽ¥å¹¶æœªå…³é—­ï¼Œè¿™ä¸ªçŠ¶æ€å¯èƒ½ä¼šæŒç»­ä¸€æ®µæ—¶é—´ã€‚</li><li>è‹¥æœåŠ¡å™¨æ²¡æœ‰æ•°æ®è¦å‘é€ï¼Œå°±é‡Šæ”¾è¿žæŽ¥ã€‚å‘é€é‡Šæ”¾æŠ¥æ–‡ï¼ˆFIN = 1ï¼‰ï¼Œå¹¶è¿›å…¥ LAST-ACK çŠ¶æ€ã€‚</li><li>å®¢æˆ·æ”¶åˆ°é‡Šæ”¾æŠ¥æ–‡åŽï¼Œå¿…é¡»å¯¹æ­¤ç¡®è®¤ã€‚æ³¨æ„ seq = u + 1ï¼Œå› ä¸ºå‰ä¸€ä¸ªå®¢æˆ·å‘å‡ºçš„é‡Šæ”¾æŠ¥æ–‡ï¼ˆè¿™é‡Œå‡è®¾æœªæºå¸¦æ•°æ®ï¼‰è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ç„¶åŽè¿›å…¥ TIMW-WAIT çŠ¶æ€ã€‚å¿…é¡»ç»è¿‡<strong>æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨</strong>ï¼ˆTIME-WAIT timerï¼‰è®¾ç½®çš„æ—¶é—´ 2MSL åŽï¼Œæ‰è¿›å…¥åˆ° CLOSED çŠ¶æ€ã€‚æ—¶é—´ MSL å«åš<strong>æœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½</strong>ï¼ˆMaximum Segment Lifetimeï¼‰ã€‚</li></ol><p>ä¸ºä»€ä¹ˆå¿…é¡»ç­‰å¾… 2MSL æ—¶é—´å‘¢ï¼Ÿè¿™æœ‰ä¸¤ä¸ªç†ç”±ï¼š</p><ol type="1"><li>ä¸ºäº†ä¿è¯å®¢æˆ·çš„æœ€åŽä¸€ä¸ª ACK æŠ¥æ–‡æ®µèƒ½å¤Ÿåˆ°è¾¾æœåŠ¡å™¨ã€‚è¿™ä¸ª ACK å¯èƒ½ä¼šä¸¢å¤±ï¼ŒæœåŠ¡å™¨è¿Ÿè¿Ÿæ”¶ä¸åˆ°å°±ä¼šé‡ä¼  FIN + ACK æŠ¥æ–‡æ®µï¼Œå®¢æˆ·å°±èƒ½åœ¨ 2MSL æ—¶é—´å†…æ”¶åˆ°é‡ä¼ çš„ FIN + ACK æŠ¥æ–‡æ®µã€‚æŽ¥ç€ï¼Œå‘é€ç¡®è®¤å¹¶é‡ç½®è®¡æ—¶å™¨ã€‚</li><li>é˜²æ­¢â€œå·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºçŽ°åœ¨æœ¬è¿žæŽ¥ä¸­ã€‚å®¢æˆ·å‘å‡ºæœ€åŽä¸€ä¸ª ACK æŠ¥æ–‡æ®µåŽï¼Œå†ç»è¿‡æ—¶é—´ 2MSLï¼Œå°±å¯ä»¥ä½¿æœ¬è¿žæŽ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»Žç½‘ç»œä¸Šæ¶ˆå¤±ã€‚è¿™æ ·ï¼Œä¸‹ä¸€ä¸ªæ–°çš„è¿žæŽ¥ä¸­å°±ä¸ä¼šå‡ºçŽ°æ—§çš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚</li></ol><p>é™¤äº†æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ï¼ŒTCP è¿˜è®¾æœ‰ä¸€ä¸ª<strong>ä¿æ´»è®¡æ—¶å™¨</strong>ï¼ˆkeepalive timerï¼‰ã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·çš„æ•°æ®ï¼Œå°±é‡ç½®ä¿æ´»è®¡æ—¶å™¨ï¼Œæ—¶é—´çš„è®¾ç½®é€šå¸¸æ˜¯ä¸¤å°æ—¶ã€‚è‹¥ä¸¤å°æ—¶æ²¡æœ‰æ”¶åˆ°å®¢æˆ·çš„æ•°æ®ï¼ŒæœåŠ¡å™¨å°±å‘é€ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åŽæ¯éš” 75 ç§’å‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿žå‘é€ 10 ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µåŽä»æ— å®¢æˆ·çš„å“åº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼ŒæŽ¥ç€å°±å…³é—­è¿™ä¸ªè¿žæŽ¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer Networking </tag>
            
            <tag> TCP </tag>
            
            <tag> UDP </tag>
            
            <tag> flow control </tag>
            
            <tag> congestion control </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Reverse Linked List</title>
      <link href="/programming/leetcode/reverse-linked-list/"/>
      <url>/programming/leetcode/reverse-linked-list/</url>
      
        <content type="html"><![CDATA[<h1 id="revserse-linked-list-i">Revserse Linked List I</h1><p>Reverse a singly linked list.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</span><br><span class="line">Output: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</span><br></pre></td></tr></table></figure><p>Follow up:</p><p>A linked list can be reversed either iteratively or recursively. Could you implement both?</p><h2 id="iteration">Iteration</h2><p>Given a linked list <code>1 -&gt; 2 -&gt; 3</code>, we think it as <code>None .&gt; 1 -&gt; 2 -&gt; 3 -&gt; None</code>, then change the pointers from left. Thus, we need change three pointers for a linked list with size 3. Don't forget the <code>next</code> in new tail node need to be <code>None</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Initial:  None .&gt; 1 -&gt; 2 -&gt; 3 -&gt; None</span><br><span class="line">           ^      ^</span><br><span class="line">          pre    cur</span><br><span class="line"></span><br><span class="line">Details when fix the pointers:</span><br><span class="line">    1. temp = cur.next</span><br><span class="line">    2. cur.next = pre</span><br><span class="line">    3. pre = cur</span><br><span class="line">    4. cur = temp</span><br><span class="line"></span><br><span class="line">(1)       None &lt;- 1    2 -&gt; 3 -&gt; None</span><br><span class="line">                  ^    ^</span><br><span class="line">                 pre  cur</span><br><span class="line"></span><br><span class="line">(2)       None &lt;- 1 &lt;- 2    3 -&gt; None</span><br><span class="line">                       ^    ^</span><br><span class="line">                      pre  cur</span><br><span class="line"></span><br><span class="line">(3)       None &lt;- 1 &lt;- 2 &lt;- 3    None</span><br><span class="line">                            ^     ^</span><br><span class="line">                           pre   cur</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseList</span><span class="params">(self, head: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line">        curr, prev = head, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> curr:</span><br><span class="line">            prev, prev.next, curr = curr, prev, curr.next</span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">            temp = curr.next</span></span><br><span class="line"><span class="string">            curr.next = prev</span></span><br><span class="line"><span class="string">            prev = curr</span></span><br><span class="line"><span class="string">            curr = temp</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line">        <span class="keyword">return</span> prev</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="recursion">Recursion</h2><p>The recursive version is slightly trickier and the key is to work backwards. Assume that the rest of the list had already been reversed, now how do I reverse the front part? Let's assume the list is: <span class="math inline">\(n_1 \rightarrow \dots \rightarrow n_{k-1} \rightarrow n_k \rightarrow n_{k+1} \rightarrow \dots \rightarrow n_m \rightarrow \emptyset\)</span>.</p><p>Assume from node <span class="math inline">\(n_{k+1}\)</span> to <span class="math inline">\(n_m\)</span> had been reversed and you are at node <span class="math inline">\(n_k\)</span>: <span class="math inline">\(n_1 \rightarrow \dots \rightarrow n_{k-1} \rightarrow n_k \rightarrow n_{k+1} \leftarrow \dots \leftarrow n_m\)</span>.</p><p>We want <span class="math inline">\(n_{k+1}\)</span>â€™s next node to point to <span class="math inline">\(n_k\)</span>. So, <span class="math inline">\(n_k\)</span>.next.next = <span class="math inline">\(n_k\)</span>;</p><p>Be very careful that <span class="math inline">\(n_1\)</span>'s next must point to <span class="math inline">\(\emptyset\)</span>. If you forget about this, your linked list has a cycle in it. This bug could be caught if you test your code with a linked list of size 2.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">n1 -&gt; n2 -&gt; n3 -&gt; None</span><br><span class="line"></span><br><span class="line">reverseList(n1):</span><br><span class="line">    reverseList(n2):</span><br><span class="line">        reverseList(n3):</span><br><span class="line">            return n3</span><br><span class="line">        p = n3</span><br><span class="line">        n2.next.next = n2</span><br><span class="line">        n2.next = None</span><br><span class="line">        return n3        (n1 -&gt; n2 &lt;- n3)</span><br><span class="line">                                |-&gt; None</span><br><span class="line">    p = n3</span><br><span class="line">    n1.next.next = n1</span><br><span class="line">    n1.next = None       (None &lt;- n1 &lt;- n2 &lt;- n3)</span><br><span class="line">    return n3</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseList</span><span class="params">(self, head: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line">        p = self.reverseList(head.next)  <span class="comment"># return new head</span></span><br><span class="line">        head.next.next = head  <span class="comment"># old head is the new tail</span></span><br><span class="line">        head.next = <span class="literal">None</span>  <span class="comment"># set tail.next to None</span></span><br><span class="line">        <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure><h1 id="reverse-linked-list-ii">Reverse Linked List II</h1><p>Reverse a linked list from position m to n. <strong>Do it in one-pass</strong>.</p><p>Note: <span class="math inline">\(1 \le m \le n \le\)</span> length of list.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, m = 2, n = 4</span><br><span class="line">Output: 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;NULL</span><br></pre></td></tr></table></figure><h2 id="iteration-1">Iteration</h2><p>Given a linked list initially with elements <code>7 -&gt; 9 -&gt; 2 -&gt; 10 -&gt; 1 -&gt; 8 -&gt; 6</code> and we need to reverse the list from node 3 throught 6.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  None .&gt; 7 -&gt; 9 -&gt; 2 -&gt; 10 -&gt; 1 -&gt; 8 -&gt; 6 -&gt; None</span><br><span class="line">   ^      ^</span><br><span class="line">  pre    cur</span><br><span class="line"></span><br><span class="line">Step forward until cur reach the node 3:</span><br><span class="line"></span><br><span class="line">  None .&gt; 7 -&gt; 9 -&gt; 2 -&gt; 10 -&gt; 1 -&gt; 8 -&gt; 6 -&gt; None</span><br><span class="line">               ^    ^</span><br><span class="line">              pre  cur</span><br><span class="line">              con  tail</span><br><span class="line"></span><br><span class="line">Fix connections until pre reach node 6:</span><br><span class="line"></span><br><span class="line">  None .&gt; 7 -&gt; 9 &lt;-&gt; 2 &lt;- 10 &lt;- 1 &lt;- 8    6 -&gt; None</span><br><span class="line">               ^     ^               ^    ^</span><br><span class="line">              con   tai             pre  cur</span><br><span class="line"></span><br><span class="line">Adjust connections:  con -&gt; pre  tail -&gt; cur</span><br><span class="line"></span><br><span class="line">  None .&gt; 7 -&gt; 9 -&gt; 8 -&gt; 1 -&gt; 10 -&gt; 2 -&gt; 6 -&gt; None</span><br><span class="line">               ^    ^               ^    ^</span><br><span class="line">              con  pre             tail cur</span><br><span class="line"></span><br><span class="line">Be careful that con is None when m = 1.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseBetween</span><span class="params">(self, head: ListNode, m: int, n: int)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Move the pointers until they reach the proper starting point</span></span><br><span class="line">        pre, cur = <span class="literal">None</span>, head</span><br><span class="line">        <span class="keyword">while</span> m &gt; <span class="number">1</span>:</span><br><span class="line">            pre, cur = cur, cur.next</span><br><span class="line">            m, n = m - <span class="number">1</span>, n - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># The two pointers that will fix the final connections</span></span><br><span class="line">        con, tail = pre, cur</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Iteratively reverse the nodes</span></span><br><span class="line">        <span class="keyword">while</span> n:</span><br><span class="line">            pre, pre.next, cur = cur, pre, cur.next</span><br><span class="line">            n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Adjust the final connections</span></span><br><span class="line">        <span class="keyword">if</span> con:</span><br><span class="line">            con.next = pre</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            head = pre</span><br><span class="line">        tail.next = cur</span><br><span class="line">        <span class="keyword">return</span> head</span><br></pre></td></tr></table></figure><h2 id="recursion-1">Recursion</h2><p>The recursive function to reverse a linked list:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseList</span><span class="params">(self, head: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line">        p = self.reverseList(head.next)  <span class="comment"># return new head</span></span><br><span class="line">        head.next.next = head  <span class="comment"># old head is the new tail</span></span><br><span class="line">        head.next = <span class="literal">None</span>  <span class="comment"># set tail.next to None</span></span><br><span class="line">        <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure><p>To reverse first n elements:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseN</span><span class="params">(self, head: ListNode, n: int)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        successor = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(head, n)</span>:</span></span><br><span class="line">            <span class="keyword">nonlocal</span> successor</span><br><span class="line">            <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">                successor = head.next</span><br><span class="line">                <span class="keyword">return</span> head  <span class="comment"># new tail</span></span><br><span class="line">            p = helper(head.next, n - <span class="number">1</span>)</span><br><span class="line">            head.next.next = head</span><br><span class="line">            head.next = successor</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(head, n)</span><br></pre></td></tr></table></figure><p>Finally, solve the problem:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseBetween</span><span class="params">(self, head: ListNode, m: int, n: int)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> self.reverseN(head, n)</span><br><span class="line">        head.next = self.reverseBetween(head.next, m - <span class="number">1</span>, n - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> head</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linked list </tag>
            
            <tag> reverse </tag>
            
            <tag> recursion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Populating Next Right Pointers in Each Node</title>
      <link href="/programming/leetcode/populating-next-right-pointers-in-each-node/"/>
      <url>/programming/leetcode/populating-next-right-pointers-in-each-node/</url>
      
        <content type="html"><![CDATA[<p>You are given a <strong>perfect binary tree</strong> where all leaves are on the same level, and every parent has two children. The binary tree has the following definition:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct Node &#123;</span><br><span class="line">  int val;</span><br><span class="line">  Node *left;</span><br><span class="line">  Node *right;</span><br><span class="line">  Node *next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Populate each next pointer to point to its next right node. If there is no next right node, the next pointer should be set to <code>NULL</code>.</p><p>Initially, all next pointers are set to <code>NULL</code>.</p><p><strong>Follow up</strong>:</p><ul><li>You may only use constant extra space.</li><li>Recursive approach is fine, you may assume implicit stack space does not count as extra space for this problem.</li></ul><p>Example 1:</p><p><img src="/uploads/image/leetcode/connect_next.png"></p><p>Given the above perfect binary tree (Figure A), your function should populate each next pointer to point to its next right node, just like in Figure B.</p><p>Constraints:</p><ul><li>The number of nodes in the given tree is less than 4096.</li><li><code>-1000 &lt;= node.val &lt;= 1000</code></li></ul><h1 id="level-order-traversal">Level Order Traversal</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self, root: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line">        level = deque([root])</span><br><span class="line">        <span class="keyword">while</span> level:</span><br><span class="line">            n = len(level)</span><br><span class="line">            <span class="keyword">while</span> n:</span><br><span class="line">                cur = level.popleft()</span><br><span class="line">                n -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> n:  <span class="comment"># n &gt; 0 means level[0] and cur are in one level</span></span><br><span class="line">                    cur.next = level[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> cur.left:</span><br><span class="line">                    level.append(cur.left)</span><br><span class="line">                <span class="keyword">if</span> cur.right:</span><br><span class="line">                    level.append(cur.right)</span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="without-extra-space">Without extra space</h1><p>Utilize the next pointers constructed before to visit a level from left to right. For each node visited:</p><ol type="1"><li>connect left child and right child.</li><li>connect right child and left child of next node.</li></ol><p>Then, go to next level. Repeat two steps for each node.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Initial:</span><br><span class="line"></span><br><span class="line">         1</span><br><span class="line">     /       \</span><br><span class="line">   2           3</span><br><span class="line"> /   \       /   \</span><br><span class="line">4     5     6     7</span><br><span class="line"></span><br><span class="line">cur = root, fix the pointers of root&apos;s children:</span><br><span class="line"></span><br><span class="line">         1</span><br><span class="line">     /       \</span><br><span class="line">   2    --&gt;    3</span><br><span class="line"> /   \       /   \</span><br><span class="line">4     5     6     7</span><br><span class="line"></span><br><span class="line">Fix the pointers of node 2:</span><br><span class="line"></span><br><span class="line">         1</span><br><span class="line">     /       \</span><br><span class="line">   2    --&gt;    3</span><br><span class="line"> /   \       /   \</span><br><span class="line">4 --&gt; 5 --&gt; 6    7</span><br><span class="line"></span><br><span class="line">Fix the pointers of node 3:</span><br><span class="line"></span><br><span class="line">         1</span><br><span class="line">     /       \</span><br><span class="line">   2    --&gt;    3</span><br><span class="line"> /   \       /   \</span><br><span class="line">4 --&gt; 5 --&gt; 6 --&gt; 7</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self, root: Node)</span> -&gt; Node:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">        level = root</span><br><span class="line">        <span class="keyword">while</span> level.left:  <span class="comment"># è¿›è¡Œåˆ°å€’æ•°ç¬¬äºŒå±‚ï¼Œä¿®æ”¹ä¸‹ä¸€å±‚çš„æŒ‡é’ˆ</span></span><br><span class="line">            cur = level</span><br><span class="line">            <span class="keyword">while</span> cur:</span><br><span class="line">                <span class="comment"># è¿žæŽ¥èŠ‚ç‚¹çš„å·¦å³å­©å­èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> cur.left:</span><br><span class="line">                    cur.left.next = cur.right</span><br><span class="line">                <span class="comment"># è¿žæŽ¥å³èŠ‚ç‚¹ä¸Žä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> cur.next:</span><br><span class="line">                    cur.right.next = cur.next.left</span><br><span class="line">                cur = cur.next  <span class="comment"># å¯¹ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹åšåŒæ ·æ“ä½œ</span></span><br><span class="line">            level = level.left</span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure><h1 id="recursion">Recursion</h1><p>For each node, we did two steps. This hint us recursion.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self, root: Node)</span> -&gt; Node:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> node.left:  <span class="comment"># æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">                node.left.next = node.right</span><br><span class="line">                <span class="keyword">if</span> node.next:  <span class="comment"># æœ‰å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">                    node.right.next = node.next.left</span><br><span class="line">                helper(node.left)  <span class="comment"># é€’å½’å…¶å­èŠ‚ç‚¹</span></span><br><span class="line">                helper(node.right)</span><br><span class="line"></span><br><span class="line">        helper(root)</span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> tree </tag>
            
            <tag> traversal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Binary Tree Right Side View</title>
      <link href="/programming/leetcode/binary-tree-right-side-view/"/>
      <url>/programming/leetcode/binary-tree-right-side-view/</url>
      
        <content type="html"><![CDATA[<p>Given a binary tree, imagine yourself standing on the right side of it, return the values of the nodes you can see ordered from top to bottom.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,null,5,null,4]</span><br><span class="line">Output: [1, 3, 4]</span><br><span class="line">Explanation:</span><br><span class="line"></span><br><span class="line">   1            &lt;---</span><br><span class="line"> /   \</span><br><span class="line">2     3         &lt;---</span><br><span class="line"> \     \</span><br><span class="line">  5     4       &lt;---</span><br></pre></td></tr></table></figure><h1 id="level-order-traversal">Level Order Traversal</h1><p>Return the list that contains the last node in each order.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rightSideView</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        level, res = deque([root]), []</span><br><span class="line">        node = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> level:</span><br><span class="line">            n = len(level)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(n):</span><br><span class="line">                node = level.popleft()</span><br><span class="line">                <span class="keyword">if</span> node.left:</span><br><span class="line">                    level.append(node.left)</span><br><span class="line">                <span class="keyword">if</span> node.right:</span><br><span class="line">                    level.append(node.right)</span><br><span class="line">            res.append(node.val)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="preorder">Preorder</h1><p>Modify the pre order traversal, we visit the node first, then right child, finally left child.</p><p>The first node we visit at each level is the rightmost. So we need to save the depth for each node.</p><h2 id="iteration">Iteration</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rightSideView</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        stack, res = [(root, <span class="number">1</span>)], []</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            node, depth = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> depth &gt; len(res):</span><br><span class="line">                res.append(node.val)</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                stack.append((node.left, depth + <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                stack.append((node.right, depth + <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="recursion">Recursion</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rightSideView</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node, depth, ans)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> depth &gt; len(ans):  <span class="comment"># meet the rightmost</span></span><br><span class="line">                ans.append(node.val)</span><br><span class="line">            <span class="keyword">if</span> node.right:</span><br><span class="line">                helper(node.right, depth + <span class="number">1</span>, ans)</span><br><span class="line">            <span class="keyword">if</span> node.left:</span><br><span class="line">                helper(node.left, depth + <span class="number">1</span>, ans)</span><br><span class="line"></span><br><span class="line">        res = []</span><br><span class="line">        helper(root, <span class="number">1</span>, res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> binary tree </tag>
            
            <tag> traversal </tag>
            
            <tag> level order </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Balanced Binary Tree</title>
      <link href="/programming/leetcode/balanced-binary-tree/"/>
      <url>/programming/leetcode/balanced-binary-tree/</url>
      
        <content type="html"><![CDATA[<p>Given a binary tree, determine if it is height-balanced.</p><p>For this problem, a height-balanced binary tree is defined as:</p><blockquote><p>a binary tree in which the left and right subtrees of every node differ in height by no more than 1.</p></blockquote><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">       1</span><br><span class="line">      / \</span><br><span class="line">     2   2</span><br><span class="line">    / \</span><br><span class="line">   3   3</span><br><span class="line">  / \</span><br><span class="line"> 4   4</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h1 id="top-down-recursion">Top-Down Recursion</h1><p>First, calculate max depth of children. Then, compare them, if balanced, check children recursively; if not, return False.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(nlog(n))</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isBalanced</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        left_depth = self.maxDepth(root.left)</span><br><span class="line">        right_depth = self.maxDepth(root.right)</span><br><span class="line">        <span class="keyword">if</span> abs(left_depth - right_depth) &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> self.isBalanced(root.left) <span class="keyword">and</span> self.isBalanced(root.right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxDepth</span><span class="params">(self, root: TreeNode)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        left_depth = self.maxDepth(root.left)</span><br><span class="line">        right_depth = self.maxDepth(root.right)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + max(left_depth, right_depth)</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="bottom-up-recursion">Bottom-Up Recursion</h1><p>Top-Down recursion is slower than Bottom-Up recursion.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isBalanced</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node)</span>:</span>  <span class="comment"># variation of maximum height</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            left_depth = helper(node.left)</span><br><span class="line">            <span class="keyword">if</span> left_depth == <span class="number">-1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>  <span class="comment"># -1 is a flag that a tree is not balanced</span></span><br><span class="line">            right_depth = helper(node.right)</span><br><span class="line">            <span class="keyword">if</span> right_depth == <span class="number">-1</span> <span class="keyword">or</span> abs(left_depth - right_depth) &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">            <span class="keyword">return</span> max(left_depth, right_depth) + <span class="number">1</span>  <span class="comment"># return true depth when balanced</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(root) != <span class="number">-1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> binary tree </tag>
            
            <tag> balanced binary tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LRU Cache</title>
      <link href="/programming/leetcode/lru-cache/"/>
      <url>/programming/leetcode/lru-cache/</url>
      
        <content type="html"><![CDATA[<p>Design and implement a data structure for Least Recently Used (LRU) cache. It should support the following operations: get and put.</p><p><code>get(key)</code> - Get the value (will always be positive) of the key if the key exists in the cache, otherwise return -1. <code>put(key, value)</code> - Set or insert the value if the key is not already present. When the cache reached its capacity, it should invalidate the least recently used item before inserting a new item.</p><p>The cache is initialized with a <strong>positive</strong> capacity.</p><p><strong>Follow up</strong>:</p><p>Could you do both operations in <code>O(1)</code> time complexity?</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LRUCache cache = new LRUCache( 2 /* capacity */ );</span><br><span class="line"></span><br><span class="line">cache.put(1, 1);</span><br><span class="line">cache.put(2, 2);</span><br><span class="line">cache.get(1);       // returns 1</span><br><span class="line">cache.put(3, 3);    // evicts key 2</span><br><span class="line">cache.get(2);       // returns -1 (not found)</span><br><span class="line">cache.put(4, 4);    // evicts key 1</span><br><span class="line">cache.get(1);       // returns -1 (not found)</span><br><span class="line">cache.get(3);       // returns 3</span><br><span class="line">cache.get(4);       // returns 4</span><br></pre></td></tr></table></figure><h1 id="hash-table-linked-list">Hash Table + Linked List</h1><p>Using double linked list to save the order. Define the node near the head is newer, near the tail is older. Used double linked list so we can move any node to the head.</p><p>Do get and put in <code>O(1)</code> time, we need a hash table.</p><p>When the size of linked list is large than capacity, remove the tail (oldest) node. We also need to remove the correspond key in hash table, so the key should be saved in linked list node.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DLinkedNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key=<span class="number">0</span>, value=<span class="number">0</span>, prev=None, next=None)</span>:</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.value = value</span><br><span class="line">        self.prev = prev</span><br><span class="line">        self.next = next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, capacity: int)</span>:</span></span><br><span class="line">        self.capacity = capacity</span><br><span class="line">        self.cache = dict()</span><br><span class="line">        self.size = <span class="number">0</span></span><br><span class="line">        self.head, self.tail = DLinkedNode(), DLinkedNode()</span><br><span class="line">        self.head.next, self.tail.prev = self.tail, self.head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.cache:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        node = self.cache[key]</span><br><span class="line">        self.move_to_head(node)</span><br><span class="line">        <span class="keyword">return</span> node.value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, key: int, value: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.cache:</span><br><span class="line">            node = DLinkedNode(key, value)</span><br><span class="line">            self.add_to_head(node)  <span class="comment"># å†™ç¼“å­˜</span></span><br><span class="line">            self.cache[key] = node</span><br><span class="line">            self.size += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.size &gt; self.capacity:  <span class="comment"># åˆ ç¼“å­˜</span></span><br><span class="line">                node = self.remove_tail()</span><br><span class="line">                <span class="keyword">del</span> self.cache[node.key]</span><br><span class="line">                self.size -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = self.cache[key]  <span class="comment"># è¦†ç›–ç¼“å­˜</span></span><br><span class="line">            node.value = value</span><br><span class="line">            self.move_to_head(node)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_to_head</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        self.head.next.prev, node.next = node, self.head.next</span><br><span class="line">        self.head.next, node.prev = node, self.head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move_to_head</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.head.next != node:</span><br><span class="line">            self.remove_node(node)</span><br><span class="line">            self.add_to_head(node)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove_node</span><span class="params">(node)</span>:</span></span><br><span class="line">        node.prev.next = node.next</span><br><span class="line">        node.next.prev = node.prev</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove_tail</span><span class="params">(self)</span>:</span></span><br><span class="line">        node = self.tail.prev</span><br><span class="line">        self.remove_node(node)</span><br><span class="line">        <span class="keyword">return</span> node</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="ordereddict">OrderedDict</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span><span class="params">(collections.OrderedDict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, capacity: int)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.capacity = capacity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        self.move_to_end(key)</span><br><span class="line">        <span class="keyword">return</span> self[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, key: int, value: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self:</span><br><span class="line">            self.move_to_end(key)</span><br><span class="line">        self[key] = value</span><br><span class="line">        <span class="keyword">if</span> len(self) &gt; self.capacity:</span><br><span class="line">            self.popitem(last=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> OrderedDict </tag>
            
            <tag> linked list </tag>
            
            <tag> hash table </tag>
            
            <tag> LRU </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åº”ç”¨å±‚</title>
      <link href="/notes/computer-networking/application-layer/"/>
      <url>/notes/computer-networking/application-layer/</url>
      
        <content type="html"><![CDATA[<p>åº”ç”¨å±‚çš„è®¸å¤šåè®®éƒ½æ˜¯åŸºäºŽå®¢æˆ·æœåŠ¡å™¨æ¨¡å¼ã€‚å³ä½¿æ˜¯ P2P å¯¹ç­‰é€šä¿¡æ–¹å¼ï¼Œå®žè´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ã€‚å®¢æˆ·ï¼ˆclientï¼‰å’ŒæœåŠ¡å™¨ï¼ˆserverï¼‰éƒ½æ˜¯æŒ‡é€šä¿¡ä¸­æ‰€æ¶‰åŠçš„ä¸¤ä¸ªåº”ç”¨è¿›ç¨‹ã€‚æ˜¯æœåŠ¡è¯·æ±‚æ–¹ï¼ŒæœåŠ¡å™¨æ˜¯æœåŠ¡æä¾›æ–¹ã€‚</p><h1 id="dns">DNS</h1><p>åŸŸåç³»ç»Ÿ DNSï¼ˆDomain Name Systemï¼‰ç”¨æ¥æŠŠä¾¿äºŽäººä»¬ä½¿ç”¨çš„æœºå™¨åå­—è½¬æ¢ä¸º IP åœ°å€ã€‚</p><p>ä¸ºä»€ä¹ˆæœºå™¨åœ¨å¤„ç† IP æ•°æ®æŠ¥æ—¶è¦ä½¿ç”¨ IP åœ°å€è€Œä¸ä½¿ç”¨åŸŸåå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º IP åœ°å€çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼ˆIPv4 å›ºå®š 32 ä½ï¼ŒIPv6 å›ºå®š 128 ä½ï¼‰ï¼Œè€ŒåŸŸåçš„é•¿åº¦å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œæœºå™¨å¤„ç†èµ·æ¥æ¯”è¾ƒå›°éš¾ã€‚</p><p>DNS è¢«è®¾è®¡æˆä¸ºä¸€ä¸ªè”æœºåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿï¼Œå¹¶é‡‡ç”¨å®¢æœæœåŠ¡å™¨æ–¹å¼ã€‚<strong>DNS ä½¿å¤§å¤šæ•°åå­—éƒ½åœ¨æœ¬åœ°è¿›è¡Œè§£æžï¼Œä»…å°‘é‡è§£æžéœ€è¦åœ¨äº’è”ç½‘ä¸Šé€šä¿¡ï¼Œå› æ­¤ DNS çš„æ•ˆçŽ‡å¾ˆé«˜</strong>ã€‚ç”±äºŽ DNS æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå³ä½¿å•ä¸ªè®¡ç®—æœºå‡ºäº†æ•…éšœï¼Œä¹Ÿä¸ä¼šå¦¨ç¢æ•´ä¸ª DNS ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚</p><h2 id="åŸŸåæœåŠ¡å™¨">åŸŸåæœåŠ¡å™¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ ¹åŸŸåæœåŠ¡å™¨                   æ ¹åŸŸåæœåŠ¡å™¨</span><br><span class="line">                          /     |       \</span><br><span class="line">é¡¶çº§åŸŸåæœåŠ¡å™¨  org åŸŸåæœåŠ¡å™¨  com åŸŸåæœåŠ¡å™¨  edu åŸŸåæœåŠ¡å™¨  ...</span><br><span class="line">                                |</span><br><span class="line">æƒé™åŸŸåæœåŠ¡å™¨                 abc.com åŸŸåæœåŠ¡å™¨</span><br><span class="line">                                |</span><br><span class="line">                            y.abc.com åŸŸåæœåŠ¡å™¨</span><br></pre></td></tr></table></figure><ul><li>æ ¹åŸŸåæœåŠ¡å™¨ï¼ˆroot name serverï¼‰çŸ¥é“æ‰€æœ‰çš„é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åŸŸåå’Œ IP åœ°å€ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨åœ¨å¯¹ä¸€ä¸ªåŸŸåè¿›è¡Œè§£æžæ—¶ï¼Œåªè¦è‡ªå·±æ— æ³•è§£æžï¼Œå°±é¦–å…ˆè¦æ±‚åŠ©äºŽæ ¹åŸŸåæœåŠ¡å™¨ã€‚<ul><li>æ ¹åŸŸåæœåŠ¡å™¨é‡‡ç”¨<strong>ä»»æ’­</strong>ï¼ˆä»»æ’­çš„ IP æ•°æ®æŠ¥çš„ç»ˆç‚¹æ˜¯ä¸€ç»„åœ¨ä¸åŒåœ°ç‚¹çš„ä¸»æœºï¼Œä½†å…·æœ‰ç›¸åŒçš„ IP åœ°å€ã€‚IP æ•°æ®æŠ¥äº¤ä»˜ç¦»æºç‚¹æœ€è¿‘çš„ä¸€å°ä¸»æœºã€‚ï¼‰æŠ€æœ¯ï¼Œå½“ DNS å®¢æˆ·å‘æŸä¸ªæ ¹åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€å‘å‡ºæŸ¥è¯¢æŠ¥æ–‡æ—¶ï¼Œè·¯ç”±èƒ½æ‰¾åˆ°ç¦»è¿™ä¸ª DNS å®¢æˆ·æœ€è¿‘çš„ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨ã€‚è¿™æ ·åšä¸ä»…åŠ å¿«äº† DNS çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œä¹Ÿæ›´åŠ åˆç†åœ°åˆ©ç”¨äº†äº’è”ç½‘çš„èµ„æºã€‚</li><li>æ ¹åŸŸåæœåŠ¡å™¨å¹¶ä¸ç›´æŽ¥æŠŠå¾…æŸ¥è¯¢çš„åŸŸåç›´æŽ¥è½¬æ¢æˆ IP åœ°å€ï¼ˆæ ¹åŸŸåæœåŠ¡å™¨ä¹Ÿæ²¡æœ‰å­˜æ”¾è¿™ç§ä¿¡æ¯ï¼‰ï¼Œè€Œæ˜¯å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸‹ä¸€æ­¥åº”å½“æ‰¾å“ªä¸€ä¸ªé¡¶çº§åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ã€‚</li></ul></li><li>é¡¶çº§åŸŸåï¼ˆTLDï¼‰æœåŠ¡å™¨è´Ÿè´£ç®¡ç†åœ¨è¯¥é¡¶çº§åŸŸåæœåŠ¡å™¨æ³¨å†Œçš„æ‰€æœ‰äºŒçº§åŸŸåã€‚å½“æ”¶åˆ° DNS æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œå°±ç»™å‡ºç›¸åº”çš„å›žç­”ï¼ˆå¯èƒ½æ˜¯æœ€åŽçš„ç»“æžœï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸‹ä¸€æ­¥åº”å½“æ‰¾çš„åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€ï¼‰ã€‚</li><li>æƒé™åŸŸåæœåŠ¡å™¨æ˜¯è´Ÿè´£ä¸€ä¸ªåŒºçš„åŸŸåæœåŠ¡å™¨ã€‚ä¾‹å¦‚åŒº abc.com å’ŒåŒº y.abc.com å„è®¾æœ‰ä¸€ä¸ªæƒé™åŸŸåæœåŠ¡å™¨ã€‚</li><li>æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼ˆlocal name serverï¼‰ä¸å±žäºŽä¸Šé¢æ‰€ç¤ºçš„åŸŸåæœåŠ¡å™¨å±‚æ¬¡ç»“æž„ï¼Œä½†å®ƒå¯¹åŸŸåç³»ç»Ÿéžå¸¸é‡è¦ã€‚å½“ä¸€å°ä¸»æœºå‘å‡º DNS æŸ¥è¯¢è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡å°±å‘é€ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ã€‚æ¯ä¸€ä¸ªäº’è”ç½‘æœåŠ¡æä¾›è€… ISPï¼Œæˆ–ä¸€ä¸ªå¤§å­¦ï¼Œç”šè‡³ä¸€ä¸ªå¤§å­¦é‡Œçš„ç³»ï¼Œéƒ½å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºé»˜è®¤åŸŸåæœåŠ¡å™¨ã€‚</li></ul><h2 id="é€’å½’è¿­ä»£-æŸ¥è¯¢">é€’å½’/è¿­ä»£ æŸ¥è¯¢</h2><p>ä¸»æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨<strong>é€’å½’æŸ¥è¯¢</strong>ï¼ˆrecursive queryï¼‰ã€‚å¦‚æžœæœ¬åœ°åŸŸåæœåŠ¡å™¨æ— æ³•è§£æžï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±ä»¥ DNS å®¢æˆ·çš„èº«ä»½ï¼Œå‘æ ¹åŸŸåæœåŠ¡å™¨å‘å‡ºæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡ã€‚</p><p>æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢é€šå¸¸æ˜¯é‡‡ç”¨<strong>è¿­ä»£æŸ¥è¯¢</strong>ï¼ˆiterative queryï¼‰ã€‚æ ¹åŸŸåæœåŠ¡å™¨é€šå¸¸æ˜¯æŠŠè‡ªå·±çŸ¥é“çš„é¡¶çº§åŸŸåæœåŠ¡å™¨çš„ IP åœ°å€å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œè®©æœ¬åœ°åŸŸåæœåŠ¡å™¨å†å‘é¡¶çº§åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ã€‚</p><p>ä¸ºäº†æé«˜ DNS æŸ¥è¯¢æ•ˆçŽ‡ï¼Œå¹¶å‡è½»æ ¹åŸŸåæœåŠ¡å™¨çš„è´Ÿè·å’Œå‡å°‘äº’è”ç½‘ä¸Šçš„ DNS æŸ¥è¯¢æŠ¥æ–‡æ•°é‡ï¼Œåœ¨åŸŸåæœåŠ¡å™¨ä¸­å¹¿æ³›ä½¿ç”¨äº†<strong>é«˜é€Ÿç¼“å­˜</strong>ã€‚åå­—åˆ°åœ°å€çš„ç»‘å®šå¹¶ä¸ç»å¸¸æ”¹å˜ï¼Œä¸ºä¿æŒé«˜é€Ÿç¼“å­˜ä¸­çš„å†…å®¹æ­£ç¡®ï¼ŒåŸŸåæœåŠ¡å™¨åº”ä¸ºæ¯é¡¹å†…å®¹è®¾ç½®è®¡æ—¶å™¨ï¼ˆä¾‹å¦‚ï¼Œæ¯ä¸ªé¡¹ç›®åªå­˜æ”¾ä¸¤å¤©ï¼‰ã€‚</p><p>ä¸ä½†åœ¨æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸­éœ€è¦é«˜é€Ÿç¼“å­˜ï¼Œåœ¨ä¸»æœºä¸­ä¹Ÿå¾ˆéœ€è¦ã€‚è®¸å¤šä¸»æœºåœ¨å¯åŠ¨æ—¶ä»Žæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸‹è½½å…¨éƒ¨æ•°æ®åº“ã€‚ç”±äºŽåŸŸåæ”¹åŠ¨å¹¶ä¸é¢‘ç¹ï¼Œå¤§å¤šæ•°ç½‘ç‚¹ä¸éœ€èŠ±å¤ªå¤šç²¾åŠ›å°±èƒ½ç»´æŠ¤æ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚</p><a id="more"></a><h1 id="ftp">FTP</h1><p>æ–‡ä»¶ä¼ é€åè®® FTPï¼ˆFile Transfer Protocolï¼‰æä¾›äº¤äº’å¼çš„è®¿é—®ï¼Œå…è®¸å®¢æˆ·æŒ‡æ˜Žæ–‡ä»¶çš„ç±»åž‹ä¸Žæ ¼å¼ï¼Œå¹¶å…è®¸æ–‡ä»¶å…·æœ‰å­˜å–æƒé™ã€‚</p><p>åŸºäºŽ TCP çš„ FTP å’ŒåŸºäºŽ UDP çš„ TFTP éƒ½æ˜¯æ–‡ä»¶å…±äº«åè®®ä¸­çš„ä¸€å¤§ç±»ï¼Œå³<strong>å¤åˆ¶æ•´ä¸ªæ–‡ä»¶</strong>ï¼Œå…¶ç‰¹ç‚¹æ˜¯ï¼šè‹¥è¦å­˜å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±å¿…é¡»å…ˆèŽ·å¾—ä¸€ä¸ªæœ¬åœ°çš„æ–‡ä»¶å‰¯æœ¬ã€‚å¦‚æžœè¦ä¿®æ”¹æ–‡ä»¶ï¼Œåªèƒ½å¯¹æ–‡ä»¶çš„å‰¯æœ¬è¿›è¡Œä¿®æ”¹ï¼Œç„¶åŽå†å°†ä¿®æ”¹åŽçš„æ–‡ä»¶å‰¯æœ¬ä¼ å›žåŽŸèŠ‚ç‚¹ã€‚</p><p>æ–‡ä»¶å…±äº«åè®®ä¸­çš„å¦ä¸€å¤§ç±»æ˜¯<strong>è”æœºè®¿é—®</strong>ï¼ˆon-line accessï¼‰ï¼Œå…è®¸å¤šä¸ªç¨‹åºåŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå­˜å–ï¼Œç”±æ“ä½œç³»ç»Ÿæä¾›å¯¹è¿œåœ°å…±äº«æ–‡ä»¶è¿›è¡Œè®¿é—®çš„æœåŠ¡ï¼Œå°±å¦‚åŒå¯¹æœ¬åœ°æ–‡ä»¶çš„è®¿é—®ä¸€æ ·ã€‚å±žäºŽæ–‡ä»¶å…±äº«åè®®çš„æœ‰<strong>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ</strong> NFSï¼ˆNetwork File Systemï¼‰ã€‚</p><p>FTP çš„ä¸»è¦åŠŸèƒ½æ˜¯å‡å°‘æˆ–æ¶ˆé™¤åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸‹å¤„ç†æ–‡ä»¶çš„ä¸å…¼å®¹æ€§ã€‚</p><p>FTP ä½¿ç”¨ä¸¤ä¸ªå¹¶è¡Œçš„ TCP è¿žæŽ¥æ¥ä¼ è¾“æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯<strong>æŽ§åˆ¶è¿žæŽ¥</strong>ï¼ˆcontrol connectionï¼Œä½¿ç”¨ 21 å·ç«¯å£ï¼‰ï¼Œä¸€ä¸ªæ˜¯<strong>æ•°æ®è¿žæŽ¥</strong>ï¼ˆdata connectionï¼Œä½¿ç”¨ 20 å·ç«¯å£ï¼‰ã€‚æŽ§åˆ¶è¿žæŽ¥ç”¨äºŽä¼ è¾“æŽ§åˆ¶ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·æ ‡è¯†ã€å£ä»¤ç­‰ã€‚æ•°æ®è¿žæŽ¥ç”¨äºŽå®žé™…å‘é€ä¸€ä¸ªæ–‡ä»¶ã€‚å› ä¸º FTP åè®®ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„æŽ§åˆ¶è¿žæŽ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§° FTP çš„æŽ§åˆ¶ä¿¡æ¯æ˜¯<strong>å¸¦å¤–</strong>ï¼ˆout-of-bandï¼‰ä¼ é€çš„ã€‚å› æ­¤ï¼ŒHTTP å¯ä»¥è¯´æ˜¯<strong>å¸¦å†…</strong>ï¼ˆin-bandï¼‰å‘é€æŽ§åˆ¶ä¿¡æ¯çš„ã€‚</p><p>æŽ§åˆ¶è¿žæŽ¥åœ¨æ•´ä¸ªä¼šè¯æœŸé—´ä¸€ç›´ä¿æŒæ‰“å¼€ï¼Œä½†æ˜¯å¯¹ä¼šè¯ä¸­çš„æ¯ä¸€æ¬¡æ–‡ä»¶ä¼ è¾“éƒ½éœ€è¦å»ºè®®ä¸€ä¸ªæ–°çš„æ•°æ®è¿žæŽ¥ï¼ˆå³æ•°æ®è¿žæŽ¥æ˜¯éžæŒç»­çš„ï¼‰ã€‚</p><h1 id="tftp">TFTP</h1><p>ç®€å•æ–‡ä»¶ä¼ é€åè®® TFTPï¼ˆTrivial File Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªå¾ˆå°ä¸”æ˜“äºŽå®žçŽ°çš„æ–‡ä»¶ä¼ é€åè®®ã€‚</p><ul><li>ä½¿ç”¨ UDP æ•°æ®æŠ¥ï¼Œå› æ­¤ TFTP éœ€è¦æœ‰è‡ªå·±çš„å·®é”™æ”¹æ­£æŽªæ–½ã€‚</li><li>åªæ”¯æŒæ–‡ä»¶ä¼ è¾“è€Œä¸æ”¯æŒäº¤äº’ã€‚</li><li>æ²¡æœ‰ä¸€ä¸ªåºžå¤§çš„å‘½ä»¤é›†ï¼Œæ²¡æœ‰åˆ—ç›®å½•çš„åŠŸèƒ½ï¼Œä¹Ÿä¸èƒ½å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½é‰´åˆ«ã€‚</li></ul><p>TFTP çš„ä¸»è¦ä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼š</p><ol type="1"><li>å¯ç”¨äºŽ UDP çŽ¯å¢ƒã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦å°†ç¨‹åºæˆ–æ–‡ä»¶åŒæ—¶å‘è®¸å¤šæœºå™¨ä¸‹è½½æ—¶å°±å¾€å¾€éœ€è¦ä½¿ç”¨ TFTPã€‚</li><li>TFTP ä»£ç æ‰€å çš„å†…å­˜è¾ƒå°ã€‚è¿™å¯¹è¾ƒå°çš„è®¡ç®—æœºæˆ–æŸäº›ç‰¹æ®Šç”¨é€”çš„è®¾å¤‡æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™äº›è®¾å¤‡ä¸éœ€è¦ç¡¬ç›˜ï¼Œåªéœ€è¦å›ºåŒ–äº† TFTPã€UDP å’Œ IP çš„å°å®¹é‡åªè¯»å­˜å‚¨å™¨å³å¯ã€‚å½“æŽ¥é€šç”µæºåŽï¼Œè®¾å¤‡æ‰§è¡Œåªè¯»å­˜å‚¨å™¨ä¸­çš„ä»£ç ï¼Œåœ¨ç½‘ç»œä¸Šå¹¿æ’­ä¸€ä¸ª TFTP è¯·æ±‚ã€‚ç½‘ç»œä¸Šçš„ TFTP æœåŠ¡å™¨å°±å‘é€å“åº”ï¼Œå…¶ä¸­åŒ…æ‹¬å¯æ‰§è¡ŒäºŒè¿›åˆ¶ç¨‹åºã€‚è®¾å¤‡æ”¶åˆ°æ­¤æ–‡ä»¶åŽå°†å…¶æ”¾å…¥å†…å­˜ï¼Œç„¶åŽå¼€å§‹è¿è¡Œç¨‹åºã€‚è¿™ç§æ–¹å¼å¢žåŠ äº†çµæ´»æ€§ï¼Œä¹Ÿå‡å°‘äº†å¼€é”€ã€‚</li></ol><p>TFTP çš„å·¥ä½œå¾ˆåƒåœæ­¢ç­‰å¾…åè®®ã€‚å‘é€å®Œä¸€ä¸ªæ–‡ä»¶å—åŽå°±ç­‰å¾…å¯¹æ–¹çš„ç¡®è®¤ï¼Œç¡®è®¤æ—¶åº”æŒ‡æ˜Žæ‰€ç¡®è®¤çš„å—ç¼–å·ã€‚</p><p>TFTP å®¢æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªè¯»è¯·æ±‚æŠ¥æ–‡æˆ–å†™è¯·æ±‚æŠ¥æ–‡ç»™ TFTP æœåŠ¡å™¨è¿›ç¨‹ï¼Œå…¶å­°çŸ¥<strong>ç«¯å£å·ç ä¸º 69</strong>ã€‚TFTP æœåŠ¡å™¨è¿›ç¨‹è¦é€‰æ‹©ä¸€ä¸ªæ–°çš„ç«¯å£å·å’Œ TFTP å®¢æˆ·è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚è‹¥æ–‡ä»¶é•¿åº¦ä¸æ˜¯ 512 å­—èŠ‚çš„æ•´æ•°å€ï¼Œåˆ™æœ€åŽä¼ é€æ•°æ®æŠ¥æ–‡ä¸­çš„æ•°æ®å­—æ®µä¸€å®šä¸æ»¡ 512 å­—èŠ‚ï¼Œè¿™æ­£å¥½å¯ä½œä¸ºæ–‡ä»¶ç»“æŸçš„æ ‡å¿—ã€‚è‹¥æ–‡ä»¶é•¿åº¦æ°å¥½ä¸º 512 å­—èŠ‚çš„æ•´æ•°å€ï¼Œåˆ™åœ¨æ–‡ä»¶ä¼ é€å®Œæ¯•åŽï¼Œè¿˜å¿…é¡»åœ¨æœ€åŽå‘é€ä¸€ä¸ªåªå«é¦–éƒ¨è€Œæ— æ•°æ®çš„æ•°æ®æŠ¥æ–‡ã€‚</p><h1 id="telnet">TELNET</h1><p>TELNET æ˜¯ä¸€ä¸ªç®€å•çš„<strong>è¿œç¨‹ç»ˆç«¯åè®®</strong>ã€‚TELNET é€šè¿‡ TCP è¿žæŽ¥åˆ°è¿œåœ°çš„å¦ä¸€å°ä¸»æœºä¸Šã€‚TELNET èƒ½å°†ç”¨æˆ·çš„å‡»é”®ä¼ åˆ°è¿œåœ°ä¸»æœºï¼ŒåŒæ—¶ä¹Ÿèƒ½å°†è¿œåœ°ä¸»æœºçš„è¾“å‡ºé€šè¿‡ TCP è¿žæŽ¥è¿”å›žåˆ°ç”¨æˆ·å±å¹•ã€‚è¿™ç§æœåŠ¡æ˜¯é€æ˜Žçš„ï¼Œå› ä¸ºç”¨æˆ·æ„Ÿè§‰åˆ°å¥½åƒé”®ç›˜å’Œæ˜¾ç¤ºå™¨æ˜¯ç›´æŽ¥è¿žåœ¨è¿œåœ°ä¸»æœºä¸Šã€‚å› æ­¤ï¼ŒTELNET åˆç§°ä¸º<strong>ç»ˆç«¯ä»¿çœŸåè®®</strong>ã€‚</p><p>TELNET èƒ½å¤Ÿé€‚åº”è®¸å¤šè®¡ç®—æœºå’Œæ“ä½œç³»ç»Ÿçš„å·®å¼‚ã€‚ä¾‹å¦‚ï¼Œå¯¹äºŽæ–‡æœ¬ä¸­ä¸€è¡Œçš„ç»“æŸï¼Œæœ‰çš„ç³»ç»Ÿä½¿ç”¨ ASCII ç çš„å›žè½¦ï¼ˆCRï¼‰ï¼Œæœ‰çš„ç³»ç»Ÿä½¿ç”¨æ¢è¡Œï¼ˆLFï¼‰ï¼Œè¿˜æœ‰çš„ç³»ç»Ÿä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦ï¼ˆCRLFï¼‰ã€‚ä¸ºäº†é€‚åº”è¿™ç§å·®å¼‚ï¼ŒTELNET å®šä¹‰äº†æ•°æ®å’Œå‘½ä»¤åº”æ€Žæ ·é€šè¿‡äº’è”ç½‘ã€‚è¿™äº›å®šä¹‰å°±æ˜¯æ‰€è°“çš„<strong>ç½‘ç»œè™šæ‹Ÿç»ˆç«¯</strong> NVTï¼ˆNetwork Virtual Terminalï¼‰ã€‚å®¢æˆ·è½¯ä»¶æŠŠç”¨æˆ·çš„å‡»é”®å’Œå‘½ä»¤è½¬æ¢æˆ NVT æ ¼å¼ï¼Œå¹¶é€äº¤æœåŠ¡å™¨ã€‚æœåŠ¡å™¨è½¯ä»¶æŠŠæ”¶åˆ°çš„æ•°æ®å’Œå‘½ä»¤ä»Ž NVT æ ¼å¼è½¬æ¢æˆè¿œåœ°ç³»ç»Ÿæ‰€éœ€çš„æ ¼å¼ã€‚å‘ç”¨æˆ·è¿”å›žæ•°æ®æ—¶åŒç†ã€‚</p><h1 id="http">HTTP</h1><p>è¶…æ–‡æœ¬ä¼ è¾“åè®® HTTPï¼ˆHyper Text Transfer Protocolï¼‰æ˜¯ Web çš„æ ¸å¿ƒï¼Œå®šä¹‰äº† Web å®¢æˆ·å‘ Web æœåŠ¡å™¨è¯·æ±‚ Web é¡µé¢çš„æ–¹å¼ï¼Œä»¥åŠæœåŠ¡å™¨å‘å®¢æˆ·ä¼ é€ Web é¡µé¢çš„æ–¹å¼ã€‚</p><p>HTTP ä½¿ç”¨äº†é¢å‘è¿žæŽ¥çš„ TCP ä½œä¸ºè¿è¾“å±‚åè®®ï¼Œä¿è¯äº†æ•°æ®çš„å¯é ä¼ è¾“ã€‚ä½†æ˜¯ï¼Œ<strong>HTTP åè®®æœ¬èº«æ˜¯æ— è¿žæŽ¥çš„</strong>ã€‚</p><p><strong>HTTP åè®®æ˜¯æ— çŠ¶æ€çš„</strong>ï¼ˆstatelessï¼‰ã€‚æ— çŠ¶æ€ç‰¹æ€§ç®€åŒ–äº†æœåŠ¡å™¨çš„è®¾è®¡ï¼Œä½¿æœåŠ¡å™¨æ›´å®¹æ˜“æ”¯æŒå¤§é‡å¹¶å‘çš„ HTTP è¯·æ±‚ã€‚</p><h2 id="éžæŒç»­æŒç»­-è¿žæŽ¥">éžæŒç»­/æŒç»­ è¿žæŽ¥</h2><p>HTTP/1.0 çš„ä¸»è¦ç¼ºç‚¹ï¼Œå°±æ˜¯æ¯è¯·æ±‚ä¸€ä¸ªæ–‡æ¡£å°±è¦æœ‰ä¸¤å€ RTTï¼ˆRound-Trip Timeï¼‰çš„å¼€é”€ã€‚è‹¥ä¸€ä¸ªé¡µé¢ä¸Šæœ‰å¾ˆå¤šé“¾æŽ¥çš„å¯¹è±¡ï¼ˆå¦‚å›¾ç‰‡ç­‰ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡é“¾æŽ¥ä¸‹è½½éƒ½å¯¼è‡´ 2 x RTT çš„å¼€é”€ã€‚å¦ä¸€ç§å¼€é”€å°±æ˜¯å®¢æˆ·å’ŒæœåŠ¡å™¨æ¯ä¸€æ¬¡å»ºç«‹æ–°çš„ TCP è¿žæŽ¥éƒ½è¦åˆ†é…ç¼“å­˜å’Œå˜é‡ã€‚è¿™ç§<strong>éžæŒç»­è¿žæŽ¥</strong>ï¼ˆnon-persistent connectionï¼‰ä¼šä½¿æœåŠ¡å™¨çš„è´Ÿæ‹…å¾ˆé‡ã€‚</p><p>HTTP/1.1 è¾ƒå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒä½¿ç”¨äº†<strong>æŒç»­è¿žæŽ¥</strong>ï¼ˆpersistent connectionï¼‰ï¼ŒæœåŠ¡å™¨åœ¨å‘é€å“åº”åŽä»ç„¶åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒè¿™æ¡è¿žæŽ¥ï¼Œä½¿åŒä¸€ä¸ªå®¢æˆ·å’Œè¯¥æœåŠ¡å™¨å¯ä»¥ç»§ç»­åœ¨è¿™æ¡è¿žæŽ¥ä¸Šä¼ é€åŽç»­çš„ HTTP è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚è¿™å¹¶ä¸å±€é™äºŽä¼ é€åŒä¸€ä¸ªé¡µé¢ä¸Šé“¾æŽ¥çš„æ–‡æ¡£ï¼Œè€Œæ˜¯åªè¦è¿™äº›æ–‡æ¡£éƒ½åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šå°±è¡Œã€‚</p><p>HTTP/1.1 çš„æŒç»­è¿žæŽ¥æœ‰ä¸¤ç§å·¥ä½œæ–¹å¼ï¼Œå³éžæµæ°´çº¿æ–¹å¼ï¼ˆwithout pipeliningï¼‰å’Œæµæ°´çº¿æ–¹å¼ï¼ˆwith pipeliningï¼‰ã€‚</p><h2 id="ä»£ç†æœåŠ¡å™¨">ä»£ç†æœåŠ¡å™¨</h2><p><strong>ä»£ç†æœåŠ¡å™¨</strong>ï¼ˆproxy serverï¼‰æ˜¯ä¸€ç§ç½‘ç»œå®žä½“ï¼Œåˆç§°ä¸º<strong>ä¸‡ç»´ç½‘é«˜é€Ÿç¼“å­˜</strong>ï¼ˆWeb cacheï¼‰ã€‚ä»£ç†æœåŠ¡å™¨å¯åœ¨å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯å·¥ä½œï¼Œä¹Ÿå¯åœ¨ä¸­é—´ç³»ç»Ÿä¸Šå·¥ä½œã€‚</p><h2 id="è¯·æ±‚å“åº”-æŠ¥æ–‡">è¯·æ±‚/å“åº” æŠ¥æ–‡</h2><p>HTTP æ˜¯é¢å‘æ–‡æœ¬çš„ï¼ˆtext-orientedï¼‰ï¼Œæœ‰ä¸¤ç±»æŠ¥æ–‡ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CRLF ä»£è¡¨ å›žè½¦æ¢è¡Œ</span><br><span class="line"></span><br><span class="line">è¯·æ±‚æŠ¥æ–‡ï¼š</span><br><span class="line">          æ–¹æ³• URL ç‰ˆæœ¬CRLF</span><br><span class="line">          é¦–éƒ¨å­—æ®µå: å€¼CRLF</span><br><span class="line">            ...</span><br><span class="line">          é¦–éƒ¨å­—æ®µå: å€¼CRLF</span><br><span class="line">          CRLF</span><br><span class="line">          å®žä½“ä¸»ä½“ï¼ˆé€šå¸¸ä¸ç”¨ï¼‰</span><br><span class="line">ä¾‹ï¼š</span><br><span class="line"></span><br><span class="line">GET /dir/index.htm HTTP/1.1</span><br><span class="line">Host: www.xyz.edu.cn</span><br><span class="line">Connection: close</span><br><span class="line">User-Agent: Mozilla/5.0</span><br><span class="line">Accept-Language: cn</span><br><span class="line"></span><br><span class="line">å“åº”æŠ¥æ–‡ï¼š</span><br><span class="line"></span><br><span class="line">          ç‰ˆæœ¬ çŠ¶æ€ç  çŸ­è¯­CRLF</span><br><span class="line">          é¦–éƒ¨å­—æ®µå: å€¼CRLF</span><br><span class="line">            ...</span><br><span class="line">          é¦–éƒ¨å­—æ®µå: å€¼CRLF</span><br><span class="line">          CRLF</span><br><span class="line">          å®žä½“ä¸»ä½“ï¼ˆæœ‰äº›å“åº”æŠ¥æ–‡ä¸ç”¨ï¼‰</span><br></pre></td></tr></table></figure><p>è¯·æ±‚æŠ¥æ–‡çš„ä¸€äº›æ–¹æ³•ï¼š</p><table><thead><tr class="header"><th>æ–¹æ³•ï¼ˆæ“ä½œï¼‰</th><th>æ„ä¹‰</th></tr></thead><tbody><tr class="odd"><td>OPTION</td><td>è¯·æ±‚ä¸€äº›é€‰é¡¹çš„ä¿¡æ¯</td></tr><tr class="even"><td>GET</td><td>è¯·æ±‚è¯»å–ç”± URL æ‰€æ ‡å¿—çš„ä¿¡æ¯</td></tr><tr class="odd"><td>HEAD</td><td>è¯·æ±‚è¯»å–ç”± URL æ‰€æ ‡å¿—çš„ä¿¡æ¯çš„é¦–éƒ¨</td></tr><tr class="even"><td>POST</td><td>ç»™æœåŠ¡å™¨æ·»åŠ ä¿¡æ¯</td></tr><tr class="odd"><td>PUT</td><td>åœ¨æŒ‡æ˜Žçš„ URL ä¸‹å­˜å‚¨ä¸€ä¸ªæ–‡æ¡£</td></tr><tr class="even"><td>DELETE</td><td>åˆ é™¤æŒ‡æ˜Žçš„ URL æ‰€æ ‡å¿—çš„èµ„æº</td></tr><tr class="odd"><td>TRACE</td><td>ç”¨æ¥è¿›è¡ŒçŽ¯å›žæµ‹è¯•çš„è¯·æ±‚æŠ¥æ–‡</td></tr><tr class="even"><td>CONNECT</td><td>ç”¨äºŽä»£ç†æœåŠ¡å™¨</td></tr></tbody></table><p>çŠ¶æ€ç </p><ul><li>1xx è¡¨ç¤ºé€šçŸ¥ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚æ”¶åˆ°äº†æˆ–æ­£åœ¨è¿›è¡Œå¤„ç†ã€‚</li><li>2xx è¡¨ç¤ºæˆåŠŸï¼Œå¦‚æŽ¥å—æˆ–çŸ¥é“äº†ã€‚</li><li>3xx è¡¨ç¤ºé‡å®šå‘ï¼Œå¦‚è¦å®Œæˆè¯·æ±‚è¿˜å¿…é¡»é‡‡å–è¿›ä¸€æ­¥çš„è¡ŒåŠ¨ï¼ˆä¸»æµæµè§ˆå™¨å¤§éƒ½ä¼šè‡ªåŠ¨å®Œæˆï¼‰ã€‚</li><li>4xx è¡¨ç¤ºå®¢æˆ·çš„å·®é”™ï¼Œå¦‚è¯·æ±‚ä¸­æœ‰é”™è¯¯çš„è¯­æ³•æˆ–ä¸èƒ½å®Œæˆã€‚</li><li>5xx è¡¨ç¤ºæœåŠ¡å™¨çš„å·®é”™ï¼Œå¦‚æœåŠ¡å™¨å¤±æ•ˆæ— æ³•å®Œæˆè¯·æ±‚ã€‚</li></ul><p>å¸¸è§çš„çŠ¶æ€è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line"></span><br><span class="line">HTTP/1.1 202 Accepted</span><br><span class="line"></span><br><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line"></span><br><span class="line">HTTP/1.1 404 Not Found</span><br><span class="line"></span><br><span class="line">HTTP/1.1 301 Moved Permanently</span><br><span class="line">Location: new URL</span><br></pre></td></tr></table></figure><h2 id="cookie">Cookie</h2><p>ä¸‡ç»´ç½‘ç«™ç‚¹å¯ä»¥ä½¿ç”¨ Cookie æ¥è·Ÿè¸ªç”¨æˆ·ã€‚</p><p>å½“ç”¨æˆ· A æµè§ˆæŸä¸ªä½¿ç”¨ Cookie çš„ç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™çš„æœåŠ¡å™¨å°±ä¸º A äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„è¯†åˆ«ç ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºç´¢å¼•åœ¨æœåŠ¡å™¨åŽç«¯æ•°æ®åº“ä¸­äº§ç”Ÿä¸€ä¸ªé¡¹ç›®ã€‚æŽ¥ç€åœ¨ç»™ A çš„å“åº”æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªå«åš Set-cookie çš„é¦–éƒ¨è¡Œã€‚ä¾‹å¦‚ï¼Œ<code>Set-cookie: 390ja3mi5o8a0e4w</code>ã€‚</p><p>å½“ A æ”¶åˆ°è¿™ä¸ªå“åº”æ—¶ï¼Œå…¶æµè§ˆå™¨å°±åœ¨å®ƒç®¡ç†çš„ç‰¹å®š Cookie æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œå…¶ä¸­åŒ…æ‹¬è¿™ä¸ªæœåŠ¡å™¨çš„ä¸»æœºå’Œ Set-cookie åŽé¢ç»™å‡ºçš„è¯†åˆ«ç ã€‚å½“ A ç»§ç»­æµè§ˆè¿™ä¸ªç½‘ç«™æ—¶ï¼Œæ¯å‘é€ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼Œå°±å–å‡ºè¯†åˆ«ç å¹¶æ”¾åˆ°è¯·æ±‚æŠ¥æ–‡çš„é¦–éƒ¨è¡Œä¸­ï¼š<code>Cookie: 390ja3mi5o8a0e4w</code>ã€‚</p><h1 id="ç”µå­é‚®ä»¶">ç”µå­é‚®ä»¶</h1><p>ä¸€ä¸ªç”µå­é‚®ä»¶ç³»ç»Ÿæœ‰ä¸‰ä¸ªä¸»è¦ç»„æˆæž„ä»¶ï¼š</p><ol type="1"><li>ç”¨æˆ·ä»£ç† UAï¼ˆUser Agentï¼‰ï¼šæ˜¯ç”¨æˆ·ä¸Žç”µå­é‚®ä»¶ç³»ç»Ÿçš„æŽ¥å£ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯è¿è¡Œåœ¨ç”¨æˆ·ç”µè„‘ä¸­çš„ä¸€ä¸ªç¨‹åºã€‚å› æ­¤åˆç§°ä¸ºç”µå­é‚®ä»¶å®¢æˆ·ç«¯è½¯ä»¶ï¼Œä¾‹å¦‚ Outlookã€Foxmailã€‚</li><li>é‚®ä»¶æœåŠ¡å™¨ï¼šå‘é€å’ŒæŽ¥æ”¶é‚®ä»¶ï¼ŒåŒæ—¶è¿˜è¦å‘å‘ä»¶äººæŠ¥å‘Šé‚®ä»¶ä¼ é€çš„ç»“æžœï¼ˆå·²äº¤ä»˜ã€è¢«æ‹’ç»ã€ä¸¢å¤±ç­‰ï¼‰ã€‚é‚®ä»¶æœåŠ¡å™¨éœ€è¦ä½¿ç”¨ä¸¤ç§ä¸åŒçš„åè®®ã€‚</li><li>é‚®ä»¶å‘é€åè®®ï¼ˆå¦‚ SMTPï¼‰å’Œé‚®ä»¶è¯»å–åè®®ï¼ˆå¦‚ POP3ï¼ŒIMAPï¼‰</li></ol><h2 id="smtp">SMTP</h2><p>å®¢æˆ· SMTP ï¼ˆè¿è¡Œåœ¨å‘é€é‚®ä»¶æœåŠ¡å™¨ä¸Šï¼‰åœ¨ <strong>25 å·ç«¯å£</strong>å»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡å™¨ SMTPï¼ˆè¿è¡Œåœ¨æŽ¥æ”¶é‚®ä»¶æœåŠ¡å™¨ä¸Šï¼‰çš„ TCP è¿žæŽ¥ã€‚å¦‚æžœæœåŠ¡å™¨æ²¡æœ‰å¼€æœºï¼Œå®¢æˆ·ä¼šåœ¨ç¨å€™ç»§ç»­å°è¯•è¿žæŽ¥ã€‚SMTP ä¸€èˆ¬ä¸ä½¿ç”¨ä¸­é—´é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ï¼Œå³ä½¿è¿™ä¸¤ä¸ªé‚®ä»¶æœåŠ¡å™¨ä½äºŽåœ°çƒçš„ä¸¤ç«¯ä¹Ÿæ˜¯è¿™æ ·ã€‚</p><p>ä¸Ž HTTP çš„æ¯”è¾ƒï¼š</p><p>æŒç»­çš„ HTTP å’Œ SMTP éƒ½ä½¿ç”¨æŒç»­è¿žæŽ¥ã€‚HTTP ä¸»è¦æ˜¯ä¸€ä¸ª<strong>æ‹‰åè®®</strong>ï¼ˆpull protocolï¼‰ï¼ŒTCP è¿žæŽ¥æ˜¯ç”±æƒ³æŽ¥æ”¶æ–‡ä»¶çš„æœºå™¨å‘èµ·çš„ï¼›SMTP åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª<strong>æŽ¨åè®®</strong>ï¼ˆpush protocolï¼‰ï¼ŒTCP è¿žæŽ¥æ˜¯ç”±è¦å‘é€æ–‡ä»¶çš„æœºå™¨å‘èµ·çš„ã€‚</p><p>ç®€å•é‚®ä»¶ä¼ é€åè®® SMTPï¼ˆSimple Mail Transfer Protocolï¼‰å­˜åœ¨ç€ä¸€äº›ç¼ºç‚¹ï¼š</p><ul><li>FROM å‘½ä»¤åŽé¢çš„åœ°å€å¯ä»¥ä»»æ„å¡«å†™ã€‚</li><li>SMTP é™äºŽä¼ é€ 7 ä½çš„ ASCII ç ã€‚</li><li>SMTP ä¼ é€çš„é‚®ä»¶æ˜¯æ˜Žæ–‡ã€‚</li></ul><h2 id="pop3-å’Œ-imap">POP3 å’Œ IMAP</h2><p>å¸¸ç”¨çš„é‚®ä»¶è¯»å–åè®®æœ‰ä¸¤ä¸ªï¼Œå³<strong>é‚®å±€åè®®ç¬¬ 3 ç‰ˆ POP3</strong>ï¼ˆPost Office Protocol version 3ï¼‰å’Œ<strong>å› ç‰¹ç½‘é‚®ä»¶è®¿é—®åè®® IMAP</strong>ï¼ˆInternet Mail Access Protocolï¼‰ã€‚</p><p>POP3 æ˜¯ä¸€ä¸ªéžå¸¸ç®€å•ã€ä½†åŠŸèƒ½æœ‰é™çš„é‚®ä»¶è¯»å–åè®®ï¼Œ<strong>å­°çŸ¥ç«¯å£æ˜¯ 110</strong>ã€‚ä½¿ç”¨ POP3 çš„ç”¨æˆ·ä»£ç†é€šå¸¸è¢«ç”¨æˆ·é…ç½®ä¸ºâ€œä¸‹è½½å¹¶åˆ é™¤â€æˆ–è€…â€œä¸‹è½½å¹¶ä¿ç•™â€æ–¹å¼ã€‚ä½¿ç”¨â€œä¸‹è½½å¹¶åˆ é™¤â€æ–¹å¼å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œé‚®ä»¶æŽ¥æ”¶æ–¹å¯èƒ½å¸Œæœ›ä»Žå¤šä¸ªä¸åŒçš„æœºå™¨è®¿é—®ä»–çš„é‚®ä»¶ï¼Œå¦‚ä»ŽåŠžå…¬å®¤çš„ PCã€å®¶é‡Œçš„ PCã€‚</p><p>IMAP æ¯” POP3 å¤æ‚å¾—å¤šï¼ŒIMAP æ˜¯ä¸€ä¸ªè”æœºåè®®ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦ä¸ºè‡ªå·±çš„é‚®ç®±åˆ›å»ºä¾¿äºŽåˆ†ç±»ç®¡ç†çš„å±‚æ¬¡å¼çš„é‚®ç®±æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†å­˜æ”¾çš„é‚®ä»¶ä»ŽæŸä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ç”¨æˆ·ä¹Ÿå¯æŒ‰æŸç§æ¡ä»¶å¯¹é‚®ä»¶è¿›è¡ŒæŸ¥æ‰¾ã€‚åœ¨ç”¨æˆ·æœªå‘å‡ºåˆ é™¤é‚®ä»¶çš„å‘½ä»¤ä¹‹å‰ï¼ŒIMAP æœåŠ¡å™¨é‚®ç®±ä¸­çš„é‚®ä»¶ä¸€ç›´ä¿å­˜ç€ã€‚</p><p>IMAP çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å…è®¸åªè¯»å–é‚®ä»¶ä¸­çš„æŸä¸€ä¸ªéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œæ”¶åˆ°äº†ä¸€ä¸ªå¸¦æœ‰é™„ä»¶ï¼ˆæ­¤æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼‰çš„é‚®ä»¶ï¼Œè€Œç”¨æˆ·ä»£ç†å’ŒæœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨ä½Žå®½å¸¦è¿žæŽ¥æ—¶ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œå¯ä»¥å…ˆä¸‹è½½é‚®ä»¶çš„æ­£æ–‡éƒ¨åˆ†ï¼Œå¾…ä»¥åŽæœ‰æ—¶é—´å†è¯»å–æˆ–ä¸‹è½½è¿™ä¸ªå¾ˆå¤§çš„é™„ä»¶ã€‚</p><h2 id="åŸºäºŽ-web-çš„ç”µå­é‚®ä»¶">åŸºäºŽ Web çš„ç”µå­é‚®ä»¶</h2><p>ä½¿ç”¨ä¸‡ç»´ç½‘ç”µå­é‚®ä»¶ä¸éœ€è¦åœ¨è®¡ç®—æœºä¸­å†å®‰è£…ç”¨æˆ·ä»£ç†è½¯ä»¶ï¼Œæµè§ˆå™¨æœ¬èº«å¯ä»¥å‘ç”¨æˆ·æä¾›éžå¸¸å‹å¥½çš„ç”µå­é‚®ä»¶ç•Œé¢ã€‚</p><p>åœ¨æµè§ˆå™¨å’Œäº’è”ç½‘ä¸Šçš„é‚®ä»¶æœåŠ¡å™¨ä¹‹é—´ä¼ é€é‚®ä»¶æ—¶ï¼Œä»ç„¶ä½¿ç”¨ HTTP åè®®ã€‚ä½†æ˜¯åœ¨å„é‚®ä»¶æœåŠ¡å™¨ä¹‹é—´ä¼ é€é‚®ä»¶æ—¶ï¼Œåˆ™ä»ç„¶ä½¿ç”¨ SMTP åè®®ã€‚</p><h2 id="mime">MIME</h2><p>SMTP æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ol type="1"><li>ä¸èƒ½ä¼ é€äºŒè¿›åˆ¶å¯¹è±¡ã€‚äººä»¬æ›¾è¯•å›¾å°†äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸º ASCII æ–‡æœ¬ï¼Œä½†æœªå½¢æˆæ­£å¼æ ‡å‡†æˆ–äº‹å®žä¸Šçš„æ ‡å‡†ã€‚</li><li>é™äºŽä¼ é€ 7 ä½çš„ ASCII ç ã€‚è®¸å¤šå…¶ä»–éžè‹±è¯­å›½å®¶çš„æ–‡å­—å°±æ— æ³•ä¼ é€ã€‚</li><li>æœåŠ¡å™¨ä¼šæ‹’ç»è¶…è¿‡ä¸€å®šé•¿åº¦çš„é‚®ä»¶ã€‚</li><li>æŸäº› STMP çš„å®žçŽ°å¹¶æ²¡æœ‰å®Œå…¨æŒ‰ç…§ SMTP çš„äº’è”ç½‘æ ‡å‡†ã€‚å¸¸è§çš„é—®é¢˜å¦‚ä¸‹ï¼š<ul><li>å›žè½¦ã€æ¢è¡Œçš„åˆ é™¤å’Œå¢žåŠ </li><li>è¶…è¿‡ 76 ä¸ªå­—ç¬¦æ—¶çš„å¤„ç†ï¼šæˆªæ–­æˆ–è‡ªåŠ¨æ¢è¡Œ</li><li>åŽé¢å¤šä½™ç©ºæ ¼çš„åˆ é™¤</li><li>å°†åˆ¶è¡¨ç¬¦ tab è½¬æ¢ä¸ºè‹¥å¹²ä¸ªç©ºæ ¼</li></ul></li></ol><p>é€šç”¨äº’è”ç½‘é‚®ä»¶æ‰©å…… MIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰å¹¶æ²¡æœ‰æ”¹åŠ¨æˆ–å–ä»£ SMTPã€‚MIME çš„æ„å›¾æ˜¯ç»§ç»­ä½¿ç”¨åŽŸæ¥çš„é‚®ä»¶æ ¼å¼ï¼Œä½†å¢žåŠ äº†é‚®ä»¶ä¸»ä½“çš„ç»“æž„ï¼Œå¹¶å®šä¹‰äº†ä¼ é€éž ASCII ç çš„ç¼–ç æ ‡å‡†ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·              ç”¨æˆ·</span><br><span class="line"> | éžASCIIç        | éžASCIIç </span><br><span class="line">MIME             MIME</span><br><span class="line"> | 7ä½ASCIIç       | 7ä½ASCIIç </span><br><span class="line">SMTP &lt;---------&gt; SMTP</span><br></pre></td></tr></table></figure><h1 id="dhcp">DHCP</h1><p>åŠ¨æ€ä¸»æœºé…ç½®åè®® DHCPï¼ˆDynamic Host Configuration Protocolï¼‰æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œç§°ä¸º<strong>å³æ’å³ç”¨è”ç½‘</strong>ï¼ˆplug-and-play networkingï¼‰ã€‚è¿™ç§æœºåˆ¶å…è®¸ä¸€å°è®¡ç®—æœºåŠ å…¥æ–°çš„ç½‘ç»œå’ŒèŽ·å– IP è€Œä¸ç”¨æ‰‹åŠ¨å‚ä¸Žã€‚DHCP å¾ˆé€‚åˆäºŽç»å¸¸ç§»åŠ¨ä½ç½®çš„è®¡ç®—æœºã€‚</p><p>DHCP ä½¿ç”¨å®¢æˆ·æœåŠ¡å™¨æ–¹å¼ã€‚éœ€è¦ IP åœ°å€çš„ä¸»æœºåœ¨å¯åŠ¨æ—¶å°±å‘ DHCP æœåŠ¡å™¨å¹¿æ’­ï¼ˆå°†ç›®çš„ IP åœ°å€ç½®ä¸ºå…¨ 1ï¼Œå³ 255.255.255.255ï¼›æº IP åœ°å€ç½®ä¸ºå…¨ 0ï¼Œå› ä¸ºè¿™å°ä¸»æœºç›®å‰è¿˜æ²¡æœ‰è‡ªå·±çš„ IP åœ°å€ï¼‰å‘é€<strong>å‘çŽ°æŠ¥æ–‡ï¼ˆDHCPDISCOVERï¼‰</strong>ã€‚åœ¨æœ¬åœ°ç½‘ç»œä¸Šæ‰€æœ‰ä¸»æœºéƒ½èƒ½å¤Ÿæ”¶åˆ°è¿™ä¸ªå¹¿æ’­æŠ¥æ–‡ï¼Œä½†åªæœ‰ DHCP æœåŠ¡å™¨æ‰å¯¹æ­¤è¿›è¡Œå›žç­”ã€‚DHCP æœåŠ¡å™¨å…ˆåœ¨å…¶æ•°æ®åº“ä¸­æŸ¥æ‰¾è¯¥è®¡ç®—æœºçš„é…ç½®ä¿¡æ¯ã€‚è‹¥æ‰¾åˆ°ï¼Œåˆ™è¿”å›žæ‰¾åˆ°çš„ä¿¡æ¯ã€‚è‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™ä»ŽæœåŠ¡å™¨çš„ IP åœ°å€æ± ï¼ˆaddress poolï¼‰ä¸­å–ä¸€ä¸ªåœ°å€åˆ†é…ç»™è¯¥è®¡ç®—æœºã€‚DHCP æœåŠ¡å™¨çš„å›žç­”æŠ¥æ–‡å«åš<strong>æä¾›æŠ¥æ–‡ï¼ˆDHCPOFFERï¼‰</strong>ã€‚</p><p>å‡¡æ”¶åˆ° DHCP å‘çŽ°æŠ¥æ–‡çš„ DHCP æœåŠ¡å™¨éƒ½å‘å‡º DHCP æä¾›æŠ¥æ–‡ï¼Œå› æ­¤ DHCP å®¢æˆ·å¯èƒ½æ”¶åˆ°å¤šä¸ª DHCP æä¾›æŠ¥æ–‡ã€‚é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªï¼Œæƒ³æ‰€é€‰æ‹©çš„ DHCP æœåŠ¡å™¨å‘é€<strong>è¯·æ±‚æŠ¥æ–‡ï¼ˆDHCPREQUESTï¼‰</strong>ã€‚è¢«é€‰æ‹©çš„æœåŠ¡å™¨æ”¶åˆ°åŽå‘é€<strong>ç¡®è®¤æŠ¥æ–‡ï¼ˆDHCPACK</strong>ï¼‰ï¼ŒDHCP å®¢æˆ·å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª IP åœ°å€äº†ã€‚è¿™ç§çŠ¶æ€å«åšå·²ç»‘å®šçŠ¶æ€ã€‚</p><p>DHCP å®¢æˆ·æ ¹æ®æœåŠ¡å™¨æä¾›çš„ç§Ÿç”¨æœŸ T è®¾ç½®ä¸¤ä¸ªè®¡æ—¶å™¨ï¼Œè¶…æ—¶æ—¶é—´åˆ†åˆ«æ˜¯ 0.5T å’Œ 0.875Tã€‚å½“è¶…æ—¶æ—¶é—´åˆ°äº†å°±è¦å‘é€è¯·æ±‚æŠ¥æ–‡ï¼ˆDHCPREQUESTï¼‰è¯·æ±‚æ›´æ–°ç§Ÿç”¨æœŸã€‚DHCP æœåŠ¡å™¨è‹¥åŒæ„ï¼Œåˆ™å‘æŒ¥ç¡®è®¤æŠ¥æ–‡ï¼ˆDHCPACKï¼‰ï¼›è‹¥ä¸åŒæ„ï¼Œåˆ™å‘å›ž<strong>å¦è®¤æŠ¥æ–‡ï¼ˆDHCPNACKï¼‰</strong>ï¼Œè¿™æ—¶ DHCP å®¢æˆ·å¿…é¡»ç«‹å³åœæ­¢ä½¿ç”¨åŽŸæ¥çš„ IP åœ°å€ï¼Œé‡æ–°ç”³è¯· IP åœ°å€ï¼ˆå¹¿æ’­å‘é€å‘çŽ°æŠ¥æ–‡ï¼‰ã€‚</p><p>DHCP å®¢æˆ·å¯ä»¥éšæ—¶ç»ˆæ­¢ç§Ÿç”¨ï¼Œåªéœ€å‘ DHCP æœåŠ¡å™¨å‘é€é‡Šæ”¾æŠ¥æ–‡ï¼ˆDHCPRELEASEï¼‰å³å¯ã€‚</p><p><strong>DHCP å®¢æˆ·ä½¿ç”¨çš„ UDP ç«¯å£æ˜¯ 68ï¼Œè€Œ DHCP æœåŠ¡å™¨ä½¿ç”¨çš„ UDP ç«¯å£æ˜¯ 67</strong>ã€‚</p><p>åœ¨æ¯ä¸€ä¸ªç½‘ç»œä¸Šéƒ½è®¾ç½®ä¸€ä¸ª DHCP æœåŠ¡å™¨ä¼šä½¿ DHCP æœåŠ¡å™¨æ•°é‡å¤ªå¤šã€‚å› æ­¤çŽ°åœ¨æ˜¯ä½¿æ¯ä¸€ä¸ªç½‘ç»œè‡³å°‘æœ‰ä¸€ä¸ª DHCP ä¸­ç»§ä»£ç†ï¼ˆrelay agentï¼‰ï¼Œé€šå¸¸æ˜¯ä¸€å°è·¯ç”±å™¨ï¼Œå®ƒé…ç½®äº† DHCP æœåŠ¡å™¨çš„ IP åœ°å€ä¿¡æ¯ã€‚å½“ DHCP ä¸­ç»§ä»£ç†æ”¶åˆ°ä¸»æœºä»¥å¹¿æ’­å½¢å¼å‘é€çš„å‘çŽ°æŠ¥æ–‡åŽï¼Œå°±ä»¥å•æ’­çš„æ–¹å¼å‘ DHCP æœåŠ¡å™¨è½¬å‘æ­¤æŠ¥æ–‡ã€‚</p><p>DHCP æœåŠ¡å™¨åˆ†é…ç»™ DHCP å®¢æˆ·çš„ IP åœ°å€æ˜¯ä¸´æ—¶çš„ï¼ŒDHCP åè®®ç§°è¿™æ®µæ—¶é—´ä¸ºç§Ÿç”¨æœŸï¼ˆlease periodï¼‰ï¼Œæ•°å€¼ç”± DHCP æœåŠ¡å™¨è‡ªå·±å†³å®šã€‚DHCP å®¢æˆ·ä¹Ÿå¯åœ¨æŠ¥æ–‡ä¸­ï¼ˆä¾‹å¦‚ï¼Œå‘çŽ°æŠ¥æ–‡ï¼‰æå‡ºå¯¹ç§Ÿç”¨æœŸçš„è¦æ±‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer Networking </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k Sum</title>
      <link href="/programming/leetcode/k-sum/"/>
      <url>/programming/leetcode/k-sum/</url>
      
        <content type="html"><![CDATA[<h1 id="sum">2 Sum</h1><h2 id="input-is-an-array">Input is an array</h2><p>Given an array of integers, return <strong>indices</strong> of the two numbers such that they add up to a specific target.</p><p>You may assume that each input would have <strong>exactly</strong> one solution, and you may not use the same element twice.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given nums = [2, 7, 11, 15], target = 9,</span><br><span class="line"></span><br><span class="line">Because nums[0] + nums[1] = 2 + 7 = 9,</span><br><span class="line">return [0, 1].</span><br></pre></td></tr></table></figure><h3 id="hash-table">Hash Table</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums: list, target: int)</span> -&gt; list:</span></span><br><span class="line">        table = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i, n <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            <span class="keyword">if</span> target - n <span class="keyword">in</span> table:</span><br><span class="line">                <span class="keyword">return</span> [table[target - n], i]</span><br><span class="line">            table[n] = i</span><br><span class="line">        <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="input-array-is-sorted">Input array is sorted</h2><p>Given an array of integers that is already <strong>sorted in ascending order</strong>, find two numbers such that they add up to a specific target number.</p><p>The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2.</p><p><strong>Note</strong>:</p><ul><li>Your returned answers (both index1 and index2) are <strong>not zero-based</strong>.</li><li>You may assume that each input would have exactly one solution and you may not use the same element twice.</li></ul><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: numbers = [2,7,11,15], target = 9</span><br><span class="line">Output: [1,2]</span><br><span class="line">Explanation: The sum of 2 and 7 is 9. Therefore index1 = 1, index2 = 2.</span><br></pre></td></tr></table></figure><h3 id="two-pointers">Two Pointers</h3><p>Since nums is sorted, we can make use of this property. Prepare two pointers <code>i, j</code>,</p><ul><li>if <code>nums[i] + nums[j] == target</code>, return <code>[i + 1 ,j + 1]</code>.</li><li>if <code>nums[i] + nums[j] &lt; target</code>, <code>i = i + 1</code>, so that <code>nums[i]</code> is larger than previous.</li><li>if <code>nums[i] + nums[j] &gt; target</code>, <code>j = j - 1</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, numbers: list, target: int)</span> -&gt; list:</span></span><br><span class="line">        i, j = <span class="number">0</span>, len(numbers) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; j:</span><br><span class="line">            current = numbers[i] + numbers[j]</span><br><span class="line">            <span class="keyword">if</span> current == target:</span><br><span class="line">                <span class="keyword">return</span> [i + <span class="number">1</span>, j + <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">elif</span> current &lt; target:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure><h2 id="input-is-a-bst">Input is a BST</h2><p>Given a Binary Search Tree and a target number, return true if there exist two elements in the BST such that their sum is equal to the given target.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  3   6</span><br><span class="line"> / \   \</span><br><span class="line">2   4   7</span><br><span class="line"></span><br><span class="line">Target = 9</span><br><span class="line"></span><br><span class="line">Output: True</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  3   6</span><br><span class="line"> / \   \</span><br><span class="line">2   4   7</span><br><span class="line"></span><br><span class="line">Target = 28</span><br><span class="line"></span><br><span class="line">Output: False</span><br></pre></td></tr></table></figure><h3 id="traversal-hash-set">Traversal + Hash Set</h3><p>Input can be any binary tree.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n). The entire tree is traversed only once in the worst case.</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findTarget</span><span class="params">(self, root: TreeNode, k: int)</span> -&gt; bool:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node, hSet)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> k - node.val <span class="keyword">in</span> hSet:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            hSet.add(node.val)</span><br><span class="line">            <span class="keyword">return</span> helper(node.left, hSet) <span class="keyword">or</span> helper(node.right, hSet)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(root, set())</span><br></pre></td></tr></table></figure><h3 id="inorder-two-pointers">Inorder + Two Pointers</h3><p>Only for BST since we used the property of BST.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findTarget</span><span class="params">(self, root: TreeNode, k: int)</span> -&gt; bool:</span></span><br><span class="line">        nums = []</span><br><span class="line">        self.inorder(root, nums)</span><br><span class="line">        i, j = <span class="number">0</span>, len(nums) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; j:</span><br><span class="line">            current = nums[i] + nums[j]</span><br><span class="line">            <span class="keyword">if</span> current == k:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> current &lt; k:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                j -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorder</span><span class="params">(self, root, res)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> root:</span><br><span class="line">            self.inorder(root.left, res)</span><br><span class="line">            res.append(root.val)</span><br><span class="line">            self.inorder(root.right, res)</span><br></pre></td></tr></table></figure><h1 id="sum-1">3 Sum</h1><p>Given an array nums of n integers, are there elements a, b, c in nums such that <code>a + b + c = 0</code>? Find <strong>all unique</strong> triplets in the array which gives the sum of zero.</p><p><strong>Note</strong>: The solution set must not contain duplicate triplets.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given array nums = [-1, 0, 1, 2, -1, -4],</span><br><span class="line"></span><br><span class="line">A solution set is:</span><br><span class="line">[</span><br><span class="line">  [-1, 0, 1],</span><br><span class="line">  [-1, -1, 2]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="sorting-two-pointers">Sorting + Two Pointers</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(1) or O(n) depending on extra memory needed for sorting</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums: list)</span> -&gt; list:</span></span><br><span class="line">        res = []</span><br><span class="line">        nums.sort()</span><br><span class="line">        <span class="keyword">for</span> i, a <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> a == nums[i - <span class="number">1</span>]:  <span class="comment"># skip same value</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            l, r = i + <span class="number">1</span>, len(nums) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> l &lt; r:</span><br><span class="line">                threeSum = a + nums[l] + nums[r]</span><br><span class="line">                <span class="keyword">if</span> threeSum &gt; <span class="number">0</span>:</span><br><span class="line">                    r -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> threeSum &lt; <span class="number">0</span>:</span><br><span class="line">                    l += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    res.append([a, nums[l], nums[r]])</span><br><span class="line">                    l += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> nums[l] == nums[l - <span class="number">1</span>] <span class="keyword">and</span> l &lt; r:</span><br><span class="line">                        l += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="sum-2">4 Sum</h1><p>Given an array <code>nums</code> of n integers and an integer target, are there elements a, b, c, and d in nums such that <code>a + b + c + d = target</code>? Find <strong>all unique</strong> quadruplets in the array which gives the sum of target.</p><p><strong>Note</strong>: The solution set must not contain duplicate quadruplets.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given array nums = [1, 0, -1, 0, -2, 2], and target = 0.</span><br><span class="line"></span><br><span class="line">A solution set is:</span><br><span class="line">[</span><br><span class="line">  [-1,  0, 0, 1],</span><br><span class="line">  [-2, -1, 1, 2],</span><br><span class="line">  [-2,  0, 0, 2]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>If an interviewer asks you to solve 4Sum, they can follow-up with 5Sum, 6Sum, and so on. What they are really expecting at this point is a kSum solution.</p><h2 id="sorting-recursion">Sorting + Recursion</h2><p>The two pointers pattern requires the array to be sorted, so we do that first. Also, it's easier to deal with duplicates if the array is sorted: repeated values are next to each other and easy to skip.</p><p>For 3Sum, we enumerate each value in a single loop, and use the two pointers pattern for the rest of the array. For kSum, we will have <code>k - 2</code> nested loops.</p><p>We can implement <code>k - 2</code> loops using a recursion. We will pass the starting point and k as the parameters. When <code>k == 2</code>, we will call twoSum, terminating the recursion.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^(k - 1)) for k sum</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fourSum</span><span class="params">(self, nums: list, target: int)</span> -&gt; list:</span></span><br><span class="line">        nums.sort()</span><br><span class="line">        <span class="keyword">return</span> self.kSum(nums, target, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kSum</span><span class="params">(self, nums: list, target: int, k: int)</span> -&gt; list:</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">if</span> len(nums) == <span class="number">0</span> <span class="keyword">or</span> nums[<span class="number">0</span>] * k &gt; target <span class="keyword">or</span> target &gt; nums[<span class="number">-1</span>] * k:</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> self.twoSum(nums, target)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">or</span> nums[i - <span class="number">1</span>] != nums[i]:</span><br><span class="line">                <span class="keyword">for</span> other <span class="keyword">in</span> self.kSum(nums[i + <span class="number">1</span>:], target - nums[i], k - <span class="number">1</span>):</span><br><span class="line">                    res.append([nums[i]] + other)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Two Pointers</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums: list, target: int)</span> -&gt; list:</span></span><br><span class="line">        res = []</span><br><span class="line">        lo, hi = <span class="number">0</span>, len(nums) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> lo &lt; hi:</span><br><span class="line">            current = nums[lo] + nums[hi]</span><br><span class="line">            <span class="keyword">if</span> current &lt; target <span class="keyword">or</span> (lo &gt; <span class="number">0</span> <span class="keyword">and</span> nums[lo] == nums[lo - <span class="number">1</span>]):</span><br><span class="line">                lo += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> current &gt; target <span class="keyword">or</span> (hi &lt; len(nums) - <span class="number">1</span> <span class="keyword">and</span> nums[hi] == nums[hi + <span class="number">1</span>]):</span><br><span class="line">                hi -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append([nums[lo], nums[hi]])</span><br><span class="line">                lo += <span class="number">1</span></span><br><span class="line">                hi -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="sorting-hash-set">Sorting + Hash Set</h2><p>The code will only differ in the twoSum implementation.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hash set</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums: list, target: int)</span> -&gt; list:</span></span><br><span class="line">    res = []</span><br><span class="line">    s = set()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">        <span class="keyword">if</span> len(res) == <span class="number">0</span> <span class="keyword">or</span> res[<span class="number">-1</span>][<span class="number">1</span>] != nums[i]:  <span class="comment"># skip same value</span></span><br><span class="line">            <span class="keyword">if</span> target - nums[i] <span class="keyword">in</span> s:</span><br><span class="line">                res.append([target - nums[i], nums[i]])</span><br><span class="line">        s.add(nums[i])</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> traversal </tag>
            
            <tag> hash table </tag>
            
            <tag> BST </tag>
            
            <tag> hash set </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Contruct Binary Tree from Traversal</title>
      <link href="/programming/leetcode/contruct-binary-tree-from-traversal/"/>
      <url>/programming/leetcode/contruct-binary-tree-from-traversal/</url>
      
        <content type="html"><![CDATA[<h1 id="from-preorder-and-inorder">From Preorder and Inorder</h1><p>Given preorder and inorder traversal of a tree, construct the binary tree.</p><p><strong>Note</strong>: You may assume that duplicates do not exist in the tree.</p><p>For example, given</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">preorder = [3,9,20,15,7]</span><br><span class="line">inorder = [9,3,15,20,7]</span><br></pre></td></tr></table></figure><p>Return the following binary tree:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><h2 id="recursion">Recursion</h2><p>The key point to solve such problems is to undertand:</p><ol type="1"><li>PreOrder: <code>[root, m nodes in left subtree, n nodes in right subtree] (m, n &gt;= 0)</code>.</li><li>InOrder: <code>[m nodes in left subtree, root, n nodes in right subtree]</code>.</li><li>PostOrder: <code>[m nodes in left subtree, n nodes in right subtree, root]</code>.</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n),</span></span><br><span class="line"><span class="comment"># Space: O(n), we copied preorder and inorder at each recursion</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, preorder: list, inorder: list)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> preorder <span class="keyword">and</span> <span class="keyword">not</span> inorder:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        root_val = preorder[<span class="number">0</span>]</span><br><span class="line">        ind = inorder.index(root_val)</span><br><span class="line">        left = self.buildTree(preorder[<span class="number">1</span>:ind + <span class="number">1</span>], inorder[:ind])</span><br><span class="line">        right = self.buildTree(preorder[ind + <span class="number">1</span>:], inorder[ind + <span class="number">1</span>:])</span><br><span class="line">        <span class="keyword">return</span> TreeNode(root_val, left, right)</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="from-inorder-and-postorder">From Inorder and Postorder</h1><p>Given inorder and postorder traversal of a tree, construct the binary tree.</p><p><strong>Note</strong>: You may assume that duplicates do not exist in the tree.</p><p>For example, given</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">inorder = [9,3,15,20,7]</span><br><span class="line">postorder = [9,15,7,20,3]</span><br></pre></td></tr></table></figure><p>Return the following binary tree:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, inorder: list, postorder: list)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inorder <span class="keyword">and</span> <span class="keyword">not</span> postorder:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        root_val = postorder[<span class="number">-1</span>]</span><br><span class="line">        ind = inorder.index(root_val)</span><br><span class="line">        left = self.buildTree(inorder[:ind], postorder[:ind])</span><br><span class="line">        right = self.buildTree(inorder[ind + <span class="number">1</span>:], postorder[ind:<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">return</span> TreeNode(root_val, left, right)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> tree </tag>
            
            <tag> traversal </tag>
            
            <tag> preorder </tag>
            
            <tag> inorder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maximum Depth of Binary Tree</title>
      <link href="/programming/leetcode/maximum-depth-of-binary-tree/"/>
      <url>/programming/leetcode/maximum-depth-of-binary-tree/</url>
      
        <content type="html"><![CDATA[<p>Given a binary tree, find its maximum depth.</p><p>The maximum depth is the number of nodes along the longest path from the root node down to the farthest leaf node.</p><p><strong>Note</strong>: A leaf is a node with no children.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line"></span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><h1 id="recursion">Recursion</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxDepth</span><span class="params">(self, root: TreeNode)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        left_depth = self.maxDepth(root.left)</span><br><span class="line">        right_depth = self.maxDepth(root.right)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + max(left_depth, right_depth)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Symmetric Tree and Same Tree</title>
      <link href="/programming/leetcode/symmetric-and-same-tree/"/>
      <url>/programming/leetcode/symmetric-and-same-tree/</url>
      
        <content type="html"><![CDATA[<h1 id="symmetric-tree">Symmetric Tree</h1><p>Given a binary tree, check whether it is a mirror of itself (ie, symmetric around its center).</p><p>For example, this binary tree is symmetric:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   2</span><br><span class="line"> / \ / \</span><br><span class="line">3  4 4  3</span><br></pre></td></tr></table></figure><p>But the following is not:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  1</span><br><span class="line"> / \</span><br><span class="line">2   2</span><br><span class="line"> \   \</span><br><span class="line"> 3    3</span><br></pre></td></tr></table></figure><p><strong>Follow up</strong>: Solve it both recursively and iteratively.</p><h2 id="recursion">Recursion</h2><p>Define a function <code>helper(t1, t2)</code>, then return true if <code>t1</code> and <code>t2</code> is symmetric. A tree <code>root</code> is symmetric only if <code>root.left</code> and <code>root.right</code> are symmetric.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isSymmetric</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(t1, t2)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> t1 <span class="keyword">and</span> <span class="keyword">not</span> t2:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> t1 <span class="keyword">or</span> <span class="keyword">not</span> t2 <span class="keyword">or</span> t1.val != t2.val:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">return</span> helper(t1.left, t2.right) <span class="keyword">and</span> helper(t1.right, t2.left)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(root.left, root.right)</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="iteration">Iteration</h2><p>The <code>helper(t1, t2)</code> is actually a recursive traversal function, which visit two trees at the same time. The order to visit <code>t1</code> is <code>node -&gt; left -&gt; right</code> (preorder), but the order to visit <code>t2</code> is <code>node -&gt; right -&gt; left</code> (modified preorder).</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isSymmetric</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        stack = [(root, root)]</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            n1, n2 = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> n1 <span class="keyword">and</span> <span class="keyword">not</span> n2:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> n1 <span class="keyword">or</span> <span class="keyword">not</span> n2 <span class="keyword">or</span> n1.val != n2.val:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            stack.append((n1.left, n2.right))</span><br><span class="line">            stack.append((n1.right, n2.left))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="same-tree">Same Tree</h1><p>Given two binary trees, write a function to check if they are the same or not.</p><p>Two binary trees are considered the same if they are structurally identical and the nodes have the same value.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:     1         1</span><br><span class="line">          / \       / \</span><br><span class="line">         2   3     2   3</span><br><span class="line"></span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:     1         1</span><br><span class="line">          /           \</span><br><span class="line">         2             2</span><br><span class="line"></span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:     1         1</span><br><span class="line">          / \       / \</span><br><span class="line">         2   1     1   2</span><br><span class="line"></span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h2 id="recursion-1">Recursion</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isSameTree</span><span class="params">(self, p: TreeNode, q: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> p <span class="keyword">and</span> <span class="keyword">not</span> q:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> p <span class="keyword">or</span> <span class="keyword">not</span> q <span class="keyword">or</span> p.val != q.val:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> self.isSameTree(p.left, q.left) <span class="keyword">and</span> self.isSameTree(p.right, q.right)</span><br></pre></td></tr></table></figure><h2 id="iteration-1">Iteration</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isSameTree</span><span class="params">(self, p: TreeNode, q: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        stack = [(p, q)]</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            np, nq = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> np <span class="keyword">and</span> <span class="keyword">not</span> nq:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> np <span class="keyword">or</span> <span class="keyword">not</span> nq <span class="keyword">or</span> np.val != nq.val:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            stack.append((np.right, nq.right))</span><br><span class="line">            stack.append((np.left, nq.left))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> tree </tag>
            
            <tag> traversal </tag>
            
            <tag> preorder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼æ€»ç»“</title>
      <link href="/notes/head-first-design-patterns/summary-of-design-patterns/"/>
      <url>/notes/head-first-design-patterns/summary-of-design-patterns/</url>
      
        <content type="html"><![CDATA[<h1 id="å®šä¹‰è®¾è®¡æ¨¡å¼">å®šä¹‰è®¾è®¡æ¨¡å¼</h1><blockquote><p>è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—<strong>è¢«åå¤ä½¿ç”¨</strong>çš„ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£å¹¶ä¸”ä¿è¯ä»£ç å¯é æ€§ã€‚</p><p>â€”â€”ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢æ€§å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹</p></blockquote><blockquote><p>æ¨¡å¼æ˜¯åœ¨æŸæƒ…å¢ƒä¸‹ï¼Œé’ˆå¯¹æŸé—®é¢˜çš„æŸç§è§£å†³æ–¹æ¡ˆã€‚</p><p>æƒ…æ™¯å°±æ˜¯åº”ç”¨æŸä¸ªæ¨¡å¼çš„æƒ…å†µã€‚è¿™åº”è¯¥æ˜¯ä¼š<strong>ä¸æ–­å‡ºçŽ°</strong>çš„æƒ…å†µã€‚</p><p>é—®é¢˜å°±æ˜¯ä½ æƒ³åœ¨æŸæƒ…å¢ƒä¸‹è¾¾åˆ°çš„ç›®æ ‡ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯æŸæƒ…å¢ƒä¸‹çš„çº¦æŸã€‚</p><p>è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½ è¿½æ±‚çš„ï¼šä¸€ä¸ªé€šç”¨çš„è®¾è®¡ï¼Œç”¨æ¥è§£å†³çº¦æŸï¼Œè¾¾åˆ°ç›®æ ‡ã€‚</p><p>â€”â€”ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹</p></blockquote><p>ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªæ¨¡å¼æœ‰å››ä¸ªåŸºæœ¬è¦ç´ ï¼š</p><ol type="1"><li>æ¨¡å¼åç§°ï¼ˆpattern nameï¼‰ï¼šé€šè¿‡ä¸€ä¸¤ä¸ªè¯æ¥ä¸ºæ¨¡å¼å‘½åï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´å¥½åœ°ç†è§£æ¨¡å¼å¹¶æ–¹ä¾¿å¼€å‘äººå‘˜ä¹‹é—´äº¤æµã€‚</li><li>é—®é¢˜ï¼ˆproblemï¼‰ï¼šæè¿°äº†åº”è¯¥åœ¨ä½•æ—¶ä½¿ç”¨æ¨¡å¼ï¼Œå®ƒåŒ…å«äº†è®¾è®¡ä¸­å­˜åœ¨çš„é—®é¢˜ä»¥åŠé—®é¢˜å­˜åœ¨çš„åŽŸå› ã€‚</li><li>è§£å†³æ–¹æ¡ˆï¼ˆsolutionï¼‰ï¼šæè¿°äº†ä¸€ä¸ªè®¾è®¡æ¨¡å¼çš„ç»„æˆéƒ¨åˆ†ï¼Œä»¥åŠè¿™äº›ç»„æˆéƒ¨åˆ†ä¹‹é—´çš„ç›¸äº’å…³ç³»ã€å„è‡ªçš„èŒè´£å’Œåä½œæ–¹å¼ï¼Œé€šå¸¸è§£å†³æ–¹æ¡ˆé€šè¿‡UMLç±»å›¾å’Œæ ¸å¿ƒä»£ç è¿›è¡Œæè¿°ã€‚</li><li>æ•ˆæžœï¼ˆconsequencesï¼‰ï¼šæè¿°äº†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä»¥åŠåœ¨ä½¿ç”¨æ¨¡å¼æ—¶åº”æƒè¡¡çš„é—®é¢˜ã€‚</li></ol><blockquote><p>ç¬¦åˆæ¨¡å¼å¹¶ä¸è¡¨ç¤ºåšå¾—å¯¹ã€‚</p><p>â€”â€” Ralph Johnsonï¼Œã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢æ€§å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹çš„ä½œè€…ä¹‹ä¸€</p></blockquote><blockquote><p>è™½ç„¶è®¾è®¡æ¨¡å¼ä¸Žè¯­è¨€æ— å…³ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ¯ä¸€ä¸ªæ¨¡å¼éƒ½èƒ½åœ¨æ¯ä¸€é—¨è¯­è¨€ä¸­ä½¿ç”¨ã€‚1996 å¹´ï¼ŒPeter Norvig åœ¨é¢˜ä¸ºâ€œ<a href="http://norvig.com/design-patterns/" target="_blank" rel="noopener">Design Patterns in Dynamic Languages</a>â€çš„æ¼”è®²ä¸­æŒ‡å‡ºï¼ŒGamma ç­‰äººåˆè‘—çš„ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ä¸­æœ‰ 23 ä¸ªæ¨¡å¼ï¼Œå…¶ä¸­æœ‰ 16 ä¸ªåœ¨åŠ¨æ€è¯­è¨€ä¸­â€œä¸è§äº†ï¼Œæˆ–è€…ç®€åŒ–äº†â€ï¼ˆå‚è§ç¬¬ 9 å¼ å¹»ç¯ç‰‡ï¼‰ã€‚ä»–è®¨è®ºçš„æ˜¯ Lisp å’Œ Dylanï¼Œä¸è¿‡å¾ˆå¤šç›¸å…³çš„åŠ¨æ€ç‰¹æ€§åœ¨ Python ä¸­ä¹Ÿèƒ½æ‰¾åˆ°ã€‚</p><p>â€”â€”ã€Šæµç•…çš„Pythonã€‹ç¬¬6ç« </p></blockquote><a id="more"></a><h1 id="ç»„ç»‡ç¼–ç›®">ç»„ç»‡ç¼–ç›®</h1><table><tr><th colspan="2" rowspan="2"></th><th colspan="3">ç›®çš„</th></tr><tr><th>åˆ›å»ºåž‹</th><th>ç»“æž„åž‹</th><th>è¡Œä¸ºåž‹</th></tr><tr><th rowspan="2">èŒƒå›´</th><th>ç±»</th><td>å·¥åŽ‚æ–¹æ³•</td><td>é€‚é…å™¨ï¼ˆç±»ï¼‰</td><td>è§£é‡Šå™¨<br>æ¨¡æ¿æ–¹æ³•</td></tr><tr><th>å¯¹è±¡</th><td>æŠ½è±¡å·¥åŽ‚<br>ç”Ÿæˆå™¨<br>åŽŸåž‹<br>å•ä¾‹</td><td>é€‚é…å™¨ï¼ˆå¯¹è±¡ï¼‰<br>æ¡¥æŽ¥<br>ç»„æˆ<br>è£…é¥°<br>å¤–è§‚<br>äº«å…ƒ<br>ä»£ç†</td><td>èŒè´£é“¾<br>å‘½ä»¤<br>è¿­ä»£å™¨<br>ä¸­ä»‹è€…<br>è§‚å¯Ÿè€…<br>çŠ¶æ€<br>ç­–ç•¥<br>è®¿é—®è€…</td></tr></table><p>æ ¹æ®ä¸¤æ¡å‡†åˆ™å¯¹æ¨¡å¼è¿›è¡Œåˆ†ç±»ã€‚ç¬¬ä¸€æ˜¯ç›®çš„å‡†åˆ™ï¼Œå³æ¨¡å¼æ˜¯ç”¨æ¥å®Œæˆä»€ä¹ˆå·¥ä½œçš„ã€‚ä¾æ®å…¶ç›®çš„å¯åˆ†ä¸ºåˆ›å»ºåž‹ï¼ˆcreationalï¼‰ã€ç»“æž„åž‹ï¼ˆstructuralï¼‰æˆ–è¡Œä¸ºåž‹ï¼ˆbehavioralï¼‰ä¸‰ç§ã€‚åˆ›å»ºåž‹æ¨¡å¼ä¸Žå¯¹è±¡çš„åˆ›å»ºæœ‰å…³ï¼›ç»“æž„åž‹æ¨¡å¼å¤„ç†ç±»æˆ–å¯¹è±¡çš„ç»„åˆï¼›è¡Œä¸ºåž‹æ¨¡å¼å¯¹ç±»æˆ–å¯¹è±¡æ€Žæ ·äº¤äº’å’Œæ€Žæ ·åˆ†é…èŒè´£è¿›è¡Œæè¿°ã€‚</p><p>ç¬¬äºŒå‡†åˆ™æ˜¯èŒƒå›´ï¼ŒæŒ‡å®šæ¨¡å¼ä¸»è¦æ˜¯ç”¨äºŽç±»è¿˜æ˜¯ç”¨äºŽå¯¹è±¡ã€‚<strong>ç±»æ¨¡å¼å¤„ç†ç±»å’Œå­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œè¿™äº›å…³ç³»é€šè¿‡ç»§æ‰¿å»ºç«‹ï¼Œæ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ»ä¾¿ç¡®å®šä¸‹æ¥äº†ã€‚å¯¹è±¡æ¨¡å¼å¤„ç†å¯¹è±¡é—´çš„å…³ç³»ï¼Œè¿™äº›å…³ç³»åœ¨è¿è¡Œæ—¶åˆ»æ˜¯å¯ä»¥å˜åŒ–çš„ï¼Œæ›´å…·åŠ¨æ€æ€§</strong>ã€‚ä»ŽæŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œå‡ ä¹Žæ‰€æœ‰æ¨¡å¼éƒ½é€‚ç”¨ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥â€ç±»æ¨¡å¼â€œåªæŒ‡é‚£äº›é›†ä¸­äºŽå¤„ç†ç±»é—´å…³ç³»çš„æ¨¡å¼ï¼Œè€Œå¤§éƒ¨åˆ†æ¨¡å¼éƒ½å±žäºŽå¯¹è±¡æ¨¡å¼çš„èŒƒç•´ã€‚</p><h1 id="oo-åŸºç¡€">OO åŸºç¡€</h1><p>æŠ½è±¡ï¼Œå°è£…ï¼Œå¤šæ€ï¼Œç»§æ‰¿</p><h1 id="oo-åŽŸåˆ™">OO åŽŸåˆ™</h1><table><colgroup><col style="width: 33%"><col style="width: 66%"></colgroup><thead><tr class="header"><th>åç§°æˆ–å†…å®¹</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td>å°è£…å˜åŒ–</td><td>æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</td></tr><tr class="even"><td>é’ˆå¯¹æŽ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®žçŽ°ç¼–ç¨‹</td><td>â€œé’ˆå¯¹æŽ¥å£ç¼–ç¨‹â€çœŸæ­£çš„æ„æ€æ˜¯â€œé’ˆå¯¹è¶…ç±»åž‹ï¼ˆsupertypeï¼‰ç¼–ç¨‹ï¼Œå¯ä»¥æ›´æ˜Žç¡®åœ°è¯´æˆâ€å˜é‡çš„å£°æ˜Žç±»åž‹åº”è¯¥æ˜¯è¶…ç±»åž‹ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–è€…æ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œå¦‚æ­¤ï¼Œåªè¦æ˜¯å…·ä½“å®žçŽ°æ­¤è¶…ç±»åž‹çš„ç±»æ‰€äº§ç”Ÿçš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥æŒ‡å®šç»™è¿™ä¸ªå˜é‡ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå£°æ˜Žç±»æ—¶ä¸ç”¨ç†ä¼šä»¥åŽæ‰§è¡Œæ—¶çš„çœŸæ­£å¯¹è±¡ç±»åž‹ï¼â€ã€‚</td></tr><tr class="odd"><td>å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿</td><td>ä½¿ç”¨ç»„åˆå»ºç«‹ç³»ç»Ÿå…·æœ‰å¾ˆå¤§çš„å¼¹æ€§ã€‚ï¼ˆå¤§å¤šæ•°æ¨¡å¼éƒ½æ˜¯ç”¨äºŽå¯¹è±¡ï¼‰</td></tr><tr class="even"><td>ä¸ºäº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›</td><td>å½“ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ¾è€¦åˆï¼Œå®ƒä»¬ä¾ç„¶å¯ä»¥äº¤äº’ï¼Œä½†æ˜¯ä¸å¤ªæ¸…æ¥šå½¼æ­¤çš„ç»†èŠ‚ã€‚åªè¦å®ƒä»¬ä¹‹é—´çš„æŽ¥å£ä»è¢«éµå®ˆï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°æ”¹å˜å®ƒä»¬ï¼Œæ”¹å˜å…¶ä¸­ä¸€æ–¹ï¼Œå¹¶ä¸ä¼šå½±å“å¦ä¸€æ–¹ã€‚</td></tr><tr class="odd"><td>å¼€é—­åŽŸåˆ™ï¼ˆOpen-Closed Principleï¼‰</td><td>ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</td></tr><tr class="even"><td>ä¾èµ–å€’ç½®åŽŸåˆ™ï¼ˆDependency Inversion Principleï¼‰</td><td>è¦ä¾èµ–æŠ½è±¡ï¼Œä¸è¦ä¾èµ–å…·ä½“ç±»ã€‚å¾ˆåƒâ€œé’ˆå¯¹æŽ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®žçŽ°ç¼–ç¨‹â€œï¼Œç„¶è€Œè¿™é‡Œæ›´å¼ºè°ƒâ€æŠ½è±¡â€œã€‚ä¸èƒ½è®©é«˜å±‚ç»„ä»¶ä¾èµ–ä½Žå±‚ç»„ä»¶ï¼Œè€Œä¸”ï¼Œä¸ç®¡é«˜å±‚æˆ–ä½Žå±‚ç»„ä»¶ï¼Œéƒ½åº”è¯¥ä¾èµ–äºŽæŠ½è±¡ã€‚</td></tr><tr class="odd"><td>æœ€å°‘çŸ¥è¯†åŽŸåˆ™ï¼ˆLeast Knowledge Principleï¼‰<br>ä¹Ÿå«åšè¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼‰</td><td>åªå’Œä½ çš„å¯†å‹è°ˆè¯ã€‚è¿™ä¸ªåŽŸåˆ™æä¾›äº†ä¸€äº›æ–¹é’ˆï¼šå°±ä»»ä½•å¯¹è±¡è€Œè¨€ï¼Œåœ¨è¯¥å¯¹è±¡çš„æ–¹æ³•å†…ï¼Œæˆ‘ä»¬åªåº”è¯¥è°ƒç”¨å±žäºŽä»¥ä¸‹èŒƒå›´çš„æ–¹æ³•ï¼šè¯¥å¯¹è±¡æœ¬èº«ï¼›è¢«å½“ä½œæ–¹æ³•çš„å‚æ•°è€Œä¼ é€’è¿›æ¥çš„å¯¹è±¡ï¼›æ­¤æ–¹æ³•æ‰€åˆ›å»ºæˆ–å®žä¾‹åŒ–çš„ä»»ä½•å¯¹è±¡ï¼›å¯¹è±¡çš„ä»»ä½•ç»„ä»¶ã€‚</td></tr><tr class="even"><td>å¥½èŽ±åžåŽŸåˆ™</td><td>åˆ«è°ƒç”¨æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä½ ã€‚</td></tr><tr class="odd"><td>å•ä¸€è´£ä»»åŽŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰</td><td>ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å˜åŒ–çš„åŽŸå› ã€‚</td></tr></tbody></table><h1 id="oo-æ¨¡å¼">OO æ¨¡å¼</h1><table><thead><tr class="header"><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="/notes/head-first-design-patterns/strategy-pattern/" title="ç­–ç•¥">ç­–ç•¥</a></td><td>å®šä¹‰ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥<strong>äº’ç›¸æ›¿æ¢</strong>ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºŽä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/observer-pattern/" title="è§‚å¯Ÿè€…">è§‚å¯Ÿè€…</a></td><td>åœ¨å¯¹è±¡ä¹‹é—´å®šä¹‰ä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œä¾èµ–å®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/decorator-pattern/" title="è£…é¥°è€…">è£…é¥°è€…</a></td><td>åŠ¨æ€åœ°å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚æƒ³è¦æ‰©å±•åŠŸèƒ½ï¼Œè£…é¥°è€…æä¾›æœ‰åˆ«äºŽç»§æ‰¿çš„å¦ä¸€ç§é€‰æ‹©ã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/factory-pattern/" title="ç®€å•å·¥åŽ‚">ç®€å•å·¥åŽ‚</a></td><td>ç®€å•å·¥åŽ‚å…¶å®žä¸æ˜¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œåè€Œæ¯”è¾ƒåƒæ˜¯ä¸€ç§ç¼–ç¨‹ä¹ æƒ¯ã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/factory-pattern/" title="å·¥åŽ‚æ–¹æ³•">å·¥åŽ‚æ–¹æ³•</a></td><td>å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŽ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®žä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥åŽ‚æ–¹æ³•è®©ç±»æŠŠå®žä¾‹åŒ–æŽ¨è¿Ÿåˆ°å­ç±»ã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/factory-pattern/" title="æŠ½è±¡å·¥åŽ‚">æŠ½è±¡å·¥åŽ‚</a></td><td>æä¾›ä¸€ä¸ªæŽ¥å£ï¼Œç”¨äºŽåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„<strong>å®¶æ—</strong>ï¼Œè€Œä¸éœ€è¦æ˜Žç¡®æŒ‡å®šå…·ä½“ç±»ã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/singleton-pattern/" title="å•ä»¶">å•ä»¶</a></td><td>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/command-pattern/" title="å‘½ä»¤">å‘½ä»¤</a></td><td>å°†â€œè¯·æ±‚â€å°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ã€é˜Ÿåˆ—æˆ–è€…æ—¥å¿—æ¥å‚æ•°åŒ–å…¶ä»–å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/adapter-pattern-and-facade-pattern/" title="é€‚é…å™¨">é€‚é…å™¨</a></td><td>å°†ä¸€ä¸ªç±»çš„æŽ¥å£ï¼Œè½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæŽ¥å£ã€‚é€‚é…å™¨è®©é‚£ä¸ªåŽŸæœ¬æŽ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/adapter-pattern-and-facade-pattern/" title="å¤–è§‚">å¤–è§‚</a></td><td>æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æŽ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æŽ¥å£ã€‚å¤–è§‚å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æŽ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/template-method-pattern/" title="æ¨¡æ¿æ–¹æ³•">æ¨¡æ¿æ–¹æ³•</a></td><td>åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æž¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æž„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/iterator-pattern-and-composite-pattern/" title="è¿­ä»£å™¨">è¿­ä»£å™¨</a></td><td>æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨çš„è¡¨ç¤ºã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/iterator-pattern-and-composite-pattern/" title="ç»„åˆ">ç»„åˆ</a></td><td>å…è®¸ä½ å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æž„æ¥è¡¨çŽ°â€œæ•´ä½“/éƒ¨åˆ†â€å±‚æ¬¡ç»“æž„ã€‚ç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠå¯¹è±¡ç»„åˆã€‚</td></tr><tr class="even"><td><a href="/notes/head-first-design-patterns/state-pattern/" title="çŠ¶æ€">çŠ¶æ€</a></td><td>å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚</td></tr><tr class="odd"><td><a href="/notes/head-first-design-patterns/proxy-pattern/" title="ä»£ç†">ä»£ç†</a></td><td>ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«æˆ–å ä½ç¬¦ä»¥æŽ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤åˆæ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/compound-pattern/"/>
      <url>/notes/head-first-design-patterns/compound-pattern/</url>
      
        <content type="html"><![CDATA[<p>æ¨¡å¼é€šå¸¸è¢«ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶è¢«ç»„åˆåœ¨åŒä¸€ä¸ªè®¾è®¡è§£å†³æ–¹æ¡ˆä¸­ã€‚å¤åˆæ¨¡å¼ï¼ˆCompound Patternï¼‰åœ¨ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸­ç»“åˆä¸¤ä¸ªæˆ–å¤šä¸ªæ¨¡å¼ï¼Œå·²è§£å†³ä¸€èˆ¬æˆ–é‡å¤å‘ç”Ÿçš„é—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬å°†æŸäº›æ¨¡å¼ç»“åˆä½¿ç”¨ï¼Œå¹¶ä¸ä»£è¡¨è¿™äº›æ¨¡å¼å°±å¤Ÿèµ„æ ¼ç§°ä¸ºå¤åˆæ¨¡å¼ã€‚<strong>å¤åˆæ¨¡å¼å¿…é¡»å¤Ÿä¸€èˆ¬æ€§ï¼Œé€‚åˆè§£å†³è®¸å¤šé—®é¢˜æ‰è¡Œ</strong>ã€‚</p><h1 id="å®šä¹‰å¤åˆæ¨¡å¼">å®šä¹‰å¤åˆæ¨¡å¼</h1><p>å¤åˆæ¨¡å¼ç»“åˆä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„æ¨¡å¼ï¼Œç»„æˆä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè§£å†³ä¸€å†å‘ç”Ÿçš„ä¸€èˆ¬æ€§é—®é¢˜ã€‚</p><h1 id="å¯¼å…¥ä¸Žé¸­å­é‡èš">å¯¼å…¥ï¼šä¸Žé¸­å­é‡èš</h1><p>æˆ‘ä»¬å°†ä»Žå¤´é‡å»ºæˆ‘ä»¬çš„é¸­å­æ¨¡æ‹Ÿå™¨ï¼Œå¹¶é€šè¿‡ä½¿ç”¨ä¸€å †æ¨¡å¼æ¥èµ‹äºˆå®ƒä¸€äº›æœ‰è¶£çš„èƒ½åŠ›ã€‚åŠ¨å·¥äº†â€¦â€¦</p><a id="more"></a><h1 id="ä»Ž-quackable-å¼€å§‹">ä»Ž Quackable å¼€å§‹</h1><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä¸ç ”ç©¶é¸­å­çš„é£žè¡Œã€å‘±å‘±å«ç­‰è¡Œä¸ºï¼Œæˆ‘ä»¬è®©é¸­å­å®žçŽ° Quackable æŽ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallardDuck</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Quack"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckCall</span>  <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;  <span class="comment">// é¸­é¸£å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Kwak"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RubberDuck</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Squeak"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DuckSimulator simulator = <span class="keyword">new</span> DuckSimulator();</span><br><span class="line">        simulator.simulate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Quackable mallardDuck = <span class="keyword">new</span> MallardDuck();</span><br><span class="line">        Quackable duckCall = <span class="keyword">new</span> DuckCall();</span><br><span class="line">        Quackable rubberDuck = <span class="keyword">new</span> RubberDuck();</span><br><span class="line"></span><br><span class="line">        simulate(mallardDuck);</span><br><span class="line">        simulate(duckCall);</span><br><span class="line">        simulate(rubberDuck);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java DuckSimulator</span><br><span class="line">Quack</span><br><span class="line">Kwak</span><br><span class="line">Squeak</span><br></pre></td></tr></table></figure><h1 id="æœ‰ä¸€åªé¹…å‡ºçŽ°äº†">æœ‰ä¸€åªé¹…å‡ºçŽ°äº†</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Goose</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">honk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Honk"</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒå¸Œæœ›è‡ªå·±åƒä¸€ä¸ª Quackableã€‚æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨<strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼Œå°†é¹…é€‚é…æˆ Quackableã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GooseAdapter</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    Goose goose;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GooseAdapter</span><span class="params">(Goose goose)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.goose = goose;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        goose.honk();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DuckSimulator simulator = <span class="keyword">new</span> DuckSimulator();</span><br><span class="line">        simulator.simulate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Quackable duckCall = <span class="keyword">new</span> DuckCall();</span><br><span class="line">        Quackable rubberDuck = <span class="keyword">new</span> RubberDuck();</span><br><span class="line">        Quackable gooseDuck = <span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose());  <span class="comment">// é¹…å‡ºçŽ°</span></span><br><span class="line"></span><br><span class="line">        simulate(mallardDuck);</span><br><span class="line">        simulate(duckCall);</span><br><span class="line">        simulate(rubberDuck);</span><br><span class="line">        simulate(gooseDuck);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java DuckSimulator</span><br><span class="line">Quack</span><br><span class="line">Kwak</span><br><span class="line">Squeak</span><br><span class="line">Honk</span><br></pre></td></tr></table></figure><h1 id="è®¡ç®—å‘±å‘±å®¶æ¬¡æ•°">è®¡ç®—å‘±å‘±å®¶æ¬¡æ•°</h1><p>å‘±å‘±å«å­¦å®¶å†³å®šè¦è®¡ç®—å‘±å‘±å«å£°çš„æ¬¡æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<strong>è£…é¥°è€…æ¨¡å¼</strong>ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º QuackCounter çš„è£…é¥°è€…ã€‚å®ƒç”¨æ¥è¿½è¸ª <code>quack()</code> è¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œå¹¶å°†è°ƒç”¨å§”æ‰˜ç»™å®ƒæ‰€è£…é¥°çš„ Quackable å¯¹è±¡ã€‚é€šè¿‡æŠŠé¸­å­åŒ…è£…è¿›è£…é¥°è€…å¯¹è±¡ï¼Œç»™é¸­å­ä¸€äº›æ–°è¡Œä¸ºï¼ˆè®¡ç®—æ¬¡æ•°ï¼‰ã€‚æˆ‘ä»¬ä¸å¿…ä¿®æ”¹é¸­å­çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuackCounter</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    Quackable duck;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> numberOfQuacks;  <span class="comment">// åˆ©ç”¨é™æ€å˜é‡è¿½è¸ªæ‰€æœ‰å‘±å‘±å«æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuackCounter</span> <span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.duck = duck;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">        numberOfQuacks++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getQuacks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numberOfQuacks;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DuckSimulator simulator = <span class="keyword">new</span> DuckSimulator();</span><br><span class="line">        simulator.simulate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Quackable mallardDuck = <span class="keyword">new</span> QuackCounter(<span class="keyword">new</span> MallardDuck());</span><br><span class="line">        Quackable duckCall = <span class="keyword">new</span> QuackCounter(<span class="keyword">new</span> DuckCall());</span><br><span class="line">        Quackable rubberDuck = <span class="keyword">new</span> QuackCounter(<span class="keyword">new</span> RubberDuck());  <span class="comment">// è£…é¥°æ‰€æœ‰é¸­å­</span></span><br><span class="line">        Quackable gooseDuck = <span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose());  <span class="comment">// é¹…å°±ç®—äº†</span></span><br><span class="line"></span><br><span class="line">        simulate(mallardDuck);</span><br><span class="line">        simulate(duckCall);</span><br><span class="line">        simulate(rubberDuck);</span><br><span class="line">        simulate(gooseDuck);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"The ducks quacked "</span> + QuackCounter.getQuacks()</span><br><span class="line">            + <span class="string">" times"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java DuckSimulator</span><br><span class="line">Quack</span><br><span class="line">Kwak</span><br><span class="line">Squeak</span><br><span class="line">Honk</span><br><span class="line">The ducks quacked 3 times</span><br></pre></td></tr></table></figure><h1 id="å‘±å‘±å«å­¦å®¶æ‹…å¿ƒå¿˜è®°è®¡æ•°">å‘±å‘±å«å­¦å®¶æ‹…å¿ƒå¿˜è®°è®¡æ•°</h1><p>æˆ‘ä»¬éœ€è¦ä¸€äº›è´¨é‡æŽ§åˆ¶æ¥ç¡®ä¿é¸­å­ä¸€å®šæ˜¯è¢«åŒ…è£…èµ·æ¥çš„ã€‚æˆ‘ä»¬è¦å»ºé€ ä¸€ä¸ªå·¥åŽ‚ï¼Œåˆ›å»ºè£…é¥°è¿‡çš„é¸­å­ã€‚æ­¤å·¥åŽ‚åº”è¯¥ç”Ÿäº§å„ç§ä¸åŒç±»åž‹çš„é¸­å­çš„äº§å“å®¶æ—ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç”¨<strong>æŠ½è±¡å·¥åŽ‚æ¨¡å¼</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDuckFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Quackable <span class="title">createMallardDuck</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Quackable <span class="title">createDuckCall</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Quackable <span class="title">createRubberDuck</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckFactory</span> <span class="keyword">extends</span> <span class="title">AbstractDuckFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quackable <span class="title">createMallardDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MallardDuck();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quackable <span class="title">createDuckCall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DuckCall();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quackable <span class="title">createRubberDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RubberDuck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingDuckFactory</span> <span class="keyword">extends</span> <span class="title">AbstractDuckFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quackable <span class="title">createMallardDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QuackCounter(<span class="keyword">new</span> MallardDuck());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quackable <span class="title">createDuckCall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QuackCounter(<span class="keyword">new</span> DuckCall());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Quackable <span class="title">createRubberDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QuackCounter(<span class="keyword">new</span> RubberDuck());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DuckSimulator simulator = <span class="keyword">new</span> DuckSimulator();</span><br><span class="line">        AbstractDuckFactory duckFactory = <span class="keyword">new</span> CountingDuckFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ä¼ å…¥ä¸åŒçš„å·¥åŽ‚ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸åŒçš„äº§å“å®¶æ—</span></span><br><span class="line">        simulator.simulate(duckFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(AbstractDuckFactory duckFactory)</span> </span>&#123;  <span class="comment">// éœ€è¦ä¸€ä¸ªå·¥åŽ‚ä½œä¸ºå‚æ•°</span></span><br><span class="line">        Quackable mallardDuck = duckFactory.createMallardDuck();</span><br><span class="line">        Quackable duckCall = duckFactory.createDuckCall();</span><br><span class="line">        Quackable rubberDuck = duckFactory.createRubberDuck();  <span class="comment">// ä½¿ç”¨å·¥åŽ‚ç”Ÿäº§é¸­å­</span></span><br><span class="line">        Quackable gooseDuck = <span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose());  <span class="comment">// é¹…å°±ç®—äº†</span></span><br><span class="line"></span><br><span class="line">        simulate(mallardDuck);</span><br><span class="line">        simulate(duckCall);</span><br><span class="line">        simulate(rubberDuck);</span><br><span class="line">        simulate(gooseDuck);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"The ducks quacked "</span> + QuackCounter.getQuacks()</span><br><span class="line">            + <span class="string">" times"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java DuckSimulator</span><br><span class="line">Quack</span><br><span class="line">Kwak</span><br><span class="line">Squeak</span><br><span class="line">Honk</span><br><span class="line">The ducks quacked 3 times</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»ç„¶ä¾èµ–å…·ä½“ç±»æ¥ç›´æŽ¥å®žä¾‹åŒ–é¹…ã€‚ä½ èƒ½å¤Ÿä¸ºé¹…å†™ä¸€ä¸ªæŠ½è±¡å·¥åŽ‚å—ï¼Ÿåˆ›å»ºâ€œå†…é¹…å¤–é¸­â€çš„å¯¹è±¡æ—¶ï¼Œä½ æ€Žä¹ˆå¤„ç†ï¼Ÿ</p><h1 id="åˆæ˜¯é¸­å­åˆæ˜¯é¹…">åˆæ˜¯é¸­å­åˆæ˜¯é¹…</h1><p>æˆ‘ä»¬éœ€è¦å°†é¸­å­è§†ä¸ºä¸€ä¸ªé›†åˆï¼Œç”šè‡³æ˜¯å­é›†åˆï¼ˆsubcollectionï¼‰ï¼Œå¦‚æžœæˆ‘ä»¬ä¸€æ¬¡å‘½ä»¤ï¼Œå°±èƒ½è®©æ•´ä¸ªé¸­å­å¬å‘½è¡Œäº‹ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚<strong>ç»„åˆæ¨¡å¼</strong>å…è®¸æˆ‘ä»¬åƒå¯¹å¾…å•ä¸ªå¯¹è±¡ä¸€æ ·å¯¹å¾…å¯¹è±¡é›†åˆã€‚</p><p>æˆ‘ä»¬å­©å·å·ç”¨äº†<strong>è¿­ä»£å™¨æ¨¡å¼</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Flock</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    ArrayList quackers = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Quackable quacker)</span> </span>&#123;</span><br><span class="line">        quackers.add(quacker);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator iterator = quackers.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Quackable quacker = (Quackable)iterator.next();</span><br><span class="line">            quacker.quack();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DuckSimulator simulator = <span class="keyword">new</span> DuckSimulator();</span><br><span class="line">        AbstractDuckFactory duckFactory = <span class="keyword">new</span> CountingDuckFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ä¼ å…¥ä¸åŒçš„å·¥åŽ‚ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸åŒçš„äº§å“å®¶æ—</span></span><br><span class="line">        simulator.simulate(duckFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(AbstractDuckFactory duckFactory)</span> </span>&#123;</span><br><span class="line">        Quackable mallardDuck = duckFactory.createMallardDuck();</span><br><span class="line">        Quackable duckCall = duckFactory.createDuckCall();</span><br><span class="line">        Quackable rubberDuck = duckFactory.createRubberDuck();  <span class="comment">// ä½¿ç”¨å·¥åŽ‚ç”Ÿäº§é¸­å­</span></span><br><span class="line">        Quackable gooseDuck = <span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose());  <span class="comment">// é¹…å°±ç®—äº†</span></span><br><span class="line"></span><br><span class="line">        Flock flockOfDucks = <span class="keyword">new</span> Flock();  <span class="comment">// ä¸»ç¾¤</span></span><br><span class="line">        flockOfDucks.add(mallardDuck);</span><br><span class="line">        flockOfDucks.add(duckCall);</span><br><span class="line">        flockOfDucks.add(rubberDuck);</span><br><span class="line"></span><br><span class="line">        Flock flockOfGooses = <span class="keyword">new</span> Flock();  <span class="comment">// å­ç¾¤ï¼šé¹…ç¾¤</span></span><br><span class="line">        flockOfGooses.add(<span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose()));</span><br><span class="line">        flockOfGooses.add(<span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose()));</span><br><span class="line"></span><br><span class="line">        flockOfDucks.add(flockOfGooses);  <span class="comment">// å°†é¹…ç¾¤åŠ å…¥é¸­ç¾¤</span></span><br><span class="line"></span><br><span class="line">        simulate(flockOfDucks);</span><br><span class="line">        System.out.println(<span class="string">"The ducks quacked "</span> + QuackCounter.getQuacks()</span><br><span class="line">            + <span class="string">" times"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java DuckSimulator</span><br><span class="line">Quack</span><br><span class="line">Kwak</span><br><span class="line">Squeak</span><br><span class="line">Honk</span><br><span class="line">Honk</span><br><span class="line">The ducks quacked 3 times</span><br></pre></td></tr></table></figure><p>å®‰å…¨æ€§ vs. é€æ˜Žæ€§</p><p>ä½ æˆ–è®¸è¿˜è®°å¾—ï¼Œåœ¨ç»„åˆæ¨¡å¼ç« èŠ‚ä¸­ï¼Œç»„åˆï¼ˆèœå•ï¼‰å’Œå¶èŠ‚ç‚¹ï¼ˆèœå•é¡¹ï¼‰å…·æœ‰ä¸€ç»„ç›¸åŒçš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬äº† <code>add()</code> æ–¹æ³•ã€‚è¿™ä¹ˆè®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œå¶èŠ‚ç‚¹å’Œç»„åˆä¹‹é—´æ˜¯â€œé€æ˜Žçš„â€ã€‚å®¢æˆ·æ ¹æœ¬ä¸ç”¨ç®¡ç©¶ç«Ÿæ˜¯ç»„åˆèŠ‚ç‚¹è¿˜æ˜¯å¶èŠ‚ç‚¹ï¼Œå®¢æˆ·åªæ˜¯è°ƒç”¨ä¸¤è€…çš„åŒä¸€ä¸ªæ–¹æ³•ã€‚</p><p>ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å†³å®šæŠŠç»„åˆç»´æŠ¤å­©å­çš„æ–¹æ³•å’Œå¶èŠ‚ç‚¹åˆ†å¼€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰“ç®—åªè®© Flock å…·æœ‰ <code>add()</code> æ–¹æ³•ã€‚è¿™æ ·çš„è®¾è®¡æ¯”è¾ƒâ€œå®‰å…¨â€ï¼Œä½ ä¸ä¼šè°ƒç”¨æ— æ„ä¹‰çš„æ–¹æ³•ï¼Œä½†æ˜¯é€æ˜Žæ€§æ¯”è¾ƒå·®ã€‚çŽ°åœ¨ï¼Œå®¢æˆ·å¦‚æžœæƒ³è°ƒç”¨ <code>add()</code>ï¼Œå¾—å…ˆç¡®å®šè¯¥ Quackable å¯¹è±¡æ˜¯ Flock æ‰è¡Œã€‚</p><p>åœ¨ OO è®¾è®¡çš„è¿‡ç¨‹ä¸­ï¼ŒæŠ˜è¡·ä¸€ç›´éƒ½æ˜¯é¿å…ä¸äº†çš„ï¼Œåœ¨åˆ›å»ºä½ è‡ªå·±çš„ç»„åˆæ—¶ï¼Œä½ éœ€è¦è€ƒè™‘è¿™äº›ã€‚</p><h1 id="è¿½è¸ªä¸ªåˆ«çš„é¸­å­">è¿½è¸ªä¸ªåˆ«çš„é¸­å­</h1><p>å‘±å‘±å«å­¦å®¶æƒ³è¦è§‚å¯Ÿä¸ªåˆ«é¸­å­çš„è¡Œä¸ºï¼Œæœ‰ä¸€ä¸ªæ¨¡å¼å¯ä»¥è§‚å¯Ÿå¯¹è±¡çš„è¡Œä¸ºï¼š<strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ã€‚</p><p>è¢«è§‚å¯Ÿè€…ï¼ˆä¸»é¢˜ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">QuackObservable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;  <span class="comment">// ä¸ºäº†ä¿æŒç®€å•ï¼Œçœç•¥äº†åˆ é™¤è§‚å¯Ÿè€…çš„æŽ¥å£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Observableè¾…åŠ©ç±»ï¼Œè¿™æ¬¡æˆ‘ä»¬é€šè¿‡ç»„åˆçš„æ–¹å¼ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Observable</span> <span class="keyword">implements</span> <span class="title">QuackObservable</span> </span>&#123;</span><br><span class="line">    ArrayList observers = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    QuackObservable duck;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Observable</span><span class="params">(QuackObservable duck)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.duck = duck;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator iterator = observers.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Observer observer = (Observer)iterator.next();</span><br><span class="line">            <span class="comment">// æŠŠé¸­å­å¯¹è±¡ä¼ è¿‡åŽ»ï¼Œå¥½è®©è§‚å¯Ÿè€…çŸ¥é“æ˜¯å“ªä¸ªé¸­å­åœ¨å‘±å‘±å«</span></span><br><span class="line">            observer.update(duck);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿè€…ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(QuackObservable duck)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…·ä½“çš„è§‚å¯Ÿè€…ï¼šå‘±å‘±å«å­¦å®¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Quackologist</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(QuackObservable duck)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Quackologist: "</span> + duck + <span class="string">" just quacked."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¡®ä¿æ‰€æœ‰çš„Quackableéƒ½å®žçŽ°æ­¤æŽ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹²è„†è®©Quackableæ¥æ‰©å±•æ­¤æŽ¥å£ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Quackable</span> <span class="keyword">extends</span> <span class="title">QuackObservable</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´åˆObservableè¾…åŠ©ç±»å’ŒQuackableç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MallardDuckçš„å®žçŽ°ï¼Œå…¶ä»–é¸­å­ï¼ˆåŒ…æ‹¬GooseAdapterï¼ŒQuackCounterï¼‰åŒç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallardDuck</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    Observable observable;  <span class="comment">// æŒæœ‰ä¸€ä¸ªä¸»é¢˜å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MallardDuck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å°†è‡ªèº«ä¼ å…¥ä¸»é¢˜</span></span><br><span class="line">        observable = <span class="keyword">new</span> Observable(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Quack"</span>);</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å§”æ‰˜ç»™è¾…åŠ©ç±»æ‰§è¡Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observable.registerObserver(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        observable.notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Mallard Duck"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuackCounter</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    Quackable duck;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> numberOfQuacks;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuackCounter</span> <span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.duck = duck;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">        numberOfQuacks++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getQuacks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numberOfQuacks;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å§”æ‰˜ç»™é¸­å­</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        duck.registerObserver(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        duck.notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Flock</span> <span class="keyword">implements</span> <span class="title">Quackable</span> </span>&#123;</span><br><span class="line">    ArrayList quackers = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Quackable quacker)</span> </span>&#123;</span><br><span class="line">        quackers.add(quacker);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator iterator = quackers.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Quackable quacker = (Quackable)iterator.next();</span><br><span class="line">            quacker.quack();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å§”æ‰˜ç»™æ¯ä¸€åªé¸­å­ï¼ˆæˆ–é¸­ç¾¤ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        Iterator iterator = quackers.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Quackable duck = (Quackable)iterator.next();</span><br><span class="line">            duck.registerObserver(observer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator iterator = quackers.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Quackable duck = (Quackable)iterator.next();</span><br><span class="line">            duck.notifyObservers();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckSimulator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DuckSimulator simulator = <span class="keyword">new</span> DuckSimulator();</span><br><span class="line">        AbstractDuckFactory duckFactory = <span class="keyword">new</span> CountingDuckFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ä¼ å…¥ä¸åŒçš„å·¥åŽ‚ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸åŒçš„äº§å“å®¶æ—</span></span><br><span class="line">        simulator.simulate(duckFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(AbstractDuckFactory duckFactory)</span> </span>&#123;</span><br><span class="line">        Quackable mallardDuck = duckFactory.createMallardDuck();</span><br><span class="line">        Quackable duckCall = duckFactory.createDuckCall();</span><br><span class="line">        Quackable rubberDuck = duckFactory.createRubberDuck();  <span class="comment">// ä½¿ç”¨å·¥åŽ‚ç”Ÿäº§é¸­å­</span></span><br><span class="line">        Quackable gooseDuck = <span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose());  <span class="comment">// é¹…å°±ç®—äº†</span></span><br><span class="line"></span><br><span class="line">        Flock flockOfDucks = <span class="keyword">new</span> Flock();  <span class="comment">// ä¸»ç¾¤</span></span><br><span class="line">        flockOfDucks.add(mallardDuck);</span><br><span class="line">        flockOfDucks.add(duckCall);</span><br><span class="line">        flockOfDucks.add(rubberDuck);</span><br><span class="line"></span><br><span class="line">        Flock flockOfGooses = <span class="keyword">new</span> Flock();  <span class="comment">// å­ç¾¤ï¼šé¹…ç¾¤</span></span><br><span class="line">        flockOfGooses.add(<span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose()));</span><br><span class="line">        flockOfGooses.add(<span class="keyword">new</span> GooseAdapter(<span class="keyword">new</span> Goose()));</span><br><span class="line"></span><br><span class="line">        flockOfDucks.add(flockOfGooses);  <span class="comment">// å°†é¹…ç¾¤åŠ å…¥é¸­ç¾¤</span></span><br><span class="line"></span><br><span class="line">        Quackologist quackologist = <span class="keyword">new</span> Quackologist();  <span class="comment">// åˆ›å»ºè§‚å¯Ÿè€…</span></span><br><span class="line">        flockOfDucks.registerObserver(quackologist);  <span class="comment">// è§‚å¯Ÿè¿™ä¸ªæ—ç¾¤</span></span><br><span class="line"></span><br><span class="line">        simulate(flockOfDucks);</span><br><span class="line">        System.out.println(<span class="string">"The ducks quacked "</span> + QuackCounter.getQuacks()</span><br><span class="line">            + <span class="string">" times"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">simulate</span><span class="params">(Quackable duck)</span> </span>&#123;</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java DuckSimulator</span><br><span class="line">Quack</span><br><span class="line">Quackologist: Mallard Duck just quacked.</span><br><span class="line">Kwak</span><br><span class="line">Quackologist: Duck Call just quacked.</span><br><span class="line">Squeak</span><br><span class="line">Quackologist: Rubber Duck just quacked.</span><br><span class="line">Honk</span><br><span class="line">Quackologist: Goose pretending to be a Duck just quacked.</span><br><span class="line">Honk</span><br><span class="line">Quackologist: Goose pretending to be a Duck just quacked.</span><br><span class="line">The ducks quacked 3 times</span><br></pre></td></tr></table></figure><h1 id="é—®ç­”">é—®ç­”</h1><ul><li><p><strong>é—®</strong>ï¼šè¿™å°±æ˜¯å¤åˆæ¨¡å¼ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸ï¼Œè¿™åªæ˜¯ä¸€ç¾¤æ¨¡å¼æºæ‰‹åˆä½œã€‚æ‰€è°“çš„å¤åˆæ¨¡å¼ï¼Œæ˜¯æŒ‡ä¸€ç¾¤æ¨¡å¼è¢«ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä»¥è§£å†³<strong>ä¸€èˆ¬æ€§é—®é¢˜</strong>ã€‚å¤åˆæ¨¡å¼æ˜¯ç”±æ•°ä¸ªæ¨¡å¼ç»“åˆèµ·æ¥è€Œå½¢æˆçš„æ¨¡å¼ï¼Œ<strong>ä¸€å†åœ°è¢«ç”¨äºŽè§£å†³è®¸å¤šè®¾è®¡é—®é¢˜</strong>ã€‚ä¾‹å¦‚ï¼Œå¤§åé¼Žé¼Žçš„ Model-View-Controllorï¼ˆæ¨¡åž‹-è§†å›¾-æŽ§åˆ¶å™¨ï¼‰æ¨¡å¼ã€‚</p></li><li><p><strong>é—®</strong>ï¼šæ‰€ä»¥ï¼Œè®¾è®¡æ¨¡å¼çœŸæ­£æ¼‚äº®çš„åœ°æ–¹åœ¨äºŽï¼Œé‡åˆ°é—®é¢˜æ—¶ï¼Œæˆ‘å¯ä»¥æ‹¿æ¨¡å¼é€ä¸€åœ°è§£å†³é—®é¢˜ï¼Œç›´åˆ°æ‰€æœ‰çš„é—®é¢˜éƒ½è¢«è§£å†³ã€‚æˆ‘è¿™æ ·è¯´å¯¹å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šé”™ï¼æœ‰æ—¶å€™ï¼Œç”¨å¥½ OO è®¾è®¡åŽŸåˆ™å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œè¿™å…¶å®žå°±å¤Ÿäº†ã€‚é‡‡ç”¨æ¨¡å¼æ—¶å¿…é¡»è¦è€ƒè™‘åˆ°è¿™ä¹ˆåšæ˜¯å¦æœ‰æ„ä¹‰ã€‚ç»å¯¹ä¸èƒ½ä¸ºäº†ä½¿ç”¨æ¨¡å¼è€Œä½¿ç”¨æ¨¡å¼ã€‚æœ‰äº†è¿™æ ·çš„è§‚å¿µï¼Œé¸­å­æ¨¡æ‹Ÿå™¨çš„è®¾è®¡çœ‹èµ·æ¥å°±æ˜¾å¾—åšä½œã€‚</p></li></ul><h1 id="æ¨¡åž‹-è§†å›¾-æŽ§åˆ¶å™¨">æ¨¡åž‹-è§†å›¾-æŽ§åˆ¶å™¨</h1><img src="http://www.plantuml.com/plantuml/svg/NLB9Ki904Btp5LFSiShjmi4luM8f1wimM89wdI1OGI0HLnOL4IEvA9HBW4JYnvZk6Kx-WfCCudB98VssVjEPx6esIQAyUm1DBqfMCsHt8xaN9-pKmYiJgXhJ-sYruRhqGNCIDQ4D60vPyoMXe6xwhYxd_l01Z7FmBk1nVt99-RsADO_TEGc5DVBiq4Qg-aCTp_fOUHHQaOnqHhqBcWrrApHVIolPxNGgbToE4waM1D46Ge9x9r0mOMJpReVtt8G21Hjw8sakvfWta5xzLWudeUncUZsPYXFv1yigNXQnICKtu4qJgJAZq3qkCwi4ZZ6XBlUgGd7AUse7l6TBE0cKrfTr2FXiXy-tCg-FMTuM7Q1nb51yh-ax1tXIOSvh0EnGzd8hZG9htGIZ8qX2RcI3KPryfy3J4HWrqJHhcSojysuEUYrE2y5wmGEHsCvMRELFNVDpH7O5QWDRHxvh-qufyeCWCK6O5h4mHwI3TFkFaYUm-0sIxnW9kMGsNX9ZhGg39-OQ4YSsdOQR6Is787aE_lZcvnBUswZslW00"><p><strong>é—®</strong>ï¼šæŽ§åˆ¶å™¨å¯ä»¥å˜æˆæ¨¡åž‹çš„è§‚å¯Ÿè€…å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå½“ç„¶ã€‚åœ¨æŸäº›è®¾è®¡ä¸­ï¼ŒæŽ§åˆ¶å™¨ä¼šå‘æ¨¡åž‹æ³¨å†Œï¼Œæ¨¡åž‹ä¸€æœ‰æ”¹å˜å°±é€šçŸ¥æŽ§åˆ¶å™¨ã€‚å½“æ¨¡åž‹ç›´æŽ¥å½±å“åˆ°ç”¨æˆ·ç•Œé¢æ—¶ï¼Œå°±ä¼šè¿™ä¹ˆåšã€‚æ¯”æ–¹è¯´ï¼Œæ¨¡åž‹å†…çš„æŸäº›çŠ¶æ€å¯ä»¥æ”¯é…ç•Œé¢çš„æŸäº›é¡¹ç›®å˜æˆæœ‰æ•ˆæˆ–è€…æ— æ•ˆï¼Œå¦‚æžœè¿™æ ·ï¼Œè¦æ±‚è§†å›¾æ›´æ–°ç›¸åº”æ˜¾ç¤ºå…¶å®žå°±æ˜¯æŽ§åˆ¶å™¨çš„äº‹ã€‚</p><h1 id="mvc-ä¸­çš„æ¨¡å¼">MVC ä¸­çš„æ¨¡å¼</h1><p>æ¨¡åž‹å®žçŽ°äº†<strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼Œå½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œç›¸å…³å¯¹è±¡å°†æŒç»­æ›´æ–°ã€‚ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥è®©æ¨¡åž‹å®Œå…¨ç‹¬ç«‹äºŽè§†å›¾å’ŒæŽ§åˆ¶å™¨ï¼ŒåŒä¸€ä¸ªæ¨¡åž‹å¯ä»¥ä½¿ç”¨ä¸åŒçš„è§†å›¾ï¼Œç”šè‡³å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªè§†å›¾ã€‚</p><p>è§†å›¾å†…éƒ¨ä½¿ç”¨<strong>ç»„åˆæ¨¡å¼</strong>æ¥ç®¡ç†çª—å£ã€æŒ‰é’®ä»¥åŠå…¶ä»–æ˜¾ç¤ºç»„ä»¶ã€‚æ¯ä¸ªæ˜¾ç¤ºç»„ä»¶å¦‚æžœä¸æ˜¯ç»„åˆèŠ‚ç‚¹ï¼Œå°±æ˜¯å¶èŠ‚ç‚¹ã€‚å½“æŽ§åˆ¶å™¨å‘Šè¯‰è§†å›¾æ›´æ–°æ—¶ï¼Œåªéœ€å‘Šè¯‰è§†å›¾æœ€é¡¶å±‚çš„ç»„ä»¶å³å¯ï¼Œç»„åˆä¼šå¤„ç†å…¶ä½™çš„äº‹ã€‚</p><p>è§†å›¾å’ŒæŽ§åˆ¶å™¨å®žçŽ°äº†ç»å…¸çš„<strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šè§†å›¾æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è¢«è°ƒæ•´ä½¿ç”¨ä¸åŒçš„ç­–ç•¥ï¼ˆæ¢ä¸€ä¸ªæŽ§åˆ¶å™¨ï¼‰ï¼Œè€ŒæŽ§åˆ¶å™¨æä¾›äº†ç­–ç•¥ã€‚è§†å›¾åªå…³å¿ƒç³»ç»Ÿä¸­å¯è§†çš„éƒ¨åˆ†ï¼Œå¯¹äºŽä»»ä½•ç•Œé¢è¡Œä¸ºï¼Œéƒ½å§”æ‰˜ç»™æŽ§åˆ¶å™¨å¤„ç†ã€‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼ä¹Ÿå¯ä»¥è®©è§†å›¾å’Œæ¨¡åž‹ä¹‹é—´çš„å…³ç³»è§£è€¦ï¼Œå› ä¸ºæŽ§åˆ¶å™¨è´Ÿè´£å’Œæ¨¡åž‹äº¤äº’æ¥ä¼ é€’ç”¨æˆ·çš„è¯·æ±‚ã€‚å¯¹äºŽå·¥ä½œæ˜¯æ€Žä¹ˆå®Œæˆçš„ï¼Œè§†å›¾æ¯«ä¸çŸ¥æƒ…ã€‚</p><p>è¿™äº›æ¨¡å¼æºæ‰‹åˆä½œï¼ŒæŠŠ MVC æ¨¡åž‹çš„ä¸‰å±‚è§£è€¦ï¼Œè¿™æ ·å¯ä»¥ä¿æŒè®¾è®¡å¹²å‡€åˆæœ‰å¼¹æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Recover Binary Search Tree</title>
      <link href="/programming/leetcode/recover-binary-search-tree/"/>
      <url>/programming/leetcode/recover-binary-search-tree/</url>
      
        <content type="html"><![CDATA[<p>Two elements of a binary search tree (BST) are swapped by mistake.</p><p>Recover the tree without changing its structure.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">   1</span><br><span class="line">  /</span><br><span class="line"> 3</span><br><span class="line">  \</span><br><span class="line">   2</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">   3</span><br><span class="line">  /</span><br><span class="line"> 1</span><br><span class="line">  \</span><br><span class="line">   2</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">1   4</span><br><span class="line">   /</span><br><span class="line">  2</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">  2</span><br><span class="line"> / \</span><br><span class="line">1   4</span><br><span class="line">   /</span><br><span class="line">  3</span><br></pre></td></tr></table></figure><p>Follow up:</p><ul><li>A solution using <code>O(n)</code> space is pretty straight forward.</li><li>Could you devise a constant space solution?</li></ul><h1 id="using-inorder-traversal">Using inorder traversal</h1><p>It would be very easy if you think about this problem:</p><p>Two elements in a sorted array are swapped by mistake, design an algorithm to fix it.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1, 2, 23, 8, 9, 11, 5, 25</span><br><span class="line">      ^             ^</span><br><span class="line">23 &gt; 8: this is the first wrong location</span><br><span class="line">11 &gt; 5: this is the second wrong location</span><br></pre></td></tr></table></figure><p>We can fit the sorted array by swap 23 (the first element on the first wrong location) and 5 (the second element on the second wrong location).</p><p>And there is a special case, only one wrong location exists. In this case, sorted array can be fixed by swap that two elements.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1, 2, 5, 9, 8, 11, 23, 25</span><br><span class="line">         ^  ^</span><br><span class="line">9 &gt; 8</span><br></pre></td></tr></table></figure><a id="more"></a><p>Now, BST can be fixed by similar procedure as long as you know <strong>the inorder traversal</strong> of a BST gives a sorted list.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recoverTree</span><span class="params">(self, root: TreeNode)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify root in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.first = self.second = self.prev = <span class="literal">None</span></span><br><span class="line">        self.inOrder(root)</span><br><span class="line">        <span class="keyword">if</span> self.first <span class="keyword">and</span> self.second:</span><br><span class="line">            self.first.val, self.second.val = self.second.val, self.first.val</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inOrder</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.inOrder(node.left)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.prev:</span><br><span class="line">            <span class="keyword">if</span> node.val &lt;= self.prev.val:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> self.first:</span><br><span class="line">                    self.first = self.prev</span><br><span class="line">                self.second = node</span><br><span class="line"></span><br><span class="line">        self.prev = node  <span class="comment"># record node after visit</span></span><br><span class="line">        self.inOrder(node.right)</span><br></pre></td></tr></table></figure><h1 id="using-morris-traversal">Using morris traversal</h1><p>Of course you can use stack instead of recursion, which make algorithm a little bit faster. But also takes <code>O(n)</code> time complexity. A constant space solution can be realized by using Morris Traversal. See section &quot;Smarter morris traversal&quot; in <a href="/programming/leetcode/binary-tree-traversal/" title="Binary Tree Traversal">Binary Tree Traversal</a> for more details.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recoverTree</span><span class="params">(self, root: TreeNode)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify root in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        first = second = prev = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># morris traversal</span></span><br><span class="line">        curr = root</span><br><span class="line">        <span class="keyword">while</span> curr:</span><br><span class="line">            <span class="keyword">if</span> curr.left:</span><br><span class="line">                p = curr.left</span><br><span class="line">                <span class="keyword">while</span> p.right <span class="keyword">and</span> p.right != curr:</span><br><span class="line">                    p = p.right</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> p.right:</span><br><span class="line">                    p.right = curr</span><br><span class="line">                    curr = curr.left</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    p.right = <span class="literal">None</span></span><br><span class="line">            <span class="comment"># compare value when visit a node</span></span><br><span class="line">            <span class="keyword">if</span> prev <span class="keyword">and</span> curr.val &lt;= prev.val:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> first:</span><br><span class="line">                    first = prev</span><br><span class="line">                second = curr</span><br><span class="line">            <span class="comment"># visit next</span></span><br><span class="line">            prev = curr</span><br><span class="line">            curr = curr.right</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fix BST</span></span><br><span class="line">        <span class="keyword">if</span> first <span class="keyword">and</span> second:</span><br><span class="line">            first.val, second.val = second.val, first.val</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> tree </tag>
            
            <tag> traversal </tag>
            
            <tag> morris </tag>
            
            <tag> inorder </tag>
            
            <tag> BST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿æŠ¤ä»£ç†</title>
      <link href="/notes/head-first-design-patterns/protection-proxy/"/>
      <url>/notes/head-first-design-patterns/protection-proxy/</url>
      
        <content type="html"><![CDATA[<h1 id="java-åŠ¨æ€ä»£ç†">Java åŠ¨æ€ä»£ç†</h1><p>Java åœ¨ <code>java.lang.reflect</code> åŒ…ä¸­æœ‰è‡ªå·±çš„ä»£ç†æ”¯æŒï¼Œåˆ©ç”¨è¿™ä¸ªåŒ…ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œå®žçŽ°ä¸€ä¸ªæˆ–å¤šä¸ªæŽ¥å£ï¼Œå¹¶å°†æ–¹æ³•çš„è°ƒç”¨è½¬å‘åˆ°ä½ æ‰€æŒ‡å®šçš„ç±»ã€‚å› ä¸ºå®žé™…ä»£ç†ç±»æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ª Java æŠ€æœ¯ä¸ºï¼šåŠ¨æ€ä»£ç†ã€‚</p><p>å°±å’ŒçœŸå®žä¸–ç•Œä¸­å¤§å¤šæ•°çš„äº‹ç‰©ä¸€æ ·ï¼Œå®ƒå’Œä»£ç†æ¨¡å¼çš„ä¼ ç»Ÿå®šä¹‰æœ‰ä¸€ç‚¹å‡ºå…¥ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VP4zJy906CVtVeeBamwG22lfB4v6Ht4uoXcgxO7jGIH8GaGO3066OWmQ9GAHI4I83fKNlupN5YU_WgKKhE5bVPxV_L-UY_1X190O8qaW8Z6492OocN2yn0c8uJ51qX7a4DYFXuuHHu3VFv-nB4Wn0AHWI2OIv4WQIEWqZcIoiSca7Ky3E17b8E6ZU1lYi82azIAyYPyWIuCJe2o3FGI5cVs4TRfCYLqfUfPSiLjm3uWnmM8THlDsvnxFLEt_o161ML9dWYprOQR9tEoAjREQ-y2yV1ZXGzPEWAC40HSTr8rotYXsjRkMLiXfvJPL6rHzDdg3hyo52q0Pu2sRjTxfDw-6qjk12KZxJuRoO5GlVuQ581vd2bHLjCwzgKNxUQrJq2llvZA8xGHwiQcLwdDHxop0gAQNolJpTg629MjvKlNALAA30HrLzEiF_QqoxcODfHN4tzaH7LR7Zsqwh6cvflxIS0RtsGSoxsUMMFvLqzqVvrt3-Nu1"><p>å› ä¸º Java å·²ç»ä¸ºä½ åˆ›å»ºäº† Proxy ç±»ï¼Œæ‰€ä»¥ä½ éœ€è¦æœ‰åŠžæ³•æ¥å‘Šè¯‰ Proxy ç±»ä½ è¦åšä»€ä¹ˆã€‚ä½ ä¸èƒ½åƒä»¥å‰ä¸€æ ·æŠŠä»£ç æ”¾åœ¨ Proxy ç±»ä¸­ï¼Œå› ä¸º Proxy ä¸æ˜¯ä½ ç›´æŽ¥å®žçŽ°çš„ã€‚è¦æŠŠä»£ç æ”¾åœ¨ InvocationHandler ä¸­ã€‚InvocationHandler çš„å·¥ä½œæ˜¯ç›¸åº”ä»£ç†çš„ä»»ä½•è°ƒç”¨ã€‚ä½ å¯ä»¥æŠŠ InvocationHandler æƒ³æˆæ˜¯ä»£ç†æ”¶åˆ°æ–¹æ³•è°ƒç”¨åŽï¼Œè¯·æ±‚åšå®žé™…å·¥ä½œçš„å¯¹è±¡ã€‚</p><a id="more"></a><h1 id="å¯¼å…¥å¯¹è±¡æ‘çš„é…å¯¹">å¯¼å…¥ï¼šå¯¹è±¡æ‘çš„é…å¯¹</h1><p>ä½ è´Ÿè´£å¸®å¯¹è±¡æ‘å®žçŽ°çº¦ä¼šæœåŠ¡ç³»ç»Ÿã€‚ä½ çš„æœåŠ¡ç³»ç»Ÿæ¶‰åŠåˆ°ä¸€ä¸ª Person beanï¼Œå…è®¸è®¾ç½®æˆ–å–å¾—ä¸€ä¸ªäººçš„ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonBean</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getGender</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getInterests</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getHotOrNotRating</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setInterests</span><span class="params">(String interests)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setHotOrNotRating</span><span class="params">(<span class="keyword">int</span> rating)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonBeanImpl</span> <span class="keyword">implements</span> <span class="title">PersonBean</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–å˜é‡</span></span><br><span class="line">    <span class="keyword">int</span> rating;</span><br><span class="line">    <span class="keyword">int</span> ratingCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHotOrNotRating</span><span class="params">()</span> </span>&#123;  <span class="comment">// è®¡ç®—å¹³å‡å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (ratingCount == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> (rating/ratingCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHotOrNotRating</span><span class="params">(<span class="keyword">int</span> rating)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rating += rating;</span><br><span class="line">        ratingCount++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„çº¦ä¼šæœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›é¡¾å®¢å¯ä»¥è®¾ç½®è‡ªå·±çš„ä¿¡æ¯ï¼ŒåŒæ—¶åˆé˜²æ­¢ä»–äººæ›´æ”¹è¿™äº›ä¿¡æ¯ã€‚HotOrNot è¯„åˆ†åˆ™ç›¸åï¼Œä½ ä¸èƒ½æ›´æ”¹è‡ªå·±çš„è¯„åˆ†ï¼Œä½†æ˜¯ä»–äººå¯ä»¥è®¾ç½®ä½ çš„è¯„åˆ†ã€‚æˆ‘ä»¬åœ¨ PersonBean ä¸­å·²ç»æœ‰è®¸å¤š getter æ–¹æ³•äº†ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•é¡¾å®¢éƒ½å¯ä»¥è°ƒç”¨å®ƒä»¬ã€‚</p><h1 id="ä¸º-personbean-åˆ›å»ºåŠ¨æ€ä»£ç†">ä¸º PersonBean åˆ›å»ºåŠ¨æ€ä»£ç†</h1><p>æˆ‘ä»¬æœ‰ä¸€äº›é—®é¢˜è¦ä¿®æ­£ï¼šé¡¾å®¢ä¸å¯ä»¥æ”¹å˜è‡ªå·±çš„ HotOrNot è¯„åˆ†ï¼Œä¹Ÿä¸å¯ä»¥æ”¹å˜å…¶ä»–é¡¾å®¢çš„ä¸ªäººä¿¡æ¯ã€‚è¦ä¿®æ­£è¿™äº›é—®é¢˜ï¼Œä½ å¿…é¡»åˆ›å»ºä¸¤ä¸ªä»£ç†ï¼šä¸€ä¸ªè®¿é—®ä½ è‡ªå·±çš„ PersonBean å¯¹è±¡ï¼Œå¦ä¸€ä¸ªè®¿é—®å¦ä¸€é¡¾å®¢çš„ PersonBean å¯¹è±¡ã€‚è¿™æ ·ï¼Œä»£ç†å°±å¯ä»¥æŽ§åˆ¶åœ¨æ¯ä¸€ç§æƒ…å†µä¸‹å…è®¸å“ªä¸€ç§è¯·æ±‚ã€‚</p><h2 id="åˆ›å»º-invocationhandler">åˆ›å»º InvocationHandler</h2><p>æˆ‘ä»¬éœ€è¦å†™ä¸¤ä¸ª InvocationHandlerï¼ˆè°ƒç”¨å¤„ç†å™¨ï¼‰ï¼Œå…¶ä¸­ä¸€ä¸ªç»™æ‹¥æœ‰è€…ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç»™éžæ‹¥æœ‰è€…ä½¿ç”¨ã€‚å½“ä»£ç†çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä»£ç†å°±ä¼šæŠŠè¿™ä¸ªè°ƒç”¨è½¬å‘ç»™ InvocationHandlerã€‚InvocationHandler æŽ¥å£åªæœ‰ä¸€ä¸ªåä¸º <code>invoke()</code> çš„æ–¹æ³•ï¼Œä¸ç®¡ä»£ç†åˆ«è°ƒç”¨çš„æ˜¯ä½•ç§æ–¹æ³•ï¼Œå¤„ç†å™¨è¢«è°ƒç”¨çš„ä¸€å®šæ˜¯ <code>invoke()</code> æ–¹æ³•ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><ol type="1"><li>å‡è®¾ proxy çš„ <code>setHotOrNotRating()</code> æ–¹æ³•è¢«è°ƒç”¨ã€‚</li><li>proxy ä¼šæŽ¥ç€è°ƒç”¨ InvocationHandler çš„ <code>invoke()</code> æ–¹æ³•ã€‚</li><li>handler å†³å®šè¦å¦‚ä½•å¤„ç½®è¿™ä¸ªè¯·æ±‚ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">proxy.setHotOrNotRating(9);</span><br><span class="line"></span><br><span class="line">// proxy å¯¹è±¡è¢«ä¼ å…¥ proxy</span><br><span class="line">// setHotOrNotRating æ–¹æ³•å¯¹è±¡è¢«ä¼ å…¥ method</span><br><span class="line">// å‚æ•° 9 è¢«ä¼ å…¥ args</span><br><span class="line"></span><br><span class="line">invoke(Object proxy, Method method, Object[] args) &#123;</span><br><span class="line">  return method.invoke(person, args);   // åœ¨personå¯¹è±¡ä¸Šè°ƒç”¨methodä»£è¡¨çš„æ–¹æ³•ï¼Œå‚æ•°ä¸ºargs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>OwnerInvocationHandler.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OwnerInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    PersonBean person;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OwnerInvocationHandler</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.person = person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String name = method.getName();</span><br><span class="line">            <span class="keyword">if</span> (name.equals(<span class="string">"setHotOrNotRating"</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name.startsWith(<span class="string">"set"</span>) || name.startsWith(<span class="string">"get"</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> method.invoke(person, args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  <span class="comment">// å¦‚æžœè°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œä¸€å¾‹ä¸ç†ï¼Œè¿”å›žnull</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-proxy-ç±»å¹¶å®žä¾‹åŒ–-proxy-å¯¹è±¡">åˆ›å»º Proxy ç±»å¹¶å®žä¾‹åŒ– Proxy å¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">PersonBean <span class="title">getOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (PersonBean) Proxy.newProxyInstance(  <span class="comment">// åˆ©ç”¨Proxyçš„é™æ€æ–¹æ³•åˆ›å»ºä»£ç†</span></span><br><span class="line">      person.getClass().getClassLoader(),  <span class="comment">// å°†PersonBeançš„ç±»è½½å…¥å™¨å½“ä½œå‚æ•°...</span></span><br><span class="line">      person.getClass().getInterfaces(),   <span class="comment">// ä»£ç†éœ€è¦å®žçŽ°çš„æŽ¥å£...</span></span><br><span class="line">      <span class="keyword">new</span> OwnerInvocationHandler(person)   <span class="comment">// è‡ªå®šä¹‰çš„è°ƒç”¨å¤„ç†å™¨</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">PersonBean <span class="title">getNonOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (PersonBean) Proxy.newProxyInstance(</span><br><span class="line">        person.getClass().getClassLoader(),</span><br><span class="line">        person.getClass().getInterfaces(),</span><br><span class="line">        <span class="keyword">new</span> NonOwnerInvocationHandler(person)  <span class="comment">// ç»†å¾®åŒºåˆ«åœ¨äºŽhandler</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•é…å¯¹æœåŠ¡">æµ‹è¯•é…å¯¹æœåŠ¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchMakingTestDrive</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> MatchMakingTestDrive().drive();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PersonBean joe = <span class="keyword">new</span> PersonBeanImpl();</span><br><span class="line">        joe.setName(<span class="string">"joe"</span>);</span><br><span class="line">        PersonBean jane = <span class="keyword">new</span> PersonBeanImpl();</span><br><span class="line">        jane.setName(<span class="string">"jane"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå·±æ˜¯joe</span></span><br><span class="line">        PersonBean ownerProxy = getOwnerProxy(joe);</span><br><span class="line">        PersonBean nonOwnerProxy = getNonOwnerProxy(jane);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ‹è¯•getterï¼Œä¸æ‰“å°å†…å®¹</span></span><br><span class="line">        ownerProxy.getName();</span><br><span class="line">        ownerProxy.getHotOrNotRating();</span><br><span class="line">        nonOwnerProxy.getName();</span><br><span class="line">        nonOwnerProxy.getHotOrNotRating();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ‹è¯•ownerProxy</span></span><br><span class="line">        ownerProxy.setName(<span class="string">"Joe"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ownerProxy.setHotOrNotRating(<span class="number">9</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Can't set rating from owner proxy"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æµ‹è¯•nonOwnerProxy</span></span><br><span class="line">        nonOwnerProxy.setHotOrNotRating(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            nonOwnerProxy.setName(<span class="string">"Demon"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Can't set name from non owner proxy"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">PersonBean <span class="title">getOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// çœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">PersonBean <span class="title">getNonOwnerProxy</span><span class="params">(PersonBean person)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// çœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java MatchMakingTestDrive</span><br><span class="line">Can&apos;t set rating from owner proxy</span><br><span class="line">Can&apos;t set name from non owner proxy</span><br></pre></td></tr></table></figure><h1 id="ç±»å›¾çº¦ä¼šç³»ç»Ÿè®¾è®¡">ç±»å›¾ï¼šçº¦ä¼šç³»ç»Ÿè®¾è®¡</h1><img src="http://www.plantuml.com/plantuml/svg/bL9DJy904BttLynH3vIx8JruaWjo5mzBEz16kakswmU19eI8uS21HC54kH0k64sCCI61XlXZR4lz5u8OBC4Y7kVDUs_UpAvkQ0Xe5aK9J3Ipo2LzZgW6Lmie6LGWpn4L8OtSOdGV2OL4OWah2fGbW3B9Me8JLTYGHv4Y9kxihi9M63PHw4op8Hu7hpvqdOxV6VclRSaEpKlICwOIOJ1wGAXMGBvvh36ZdypjRKaj4Ck2mtEAVDraBWkjiYPBCVflPVWq5Lc6D6SNfNLqMIVDOa7wPR-AV5gK8u97yoCJIryvG9OL-9EmmMGbDYHYCTYUkRLjx6ZswpIanyhtzQBV8KIDyAPC870ZhmjWkONV7dZTGV3M2dfD_tReDUuzP-mw_Mdhoky-1UF7zsejGxt6m_Hcy56jUPFhwTtbekyrwq6_dg6kuxYJzazixtaKlFHckay0"><h1 id="é—®ç­”">é—®ç­”</h1><ul><li><p><strong>é—®</strong>ï¼šåˆ°åº•â€œåŠ¨æ€ä»£ç†â€åŠ¨æ€åœ¨å“ªé‡Œï¼Ÿæ˜¯ä¸æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶æ‰å°†å®ƒå®žä¾‹åŒ–å¹¶å’Œ handler è”ç³»èµ·æ¥ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸æ˜¯çš„ã€‚åŠ¨æ€ä»£ç†ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºåŠ¨æ€ï¼Œæ˜¯å› ä¸ºè¿è¡Œæ—¶æ‰å°†å®ƒçš„ç±»<strong>åˆ›å»º</strong>å‡ºæ¥ã€‚ä»£ç å¼€å§‹æ‰§è¡Œæ—¶ï¼Œè¿˜æ²¡æœ‰ Proxy ç±»ï¼Œå®ƒæ˜¯æ ¹æ®éœ€è¦ä»Žä½ ä¼ å…¥çš„æŽ¥å£é›†åˆ›å»ºçš„ã€‚</p></li><li><p><strong>é—®</strong>ï¼šæœ‰æ²¡æœ‰åŠžæ³•çŸ¥é“æŸä¸ªç±»æ˜¯ä¸æ˜¯ä»£ç†ç±»å‘¢ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå¯ä»¥ã€‚ä»£ç†ç±»æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå«åš <code>isProxyClass()</code>ã€‚æ­¤æ–¹æ³•çš„è¿”å›žå€¼å¦‚æžœä¸º trueï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»ã€‚</p></li><li><p><strong>é—®</strong>ï¼šå¯¹äºŽæˆ‘èƒ½ä¼ å…¥ <code>newProxyInstance()</code> çš„æŽ¥å£ç±»åž‹ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæ˜¯æœ‰ä¸€äº›é™åˆ¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼ ç»™ <code>newProxyInstance()</code> ä¸€ä¸ªæŽ¥å£æ•°ç»„ï¼Œæ­¤æ•°ç»„å†…åªèƒ½æœ‰æŽ¥å£ï¼Œä¸èƒ½æœ‰ç±»ã€‚å¦‚æžœæŽ¥å£ä¸æ˜¯ publicï¼Œå°±å¿…é¡»å±žäºŽåŒä¸€ä¸ª packageï¼Œä¸åŒçš„æŽ¥å£å†…ä¸å¯ä»¥æœ‰åç§°å’Œå‚æ•°å®Œå…¨ä¸€æ ·çš„æ–¹æ³•ã€‚è¿˜æœ‰ä¸€äº›æ¯”è¾ƒç»†å¾®çš„é™åˆ¶ï¼Œä½ åº”è¯¥å¥½å¥½ç ”è¯»ä¸€ä¸‹ javadoc çš„æ–‡ä»¶ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
            <tag> dynamic proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è™šæ‹Ÿä»£ç†</title>
      <link href="/notes/head-first-design-patterns/virtual-proxy/"/>
      <url>/notes/head-first-design-patterns/virtual-proxy/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥æ˜¾ç¤º-cd-å°é¢">å¯¼å…¥ï¼šæ˜¾ç¤º CD å°é¢</h1><p>æˆ‘ä»¬æ‰“ç®—å»ºç«‹ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨æ¥æˆ˜ç¾¡ä½ æœ€å–œæ¬¢çš„ CD å°é¢ã€‚å¦‚æžœä½ ä½¿ç”¨ Swingï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Icon æŽ¥å£ä»Žç½‘ç»œä¸ŠåŠ è½½å›¾åƒã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯ï¼Œ<strong>é™äºŽè¿žæŽ¥å¸¦å®½å’Œç½‘ç»œè´Ÿè½½ï¼Œä¸‹è½½å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œæ‰€ä»¥åœ¨ç­‰å¾…å›¾åƒåŠ è½½çš„æ—¶å€™ï¼Œåº”è¯¥æ˜¾ç¤ºä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›åœ¨ç­‰å¾…å›¾åƒæ—¶çœŸä¸ªåº”ç”¨ç¨‹åºè¢«æŒ‚èµ·</strong>ã€‚ä¸€æ—¦å›¾åƒè¢«åŠ è½½å®Œæˆï¼Œåˆšæ‰æ˜¾ç¤ºçš„ä¸œè¥¿åº”è¯¥æ¶ˆå¤±ï¼Œå›¾åƒæ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>æƒ³åšåˆ°è¿™æ ·ï¼Œç®€å•çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨è™šæ‹Ÿä»£ç†ã€‚è™šæ‹Ÿä»£ç†å¯ä»¥ä»£ç† Iconï¼Œç®¡ç†èƒŒæ™¯çš„åŠ è½½ï¼Œå¹¶åœ¨åŠ è½½æœªå®Œæˆæ—¶æ˜¾ç¤ºâ€œCD å°é¢åŠ è½½ä¸­ï¼Œè¯·ç¨å€™â€¦â€¦â€ï¼Œä¸€æ—¦åŠ è½½å®Œæˆï¼Œä»£ç†å°±æŠŠæ˜¾ç¤ºçš„èŒè´£å§”æ‰˜ç»™ Iconã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaScNcbQGMfIKcfofu9kVdATZOm0Nix1IgkHGKgXEJYakA4fDBQXNIKqj0Yi8pKqeoD3InodcaPgPdbA1B5YG2JGL90oLgkP9p4ekB5Jnp4zDJmNQ2RC4m6jCyd8O45ELNL99d2iJFDNfw2EUWYu5DvqAuraONITnAeRWqAIirkOGhBxyaLI4dDQr48JyD79HM2Y_sptmsOtrmUMPU-lDPBI2nPtrBd_OlVh-d9oRlwPmLpwUiUDQn_VdKdfTp5ptPqVLinhxdItOzdRtlQNF_uuOcD1DXzbifP2MM9LRe5OECrOCBWyryigFXoOvLoEO0xNs-SJVSj29GCC2DW_e0uind7HEVx5u3LFzaz-Bd4zg0MW00"><a id="more"></a><h1 id="ç¼–å†™-imageproxy">ç¼–å†™ ImageProxy</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageProxy</span> <span class="keyword">implements</span> <span class="title">Icon</span> </span>&#123;  <span class="comment">// å®žçŽ°IconæŽ¥å£</span></span><br><span class="line">    ImageIcon imageIcon;    <span class="comment">// çœŸæ­£çš„å›¾åƒ</span></span><br><span class="line">    URL imgaeURL;</span><br><span class="line">    Thread retrievalThread;</span><br><span class="line">    <span class="keyword">boolean</span> retrieving = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageProxy</span><span class="params">(URL url)</span> </span>&#123;  <span class="comment">// å°†å›¾åƒURLä¼ å…¥æž„é€ å™¨</span></span><br><span class="line">        imgaeURL = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIconWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageIcon.getIconWidth();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">800</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIconHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> imageIcon.getIconHeight();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">600</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“éœ€è¦ç»˜åˆ¶å›¾åƒæ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paintIcon</span><span class="params">(<span class="keyword">final</span> Component c, Graphics g, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (imageIcon != <span class="keyword">null</span>) &#123;     <span class="comment">// å¦‚æžœå·²ç»æœ‰iconï¼Œå‘Šè¯‰å®ƒç”»å‡ºè‡ªå·±</span></span><br><span class="line">            imageIcon.paintIcon(c, g, x, y);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            g.drawString(<span class="string">"Loading CD cover, please wait..."</span>, x+<span class="number">300</span>, y+<span class="number">190</span>);</span><br><span class="line">            <span class="keyword">if</span> (!retrieving) &#123;</span><br><span class="line">                retrieving = <span class="keyword">true</span>;</span><br><span class="line">                <span class="comment">// æˆ‘ä»¬ä¸å¸Œæœ›æŒ‚èµ·æ•´ä¸ªç”¨æˆ·ç•Œé¢ï¼Œæ‰€ä»¥ç”¨å¦ä¸€ä¸ªçº¿ç¨‹å–å‡ºå›¾åƒã€‚</span></span><br><span class="line">                retrievalThread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            imageIcon = <span class="keyword">new</span> ImageIcon(imgaeURL, <span class="string">"CD cover"</span>);</span><br><span class="line">                            <span class="comment">// å½“å›¾åƒå‡†å¤‡å¥½æ—¶ï¼Œæˆ‘ä»¬å‘Šè¯‰Swingï¼Œéœ€è¦é‡ç»˜ã€‚</span></span><br><span class="line">                            c.repaint();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                retrievalThread.start();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/AyxEp2j8B4hCLN3AhmX8J4d9p4jNC3JWAeQB1-MNvgKuvnVbfHOfc78bvLSeA3ddPARcbIXn0HMKP2Pd5YJcbIX0n524F7CJqrC3Yl8hAZ65FPFpyxXIyr8KW0P230KBAmId5fMb5g4Q3H63guROfA1hXsI1bK91OcPU2SXK3KsO2XjT51NFPknxlcJNeuOvJxiMlDYxzycEjOyQvZxRrl6iSJqNGXtSN91PLWfFryrxig_xQSyqXAiJaqioon9BKf4y0cU1T4ES2zJQF-tfx7rFc_kHf85EGf6U1rM1vcA8tSXUoii7MfWFr8ZYfQTpLi3LlrYq-cd7xAUxTpsTqFT-JqzCtfCTtS_MB7oneVdvb1LFEpOWcVPi-ZQ8YjsBdqzeUxfXuzFbKvvrpe0RfQ7vOl_i5mjx7ZSq4H7QECCEJvHWA000"><h1 id="é—®ç­”">é—®ç­”</h1><ul><li><p><strong>é—®</strong>ï¼šå¯¹æˆ‘æ¥è¯´ï¼Œè¿œç¨‹æœåŠ¡å™¨å’Œè™šæ‹ŸæœåŠ¡å™¨å·®å¼‚éžå¸¸å¤§ï¼Œå®ƒä»¬çœŸçš„æ˜¯ä¸€ä¸ªæ¨¡å¼å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šåœ¨çœŸå®žçš„ä¸–ç•Œä¸­ï¼Œä»£ç†æ¨¡å¼æœ‰è®¸å¤šå˜ä½“ï¼Œè¿™äº›å˜ä½“éƒ½æœ‰å…±é€šç‚¹ï¼šéƒ½ä¼šå°†å®¢æˆ·å¯¹ä¸»é¢˜ï¼ˆSubjectï¼‰æ–½åŠ çš„æ–¹æ³•è°ƒç”¨æ‹¦æˆªä¸‹æ¥ã€‚è¿™ç§é—´æŽ¥çš„çº§åˆ«è®©æˆ‘ä»¬å¯ä»¥åšè®¸å¤šäº‹ï¼ŒåŒ…æ‹¬å°†è¯·æ±‚åˆ†å‘åˆ°è¿œç¨‹ä¸»é¢˜ï¼›ç»™åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡æä¾›ä»£è¡¨ï¼›æä¾›æŸäº›çº§åˆ«çš„ä¿æŠ¤ï¼Œè¿™ç§ä¿æŠ¤èƒ½å†³å®šå“ªäº›å®¢æˆ·èƒ½è°ƒç”¨å“ªäº›æ–¹æ³•â€¦â€¦ä¸€èˆ¬çš„ä»£ç†å½¢å¼è¿˜å¯ä»¥ä»¥è®¸å¤šå½¢å¼ä½¿ç”¨ã€‚</p></li><li><p><strong>é—®</strong>ï¼šImageProxy åœ¨æˆ‘çœ‹æ¥å¥½åƒæ˜¯ Decoratorï¼ˆè£…é¥°è€…ï¼‰ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨ä¸€ä¸ªå¯¹è±¡æŠŠå¦ä¸€ä¸ªå¯¹è±¡åŒ…èµ·æ¥ï¼Œç„¶åŽæŠŠè°ƒç”¨å§”æ‰˜ç»™ ImageIconã€‚æˆ‘è¿™æ ·è¯´æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæœ‰æ—¶å€™è¿™ä¸¤è€…çš„ç¡®çœ‹èµ·æ¥å¾ˆåƒï¼Œä½†æ˜¯<strong>å®ƒä»¬çš„ç›®çš„æ˜¯ä¸ä¸€æ ·çš„ã€‚è£…é¥°è€…ä¸ºå¯¹è±¡å¢žåŠ è¡Œä¸ºï¼Œè€Œä»£ç†æ˜¯æŽ§åˆ¶å¯¹è±¡çš„è®¿é—®</strong>ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œæ˜¾ç¤ºâ€˜åŠ è½½ä¸­â€™æ¶ˆæ¯ï¼Œéš¾é“å°±ä¸æ˜¯åœ¨å¢žåŠ è¡Œä¸ºï¼Ÿâ€ï¼Œä»ŽæŸæ–¹é¢æ¥è¯´ï¼Œè¿™çš„ç¡®å¯ä»¥ç®—æ˜¯ï¼Œä½†æ˜¯ï¼Œæ›´é‡è¦çš„ï¼ŒImageProxy æ˜¯æŽ§åˆ¶ ImageIcon çš„è®¿é—®ï¼Œå¦‚ä½•æŽ§åˆ¶å‘¢ï¼Ÿè¯•æƒ³ï¼šä»£ç†å°†å®¢æˆ·ä»Ž ImageIcon è§£è€¦äº†ï¼Œå¦‚æžœå®ƒä»¬ä¹‹é—´æ²¡æœ‰è§£è€¦ï¼Œå®¢æˆ·å°±å¿…é¡»ç­‰åˆ°æ¯å¹…å›¾åƒéƒ½è¢«å–å›žï¼Œç„¶åŽæ‰èƒ½æŠŠå®ƒç»˜åˆ¶åœ¨ç•Œé¢ä¸Šã€‚ä»£ç†æŽ§åˆ¶ ImageIcon çš„è®¿é—®ï¼Œä»¥ä¾¿åœ¨å›¾åƒå®Œå…¨åˆ›å»ºä¹‹å‰æä¾›å±å¹•ä¸Šçš„ä»£è¡¨ã€‚ä¸€æ—¦ ImageIcon è¢«åˆ›å»ºï¼Œä»£ç†å°±å…è®¸è®¿é—® ImageIconã€‚</p></li><li><p><strong>é—®</strong>ï¼šæˆ‘è¦å¦‚ä½•è®©å®¢æˆ·ä½¿ç”¨ä»£ç†ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„å¯¹è±¡ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå¥½é—®é¢˜ï¼Œä¸€ä¸ªå¸¸ç”¨çš„æŠ€å·§æ˜¯æä¾›ä¸€ä¸ªå·¥åŽ‚ï¼Œå®žä¾‹åŒ–å¹¶è¿”å›žä¸»é¢˜ã€‚å› ä¸ºè¿™æ˜¯åœ¨å·¥åŽ‚æ–¹æ³•å†…å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»£ç†åŒ…è£…ä¸»é¢˜å†è¿”å›žï¼Œè€Œå®¢æˆ·ä¸çŸ¥é“ä¹Ÿä¸åœ¨ä¹Žä»–ä½¿ç”¨çš„æ˜¯ä»£ç†è¿˜æ˜¯çœŸä¸œè¥¿ã€‚</p></li><li><p><strong>é—®</strong>ï¼šä»£ç†å’Œé€‚é…å™¨ä¹Ÿå¾ˆç±»ä¼¼ã€‚</p><p><strong>ç­”</strong>ï¼šä»£ç†å’Œé€‚é…å™¨éƒ½æ˜¯æŒ¡åœ¨å…¶ä»–å¯¹è±¡çš„å‰é¢ï¼Œå¹¶è´Ÿè´£å°†è¯·æ±‚è½¬å‘ç»™å®ƒä»¬ã€‚é€‚é…å™¨ä¼šæ”¹å˜å¯¹è±¡é€‚é…çš„æŽ¥å£ï¼Œè€Œä»£ç†åˆ™å®žçŽ°ç›¸åŒçš„æŽ¥å£ã€‚</p><p>æœ‰ä¸€ä¸ªé¢å¤–ç›¸ä¼¼æ€§ç‰µæ¶‰åˆ°ä¿æŠ¤ä»£ç†ï¼ˆProtection Proxyï¼‰ã€‚ä¿æŠ¤ä»£ç†å¯ä»¥æ ¹æ®å®¢æˆ·çš„è§’è‰²æ¥å†³å®šæ˜¯å¦å…è®¸å®¢æˆ·è®¿é—®ç‰¹å®šçš„æ–¹æ³•ã€‚æ‰€ä»¥ä¿æŠ¤ä»£ç†å¯èƒ½åªæä¾›ç»™å®¢æˆ·éƒ¨åˆ†æŽ¥å£ï¼Œè¿™å°±å’ŒæŸäº›é€‚é…å™¨å¾ˆç›¸åƒäº†ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿œç¨‹ä»£ç†</title>
      <link href="/notes/head-first-design-patterns/remote-proxy/"/>
      <url>/notes/head-first-design-patterns/remote-proxy/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥ç³–æžœæœºçŠ¶æ€ç›‘è§†å™¨">å¯¼å…¥ï¼šç³–æžœæœºçŠ¶æ€ç›‘è§†å™¨</h1><p>ç³–æžœå…¬å¸ CEO éœ€è¦åœ¨è¿œç¨‹ç›‘æŽ§ç³–æžœæœºã€‚æˆ‘ä»¬å·²ç»å¾—åˆ°äº†å¯ä»¥å–å¾—ç³–æžœæ•°é‡çš„ <code>getCount()</code> æ–¹æ³•å’Œå–å¾—ç³–æžœæœºçŠ¶æ€çš„ <code>getState()</code> æ–¹æ³•ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„äº‹ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä»½èƒ½æ‰“å°å‡ºæ¥çš„æŠ¥å‘Šï¼Œç„¶åŽæŠŠå®ƒé€’é€ç»™ CEOã€‚è®©æˆ‘ä»¬çŽ°åœ¨å°±å¼€å§‹ç¼–ç ã€‚</p><p>å…ˆä¸º GumballMachine åŠ ä¸Šå¤„ç†ä½ç½®çš„æ”¯æŒï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–å®žä¾‹å˜é‡</span></span><br><span class="line">    String location;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(String location, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æž„é€ å™¨å†…çš„å…¶ä»–ä»£ç </span></span><br><span class="line">        <span class="keyword">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getterç­‰å…¶ä»–æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¦ä¸€ä¸ªç±»ï¼šGumballMonitorï¼ˆç³–æžœç›‘è§†å™¨ï¼‰ï¼Œä»¥ä¾¿å–å¾—æœºå™¨çš„ä½ç½®ã€ç³–æžœçš„åº“å­˜é‡ä»¥åŠå½“å‰æœºå™¨çš„çŠ¶æ€ï¼Œå¹¶æ‰“å°æˆä¸€ä»½å¯çˆ±çš„æŠ¥å‘Šã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitor</span> </span>&#123;</span><br><span class="line">    GumballMachine machine;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GumballMonitor</span><span class="params">(GumballMachine machine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.machine = machine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">report</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ‰“å°æŠ¥å‘Š</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»™ GumballMonitor ä¸€ä¸ªç³–æžœæœºçš„å¼•ç”¨ï¼Œå®ƒç»™æˆ‘ä»¬ä¸€ä»½æŠ¥å‘Šã€‚<strong>é—®é¢˜åœ¨äºŽç›‘è§†å™¨å’Œç³–æžœæœºå¿…é¡»åœ¨åŒä¸€ä¸ª JVM ä¸Šé¢æ‰§è¡Œï¼Œä½†æ˜¯ CEO å¸Œæœ›åœ¨ä»–çš„æ¡Œé¢ä¸Šè¿œç¨‹ç›‘æŽ§è¿™äº›æœºå™¨</strong>ã€‚ä½ ä¸èƒ½å–å¾—å¦ä¸€ä¸ªå †çš„å¯¹è±¡çš„å¼•ç”¨ï¼Œæ¢å¥è¯è¯´ï¼Œä½ ä¸å¯ä»¥è¿™ä¹ˆå†™ï¼š<code>Duck d = &lt;å¦ä¸€ä¸ªå †çš„å¯¹è±¡&gt;</code>ã€‚å˜é‡ d åªèƒ½å¼•ç”¨å½“å‰ä»£ç è¯­å¥çš„åŒä¸€å †ç©ºé—´çš„å¯¹è±¡ã€‚é‚£è¯¥æ€Žä¹ˆåŠžï¼Ÿ</p><p>æˆ‘ä»¬éœ€è¦<strong>è¿œç¨‹ä»£ç†</strong>ï¼ˆremote proxyï¼‰ã€‚æ‰€è°“çš„ä»£ç†ï¼Œå°±æ˜¯ä»£è¡¨æŸä¸ªçœŸå®žçš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œä»£ç†å°±åƒæ˜¯ç³–æžœæœºä¸€æ ·ï¼Œä½†å…¶å®žå¹•åŽæ˜¯å®ƒåˆ©ç”¨ç½‘ç»œå’Œä¸€ä¸ªè¿œç¨‹çš„çœŸæ­£ç³–æžœæœºæ²Ÿé€šã€‚</p><a id="more"></a><h1 id="è¿œç¨‹æ–¹æ³•-101">è¿œç¨‹æ–¹æ³• 101</h1><p>å‡å¦‚æˆ‘ä»¬æƒ³è¦è®¾è®¡ä¸€ä¸ªç³»ç»Ÿï¼Œèƒ½å¤Ÿè°ƒç”¨æœ¬åœ°å¯¹è±¡ï¼Œç„¶åŽå°†æ¯ä¸ªè¯·æ±‚è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ä¸Šè¿›è¡Œã€‚è¦å¦‚ä½•è®¾è®¡ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€äº›è¾…åŠ©å¯¹è±¡ï¼Œå¸®æˆ‘ä»¬çœŸæ­£è¿›è¡Œæ²Ÿé€šã€‚è¿™äº›è¾…åŠ©å¯¹è±¡ä½¿å®¢æˆ·å°±åƒåœ¨è°ƒç”¨æœ¬åœ°å¯¹è±¡çš„æ–¹æ³•ï¼ˆäº‹å®žä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ä¸€æ ·ã€‚å®¢æˆ·è°ƒç”¨å®¢æˆ·è¾…åŠ©å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œä»¿ä½›å®¢æˆ·è¾…åŠ©å¯¹è±¡å°±æ˜¯çœŸæ­£çš„æœåŠ¡ã€‚å®¢æˆ·è¾…åŠ©å¯¹è±¡å†è´Ÿè´£ä¸ºæˆ‘ä»¬è½¬å‘è¿™äº›è¯·æ±‚ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/RP5DIm916CVlyoa6JtKGwj15eeETEWXXtMDr1rtAcMLs3RrjcQ9IK6YHPP85OH5PU4XPqEzYExFxCHhSTNNLupppU_ulCzgnWbM9IXaO9RbzIPOLd8AR6q3pvt6InV8keHXHk0Mah4vmDfD052H83eROrmil_xBdKWW8N5UIYYfXtPzt1yvFEmGb3IPF58JrLP0pBBBg-nogKfBB0uHbA2nS6zwyOjKsQtIMdUAnFKXHIj5qcf-iJmz1p5LOyj8GFKNqA8rEL55fnSOIwmV3H4UGY8aRE0ATKOFVTtdvnZ8_xOSBotorhqj_nZbmkyFmZfyj0bdNv9NXs6Z6yWSJtR7n12P2S3iynpcZEdjikLfpGfwbJA9AwZ0jFcrjtTiMbu5IaUaxyqBFUJjplWjslMFr3Ql_mUy6l7SR0W5-9h0W7wH4o2bbcpNUQix2BzZpIerT5Zt8Qo0ehu4x_mS0"><ol type="1"><li>å®¢æˆ·å¯¹è±¡å…ˆä»Ž RMI registry ä¸­å–å¾—æ³¨å†Œåä¸º â€MyServerâ€œ çš„ä»£ç†ã€‚</li><li>RMI registry è¿”å›žæŒ‡å®šçš„ä»£ç†ï¼Œä»£ç†ä¸ŽæœåŠ¡å¯¹è±¡å…·æœ‰ç›¸åŒçš„æŽ¥å£ï¼Œå› æ­¤å¯ä»¥æ›¿ä»£å®¢æˆ·ç«¯å¸Œæœ›ä½¿ç”¨çš„æœåŠ¡å¯¹è±¡ã€‚</li><li>å®¢æˆ·å¯¹è±¡è°ƒç”¨å®¢æˆ·è¾…åŠ©ç¨‹åºçš„ <code>doBigThing()</code> æ–¹æ³•ã€‚</li><li>å®¢æˆ·è¾…åŠ©å¯¹è±¡æ‰“åŒ…è°ƒç”¨ä¿¡æ¯ï¼ˆå˜é‡ã€æ–¹æ³•åç§°ç­‰ï¼‰ï¼Œç„¶åŽé€šè¿‡ç½‘ç»œå°†å®ƒè¿ç»™æœåŠ¡è¾…åŠ©å¯¹è±¡ï¼ˆé€šè¿‡ Socket è¿žæŽ¥ï¼‰ã€‚</li><li>æœåŠ¡è¾…åŠ©å¯¹è±¡æŠŠæ¥è‡ªå®¢æˆ·è¾…åŠ©å¯¹è±¡çš„ä¿¡æ¯è§£åŒ…ï¼Œæ‰¾å‡ºè¢«è°ƒç”¨çš„æ–¹æ³•ï¼ˆä»¥åŠåœ¨å“ªä¸ªå¯¹è±¡å†…ï¼‰ï¼Œç„¶åŽè°ƒç”¨<strong>çœŸæ­£</strong>çš„æœåŠ¡å¯¹è±¡ä¸Šçš„<strong>çœŸæ­£</strong>æ–¹æ³•ã€‚</li><li>æœåŠ¡å¯¹è±¡ä¸Šçš„æ–¹æ³•è¢«è°ƒç”¨ï¼Œå°†ç»“æžœè¿”å›žç»™æœåŠ¡è¾…åŠ©å¯¹è±¡ã€‚</li><li>æœåŠ¡è¾…åŠ©å¯¹è±¡æŠŠè°ƒç”¨çš„è¿”å›žä¿¡æ¯æ‰“åŒ…ï¼Œç„¶åŽé€šè¿‡ç½‘ç»œè¿å›žç»™å®¢æˆ·è¾…åŠ©å¯¹è±¡ï¼ˆé€šè¿‡ç½‘ç»œ Socket çš„è¾“å‡ºæµï¼‰ã€‚</li><li>å®¢æˆ·è¾…åŠ©å¯¹è±¡æŠŠè¿”å›žä¿¡æ¯è§£åŒ…ï¼Œè¿”å›žç»™å®¢æˆ·å¯¹è±¡ã€‚å¯¹äºŽå®¢æˆ·æ¥è¯´ï¼Œè¿™æ˜¯å®Œå…¨é€æ˜Žçš„ã€‚</li></ol><h1 id="java-rmi-æ¦‚è§‚">Java RMI æ¦‚è§‚</h1><p>çŽ°åœ¨ä½ å·²ç»çŸ¥é“è¿œç¨‹æ–¹æ³•å¦‚ä½•å·¥ä½œçš„è¦ç‚¹ï¼Œä½ è¦éœ€è¦äº†è§£å¦‚ä½•åˆ©ç”¨ RMI è¿›è¡Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚</p><p>RMI æä¾›äº†<strong>å®¢æˆ·è¾…åŠ©å¯¹è±¡å’ŒæœåŠ¡è¾…åŠ©å¯¹è±¡</strong>ï¼Œä¸ºå®¢æˆ·è¾…åŠ©å¯¹è±¡åˆ›å»ºå’ŒæœåŠ¡å¯¹è±¡ç›¸åŒçš„æ–¹æ³•ã€‚RMI çš„å¥½å¤„åœ¨äºŽä½ ä¸å¿…äº²è‡ªå†™ä»»ä½•ç½‘ç»œæˆ– I/O ä»£ç ã€‚å®¢æˆ·ç¨‹åºè°ƒç”¨è¿œç¨‹æ–¹æ³•å°±å’Œåœ¨æœ¬åœ° JVM ä¸Šå¯¹å¯¹è±¡è¿›è¡Œæ–¹æ³•è°ƒç”¨ä¸€æ ·ã€‚</p><p>RMI ä¹Ÿæä¾›äº†æ‰€æœ‰è¿è¡Œæ—¶çš„åŸºç¡€è®¾æ–½ï¼Œå¥½è®©è¿™ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚è¿™åŒ…æ‹¬äº†æŸ¥æ‰¾æœåŠ¡ï¼ˆlookup serviceï¼‰ï¼Œè¿™ä¸ªæœåŠ¡ç”¨æ¥å¯»æ‰¾å’Œè®¿é—®è¿œç¨‹å¯¹è±¡ã€‚</p><p>å…³äºŽ RMI è°ƒç”¨å’Œæœ¬åœ°çš„æ–¹æ³•è°ƒç”¨ï¼Œæœ‰ä¸€ä¸ªä¸åŒç‚¹ã€‚<strong>è™½ç„¶è°ƒç”¨è¿œç¨‹æ–¹æ³•å°±å¦‚åŒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼Œä½†æ˜¯å®¢æˆ·è¾…åŠ©å¯¹è±¡ä¼šé€šè¿‡ç½‘ç»œå‘é€æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥ç½‘ç»œå’Œ I/O çš„ç¡®æ˜¯å­˜åœ¨çš„ã€‚æˆ‘ä»¬çŸ¥é“ç½‘ç»œå’Œ I/O æ˜¯æœ‰é£Žé™©çš„ï¼Œå®¹æ˜“å¤±è´¥çš„ï¼Œæ‰€ä»¥éšæ—¶éƒ½å¯èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚</strong></p><p><strong>RMI å°†å®¢æˆ·è¾…åŠ©å¯¹è±¡ç§°ä¸º stubï¼ˆæ¡©ï¼‰ï¼ŒæœåŠ¡è¾…åŠ©å¯¹è±¡ç§°ä¸º skeletonï¼ˆéª¨æž¶ï¼‰ã€‚</strong></p><h1 id="åˆ¶ä½œè¿œç¨‹æœåŠ¡">åˆ¶ä½œè¿œç¨‹æœåŠ¡</h1><p>è¿™é‡Œåˆç”¨æ¥åˆ¶ä½œè¿œç¨‹æœåŠ¡çš„äº”ä¸ªæ­¥éª¤çš„æ¦‚è¦ã€‚è¿™äº›æ­¥éª¤å°†ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡å˜æˆå¯ä»¥è¢«è¿œç¨‹å®¢æˆ·è°ƒç”¨çš„è¿œç¨‹å¯¹è±¡ã€‚æˆ‘ä»¬ç¨åŽä¼šæŠŠè¿™äº›æ­¥éª¤åº”ç”¨äºŽ GumballMachineã€‚</p><h2 id="åˆ¶ä½œè¿œç¨‹æŽ¥å£">åˆ¶ä½œè¿œç¨‹æŽ¥å£</h2><p>è¿œç¨‹æŽ¥å£å®šä¹‰å‡ºå¯ä»¥è®©å®¢æˆ·è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚å®¢æˆ·å°†ç”¨å®ƒä½œä¸ºæœåŠ¡çš„ç±»ç±»åž‹ã€‚</p><ol type="1"><li><p>æ‰©å±• <code>java.rmi.Remote</code>ã€‚</p><p>Remote æ˜¯ä¸€ä¸ªâ€œè®°å·â€æŽ¥å£ï¼Œæ‰€ä»¥ Remote ä¸å…·æœ‰æ–¹æ³•ã€‚å¯¹äºŽ RMI æ¥è¯´ï¼ŒRemote æŽ¥å£å…·æœ‰ç‰¹åˆ«çš„æ„ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»éµå®ˆè§„åˆ™ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿™é‡Œè¯´çš„æ˜¯â€œæ‰©å±•â€ï¼ˆextendsï¼‰ï¼Œå› ä¸ºæŽ¥å£å¯ä»¥â€œæ‰©å±•â€å¦ä¸€ä¸ªæŽ¥å£ã€‚</p></li><li><p>å£°æ˜Žæ‰€æœ‰çš„æ–¹æ³•éƒ½ä¼šæŠ›å‡º RemoteExceptionã€‚</p><p>å®¢æˆ·ä¼šè°ƒç”¨å®žçŽ°è¿œç¨‹æŽ¥å£çš„ Stub ä¸Šçš„æ–¹æ³•ï¼Œè€Œ Stub åº•å±‚ç”¨åˆ°äº†ç½‘ç»œå’Œ I/Oï¼Œæ‰€ä»¥å„ç§åäº‹æƒ…éƒ½æœ‰å¯èƒ½ä¼šå‘ç”Ÿã€‚å®¢æˆ·å¿…é¡»è®¤è¯†åˆ°é£Žé™©ï¼Œé€šè¿‡å¤„ç†æˆ–å£°æ˜Žè¿œç¨‹å¼‚å¸¸æ¥è§£å†³ã€‚</p></li><li><p>ç¡®å®šå˜é‡å’Œè¿”å›žå€¼æ˜¯å±žäºŽåŽŸè¯­ï¼ˆprimitiveï¼‰ç±»åž‹æˆ–è€…å¯åºåˆ—åŒ–ï¼ˆSerializableï¼‰ç±»åž‹ã€‚</p><p>è¿œç¨‹æ–¹æ³•çš„å˜é‡å¿…é¡»è¢«æ‰“åŒ…å¹¶é€šè¿‡ç½‘ç»œè¿é€ï¼Œè¿™è¦é åºåˆ—åŒ–æ¥å®Œæˆã€‚å¦‚æžœä½ ä½¿ç”¨åŽŸè¯­ç±»åž‹ï¼Œå­—ç¬¦ä¸²å’Œè®¸å¤š API ä¸­å†…å®šçš„ç±»åž‹ï¼ˆåŒ…æ‹¬æ•°ç»„å’Œé›†åˆï¼‰ï¼Œéƒ½ä¸ä¼šæœ‰é—®é¢˜ã€‚å¦‚æžœä½ ä¼ é€è‡ªå·±å®šä¹‰çš„ç±»ï¼Œå°±å¿…é¡»ä¿è¯ä½ çš„ç±»å®žçŽ°äº† Serializableã€‚</p></li></ol><figure class="highlight java"><figcaption><span>server/MyRemote.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;  <span class="comment">// RemoteæŽ¥å£åœ¨java.rmiä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyRemote</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¶ä½œè¿œç¨‹çš„å®žçŽ°">åˆ¶ä½œè¿œç¨‹çš„å®žçŽ°</h2><p>è¿™æ˜¯åšå®žé™…å·¥ä½œçš„ç±»ï¼Œä¸ºè¿œç¨‹æŽ¥å£ä¸­å®šä¹‰çš„è¿œç¨‹æ–¹æ³•æä¾›äº†çœŸæ­£çš„å®žçŽ°ã€‚è¿™å°±æ˜¯å®¢æˆ·çœŸæ­£æƒ³è¦è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ GumballMachineï¼‰ã€‚</p><ol type="1"><li><p>å®žçŽ°è¿œç¨‹æŽ¥å£ã€‚</p><p>ä½ çš„æœåŠ¡å¿…é¡»å®žçŽ°è¿œç¨‹æŽ¥å£ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·å°†è¦è°ƒç”¨çš„æ–¹æ³•çš„æŽ¥å£ã€‚</p></li><li><p>æ‰©å±• UnicastRemoteObjectã€‚</p><p>ä¸ºäº†è¦æˆä¸ºè¿œç¨‹æœåŠ¡å¯¹è±¡ï¼Œä½ çš„å¯¹è±¡éœ€è¦æŸäº›â€œè¿œç¨‹çš„â€åŠŸèƒ½ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯æ‰©å±• <code>java.rmi.server.UnicastRemoteObject</code>ï¼Œè®©è¶…ç±»å¸®ä½ åšè¿™äº›å·¥ä½œã€‚</p></li><li><p>è®¾è®¡ä¸€ä¸ªä¸å¸¦å˜é‡çš„æž„é€ å™¨ï¼Œå¹¶å£°æ˜Ž RemoteExceptionã€‚</p><p>ä½ çš„æ–°è¶…ç±» UnicastRemoteObject å¸¦æ¥ä¸€ä¸ªå°é—®é¢˜ï¼šå®ƒçš„æž„é€ å™¨æŠ›å‡º RemoteExceptionã€‚å”¯ä¸€è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±æ˜¯ä¸ºä½ çš„è¿œç¨‹å®žçŽ°å£°æ˜Žä¸€ä¸ªæž„é€ å™¨ï¼Œè¿™æ ·å°±æœ‰äº†ä¸€ä¸ªå£°æ˜Ž RemoteException çš„åœ°æ–¹ã€‚</p></li><li><p>ç”¨ RMI Registry æ³¨å†Œæ­¤æœåŠ¡ã€‚</p><p>çŽ°åœ¨ä½ å·²ç»æœ‰ä¸€ä¸ªè¿œç¨‹æœåŠ¡äº†ï¼Œå¿…é¡»è®©å®ƒå¯ä»¥è¢«è¿œç¨‹å®¢æˆ·è°ƒç”¨ã€‚ä½ è¦åšçš„æ˜¯å°†æ­¤æœåŠ¡å®žä¾‹åŒ–ï¼Œç„¶åŽæ”¾è¿› RMI registryä¸­ï¼ˆç¡®å®š RMI Registry æ­£åœ¨è¿è¡Œï¼Œå¦åˆ™æ³¨å†Œä¼šå¤±è´¥ï¼‰ã€‚å½“æ³¨å†Œè¿™ä¸ªå®žçŽ°å¯¹è±¡æ—¶ï¼ŒRMI ç³»ç»Ÿå…¶å®žæ³¨å†Œçš„æ˜¯ stubï¼Œå› ä¸ºè¿™æ˜¯å®¢æˆ·æ•´æ•´éœ€è¦çš„ã€‚æ³¨å†ŒæœåŠ¡ä½¿ç”¨äº† <code>java.rmi.Naming</code> ç±»çš„é™æ€ <code>rebind()</code> æ–¹æ³•ã€‚</p></li></ol><figure class="highlight java"><figcaption><span>server/MyRemoteImpl.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRemoteImpl</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">MyRemote</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Server says, 'Hey'"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyRemoteImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MyRemote service = <span class="keyword">new</span> MyRemoteImpl();</span><br><span class="line">            <span class="comment">// å®¢æˆ·å°†ä½¿ç”¨ä½ æ‰€æ³¨å†Œçš„åç§° RemoteHello åœ¨RMI registryä¸­å¯»æ‰¾å®ƒã€‚</span></span><br><span class="line">            Naming.rebind(<span class="string">"RemoteHello"</span>, service);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº§ç”Ÿ-stub-å’Œ-skeleton">äº§ç”Ÿ Stub å’Œ Skeleton</h2><p>è¿™å°±æ˜¯å®¢æˆ·å’ŒæœåŠ¡çš„è¾…åŠ©ç±»ã€‚ä½ ä¸éœ€è‡ªå·±åˆ›å»ºè¿™äº›ç±»ï¼Œå½“ä½ è¿è¡Œ rmic å·¥å…·æ—¶ï¼Œä¼šè‡ªåŠ¨å¤„ç†ã€‚</p><ol type="1"><li><p>åœ¨è¿œç¨‹å®žçŽ°ç±»ï¼ˆä¸æ˜¯è¿œç¨‹æŽ¥å£ï¼‰ä¸Šæ‰§è¡Œrmicã€‚</p><p>rmic æ˜¯ JDK å†…çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥ä¸ºä¸€ä¸ªæœåŠ¡ç±»äº§ç”Ÿ stub å’Œ skeletonã€‚å‘½åä¹ æƒ¯æ˜¯åœ¨è¿œç¨‹å®žçŽ°çš„åå­—åŽé¢åŠ ä¸Š _Stub æˆ– _Skelã€‚rmic æœ‰ä¸€äº›é€‰é¡¹å¯ä»¥è°ƒæ•´ï¼Œç”šè‡³ä½¿ç”¨ IIOP ä½œä¸ºåè®®ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨å¸¸ç”¨çš„æ–¹å¼ï¼Œå°†ç±»äº§ç”Ÿåœ¨å½“å‰ç›®å½•ä¸‹ã€‚è¯·æ³¨æ„ï¼Œrmic å¿…é¡»çœ‹åˆ°ä½ çš„å®žçŽ°ç±»ï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šä»Žä½ çš„è¿œç¨‹å®žçŽ°æ‰€åœ¨çš„ç›®å½•æ‰§è¡Œ rmicï¼ˆä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œä¸ç”¨ packageã€‚ä½†æ˜¯åœ¨çœŸå®žä¸–ç•Œä¸­ï¼Œä½ å¿…é¡»æ³¨æ„ package çš„ç›®å½•ç»“æž„å’Œåç§°é—®é¢˜ï¼‰ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server admin$ javac MyRemote.java         # ç¼–è¯‘æŽ¥å£</span><br><span class="line">server admin$ javac MyRemoteImpl.java     # ç¼–è¯‘å®žçŽ°</span><br><span class="line">server admin$ rmic MyRemoteImpl           # åœ¨å®žçŽ°ä¸Šè¿è¡Œrmicå·¥å…·</span><br><span class="line">è­¦å‘Š: ä¸º JRMP ç”Ÿæˆå’Œä½¿ç”¨éª¨æž¶åŠé™æ€å­˜æ ¹</span><br><span class="line">å·²è¿‡æ—¶ã€‚éª¨æž¶ä¸å†å¿…è¦, è€Œé™æ€å­˜æ ¹</span><br><span class="line">å·²ç”±åŠ¨æ€ç”Ÿæˆçš„å­˜æ ¹å–ä»£ã€‚å»ºè®®ç”¨æˆ·</span><br><span class="line">ä¸å†ä½¿ç”¨rmicæ¥ç”Ÿæˆéª¨æž¶å’Œé™æ€å­˜æ ¹ã€‚</span><br><span class="line">è¯·å‚é˜… java.rmi.server.UnicastRemoteObject çš„æ–‡æ¡£ã€‚</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨-rmi-registry">å¯åŠ¨ RMI registry</h2><p>rmiregistry å°±åƒæ˜¯ç”µè¯è–„ï¼Œå®¢æˆ·å¯ä»¥ä»Žä¸­æŸ¥åˆ°ä»£ç†çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·çš„ stub helper å¯¹è±¡ï¼‰ã€‚</p><ol type="1"><li><p>å¼€å¯ä¸€ä¸ªç»ˆç«¯ï¼Œå¯åŠ¨ rmiregistryã€‚</p><p>ç¡®å®šå¯åŠ¨ç›®å½•å¿…é¡»å¯ä»¥è®¿é—®ä½ çš„ç±»ã€‚æœ€ç®€å•çš„åšæ³•æ˜¯ä»Žä½ çš„ â€œclassesâ€ ç›®å½•å¯åŠ¨ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server admin$ rmiregistry</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨è¿œç¨‹æœåŠ¡">å¯åŠ¨è¿œç¨‹æœåŠ¡</h2><p>ä½ å¿…é¡»è®©æœåŠ¡å¯¹è±¡å¼€å§‹è¿è¡Œã€‚ä½ çš„æœåŠ¡å®žçŽ°ç±»ä¼šåŽ»å®žä¾‹åŒ–ä¸€ä¸ªæœåŠ¡çš„å®žä¾‹ï¼Œå¹¶å°†è¿™ä¸ªæœåŠ¡æ³¨å†Œåˆ° RMI registryã€‚æ³¨å†Œä¹‹åŽï¼Œè¿™ä¸ªæœåŠ¡å°±å¯ä»¥ä¾›å®¢æˆ·è°ƒç”¨äº†ã€‚</p><ol type="1"><li><p>å¼€å¯å¦ä¸€ä¸ªç»ˆç«¯ï¼Œå¯åŠ¨æœåŠ¡ã€‚</p><p>ä»Žå“ªé‡Œå¯åŠ¨ï¼Ÿå¯èƒ½æ˜¯ä»Žä½ çš„è¿œç¨‹å®žçŽ°ç±»ä¸­çš„ <code>main()</code> æ–¹æ³•ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»Žä¸€ä¸ªç‹¬ç«‹çš„å¯åŠ¨ç±»ã€‚åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä»Žå®žçŽ°ç±»ä¸­çš„ <code>main()</code> æ–¹æ³•å¯åŠ¨çš„ï¼Œå…ˆå®žä¾‹åŒ–ä¸€ä¸ªæœåŠ¡å¯¹è±¡ï¼ˆ<code>new MyRemoteImpl()</code>ï¼‰ï¼Œç„¶åŽåˆ° RMI registry ä¸­æ³¨å†Œï¼ˆ<code>Naming.rebind()</code>ï¼‰ã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server admin$ java MyRemoteImpl   # åœ¨æœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡</span><br></pre></td></tr></table></figure><h1 id="å®¢æˆ·å¦‚ä½•å–å¾—-stub-å¯¹è±¡">å®¢æˆ·å¦‚ä½•å–å¾— stub å¯¹è±¡</h1><p>å®¢æˆ·å¿…é¡»å–å¾— stub å¯¹è±¡ï¼ˆæˆ‘ä»¬çš„ä»£ç†ï¼‰ä»¥è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ RMI registry çš„å¸®å¿™ã€‚</p><figure class="highlight java"><figcaption><span>client/MyRemoteClient.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;  <span class="comment">// ç”¨æ¥lookupçš„Namingç±»åœ¨rmiåŒ…ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRemoteClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> MyRemoteClient().go();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è¿”å›žå€¼æ˜¯Objectç±»åž‹ï¼Œè¦è½¬æ¢ç±»åž‹</span></span><br><span class="line">            <span class="comment">// ä½ éœ€è¦IPåœ°å€æˆ–ä¸»æœºåï¼Œä»¥åŠæœåŠ¡è¢«ç»‘å®š/é‡ç»‘å®šæ—¶ç”¨çš„åç§°</span></span><br><span class="line">            MyRemote service = (MyRemote) Naming.lookup(<span class="string">"rmi://127.0.0.1/RemoteHello"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å’Œä¸€èˆ¬çš„æ–¹æ³•è°ƒç”¨æ²¡ä»€ä¹ˆä¸¤æ ·ï¼ˆé™¤äº†å¿…é¡»æ³¨æ„RemoteExceptionä¹‹å¤–ï¼‰ã€‚</span></span><br><span class="line">            String s = service.sayHello();</span><br><span class="line"></span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># MyRemoteClientä¹Ÿéœ€è¦MyRemoteæŽ¥å£</span><br><span class="line">client admin$ cp ../server/MyRemote.class MyRemote.class</span><br><span class="line"></span><br><span class="line"># rmicå·¥å…·ç”Ÿæˆçš„MyRemoteImpl_Stub.classæ˜¯å®¢æˆ·ç«¯æ‰€éœ€è¦çš„</span><br><span class="line">client admin$ mv ../server/MyRemoteImpl_Stub.class MyRemoteImpl_Stub.class</span><br><span class="line"></span><br><span class="line">client admin$ javac MyRemoteClient.java</span><br><span class="line">client admin$ java MyRemoteClient</span><br><span class="line">Server says, &apos;Hey&apos;</span><br></pre></td></tr></table></figure><blockquote><p>å®¢æˆ·å¦‚ä½•å–å¾— stub ç±»ï¼Ÿ</p><p>çŽ°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ã€‚ä¸ç®¡æ€Žæ ·ï¼Œå®¢æˆ·åœ¨åš lookup æ—¶å¿…é¡»æœ‰ stub ç±»ï¼ˆä¹‹å‰åˆ©ç”¨ rmic äº§ç”Ÿçš„ï¼‰ï¼Œå¦åˆ™ stub åœ¨å®¢æˆ·ç«¯å°±æ— æ³•è¢«ååºåˆ—åŒ–ï¼Œä¸€åˆ‡ä¹Ÿå°±å‘Šå¹ã€‚å®¢æˆ·ç«¯ä¹Ÿéœ€è¦è°ƒç”¨è¿œç¨‹å¯¹è±¡æ–¹æ³•æ‰€è¿”å›žçš„åºåˆ—åŒ–å¯¹è±¡çš„ç±»ï¼ˆä¾‹å¦‚è°ƒç”¨ <code>sayHello()</code> è¿”å›žçš„ Stringï¼‰ã€‚å¦‚æžœæ˜¯ä¸€ä¸ªç®€å•çš„ç³»ç»Ÿï¼Œå¯ä»¥ç®€å•åœ°æŠŠè¿™äº›ç±»ç§»äº¤ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ›´é…·çš„æ–¹å¼ï¼Œè¿™ä¸ªé…·æ–¹æ³•æ˜¯â€œåŠ¨æ€ç±»ä¸‹è½½â€ï¼ˆdynamic class downloadingï¼‰ï¼Œåˆ©ç”¨åŠ¨æ€ç±»ä¸‹è½½ï¼Œåºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆåƒ stubï¼‰å¯ä»¥è¢«â€œè´´â€ä¸Šä¸€ä¸ª URLï¼Œå‘Šè¯‰å®¢æˆ·çš„ RMI ç³»ç»ŸåŽ»å¯»æ‰¾å¯¹è±¡çš„ç±»æ–‡ä»¶ã€‚å¦‚æžœ RMI æ²¡æœ‰åœ¨æœ¬åœ°å‘çŽ°ç±»ï¼Œå°±ä¼šåˆ©ç”¨ HTTP çš„ GET ä»Žè¯¥ URL å–å¾—ç±»æ–‡ä»¶ã€‚æ‰€ä»¥ä½ éœ€è¦ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡å™¨æ¥æä¾›è¿™äº›ç±»æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„å®‰å…¨å‚æ•°ã€‚å…³äºŽåŠ¨æ€ç±»ä¸‹è½½ï¼Œè¿˜æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„ä¸»é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œåªæ˜¯ç®€è¿°ä¸€ä¸‹ã€‚</p><p>ç‰¹åˆ«å¯¹äºŽ stub å¯¹è±¡ï¼Œå®¢æˆ·è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•å¯ä»¥å–å¾—ç±»ï¼Œä½†æ˜¯åªæœ‰ Java 5 æ‰æ”¯æŒã€‚Java 5 çš„ RMI å’ŒåŠ¨æ€ä»£ç†æ­é…ä½¿ç”¨ï¼ŒåŠ¨æ€ä»£ç†åŠ¨æ€äº§ç”Ÿ stubï¼Œè¿œç¨‹å¯¹è±¡çš„ stub æ˜¯ <code>java.lang.reflect.Proxy</code> å®žä¾‹ï¼ˆè¿žåŒä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨ï¼‰ï¼Œå®ƒæ˜¯è‡ªåŠ¨äº§ç”Ÿçš„ï¼Œæ¥å¤„ç†æ‰€æœ‰æŠŠå®¢æˆ·çš„æœ¬åœ°è°ƒç”¨å˜æˆè¿œç¨‹è°ƒç”¨çš„ç»†èŠ‚ã€‚æ‰€ä»¥ï¼Œä½ ä¸å†éœ€è¦ä½¿ç”¨ rmicï¼Œå®¢æˆ·å’Œè¿œç¨‹å¯¹è±¡æ²Ÿé€šçš„ä¸€åˆ‡éƒ½åœ¨å¹•åŽå¤„ç†æŽ‰äº†ã€‚</p><p>åŠ¨æ€ä»£ç†çš„ç›¸å…³å†…å®¹è§<a href="/notes/head-first-design-patterns/protection-proxy/" title="ä¿æŠ¤ä»£ç†">ä¿æŠ¤ä»£ç†</a>ã€‚</p></blockquote><p>å¯¹äºŽ RMIï¼Œç¨‹åºå‘˜æœ€å¸¸çŠ¯çš„ä¸‰ä¸ªé”™è¯¯æ˜¯ï¼š</p><ol type="1"><li>å¿˜äº†åœ¨å¯åŠ¨è¿œç¨‹æœåŠ¡ä¹‹å‰å…ˆå¯åŠ¨ rmiregistryï¼ˆè¦ç”¨ <code>Naming.rebind()</code> æ³¨å†ŒæœåŠ¡ï¼Œrmiregistry å¿…é¡»æ˜¯è¿è¡Œçš„ï¼‰ã€‚</li><li>å¿˜äº†è®©å˜é‡å’Œè¿”å›žå€¼çš„ç±»åž‹æˆä¸ºå¯åºåˆ—åŒ–çš„ç±»åž‹ï¼ˆè¿™ç§é”™è¯¯æ— æ³•åœ¨ç¼–è¯‘æ—¶æœŸå‘çŽ°ï¼Œåªä¼šåœ¨è¿è¡Œæ—¶å‘çŽ°ï¼‰ã€‚</li><li>å¿˜äº†ç»™å®¢æˆ·æä¾› stub ç±»ã€‚</li></ol><h1 id="å›žåˆ°-gumballmachine">å›žåˆ° GumballMachine</h1><h2 id="æœåŠ¡å™¨ç«¯">æœåŠ¡å™¨ç«¯</h2><p>åˆ¶ä½œè¿œç¨‹æŽ¥å£ï¼š</p><figure class="highlight java"><figcaption><span>server/GumballMachineRemote.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;  <span class="comment">// RemoteæŽ¥å£åœ¨java.rmiä¸­ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GumballMachineRemote</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">    <span class="comment">// æ‰€æœ‰çš„è¿”å›žç±»åž‹éƒ½å¿…é¡»æ˜¯åŽŸè¯­ç±»åž‹æˆ–å¯åºåˆ—åŒ–ç±»åž‹ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>server/State.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*; <span class="comment">// Serializableåœ¨java.ioåŒ…å†…ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åªéœ€è¦æ‰©å±•SerializableæŽ¥å£ï¼ˆæ­¤æŽ¥å£æ²¡æœ‰æ–¹æ³•ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">// çŽ°åœ¨æ‰€æœ‰å­ç±»ä¸­çš„Stateå°±å¯ä»¥åœ¨ç½‘ç»œä¸Šä¼ é€äº†ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">State</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>server/NoQuarterState.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½œä¸ºç¤ºä¾‹ï¼Œè¿™é‡Œåªåˆ—å‡ºNoQuarteStateçš„å®žçŽ°</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoQuarterState</span> <span class="keyword">implements</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯¹äºŽStateçš„æ¯ä¸ªå®žçŽ°ï¼Œæˆ‘ä»¬éƒ½åœ¨GumballMachineå®žä¾‹å˜é‡</span></span><br><span class="line">    <span class="comment">// å‰é¢åŠ ä¸Štransientå…³é”®å­—ï¼Œè¿™æ ·å°±å‘Šè¯‰JVMä¸è¦åºåˆ—åŒ–è¿™ä¸ªå­—æ®µã€‚</span></span><br><span class="line">    <span class="keyword">transient</span> GumballMachineRemote machine;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoQuarterState</span><span class="params">(GumballMachineRemote machine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.machine = machine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"waiting for quarter"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¶ä½œè¿œç¨‹å®žçŽ°ï¼š</p><figure class="highlight java"><figcaption><span>server/GumballMachine.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GumballMachineè¦ç»§æ‰¿UnicastRemoteObjectï¼Œä»¥æˆä¸ºä¸€ä¸ªè¿œç¨‹æœåŠ¡ã€‚</span></span><br><span class="line"><span class="comment">// GumballMachineä¹Ÿéœ€è¦å®žçŽ°è¿œç¨‹æŽ¥å£GumballMachineRemoteã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">GumballMachineRemote</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    State noQuarterState;</span><br><span class="line">    State soldOutState;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæœ‰å…¶ä»–çŠ¶æ€ã€‚</span></span><br><span class="line">    State state;</span><br><span class="line">    String location;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æž„é€ å™¨éœ€è¦æŠ›å‡ºRemoteExceptionï¼Œå› ä¸ºè¶…ç±»æ˜¯è¿™ä¹ˆåšçš„ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(String location, <span class="keyword">int</span> count)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">        noQuarterState = <span class="keyword">new</span> NoQuarterState(<span class="keyword">this</span>);</span><br><span class="line">        soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå®žä¾‹åŒ–å…¶ä»–çŠ¶æ€ã€‚</span></span><br><span class="line">        <span class="keyword">this</span>.location = location;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            state = noQuarterState;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            state = soldOutState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;  <span class="comment">// è¿™é‡Œä¸éœ€è¦æ”¹ï¼</span></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œæœ‰å…¶ä»–çš„æ–¹æ³•ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Žç¤ºä¾‹çš„ MyRemoteImpl ä¸åŒï¼Œè¿™æ¬¡å¯ç”¨ä¸€ä¸ªæ–°çš„æµ‹è¯•ç±»ï¼Œç”¨æ¥æ³¨å†Œ GumballMachineã€‚</p><figure class="highlight java"><figcaption><span>server/GumballMachineTestDrive.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachineTestDrive</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GumballMachineRemote gumballMachine = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> count;</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"GumballMachine &lt;IP&gt; &lt;name&gt; &lt;inventory&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count = Integer.parseInt(args[<span class="number">2</span>]);</span><br><span class="line">            gumballMachine = <span class="keyword">new</span> GumballMachine(args[<span class="number">1</span>], count);</span><br><span class="line">            Naming.rebind(<span class="string">"//"</span> + args[<span class="number">0</span>] + <span class="string">"/"</span> + args[<span class="number">1</span>], gumballMachine);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯æ‰€éœ€æ–‡ä»¶åˆ—è¡¨ï¼š</p><figure class="highlight plain"><figcaption><span>server/</span></figcaption><table><tr><td class="code"><pre><span class="line">State.java</span><br><span class="line">SoldOutState.java</span><br><span class="line">NoQuarterState.java</span><br><span class="line">GumballMachineTestDrive.java</span><br><span class="line">GumballMachineRemote.java</span><br><span class="line">GumballMachine.java</span><br></pre></td></tr></table></figure><p>åœ¨ RMI registry ä¸­æ³¨å†Œï¼ˆä¸éœ€è¦ rmicï¼Œæ‰€æœ‰å·¥ä½œï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server admin$ javac *.java</span><br><span class="line">server admin$ rmiregistry</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªç»ˆç«¯</span><br><span class="line">server admin$ java GumballMachineTestDrive 127.0.0.1 A 100</span><br><span class="line"># æ–°å»ºä¸€ä¸ªç»ˆç«¯</span><br><span class="line">server admin$ java GumballMachineTestDrive 127.0.0.1 B 0</span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h2><p>ç›‘è§†å™¨å®žçŽ°ï¼š</p><figure class="highlight java"><figcaption><span>client/GumballMonitor.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitor</span> </span>&#123;</span><br><span class="line">    GumballMachineRemote machine;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¾èµ–è¿œç¨‹æŽ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„GumballMachineç±»ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GumballMonitor</span><span class="params">(GumballMachineRemote machine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.machine = machine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">report</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Gumball Machine: "</span> + machine.getLocation());</span><br><span class="line">            System.out.println(<span class="string">"Current inventory: "</span> + machine.getCount() +</span><br><span class="line">                <span class="string">" gumball"</span> + (machine.getCount() &gt; <span class="number">1</span> ? <span class="string">"s"</span> : <span class="string">""</span>));</span><br><span class="line">            System.out.println(<span class="string">"Current state: "</span> + machine.getState());</span><br><span class="line">        <span class="comment">// å½“æˆ‘ä»¬è¯•å›¾è°ƒç”¨é‚£äº›æœ€ç»ˆè¦é€šè¿‡ç½‘ç»œå‘ç”Ÿçš„æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ•èŽ·æ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„è¿œç¨‹å¼‚å¸¸ã€‚</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMonitorTestDrive</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] location = &#123;<span class="string">"rmi://127.0.0.1/A"</span>,</span><br><span class="line">                             <span class="string">"rmi://127.0.0.1/B"</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç›‘è§†å™¨çš„æ•°ç»„</span></span><br><span class="line">        GumballMonitor[] monitor = <span class="keyword">new</span> GumballMonitor[location.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; location.length; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                GumballMachineRemote machine =</span><br><span class="line">                        (GumballMachineRemote) Naming.lookup(location[i]);</span><br><span class="line">                <span class="comment">// åˆ›å»ºç›‘è§†å™¨ï¼ŒæŠŠè¦ç›‘è§†çš„æœºå™¨ä¼ ç»™å®ƒã€‚</span></span><br><span class="line">                monitor[i] = <span class="keyword">new</span> GumballMonitor(machine);</span><br><span class="line">                System.out.println(monitor[i]);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; monitor.length; i++) &#123;</span><br><span class="line">            monitor[i].report();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">client admin$ cp ../server/GumballMachineRemote.class GumballMachineRemote.class</span><br><span class="line">client admin$ cp ../server/State.class State.class</span><br><span class="line">client admin$ javac *.java          # ç¼–è¯‘ä¾èµ–ä¸Šè¿°ä¸¤ä¸ªæŽ¥å£</span><br><span class="line"></span><br><span class="line">client admin$ cp ../server/NoQuarterState.class NoQuarterState.class</span><br><span class="line">client admin$ cp ../server/SoldOutState.class SoldOutState.class</span><br><span class="line">client admin$ java GumballMonitorTestDrive         # æµ‹è¯•ä¾èµ–ä¸¤ä¸ªå…·ä½“çŠ¶æ€</span><br><span class="line">GumballMonitor@31cefde0</span><br><span class="line">GumballMonitor@7daf6ecc</span><br><span class="line">Gumball Machine: A</span><br><span class="line">Current inventory: 100 gumballs</span><br><span class="line">Current state: waiting for quarter</span><br><span class="line">Gumball Machine: B</span><br><span class="line">Current inventory: 0 gumball</span><br><span class="line">Current state: waiting for refill</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç†æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/proxy-pattern/"/>
      <url>/notes/head-first-design-patterns/proxy-pattern/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç†è¦åšçš„ï¼šæŽ§åˆ¶å’Œç®¡ç†è®¿é—®ã€‚ä½ å°†çœ‹åˆ°ï¼Œä»£ç†çš„æ–¹å¼æœ‰è®¸å¤šç§ã€‚ä»£ç†ä»¥é€šè¿‡ Internet ä¸ºå®ƒä»¬çš„ä»£ç†å¯¹è±¡æ¬è¿çš„æ•´ä¸ªæ–¹æ³•è°ƒç”¨è€Œå‡ºåï¼Œå®ƒä¹Ÿå¯ä»¥ä»£æ›¿æŸäº›æ‡’æƒ°çš„å¯¹è±¡åšä¸€äº›äº‹æƒ…ã€‚</p><h1 id="å®šä¹‰ä»£ç†æ¨¡å¼">å®šä¹‰ä»£ç†æ¨¡å¼</h1><p>ä»£ç†æ¨¡å¼ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«æˆ–å ä½ç¬¦ä»¥æŽ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><p>ä½¿ç”¨ä»£ç†æ¨¡å¼åˆ›å»ºä»£è¡¨ï¼ˆrepresentativeï¼‰å¯¹è±¡ã€‚è®©ä»£è¡¨å¯¹è±¡æŽ§åˆ¶æŸå¯¹è±¡çš„è®¿é—®ï¼Œè¢«ä»£ç†çš„å¯¹è±¡å¯ä»¥æ˜¯è¿œç¨‹çš„å¯¹è±¡ã€åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡æˆ–éœ€è¦å®‰å…¨æŽ§åˆ¶çš„å¯¹è±¡ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaScNcbQGMfIKcfoe4boPbfIQNADZOmCNix1IgkHGKgXEJYakA4fDBQXMAKWjBKujBD3IvQhcISnABYnK2Yl8hAi7AWb8JSs26527OG1bCNSXggz5Km1rIewU7h11L0cml5x8vDhfGmRpyabI5eipqZ1A5_3I8c9N2ivx6PtCweMgVpsfvkcVgyoahtk_fYSbxkh_rnRB6PzEtFTtGzcBzzcSRcrxiNVDyzqoeOW00"><p>Subject ä¸º RealSubject å’Œ Proxy æä¾›äº†æŽ¥å£ã€‚é€šè¿‡å®žçŽ°åŒä¸€æŽ¥å£ï¼ŒProxy åœ¨ RealSubject å‡ºçŽ°çš„åœ°æ–¹å–ä»£å®ƒã€‚</p><p>RealSubject æ˜¯çœŸæ­£åšäº‹çš„å¯¹è±¡ï¼Œå®ƒæ˜¯è¢« Proxy ä»£ç†å’ŒæŽ§åˆ¶è®¿é—®çš„å¯¹è±¡ã€‚</p><p>Proxy æŒæœ‰ RealSubject çš„å¼•ç”¨ã€‚åœ¨æŸäº›ä¾‹å­ä¸­ï¼ŒProxy è¿˜ä¼šè´Ÿè´£ RealSubject å¯¹è±¡çš„åˆ›å»ºä¸Žé”€æ¯ã€‚å®¢æˆ·å’Œ RealSubject çš„äº¤äº’éƒ½å¿…é¡»é€šè¿‡ Proxyã€‚Proxy ä¹ŸæŽ§åˆ¶äº†å¯¹ RealSubject çš„è®¿é—®ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è¿™æ ·çš„æŽ§åˆ¶ã€‚è¿™äº›æƒ…å†µåŒ…æ‹¬ RealSubject æ˜¯è¿œç¨‹å¯¹è±¡ã€RealSubject åˆ›å»ºå¼€é”€å¤§ï¼Œæˆ– RealSubject éœ€è¦è¢«ä¿æŠ¤ã€‚</p><h1 id="è¿œç¨‹ä»£ç†">è¿œç¨‹ä»£ç†</h1><p>è¿œç¨‹ä»£ç†å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ª JVM ä¸Šå¯¹è±¡ç»™çš„æœ¬åœ°ä»£è¡¨ã€‚è°ƒç”¨ä»£ç†çš„æ–¹æ³•ï¼Œä¼šè¢«ä»£ç†åˆ©ç”¨ç½‘ç»œè½¬å‘åˆ°è¿œç¨‹æ‰§è¡Œï¼Œå¹¶ä¸”ç»“æžœä¼šé€šè¿‡ç½‘ç»œè¿”å›žç»™ä»£ç†ï¼Œå†ç”±ä»£ç†å°†ç»“æžœè½¬ç»™å®¢æˆ·ã€‚</p><a href="/notes/head-first-design-patterns/remote-proxy/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><a id="more"></a><img src="http://www.plantuml.com/plantuml/svg/AyxEp2j8B4hCLN3AhmX8J4d9p4jNC3JWIiglu0AAbsGcPnOavfKeEETafkQLe0W55ELNL7AbvgKeW1IZQmXAJSm9BatAIaqkWQk16AAWQmVHQwLGb5fOcbfSeg791HO0oI3fGv870000"><h1 id="è™šæ‹Ÿä»£ç†">è™šæ‹Ÿä»£ç†</h1><p>è™šæ‹Ÿä»£ç†ä½œä¸ºåˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡çš„ä»£è¡¨ã€‚è™šæ‹Ÿä»£ç†ç»å¸¸ç›´åˆ°æˆ‘ä»¬çœŸæ­£éœ€è¦ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™æ‰åˆ›å»ºå®ƒã€‚å½“å¯¹è±¡åœ¨åˆ›å»ºå‰å’Œåˆ›å»ºä¸­æ—¶ï¼Œç”±è™šæ‹Ÿä»£ç†æ¥æ‰®æ¼”å¯¹è±¡çš„æ›¿èº«ã€‚å¯¹è±¡åˆ›å»ºåŽï¼Œä»£ç†å°±ä¼šå°†è¯·æ±‚ç›´æŽ¥å§”æ‰˜ç»™å¯¹è±¡ã€‚</p><a href="/notes/head-first-design-patterns/virtual-proxy/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><img src="http://www.plantuml.com/plantuml/svg/AyxEp2j8B4hCLN3AhmX8J4d9p4jNC3JWAeQB1-MNvgKuvnVbfHOfc78bvLTm0SLBCfCp2nBpIXISSp9JyqfGX0AAyYigKKI2KXDpWakJibAJIxXIyr8KG8RavPUaAkIN0Gr5ahL2vZnTl_F5neKnUSzdjJpjcFrqzwwdUnfUJcbukcGv5yHM1LqxY6LM2aMfXQMfnIKQcbnW0P0CYh5Fvwnukh_rnRB6PzEtlT_J0p4FISNZXgQOlAVBcfxDcuFiWksRdk_kXoX-igiDg16eQCF6PrrTBzPlVxQnwUdoASywPppVFHFL9000"><h1 id="ä¿æŠ¤ä»£ç†">ä¿æŠ¤ä»£ç†</h1><p>ä¿æŠ¤ä»£ç†åŸºäºŽæƒé™æŽ§åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚</p><a href="/notes/head-first-design-patterns/protection-proxy/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h1 id="å…¶ä»–ä»£ç†">å…¶ä»–ä»£ç†</h1><table><colgroup><col style="width: 22%"><col style="width: 44%"><col style="width: 33%"></colgroup><thead><tr class="header"><th>ä»£ç†</th><th>æè¿°</th><th>æ –æ¯åœ°</th></tr></thead><tbody><tr class="odd"><td>é˜²ç«å¢™ä»£ç†ï¼ˆFirewall Proxyï¼‰</td><td>æŽ§åˆ¶ç½‘ç»œèµ„æºçš„è®¿é—®ï¼Œä¿æŠ¤ä¸»é¢˜å…äºŽâ€œåå®¢æˆ·â€çš„ä¾µå®³ã€‚</td><td>å…¬å¸çš„é˜²ç«å¢™ç³»ç»Ÿ</td></tr><tr class="even"><td>æ™ºèƒ½å¼•ç”¨ä»£ç†ï¼ˆSmart Reference Proxyï¼‰</td><td>å½“ä¸»é¢˜è¢«å¼•ç”¨æ—¶ï¼Œè¿›è¡Œé¢å¤–çš„åŠ¨ä½œï¼Œä¾‹å¦‚è®¡ç®—ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚</td><td>åžƒåœ¾æ”¶é›†å™¨</td></tr><tr class="odd"><td>ç¼“å­˜ä»£ç†ï¼ˆCaching Proxyï¼‰</td><td>ä¸ºå¼€é”€å¤§çš„è¿ç®—ç»“æžœæä¾›æš‚æ—¶å­˜å‚¨ï¼Œå®ƒä¹Ÿå…è®¸å¤šä¸ªå®¢æˆ·å…±äº«ç»“æžœï¼Œä»¥å‡å°‘è®¡ç®—æˆ–ç½‘ç»œå»¶è¿Ÿã€‚</td><td>WebæœåŠ¡å™¨ä»£ç†ï¼Œå†…å®¹ç®¡ç†ä¸Žå‡ºç‰ˆç³»ç»Ÿ</td></tr><tr class="even"><td>åŒæ­¥ä»£ç†ï¼ˆSynchronization Proxyï¼‰</td><td>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¸ºä¸»é¢˜æä¾›å®‰å…¨çš„è®¿é—®ã€‚</td><td>å‡ºæ²¡äºŽJavaSpacesï¼Œä¸ºåˆ†æ•£å¼çŽ¯å¢ƒå†…çš„æ½œåœ¨å¯¹è±¡é›†åˆæä¾›åŒæ­¥è®¿é—®æŽ§åˆ¶ã€‚</td></tr><tr class="odd"><td>å¤æ‚éšè—ä»£ç†ï¼ˆComplexity Hiding Proxyï¼‰</td><td>ç”¨æ¥éšè—ä¸€ä¸ªç±»çš„å¤æ‚é›†åˆçš„å¤æ‚åº¦ï¼Œå¹¶è¿›è¡Œè®¿é—®æŽ§åˆ¶ã€‚æœ‰æ—¶å€™ä¹Ÿç§°ä¸ºå¤–è§‚ä»£ç†ï¼ˆFacade Proxyï¼‰ï¼Œè¿™ä¸éš¾ç†è§£ã€‚å¤æ‚éšè—ä»£ç†å’Œå¤–è§‚æ¨¡å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºä»£ç†æŽ§åˆ¶è®¿é—®ï¼Œè€Œå¤–è§‚æ¨¡å¼åªæä¾›å¦ä¸€ç»„æŽ¥å£ã€‚</td><td></td></tr><tr class="even"><td>å†™å…¥æ—¶å¤åˆ¶ä»£ç†ï¼ˆCopy-On-Write Proxyï¼‰</td><td>ç”¨æ¥æŽ§åˆ¶å¯¹è±¡çš„å¤åˆ¶ï¼Œæ–¹æ³•æ˜¯å»¶è¿Ÿå¯¹è±¡çš„å¤åˆ¶ï¼Œç›´åˆ°å®¢æˆ·çœŸçš„éœ€è¦ä¸ºæ­¢ã€‚è¿™æ˜¯è™šæ‹Ÿä»£ç†çš„å˜ä½“ã€‚</td><td>Java 5 çš„ CopyOnWriteArrayList</td></tr></tbody></table><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>ä»£ç†æ¨¡å¼ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä»£è¡¨ï¼Œä»¥ä¾¿æŽ§åˆ¶å®¢æˆ·å¯¹å¯¹è±¡çš„è®¿é—®ï¼Œç®¡ç†è®¿é—®çš„æ–¹å¼æœ‰è®¸å¤šç§ã€‚</li><li>è¿œç¨‹ä»£ç†ç®¡ç†å®¢æˆ·å’Œè¿œç¨‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’ã€‚</li><li>è™šæ‹Ÿä»£ç†æŽ§åˆ¶è®¿é—®å®žä¾‹åŒ–å¼€é”€å¤§çš„å¯¹è±¡ã€‚</li><li>ä¿æŠ¤ä»£ç†åŸºäºŽè°ƒç”¨è€…æŽ§åˆ¶å¯¹è±¡æ–¹æ³•çš„è®¿é—®ã€‚</li><li>ä»£ç†æ¨¡å¼æœ‰è®¸å¤šå˜ä½“ï¼Œä¾‹å¦‚ï¼šç¼“å­˜ä»£ç†ã€åŒæ­¥ä»£ç†ã€é˜²ç«å¢™ä»£ç†å’Œå†™å…¥æ—¶å¤åˆ¶ä»£ç†ã€‚</li><li>ä»£ç†åœ¨ç»“æž„ä¸Šç±»ä¼¼è£…é¥°è€…ï¼Œä½†æ˜¯ç›®çš„ä¸åŒã€‚</li><li>è£…é¥°è€…æ¨¡å¼ä¸ºå¯¹è±¡åŠ ä¸Šè¡Œä¸ºï¼Œè€Œä»£ç†åˆ™æ˜¯æŽ§åˆ¶è®¿é—®ã€‚</li><li>Java å†…ç½®çš„ä»£ç†æ”¯æŒï¼Œå¯ä»¥æ ¹æ®éœ€è¦å»ºç«‹åŠ¨æ€ä»£ç†ï¼Œå¹¶å°†æ‰€æœ‰è°ƒç”¨åˆ†é…åˆ°æ‰€é€‰çš„å¤„ç†å™¨ã€‚</li><li>å°±å’Œå…¶ä»–çš„åŒ…è£…ç€ï¼ˆwrapperï¼‰ä¸€æ ·ï¼Œä»£ç†ä¼šé€ æˆä½ çš„è®¾è®¡ä¸­ç±»çš„æ•°ç›®å¢žåŠ ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŠ¶æ€æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/state-pattern/"/>
      <url>/notes/head-first-design-patterns/state-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥ç³–æžœæœº">å¯¼å…¥ï¼šç³–æžœæœº</h1><p>æˆ‘ä»¬è®¤ä¸ºç³–æžœæœºçš„æŽ§åˆ¶å™¨éœ€è¦å¦‚ä¸‹å›¾èˆ¬çš„å·¥ä½œã€‚å¸Œæœ›ä½ èƒ½ç”¨ Java è¯­è¨€å¸®æˆ‘ä»¬å®žçŽ°å®ƒï¼Œè€Œä¸”éœ€è¦è®©è®¾è®¡èƒ½å¤Ÿå°½é‡æœ‰å¼¹æ€§è€Œä¸”å¥½ç»´æŠ¤ï¼Œå› ä¸ºå°†æ¥æˆ‘ä»¬å¯èƒ½è¦ä¸ºå®ƒå¢žåŠ æ›´å¤šçš„è¡Œä¸ºã€‚</p><img src="http://www.plantuml.com/plantuml/svg/Aov9B4bLK7gsQU6pEPr6fayxsbvEsgYaa5Yia9SVNrYQM5IIMiHL35M4fY8ZiHYe91LPoTCfwvwsxtg-UTgpUNF0QehpSr9WaX1Xe9BdUrlWal7vfILSI2OfwDeXMMsbyBAXuUdiUJ1xkH1I88L8-gmKddLDVTgw5AuInKoWMf1bLWelzgvvshNYsUnDp-QtS8645A1I87TOAK2S-6pgXkUprzaQG1MK5g2v2LcLdG40"><h1 id="çŠ¶æ€æœº-101">çŠ¶æ€æœº 101</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD_OUT = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NO_QUARTER = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> HAS_QUARTER = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD = <span class="number">3</span>;  <span class="comment">// å››ä¸ªçŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> state = SOLD_OUT;       <span class="comment">// å½“å‰çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;              <span class="comment">// ç³–æžœæ•°é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            state = NO_QUARTER;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;  <span class="comment">// æŠ•å…¥25åˆ†é’±</span></span><br><span class="line">        <span class="comment">// åˆ©ç”¨æ¡ä»¶è¯­å¥å†³å®šåœ¨æ¯ä¸ªçŠ¶æ€å†…ä»€ä¹ˆè¡Œä¸ºæ˜¯æ°å½“çš„</span></span><br><span class="line">        <span class="keyword">if</span> (state == HAS_QUARTER) &#123;</span><br><span class="line">            System.out.println(<span class="string">"You can't insert another quarter"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == NO_QUARTER) &#123;</span><br><span class="line">            state = HAS_QUARTER;</span><br><span class="line">            System.out.println(<span class="string">"You inserted a quarter"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD_OUT) &#123;</span><br><span class="line">            System.out.println(<span class="string">"You can't insert a quarter, the machine is sold out"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == SOLD) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Please wait, we're already giving you a gumball"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123; <span class="comment">/* é€€å›ž25åˆ†é’± */</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123; <span class="comment">/* è½¬åŠ¨æ›²æŸ„ */</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123; <span class="comment">/* å‘æ”¾ç³–æžœ */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¯¥æ¥çš„èº²ä¸æŽ‰å˜æ›´è¯·æ±‚">è¯¥æ¥çš„èº²ä¸æŽ‰ï¼šå˜æ›´è¯·æ±‚</h1><p>æˆ‘ä»¬è®¤ä¸ºï¼Œå°†â€œè´­ä¹°ç³–æžœâ€å˜æˆæ˜¯ä¸€ä¸ªæ¸¸æˆï¼Œå¯ä»¥å¤§å¤§åœ°å¢žåŠ æˆ‘ä»¬çš„é”€å”®é‡ã€‚å½“æ›²æŸ„è¢«è½¬åŠ¨æ—¶ï¼Œæœ‰ 10% çš„å‡ çŽ‡æŽ‰ä¸‹æ¥çš„æ˜¯ä¸¤é¢—ç³–æžœã€‚å½“ä¸ªèµ¢å®¶ï¼10 äººæœ‰ 1 äººå¯ä»¥å¾—åˆ°å…è´¹ç³–æžœã€‚</p><a id="more"></a><img src="http://www.plantuml.com/plantuml/svg/Aov9B4bLK7gsQU6pEPr6fayxsbvEsgYaa5Yia9SVNrYQM5IIMiHL35M4fY8ZiHYe91LPoTCfwvwsxtg-UTgpUNF0QehpSr9WaX1Xe9BdUrlWal7vfIKm1I-sBdgwRXjOgZmpBo-ro4hXQV_4PrFsFTcnvEMYwH3zN4ZMAkZQ8RdJIk5bGyFJsVDWZkH2I84K8kcpKdZMDVLfwrAuIXGpWMfXrh_Ok-PfrufdipSzcz_oVayFq85FThLXg0Rv0qCjC4Y1ohb0Sd158CzQAK3yyMpgXkUprzaQG5MK5g3v1LcLdG4Nn4NuJOAf8M0M0000"><p>ä½¿ç”¨ä¸€ç§è€ƒè™‘å‘¨è¯¦çš„æ–¹æ³•ç¼–å†™ç³–æžœæœºçš„ä»£ç ï¼Œå¹¶ä¸æ„å‘³ç€è¿™ä»½ä»£ç å°±å®¹æ˜“æ‰©å±•ã€‚äº‹å®žä¸Šï¼Œå½“ä½ å›žé¡¾è¿™äº›ä»£ç ï¼Œå¹¶å¼€å§‹è€ƒè™‘è¦å¦‚ä½•ä¿®æ”¹å®ƒæ—¶â€¦â€¦</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD_OUT = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NO_QUARTER = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> HAS_QUARTER = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SOLD = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// é¦–å…ˆï¼Œä½ å¿…é¡»åŠ ä¸Šä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œç§°ä¸ºâ€œèµ¢å®¶â€ã€‚è¿™è¿˜ä¸ç®—å¤ªéº»çƒ¦â€¦â€¦</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123; <span class="comment">/*æŠ•å¸ä»£ç */</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123; <span class="comment">/*é€€å¸ä»£ç */</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123; <span class="comment">/*è½¬åŠ¨æ›²æŸ„ä»£ç */</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123; <span class="comment">/*å‘æ”¾ç³–æžœä»£ç */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç„¶åŽå‘¢ï¼Œä½ å¿…é¡»åœ¨æ¯ä¸ªæ–¹æ³•ä¸­åŠ å…¥ä¸€ä¸ªæ–°çš„æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line"><span class="comment">// æ¥å¤„ç†â€œèµ¢å®¶â€œçŠ¶æ€ï¼šè¿™å¯æœ‰ä½ å¿™çš„äº†ã€‚</span></span><br><span class="line"><span class="comment">// turnCrank()å°¤å…¶ä¼šå˜å¾—ä¸€å›¢ä¹±ï¼Œå› ä¸ºä½ å¿…é¡»åŠ ä¸Šä»£ç </span></span><br><span class="line"><span class="comment">// æ¥æ£€æŸ¥ç›®å‰çš„é¡¾å®¢æ˜¯å¦æ˜¯èµ¢å®¶ï¼Œç„¶åŽå†å†³å®šæ˜¯åˆ‡æ¢åˆ°</span></span><br><span class="line"><span class="comment">// èµ¢å®¶çŠ¶æ€è¿˜æ˜¯å”®å‡ºç³–æžœçŠ¶æ€ã€‚</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®žçŽ°çš„çŠ¶æ€ï¼š</p><ul><li>ä»£ç æ²¡æœ‰éµå®ˆå¼€æ”¾-å…³é—­åŽŸåˆ™ã€‚</li><li>è®¾è®¡å…¶å®žä¸ç¬¦åˆé¢å‘å¯¹è±¡ã€‚</li><li>çŠ¶æ€è½¬æ¢è¢«åŸ‹è—åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œæ‰€ä»¥å¹¶ä¸æ˜Žæ˜¾ã€‚</li><li>æ²¡æœ‰æŠŠä¼šæ”¹å˜çš„é‚£éƒ¨åˆ†åŒ…è£…èµ·æ¥ã€‚</li><li>æœªæ¥åŠ å…¥çš„ä»£ç å¾ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´ bugã€‚</li></ul><h1 id="æ–°çš„è®¾è®¡">æ–°çš„è®¾è®¡</h1><p>æˆ‘ä»¬çš„è®¡åˆ’æ˜¯è¿™æ ·çš„ï¼šä¸è¦ç»´æŠ¤æˆ‘ä»¬çŽ°æœ‰çš„ä»£ç ï¼Œæˆ‘ä»¬é‡å†™å®ƒä»¥ä¾¿äºŽå°†çŠ¶æ€å¯¹è±¡å°è£…åœ¨å„è‡ªçš„ç±»æ€»ï¼Œç„¶åŽåœ¨åŠ¨ä½œå‘ç”Ÿæ—¶å§”æ‰˜ç»™å½“å‰çŠ¶æ€ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/lLF1RjD04BtxArOzbKDRzOgY7E005q2e1ow-REo1cDhhohi6eHB98I0QLDLK2X5AGoLK8I4acbGLg2bj-HZYjNlgBx3EkexjkDTSREkzqNiputbrGmS4rWPxXIomQk0ezHZH34SpGJ480-SfrW2jCSm0LIefKgsYJGMXJLoZpC4QQo23K73OOnSxecJnLfw4vw3Tn37N8NSTJDQBX6xG3H2g0cyeceafHMksgSjUOlTxhbN3fla0QtM30BBaMn2plSmqa7UzmUgHo-Razj1EokVaTn_J-He-CGYPcrb1FFQJpZJvgU8xnKXkzIbSpsye9v57Nav7KwPbIOb83D9ibp3n_S8sz9Bv9l3Ca1CqF-a4eY1lSZ7Zav8Ec80ft173opHPmEgsta0hA-WPCA4T_cppxeWVVnBBIbBzUdbv6gmYU1s1B9u_rYnJEAiibJa0PHhZoj9IjV2xRgFmms_kDOF1A3hwEhxu4ltgXiTTlj_d_TEhissLN7gzwE_xQDWAEzzJ9koz7PzuuzCzEPvAU6SK-9-b5j_g1lukxrp8yd_U6oMNx_8shgMJ7jgZuB2d4gbuTTRZsqtUR_Es9vug2Vn1r3eNNKW-jYY4kiH4AUQmh2ORdJAUs89Ou0D_VF93cb-speDXCpfunxS-gYHUYs2E_eZboQgOFzmFTuOgcSZodM-1Vo1QNa2O8hAga5MKFOh_"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoQuarterState</span> <span class="keyword">implements</span> </span>&#123; <span class="comment">// å…¶ä»–çŠ¶æ€ç±»ç±»ä¼¼</span></span><br><span class="line">    GumballMachine machine;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NoQuarterState</span><span class="params">(GumballMachine machine)</span> </span>&#123;  <span class="comment">// ä¼ å…¥ç³–æžœæœºçš„å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">this</span>.machine = machine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"You inserted a quarter"</span>);</span><br><span class="line">        machine.setState(machine.getHasQuarterState());  <span class="comment">// æ”¹å˜æœºå™¨çŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"You haven't inserted a quarter"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123; <span class="comment">/*çœç•¥*/</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispense</span><span class="params">()</span> </span>&#123; <span class="comment">/*çœç•¥*/</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GumballMachine</span> </span>&#123;</span><br><span class="line">    State soldOutState;</span><br><span class="line">    <span class="comment">// å…¶ä»–çŠ¶æ€</span></span><br><span class="line">    State state = soldOutState;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GumballMachine</span><span class="params">(<span class="keyword">int</span> numberGumballs)</span> </span>&#123;</span><br><span class="line">        soldOutState = <span class="keyword">new</span> SoldOutState(<span class="keyword">this</span>);  <span class="comment">// åˆ›å»ºçŠ¶æ€å®žä¾‹ï¼Œå¹¶ä¼ å…¥æ­¤æœºå™¨çš„å¼•ç”¨</span></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å…¶ä»–çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">this</span>.count = numberGumballs;</span><br><span class="line">        <span class="keyword">if</span> (numberGumballs &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            state = noQuarterState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.insertQuarter();  <span class="comment">// å§”æ‰˜ç»™å½“å‰çŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ejectQuarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.ejectQuarter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ä¸éœ€è¦åœ¨GumballMachineä¸­å‡†å¤‡ä¸€ä¸ªdispense()çš„åŠ¨ä½œæ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">// å› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªå†…éƒ¨çš„åŠ¨ä½œï¼šç”¨æˆ·ä¸å¯ä»¥ç›´æŽ¥è¦æ±‚æœºå™¨å‘æ”¾ç³–æžœã€‚</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬æ˜¯åœ¨turnCrank()æ–¹æ³•ä¸­è°ƒç”¨å½“å‰çŠ¶æ€å¯¹è±¡çš„dispense()æ–¹æ³•çš„ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnCrank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.turnCrank();</span><br><span class="line">        state.dispense();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;  <span class="comment">// å…è®¸çŠ¶æ€å¯¹è±¡æ”¹å˜æœºå™¨çš„å½“å‰çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">releaseBall</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A gumball comes rolling out the slot..."</span>);</span><br><span class="line">        <span class="keyword">if</span> (count != <span class="number">0</span>) &#123;</span><br><span class="line">            count--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getterç­‰å…¶ä»–æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®</strong>ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ WinnerStateï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æŽ¥åœ¨ SoldState ä¸­å‘æ”¾ä¸¤é¢—ç³–æžœï¼Ÿ</p><p><strong>ç­”</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ã€‚è¿™ä¸¤ä¸ªçŠ¶æ€å‡ ä¹Žä¸€æ ·ï¼Œå”¯ä¸€çš„å·®åˆ«åœ¨äºŽï¼ŒWinnerState çŠ¶æ€ä¼šå‘æ”¾ä¸¤é¢—ç³–æžœã€‚ä½ å½“ç„¶å¯ä»¥å°†å‘æ”¾ä¸¤é¢—ç³–æžœçš„ä»£ç æ”¾åœ¨ SoldState ä¸­ï¼Œå½“ç„¶è¿™ä¹ˆåšæœ‰ç¼ºç‚¹ï¼Œå› ä¸ºä½ ç­‰äºŽæ˜¯å°†ä¸¤ä¸ªçŠ¶æ€ç”¨ä¸€ä¸ªçŠ¶æ€ç±»æ¥ä»£è¡¨ã€‚è¿™æ ·åšä½ ç‰ºç‰²äº†çŠ¶æ€ç±»çš„æ¸…æ™°æ˜“æ‡‚æ¥å‡å°‘ä¸€äº›å†—ä½™ä»£ç ã€‚ä½ ä¹Ÿåº”è¯¥è€ƒè™‘åˆ°ï¼šä¸€ä¸ªç±»ï¼Œä¸€ä¸ªè´£ä»»ã€‚å°† WinnerState çŠ¶æ€çš„è´£ä»»æ”¾è¿› SoldState çŠ¶æ€ä¸­ï¼Œç­‰äºŽæ˜¯è®© SoldState çŠ¶æ€å…·æœ‰ä¸¤ä¸ªè´£ä»»ã€‚é‚£ä¹ˆä¿ƒé”€æ–¹æ¡ˆç»“æŸåŽæˆ–è€…èµ¢å®¶çš„å‡ çŽ‡æ”¹å˜ä¹‹åŽï¼Œä½ åˆè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¿™å¿…é¡»ç”¨ä½ çš„æ™ºæ…§æ¥åšæŠ˜è¡·ã€‚</p><p>ä½ çŽ°åœ¨æœ‰äº†ä¸€ä¸ªç³–æžœæœºçš„å®žçŽ°ï¼Œå®ƒåœ¨ç»“æž„ä¸Šå’Œå‰ä¸€ä¸ªç‰ˆæœ¬å·®å¼‚é¢‡å¤§ï¼Œä½†æ˜¯åŠŸèƒ½ä¸Šå´æ˜¯ä¸€æ ·çš„ã€‚é€šè¿‡ä»Žç»“æž„ä¸Šæ”¹å˜å®žçŽ°ï¼Œä½ å·²ç»åšåˆ°äº†ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å°†æ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºå±€éƒ¨åŒ–åˆ°å®ƒè‡ªå·±çš„ç±»ä¸­ã€‚</li><li>å°†å®¹æ˜“äº§ç”Ÿé—®é¢˜çš„ if è¯­å¥åˆ é™¤ï¼Œä»¥æ–¹ä¾¿æ—¥åŽçš„ç»´æŠ¤ã€‚</li><li>è®©æ¯ä¸€ä¸ªçŠ¶æ€â€œå¯¹ä¿®æ”¹å…³é—­â€ï¼Œè®©ç³–æžœæœºâ€œå¯¹æ‰©å±•å¼€æ”¾â€ï¼Œå› ä¸ºå¯ä»¥åŠ å…¥æ–°çš„çŠ¶æ€ç±»ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç åŸºå’Œç±»ç»“æž„ï¼Œæ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ã€‚</li></ul><p>åœ¨æŽ¨å‡ºæˆ‘ä»¬çš„é»„é‡‘ç‰ˆæœ¬ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å†æ£€æŸ¥çœ‹çœ‹ GumballMachine è¿˜æœ‰å“ªäº›æ–¹é¢éœ€è¦æ”¹è¿›ï¼š</p><ul><li>æˆ‘ä»¬åœ¨å”®å‡ºç³–æžœå’Œèµ¢å®¶çŠ¶æ€ä¸­ï¼Œæœ‰è®¸å¤šé‡å¤çš„ä»£ç ã€‚æˆ‘ä»¬å¿…é¡»æŠŠè¿™éƒ¨åˆ†æ¸…ç†ä¸€ä¸‹ã€‚è¦æ€Žä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠ State è®¾è®¡æˆæŠ½è±¡ç±»ï¼Œç„¶åŽæŠŠæ–¹æ³•çš„é»˜è®¤è¡Œä¸ºæ”¾åœ¨å…¶ä¸­ï¼›æ¯•ç«Ÿï¼Œåƒæ˜¯â€œä½ å·²ç»æŠ•å…¥ 25 åˆ†é’±â€è¿™ç±»çš„æ¶ˆæ¯ï¼Œä¸ä¼šè¢«é¡¾å®¢çœ‹è§ã€‚æ‰€ä»¥ï¼Œæ‰€æœ‰çš„â€œé”™è¯¯å“åº”â€è¡Œä¸ºéƒ½å¯ä»¥å†™çš„å…·æœ‰é€šç”¨æ€§ï¼Œå¹¶æ”¾åœ¨æŠ½è±¡çš„ State ç±»ä¸­ä¾›å­ç±»ç»§æ‰¿ã€‚</li><li><code>dispense()</code> æ–¹æ³•å³ä½¿æ˜¯åœ¨æ²¡æœ‰ 25 åˆ†é’±æ—¶æ›²æŸ„è¢«è½¬åŠ¨çš„æƒ…å†µä¸‹ä¹Ÿæ€»æ˜¯ä¼šè¢«è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°ä¿®æ”¹è¿™éƒ¨åˆ†ï¼Œåšæ³•æ˜¯è®© <code>turnCrank()</code> è¿”å›žä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæˆ–è€…å¼•å…¥å¼‚å¸¸ã€‚</li><li>çŠ¶æ€è½¬æ¢çš„æ‰€æœ‰æ™ºèƒ½è¢«æ”¾åœ¨çŠ¶æ€ç±»ä¸­ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆç±»çš„æ•°ç›®å¢žå¤šï¼‰æˆ‘ä»¬è¦å°†é€»è¾‘ç§»è¿›ç³–æžœæœºä¸­å—ï¼Ÿè¿™æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿï¼ˆè¿åå¼€æ”¾-å…³é—­åŽŸåˆ™ï¼Œè¯¦ç»†è§£é‡Šè§é—®ç­”ä¸€èŠ‚ï¼‰</li><li>ä½ ä¼šå®žä¾‹åŒ–è®¸å¤šçš„ GumballMachine å¯¹è±¡å—ï¼Ÿå¦‚æžœæ˜¯çš„è¯ï¼Œä½ å¯èƒ½æƒ³è¦å°†çŠ¶æ€çš„å®žä¾‹è½¬ç§»åˆ°é™æ€çš„å®žä¾‹å˜é‡ä¸­å…±äº«ã€‚è¿™éœ€è¦å¯¹ GumballMachine å’Œ State åšæ€Žæ ·çš„æ”¹å˜ï¼Ÿï¼ˆState ä¸èƒ½æ‹¥æœ‰å†…éƒ¨çŠ¶æ€ï¼Œå³ç³–æžœæœºï¼Œåªæä¾›è¡Œä¸ºã€‚GumballMachine å§”æ‰˜è¡Œä¸ºæ—¶è¦ä¼ å…¥è‡ªå·±çš„å¼•ç”¨ï¼Œè¯¦ç»†è§£é‡Šè§é—®ç­”ä¸€èŠ‚ï¼‰</li></ul><h1 id="å®šä¹‰çŠ¶æ€æ¨¡å¼">å®šä¹‰çŠ¶æ€æ¨¡å¼</h1><p>çŠ¶æ€æ¨¡å¼å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚</p><p>åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼šè¿™ä¸ªæ¨¡å¼å°†çŠ¶æ€å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œå¹¶å°†åŠ¨ä½œå§”æ‰˜åˆ°ä»£è¡¨å½“å‰çŠ¶æ€çš„å¯¹è±¡ï¼Œæˆ‘ä»¬çŸ¥é“è¡Œä¸ºä¼šéšç€å†…éƒ¨çŠ¶æ€è€Œæ”¹å˜ã€‚</p><p>å¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ï¼šä»Žå®¢æˆ·çš„è§†è§’æ¥çœ‹ï¼Œå¦‚æžœè¯´ä½ ä½¿ç”¨çš„å¯¹è±¡èƒ½å¤Ÿå®Œå…¨æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½ ä¼šè§‰å¾—ï¼Œè¿™ä¸ªå¯¹è±¡å®žé™…ä¸Šæ˜¯ä»Žåˆ«çš„ç±»å®žä¾‹åŒ–è€Œæ¥çš„ã€‚ç„¶è€Œï¼Œå®žé™…ä¸Šï¼Œä½ çŸ¥é“æˆ‘ä»¬æ˜¯åœ¨ä½¿ç”¨ç»„åˆé€šè¿‡ç®€å•å¼•ç”¨ä¸åŒçš„çŠ¶æ€å¯¹è±¡æ¥é€ æˆç±»æ”¹å˜çš„å‡è±¡ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VSv12i8m40NG_PnYbhg85r04wn4yGJhza49IDHd1KdDtsvHiXBeR_dy3t_KT6E6X8mU45f7SaaWVnODicpHQKRwfLV14p5FDCZixT1wxFMKIRrFYwtsG24NHbyB_csRJADvQoeZd2sc-EIqVXugFd6TVfJcl4saTUleOyxDcisc-"><h1 id="çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼">çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼</h1><p><strong>ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„ç±»å›¾æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸¤ä¸ªæ¨¡å¼çš„å·®åˆ«åœ¨äºŽå®ƒä»¬çš„â€œæ„å›¾â€ã€‚</strong></p><img src="http://www.plantuml.com/plantuml/svg/XOyn3eCm34NtdC8Z3EK2HP5AZz0JXDGKfAH4naEZaBit80XIEx1Pt_zzV_V34m6jOmyMROia-aNH0sc3GXirJN0VtumVXY007aoAyULXseQaEQHk95kK4B9SAUUCByehH175a0AeKneFlgwpAEKQ7LIxq9eZR70YSmDDoBZJjnKuSpK_hlsFYymrnD5dhgh_EoVxvWi0"><p>ä»¥çŠ¶æ€æ¨¡å¼è€Œè¨€ï¼Œæˆ‘ä»¬å°†ä¸€ç¾¤è¡Œä¸ºå°è£…åœ¨çŠ¶æ€å¯¹è±¡ä¸­ï¼Œcontext çš„è¡Œä¸ºéšæ—¶å¯å§”æ‰˜åˆ°é‚£äº›çŠ¶æ€ä¸­çš„ä¸€ä¸ªã€‚éšç€æ—¶é—´çš„æµé€ï¼Œå½“å‰çŠ¶æ€åœ¨çŠ¶æ€å¯¹è±¡é›†åˆä¸­æ¸¸èµ°æ”¹å˜ï¼Œä»¥åæ˜ å‡º context å†…éƒ¨çš„çŠ¶æ€ï¼Œå› æ­¤ï¼Œcontext çš„è¡Œä¸ºä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚ä½†æ˜¯ context çš„å®¢æˆ·å¯¹äºŽçŠ¶æ€å¯¹è±¡äº†è§£ä¸å¤šï¼Œç”šè‡³æ ¹æœ¬æ˜¯æµ‘ç„¶ä¸è§‰ã€‚</p><p>è€Œä»¥ç­–ç•¥æ¨¡å¼è€Œè¨€ï¼Œå®¢æˆ·é€šå¸¸ä¸»åŠ¨æŒ‡å®š Context æ‰€è¦ç»„åˆçš„ç­–ç•¥å¯¹è±¡æ˜¯å“ªä¸€ä¸ªã€‚çŽ°åœ¨ï¼Œå›ºç„¶ç­–ç•¥æ¨¡å¼è®©æˆ‘ä»¬å…·æœ‰å¼¹æ€§ï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ”¹å˜ç­–ç•¥ï¼Œä½†å¯¹äºŽæŸä¸ª context å¯¹è±¡æ¥è¯´ï¼Œé€šå¸¸éƒ½åªæœ‰ä¸€ä¸ªæœ€é€‚å½“çš„ç­–ç•¥å¯¹è±¡ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬<strong>æŠŠç­–ç•¥æ¨¡å¼æƒ³æˆæ˜¯é™¤äº†ç»§æ‰¿ä¹‹å¤–çš„ä¸€ç§å¼¹æ€§æ›¿ä»£æ–¹æ¡ˆ</strong>ã€‚å¦‚æžœä½ ä½¿ç”¨ç»§æ‰¿å®šä¹‰äº†ä¸€ä¸ªç±»çš„è¡Œä¸ºï¼Œä½ å°†è¢«è¿™ä¸ªè¡Œä¸ºå›°ä½ï¼Œç”šè‡³è¦ä¿®æ”¹å®ƒéƒ½å¾ˆéš¾ã€‚æœ‰äº†ç­–ç•¥æ¨¡å¼ï¼Œä½ å¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„å¯¹è±¡æ¥æ”¹å˜è¡Œä¸ºã€‚</p><p>æˆ‘ä»¬<strong>æŠŠçŠ¶æ€æ¨¡å¼æƒ³æˆæ˜¯ä¸ç”¨åœ¨ context ä¸­æ”¾ç½®è®¸å¤šæ¡ä»¶åˆ¤æ–­çš„æ›¿ä»£æ–¹æ¡ˆ</strong>ã€‚é€šè¿‡å°†è¡Œä¸ºåŒ…è£…è¿›çŠ¶æ€å¯¹è±¡ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ context å†…ç®€å•åœ°æ”¹å˜çŠ¶æ€å¯¹è±¡æ¥æ”¹å˜ context çš„è¡Œä¸ºã€‚</p><h1 id="é—®ç­”">é—®ç­”</h1><ul><li><p><strong>é—®</strong>ï¼šåœ¨ GumballMachine ä¸­ï¼ŒçŠ¶æ€å†³å®šäº†ä¸‹ä¸€ä¸ªçŠ¶æ€åº”è¯¥æ˜¯ä»€ä¹ˆã€‚ConcreteState æ€»æ˜¯å†³å®šæŽ¥ä¸‹æ¥çš„çŠ¶æ€æ˜¯ä»€ä¹ˆå—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸ï¼Œå¹¶éžæ€»æ˜¯å¦‚æ­¤ï¼ŒContext ä¹Ÿå¯ä»¥å†³å®šçŠ¶æ€è½¬æ¢çš„æµå‘ã€‚</p><p><strong>ä¸€èˆ¬æ¥è®²ï¼Œå½“çŠ¶æ€è½¬æ¢æ˜¯å›ºå®šçš„æ—¶å€™ï¼Œå°±é€‚åˆæ”¾åœ¨ Contextä¸­ï¼›ç„¶è€Œï¼Œå½“è½¬æ¢æ˜¯æ›´åŠ¨æ€çš„æ—¶å€™ï¼Œé€šå¸¸å°±ä¼šæ”¾åœ¨çŠ¶æ€ç±»ä¸­</strong>ã€‚</p><p><strong>å°†çŠ¶æ€è½¬æ¢æ”¾åœ¨çŠ¶æ€ç±»ä¸­çš„ç¼ºç‚¹æ˜¯ï¼šçŠ¶æ€ç±»ä¹‹é—´äº§ç”Ÿäº†ä¾èµ–</strong>ã€‚åœ¨æˆ‘ä»¬çš„ GumballMachine å®žçŽ°ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾é€šè¿‡ä½¿ç”¨ Context ä¸Šçš„ getter æ–¹æ³•æŠŠä¾èµ–å‡åˆ°æœ€å°ï¼Œè€Œä¸æ˜¯æ˜¾å¼ç¡¬ç¼–ç å…·ä½“çŠ¶æ€ç±»ã€‚</p><p>è¯·æ³¨æ„ï¼Œ<strong>åœ¨åšè¿™ä¸ªå†³ç­–çš„åŒæ—¶ï¼Œä¹Ÿç­‰äºŽæ˜¯åœ¨ä¸ºå¦ä¸€ä»¶äº‹æƒ…åšå†³ç­–ï¼šå½“ç³»ç»Ÿè¿›åŒ–æ—¶ï¼Œç©¶ç«Ÿå“ªä¸ªç±»æ˜¯å¯¹ä¿®æ”¹å°é—­ï¼ˆContext è¿˜æ˜¯çŠ¶æ€ç±»ï¼‰çš„</strong>ã€‚</p></li><li><p><strong>é—®</strong>ï¼šå®¢æˆ·ä¼šç›´æŽ¥å’ŒçŠ¶æ€äº¤äº’å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸ä¼šã€‚çŠ¶æ€æ˜¯ç”¨åœ¨ Context ä¸­æ¥ä»£è¡¨å®ƒçš„å†…éƒ¨çŠ¶æ€ä»¥åŠè¡Œä¸ºçš„ï¼Œæ‰€ä»¥åªæœ‰ Context æ‰ä¼šå¯¹çŠ¶æ€æå‡ºè¯·æ±‚ã€‚å®¢æˆ·ä¸ä¼šç›´æŽ¥æ”¹å˜ Context çš„çŠ¶æ€ã€‚<strong>å…¨ç›˜äº†è§£çŠ¶æ€æ˜¯ Context çš„å·¥ä½œï¼Œå®¢æˆ·æ ¹æœ¬ä¸äº†è§£ï¼Œæ‰€ä»¥ä¸ä¼šç›´æŽ¥å’ŒçŠ¶æ€è”ç³»ã€‚</strong></p></li><li><p><strong>é—®</strong>ï¼šå¦‚æžœåœ¨æˆ‘çš„ç¨‹åºä¸­ Context æœ‰è®¸å¤šå®žä¾‹ï¼Œè¿™äº›å®žä¾‹ä¹‹é—´å¯ä»¥å…±äº«çŠ¶æ€å¯¹è±¡å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæ˜¯çš„ï¼Œç»å¯¹å¯ä»¥ï¼Œäº‹å®žä¸Šè¿™æ˜¯å¾ˆå¸¸è§çš„åšæ³•ã€‚<strong>ä½†å”¯ä¸€çš„å‰ææ˜¯ï¼Œä½ çš„çŠ¶æ€å¯¹è±¡ä¸èƒ½æŒæœ‰å®ƒä»¬è‡ªå·±çš„å†…éƒ¨çŠ¶æ€ï¼›å¦åˆ™å°±ä¸èƒ½å…±äº«</strong>ã€‚</p><p>æƒ³è¦å…±äº«çŠ¶æ€ï¼Œä½ éœ€è¦æŠŠæ¯ä¸ªçŠ¶æ€éƒ½æŒ‡å®šåˆ°é™æ€çš„å®žä¾‹å˜é‡ä¸­ï¼Œå¦‚æžœä½ çš„çŠ¶æ€éœ€è¦åˆ©ç”¨åˆ° Context ä¸­çš„æ–¹æ³•æˆ–è€…å®žä¾‹å˜é‡ï¼Œä½ è¿˜å¿…é¡»åœ¨æ¯ä¸ª <code>handler()</code> æ–¹æ³•å†…ä¼ å…¥ä¸€ä¸ª context çš„å¼•ç”¨ã€‚</p></li><li><p><strong>é—®</strong>ï¼šä½¿ç”¨çŠ¶æ€æ¨¡å¼ä¼¼ä¹Žæ€»æ˜¯å¢žåŠ æˆ‘ä»¬è®¾è®¡ä¸­ç±»çš„æ•°ç›®ã€‚</p><p><strong>ç­”</strong>ï¼šæ²¡é”™ï¼Œåœ¨ä¸ªåˆ«çš„çŠ¶æ€ç±»ä¸­å°è£…çŠ¶æ€çš„è¡Œä¸ºï¼Œç»“æžœæ€»æ˜¯å¢žåŠ è¿™ä¸ªè®¾è®¡ä¸­ç±»çš„æ•°ç›®ã€‚<strong>è¿™å°±æ˜¯ä¸ºäº†è¦èŽ·å–å¼¹æ€§è€Œä»˜å‡ºçš„ä»£ä»·</strong>ã€‚é™¤éžä½ çš„ä»£ç æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¯ä»¥ç”¨å®Œå°±æ‰”æŽ‰ï¼Œé‚£ä¹ˆçŠ¶æ€æ¨¡å¼çš„è®¾è®¡æ˜¯ç»å¯¹å€¼å¾—çš„ã€‚å…¶å®žçœŸæ­£é‡è¦çš„æ˜¯ä½ æš´éœ²ç»™å®¢æˆ·çš„ç±»æ•°ç›®ï¼Œè€Œä¸”æˆ‘ä»¬æœ‰åŠžæ³•å°†è¿™äº›é¢å¤–çš„çŠ¶æ€ç±»å…¨éƒ¨éšè—èµ·æ¥ã€‚</p></li><li><p><strong>é—®</strong>ï¼šçŠ¶æ€æ¨¡å¼ç±»å›¾æ˜¾ç¤º State æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†ä½ ä¸æ˜¯ä½¿ç”¨æŽ¥å£å®žçŽ°çš„ç³–æžœæœºçŠ¶æ€çš„å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæ˜¯çš„ã€‚å¦‚æžœæˆ‘ä»¬æ²¡æœ‰å…±åŒçš„åŠŸèƒ½å¯ä»¥æ”¾è¿›æŠ½è±¡ç±»ä¸­ï¼Œå°±ä¼šä½¿ç”¨æŽ¥å£ã€‚åœ¨ä½ å®žçŽ°çŠ¶æ€æ¨¡å¼æ—¶ï¼Œå¾ˆå¯èƒ½æƒ³ä½¿ç”¨æŠ½è±¡ç±»ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œå½“ä½ ä»¥åŽéœ€è¦åœ¨æŠ½è±¡ç±»ä¸­åŠ å…¥æ–°çš„æ–¹æ³•æ—¶å°±å¾ˆå®¹æ˜“ï¼Œä¸éœ€è¦æ‰“ç ´å…·ä½“çŠ¶æ€çš„å®žçŽ°ï¼ˆå­ç±»ä¼šç»§æ‰¿æŠ½è±¡ç±»ä¸­çš„æ–°æ–¹æ³•ï¼‰ã€‚</p></li></ul><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åŸºäºŽå†…éƒ¨çŠ¶æ€è€Œæ‹¥æœ‰ä¸åŒçš„è¡Œä¸ºã€‚</li><li>Context ä¼šå°†è¡Œä¸ºå§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡ã€‚</li><li>é€šè¿‡å°†æ¯ä¸ªçŠ¶æ€å°è£…è¿›ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬æŠŠä»¥åŽéœ€è¦åšçš„ä»»ä½•æ”¹å˜å±€éƒ¨åŒ–äº†ã€‚</li><li>çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼æœ‰ç›¸åŒçš„ç±»å›¾ï¼Œä½†æ˜¯å®ƒä»¬çš„æ„å›¾ä¸åŒã€‚</li><li>ç­–ç•¥æ¨¡å¼é€šå¸¸ä¼šç”¨è¡Œä¸ºæˆ–ç®—æ³•æ¥é…ç½® Context ç±»ã€‚</li><li>çŠ¶æ€æ¨¡å¼å…è®¸ Context éšç€çŠ¶æ€çš„æ”¹å˜è€Œæ”¹å˜è¡Œä¸ºã€‚</li><li>çŠ¶æ€å˜æ¢å¯ä»¥ç”± State ç±»æˆ– Context ç±»æŽ§åˆ¶ã€‚</li><li>ä½¿ç”¨çŠ¶æ€æ¨¡å¼é€šå¸¸ä¼šå¯¼è‡´è®¾è®¡ä¸­ç±»çš„æ•°ç›®å¤§é‡å¢žåŠ ã€‚</li><li>çŠ¶æ€ç±»å¯ä»¥è¢«å¤šä¸ª Context å®žä¾‹å…±äº«ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Validate Binary Search Tree</title>
      <link href="/programming/leetcode/validate-binary-search-tree/"/>
      <url>/programming/leetcode/validate-binary-search-tree/</url>
      
        <content type="html"><![CDATA[<p>Given a binary tree, determine if it is a valid binary search tree (BST).</p><p>Assume a BST is defined as follows:</p><ul><li>The left subtree of a node contains only nodes with keys <strong>less than</strong> the node's key.</li><li>The right subtree of a node contains only nodes with keys <strong>greater than</strong> the node's key.</li><li>Both the left and right subtrees must also be binary search trees.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    2</span><br><span class="line">   / \</span><br><span class="line">  1   3</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    5</span><br><span class="line">   / \</span><br><span class="line">  1   4</span><br><span class="line">     / \</span><br><span class="line">    3   6</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h1 id="recursion">Recursion</h1><p>For each node <code>l</code> in left subtree, we check if <code>l.val &lt; root.val</code> or not; And for each node <code>r</code> in right subtree, we check <code>r.val &gt; root.val</code>. Then, same procedure applied on subtrees.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValidBST</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(node, lower=float<span class="params">(<span class="string">'-inf'</span>)</span>, upper=float<span class="params">(<span class="string">'inf'</span>)</span>)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            val = node.val</span><br><span class="line">            <span class="keyword">if</span> val &gt;= upper <span class="keyword">or</span> val &lt;= lower:  <span class="comment"># check root and it's two children</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> helper(node.left, lower, val):  <span class="comment"># check left subtree recursively</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> helper(node.right, val, upper):  <span class="comment"># check right subtree recursively</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(root)</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="iteration">Iteration</h1><p>The above recursion could be converted into iteration, with the help of stack. DFS would be better than BFS since it works faster here.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValidBST</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        stack = [(root, float(<span class="string">'-inf'</span>), float(<span class="string">'inf'</span>)), ]</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            root, lower, upper = stack.pop()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            val = root.val</span><br><span class="line">            <span class="keyword">if</span> val &lt;= lower <span class="keyword">or</span> val &gt;= upper:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            stack.append((root.right, val, upper))</span><br><span class="line">            stack.append((root.left, lower, val))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="inorder-traversal">Inorder traversal</h1><p><img src="/uploads/image/leetcode/traversal.png"></p><p>Here the nodes are enumerated in the order you visit them, and you could follow <code>1-2-3-4-5</code> to compare different strategies.</p><p><code>Left -&gt; Node -&gt; Right</code> order of inorder traversal means for BST that each element should be smaller than the next one.</p><p>Hence the algorithm with <code>O(n)</code> time complexity and <code>O(n)</code> space complexity could be simple:</p><ul><li><p>Compute inorder traversal list inorder.</p></li><li><p>Check if each element in inorder is smaller than the next one.</p></li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValidBST</span><span class="params">(self, root: TreeNode)</span> -&gt; bool:</span></span><br><span class="line">        stack, inorder = [], float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> stack <span class="keyword">or</span> root:</span><br><span class="line">            <span class="keyword">while</span> root:</span><br><span class="line">                stack.append(root)</span><br><span class="line">                root = root.left</span><br><span class="line">            root = stack.pop()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># If next element in inorder traversal</span></span><br><span class="line">            <span class="comment"># is smaller than the previous one</span></span><br><span class="line">            <span class="comment"># that's not BST.</span></span><br><span class="line">            <span class="keyword">if</span> root.val &lt;= inorder:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            inorder = root.val</span><br><span class="line">            root = root.right</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> tree </tag>
            
            <tag> BST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿­ä»£å™¨æ¨¡å¼å’Œç»„åˆæ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/iterator-pattern-and-composite-pattern/"/>
      <url>/notes/head-first-design-patterns/iterator-pattern-and-composite-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿­ä»£å™¨æ¨¡å¼å°è£…éåŽ†">è¿­ä»£å™¨æ¨¡å¼ï¼šå°è£…éåŽ†</h1><h2 id="å¯¼å…¥é¤åŽ…å’Œç…Žé¥¼å±‹åˆå¹¶äº†">å¯¼å…¥ï¼šé¤åŽ…å’Œç…Žé¥¼å±‹åˆå¹¶äº†</h2><img src="http://www.plantuml.com/plantuml/svg/TP31Im915CRl-rUyOnt4UqGGT2We23gAXt7dwGxjpiZiA8XuKoWoaqY3yY8KU0cA81IB_XbdL_-BTjSSK-dulddVz_lcEOmYe5TK5V3Gow6qd5YncRHTj6oN-3wS82yTAVIWQW6SASbu0JZnS3bHz6t9Yee97eavuRf8E9InW8f8HcAHYbBEHIXAPgDL-qq-9TmcvtWeIZx6b8ImBoMf73DVHOtcO3zIou9H89J6yzRsobf4MLJqawUgXyeHj0RfDEZ6nsJS3RgZuBrZk0UCepJ0XJcJJOZiF-AVlJLapJ8tsasbDhwr-chWrh96AXETdIBFxcsQkL08aXKS1I9lIkp0xAcjMmrzsmmRhTdpftwx2dgNuUDGjvlXGtrwqzFNdLb_jEPVZzy1OzUzmTmr6RvClhx3ku6-k9_s1_C45_D9W2bj6cpOWivhEAx_0000"><p>çœŸæ˜¯ä¸ªå¥½æ¶ˆæ¯ï¼çŽ°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œäº«ç”¨ç…Žé¥¼å±‹ç¾Žå‘³çš„ç…Žé¥¼æ—©é¤ï¼Œå’Œå¥½åƒçš„é¤åŽ…åˆé¤äº†ã€‚ä½†æ˜¯ï¼Œå¥½åƒæœ‰ä¸€ç‚¹å°éº»çƒ¦â€¦â€¦æœ‰ä¸¤ç§ä¸åŒçš„èœå•è¡¨çŽ°æ–¹å¼ï¼Œè¿™ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>å‡è®¾ä½ å·²ç»è¢«åˆç»„çš„æ–°å…¬å¸é›‡ä½£ã€‚ä½ çš„å·¥ä½œæ˜¯è¦åˆ›å»ºä¸€ä¸ª Java ç‰ˆæœ¬çš„å¥³æ‹›å¾…ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/ROxDIiD058NtUOfPrbNVGLmeABZIzNLwQuOcOvYPBAGKYWWsOaX1nRzG5RLGDt7XeehWotIcoSfNS6e8qkhkt7FFT-znMGC9-e7Q9pxwEoWST-PG9gY73lL0Ih8DJ0cqekqGiWcSGWjNzqA96yX34YmODhF2E8gVPQDIrWq4usgcQqkaJUfrOg9J7R_ee_SyINLyFXaVJwyFJPPCnjtY_erqAcPP8BIQ8ETWdJoNlBaO5O_zEM0zvDJzDwpZtc9u2tTHWM30_tOpKTUaaMqrVRqh7cxBdXNDv9f2_nUlSV2nUZWyC8Cqpvvis5nc9VxrSP9_dkcRWGe5sa7tXxftLLfDy2JQivrl"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ArrayList breakfastItems = pancakeHouseMenu.getMenuItems();</span><br><span class="line">    MenuItem[] launchItems = dinerMenu.getMenuItems();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; breakfastItems.size(); i++) &#123;</span><br><span class="line">        MenuItem menuItem = (MenuItem)breakfastItems.get(i);</span><br><span class="line">        <span class="comment">// æ‰“å°menuItem</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lunchItems.length; i++) &#123;</span><br><span class="line">        MenuItem menuItem = lunchItems[i];</span><br><span class="line">        <span class="comment">// æ‰“å°menuItem</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®žçŽ°å…¶ä»–æ–¹æ³•ï¼Œåšæ³•ä¹Ÿç±»ä¼¼ã€‚æˆ‘ä»¬æ€»æ˜¯éœ€è¦å¤„ç†ä¸¤ä¸ªèœå•ï¼Œå¹¶ä¸”ç”¨ä¸¤ä¸ªå¾ªçŽ¯éåŽ†ã€‚å¦‚æžœè¿˜æœ‰ç¬¬ä¸‰å®¶é¤åŽ…ä»¥ä¸åŒçš„å®žçŽ°å‡ºçŽ°ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ä¸‰ä¸ªå¾ªçŽ¯ã€‚</p><a id="more"></a><p>æ ¹æ®æˆ‘ä»¬çš„ <code>printMenu()</code> å®žçŽ°ï¼š</p><ul><li>æˆ‘ä»¬æ˜¯é’ˆå¯¹ PancakeHouseMenu å’Œ DinerMenu çš„å…·ä½“å®žçŽ°ç¼–ç ï¼Œè€Œä¸æ˜¯é’ˆå¯¹æŽ¥å£ã€‚</li><li>å¦‚æžœæˆ‘ä»¬å†³å®šä»Ž DinerMenu åˆ‡æ¢åˆ°å¦ä¸€ç§èœå•ï¼Œæ­¤èœå•çš„é¡¹ä½¿ç”¨ Hashtable æ¥å­˜æ”¾çš„ï¼Œæˆ‘ä»¬ä¼šå› æ­¤éœ€è¦ä¿®æ”¹å¥³æ‹›å¾…ä¸­çš„è®¸å¤šä»£ç ã€‚</li><li>å¥³æ‹›å¾…éœ€è¦çŸ¥é“æ¯ä¸ªèœå•å¦‚ä½•è¡¨è¾¾å†…éƒ¨çš„èœå•é¡¹é›†åˆï¼Œè¿™è¿åäº†å°è£…ã€‚</li><li>æˆ‘ä»¬æœ‰é‡å¤çš„ä»£ç ï¼š<code>printMenu()</code> æ–¹æ³•éœ€è¦ä¸¤ä¸ªå¾ªçŽ¯ï¼Œæ¥éåŽ†ä¸¤ç§ä¸åŒçš„èœå•ã€‚å¦‚æžœæˆ‘ä»¬åŠ ä¸Šç¬¬ä¸‰ç§èœå•ï¼Œæˆ‘ä»¬å°±éœ€è¦ç¬¬ä¸‰ä¸ªå¾ªçŽ¯ã€‚</li></ul><p>å¦‚æžœä½ ä»Žæœ¬ä¹¦ä¸­å­¦ä¹ äº†ä¸€ä»¶äº‹æƒ…ï¼Œé‚£å°±æ˜¯å°è£…å˜åŒ–çš„éƒ¨åˆ†ã€‚å¾ˆæ˜Žæ˜¾ï¼Œåœ¨è¿™é‡Œå‘ç”Ÿå˜åŒ–çš„æ˜¯ï¼šç”±ä¸åŒçš„é›†åˆï¼ˆcollectionï¼‰ç±»åž‹æ‰€é€ æˆçš„éåŽ†ã€‚</p><h2 id="åº”ç”¨è¿­ä»£å™¨æ¨¡å¼">åº”ç”¨è¿­ä»£å™¨æ¨¡å¼</h2><img src="http://www.plantuml.com/plantuml/svg/ZPDDIm916CVl-oa6JtNO1QyY2q67Wenk7Sp3k3xYaZihCoCava5AyL84lK1vAF3Y9GWIeaJyCeultwBnRNRTRSdJxlwV__DxNcQsOES0WLFY5UI0amMg5UQAPLEh29fLn8oXKsnp2lAbgY5KeZRXAI3bdLsjjZASO6BXSpXmompceOLnZr9SER8Pbs1IFkJWCAdA9yNSfSYYW3ciFtsmVPi0LPJKAZUTMM3iBJ2oFw1vR87dIYQLQ9eBRXLd6QVOuZLKmEmOBhZCtP39KekQKR7dD3yYaAV6-Jz1xLdNTJDKC11MN4ytJ3Mnver-QHX6PFT1NwXRBNIsXXbDyyxECFzW4PS3AaAU8pUlRbK2ZGR3oKDtxPhLRyHjSzPkYhkMQ5nDUc-RUS7YYT0TcFPUfxtE6H6jjkZ_YCRNQ70_URcU3jz7_OvuxYvvCV5HdtOQiijLczAoh3r--Xv_FiOGPeZ4DH97sor6JyjV9mSaupySRoE-SDJ-VW40"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Waitress &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator pancakeIterator = pancakeHouseMenu.createIterator();</span><br><span class="line">        Iterator dinerIterator = dinerMenu.createIterator();</span><br><span class="line">        printMenu(pancakeIterator);</span><br><span class="line">        printMenu(dinerIterator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">(Iterator iterator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            MenuItem menuItem = (MenuItem)iterator.next();</span><br><span class="line">            <span class="comment">// æ‰“å°menuItem</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DinerMenuIterator</span> </span>&#123;</span><br><span class="line">    MenuItem[] items;  <span class="comment">// é¤åŽ…èœå•</span></span><br><span class="line">    <span class="keyword">int</span> position = <span class="number">0</span>; <span class="comment">// è®°å½•å½“å‰éåŽ†çš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DinerMenuIterator</span><span class="params">(MenuItems[] items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MenuItem menuItem = items[position];</span><br><span class="line">        position++;</span><br><span class="line">        <span class="keyword">return</span> menuItem;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (position &gt;= item.length || items[position] == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DinerMenu</span> </span>&#123;</span><br><span class="line">    MenuItem[] menuItems;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DinerMenuIterator(menuItems);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åšä¸€äº›æ”¹è‰¯">åšä¸€äº›æ”¹è‰¯</h2><p>ä¸¤ä»½èœå•è¦å¿…é¡»å®žçŽ° <code>createIterator()</code> æ–¹æ³•ï¼Œä½†æˆ‘ä»¬æ²¡æœ‰ä¸ºå®ƒä»¬è®¾è®¡ä¸€ä¸ªå…±åŒçš„æŽ¥å£ã€‚æ‰€ä»¥ï¼ŒæŽ¥ä¸‹æ¥å°±è¦è¿™ä¹ˆåšã€‚</p><p>ä¸ºç¤¾ä¹ˆæˆ‘ä»¬ä¸ä½¿ç”¨ Java çš„ Iterator æŽ¥å£å‘¢â€”â€”æˆ‘ä»¬ä¹‹æ‰€ä»¥è¿™ä¹ˆåšï¼Œæ˜¯ä¸ºäº†è¦è®©ä½ äº†è§£å¦‚æžœä»Žå¤´åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰äº† Iterable æŽ¥å£ã€‚çŽ°åœ¨æˆ‘ä»¬çš„ç›®çš„å·²ç»è¾¾åˆ°äº†ï¼Œæ‰€ä»¥å°±è¦æ”¹å˜åšæ³•ï¼Œå¼€å§‹ä½¿ç”¨ Java çš„ Iterator æŽ¥å£ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VP9DImCn48Rl-HN1KtjemQjAGV2WekBDG_MGRaSRx6ObcnPBBLGHLB0LGSMFwi5I4L6hA5W_m1_ZxdOz-HTClx8hhRqbxypxJ2Op2He73FgAo60Tz1Xmb6We6kLQ4f2M9AQ9vmWL7EGXYp1UuPI9QM2fG13bsWcpX6ba6SQDb0cDK3Dnb7EIcQAca62McX2WcrBLE101yiQ9C7WWYBEOWqXnvcM5gOeEuvmgCaOPS4MVRcT75vf6-WzUkkLpWIyI3PeUF3AYX4YaYSgIc2auqKIklxqZzqSaY3a3gq9w_yYiXyP1DzBW-qVLeYhLWFk92kFpjjeAgJ6rXRLmk6imlf1N3AdvXYEgIUHrsyZkUXdonY5TtU6kbGX5vMB5WItuiX4p161Ebn826ukgzX2U96bIFzti2FFCALRilRBxUUoKTgnQtghTpBFE5pX7hyxJuLT-euKRK8kdSjtF0_liedE-izxBzicrv7kBfXYoLE7ItgkurNEt-lppiUjixrlljrQjy5tAkrVhLkrDyUtxYthnmTswiLyU9KsH9MO04nEpGSG6SOyn_080"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DinerMenuIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">    MenuItem[] list;</span><br><span class="line">    <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// next()æ–¹æ³•å’ŒhasNext()æ–¹æ³•ä¿æŒä¸å˜</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¢žåŠ remove()æ–¹æ³•çš„å®žçŽ°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (position &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException</span><br><span class="line">                (<span class="string">"You can't remove an item until you've done at least one next()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (list[position-<span class="number">1</span>] != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = position-<span class="number">1</span>; i &lt; (list.length-<span class="number">1</span>); i++) &#123;</span><br><span class="line">                list[i] = list[i+<span class="number">1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            list[list.length-<span class="number">1</span>] = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>é—®</strong>ï¼šå¦‚æžœæˆ‘ä¸æƒ³è®©å®¢æˆ·å…·å¤‡åˆ é™¤çš„èƒ½åŠ›ï¼Œè¯¥æ€Žä¹ˆåŠžï¼Ÿ</p><p><strong>ç­”</strong>ï¼š<code>remove()</code> æ–¹æ³•å…¶å®žæ˜¯å¯æœ‰å¯æ— çš„ï¼Œä¸ä¸€å®šè¦æä¾›åˆ é™¤çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¾ˆæ˜Žæ˜¾çš„ï¼Œä½ éœ€è¦æä¾›è¿™æ ·çš„æ–¹æ³•ï¼Œå› ä¸ºæ¯•ç«Ÿå®ƒè¢«å£°æ˜Žåœ¨ Iterator æŽ¥å£ä¸­ï¼Œå¦‚æžœä½ ä¸å…è®¸ <code>remove()</code> çš„è¯ï¼Œå¯ä»¥æŠ›å‡ºä¸€ä¸ª <code>java.lang.UnsupportedOperationException</code> è¿è¡Œæ—¶å¼‚å¸¸ã€‚</p><p><strong>Iterator çš„ API æ–‡ä»¶æåˆ°å¯ä»¥è®© <code>remove()</code> æ–¹æ³•æŠ›å‡ºè¿™æ ·çš„å¼‚å¸¸ï¼Œè€Œä»»ä½•è‰¯å¥½çš„å®¢æˆ·ç¨‹åºåªè¦è°ƒç”¨äº† <code>remove()</code> æ–¹æ³•ï¼Œå°±åº”è¯¥æ£€æŸ¥æ˜¯å¦ä¼šå‘ç”Ÿè¿™ä¸ªå¼‚å¸¸</strong>ã€‚</p></li><li><p><strong>é—®</strong>ï¼šåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªè¿­ä»£å™¨å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡é›†åˆã€‚<code>remove()</code> ä¼šé€ æˆæ€Žæ ·çš„å½±å“ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šåŽæžœå¹¶æ²¡æœ‰æŒ‡æ˜Žï¼Œæ‰€ä»¥å¾ˆéš¾é¢„æ–™ã€‚å½“ä½ çš„ç¨‹åºåœ¨å¤šçº¿ç¨‹çš„ä»£ç ä¸­ä½¿ç”¨åˆ°è¿­ä»£å™¨æ—¶ï¼Œå¿…é¡»ç‰¹åˆ«å°å¿ƒã€‚</p></li></ul><h2 id="å®šä¹‰è¿­ä»£å™¨æ¨¡å¼">å®šä¹‰è¿­ä»£å™¨æ¨¡å¼</h2><p>è¿­ä»£å™¨æ¨¡å¼æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨çš„è¡¨ç¤ºã€‚</p><p>è¿™ä¸ªæ¨¡å¼ç»™ä½ æä¾›äº†ä¸€ä¸ªæ–¹æ³•ï¼Œ<strong>å¯ä»¥é¡ºåºè®¿é—®ä¸€ä¸ªèšé›†å¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œè€Œåˆä¸ç”¨çŸ¥é“å†…éƒ¨æ˜¯å¦‚ä½•è¡¨ç¤ºçš„</strong>ã€‚</p><p>å¦ä¸€ä¸ªå¯¹ä½ çš„è®¾è®¡é€ æˆé‡è¦å½±å“çš„ï¼Œæ˜¯<strong>è¿­ä»£å™¨æ¨¡å¼æŠŠåœ¨å…ƒç´ ä¹‹é—´æ¸¸èµ°çš„è´£ä»»äº¤ç»™è¿­ä»£å™¨ï¼Œè€Œä¸æ˜¯èšåˆå¯¹è±¡</strong>ã€‚è¿™ä¸ä»…è®©èšåˆçš„æŽ¥å£å’Œå®žçŽ°å˜å¾—æ›´ç®€æ´ï¼Œè€Œå¯ä»¥è®©èšåˆæ›´ä¸“æ³¨åœ¨å®ƒæ‰€åº”è¯¥ä¸“æ³¨çš„äº‹æƒ…ä¸Šé¢ï¼ˆä¹Ÿå°±æ˜¯ç®¡ç†å¯¹è±¡é›†åˆï¼‰ï¼Œè€Œä¸å¿…åŽ»ç†ä¼šéåŽ†çš„äº‹æƒ…ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VP3BJi9068NtVOfPweO7C8R4k7BZ4x0fTMX9Q6k6YT4W2HT1Y4XDC1YLS95B20b5t1J2xM7ib7R5ApYbePH0t9vpvfpl7o5y1G4Kh_4T4A4OX8WHR8KB8ou2cR248Ggn70HdF8yWps88JazTrUy7CGQ061kCOiHoE0uu16dcWleibj7HCHFtT6pa_oi4Dde9Rp5zkoDB1pG4HVa6hbUu21kDWdDPeWGORcdjyWDGkt4Np4vxzzrHpvBd9-vzllr9Pdkcrz-ep3wZpx-NEW54hUhp9r8ewwE4FkgHZARFIW79NFJrIPEyTrVJWfcUaLRDIZwJOZOWaS7O73QiponvoQscEVEnHxJXQffd99bkH6080pcqZsilVHavZNHIHhLYLH9c9-bMgcawOxpLgRoijQraYIhBZmVRgIwBtqPvJAOAZH2bvqG24WsvZ3Hg5Dj4QVucKWu62lF2ccDxg9icYupLc3ZD0Sdejvotj5wVrOaoq2UqNfyjbgzTelqObJojjyrnZVAiRUTcKvsRQiFvDZhy1m00"><p>è¿­ä»£å™¨æ¨¡å¼çš„ç±»å›¾çœ‹èµ·æ¥å¾ˆåƒæˆ‘ä»¬æ‰€å­¦çš„å¦ä¸€ä¸ªæ¨¡å¼ï¼Œä½ çŸ¥é“æ˜¯å“ªä¸ªæ¨¡å¼å—ï¼Ÿæç¤ºï¼šå­ç±»å†³å®šè¦åˆ›å»ºå“ªä¸ªå¯¹è±¡ã€‚ï¼ˆå·¥åŽ‚æ–¹æ³•æ¨¡å¼ï¼‰</p><h2 id="é—®ç­”">é—®ç­”</h2><ul><li><p><strong>é—®</strong>ï¼šæˆ‘å¬è¯´è¿‡â€œå†…éƒ¨çš„â€è¿­ä»£å™¨å’Œâ€œå¤–éƒ¨çš„â€è¿­ä»£å™¨ã€‚è¿™æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬åœ¨å‰é¢çš„ä¾‹å­ä¸­å®žçŽ°çš„æ˜¯å“ªä¸€ç§ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæˆ‘ä»¬å®žçŽ°çš„æ˜¯å¤–éƒ¨è¿­ä»£å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·é€šè¿‡è°ƒç”¨ <code>next()</code> å–å¾—ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚<strong>è€Œå†…éƒ¨çš„è¿­ä»£å™¨åˆ™æ˜¯ç”±è¿­ä»£å™¨è‡ªå·±æŽ§åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸ºæ˜¯ç”±è¿­ä»£å™¨è‡ªè¡Œåœ¨å…ƒç´ ä¹‹é—´æ¸¸èµ°ï¼Œæ‰€ä»¥ä½ å¿…é¡»é«˜é€Ÿè¿­ä»£å™¨åœ¨æ¸¸èµ°çš„è¿‡ç¨‹ä¸­ï¼Œè¦åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¿…é¡»å°†æ“ä½œä¼ å…¥ç»™è¿­ä»£å™¨</strong>ã€‚å› ä¸ºå®¢æˆ·æ— æ³•æŽ§åˆ¶éåŽ†çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å†…éƒ¨è¿­ä»£å™¨æ¯”å¤–éƒ¨è¿­ä»£å™¨æ›´æ²¡æœ‰å¼¹æ€§ã€‚ç„¶è€Œï¼ŒæŸäº›äººå¯èƒ½è®¤ä¸ºå†…éƒ¨çš„è¿­ä»£å™¨æ¯”è¾ƒå®¹æ˜“ä½¿ç”¨ï¼Œå› ä¸ºåªéœ€å°†æ“ä½œå‘Šè¯‰å®ƒï¼Œå®ƒå°±ä¼šå¸®ä½ åšå®Œæ‰€æœ‰äº‹æƒ…ã€‚</p></li><li><p><strong>é—®</strong>ï¼šä½ è¯´å¯ä»¥ç”¨è¿­ä»£å™¨å†™å‡ºâ€œå¤šæ€çš„ä»£ç â€ï¼Œå¯ä»¥å†å¤šåšä¸€äº›è§£é‡Šå—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå½“æˆ‘ä»¬å†™äº†ä¸€ä¸ªéœ€è¦ä»¥è¿­ä»£å™¨å½“ä½œå‚æ•°çš„æ–¹æ³•æ—¶ï¼Œå…¶å®žå°±æ˜¯åœ¨ä½¿ç”¨å¤šæ€çš„è¿­ä»£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰€å†™å‡ºçš„ä»£ç ï¼Œå¯ä»¥åœ¨ä¸åŒçš„é›†åˆä¸­æ¸¸èµ°ï¼Œåªè¦è¿™ä¸ªé›†åˆæ”¯æŒè¿­ä»£å™¨å³å¯ã€‚æˆ‘ä»¬ä¸åœ¨ä¹Žè¿™ä¸ªé›†åˆæ˜¯å¦‚ä½•è¢«å®žçŽ°çš„ï¼Œä½†ä¾ç„¶å¯ä»¥ç¼–ç¨‹åœ¨å®ƒå†…éƒ¨çš„å…ƒç´ ä¹‹é—´æ¸¸èµ°ã€‚</p></li></ul><h1 id="å•ä¸€è´£ä»»å’Œå†…èš">å•ä¸€è´£ä»»å’Œå†…èš</h1><p>å½“æˆ‘ä»¬éƒ§è¥¿ä¸€ä¸ªç±»ä¸ä½†è¦å®Œæˆè‡ªå·±çš„äº‹æƒ…ï¼ˆç®¡ç†æŸç§èšåˆï¼‰ï¼Œè¿˜åŒæ—¶è¦è´Ÿæ‹…æ›´å¤šçš„è´£ä»»ï¼ˆä¾‹å¦‚éåŽ†ï¼‰æ—¶ï¼Œæˆ‘ä»¬å°±ç»™äº†è¿™ä¸ªç±»ä¸¤ä¸ªå˜åŒ–çš„åŽŸå› ã€‚å¦‚æžœè¿™ä¸ªé›†åˆæ”¹å˜çš„è¯ï¼Œè¿™ä¸ªç±»å¿…é¡»æ”¹å˜ï¼›å¦‚æžœæˆ‘ä»¬éåŽ†çš„æ–¹å¼æ”¹å˜çš„è¯ï¼Œè¿™ä¸ªç±»ä¹Ÿå¿…é¡»æ”¹å˜ã€‚</p><blockquote><p>ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å˜åŒ–çš„åŽŸå› ã€‚</p></blockquote><p>è¿™ä¸ªåŽŸåˆ™å‘Šè¯‰æˆ‘ä»¬å°†ä¸€ä¸ªè´£ä»»åªæŒ‡æ´¾ç»™ä¸€ä¸ªç±»ã€‚è¿™å¬èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†å…¶å®žåšèµ·æ¥å¹¶ä¸ç®€å•ï¼š<strong>åŒºåˆ†è®¾è®¡ä¸­çš„è´£ä»»ï¼Œæ˜¯æœ€å›°éš¾çš„äº‹æƒ…ä¹‹ä¸€</strong>ã€‚æˆ‘ä»¬çš„å¤§è„‘å¾ˆä¹ æƒ¯çœ‹ç€ä¸€å¤§ç¾¤çš„è¡Œä¸ºï¼Œç„¶åŽå°†å®ƒä»¬é›†ä¸­åœ¨ä¸€èµ·ï¼Œå°½ç®¡å®ƒä»¬å¯èƒ½å±žäºŽä¸¤ä¸ªæˆ–å¤šä¸ªä¸åŒçš„è´£ä»»ã€‚æƒ³è¦æˆåŠŸçš„å”¯ä¸€æ–¹æ³•ï¼Œå°±æ˜¯åŠªåŠ›ä¸æ‡ˆåœ°æ£€æŸ¥ä½ çš„è®¾è®¡ï¼Œéšç€ç³»ç»Ÿçš„æˆé•¿ï¼Œéšæ—¶è§‚å¯Ÿæœ‰æ²¡æœ‰è¿¹è±¡æ˜¾ç¤ºæŸä¸ªç±»æ”¹å˜çš„åŽŸå› è¶…å‡ºä¸€ä¸ªã€‚</p><p>å†…èšï¼ˆcohesionï¼‰è¿™ä¸ªæœ¯è¯­ç”¨æ¥åº¦é‡ä¸€ä¸ªç±»æˆ–æ¨¡å—ç´§å¯†åœ°è¾¾åˆ°å•ä¸€ç›®çš„æˆ–è´£ä»»ã€‚å½“ä¸€ä¸ªæ¨¡å—è¢«è®¾è®¡æˆåªæ”¯æŒä¸€ç»„ç›¸å…³çš„åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒå…·æœ‰é«˜å†…èšï¼›åä¹‹ï¼Œå½“è¢«è®¾è®¡æˆæ”¯æŒä¸€ç»„ä¸ç›¸å…³çš„åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒå…·æœ‰ä½Žå†…èšã€‚</p><p>å†…èšæ˜¯ä¸€ä¸ªæ¯”å•ä¸€è´£ä»»åŽŸåˆ™æ›´æ™®éçš„æ¦‚å¿µï¼Œä½†ä¸¤è€…å…¶å®žå…³ç³»æ˜¯å¾ˆå¯†åˆ‡çš„ã€‚éµå®ˆè¿™ä¸ªåŽŸåˆ™çš„ç±»å®¹æ˜“å…·æœ‰å¾ˆé«˜çš„å‡èšåŠ›ï¼Œè€Œä¸”æ¯”èƒŒè´Ÿè®¸å¤šè´£ä»»çš„ä½Žå†…èšç±»æ›´å®¹æ˜“ç»´æŠ¤ã€‚</p><h1 id="ç»„åˆæ¨¡å¼è¿ŽæŽ¥æ–°çš„èœå•">ç»„åˆæ¨¡å¼ï¼šè¿ŽæŽ¥æ–°çš„èœå•</h1><p>æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨å¥³æ‹›å¾… Waitress ä¸Šï¼Œä½†è¿˜æ˜¯å¾—æ‰¿è®¤ï¼Œç¨‹åºä¸­è°ƒç”¨ä¸¤æ¬¡ <code>printMenu()</code> çœ‹èµ·æ¥æœ‰ç‚¹ä¸‘ã€‚æ¯æ¬¡æˆ‘ä»¬ä¸€æœ‰æ–°èœå•åŠ å…¥ï¼Œå°±å¿…é¡»æ‰“å¼€ Waitress å¹¶åŠ å…¥æ›´å¤šçš„ä»£ç ã€‚è¿™ç®—ä¸ç®—æ˜¯â€œè¿åå¼€æ”¾-å…³é—­åŽŸåˆ™â€œï¼Ÿ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Iterator pancakeIterator = pancakeHouseMenu.createIterator();</span><br><span class="line">    Iterator dinerIterator = dinerMenu.createIterator();</span><br><span class="line">    Iterator cafeIterator = cafeMenu.createIterator();  <span class="comment">// æ·»åŠ å’–å•¡åŽ…èœå•</span></span><br><span class="line">    printMenu(pancakeIterator);</span><br><span class="line">    printMenu(dinerIterator);</span><br><span class="line">    printMenu(cafeIterator);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸æ˜¯å¥³æ‹›å¾…çš„é”™ã€‚å¯¹äºŽå°†å¥¹ä»Žèœå•çš„å®žçŽ°ä¸Šè§£è€¦å’Œæå–éåŽ†åŠ¨ä½œåˆ°è¿­ä»£å™¨ï¼Œæˆ‘ä»¬éƒ½åšçš„å¾ˆå¥½ã€‚ä½†æˆ‘ä»¬è®©ç„¶å°†èœå•å¤„ç†æˆåˆ†ç¦»è€Œç‹¬ç«‹çš„å¯¹è±¡â€”â€”æˆ‘ä»¬éœ€è¦ä¸€ç§ä¸€èµ·ç®¡ç†å®ƒä»¬çš„æ–¹æ³•ã€‚</p><h2 id="å°†èœå•æ‰“åŒ…è¿›-arraylist">å°†èœå•æ‰“åŒ…è¿› ArrayList</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    ArrayList menus;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Waitress</span><span class="params">(ArrayList menus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.menus = menus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator menuIterator = menus.iterator(); <span class="comment">// éåŽ†èœå•</span></span><br><span class="line">        <span class="keyword">while</span> (menuIterator.hasNext()) &#123;</span><br><span class="line">            Menu menu = (Menu)menuIterator.next();</span><br><span class="line">            printMenu(menu.createIterator());  <span class="comment">// éåŽ†å¹¶æ‰“å°èœå•é¡¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printMenu</span><span class="params">(Iterator iterator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            MenuItem menuItem = (MenuItem)iterator.next();</span><br><span class="line">            <span class="comment">// æ‰“å°èœå•é¡¹å†…å®¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ç›¸å½“ä¸é”™ï¼Œè™½ç„¶æˆ‘ä»¬å¤±åŽ»äº†èœå•çš„åå­—ï¼Œä½†æ˜¯å¯ä»¥æŠŠåå­—åŠ è¿›æ¯ä¸ªèœå•ä¸­ã€‚</p><p>æ­£å½“æˆ‘ä»¬è®¤ä¸ºè¿™å¾ˆå®‰å…¨çš„æ—¶å€™ï¼ŒçŽ°åœ¨ä»–ä»¬å¸Œæœ›èƒ½å¤ŸåŠ ä¸Šä¸€ä»½é¤åŽç”œç‚¹çš„â€œå­èœå•â€ã€‚æ ¹æ®çŽ°æœ‰çš„å®žçŽ°ï¼Œæ ¹æœ¬åšä¸åˆ°ã€‚<strong>æˆ‘ä»¬éœ€è¦è®©é¤åŽ…èœå•æŒæœ‰ä¸€ä»½å­èœå•ï¼Œä½†æ˜¯ä¸èƒ½çœŸçš„æŠŠå®ƒèµ‹å€¼ç»™èœå•é¡¹æ•°ç»„ï¼Œå› ä¸ºç±»åž‹ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½è¿™ä¹ˆåš</strong>ã€‚</p><p>è¯¥æ˜¯åšå†³ç­–æ¥æ”¹å†™åŽ¨å¸ˆçš„å®žçŽ°ä»¥ç¬¦åˆæ‰€æœ‰èœå•çš„éœ€æ±‚çš„æ—¶å€™äº†ã€‚åœ¨æˆ‘ä»¬çš„æ–°è®¾è®¡ä¸­ï¼ŒçœŸæ­£éœ€è¦äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æˆ‘ä»¬éœ€è¦æŸç§<strong>æ ‘å½¢ç»“æž„ï¼Œå¯ä»¥å®¹çº³èœå•ã€å­èœå•å’Œèœå•é¡¹</strong>ã€‚</li><li>æˆ‘ä»¬éœ€è¦ç¡®å®šèƒ½å¤Ÿåœ¨æ¯ä¸ªèœå•çš„å„ä¸ªé¡¹ä¹‹é—´æ¸¸èµ°ï¼Œè€Œä¸”è‡³å°‘è¦åƒçŽ°åœ¨ç”¨è¿­ä»£å™¨ä¸€æ ·æ–¹ä¾¿ã€‚</li><li>æˆ‘ä»¬ä¹Ÿéœ€è¦èƒ½å¤Ÿæ›´æœ‰å¼¹æ€§åœ°èœå•é¡¹ä¹‹é—´æ¸¸èµ°ã€‚æ¯”æ–¹è¯´ï¼Œå¯èƒ½åªéœ€è¦éåŽ†ç”œå“èœå•ï¼Œæˆ–è€…å¯ä»¥éåŽ†é¤åŽ…çš„æ•´ä¸ªé¤å•ï¼ˆåŒ…æ‹¬ç”œå“èœå•åœ¨å†…ï¼‰ã€‚</li></ul><h2 id="å®šä¹‰ç»„åˆæ¨¡å¼">å®šä¹‰ç»„åˆæ¨¡å¼</h2><p>æˆ‘ä»¬è¦ä»‹ç»å¦ä¸€ä¸ªæ¨¡å¼è§£å†³è¿™ä¸ªéš¾é¢˜ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰æ”¾å¼ƒè¿­ä»£å™¨â€”â€”å®ƒä»ç„¶æ˜¯æˆ‘ä»¬è§£å†³æ–¹æ¡ˆä¸­çš„ä¸€éƒ¨åˆ†â€”â€”ç„¶è€Œï¼Œç®¡ç†èœå•çš„é—®é¢˜å·²ç»åˆ°äº†ä¸€ä¸ªè¿­ä»£å™¨æ— æ³•è§£å†³çš„æ–°ç»´åº¦ã€‚</p><p>ç»„åˆæ¨¡å¼å…è®¸ä½ å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æž„æ¥è¡¨çŽ°â€œæ•´ä½“/éƒ¨åˆ†â€å±‚æ¬¡ç»“æž„ã€‚ç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠå¯¹è±¡ç»„åˆã€‚</p><img src="http://www.plantuml.com/plantuml/svg/TP7BJjj058RtVefPbaNw05759jk-GTs5IIR4aZsE7AjIHP7IN5329QuAHPH4XRHKGPLmsY9WR8ZoCCoClUihz7WiNuZ4RdoEv_ilqz1h666pwRn79ZOtiAqquabLjwi6LhIDbcDhLGTLBBDf4KmSjAKWj9NEjv7LnBRcw1PviVPqeTLggoCRczOxl3hTn4wbeHlntzjArT1QBVGQQtKfLAIdIscbfJjO_f7A5DW5u2gXOkXnXfVhUI0bZ_RgGwaajLTdcMHnyMGk7PVUG7SrJDwk5pR40gS6hZl8ggD4luouzrqCxjXY6HvTPaYLYD5FxluGXmTiCGdlU_pJWD6hyBJ7vtxqP_hOxYGqMzzi9BZqQZa_CXeKhm9qs1QJOOBWtYdpXuos6VsLYFrxs5S9emUXDnKdy-Hcj3o1CtTlezrEsF4ptJH571Oof7lcduNtCp5Sic27Trtv8e_jZof9tuH_ti_VH2NHygiulmDlujWNrr_00KnOC4u-LG9MCxOO74SU5N-d447qN33_J0jnr-Ny29wuzoqS_GPFG4nnuPZo_dKiBJi65Ypxjr0LyEDQm8NSS7SUTHVI2mj66JQn80lZ5pDmpiVdukg2JoxZ2D1fjmztTcuOtKi8B9Y5HsVyeSCf1RN_"><p><strong>åˆ©ç”¨ç»„åˆç»“æž„ï¼Œæˆ‘ä»¬èƒ½æŠŠç›¸åŒçš„æ“ä½œåº”ç”¨åœ¨ç»„åˆå’Œä¸ªåˆ«å¯¹è±¡ä¸Šã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å¿½ç•¥å¯¹è±¡ç»„åˆå’Œä¸ªåˆ«å¯¹è±¡ä¹‹é—´çš„å·®åˆ«ã€‚</strong></p><p><strong>é—®</strong>ï¼šè¿™å’Œè¿­ä»£å™¨æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæˆ‘ä»¬çŽ°åœ¨åœ¨é‡‡å–ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œæ‰“ç®—ç”¨æ–°çš„æ–¹æ¡ˆâ€”â€”ç»„åˆæ¨¡å¼ï¼Œæ¥é‡æ–°å®žçŽ°èœå•ã€‚ä¸è¦è®¤ä¸ºè¿­ä»£å™¨å’Œç»„åˆä¹‹é—´æœ‰ä»€ä¹ˆç¥žå¥‡çš„è½¬æ¢ã€‚æˆ‘ä»¬å¯ä»¥è¯´ï¼Œè¿™ä¸¤è€…å¯ä»¥åˆä½œæ— é—´ï¼Œä½ å¾ˆå¿«å°±ä¼šçœ‹åˆ°æˆ‘ä»¬å¯ä»¥åœ¨ç»„åˆçš„å®žçŽ°ä¸­ä½¿ç”¨è¿­ä»£å™¨ï¼Œè€Œä¸”åšæ³•è¿˜ä¸æ­¢ä¸€ç§ã€‚</p><h2 id="åˆ©ç”¨ç»„åˆè®¾è®¡èœå•">åˆ©ç”¨ç»„åˆè®¾è®¡èœå•</h2><img src="http://www.plantuml.com/plantuml/svg/fLDDIyD04BtdLyon7eft4K7q8gW8WXxKmpQPjWl9fcnMGMf1j2gA6X7RYlKYedYGUX2AiKf_ZDaq_HUkBVtIIYlUTcTVthnvRvAa1W9QAR495benv5hogw9JhfkeaPWZED45p25RdxAjbCsG2KXh00aKyyJ2o0YaONGKWgEYF7WDgsVXpN5GACkt7Vdo0facS1eTdTEKe3OR2h_0gJu4CtMMKA49fsG8tXIdJ0o64SE8T2R5WNYEbhs1V_f4QPvAKjE8A4501y0pccuInsaaC2FGQfY_ADGm2M0g07LBnocQHkQBHUwL_KfUkfVr0xSxf3uvz5ZzmysEOUgaSoG2LNTEXCrLgLjK7q6Jd9FDMUe8jLDTU-FyHsj7pVU4-eVmq-V-WomJAZYgMQ8JlLkkzUxy-5OqsWxXjxVlzUvo8xpeYlgz36HhpMOQimM2YN41TXnQKiR0Vw_MBXv2zrgUv6gLh5yf1wTtqhrTPM6fMY-KcY_o_BXvgDzu7zixlMIjbcFGnhJnuVr-hPZtN_TNcNpoP6dNhpm6ruT1rlMzmzfLDiXxmNDEKNu2"><p><strong>æ‰€æœ‰çš„ç»„ä»¶éƒ½å¿…é¡»å®žçŽ° MenuComponent æŽ¥å£ï¼Œç„¶è€Œï¼Œå¶èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹çš„è§’è‰²ä¸åŒï¼Œæ‰€ä»¥æœ‰äº›æ–¹æ³•å¯èƒ½å¹¶ä¸é€‚åˆæŸç§èŠ‚ç‚¹ã€‚é¢å¯¹è¿™ç§æƒ…å†µï¼Œæœ‰æ—¶å€™ï¼Œä½ æœ€å¥½æ˜¯æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚</strong></p><h2 id="å®žçŽ°èœå•é¡¹å’Œèœå•">å®žçŽ°èœå•é¡¹å’Œèœå•</h2><p>æœ¬èŠ‚é‡ç‚¹å…³æ³¨ <code>print()</code> æ–¹æ³•ã€‚è§‚å¯Ÿç»„åˆæ¨¡å¼æ˜¯å¦‚ä½•è®© Waitress èƒ½å¤Ÿå¿½ç•¥ MenuItem å’Œ Menu çš„å·®åˆ«ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–å˜é‡å’Œæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;  <span class="comment">// æ‰“å°èœå•é¡¹</span></span><br><span class="line">        System.out.print(<span class="string">"  "</span> + getName());</span><br><span class="line">        <span class="keyword">if</span> (isVegetarian()) &#123;</span><br><span class="line">            System.out.print(<span class="string">"(v)"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">", "</span> + getPrice());</span><br><span class="line">        System.out.println(<span class="string">"     -- "</span> + getDescription());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    ArrayList menuComponents = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•å’Œå˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;  <span class="comment">// æ‰“å°èœå•çš„åå­—å’Œæè¿°</span></span><br><span class="line">        System.out.print(<span class="string">"\n"</span> + getName());</span><br><span class="line">        System.out.println(<span class="string">", "</span> + getDescription());</span><br><span class="line">        System.out.println(<span class="string">"---------------------"</span>);</span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å¦‚ä½•æ‰“å°èœå•é‡Œæ¯ä¸ªèœå•é¡¹çš„å†…å®¹ï¼šæˆ‘ä»¬å¯ä»¥è®©æ¯ä¸ªç»„ä»¶æ‰“å°è‡ªå·±ã€‚</span></span><br><span class="line">        Iterator iterator = menuComponents.itertor();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="comment">// menuComponentå¯èƒ½æ˜¯èœå•ï¼Œä¹Ÿå¯èƒ½æ˜¯èœå•é¡¹ã€‚æ— è®ºå¦‚ä½•ï¼Œéƒ½æœ‰ä¸€ä¸ªprint()æ–¹æ³•ã€‚</span></span><br><span class="line">            MenuComponent menuComponent = (MenuComponent)iterator.next();</span><br><span class="line">            menuComponent.print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    MenuComponent allMenus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•å’Œå˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paintMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åªéœ€è¦è°ƒç”¨æœ€é¡¶å±‚èœå•çš„print()ï¼Œå°±å¯ä»¥æ‰“å°æ•´ä¸ªèœå•ã€‚</span></span><br><span class="line">        allMenus.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å•ä¸€è´£ä»»å’Œç»„åˆæ¨¡å¼">å•ä¸€è´£ä»»å’Œç»„åˆæ¨¡å¼</h1><p>ä½ å‘Šè¯‰æˆ‘ä»¬â€œä¸€ä¸ªç±»ï¼Œä¸€ä¸ªè´£ä»»â€ï¼ŒçŽ°åœ¨å´ç»™æˆ‘ä»¬ä¸€ä¸ªè®©ä¸€ä¸ªç±»æœ‰ä¸¤ä¸ªè´£ä»»çš„æ¨¡å¼ã€‚ç»„åˆæ¨¡å¼ä¸ä½†è¦ç®¡ç†å±‚æ¬¡ç»“æž„ï¼Œè€Œä¸”è¿˜è¦æ‰§è¡Œèœå•çš„æ“ä½œã€‚</p><p>ä½ çš„è§‚å¯Ÿæœ‰å‡ åˆ†çœŸå®žæ€§ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè¯´ï¼Œç»„åˆæ¨¡å¼ä»¥å•ä¸€è´£ä»»è®¾è®¡åŽŸåˆ™æ¢å–é€æ˜Žæ€§ï¼ˆtransparencyï¼‰ã€‚ä»€ä¹ˆæ˜¯é€æ˜Žæ€§ï¼Ÿé€šè¿‡è®©ç»„ä»¶æŽ¥å£åŒæ—¶åŒ…å«ä¸€äº›ç®¡ç†å­èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹çš„æ“ä½œï¼Œå®¢æˆ·å°±å¯ä»¥å°†ç»„åˆèŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹ä¸€è§†åŒä»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸€ä¸ªå…ƒç´ ç©¶ç«Ÿæ˜¯ç»„åˆè¿˜æ˜¯å¶èŠ‚ç‚¹ï¼Œå¯¹å®¢æˆ·æ˜¯é€æ˜Žçš„</strong>ã€‚</p><p>çŽ°åœ¨ï¼Œæˆ‘ä»¬åœ¨ MenuComponent ç±»ä¸­åŒæ—¶å…·æœ‰ä¸¤ç§ç±»åž‹çš„æ“ä½œã€‚å› ä¸ºå®¢æˆ·æœ‰æœºä¼šå¯¹ä¸€ä¸ªå…ƒç´ åšä¸€äº›ä¸æ°å½“æˆ–æ˜¯æ²¡æœ‰æ„ä¹‰çš„æ“ä½œï¼ˆä¾‹å¦‚è¯•å›¾æŠŠèœå•æ·»åŠ åˆ°èœå•é¡¹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤±åŽ»äº†ä¸€äº›â€œå®‰å…¨æ€§â€ã€‚è¿™æ˜¯è®¾è®¡ä¸Šçš„æŠ‰æ‹©ï¼šæˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹å‘çš„è®¾è®¡ï¼Œå°†è´£ä»»åŒºåˆ†å¼€æ¥æ”¾åœ¨ä¸åŒçš„æŽ¥å£ä¸­ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œè®¾è®¡ä¸Šå°±æ¯”è¾ƒå®‰å…¨ï¼Œä½†æˆ‘ä»¬ä¹Ÿå› æ­¤å¤±åŽ»äº†é€æ˜Žæ€§ï¼Œå®¢æˆ·çš„ä»£ç å°†å¿…é¡»ç”¨æ¡ä»¶è¯­å¥å’Œ instanceof æ“ä½œç¬¦å¤„ç†ä¸åŒç±»åž‹çš„èŠ‚ç‚¹ã€‚</p><p>æ‰€ä»¥ï¼Œå›žåˆ°ä½ çš„é—®é¢˜ï¼Œ<strong>è¿™æ˜¯ä¸€ä¸ªå¾ˆå…¸åž‹çš„æŠ˜è¡·æ¡ˆä¾‹ã€‚å°½ç®¡æˆ‘ä»¬å—åˆ°è®¾è®¡åŽŸåˆ™çš„æŒ‡å¯¼ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æ€»æ˜¯éœ€è¦è§‚å¯ŸæŸåŽŸåˆ™å¯¹æˆ‘ä»¬çš„è®¾è®¡æ‰€é€ æˆçš„å½±å“</strong>ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ•…æ„åšä¸€äº›è¿ååŽŸåˆ™çš„äº‹æƒ…ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›ä¾‹å­ä¸­ï¼Œè¿™æ˜¯è§‚ç‚¹çš„é—®é¢˜ï¼›æ¯”æ–¹è¯´ï¼Œè®©ç®¡ç†å­©å­çš„æ“ä½œï¼ˆä¾‹å¦‚ <code>add()</code>ã€<code>remove()</code>ã€<code>getChild()</code>ï¼‰å‡ºçŽ°åœ¨å¶èŠ‚ç‚¹ä¸­ï¼Œä¼¼ä¹Žå¾ˆä¸æ°å½“ã€‚ä½†æ˜¯æ¢ä¸ªè§’åº¦æ¥çœ‹ï¼Œä½ å¯ä»¥æŠŠå¶èŠ‚ç‚¹è§†ä¸ºæ²¡æœ‰å­©å­çš„èŠ‚ç‚¹ã€‚</p><h1 id="ç»„åˆè¿­ä»£å™¨éåŽ†ç»„åˆèœå•">ç»„åˆè¿­ä»£å™¨ï¼šéåŽ†ç»„åˆèœå•</h1><p>æˆ‘ä»¬ç­”åº”è¿‡ä¼šå‘Šè¯‰ä½ æ€Žæ ·ç”¨ç»„åˆæ¥ä½¿ç”¨è¿­ä»£å™¨ã€‚æˆ‘ä»¬å…¶å®žå·²ç»åœ¨ <code>print()</code> æ–¹æ³•å†…éƒ¨çš„å®žçŽ°ä¸­ä½¿ç”¨äº†è¿­ä»£å™¨ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æžœæœ‰éœ€è¦ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä½¿ç”¨è¿­ä»£å™¨éåŽ†æ•´ä¸ªç»„åˆã€‚æ¯”æ–¹è¯´ï¼Œæ¸¸èµ°æ•´ä¸ªèœå•ï¼ŒæŒ‘å‡ºç´ é£Ÿé¡¹ã€‚</p><p><em>éåŽ†æ‰“å°èœå•å’ŒéåŽ†èœå•æ˜¯ä¸åŒçš„ã€‚å‰è€…æˆ‘ä»¬å·²ç»å®žçŽ°ï¼›åŽè€…è¦æ±‚å®¢æˆ·èƒ½å–å‡ºæ¯ä¸€ä¸ªèœå•é¡¹ï¼Œè€Œä¸å•å•æ˜¯æ˜¾ç¤ºå…¶å†…å®¹ã€‚åŽé¢æˆ‘ä»¬ä¼šè§£é‡Šï¼Œè¿™æ˜¯å†…éƒ¨è¿­ä»£å™¨å’Œå¤–éƒ¨è¿­ä»£å™¨çš„åŒºåˆ«ã€‚</em></p><p>æƒ³è¦å®žçŽ°ä¸€ä¸ªç»„åˆè¿­ä»£å™¨ï¼Œè®©æˆ‘ä»¬ä¸ºæ¯ä¸ªç»„ä»¶éƒ½åŠ ä¸Š <code>createIterator()</code> æ–¹æ³•ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/fLDDIyD04BtdL-on7Xh_W1IaNWGjWg3dxMRQB6GtONOhbZGNGGeYr9CAdlmJfQZWdp6b_WktgSr74qcBnxnvy_9ctgpB7I0W0Zqa0aGNq7AN2EF8FB1eLscaJ9DJa8EsBm9VWjGaj0ZfW-vG0Oqz4fBzVJA_Uud7RulFXyNh_Vnf6d_SnBCPYLR48r0CUQ2vBxVYdo5dMoXpTG66JP7JBNG3v5BNqwZZDB99ePQF8FmhsAd5U6wxt7CQnX3XjNI6G3KSQq2gVQoR8BAOHvLA4ZCz8WdhN9lX-qIQmCnNsEFWET5I9RwTVhq_nfFdx_4a7sf5ReLeIjlF5bpXk62gmj0X8XsUSAND3URkJFt7Q-PcCz7gqCgvL0zYQe0zoe2iuMIWSFrK8k9IrO7hrRzpiAp0Vdra2qeSAPxzCn7FAwOofTxEmFDsQhkaN2EOJhjLVE1MyRaVZ9hDz9x-gctYQxWyaMsFMkdoh8BhOYazOTiOpFEIIeAMr7D3sPdK3m00"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–éƒ¨åˆ†çš„ä»£ç ä¸éœ€è¦ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// CompositeIteratorå¯ä»¥éåŽ†ç»„åˆèœå•ï¼ˆåŒ…æ‹¬å­èœå•ï¼‰</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å°†ç›®å‰ç»„åˆçš„è¿­ä»£å™¨ä¼ å…¥å®ƒçš„æž„é€ å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CompositeIterator(menuComponents.iterator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuItem</span> <span class="keyword">extends</span> <span class="title">MenuComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–éƒ¨åˆ†çš„ä»£ç ä¸éœ€è¦ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NullIterator();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CompositeIterator æ˜¯ä¸€ä¸ªä¸å®¹å°è§‘çš„è¿­ä»£å™¨ã€‚å®ƒçš„å·¥ä½œæ˜¯éåŽ†ç»„ä»¶å†…çš„èœå•é¡¹ï¼Œè€Œä¸”ç¡®ä¿æ‰€æœ‰çš„å­èœå•ï¼ˆä»¥åŠå­å­èœå•â€¦â€¦ï¼‰éƒ½è¢«åŒ…æ‹¬è¿›æ¥ã€‚æ³¨æ„ï¼šè·Ÿç€æˆ‘é»˜å¿µâ€œé€’å½’æ˜¯æˆ‘çš„æœ‹å‹ï¼Œé€’å½’æ˜¯æˆ‘çš„æœ‹å‹â€¦â€¦â€</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositeIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">    Stack stack = <span class="keyword">new</span> Stack();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CompositeIterator</span><span class="params">(Iterator iterator)</span> </span>&#123;</span><br><span class="line">        stack.push(iterator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hasNext()) &#123;</span><br><span class="line">            Iterator iterator = (Iterator) stack.peek();</span><br><span class="line">            MenuComponent component = (MenuComponent) iterator.next();</span><br><span class="line">            <span class="comment">// å¦‚æžœå…ƒç´ æ˜¯ä¸€ä¸ªèœå•ï¼Œå°†å®ƒä¸¢è¿›å †æ ˆä¸­</span></span><br><span class="line">            <span class="comment">// ä¸‹æ¬¡next()è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå°±èƒ½ä»Žå­èœå•ä¸­å–å‡ºå…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span> (component <span class="keyword">instanceof</span> Menu) &#123;</span><br><span class="line">                stack.push(component.createIterator());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> component</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (stack.empty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Iterator iterator = (Iterator) stack.peek();</span><br><span class="line">            <span class="comment">// è‹¥å½“å‰æ ˆé¡¶çš„è¿­ä»£å™¨ä¸ºç©ºï¼Œåˆ™ä¸¢å¼ƒå®ƒï¼Œå†æ¬¡æ£€æŸ¥æ ˆé¡¶</span></span><br><span class="line">            <span class="keyword">if</span> (!iterator.hasNext()) &#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">                <span class="keyword">return</span> hasNext(); <span class="comment">// é€’å½’è°ƒç”¨hasNext()</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸æ‰“ç®—æ”¯æŒåˆ é™¤æ“ä½œ</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœŸæ˜¯ä¸å¯å°è§‘çš„ä»£ç â€¦â€¦ç©¶ç«Ÿä¸ºä»€ä¹ˆéåŽ†ç»„åˆå¥½åƒæ¯”ä»¥å‰ä¸º MenuComponent ç±»çš„ <code>print()</code> å†™è¿‡çš„éåŽ†ä»£ç å¤æ‚ï¼Ÿ</p><p>åœ¨æˆ‘ä»¬å†™ MenuComponent ç±»çš„ <code>print()</code> æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†ä¸€ä¸ªè¿­ä»£å™¨æ¥éåŽ†ç»„ä»¶å†…çš„æ¯ä¸ªé¡¹ã€‚å¦‚æžœé‡åˆ°çš„æ˜¯èœå•ï¼Œæˆ‘ä»¬å°±ä¼šé€’å½’åœ°è°ƒç”¨ <code>print()</code> æ–¹æ³•å¤„ç†å®ƒã€‚æ¢å¥è¯è¯´ï¼ŒMenuComponent æ˜¯åœ¨â€œå†…éƒ¨â€è‡ªè¡Œå¤„ç†éåŽ†ã€‚</p><p>ä½†æ˜¯åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®žçŽ°çš„æ˜¯ä¸€ä¸ªâ€œå¤–éƒ¨â€çš„è¿­ä»£å™¨ï¼Œæ‰€ä»¥æœ‰è®¸å¤šéœ€è¦è¿½è¸ªçš„äº‹æƒ…ã€‚å¤–éƒ¨è¿­ä»£å™¨å¿…é¡»ç»´æŠ¤å®ƒåœ¨éåŽ†ä¸­çš„ä½ç½®ï¼Œä»¥ä¾¿å¤–éƒ¨å®¢æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨ <code>hasNext()</code> å’Œ <code>next()</code> æ¥é©±åŠ¨éåŽ†ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç ä¹Ÿå¿…é¡»ç»´æŠ¤ç»„åˆé€’å½’ç»“æž„çš„ä½ç½®ã€‚</p><h2 id="ç©ºè¿­ä»£å™¨">ç©ºè¿­ä»£å™¨</h2><p>èœå•é¡¹å†…æ²¡ä»€ä¹ˆå¯ä»¥éåŽ†çš„ï¼Œå¯¹å§ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•å®žçŽ°èœå•é¡¹çš„ <code>createIterator()</code> æ–¹æ³•å‘¢ï¼Ÿæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li><p>é€‰æ‹©ä¸€ï¼šè¿”å›ž null</p><p>æˆ‘ä»¬å¯ä»¥è®© <code>createIterator()</code> æ–¹æ³•è¿”å›ž nullï¼Œä½†æ˜¯å¦‚æžœè¿™ä¹ˆåšï¼Œæˆ‘ä»¬çš„å®¢æˆ·ä»£ç å°±éœ€è¦æ¡ä»¶è¯­å¥æ¥åˆ¤æ–­è¿”å›žå€¼æ˜¯å¦ä¸º nullã€‚</p></li><li><p>é€‰æ‹©äºŒï¼šè¿”å›žä¸€ä¸ªè¿­ä»£å™¨ï¼Œè€Œè¿™ä¸ªè¿­ä»£å™¨çš„ <code>hasNext()</code> æ°¸è¿œè¿”å›ž false</p><p>è¿™ä¼¼ä¹Žæ˜¯ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¾ç„¶å¯ä»¥è¿”å›žä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®¢æˆ·ä¸ç”¨å†æ‹…å¿ƒè¿”å›žå€¼æ˜¯å¦ä¸º nullã€‚æˆ‘ä»¬ç­‰äºŽæ˜¯åˆ›å»ºäº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå…¶ä½œç”¨æ˜¯â€œæ²¡ä½œç”¨â€ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NullIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»™æˆ‘ç´ é£Ÿèœå•">ç»™æˆ‘ç´ é£Ÿèœå•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waitress</span> </span>&#123;</span><br><span class="line">    MenuComponent allMenus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printVegetarianMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterator iterator = allMenus.createIterator();</span><br><span class="line">        System.out.println(<span class="string">"\nVEGETARIAN MENU\n----"</span>);</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            MenuComponent menuComponent = (MenuComponent)iterator.next();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (menuComponent.isVegetarian()) &#123;</span><br><span class="line">                    menuComponent.print();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedOperationException e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>printVegetarianMenu()</code> æ–¹æ³•å†…ä½¿ç”¨äº† try/catch æ¥å¤„ç†é‚£äº›ä¸æ”¯æŒ <code>isVegetarian()</code> æ–¹æ³•çš„èœå•çš„é€»è¾‘ã€‚</p><p>try/catch æ˜¯ä¸€ç§é”™è¯¯å¤„ç†çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç¨‹åºé€»è¾‘çš„æ–¹æ³•ã€‚å¦‚æžœä¸è¿™ä¹ˆåšï¼Œæˆ‘ä»¬è¿˜æœ‰å“ªäº›é€‰æ‹©å‘¢ï¼Ÿ<strong>æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨ <code>isVegetarian()</code> æ–¹æ³•ä¹‹å‰ï¼Œç”¨ instanceof æ¥æ£€æŸ¥èœå•ç»„ä»¶çš„è¿è¡Œæ—¶ç±»åž‹ï¼Œä»¥ç¡®å®šå®ƒæ˜¯èœå•é¡¹ã€‚ä½†æ˜¯è¿™ä¹ˆåšï¼Œæˆ‘ä»¬å°±ä¼šå› ä¸ºæ— æ³•ç»Ÿä¸€å¤„ç†èœå•å’Œèœå•é¡¹è€Œå¤±åŽ»é€æ˜Žæ€§</strong>ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹å†™ Menu çš„ <code>isVegetarian()</code> æ–¹æ³•ï¼Œè®©å®ƒè¿”å›ž falseã€‚è¿™æä¾›äº†ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿä¿æŒäº†é€æ˜Žæ€§ã€‚</p><p>æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºäº†è¦æ¸…æ¥šåœ°è¡¨ç¤ºæˆ‘ä»¬çš„æƒ³æ³•ã€‚<strong>æˆ‘ä»¬çœŸæ­£æƒ³è¦ä¼ è¾¾çš„æ˜¯ï¼š<code>isVegetarian()</code> æ˜¯ Menu æ²¡æœ‰æ”¯æŒçš„æ“ä½œï¼ˆè¿™å’Œè¯´ <code>isVegetarian()</code> æ˜¯ false æ„ä¹‰ä¸ç­‰åŒï¼‰ã€‚è¿™æ ·çš„åšæ³•ä¹Ÿå…è®¸åŽæ¥äººä¸º Menu å®žçŽ°ä¸€ä¸ªåˆç†çš„ <code>isVegetarian()</code> æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬ä¸å¿…ä¸ºæ­¤åœ¨ä¿®æ”¹è¿™é‡Œçš„ä»£ç äº†</strong>ã€‚</p><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>è¿­ä»£å™¨å…è®¸è®¿é—®èšåˆçš„å…ƒç´ ï¼Œè€Œä¸éœ€è¦æš´éœ²å®ƒçš„å†…éƒ¨ç»“æž„ã€‚</li><li>è¿­ä»£å™¨å°†éåŽ†èšåˆçš„å·¥ä½œå°è£…è¿›ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚</li><li>å½“ä½¿ç”¨è¿­ä»£å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¾èµ–èšåˆæä¾›éåŽ†ã€‚ï¼ˆè¿™å¾ˆåˆç†ï¼Œé¿å…æˆ‘ä»¬åŽ»æ‹·è´èšåˆçš„å†…å®¹ï¼ŒèŠ‚çœäº†ç©ºé—´ã€‚ä½†æ˜¯æˆ‘ä»¬æ˜¯ä¸æ˜¯æ²¡æœ‰åœ¨ UML ç±»å›¾ä¸­åŠ ä¸Š ConcreateIterator æŒ‡å‘ Iterator çš„ä¾èµ–ç®­å¤´ï¼Ÿï¼‰</li><li>è¿­ä»£å™¨æä¾›äº†ä¸€ä¸ªé€šç”¨çš„æŽ¥å£ï¼Œè®©æˆ‘ä»¬éåŽ†èšåˆçš„é¡¹ï¼Œå½“æˆ‘ä»¬ç¼–ç ä½¿ç”¨èšåˆçš„é¡¹æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å¤šæ€æœºåˆ¶ã€‚</li><li>æˆ‘ä»¬åº”è¯¥åŠªåŠ›è®©ä¸€ä¸ªç±»åªåˆ†é…ä¸€ä¸ªè´£ä»»ã€‚</li><li>ç»„åˆæ¨¡å¼æä¾›ä¸€ä¸ªç»“æž„ï¼Œå¯åŒæ—¶åŒ…å®¹ä¸ªåˆ«å¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚</li><li>ç»„åˆæ¨¡å¼å…è®¸å®¢æˆ·å¯¹ä¸ªåˆ«å¯¹è±¡ä»¥åŠç»„åˆå¯¹è±¡ä¸€è§†åŒä»ã€‚</li><li>ç»„åˆç»“æž„å†…çš„ä»»æ„å¯¹è±¡ç§°ä¸ºç»„ä»¶ï¼Œç»„ä»¶å¯ä»¥æ˜¯ç»„åˆï¼Œä¹Ÿå¯ä»¥æ˜¯å¶èŠ‚ç‚¹ã€‚</li><li>åœ¨å®žçŽ°ç»„åˆæ¨¡å¼æ—¶ï¼Œæœ‰è®¸å¤šè®¾è®¡ä¸Šçš„æŠ˜è¡·ã€‚ä½ è¦æ ¹æ®éœ€è¦å¹³è¡¡é€æ˜Žæ€§ï¼ˆä¸€ä¸ªç±»ä¸¤ä¸ªè´£ä»»ï¼‰å’Œå®‰å…¨æ€§ï¼ˆç»„ä»¶åŒæ—¶å®žçŽ°ç»„åˆçš„æŽ¥å£å’Œå¶èŠ‚ç‚¹çš„æŽ¥å£ï¼‰ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python str.title æ–¹æ³•</title>
      <link href="/documentation/python-str-title-function/"/>
      <url>/documentation/python-str-title-function/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://devdocs.io/python~3.6/library/stdtypes#str.title" target="_blank" rel="noopener"><code>str.title()</code></a></p></blockquote><p>Return a titlecased version of the string where words start with an uppercase character and the remaining characters are lowercase.</p><p>For example:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'Hello world'</span>.title()</span><br><span class="line"><span class="string">'Hello World'</span></span><br></pre></td></tr></table></figure><p>The algorithm uses a simple language-independent definition of a word as groups of consecutive letters. The definition works in many contexts but it means that apostrophes in contractions and possessives form word boundaries, which may not be the desired result:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"they're bill's friends from the UK"</span>.title()</span><br><span class="line"><span class="string">"They'Re Bill'S Friends From The Uk"</span></span><br></pre></td></tr></table></figure><p>A workaround for apostrophes can be constructed using regular expressions:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">titlecase</span><span class="params">(s)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> re.sub(<span class="string">r"[A-Za-z]+('[A-Za-z]+)?"</span>,</span><br><span class="line"><span class="meta">... </span>                  <span class="keyword">lambda</span> mo: mo.group(<span class="number">0</span>)[<span class="number">0</span>].upper() +</span><br><span class="line"><span class="meta">... </span>                             mo.group(<span class="number">0</span>)[<span class="number">1</span>:].lower(),</span><br><span class="line"><span class="meta">... </span>                  s)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>titlecase(<span class="string">"they're bill's friends."</span>)</span><br><span class="line"><span class="string">"They're Bill's Friends."</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/template-method-pattern/"/>
      <url>/notes/head-first-design-patterns/template-method-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥èŒ¶å’Œå’–å•¡">å¯¼å…¥ï¼šèŒ¶å’Œå’–å•¡</h1><p>æœ‰äº›äººæ²¡æœ‰å’–å•¡å°±æ´»ä¸ä¸‹åŽ»ï¼›æœ‰äº›äººåˆ™ç¦»ä¸å¼€èŒ¶ã€‚ä¸¤è€…å…±åŒçš„æˆåˆ†æ˜¯ä»€ä¹ˆï¼Ÿå½“ç„¶æ˜¯å’–å•¡å› äº†ï¼ä½†è¿˜ä¸åªè¿™æ ·ï¼šèŒ¶å’Œå’–å•¡çš„å†²æ³¡æ–¹å¼éžå¸¸ç›¸ä¼¼ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ˜Ÿå·´å…¹å’–å•¡å†²æ³¡æ³•ï¼š</span><br><span class="line">1. æŠŠæ°´ç…®æ²¸</span><br><span class="line">2. ç”¨æ²¸æ°´å†²æ³¡å’–å•¡</span><br><span class="line">3. æŠŠå’–å•¡å€’è¿›æ¯å­</span><br><span class="line">4. åŠ ç³–å’Œç‰›å¥¶</span><br><span class="line"></span><br><span class="line">æ˜Ÿå·´å…¹èŒ¶å†²æ³¡æ³•</span><br><span class="line">1. æŠŠæ°´ç…®æ²¸</span><br><span class="line">2. ç”¨æ²¸æ°´æµ¸æ³¡èŒ¶å¶</span><br><span class="line">3. æŠŠèŒ¶å€’è¿›æ¯å­</span><br><span class="line">4. åŠ æŸ æª¬</span><br></pre></td></tr></table></figure><p>èŒ¶å’Œå’–å•¡çš„ç±»ï¼š</p><img src="http://www.plantuml.com/plantuml/svg/ZOqx3i8m40Lxdy8b70Ce418qW4IziLyI2tzMQri88UwEar1IKCvezDxeB3G2bwSE21r4ZPCnJeo7CfvorhlKzu1-AQrPm2GumpZ6QjrCbvo_KO4i97Wi-LvSj7cMdAeSegay4rbxgGF99jgJy_Vctj-VA-Ylarm0Rl6MXj_xHuGKf-4F"><p>èŒ¶å’Œå’–å•¡çš„ç±»å­˜åœ¨ç€é‡å¤çš„ä»£ç ã€‚ä½ ä¼šå¦‚ä½•é‡æ–°è®¾è®¡è¿™äº›ç±»æ¥åˆ é™¤é‡å¤ä»£ç ï¼Ÿ</p><a id="more"></a><h1 id="å°è£…ç®—æ³•">å°è£…ç®—æ³•</h1><p>ä¸¤ä»½å†²æ³¡æ³•éƒ½é‡‡ç”¨äº†ç›¸åŒçš„ç®—æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. æŠŠæ°´ç…®æ²¸</span><br><span class="line">2. ç”¨çƒ­æ°´æ³¡å’–å•¡æˆ–èŒ¶</span><br><span class="line">3. æŠŠé¥®æ–™å€’è¿›æ¯å­</span><br><span class="line">4. åœ¨é¥®æ–™å†…åŠ å…¥é€‚å½“çš„è°ƒæ–™</span><br></pre></td></tr></table></figure><p><code>brewCoffeeGrinds()</code> å’Œ <code>steepTeaBag()</code> å·®å¼‚å…¶å®žä¸å¤§ã€‚æˆ‘ä»¬ç»™å®ƒä¸€ä¸ªæ–°çš„æ–¹æ³•åç§°ï¼Œæ¯”æ–¹è¯´ <code>brew()</code>ï¼Œç„¶åŽä¸ç®¡æ˜¯æ³¡èŒ¶æˆ–å†²æ³¡å’–å•¡æˆ‘ä»¬éƒ½ç”¨è¿™ä¸ªåç§°ã€‚ç±»ä¼¼åœ°ï¼ŒåŠ ç³–å’Œç‰›å¥¶ä¹Ÿå’ŒåŠ æŸ æª¬å¾ˆç›¸ä¼¼ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/XO-nJW9148RxUuejeQ3GqbX9PMjCR6ZsxkPWaxkzozw2CKX2r8942pM2WX2r824gK9YOKr4UnjqzhNW5Lq0b4cCty___V3EJ8pOWy0A-XJpmJ616xbEn2BDSC2mNXo5A-uu3W8e6GYQ3pKHI5zYsqpwrYGUKXrefJRFhWFyBOZFa35iSfR7c4WehK026ivCD1P_Oo24KkoXW4606Qs2H0COmqoVk1kR0nbtWvzagjVB1k2j-SKi_osUq-JlcrYzlfrBJP_ymzNS6zJaWHh8vZdndxeUbtrUhixwg78cdsxYnfpfNgZLKjGTrLtqjxsIeFByKqUDeqCZGn48IgNurlhcGlLqz9AAoYAvdied59D9MVD8Hpys96_TEjViD7WqEPBFpDgnhAqF5oxxi7egeg-L9K5Frj6grPULUC-HnJLQlz0dlxPwgrJNc0m00"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">final</span> <span class="title">prepareRecipe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    boilWater();</span><br><span class="line">    brew();</span><br><span class="line">    pourInCup();</span><br><span class="line">    addCondiments();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å®šä¹‰æ¨¡æ¿æ–¹æ³•æ¨¡å¼">å®šä¹‰æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h1><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æž¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æž„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ã€‚</p><p>ä»€ä¹ˆæ˜¯æ¨¡æ¿ï¼Ÿå¦‚ä½ æ‰€è§çš„ï¼Œæ¨¡æ¿å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å°†ç®—æ³•å®šä¹‰æˆä¸€ç»„æ­¥éª¤ï¼Œå…¶ä¸­çš„ä»»ä½•æ­¥éª¤éƒ½å¯ä»¥æ˜¯æŠ½è±¡çš„ï¼Œç”±å­ç±»è´Ÿè´£å®žçŽ°ã€‚è¿™å¯ä»¥ç¡®ä¿ç®—æ³•çš„ç»“æž„ä¿æŒä¸å˜ï¼ŒåŒæ—¶ç”±å­ç±»æä¾›éƒ¨åˆ†å®žçŽ°ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA3X26SuvYSN52jLS2WebG4qvYIMflgab6Vaf6feArGe5HPcvcIMPPQd-1Qb5YIMP-Nc66fhM2dfwUWgrG1tLCDDgiQiafCG8gAIMAndi0kVylEIYr99KX7jm6OdB75GVsTG07ObYA5TUVacgGb5cUaQ9GduQQW1OAJphsljYuyBdirgURzpzVa_FqvxMfnDMFzdLzcp5mcTpzp-RjlFPvgcF6vhG346nm4hXQV_w5yrxdytfVB5knzCbivxiMFMqTVkJlPCXPZvRt_zaHmDGC2RlPVFUf-lcFU_RW6R3iyw6btCQWAvushhYPVEAPvDxd-oT0m00"><h1 id="å¯¹æ¨¡æ¿æ–¹æ³•è¿›è¡ŒæŒ‚é’©">å¯¹æ¨¡æ¿æ–¹æ³•è¿›è¡ŒæŒ‚é’©</h1><p>é’©å­ï¼ˆhookï¼‰æ˜¯ä¸€ç§è¢«å£°æ˜Žåœ¨æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•ï¼Œä½†åªæœ‰ç©ºçš„æˆ–è€…é»˜è®¤çš„å®žçŽ°ã€‚é’©å­çš„å­˜åœ¨ï¼Œå¯ä»¥è®©å­ç±»æœ‰èƒ½åŠ›å¯¹ç®—æ³•çš„ä¸åŒç‚¹è¿›è¡ŒæŒ‚é’©ã€‚è¦ä¸è¦æŒ‚é’©ï¼Œç”±å­ç±»è‡ªè¡Œå†³å®šã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CaffeineBeverage</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">prepareRecipe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        boilWater();</span><br><span class="line">        brew();</span><br><span class="line">        pourInCup();</span><br><span class="line">        <span class="keyword">if</span> (customerWantsCondiments()) &#123;</span><br><span class="line">            addCondiments();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">brew</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™å°±æ˜¯ä¸€ä¸ªé’©å­ï¼Œå­ç±»å¯ä»¥è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œä½†ä¸è§å¾—ä¸€å®šè¦è¿™ä¹ˆåš</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">customerWantsCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸ä¸€å®šæ°å½“ï¼Œä½†ä½ å¿…é¡»è®¤è¯†åˆ°ï¼Œé’©å­èƒ½ä½œä¸ºæ¡ä»¶æŽ§åˆ¶ï¼Œå½±å“æŠ½è±¡ç±»ä¸­çš„ç®—æ³•æµç¨‹ã€‚</p><ul><li><p><strong>é—®</strong>ï¼šå½“æˆ‘åˆ›å»ºä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ—¶ï¼Œæ€Žä¹ˆæ‰èƒ½çŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥ä½¿ç”¨æŠ½è±¡æ–¹æ³•ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨é’©å­å‘¢ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå½“ä½ çš„å­ç±»â€œå¿…é¡»â€æä¾›ç®—æ³•ä¸­æŸä¸ªæ–¹æ³•æˆ–æ­¥éª¤çš„å®žçŽ°æ—¶ï¼Œå°±æ˜¯ç”¨æŠ½è±¡æ–¹æ³•ã€‚å¦‚æžœç®—æ³•çš„è¿™ä¸ªéƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œå°±ç”¨é’©å­ã€‚</p></li><li><p><strong>é—®</strong>ï¼šä½¿ç”¨é’©å­çœŸæ­£çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>ç­”</strong>ï¼šé’©å­æœ‰å‡ ç§ç”¨æ³•ã€‚å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„ï¼Œé’©å­å¯ä»¥è®©å­ç±»å®žçŽ°ç®—æ³•ä¸­çš„å¯é€‰éƒ¨åˆ†ï¼Œæˆ–è€…åœ¨é’©å­å¯¹äºŽå­ç±»çš„å®žçŽ°å¹¶ä¸é‡è¦çš„æ—¶å€™ï¼Œå­ç±»å¯ä»¥å¯¹æ­¤é’©å­ç½®ä¹‹ä¸ç†ã€‚é’©å­çš„å¦ä¸€ä¸ªç”¨æ³•ï¼Œæ˜¯è®©å­ç±»èƒ½å¤Ÿæœ‰æœºä¼šå¯¹æ¨¡æ¿æ–¹æ³•ä¸­æŸäº›å³å°†å‘ç”Ÿçš„ï¼ˆæˆ–åˆšåˆšå‘ç”Ÿçš„ï¼‰æ­¥éª¤ä½œå‡ºååº”ã€‚æ¯”æ–¹è¯´ï¼Œåä¸º <code>justReOrderedList()</code> çš„é’©å­æ–¹æ³•å…è®¸å­ç±»åœ¨å†…éƒ¨åˆ—è¡¨é‡æ–°ç»„ç»‡åŽæ‰§è¡ŒæŸäº›åŠ¨ä½œï¼ˆä¾‹å¦‚åœ¨å±å¹•ä¸Šé‡æ–°çŽ°å®žæ•°æ®ï¼‰ã€‚</p></li><li><p><strong>é—®</strong>ï¼šä¼¼ä¹Žæˆ‘åº”è¯¥ä¿æŒæŠ½è±¡æ–¹æ³•çš„æ•°ç›®è¶Šå°‘è¶Šå¥½ï¼Œå¦åˆ™ï¼Œåœ¨å­ç±»ä¸­å®žçŽ°è¿™äº›æ–¹æ³•å°†ä¼šå¾ˆéº»çƒ¦ã€‚</p><p><strong>ç­”</strong>ï¼šæ˜¯çš„ï¼Œå½“ä½ åœ¨äº›æ¨¡æ¿æ–¹æ³•çš„æ—¶å€™ï¼Œå¿ƒé‡Œè¦éšæ—¶è®°å¾—è¿™ä¸€ç‚¹ã€‚æƒ³è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œ<strong>å¯ä»¥è®©ç®—æ³•å†…çš„æ­¥éª¤ä¸è¦åˆ‡å‰²å¾—å¤ªç»†ï¼Œä½†æ˜¯å¦‚æžœæ­¥éª¤å¤ªå°‘çš„è¯ï¼Œä¼šæ¯”è¾ƒæ²¡æœ‰å¼¹æ€§ï¼Œæ‰€ä»¥è¦çœ‹æƒ…å†µæŠ˜è¡·</strong>ã€‚</p><p>ä¹Ÿè¯·è®°ä½ï¼ŒæŸäº›æ­¥éª¤æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥å°†è¿™äº›æ­¥éª¤å®žçŽ°æˆé’©å­ï¼Œè€Œä¸æ˜¯å®žçŽ°æˆæŠ½è±¡æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥è®©æŠ½è±¡ç±»çš„å­ç±»çš„è´Ÿè·å‡è½»ã€‚</p></li></ul><h1 id="å¥½èŽ±åžåŽŸåˆ™">å¥½èŽ±åžåŽŸåˆ™</h1><blockquote><p>åˆ«è°ƒç”¨ï¼ˆæ‰“ç”µè¯ç»™ï¼‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ï¼ˆæ‰“ç”µè¯ç»™ï¼‰ä½ ã€‚</p></blockquote><p>å¥½èŽ±åžåŽŸåˆ™å¯ä»¥ç»™æˆ‘ä»¬ä¸€ç§é˜²æ­¢â€œä¾èµ–è…è´¥â€çš„æ–¹æ³•ã€‚åœ¨å¥½èŽ±åžåŽŸåˆ™ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å…è®¸ä½Žå±‚ç»„ä»¶å°†è‡ªå·±æŒ‚é’©åˆ°ç³»ç»Ÿä¸Šï¼Œä½†æ˜¯é«˜å±‚ç»„ä»¶ä¼šå†³å®šä»€ä¹ˆæ—¶å€™å’Œæ€Žæ ·ä½¿ç”¨è¿™äº›ä½Žå±‚ç»„ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œé«˜å±‚ç»„ä»¶å¯¹ä½Žå±‚ç»„ä»¶çš„æ–¹å¼æ˜¯â€œåˆ«è°ƒç”¨æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä½ â€ã€‚</p><p>å¥½èŽ±åžåŽŸåˆ™å’Œæ¨¡æ¿æ–¹æ³•ä¹‹é—´çš„è¿žæŽ¥å…¶å®žè¿˜ç®—æ˜Žæ˜¾ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/XP3BJi9058RtVOfPwe8N8CQ5hDmQ4nVYOcWFqgIqpL0q1aaG204Z5nCH59IOU26e298Gj5uUniwqh7m5Xu8k8CJTp7--y__dd90i0OAmRkoXC8G3G8JGI15b8YeWu43485Wqa0y7Wo2hi08xGF0se9Y0a4v0nmJMG9HrM5ZaIa2JbGri075_kXObgwelghk_sAzP70K8x4vhM99ycYh9OL2D22_61L71aGZoQJnvdFVNDezT1_mVEBF8qhx7CmcPK-IkmcGApoQ_ZWJgrhAhgfe1I86WWRJWp8cyCmghFh7iiMK-sEVfuNsLTfEscRRC_lVRaL-bxPIJUgVN3LQueza-pJoptXNhbJbhjolymIbQRB5wZjQRmth2kJtWJOybkslIzgLTwB16oHgqsEaBPrbbPCfoUQUJia-QO-mhaPoQs5tAYvpFC-krDl4gjknsWkRBl8rTtFXLLYnP7pLha1WXRf1jPfp397Vx0G00"><p>è¿˜æœ‰å“ªäº›æ¨¡å¼é‡‡ç”¨äº†å¥½èŽ±åžåŽŸåˆ™ï¼Ÿï¼ˆå·¥åŽ‚æ–¹æ³•ã€è§‚å¯Ÿè€…ï¼‰</p><p><strong>é—®</strong>ï¼šä½Žå±‚ç»„ä»¶ä¸å¯ä»¥è°ƒç”¨é«˜å±‚ç»„ä»¶ä¸­çš„æ–¹æ³•å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå¹¶ä¸å°½ç„¶ã€‚äº‹å®žä¸Šï¼Œä½Žå±‚ç»„ä»¶åœ¨ç»“æŸæ—¶ï¼Œå¸¸å¸¸ä¼šè°ƒç”¨ä»Žè¶…ç±»ä¸­ç»§æ‰¿æ¥çš„æ–¹æ³•ã€‚æˆ‘ä»¬æ‰€è¦åšçš„æ˜¯ï¼Œ<strong>é¿å…è®©é«˜å±‚å’Œä½Žå±‚ç»„ä»¶ä¹‹é—´æœ‰æ˜Žæ˜¾çš„çŽ¯çŠ¶ä¾èµ–</strong>ã€‚</p><table><thead><tr class="header"><th>æ¨¡å¼</th><th>å™è¿°</th></tr></thead><tbody><tr class="odd"><td>æ¨¡æ¿æ–¹æ³•</td><td>å­ç±»å†³å®šå¦‚ä½•å®žçŽ°ç®—æ³•ä¸­çš„æ­¥éª¤</td></tr><tr class="even"><td>ç­–ç•¥</td><td>å°è£…å¯äº’æ¢çš„è¡Œä¸ºï¼Œç„¶åŽä½¿ç”¨å§”æ‰˜æ¥å†³å®šè¦é‡‡ç”¨å“ªä¸€ä¸ªè¡Œä¸º</td></tr><tr class="odd"><td>å·¥åŽ‚æ–¹æ³•</td><td>ç”±å­ç±»å†³å®šå®žä¾‹åŒ–å“ªä¸ªå…·ä½“ç±»</td></tr></tbody></table><h1 id="è’é‡Žä¸­çš„æ¨¡æ¿æ–¹æ³•">è’é‡Žä¸­çš„æ¨¡æ¿æ–¹æ³•</h1><h2 id="æŽ’åº">æŽ’åº</h2><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¨¡å¼ï¼Œåˆ°å¤„éƒ½æ˜¯ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä½ å¿…é¡»æ‹¥æœ‰ä¸€åŒé”åˆ©çš„çœ¼ç›ï¼Œå› ä¸ºæ¨¡æ¿æ–¹æ³•æœ‰è®¸å¤šå®žçŽ°ï¼Œè€Œå®ƒä»¬çœ‹èµ·æ¥å¹¶ä¸ä¸€å®šå’Œä¹¦ä¸Šæ‰€è®²çš„è®¾è®¡ä¸€è‡´ã€‚</p><p>æˆ‘ä»¬ç»å¸¸ç”¨æ•°ç»„åšä»€ä¹ˆäº‹æƒ…ï¼Ÿå¯¹äº†ï¼æŽ’åºã€‚Java æ•°ç»„ç±»çš„è®¾è®¡è€…æä¾›äº†æˆ‘ä»¬ä¸€ä¸ªæ–¹ä¾¿çš„æ¨¡æ¿æ–¹æ³•ç”¨æ¥æŽ’åºã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å¦‚ä½•è¿è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// sort()åªæ˜¯ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæ•°ç»„çš„æ‹·è´ï¼Œç„¶åŽè°ƒç”¨æŽ’åºç®—æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Object[] a)</span> </span>&#123;</span><br><span class="line">    Object aux[] = (Object[])a.clone();</span><br><span class="line">    mergeSort(aux, a, <span class="number">0</span>, a.length, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mergeSort()åŒ…å«æŽ’åºç®—æ³•ï¼Œæ­¤ç®—æ³•ä¾èµ–äºŽcompareTo()æ–¹æ³•çš„å®žçŽ°æ¥å®Œæˆç®—æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(Object src[], Object dest[],</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span> off)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=low; i&lt;hight; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=i; j&gt;low &amp;&amp;</span><br><span class="line">             ((Comparable)dest[j-<span class="number">1</span>]).compareTo((Comparable)dest[j])&gt;<span class="number">0</span>; j--) &#123;</span><br><span class="line">               swap(dest, j, j-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å®žçŽ° <code>compareTo()</code> æ–¹æ³•ï¼Œâ€œå¡«è¡¥â€æ¨¡æ¿æ–¹æ³•çš„ç¼ºæ†¾ã€‚</p><p><strong>é—®</strong>ï¼šæˆ‘ä»¬ä¸æ˜¯åº”è¯¥è¦ç»§æ‰¿ä»€ä¹ˆä¸œè¥¿å—ï¼Ÿæˆ‘è®¤ä¸ºè¿™æ‰æ˜¯æ¨¡æ¿æ–¹æ³•çš„å…³é”®æ‰€åœ¨ã€‚æ•°ç»„æ— æ³•ç»§æ‰¿ï¼Œæ‰€ä»¥æˆ‘ä¸çŸ¥é“è¦å¦‚ä½•ä½¿ç”¨ <code>sort()</code>ã€‚</p><p><strong>ç­”</strong>ï¼šäº‹æƒ…æ˜¯è¿™æ ·çš„ï¼š<code>sort()</code> çš„è®¾è®¡è€…å¸Œæœ›è¿™ä¸ªæ–¹æ³•èƒ½ä½¿ç”¨äºŽæ‰€æœ‰çš„æ•°ç»„ï¼Œæ‰€ä»¥ä»–ä»¬æŠŠ <code>sort()</code> å˜æˆæ˜¯é™æ€çš„æ–¹æ³•ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä»»ä½•æ•°ç»„éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚å®ƒä½¿ç”¨èµ·æ¥å’Œå®ƒè¢«å®šä¹‰åœ¨è¶…ç±»ä¸­æ˜¯ä¸€æ ·çš„ã€‚å› ä¸º <code>sort()</code> å¹¶ä¸æ˜¯çœŸæ­£å®šä¹‰åœ¨è¶…ç±»ä¸­ï¼Œæ‰€ä»¥ <code>sort()</code> æ–¹æ³•éœ€è¦çŸ¥é“ä½ å·²ç»å®žçŽ°äº†è¿™ä¸ª <code>compareTo()</code> æ–¹æ³•ï¼Œå¦åˆ™å°±æ— æ³•è¿›è¡ŒæŽ’åºã€‚</p><p>è¦è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œè®¾è®¡è€…åˆ©ç”¨äº† Ccomparable æŽ¥å£ã€‚ä½ é¡»å®žçŽ°è¿™ä¸ªæŽ¥å£ï¼Œæä¾›è¿™ä¸ªæŽ¥å£æ‰€å£°æ˜Žçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ <code>compareTo()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Duck</span> <span class="keyword">implements</span> <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> weight;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        Duck other = (Duck)object;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.weight &lt; other.weight) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.weight == other.weight) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŽ’åºé¸­å­æ—¶ï¼Œè°ƒç”¨Arrayç±»çš„é™æ€æ–¹æ³•sort()</span></span><br><span class="line"><span class="comment">// Array.sort(ducks)</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>é—®</strong>ï¼šè¿™çœŸçš„æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šè¿™ä¸ª<strong>æ¨¡å¼çš„é‡ç‚¹åœ¨äºŽæä¾›ä¸€ä¸ªç®—æ³•ï¼Œå¹¶è®©å­ç±»å®žçŽ°æŸäº›æ­¥éª¤</strong>ã€‚è’é‡Žä¸­çš„æ¨¡å¼å¹¶éžæ€»æ˜¯å¦‚åŒæ•™ç§‘ä¹¦ä¾‹å­ä¸€èˆ¬åœ°ä¸­è§„ä¸­çŸ©ï¼Œä¸ºäº†ç¬¦åˆå½“å‰çš„çŽ¯å¢ƒå’Œå®žçŽ°çš„çº¦æŸï¼Œå®ƒä»¬æ€»æ˜¯è¦è¢«é€‚å½“åœ°ä¿®æ”¹ã€‚</p><p>é€šå¸¸æˆ‘ä»¬æ— æ³•è®¾è®¡ä¸€ä¸ªç±»ç»§æ‰¿ Java æ•°ç»„ï¼Œè€Œ <code>sort()</code> æ–¹æ³•å¸Œæœ›èƒ½å¤Ÿé€‚ç”¨äºŽæ‰€æœ‰çš„æ•°ç»„ï¼ˆæ¯ä¸ªæ•°ç»„éƒ½æ˜¯ä¸åŒçš„ç±»ï¼‰ã€‚æ‰€ä»¥ä»–ä»¬å®šä¹‰äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè€Œç”±è¢«æŽ’åºçš„å¯¹è±¡å†…çš„æ¯ä¸ªå…ƒç´ è‡ªè¡Œæä¾›æ¯”è¾ƒå¤§å°çš„ç®—æ³•éƒ¨åˆ†ã€‚æ‰€ä»¥ï¼Œè¿™è™½ç„¶ä¸æ˜¯æ•™ç§‘ä¹¦ä¸Šçš„æ¨¡æ¿æ–¹æ³•ï¼Œä½†å®ƒçš„å®žçŽ°ä»ç„¶ç¬¦åˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç²¾ç¥žã€‚å†è€…ï¼Œç”±äºŽä¸éœ€è¦ç»§æ‰¿æ•°ç»„å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç®—æ³•ï¼Œè¿™æ ·ä½¿å¾—æŽ’åºå˜å¾—æ›´æœ‰å¼¹æ€§ï¼Œæ›´æœ‰ç”¨ã€‚</p></li><li><p><strong>é—®</strong>ï¼šæŽ’åºçš„å®žçŽ°çœ‹èµ·æ¥æ›´åƒæ˜¯ç­–ç•¥æ¨¡å¼ï¼Œè€Œä¸æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å°†å®ƒå½’ä¸ºæ¨¡æ¿æ–¹æ³•ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä½ ä¹‹æ‰€ä»¥ä¼šè¿™ä¹ˆè®¤ä¸ºï¼Œå¯èƒ½æ˜¯å› ä¸ºç­–ç•¥æ¨¡å¼ä½¿ç”¨å¯¹è±¡ç»„åˆã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œä½ æ˜¯å¯¹çš„â€”â€”æˆ‘ä»¬ä½¿ç”¨æ•°ç»„å¯¹è±¡æŽ’åºæˆ‘ä»¬çš„æ•°ç»„ï¼Œè¿™éƒ¨åˆ†å’Œç­–ç•¥æ¨¡å¼éžå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œ<strong>åœ¨ç­–ç•¥æ¨¡å¼ä¸­ï¼Œä½ æ‰€ç»„åˆçš„ç±»å®žçŽ°äº†æ•´ä¸ªç®—æ³•</strong>ã€‚æ•°ç»„æ‰€å®žçŽ°çš„æŽ’åºç®—æ³•å¹¶ä¸å®Œæ•´ï¼Œå®ƒéœ€è¦ä¸€ä¸ªç±»å¡«è¡¥ <code>compareTo()</code> æ–¹æ³•çš„å®žçŽ°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ›´åƒæ¨¡æ¿æ–¹æ³•ã€‚</p></li><li><p><strong>é—®</strong>ï¼šåœ¨ Java API ä¸­ï¼Œè¿˜æœ‰å…¶ä»–æ¨¡æ¿æ–¹æ³•çš„ä¾‹å­å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæœ‰çš„ï¼Œä½ å¯ä»¥åœ¨ä¸€äº›åœ°æ–¹çœ‹åˆ°å®ƒä»¬ã€‚æ¯”æ–¹è¯´ <code>java.io.InputStream</code> ç±»æœ‰ä¸€ä¸ª <code>read()</code> æ–¹æ³•ï¼Œæ˜¯ç”±å­ç±»å®žçŽ°çš„ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åˆä¼šè¢« <code>read(byte b[], int off, int len)</code> æ¨¡æ¿æ–¹æ³•ä½¿ç”¨ã€‚</p></li></ul><p>æƒ³ä¸€æƒ³å¦ä¸€ä¸ªæ¨¡å¼ï¼Œå®ƒæ˜¯æ¨¡æ¿æ–¹æ³•çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼ŒåŽŸè¯­æ“ä½œç”¨æ¥åˆ›å»ºå¹¶è¿”å›žå¯¹è±¡ã€‚ï¼ˆå·¥åŽ‚æ–¹æ³•æ¨¡å¼ï¼‰</p><h2 id="jframe">JFrame</h2><p>JFrame æ˜¯æœ€åŸºæœ¬çš„ Swing å®¹å™¨ï¼Œç»§æ‰¿äº†ä¸€ä¸ª <code>paint()</code> æ–¹æ³•ã€‚åœ¨é»˜è®¤çŠ¶æ€ä¸‹ï¼Œ<code>paint()</code> æ˜¯ä¸åšäº‹æƒ…çš„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªâ€œé’©å­â€ï¼é€šè¿‡è¦†ç›– <code>paint()</code>ï¼Œä½ å¯ä»¥å°†è‡ªå·±çš„ä»£ç æ’å…¥ JFrame çš„ç®—æ³•ä¸­ï¼Œæ˜¾ç¤ºå‡ºä½ æ‰€æƒ³è¦çš„ç”»é¢ã€‚</p><h2 id="applet">Applet</h2><p>applet å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿåœ¨ç½‘é¡µä¸Šé¢æ‰§è¡Œçš„å°ç¨‹åºã€‚ä»»ä½• applet éƒ½å¿…é¡»ç»§æ‰¿è‡ª Applet ç±»ï¼Œè€Œ Applet ç±»ä¸­æä¾›äº†å¾ˆå¤šé’©å­ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// inité’©å­ç”¨æ¥è¿›è¡Œappletçš„åˆå§‹åŒ–åŠ¨ä½œï¼Œ</span></span><br><span class="line"><span class="comment">// å®ƒä¼šåœ¨appletä¸€å¼€å§‹çš„æ—¶å€™è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// starté’©å­å¯ä»¥åœ¨appletæ­£è¦è¢«</span></span><br><span class="line"><span class="comment">// æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šæ—¶ï¼Œè®©appletåšä¸€äº›åŠ¨ä½œã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æžœç”¨æˆ·è·³åˆ°åˆ«çš„ç½‘é¡µï¼Œè¿™ä¸ªstopé’©å­ä¼šè¢«è°ƒç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">// ç„¶åŽappletå°±å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›äº‹æƒ…æ¥åœæ­¢å®ƒçš„è¡ŒåŠ¨ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“appletå³å°†è¢«é”€æ¯ï¼ˆä¾‹å¦‚ï¼šå…³é—­æµè§ˆå™¨ï¼‰æ—¶ï¼Œ</span></span><br><span class="line"><span class="comment">// destroyé’©å­å°±ä¼šè¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬çš„è€æœ‹å‹paint()æ–¹æ³•ï¼Œ</span></span><br><span class="line"><span class="comment">// appletä¹Ÿå°†è¿™ä¸ªæ–¹æ³•å½“ä½œé’©å­äº†ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>æ¨¡æ¿æ–¹æ³•å®šä¹‰äº†ç®—æ³•çš„æ­¥éª¤ï¼ŒæŠŠè¿™äº›æ­¥éª¤çš„å®žçŽ°å»¶è¿Ÿåˆ°å­ç±»ã€‚</li><li>æ¨¡æ¿æ–¹æ³•çš„æŠ½è±¡ç±»å¯ä»¥å®šä¹‰å…·ä½“æ–¹æ³•ã€æŠ½è±¡æ–¹æ³•å’Œé’©å­ã€‚</li><li>é’©å­æ˜¯ä¸€ç§æ–¹æ³•ï¼Œå®ƒåœ¨æŠ½è±¡ç±»ä¸­ä¸åšäº‹ï¼Œæˆ–è€…åªåšé»˜è®¤çš„äº‹æƒ…ï¼Œå­ç±»å¯ä»¥é€‰æ‹©è¦ä¸è¦åŽ»è¦†ç›–å®ƒã€‚</li><li>ä¸ºäº†é˜²æ­¢å­ç±»æ”¹å˜æ¨¡æ¿æ–¹æ³•ä¸­çš„ç®—æ³•ï¼Œå¯ä»¥è®²æ¨¡æ¿æ–¹æ³•å£°æ˜Žä¸º finalã€‚</li><li>å¥½èŽ±åžåŽŸåˆ™å‘Šè¯‰æˆ‘ä»¬ï¼Œå°†å†³ç­–æƒæ”¾åœ¨é«˜å±‚æ‘©å¡UIä¸­å“¦é‚£ä¸ªï¼Œä»¥ä¾¿å†³å®šå¦‚ä½•ä»¥åŠä½•æ—¶è°ƒç”¨ä½Žå±‚æ¨¡å—ã€‚</li><li>ç­–ç•¥æ¨¡å¼å’Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼éƒ½å°è£…ç®—æ³•ï¼Œä¸€ä¸ªç”¨ç»„åˆï¼Œä¸€ä¸ªç”¨ç»§æ‰¿ã€‚</li><li>å·¥åŽ‚æ–¹æ³•æ˜¯æ¨¡æ¿æ–¹æ³•çš„ä¸€ç§ç‰¹æ®Šç‰ˆæœ¬ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€‚é…å™¨æ¨¡å¼ä¸Žå¤–è§‚æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/adapter-pattern-and-facade-pattern/"/>
      <url>/notes/head-first-design-patterns/adapter-pattern-and-facade-pattern/</url>
      
        <content type="html"><![CDATA[<p>è¿˜è®°å¾—è£…é¥°è€…æ¨¡å¼å—ï¼Ÿæˆ‘ä»¬å°†å¯¹è±¡åŒ…èµ·æ¥ï¼Œèµ‹äºˆå®ƒä»¬æ–°çš„èŒè´£ã€‚è€ŒçŽ°åœ¨åˆ™æ˜¯ä»¥ä¸åŒç›®çš„ï¼ŒåŒ…è£…æŸäº›å¯¹è±¡ï¼šè®©å®ƒä»¬çš„æŽ¥å£çœ‹èµ·æ¥ä¸åƒè‡ªå·±è€Œåƒæ˜¯åˆ«çš„ä¸œè¥¿ã€‚ä¸ºä½•è¦è¿™æ ·åšï¼Ÿå› ä¸ºè¿™æ ·å°±å¯ä»¥åœ¨è®¾è®¡ä¸­ï¼Œå°†ç±»çš„æŽ¥å£è½¬æ¢æˆæƒ³è¦çš„æŽ¥å£ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜è¦æŽ¢è®¨å¦ä¸€ä¸ªæ¨¡å¼ï¼Œå°†å¯¹è±¡åŒ…è£…èµ·æ¥ä»¥ç®€åŒ–æŽ¥å£ã€‚</p><h1 id="é€‚é…å™¨æ¨¡å¼è½¬æ¢æŽ¥å£">é€‚é…å™¨æ¨¡å¼ï¼šè½¬æ¢æŽ¥å£</h1><h2 id="æˆ‘ä»¬å‘¨å›´çš„é€‚é…å™¨">æˆ‘ä»¬å‘¨å›´çš„é€‚é…å™¨</h2><p>OO é€‚é…å™¨æ˜¯ä»€ä¹ˆï¼Œä½ ä¸€å®šä¸éš¾ç†è§£ï¼Œå› ä¸ºçŽ°å®žä¸­åˆ°å¤„éƒ½æ˜¯ã€‚æ¯”æ–¹è¯´ï¼šå¦‚æžœä½ éœ€è¦åœ¨æ¬§æ´²å›½å®¶ä½¿ç”¨ç¾Žå›½åˆ¶é€ çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ä¸€ä¸ªäº¤æµç”µçš„é€‚é…å™¨ã€‚å®ƒä½äºŽç¾Žå¼æ’å¤´å’Œæ¬§å¼æ’åº§çš„ä¸­é—´ï¼Œå®ƒçš„å·¥ä½œæ˜¯å°†æ¬§å¼æ’åº§è½¬æ¢æˆç¾Žå¼æ’åº§ï¼Œå¥½è®©ç¾Žå¼æ’å¤´å¯ä»¥æ’è¿›è¿™ä¸ªæ’åº§å¾—åˆ°ç”µåŠ›ã€‚</p><p>æŸäº›äº¤æµç”µé€‚é…å™¨ç›¸å½“ç®€å•ï¼Œå®ƒä»¬åªæ˜¯æ”¹å˜æ’åº§çš„å½¢çŠ¶æ¥åŒ¹é…ä½ çš„æ’å¤´ï¼Œç›´æŽ¥æŠŠç”µæµä¼ é€è¿‡åŽ»ã€‚ä½†æ˜¯æœ‰äº›é€‚é…å™¨å†…éƒ¨åˆ™æ˜¯ç›¸å½“å¤æ‚ï¼Œå¯èƒ½ä¼šæ”¹å˜ç”µæµä»¥ç¬¦åˆè£…ç½®çš„éœ€æ±‚ã€‚</p><h2 id="å¯¼å…¥è¡—å¤´é¡½ç¦½">å¯¼å…¥ï¼šâ€œè¡—å¤´é¡½ç¦½â€</h2><p>å¦‚æžœå®ƒèµ°èµ·è·¯æ¥åƒåªé¸­å­ï¼Œå«èµ·æ¥åƒåªé¸­å­ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½æ˜¯ä¸€åªåŒ…è£…äº†é¸­å­é€‚é…å™¨çš„ç«é¸¡ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaScNcbQGMfIKcfogub2PdAzZOm0Nix1IgkHGKgXEJYakA4fDBQXKAInEJipKqKGNJSYg1GhL81eMK5cMdLk8tAZq_AIad5PTPoJc9nSKAleavEOb5AM1tWRH3hLUeLj3NLtWwSIC8zQzMg0LAWJL295vEtV-oOShBnVDUBEm1oi4C2y_CIO4w36GMp7weOPFMWn2cOS_dhyLc6CGWnvJ40g07mUP1ZIu1KoXkXGZfmIoqHbW1D0uIvZLwUiYUvO8584WSuMwuObJhhHIUhfltl6_3i-RDB_QkUTQxw5d7X9YyvxDQdc_S_NHUzxE-fK_x5tEXkbZN3ce60000"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TurkeyAdapter</span> <span class="keyword">implements</span> <span class="title">Duck</span> </span>&#123;</span><br><span class="line">    Turkey turkey;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TurkeyAdapter</span><span class="params">(Turkey turkey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.turkey = turkey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        turkey.gobble();  <span class="comment">// å®Œæˆè½¬æ¢</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;  <span class="comment">// ç«é¸¡çš„é£žè¡Œè·ç¦»çŸ­ï¼Œå¤šè°ƒç”¨å‡ æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            turkey.fly();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="é—®ç­”">é—®ç­”</h2><ul><li><p><strong>é—®</strong>ï¼šä¸€ä¸ªé€‚é…å™¨éœ€è¦åšå¤šå°‘â€œé€‚é…â€çš„å·¥ä½œï¼Ÿå¦‚æžœæˆ‘éœ€è¦å®žçŽ°ä¸€ä¸ªå¾ˆå¤§çš„ç›®æ ‡æŽ¥å£ï¼Œä¼¼ä¹Žæœ‰â€œå¾ˆå¤šâ€å·¥ä½œè¦åšã€‚</p><p><strong>ç­”</strong>ï¼šçš„ç¡®æ˜¯å¦‚æ­¤ã€‚å®žçŽ°ä¸€ä¸ªé€‚é…å™¨æ‰€éœ€è¦è¿›è¡Œçš„å·¥ä½œï¼Œçš„ç¡®å’Œç›®æ ‡æŽ¥å£çš„å¤§å°æˆæ­£æ¯”ã€‚å¦‚æžœä¸ç”¨é€‚é…å™¨ï¼Œä½ å°±å¿…é¡»æ”¹å†™å®¢æˆ·ç«¯çš„ä»£ç æ¥è°ƒç”¨è¿™ä¸ªæ–°çš„æŽ¥å£ï¼Œå°†ä¼šèŠ±è®¸å¤šåŠ›æ°”æ¥åšå¤§é‡çš„è°ƒæŸ¥å·¥ä½œå’Œä»£ç æ”¹å†™å·¥ä½œã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæä¾›ä¸€ä¸ªé€‚é…å™¨ç±»ï¼Œå°†æ‰€æœ‰çš„æ”¹å˜å°è£…åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œæ˜¯æ¯”è¾ƒå¥½çš„åšæ³•ã€‚</p></li><li><p><strong>é—®</strong>ï¼šä¸€ä¸ªé€‚é…å™¨åªèƒ½å°è£…ä¸€ä¸ªç±»å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šè™½ç„¶å¤§å¤šæ•°çš„é€‚é…å™¨æ¨¡å¼æ‰€é‡‡å–çš„ä¾‹å­éƒ½æ˜¯è®©ä¸€ä¸ªé€‚é…å™¨åŒ…è£…ä¸€ä¸ªè¢«é€‚é…è€…ï¼Œä½†æˆ‘ä»¬éƒ½çŸ¥é“è¿™ä¸ªä¸–ç•Œå…¶å®žå¤æ‚å¤šäº†ï¼Œæ‰€ä»¥ä½ å¯èƒ½é‡åˆ°ä¸€äº›çŠ¶å†µï¼Œéœ€è¦è®©ä¸€ä¸ªé€‚é…å™¨åŒ…è£…å¤šä¸ªè¢«é€‚é…ç€ã€‚</p><p>è¿™æ¶‰åŠå¦ä¸€ä¸ªæ¨¡å¼ï¼Œè¢«ç§°ä¸ºå¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰ï¼Œäººä»¬å¸¸å¸¸å°†å¤–è§‚æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æ··ä¸ºä¸€è°ˆã€‚</p></li></ul><h2 id="å®šä¹‰é€‚é…å™¨æ¨¡å¼">å®šä¹‰é€‚é…å™¨æ¨¡å¼</h2><p>é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªç±»çš„æŽ¥å£ï¼Œè½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæŽ¥å£ã€‚é€‚é…å™¨è®©é‚£ä¸ªåŽŸæœ¬æŽ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚</p><p>é€šè¿‡åˆ›å»ºé€‚é…å™¨è¿›è¡ŒæŽ¥å£è½¬æ¢ï¼Œè®©ä¸å…¼å®¹çš„æŽ¥å£å˜æˆå…¼å®¹ã€‚è¿™å¯ä»¥è®©å®¢æˆ·ä»Žå®žçŽ°çš„æŽ¥å£è§£è€¦ã€‚å¦‚æžœåœ¨ä¸€æ®µæ—¶é—´ä¹‹åŽï¼Œæˆ‘ä»¬<strong>æƒ³è¦æ”¹å˜æŽ¥å£</strong>ï¼Œé€‚é…å™¨å¯ä»¥å°†æ”¹å˜çš„éƒ¨åˆ†å°è£…èµ·æ¥ï¼Œå®¢æˆ·å°±ä¸å¿…ä¸ºäº†åº”å¯¹ä¸åŒçš„æŽ¥å£è€Œæ¯æ¬¡è·Ÿç€ä¿®æ”¹ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/AyaioKbLK7gwVkUBZGkLNZOqlMpjVJfp1LT6PaggGcfkGKcbGcvgRb9g4KGaERCeEIULApEl9BKeBJ4vLI4aiIWzjKJ1nWOkP6UdKCsbe52Tc5HSKfION5AhK9HQM9fQNAAXoLNBbPoJM5oiu9YIM52IcWfMM5oGcfoPbfaSX4DL4LWLJ4SYX0QAm4rLg8Q9wc6OPQrG2pGEviWQFJsOeLOASBy-NJVlUT-6vxFNFLlG_gnlwTF-nLmmctNjO1OZgN-oe-_5ejKGxek6rkUxMvvEw83ReQVWd9EPcbTYfV1qtQ9d7TkVzgzwFgVxQGUA1G00"><p>è¿™ä¸ªé€‚é…å™¨æ¨¡å¼å……æ»¡ç€è‰¯å¥½çš„ OO è®¾è®¡åŽŸåˆ™ï¼šä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œä»¥ä¿®æ”¹çš„æŽ¥å£åŒ…è£…è¢«é€‚é…è€…ã€‚è¿™ç§åšæ³•è¿˜æœ‰é¢å¤–çš„ä¼˜ç‚¹ï¼Œé‚£å°±æ˜¯ï¼Œè¢«é€‚é…è€…çš„ä»»ä½•å­ç±»ï¼Œéƒ½å¯ä»¥æ­é…é€‚é…è€…ä½¿ç”¨ã€‚</p><h2 id="å¯¹è±¡å’Œç±»çš„é€‚é…å™¨">å¯¹è±¡å’Œç±»çš„é€‚é…å™¨</h2><p>å®žé™…ä¸Šæœ‰â€œä¸¤ç§â€é€‚é…å™¨ï¼šâ€œå¯¹è±¡â€é€‚é…å™¨å’Œâ€œç±»â€é€‚é…å™¨ã€‚â€œç±»â€é€‚é…å™¨éœ€è¦å¤šé‡ç»§æ‰¿æ‰èƒ½å¤Ÿå®žçŽ°å®ƒï¼Œè¿™åœ¨ Java ä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚ä½†æ˜¯å½“ä½ åœ¨ä½¿ç”¨å¤šé‡ç»§æ‰¿è¯­è¨€çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯èƒ½é‡åˆ°è¿™æ ·çš„éœ€æ±‚ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/AyaioKbLK7g-SRVIouQcbwszJsUkuCh8J4bLICqjAAbKo4tDJKejWeWaPnObvwHo9USa5XShX2GMfQUMA5HpAIWKfHQMfXQNQ6XorK8b7LCI2qfIKy6onGMfoPbfcSb1E5GLePc1NGVKEfiQNLsOFYwOBIY2pZcPgNab2dfsK1TovUMNf2eKPQPdb2Zafy6KMIa0VGptyFFTovzrxe_9Ux5eDKJiHKFhqqazpsUlUxQW7QWG0000"><h2 id="çœŸå®žä¸–ç•Œçš„é€‚é…å™¨">çœŸå®žä¸–ç•Œçš„é€‚é…å™¨</h2><p>æ—©æœŸçš„ Java é›†åˆï¼ˆcollectionï¼‰ç±»åž‹ï¼ˆä¾‹å¦‚ï¼šVecotrã€Stackã€Hashtableï¼‰éƒ½å®žçŽ°äº†ä¸€ä¸ªåä¸º <code>elements()</code> çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šè¿”å›žä¸€ä¸ª Enumerationï¼ˆä¸¾ï¼‰ã€‚è¿™ä¸ª Enumeration æŽ¥å£å¯ä»¥é€ä¸€èµ°è¿‡æ­¤é›†åˆå†…çš„æ¯ä¸ªå…ƒç´ ï¼Œè€Œæ— éœ€çŸ¥é“å®ƒä»¬åœ¨é›†åˆå†…æ˜¯å¦‚ä½•è¢«ç®¡ç†çš„ã€‚</p><p>å½“ Sun æŽ¨å‡ºæ›´æ–°åŽçš„é›†åˆç±»æ—¶ï¼Œå¼€å§‹ä½¿ç”¨äº† Iteratorï¼ˆè¿­ä»£å™¨ï¼‰æŽ¥å£ï¼Œè¿™ä¸ªæŽ¥å£å’Œæžšä¸¾æŽ¥å£å¾ˆåƒï¼Œéƒ½å¯ä»¥è®©ä½ éåŽ†æ­¤é›†åˆå†…çš„æ¯ä¸ªå…ƒç´ ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œè¿­ä»£å™¨è¿˜æä¾›äº†åˆ é™¤å…ƒç´ çš„èƒ½åŠ›ã€‚</p><p>è€Œä»Šå¤©â€¦â€¦æˆ‘ä»¬ç»å¸¸é¢å¯¹é—ç•™ä»£ç ï¼Œè¿™äº›ä»£ç æš´éœ²å‡ºæžšä¸¾æŽ¥å£ï¼Œä½†æˆ‘ä»¬åˆå¸Œæœ›åœ¨æ–°çš„ä»£ç ä¸­åªæ˜¯ç”¨è¿­ä»£å™¨ã€‚æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œçœ‹æ¥æˆ‘ä»¬éœ€è¦æž„é€ ä¸€ä¸ªé€‚é…å™¨ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/XP0zJiD048NxFSMKKE03XCWDSa41L1nWindBbhm_sXsJ86C98IZfQ2YeQDBGqY38POn2Ri4w3iOHAz6DthwPxxtDyYa2IaEN855EqBAiLKHkHO4iLuGsvGBXs0-Sj8Nnk1VZ62e6KF698yi5rP1nTufpsjlVbLL0ioZr1Ngr7b0ILSgMaslrB-X4MqmAbAZ8XO3Rjmr15DovuVM-JdjtI4K_Uwal0fLFIgNjNg8_t4EelLs5l3iXEjzFQU-apEgPNvp1kNAbCTeIJi_CDaSo5sZyq2tMxFVxhw8eL8I5oXt4G-lWI0H7HUvpZQ3vU5hTlZRlozN3uclvqhmzVpukcDA4K61AeDCGRGJhwvlrtRttVWC0"><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€‚é…å™¨å¹¶ä¸å®Œç¾Žï¼šå®¢æˆ·å¿…é¡»å°å¿ƒæ½œåœ¨çš„å¼‚å¸¸ï¼ˆä¸æ”¯æŒ <code>remove()</code> æ–¹æ³•ï¼‰ï¼Œä½†åªè¦å®¢æˆ·å¤Ÿå°å¿ƒï¼Œè€Œä¸”é€‚é…å™¨çš„æ–‡æ¡£èƒ½åšå‡ºè¯´æ˜Žï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸€ä¸ªåˆç†çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="é€‚é…å™¨è£…é¥°è€…å¤–è§‚">é€‚é…å™¨ã€è£…é¥°è€…ã€å¤–è§‚</h2><p>æŸäº›äº¤æµç”µé€‚é…å™¨æ‰€åšçš„äº‹æƒ…ä¸åªæ˜¯æ”¹å˜æŽ¥å£ï¼Œå®ƒä»¬è¿˜åŠ äº†ä¸€äº›å…¶ä»–çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šç”µæ¶Œä¿æŠ¤ã€æŒ‡ç¤ºç¯ã€è­¦æŠ¥å£°ç­‰ã€‚å¦‚æžœè¦ä½ å®žçŽ°è¿™ç±»ç‰¹æ€§ï¼Œä½ è¦ä½¿ç”¨ä»€ä¹ˆæ¨¡å¼ï¼Ÿï¼ˆè£…é¥°è€…æ¨¡å¼ï¼‰</p><table><thead><tr class="header"><th>æ¨¡å¼</th><th>æ„å›¾</th></tr></thead><tbody><tr class="odd"><td>è£…é¥°è€…</td><td>ä¸æ”¹å˜æŽ¥å£ï¼Œä½†åŠ å…¥æ–°çš„è´£ä»»</td></tr><tr class="even"><td>é€‚é…å™¨</td><td>å°†ä¸€ä¸ªæŽ¥å£è½¬æˆå¦ä¸€ä¸ªæŽ¥å£</td></tr><tr class="odd"><td>å¤–è§‚</td><td>è®©æŽ¥å£æ›´ç®€å•</td></tr></tbody></table><h1 id="å¤–è§‚æ¨¡å¼ç®€åŒ–æŽ¥å£">å¤–è§‚æ¨¡å¼ï¼šç®€åŒ–æŽ¥å£</h1><h2 id="å¯¼å…¥ç”œèœœçš„å®¶åº­å½±é™¢">å¯¼å…¥ï¼šç”œèœœçš„å®¶åº­å½±é™¢</h2><p>ä¸€ä¸ªçƒ­æ½®é£Žè¡Œå…¨ç¾Žï¼šå»ºç«‹è‡ªå·±çš„å®¶åº­å½±é™¢ã€‚é€šè¿‡ä¸€ç•ªç ”ç©¶æ¯”è¾ƒï¼Œä½ ç»„è£…äº†ä¸€å¥—æ€æ‰‹çº§çš„ç³»ç»Ÿï¼Œå†…å« DVD æ’­æ”¾å™¨ã€æŠ•å½±æœºã€è‡ªåŠ¨å±å¹•ã€çŽ¯ç»•ç«‹ä½“å£°ï¼Œç”šè‡³è¿˜æœ‰çˆ†ç±³èŠ±æœºã€‚</p><img src="http://www.plantuml.com/plantuml/svg/lL3BIiD05DtdAsQfYz2zY23r0mfkkucJ6n999aCI2wKKeY2s80sAbY8AWl6ni0iHn3RQVand4btv2qxIH-e3r8shU-wvTyuvTtH31GGMzQh80ci374bF6Mmus0G9cuhhebMBcePcW8Dg4a95jMGgLT7W2H3SMcLAgfMSNSSE045kLaHV4ngcMaU50kAx3ongyw3pkXU8YKqM5jEYQLbrmIkgKoIqCrYpmDFj-UTnknVV7qlrISnPi3HbdbcPegy-i0dOon1LjbmO8w7nEx_yw7yoBDaKsmuHXVx5bDhq9_rSHvPNPX_vYPxTEySlo_9twocThnFR0sI2veb87uzOGl5famyQF3n9xgAtf_qnBXFM3rd_K10lmuvOOOy-3w-JGLWcSUkI1nTYadIRoPaVDmvOT5icl1NnxXNhdO_yRVOyJ8vkHlxEEm00"><p>çŽ°åœ¨ï¼Œä½ å‡†å¤‡å¼€å§‹äº«å—ä¸€éƒ¨ç”µå½±â€¦â€¦æƒ³çœ‹ç”µå½±ï¼Œå¿…é¡»å…ˆæ‰§è¡Œä¸€äº›ä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">popper.on();</span><br><span class="line">popper.pop();  <span class="comment">// æ‰“å¼€çˆ†ç±³èŠ±æœºï¼Œå¼€å§‹çˆ†ç±³èŠ±</span></span><br><span class="line"></span><br><span class="line">lights.dim(<span class="number">10</span>);  <span class="comment">// è°ƒæš—ç¯å…‰</span></span><br><span class="line"></span><br><span class="line">screen.down();  <span class="comment">// é™ä¸‹å±å¹•</span></span><br><span class="line"></span><br><span class="line">projector.on();</span><br><span class="line">projector.setInput(dvd);</span><br><span class="line">projector.wideScreenMode();  <span class="comment">// æ‰“å¼€å¹¶è®¾ç½®æŠ•å½±ä»ª</span></span><br><span class="line"></span><br><span class="line">amp.on();</span><br><span class="line">amp.setDvd();</span><br><span class="line">amp.setSurroundSound();</span><br><span class="line">amp.setVolume(<span class="number">5</span>);  <span class="comment">// æ‰“å¼€å¹¶è®¾ç½®åŠŸæ”¾</span></span><br><span class="line"></span><br><span class="line">dvd.on();</span><br><span class="line">dvd.play(movie);  <span class="comment">// æ‰“å¼€DVDæ’­æ”¾æœºï¼Œå¯ä»¥çœ‹ç”µå½±äº†</span></span><br></pre></td></tr></table></figure><p>è¿˜ä¸æ­¢æ˜¯è¿™æ ·â€¦â€¦</p><ul><li>çœ‹å®Œç”µå½±åŽï¼Œè¿˜è¦æŠŠä¸€åˆ‡éƒ½å…³æŽ‰ã€‚</li><li>å¦‚æžœè¦å¬ CD æˆ–è€…å¹¿æ’­ï¼Œéš¾é“ä¹Ÿä¼šè¿™ä¹ˆéº»çƒ¦ï¼Ÿ</li><li>å¦‚æžœä½ å†³å®šå‡çº§ä½ çš„ç³»ç»Ÿï¼Œå¯èƒ½è¿˜å¿…é¡»é‡æ–°å­¦ä¹ ä¸€å¥—ç¨å¾®ä¸åŒçš„æ“ä½œè¿‡ç¨‹ã€‚</li></ul><h2 id="ä½¿ç”¨å¤–è§‚æ¨¡å¼">ä½¿ç”¨å¤–è§‚æ¨¡å¼</h2><img src="http://www.plantuml.com/plantuml/svg/nLJBJjjG4DtxA-woNIJi4QfK1LNTL48josnS-mQxEBRbkAbG52a425K5X0MDGaW9eZmgAl8GRGYuQJwcldwi-WiTlvF6aSgggpipP-RCcV7rvNWM8voLrJMKnTdNMA4u9yBm2YDWYX7eN0uzbx9ucSEqYfLdD4C3NA0GIh5B0hs65SJu1iGMyq6GpKVH9Kbc94M4GmP4TWy8lwDLXdiXvNdyw36uM6GZH-1pAXQNfHGROBuL02zfbfS2B72A52NJp2gzWX6vtZTlD5DhkLgzEPvcPO7FyA31YSLFC6i6X5un2iOYohc76oa0by0MqTmS8bjzNQkHQjtUhhgO9BhYmCXaV2k7LNy8ruO-lbF8OfMJnecCsfrnyn70OYW-5EjfZsQX0sjMN_m6Cwflo_JR70viu7k8WcWn_qt2v4rwi0ouUl_MBU9C99w4gvy25lDno48Y4L_Y0559aPh-hnpIC7y67bB7mr63U7nYXJ4v2qcK4dWigfHte6Joxo9HKZ4IS4Q5rKu_3lF86XtgWojoLhCkosPF8zqAQVV9_JKPzkp3qxHeDZQjpe2SDKnjKzVwrcL57zphWn8KfSNmn_tzOySkDQpHjjNTC0--f4MVTWmtFfsJzh6vrqsBuu-9zob_bSgUKeLVuLofta3pYBHFZVUtklRPF5adrOwkdNij9bLw-etgllxp21HxfD3KAkteWrqoseAKogvV6OWA4w5xG47k-aRpojd2NWiKGqgOdXRjkcOt3gplju103Rae6yTDVNXYDqlMnVhOEc2H3ldHD_jhdVJAv4FBsXY276SlTQFUyGRHXoD7pbGZeFu3"><h2 id="é—®ç­”-1">é—®ç­”</h2><ul><li><p><strong>é—®</strong>ï¼šå¦‚æžœå¤–è§‚å°è£…äº†å­ç³»ç»Ÿçš„ç±»ï¼Œé‚£ä¹ˆéœ€è¦ä½Žå±‚åŠŸèƒ½çš„å®¢æˆ·å¦‚ä½•æŽ¥è§¦è¿™äº›ç±»ï¼Ÿ</p><p><strong>ç­”</strong>ï¼š<strong>å¤–è§‚æ²¡æœ‰â€œå°è£…â€å­ç³»ç»Ÿçš„ç±»ï¼Œå¤–è§‚åªæä¾›ç®€åŒ–çš„æŽ¥å£</strong>ï¼Œæ‰€ä»¥å®¢æˆ·å¦‚æžœè§‰å¾—æœ‰å¿…è¦ï¼Œä¾ç„¶å¯ä»¥ç›´æŽ¥ä½¿ç”¨å­ç³»ç»Ÿçš„ç±»ã€‚è¿™æ˜¯å¤–è§‚æ¨¡å¼ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹å¾ï¼šæä¾›ç®€åŒ–çš„æŽ¥å£çš„åŒæ—¶ï¼Œä¾ç„¶å°†ç³»ç»Ÿå®Œæ•´çš„åŠŸèƒ½æš´éœ²å‡ºæ¥ï¼Œä»¥ä¾›éœ€è¦çš„äººä½¿ç”¨ã€‚</p></li><li><p><strong>é—®</strong>ï¼šå¤–è§‚ä¼šæ–°å¢žåŠŸèƒ½å—ï¼Œæˆ–è€…å®ƒåªæ˜¯å°†æ¯ä¸€ä¸ªè¯·æ±‚è½¬ç”±å­ç³»ç»Ÿæ‰§è¡Œï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå¤–è§‚å¯ä»¥é™„åŠ â€œèªæ˜Žçš„â€åŠŸèƒ½ï¼Œè®©ä½¿ç”¨å­ç³»ç»Ÿæ›´æ–¹ä¾¿ã€‚</p></li><li><p><strong>é—®</strong>ï¼šé™¤äº†èƒ½æä¾›ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æŽ¥å£ä¹‹å¤–ï¼Œå¤–è§‚æ¨¡å¼è¿˜æœ‰å…¶ä»–çš„ä¼˜ç‚¹å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼š<strong>å¤–è§‚ä¸åªæ˜¯ç®€åŒ–äº†æŽ¥å£ï¼Œä¹Ÿå°†å®¢æˆ·ä»Žç»„ä»¶çš„å­ç³»ç»Ÿä¸­è§£è€¦</strong>ã€‚æ¯”æ–¹è¯´ï¼Œä½ æƒ³è¦å‡çº§ä½ çš„å®¶åº­å½±é™¢ï¼Œé‡‡ç”¨å…¨æ–°çš„å’Œä»¥å‰ä¸ä¸€æ ·æŽ¥å£çš„ç»„ä»¶ï¼ŒçŽ°åœ¨ä½ ä¸éœ€è¦æ”¹å˜å®¢æˆ·ä»£ç ï¼ˆä¾æ—§æ˜¯ <code>homeTheater.watchMovie()</code>ï¼‰ï¼Œåªéœ€è¦ä¿®æ”¹å¤–è§‚ä»£ç ï¼ˆè€Œä¸”æœ‰å¯èƒ½åŽ‚å•†ä¼šæä¾›æ–°ç‰ˆçš„å¤–è§‚ä»£ç ï¼‰ã€‚</p></li><li><p><strong>é—®</strong>ï¼šæˆ‘å¯ä¸å¯ä»¥è¿™æ ·è¯´ï¼Œé€‚é…å™¨æ¨¡å¼å’Œå¤–è§‚æ¨¡å¼ä¹‹é—´çš„å·®å¼‚åœ¨äºŽï¼šé€‚é…å™¨åŒ…è£…ä¸€ä¸ªç±»ï¼Œè€Œå¤–è§‚å¯ä»¥ä»£è¡¨è®¸å¤šç±»ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸å¯¹ï¼é€‚é…å™¨å°†ä¸€ä¸ªæˆ–å¤šä¸ªæŽ¥å£å˜æˆå®¢æˆ·æ‰€æœŸæœ›çš„ä¸€ä¸ªæŽ¥å£ã€‚è™½ç„¶å¤§å¤šæ•°ä¾‹å­ä¸­é€‚é…å™¨åªé€‚é…ä¸€ä¸ªç±»ï¼Œä½†æ˜¯ä½ å¯ä»¥é€‚é…è®¸å¤šç±»ã€‚ç±»ä¼¼åœ°ï¼Œä¸€ä¸ªå¤–è§‚ä¹Ÿå¯ä»¥åªé’ˆå¯¹ä¸€ä¸ªæ‹¥æœ‰å¤æ‚æŽ¥å£çš„ç±»æä¾›ç®€åŒ–çš„æŽ¥å£ã€‚</p><p><strong>ä¸¤ç§æ¨¡å¼çš„å·®å¼‚ï¼Œä¸åœ¨äºŽå®ƒä»¬â€œåŒ…è£…â€äº†å‡ ä¸ªç±»ï¼Œè€Œæ˜¯åœ¨äºŽå®ƒä»¬çš„æ„å›¾ã€‚é€‚é…å™¨æ¨¡å¼çš„æ„å›¾æ˜¯ï¼Œâ€œæ”¹å˜â€æŽ¥å£ç¬¦åˆå®¢æˆ·çš„æœŸæœ›ï¼›è€Œå¤–è§‚æ¨¡å¼çš„æ„å›¾æ˜¯ï¼Œæä¾›å­ç³»ç»Ÿçš„ä¸€ä¸ªç®€åŒ–æŽ¥å£ã€‚</strong></p></li></ul><h2 id="å®šä¹‰å¤–è§‚æ¨¡å¼">å®šä¹‰å¤–è§‚æ¨¡å¼</h2><p>å¤–è§‚æ¨¡å¼æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æŽ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æŽ¥å£ã€‚å¤–è§‚å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æŽ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONApZdPARcbN11A0KzEmMtnEJ4b5Gk2AMWgskd45oQ55nPN9AQwuXLr0ckMGzPhPN2qsLDp-RDUJQdy-d-rXVB6j_lwNcwRj6pZkrFTiv_sh_-oUwbCNbFzkv_FcN5qxKJdc_U_Npt_EUpMfxrBNtQl_XnGnDNNdv9ga9HPdf6YK9-6jHPLWhF-YSysJVxsOp9JtRrGNG3DG6rFjdH0DSA0000"><h1 id="æœ€å°‘çŸ¥è¯†åŽŸåˆ™">æœ€å°‘çŸ¥è¯†åŽŸåˆ™</h1><p>åªå’Œä½ çš„å¯†å‹è°ˆè¯ã€‚</p><p>å½“ä½ æ­£åœ¨è®¾è®¡ä¸€ä¸ªç³»ç»Ÿï¼Œä¸ç®¡æ˜¯ä»»ä½•å¯¹è±¡ï¼Œä½ éƒ½è¦æ³¨æ„å®ƒæ‰€äº¤äº’çš„ç±»æœ‰å“ªäº›ï¼Œå¹¶æ³¨æ„å®ƒå’Œè¿™äº›ç±»æ˜¯å¦‚ä½•äº¤äº’çš„ã€‚</p><p>è¿™ä¸ªåŽŸåˆ™å¸Œæœ›æˆ‘ä»¬åœ¨è®¾è®¡ä¸­ï¼Œä¸è¦è®©å¤ªå¤šçš„ç±»è€¦åˆåœ¨ä¸€èµ·ï¼Œå…å¾—ä¿®æ”¹ç³»ç»Ÿä¸­ä¸€éƒ¨åˆ†ï¼Œä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ã€‚å¦‚æžœè®¸å¤šç±»ä¹‹é—´ç›¸äº’ä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿå°±ä¼šå˜æˆä¸€ä¸ªæ˜“ç¢Žçš„ç³»ç»Ÿï¼Œå®ƒéœ€è¦èŠ±è®¸å¤šæˆæœ¬ç»´æŠ¤ï¼Œä¹Ÿä¼šå› ä¸ºå¤ªå¤æ‚è€Œä¸å®¹æ˜“è¢«å…¶ä»–äººäº†è§£ã€‚</p><p>ç©¶ç«Ÿè¦æ€Žæ ·æ‰èƒ½é¿å…è¿™æ ·å‘¢ï¼Ÿè¿™ä¸ªåŽŸåˆ™æä¾›äº†ä¸€äº›æ–¹é’ˆï¼šå°±ä»»ä½•å¯¹è±¡è€Œè¨€ï¼Œåœ¨è¯¥å¯¹è±¡çš„æ–¹æ³•å†…ï¼Œæˆ‘ä»¬åªå› è¯¥è°ƒç”¨å±žäºŽä»¥ä¸‹èŒƒå›´çš„æ–¹æ³•ï¼š</p><ul><li>è¯¥å¯¹è±¡æœ¬èº«</li><li>è¢«å½“åšæ–¹æ³•çš„å‚æ•°è€Œä¼ é€’è¿›æ¥çš„å¯¹è±¡</li><li>æ­¤æ–¹æ³•æ‰€åˆ›å»ºæˆ–å®žä¾‹åŒ–çš„ä»»ä½•å¯¹è±¡</li><li>å¯¹è±¡çš„ä»»ä½•ç»„ä»¶</li></ul><p>è¿™äº›æ–¹é’ˆå‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æžœæŸå¯¹è±¡æ˜¯è°ƒç”¨å…¶ä»–çš„æ–¹æ³•çš„è¿”å›žç»“æžœï¼Œä¸è¦è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ã€‚è¿™å¬èµ·æ¥æœ‰ç‚¹ä¸¥åŽ‰ï¼Œä¸æ˜¯å—ï¼Ÿå¦‚æžœè°ƒç”¨ä»Žå¦ä¸€ä¸ªè°ƒç”¨ä¸­è¿”å›žçš„å¯¹è±¡çš„æ–¹æ³•ï¼Œä¼šæœ‰ä»€ä¹ˆå®³å¤„å‘¢ï¼Ÿ<strong>å¦‚æžœæˆ‘ä»¬è¿™æ ·åšï¼Œç›¸å½“äºŽå‘å¦ä¸€ä¸ªå¯¹è±¡çš„å­éƒ¨åˆ†å‘è¯·æ±‚ï¼ˆè€Œå¢žåŠ æˆ‘ä»¬ç›´æŽ¥è®¤è¯†çš„å¯¹è±¡æ•°ç›®ï¼‰</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŽŸåˆ™è¦æˆ‘ä»¬æ”¹ä¸ºè¦æ±‚è¯¥å¯¹è±¡ä¸ºæˆ‘ä»¬åšå‡ºè¯·æ±‚ï¼Œè¿™ä¹ˆä¸€æ¥ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦è®¤è¯†è¯¥å¯¹è±¡çš„ç»„ä»¶äº†ï¼ˆè®©æˆ‘ä»¬çš„æœ‹å‹åœˆå­ç»´æŒåœ¨æœ€å°çš„çŠ¶æ€ï¼‰ã€‚æ¯”æ–¹è¯´ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getTemp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thermometer thermometer = station.getThermometer();  <span class="comment">// å–å¾—æ¸©åº¦è®¡</span></span><br><span class="line">    <span class="keyword">return</span> thermometer.getTemperature();  <span class="comment">// ä»Žæ¸©åº¦è®¡å¯¹è±¡å–å¾—æ¸©åº¦</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é‡‡ç”¨æœ€å°‘çŸ¥è¯†åŽŸåˆ™</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getTemp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> station.getTemperature();  <span class="comment">// åœ¨æ°”è±¡ç«™ä¸­åŠ è¿›ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>é—®</strong>ï¼šè¿˜æœ‰å¦ä¸€ä¸ªåŽŸåˆ™ï¼Œå«åšå¾—å¢¨å¿’è€³æ³•åˆ™ï¼ˆLaw of Demeterï¼‰ï¼Œå®ƒå’Œæœ€å°‘çŸ¥è¯†åŽŸåˆ™æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå…¶å®žä¸¤ä¸ªåæ¬¡æŒ‡çš„æ˜¯åŒä¸€ä¸ªåŽŸåˆ™ã€‚æˆ‘ä»¬å€¾å‘äºŽä½¿ç”¨æœ€å°‘çŸ¥è¯†åŽŸåˆ™æ¥ç§°å‘¼å®ƒæ˜¯å› ä¸ºä»¥ä¸‹ä¸¤ä¸ªåŽŸå› ï¼šï¼ˆ1ï¼‰è¿™ä¸ªåå­—æ›´ç›´æŽ¥ã€‚ï¼ˆ2ï¼‰æ³•åˆ™ï¼ˆLawï¼‰ç»™äººçš„æ„Ÿè§‰æ˜¯å¼ºåˆ¶çš„ã€‚äº‹å®žä¸Šï¼Œæ²¡æœ‰ä»»ä½•åŽŸåˆ™æ˜¯æ³•å¾‹ï¼Œ<strong>æ‰€æœ‰çš„åŽŸåˆ™éƒ½åº”è¯¥åœ¨æœ‰å¸®åŠ©çš„æ—¶å€™æ‰éµå®ˆã€‚æ‰€æœ‰çš„è®¾è®¡éƒ½ä¸å…éœ€è¦æŠ˜è¡·ï¼ˆåœ¨æŠ½è±¡å’Œé€Ÿåº¦ä¹‹é—´å–èˆï¼Œåœ¨ç©ºé—´å’Œæ—¶é—´ä¹‹é—´å¹³è¡¡â€¦â€¦ï¼‰</strong>ã€‚è™½ç„¶åŽŸåˆ™æä¾›äº†æ–¹é’ˆï¼Œä½†åœ¨é‡‡ç”¨åŽŸåˆ™ä¹‹å‰ï¼Œå¿…é¡»å…¨ç›˜è€ƒè™‘æ‰€æœ‰çš„å› ç´ ã€‚</p></li><li><p><strong>é—®</strong>ï¼šé‡‡ç”¨æœ€å°‘çŸ¥è¯†åŽŸåˆ™æœ‰ä»€ä¹ˆç¼ºç‚¹å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæ˜¯çš„ï¼Œè™½ç„¶è¿™ä¸ªåŽŸåˆ™å‡å°‘äº†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–ï¼Œç ”ç©¶æ˜¾ç¤ºè¿™ä¼šå‡å°‘è½¯ä»¶çš„ç»´æŠ¤æˆæœ¬ï¼›ä½†æ˜¯<strong>é‡‡ç”¨è¿™ä¸ªåŽŸåˆ™ä¹Ÿä¼šå¯¼è‡´æ›´å¤šçš„â€œåŒ…è£…â€ç±»è¢«åˆ¶é€ å‡ºæ¥ï¼Œä»¥å¤„ç†å’Œå…¶ä»–ç»„ä»¶çš„æ²Ÿé€šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¤æ‚åº¦å’Œå¼€å‘æ—¶é—´çš„å¢žåŠ ï¼Œå¹¶é™ä½Žè¿è¡Œæ—¶çš„æ€§èƒ½</strong>ã€‚</p></li></ul><h1 id="å¤–è§‚å’Œæœ€å°‘çŸ¥è¯†åŽŸåˆ™">å¤–è§‚å’Œæœ€å°‘çŸ¥è¯†åŽŸåˆ™</h1><img src="http://www.plantuml.com/plantuml/svg/TLBBBWDH6DxFK_pflariHIHI4JiMbjsCSUZ4t3ATI4GaDQMcYh9m7qgrBerM1LMgF8pvpuoLLt16QIF6wkHyb__xpYKkJX0WicRCWapaSQ9pSHyHH5sG2AVnmZG_HG0h6-vjqstcOOu342G-aO1HLHDKNM6Bnbm00x8cYPCYqI4SxeVenAZ4pmOGWpD1J5yu76pnYQvbdXjMPJ8M9xn1z25Uu5bLVsX7_m_V6HrCTmE2-Tz7_QlfYq1K4ebYS8fg4D35gRW1wkGts0lUwvxJA6ErGAq7p9MfdN4QIOPGEukvxCVpQan1-s9an7tUTY-oJgF2eD1VOIYcqDrhfrd7KijvojBKKZkFIHbQygwttCEaLxtil9RpcFTIhVU5UwnQr4vYRTFDCraQr_DexRqbJPPxPj8Z6tEx-BA3nJ8Mr-YXoU9PzDTslntjPkvfFODBzNQvcF9kdZgF5hKsdUPLEnuBHxXoJ0_kcCdTNyJYjdVkJy9QcbQABEcd5LffQctWyh5_9pSclJfXJKB09q3fuPGUY4Iw_-qJ"><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>å½“éœ€è¦ä½¿ç”¨ä¸€ä¸ªçŽ°æœ‰çš„ç±»è€Œå…¶æŽ¥å£å¹¶ä¸ç¬¦åˆä½ çš„éœ€æ±‚æ—¶ï¼Œå°±æ˜¯ç”¨é€‚é…å™¨ã€‚</li><li>å½“éœ€è¦ç®€åŒ–å¹¶ç»Ÿä¸€ä¸€ä¸ªå¾ˆå¤§çš„æŽ¥å£æˆ–è€…ä¸€ç¾¤å¤æ‚çš„æŽ¥å£æ—¶ï¼Œä½¿ç”¨å¤–è§‚ã€‚</li><li>é€‚é…å™¨å°†ä¸€ä¸ªå¯¹è±¡åŒ…è£…èµ·æ¥ä»¥æ”¹å˜å…¶æŽ¥å£ï¼›è£…é¥°è€…å°†ä¸€ä¸ªå¯¹è±¡åŒ…è£…èµ·æ¥ä»¥å¢žåŠ æ–°çš„è¡Œä¸ºå’Œè´£ä»»ï¼šè€Œå¤–è§‚å°†ä¸€ç¾¤å¯¹è±¡â€œåŒ…è£…â€èµ·æ¥ä»¥ç®€åŒ–å…¶æŽ¥å£ã€‚</li><li>å®žçŽ°ä¸€ä¸ªé€‚é…å™¨å¯èƒ½éœ€è¦ä¸€ç•ªåŠŸå¤«ï¼Œä¹Ÿå¯èƒ½ä¸è´¹å·¥å¤«ï¼Œè§†ç›®æ ‡æŽ¥å£çš„å¤§å°å’Œå¤æ‚åº¦è€Œå®šã€‚</li><li>å®žçŽ°ä¸€ä¸ªå¤–è§‚ï¼Œéœ€è¦å°†å­ç³»ç»Ÿç»„åˆè¿›å¤–è§‚ä¸­ï¼Œç„¶åŽå°†å·¥ä½œå§”æ‰˜ç»™å­ç³»ç»Ÿæ‰§è¡Œã€‚</li><li>é€‚é…å™¨æ¨¡å¼æœ‰ä¸¤ç§å½¢å¼ï¼šå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ã€‚ç±»é€‚é…å™¨éœ€è¦ç”¨åˆ°å¤šé‡ç»§æ‰¿ã€‚</li><li>ä½ å¯ä»¥ä¸ºä¸€ä¸ªå­ç³»ç»Ÿå®žçŽ°ä¸€ä¸ªä»¥ä¸Šçš„å¤–è§‚ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/command-pattern/"/>
      <url>/notes/head-first-design-patterns/command-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥é¥æŽ§å™¨-api">å¯¼å…¥ï¼šé¥æŽ§å™¨ API</h1><p>è®¾è®¡ä¸€ä¸ªå®¶ç”µè‡ªåŠ¨åŒ–é¥æŽ§å™¨çš„ APIã€‚è¿™ä¸ªé¥æŽ§å™¨å…·æœ‰ä¸ƒä¸ªå¯ç¼–ç¨‹çš„æ’æ§½ï¼Œæ¯ä¸ªæ’æ§½éƒ½æœ‰å¯¹åº”çš„å¼€å…³æŒ‰é’®ã€‚è¿™ä¸ªé¥æŽ§å™¨è¿˜å…·å¤‡ä¸€ä¸ªæ•´ä½“çš„æ’¤é”€æŒ‰é’®ã€‚æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ç»„æŽ§åˆ¶é¥æŽ§å™¨çš„ APIï¼Œè®©æ¯ä¸ªæ’æ§½éƒ½èƒ½æŽ§åˆ¶ä¸€ä¸ªæˆ–ä¸€ç»„è£…ç½®ã€‚<strong>è¯·æ³¨æ„ï¼Œèƒ½å¤ŸæŽ§åˆ¶ç›®å‰çš„è£…ç½®å’Œæœªæ¥å¯èƒ½å‡ºçŽ°çš„è£…ç½®ï¼Œè¿™ä¸€ç‚¹æ˜¯å¾ˆé‡è¦çš„ã€‚</strong></p><img src="http://www.plantuml.com/plantuml/svg/VO_D2i8m48JlVOeSzJbQ544GhFGUcsqIIB8XFnOHtzqM4ngncjFiCFjbHqW61BGDTw91Ny5LOdPwwNe5LQ-ez-GekGZaKP7feTbits8O9lLCaHgKaeR_ISwAILtiNBhVIG_XO6mCjQ36W5hS3bNKK53sr54E3Q9Bj6ZpRpXci0-ONJMVU38VqrgL7JK9AAPCYcjWCkgyY-FNtHn2Qm5OmMi3EC2_LMkswEPM36VA9AwLVm40"><p>ç±»çš„æŽ¥å£å„æœ‰å·®å¼‚ã€‚éº»çƒ¦è¿˜ä¸åªæ˜¯è¿™æ ·ï¼Œè¿™äº›ç±»ä»¥åŽè¿˜ä¼šè¶Šæ¥è¶Šå¤šã€‚æ‰€ä»¥è®¾è®¡ä¸€ä¸ªé¥æŽ§å™¨ API å˜å¾—å¾ˆæœ‰æŒ‘æˆ˜æ€§ã€‚</p><p>é¥æŽ§å™¨åº”è¯¥çŸ¥é“å¦‚ä½•è§£è¯»æŒ‰é’®è¢«æŒ‰ä¸‹çš„åŠ¨ä½œï¼Œç„¶åŽå‘å‡ºæ­£ç¡®çš„è¯·æ±‚ï¼Œä½†æ˜¯é¥æŽ§å™¨ä¸éœ€çŸ¥é“è¿™äº›å®¶ç”µè‡ªåŠ¨åŒ–çš„ç»†èŠ‚ã€‚æˆ‘ä»¬ä¸æƒ³è®©é¥æŽ§å™¨åŒ…å«ä¸€å¤§å † if è¯­å¥ï¼Œä¾‹å¦‚ <code>if slot1 == Light then light.on(), else if slot1 == GarageDoor then garageDoor.up()</code>ã€‚å¤§å®¶éƒ½çŸ¥é“è¿™æ ·çš„è®¾è®¡å¾ˆç³Ÿç³•ã€‚</p><h1 id="å‘½ä»¤æ¨¡å¼">å‘½ä»¤æ¨¡å¼</h1><p>å‘½ä»¤æ¨¡å¼å¯å°†â€œåŠ¨ä½œçš„è¯·æ±‚è€…â€ï¼ˆé¥æŽ§å™¨ï¼‰ä»Žâ€œåŠ¨ä½œçš„æ‰§è¡Œè€…â€ï¼ˆå®¶ç”µè£…ç½®ï¼‰å¯¹è±¡ä¸­è§£è€¦ã€‚</p><p>æ€Žä¹ˆèƒ½å°†å®ƒä»¬è§£è€¦ï¼Ÿé‡‡ç”¨â€œå‘½ä»¤å¯¹è±¡â€å°±å¯ä»¥åŠžåˆ°ã€‚æŠŠè¯·æ±‚ï¼ˆä¾‹å¦‚â€œæ‰“å¼€ç”µç¯â€ï¼‰å°è£…æˆä¸€ä¸ªç‰¹å®šå¯¹è±¡ã€‚å¦‚æžœå¯¹æ¯ä¸ªæŒ‰é’®éƒ½å­˜å‚¨ä¸€ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œé‚£ä¹ˆå½“æŒ‰é’®è¢«æŒ‰ä¸‹çš„æ—¶å€™ï¼Œå°±å¯ä»¥è¯·â€å‘½ä»¤å¯¹è±¡â€œåšç›¸å…³çš„å·¥ä½œã€‚é¥æŽ§å™¨å¹¶ä¸éœ€è¦çŸ¥é“å·¥ä½œçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œåªè¦æœ‰ä¸ªå‘½ä»¤å¯¹è±¡èƒ½å’Œæ­£ç¡®çš„å¯¹è±¡ï¼ˆå³å®¶ç”µè£…ç½®ï¼‰æ²Ÿé€šï¼ŒæŠŠäº‹æƒ…åšå¥½å°±å¯ä»¥äº†ã€‚</p><a id="more"></a><ul><li>å®žçŽ°å‘½ä»¤æŽ¥å£</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®žçŽ°ä¸€ä¸ªæ‰“å¼€ç”µç¯çš„å‘½ä»¤</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LightOnCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">    Light light;  <span class="comment">// æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LightOnCommand</span><span class="params">(Light light)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.light = light;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// executeæ–¹æ³•çŸ¥é“å¦‚ä½•æ²Ÿé€šå®¶ç”µè£…ç½®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨å‘½ä»¤å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleRemoteControl</span> </span>&#123;</span><br><span class="line">    Command slot;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleRemoteControl</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommand</span><span class="params">(Command command)</span> </span>&#123;</span><br><span class="line">        slot = command;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é¥æŽ§å™¨ä¸çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆï¼ŒåªçŸ¥é“æŒ‰é’®è¢«æŒ‰ä¸‹æ—¶è°ƒç”¨å‘½ä»¤çš„executeæ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buttonWasPressed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        slot.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç®€å•æµ‹è¯•</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteControlTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleRemoteControl remote = <span class="keyword">new</span> SimpleRemoteControl();</span><br><span class="line">        Light light = <span class="keyword">new</span> Light();</span><br><span class="line">        LightOnCommand lightOn = <span class="keyword">new</span> LightOnCommand(light);</span><br><span class="line"></span><br><span class="line">        remote.setCommand(lightOn);  <span class="comment">// ç»„è£…</span></span><br><span class="line">        remote.buttonWasPressed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å®šä¹‰å‘½ä»¤æ¨¡å¼">å®šä¹‰å‘½ä»¤æ¨¡å¼</h1><p>å‘½ä»¤æ¨¡å¼å°†â€œè¯·æ±‚â€å°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ã€é˜Ÿåˆ—æˆ–è€…æ—¥å¿—æ¥å‚æ•°åŒ–å…¶ä»–å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼ä¹Ÿæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</p><p>ä¸€ä¸ªå‘½ä»¤å¯¹è±¡é€šè¿‡åœ¨ç‰¹å®šæŽ¥æ”¶è€…ä¸Šç»‘å®šä¸€ç»„åŠ¨ä½œæ¥å°è£…ä¸€ä¸ªè¯·æ±‚ã€‚è¦è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œå‘½ä»¤å¯¹è±¡å°†åŠ¨ä½œå’ŒæŽ¥æ”¶è€…åŒ…è¿›å¯¹è±¡ä¸­ã€‚è¿™ä¸ªå¯¹è±¡åªæš´éœ²å‡ºä¸€ä¸ª <code>execute()</code> æ–¹æ³•ï¼Œå½“æ­¤æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒæŽ¥æ”¶è€…å°±ä¼šè¿›è¡Œè¿™äº›åŠ¨ä½œã€‚ä»Žå¤–é¢æ¥çœ‹ï¼Œå…¶ä»–å¯¹è±¡ä¸çŸ¥é“ç©¶ç«Ÿå“ªä¸ªæŽ¥æ”¶è€…è¿›è¡Œäº†å“ªäº›åŠ¨ä½œï¼ŒåªçŸ¥é“å¦‚æžœè°ƒç”¨ <code>execute()</code> æ–¹æ³•ï¼Œè¯·æ±‚çš„ç›®çš„å°±èƒ½è¾¾åˆ°ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VP11Im915CVl-odcM8Vy025UF7Njx6KTdxdapihkA8K9c-R142kmX912Cf2WL0nJDkd3j3kkfxv2quwEkK5xcUMzDx__xqr6Im42FKUFaGvw4ambyrF1cecpeE2iQbbeZnICGp1HKK7yYnkwhf8Kmk8CQXRGPNbhMoaf6g5WfbKCSZWQbRLOR0dQ1mnQWNFDvKzGBQf9YvegfYK4Hu3p53WorCYJb1442R-uGR0955PX_-4tcI6Gl288F4ipID2NU-oiNcCNiVefQzVSYUrEdhohcUjqlVxK7tQKi4yadukSn5PleSWK3WkDRa9Puv4rnxvTLOX10PdQGOOY8xqsy0ULURF71xxUwrwxn-ul-Qq4OQtnelKwBqz5NxWbYB2Rtvx9D-2ZDrCsklwqoo8Y2-aWOQrJixdEx-qMbHb7VLGN7STxkPit1kovoqMzYmT9aQ9_jXD2SY_kufttt5cR-xlE8tCw_dZazz_OiCnXtm00"><h1 id="å®žçŽ°é¥æŽ§å™¨">å®žçŽ°é¥æŽ§å™¨</h1><img src="http://www.plantuml.com/plantuml/svg/ZLD1RzCm5BxdL_Yu7TRTIzK3krQ0k73XagKEhPJOA76bebAfPTqeexHbR4ni73POjGd4sWbKsfNy6cAdEV4NSEBK96qEv63PttlvlkVlFPVAHGYW-PGy0oOqjw6bb094ArkQ0HNDK6qRF8Gc9d0B8s9X0zGKmBz2sIO0eoricYegsZ5CrnDWT00LLCJHFiHjIABZsde8O7ItGWX6ZrJxGSKkGOdhUdeWO5oDr9Ko8j3ILGrAxLnEOlbyT86QkcqJIzL87S0gr2e4HhInGA0GKWeV2kKd9N9_SMTf10U14QpXMPA1ca0p6Asjtm5rMNCyfEiYbfIG5lw_ne8eJGGbDUxX97kSRNCJkBE6EstxEuuxUKER9ykSgHc9yYFQG7RHmD34v1Xjv1VjoGBMQRAFhzn9mvkrsBuplpcdRnrtTg781ZxFP9RiJuj9tv91UM5bgOCRl8WGKfPz_nSHLHUmMeGMo2Jp9L6EgyGJL_XM4X3V0WFgmOD9Fh0iyAxFlVwUi4COyUTNXmrxr7d7Ejocrtpr3wuv-1ZHqSryjECTNdcd4tfxw9sqgjMLHy7UJzdtep3VF_x1kWE_SSRQ_Vbm8EZvNt88HExyqrT1-xln8grMSOiieErJEhiLB7GuvPtZAbvhJFlTeBOzkZkc-sTpnw7jaTySiEub_N35vLZlW5to-Vac-QrmTBY0d8femykblS-qts77Oywv-vDUlEJUk9ClOYP5mPpdBm00"><p>NoCommand å¯¹è±¡æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼ˆnull objectï¼‰çš„ä¾‹å­ã€‚å½“ä½ ä¸æƒ³è¿”å›žä¸€ä¸ªæœ‰æ„ä¹‰çš„å¯¹è±¡æ—¶ï¼Œç©ºå¯¹è±¡å°±å¾ˆæœ‰ç”¨ã€‚åœ¨è®¸å¤šè®¾è®¡æ¨¡å¼ä¸­ï¼Œéƒ½ä¼šçœ‹åˆ°ç©ºå¯¹è±¡çš„ä½¿ç”¨ã€‚ç”šè‡³æœ‰äº›æ—¶å€™ï¼Œç©ºå¯¹è±¡æœ¬èº«ä¹Ÿè¢«çˆ±è§†ä¸ºä¸€ç§è®¾è®¡æ¨¡å¼ã€‚æŽ¥ä¸‹é‡Œçœ‹çœ‹ RemoteControl çš„ä»£ç ç†è§£é¥æŽ§å™¨æ˜¯å¦‚ä½•è®°å½•å¹¶æ’¤é”€ä¸Šä¸€ä¸ªå‘½ä»¤çš„ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line">    Command[] onCommands;</span><br><span class="line">    Commandp[] offCommands;</span><br><span class="line">    Command undoCommand;  <span class="comment">// å‰ä¸€ä¸ªå‘½ä»¤å°†è¢«è®°å½•åœ¨è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RemoteControl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        onCommands = <span class="keyword">new</span> Command[<span class="number">7</span>];</span><br><span class="line">        offCommands = <span class="keyword">new</span> Command[<span class="number">7</span>];</span><br><span class="line">        Command noCommand = <span class="keyword">new</span> NoCommand();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            onCommand[i] = noCommand;</span><br><span class="line">            offCommand[i] = noCommand;</span><br><span class="line">        &#125;</span><br><span class="line">        undoCommand = noCommand;  <span class="comment">// åˆå§‹æ—¶ï¼Œæ’¤é”€å‘½ä»¤ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommand</span><span class="params">(<span class="keyword">int</span> slot, Command onCommand, Command offCommand)</span> </span>&#123;</span><br><span class="line">        onCommands[slot] = onCommand;</span><br><span class="line">        offCommands[slot] = offCommand;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonWasPushed</span><span class="params">(<span class="keyword">int</span> slot)</span> </span>&#123;</span><br><span class="line">        onCommands[slot].execute();</span><br><span class="line">        undoCommand = onCommands[slot];  <span class="comment">// è®°å½•å‰ä¸€ä¸ªå‘½ä»¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">offButtonWasPushed</span><span class="params">(<span class="keyword">int</span> slot)</span> </span>&#123;</span><br><span class="line">        offCommands[slot].execute();</span><br><span class="line">        undoCommand = offCommands[slot];  <span class="comment">// è®°å½•å‰ä¸€ä¸ªå‘½ä»¤</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undoButtonWasPushed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        undoCommand.undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”µç¯çš„æ’¤é”€å¾ˆå®¹æ˜“ã€‚é€šå¸¸ï¼Œæƒ³è¦å®žçŽ°æ’¤é”€çš„åŠŸèƒ½ï¼Œéœ€è¦è®°å½•ä¸€äº›çŠ¶æ€ã€‚æ¯”æ–¹è¯´å¤©èŠ±æ¿ä¸Šçš„åŠæ‰‡ï¼ŒåŠæ‰‡å…è®¸æœ‰å¤šç§è½¬åŠ¨é€Ÿåº¦ï¼Œå½“ç„¶ä¹Ÿå…è®¸è¢«å…³é—­ã€‚æˆ‘ä»¬éœ€è¦è¿½è¸ªåŠæ‰‡çš„æœ€åŽè®¾ç½®é€Ÿåº¦ï¼Œå¦‚æžœ <code>undo()</code> æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œå°±è¦æ¢å¤æˆä¹‹å‰åŠæ‰‡é€Ÿåº¦çš„è®¾ç½®å€¼ã€‚å¤©èŠ±æ¿åŠæ‰‡æœ‰å››ä¸ªå‘½ä»¤ï¼Œåˆ†åˆ«å¯¹åº”â€œå…³é—­â€ã€â€œä½Žé€Ÿâ€ã€â€œä¸­é€Ÿâ€å’Œâ€œé«˜é€Ÿâ€å››ç§æ“ä½œã€‚ä¸‹é¢æ˜¯ CeilingFanHighCommand çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CeilingFanHighCommand</span> </span>&#123;</span><br><span class="line">    CeilingFan ceilingFan;</span><br><span class="line">    <span class="keyword">int</span> prevSpeed;  <span class="comment">// è¿½è¸ªæœ€åŽè®¾ç½®é€Ÿåº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CeilingFanHighCommand</span><span class="params">(CeilingFan ceilingFan)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ceilingFan = ceilingFan;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        prevSpeed = ceilingFan.getSpeed();  <span class="comment">// è®°å½•çŠ¶æ€</span></span><br><span class="line">        ceilingFan.high();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (prevSpeed == CeilingFan.HIGH) &#123;</span><br><span class="line">            ceilingFan.high();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevSpeed == CeilingFan.MEDIUM) &#123;</span><br><span class="line">            ceilingFan.medium();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevSpeed == CeilingFan.LOW) &#123;</span><br><span class="line">            ceilingFan.low();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (prevSpeed == CeilingFan.OFF) &#123;</span><br><span class="line">            ceilingFan.off();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="party-æ¨¡å¼å®å‘½ä»¤">Party æ¨¡å¼ï¼šå®å‘½ä»¤</h1><p>å¦‚æžœæ‹¥æœ‰äº†ä¸€ä¸ªé¥æŽ§å™¨ï¼Œå´æ— æ³•å…‰å‡­æŒ‰ä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œå°±èƒ½åŒæ—¶å¼„æŒ‰ç¯å…‰ã€æ‰“å¼€éŸ³å“å’Œç”µè§†ã€è®¾ç½®å¥½ DVDï¼Œå¹¶è®©çƒ­æ°´å™¨å¼€å§‹åŠ æ¸©ï¼Œé‚£ä¹ˆè¦è¿™ä¸ªé¥æŽ§å™¨è¿˜æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œè€Œä¸”å®Œå…¨ä¸éœ€è¦æ”¹å˜é¥æŽ§å™¨ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/bLB1IiD05BplLpmyjOUsz6pfnQlYfVIUfXiRQ3QIR4MfWQhrK2c8e3s87Wg28egA89LO_HZJJM_-WadNfjbjA3M7aCpipBptzjNqAWPiRDCzCB1HmHQgXOYgMseT8vrGR6cAYc7DD0o5LA5GYB1Y4Pe8WgUfL6ngAIfr0EzYjK5nAYqJ3L8r0zH1QbsnRLZNjsfqaqnTkSy4X7hudln7Pj3aQDOagVGgE1EMEyueJUES6A5f_ywO6YM5436ZL1PxA9M1xY0GnY1r7aZ4cfRGyA9v0s49_2EiCsQxcDzGLCkKHs5JK3bapmqZbmFlyvezzCVFH_xvtVISDtXaJwVUu7vqDlJS6_-o7ObOxvszNiY3Mzg7Ao8J1qKhjv_DIWkJn4LJ5SdO5SqHoPAiC2mahMecK-I1I5wm6HDVYn0jbP5mxN-Ov5n8Jfx9vWx4SvB81L9YKWmhldlBEb_iP3X-wVEB-Fdeiku1k-fuWvRljaV7RvxRuzHtwt0551j87WdR55YJ_2y0"><h1 id="é—®ç­”">é—®ç­”</h1><ul><li><p><strong>é—®</strong>ï¼šæŽ¥æ”¶è€…ä¸€å®šæœ‰å¿…è¦å­˜åœ¨å—ï¼Ÿä¸ºä½•å‘½ä»¤å¯¹è±¡ä¸ç›´æŽ¥å®žçŽ° <code>execute()</code> æ–¹æ³•çš„ç»†èŠ‚ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å°½é‡è®¾è®¡â€œå‚»ç“œâ€å‘½ä»¤å¯¹è±¡ï¼Œå®ƒåªæ‡‚å¾—è°ƒç”¨ä¸€ä¸ªæŽ¥æ”¶è€…çš„ä¸€ä¸ªè¡Œä¸ºï¼Œç„¶è€Œï¼Œæœ‰è®¸å¤šâ€œèªæ˜Žâ€å‘½ä»¤å¯¹è±¡ä¼šå®žçŽ°è®¸å¤šé€»è¾‘ï¼Œç›´æŽ¥å®Œæˆä¸€ä¸ªè¯·æ±‚ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥è®¾è®¡èªæ˜Žçš„å‘½ä»¤å¯¹è±¡ï¼Œåªæ˜¯è¿™æ ·ä¸€æ¥ï¼Œè°ƒç”¨è€…å’ŒæŽ¥æ”¶è€…ä¹‹é—´çš„è§£è€¦æˆéƒ½æ˜¯æ¯”ä¸ä¸Šâ€œå‚»ç“œâ€å‘½ä»¤å¯¹è±¡çš„ï¼Œè€Œä¸”ï¼Œä½ ä¹Ÿä¸èƒ½å¤ŸæŠŠæŽ¥æ”¶è€…å½“ä½œå‚æ•°ä¼ ç»™å‘½ä»¤ã€‚</p></li><li><p><strong>é—®</strong>ï¼šå¦‚æžœèƒ½å¤Ÿå®žçŽ°å¤šå±‚æ¬¡çš„æ’¤é”€æ“ä½œï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä¸è¦åªæ˜¯è®°å½•æœ€åŽä¸€ä¸ªè¢«æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªå †æ ˆè®°å½•æ“ä½œè¿‡ç¨‹çš„æ¯ä¸€ä¸ªå‘½ä»¤ã€‚å½“æŒ‰ä¸‹äº†æ’¤é”€æŒ‰é’®ï¼Œä»Žå †æ ˆä¸­å–å‡ºæœ€ä¸Šå±‚çš„å‘½ä»¤ï¼Œç„¶åŽè°ƒç”¨å®ƒçš„ <code>undo()</code> æ–¹æ³•ã€‚</p></li><li><p><strong>é—®</strong>ï¼šæˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ª PartyCommandï¼Œç„¶åŽåœ¨å®ƒçš„ <code>execute()</code> æ–¹æ³•ä¸­è°ƒç”¨å…¶ä»–å‘½ä»¤ï¼Œåˆ©ç”¨è¿™ç§åšæ³•å®žçŽ° Party æ¨¡å¼å—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šä½ å¯ä»¥è¿™ä¹ˆåšï¼Œç„¶è€Œï¼Œè¿™ç­‰äºŽæŠŠ Party æ¨¡å¼â€œç¡¬ç¼–ç â€åˆ° PartyCommand ä¸­ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆéº»çƒ¦å‘¢ï¼Ÿ<strong>åˆ©ç”¨å®å‘½ä»¤ï¼Œä½ å¯ä»¥åŠ¨æ€åœ°å†³å®š PartyCommand æ˜¯ç”±å“ªäº›å‘½ä»¤ç»„æˆï¼Œæ‰€ä»¥å®å‘½ä»¤åœ¨ä½¿ç”¨ä¸Šæ›´çµæ´»ã€‚</strong>ä¸€èˆ¬æ¥è¯´ï¼Œå®å‘½ä»¤çš„åšæ³•æ›´ä¼˜é›…ï¼Œä¹Ÿéœ€è¦è¾ƒå°‘çš„ä»£ç ã€‚</p></li></ul><h1 id="å‘½ä»¤æ¨¡å¼çš„æ›´å¤šç”¨é€”">å‘½ä»¤æ¨¡å¼çš„æ›´å¤šç”¨é€”</h1><p>å‘½ä»¤å¯ä»¥å°†è¿ç®—å—æ‰“åŒ…ï¼ˆä¸€ä¸ªæŽ¥æ”¶è€…å’Œä¸€ç»„åŠ¨ä½œï¼‰ï¼Œç„¶åŽå°†å®ƒä¼ æ¥ä¼ åŽ»ï¼Œå°±åƒæ˜¯ä¸€èˆ¬çš„å¯¹è±¡ä¸€æ ·ã€‚çŽ°åœ¨ï¼Œå³ä½¿åœ¨å‘½ä»¤å¯¹è±¡è¢«åˆ›å»ºè®¸ä¹…ä¹‹åŽï¼Œè¿ç®—ä¾ç„¶å¯ä»¥è¢«è°ƒç”¨ã€‚äº‹å®žä¸Šï¼Œ<strong>å®ƒç”šè‡³å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¢«è°ƒç”¨</strong>ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™æ ·çš„ç‰¹æ€§è¡ç”Ÿä¸€äº›åº”ç”¨ã€‚ä¾‹å¦‚ï¼šæ—¥ç¨‹å®‰æŽ’ã€çº¿ç¨‹æ± ã€å·¥ä½œé˜Ÿåˆ—ç­‰ã€‚</p><h2 id="é˜Ÿåˆ—è¯·æ±‚">é˜Ÿåˆ—è¯·æ±‚</h2><p>æƒ³æƒ³æœ‰ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ï¼šä½ åœ¨æŸä¸€ç«¯æ·»åŠ å‘½ä»¤ï¼Œç„¶åŽå¦ä¸€æ®µåˆ™æ˜¯çº¿ç¨‹ã€‚çº¿ç¨‹è¿›è¡Œä¸‹é¢çš„åŠ¨ä½œï¼šä»Žé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå‘½ä»¤ï¼Œè°ƒç”¨å®ƒçš„ <code>execute()</code> æ–¹æ³•ï¼Œç­‰å¾…è¿™ä¸ªè°ƒç”¨å®Œæˆï¼Œç„¶åŽå°†æ­¤å‘½ä»¤å¯¹è±¡ä¸¢å¼ƒï¼Œå†å–å‡ºä¸‹ä¸€ä¸ªå‘½ä»¤â€¦â€¦</p><p>å·¥ä½œé˜Ÿåˆ—ç±»å’Œè¿›è¡Œè®¡ç®—çš„å¯¹è±¡ä¹‹é—´å®Œå…¨æ˜¯è§£è€¦çš„ã€‚æ­¤åˆ»çº¿ç¨‹å¯èƒ½åœ¨è¿›è¡Œè´¢åŠ¡è®¡ç®—ï¼Œä¸‹ä¸€åˆ»å´åœ¨è¯»å–ç½‘ç»œæ•°æ®ã€‚å·¥ä½œé˜Ÿåˆ—å¯¹è±¡ä¸åœ¨ä¹Žåˆ°åº•åšäº›ä»€ä¹ˆï¼Œå®ƒä»¬åªçŸ¥é“å–å‡ºå‘½ä»¤å¯¹è±¡ï¼Œç„¶åŽè°ƒç”¨å…¶ <code>execute()</code> æ–¹æ³•ã€‚ç±»ä¼¼åœ°ï¼Œåªè¦æ˜¯å®žçŽ°å‘½ä»¤æ¨¡å¼çš„å¯¹è±¡ï¼Œå°±å¯ä»¥æ”¾å…¥é˜Ÿåˆ—é‡Œï¼Œå½“çº¿ç¨‹å¯ç”¨æ—¶ï¼Œå°±è°ƒç”¨å¯¹è±¡çš„ <code>execute()</code> æ–¹æ³•ã€‚</p><h2 id="æ—¥å¿—è¯·æ±‚">æ—¥å¿—è¯·æ±‚</h2><p><strong>æŸäº›åº”ç”¨éœ€è¦æˆ‘ä»¬å°†æ‰€æœ‰çš„åŠ¨ä½œéƒ½è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œå¹¶èƒ½åœ¨ç³»ç»Ÿæ­»æœºä¹‹åŽï¼Œé‡æ–°è°ƒç”¨è¿™äº›åŠ¨ä½œæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚</strong>é€šè¿‡æ–°å¢žä¸¤ä¸ªæ–¹æ³•ï¼ˆ<code>store(), load()</code>ï¼‰ï¼Œå‘½ä»¤æ¨¡å¼å°±èƒ½å¤Ÿæ”¯æŒè¿™ä¸€ç‚¹ã€‚åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¯¹è±¡çš„åºåˆ—åŒ–ï¼ˆSerializationï¼‰å®žçŽ°è¿™äº›æ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬è®¤ä¸ºåºåˆ—åŒ–æœ€å¥½è¿˜æ˜¯åªç”¨åœ¨å¯¹è±¡çš„æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ä¸Šã€‚</p><p>è¦æ€Žä¹ˆåšå‘¢ï¼Ÿå½“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œå°†åŽ†å²è®°å½•å‚¨å­˜åœ¨ç£ç›˜ä¸­ã€‚ä¸€æ—¦ç³»ç»Ÿæ­»æœºï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å‘½ä»¤å¯¹è±¡é‡æ–°åŠ è½½ï¼Œå¹¶æˆæ‰¹åœ°ä¾æ¬¡è°ƒç”¨è¿™äº›å¯¹è±¡çš„ <code>execute()</code> æ–¹æ³•ã€‚</p><p>è¿™ç§æ—¥å¿—çš„æ–¹å¼å¯¹äºŽé¥æŽ§å™¨æ¥è¯´æ²¡æœ‰æ„ä¹‰ï¼Œç„¶è€Œï¼Œ<strong>æœ‰è®¸å¤šè°ƒç”¨å¤§åž‹æ•°æ®ç»“æž„çš„åŠ¨ä½œçš„åº”ç”¨æ— æ³•åœ¨æ¯æ¬¡æ”¹å˜å‘ç”Ÿæ—¶è¢«å¿«é€Ÿåœ°å­˜å‚¨</strong>ã€‚é€šè¿‡ä½¿ç”¨è®°å½•æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šæ¬¡æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰ä¹‹åŽçš„æ‰€æœ‰æ“ä½œè®°å½•ä¸‹æ¥ï¼Œå¦‚æžœç³»ç»Ÿå‡ºçŠ¶å†µï¼Œä»Žæ£€æŸ¥ç‚¹å¼€å§‹åº”ç”¨è¿™äº›æ“ä½œã€‚æ¯”æ–¹è¯´ï¼Œ<strong>å¯¹äºŽç”µå­è¡¨æ ¼åº”ç”¨ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦å®žçŽ°çš„é”™è¯¯æ¢å¤æ–¹å¼æ˜¯å°†ç”µå­è¡¨æ ¼çš„æ“ä½œè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ç”µå­è¡¨æ ¼å·²æœ‰å˜åŒ–å°±è®°å½•æ•´ä¸ªç”µå­è¡¨æ ¼</strong>ã€‚å¯¹æ›´é«˜çº§çš„åº”ç”¨è€Œè¨€ï¼Œ<strong>è¿™äº›æŠ€å·§å¯ä»¥è¢«æ‰©å±•åº”ç”¨åˆ°äº‹ç‰©ï¼ˆtransactionï¼‰å¤„ç†ä¸­</strong>ï¼Œä¸€æ•´ç¾¤æ“ä½œå¿…é¡»å…¨éƒ¨è¿›è¡Œå®Œæˆï¼Œæˆ–è€…æ²¡æœ‰è¿›è¡Œä»»ä½•çš„æ“ä½œã€‚</p><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>å‘½ä»¤æ¨¡å¼å°†å‘ç”Ÿè¯·æ±‚çš„å¯¹è±¡å’Œæ‰§è¡Œè¯·æ±‚çš„å¯¹è±¡è§£è€¦ã€‚</li><li>åœ¨è¢«è§£è€¦çš„ä¸¤è€…ä¹‹é—´æ˜¯é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šçš„ã€‚å‘½ä»¤å¯¹è±¡å°è£…äº†æŽ¥æ”¶è€…å’Œä¸€ä¸ªæˆ–ä¸€ç»„åŠ¨ä½œã€‚</li><li>è°ƒç”¨è€…å¯ä»¥æŽ¥å—å‘½ä»¤å½“ä½œå‚æ•°ï¼Œç”šè‡³åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è¿›è¡Œã€‚</li><li>å‘½ä»¤å¯ä»¥æ”¯æŒæ’¤é”€ï¼Œåšæ³•æ˜¯å®žçŽ°ä¸€ä¸ª <code>undo()</code> æ–¹æ³•æ¥å›žåˆ° <code>execute()</code> è¢«æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚</li><li>å®å‘½ä»¤æ˜¯å‘½ä»¤çš„ä¸€ç§ç®€å•çš„å»¶ä¼¸ï¼Œå…è®¸è°ƒç”¨å¤šä¸ªå‘½ä»¤ã€‚å®æ–¹æ³•ä¹Ÿæ”¯æŒæ’¤é”€ã€‚</li><li><strong>å®žé™…æ“ä½œæ—¶ï¼Œå¾ˆå¸¸è§ä½¿ç”¨â€èªæ˜Žâ€œå‘½ä»¤å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ç›´æŽ¥å®žçŽ°äº†è¯·æ±‚ï¼Œè€Œä¸æ˜¯å°†å·¥ä½œå§”æ‰˜ç»™æŽ¥æ”¶è€…ã€‚</strong></li><li>å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥å®žçŽ°æ—¥å¿—å’Œäº‹ç‰©ç³»ç»Ÿã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ä»¶æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/singleton-pattern/"/>
      <url>/notes/head-first-design-patterns/singleton-pattern/</url>
      
        <content type="html"><![CDATA[<p>æœ‰ä¸€äº›å¯¹è±¡å…¶å®žæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªï¼Œæ¯”æ–¹è¯´ï¼šçº¿ç¨‹æ± ï¼ˆthreadpoolï¼‰ã€ç¼“å­˜ï¼ˆcacheï¼‰ã€å¯¹è¯æ¡†ã€å¤„ç†åå¥½è®¾ç½®å’Œæ³¨å†Œè¡¨ï¼ˆregistryï¼‰çš„å¯¹è±¡ã€æ—¥å¿—å¯¹è±¡ï¼Œå……å½“æ‰“å°æœºã€æ˜¾å¡ç­‰è®¾å¤‡çš„é©±åŠ¨ç¨‹åºçš„å¯¹è±¡ã€‚äº‹å®žä¸Šï¼Œè¿™ç±»å¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¦‚æžœåˆ¶é€ å‡ºå¤šä¸ªå®žä¾‹ï¼Œå°±ä¼šå¯¼è‡´è®¸å¤šé—®é¢˜äº§ç”Ÿï¼Œä¾‹å¦‚ï¼šç¨‹åºçš„è¡Œä¸ºå¼‚å¸¸ã€èµ„æºä½¿ç”¨è¿‡é‡ï¼Œæˆ–è€…æ˜¯ä¸ä¸€è‡´çš„ç»“æžœã€‚</p><p>å•ä»¶æ¨¡å¼æ˜¯ç»å¾—èµ·æ—¶é—´è€ƒéªŒçš„æ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªå®žä¾‹ä¼šè¢«åˆ›å»ºã€‚å•ä»¶æ¨¡å¼ä¹Ÿç»™äº†æˆ‘ä»¬ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼Œå’Œå…¨å±€å˜é‡ä¸€æ ·æ–¹ä¾¿ï¼Œæœ‰æ²¡æœ‰å…¨å±€å˜é‡çš„ç¼ºç‚¹ã€‚ä»€ä¹ˆç¼ºç‚¹ï¼Ÿä¸¾ä¾‹æ¥è¯´ï¼šå¦‚æžœå°†å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé‚£ä¹ˆä½ å¿…é¡»åœ¨ç¨‹åºå·²å¼€å§‹å°±åˆ›å»ºå¥½å¯¹è±¡ï¼ˆè¿™å…¶å®žå’Œå®žçŽ°æœ‰å…³ã€‚æœ‰äº› JVM çš„å®žçŽ°æ˜¯ï¼šåœ¨ç”¨åˆ°çš„æ—¶å€™æ‰åˆ›å»ºå¯¹è±¡ï¼‰ï¼Œå¯¹å§ï¼Ÿä¸‡ä¸€è¿™ä¸ªå¯¹è±¡éžå¸¸è€—è´¹èµ„æºï¼Œè€Œç¨‹åºåœ¨è¿™æ¬¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­åˆä¸€ç›´æ²¡ç”¨åˆ°å®ƒï¼Œä¸å°±å½¢æˆæµªè´¹äº†å—ï¼Ÿ</p><h1 id="å®šä¹‰å•ä»¶æ¨¡å¼">å®šä¹‰å•ä»¶æ¨¡å¼</h1><p>å•ä»¶æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONAmHdvgNdf9RavobKSoae51HbbYMMf2A9bkPb5fQcUkOLboJc9QU2b9GcvMGcAm3v9K0AeJ0zjGIcIaCJgAuwDxKa8p-bLa5VN-5fwxOdkwSzcxRpsUQfNBLS24swTWWJh1IUzJG-czFvedtLq-qRdyzgURfdwlCfAm00"><h1 id="ç»å…¸çš„å•ä»¶æ¨¡å¼å®žçŽ°">ç»å…¸çš„å•ä»¶æ¨¡å¼å®žçŽ°</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">        uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æœ‰å¤šä¸ªçº¿ç¨‹è¦æ‰§è¡Œ <code>Singleton.getInstance()</code> æ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„å¯¹è±¡ã€‚</p><table><thead><tr class="header"><th>çº¿ç¨‹ä¸€</th><th>çº¿ç¨‹äºŒ</th><th>uniqueInstance</th></tr></thead><tbody><tr class="odd"><td><code>public static Singleton getInstance() {</code></td><td></td><td><code>null</code></td></tr><tr class="even"><td></td><td><code>public static Singleton getInstance() {</code></td><td><code>null</code></td></tr><tr class="odd"><td><code>if (uniqueInstance == null) {</code></td><td></td><td><code>null</code></td></tr><tr class="even"><td></td><td><code>if (uniqueInstance == null) {</code></td><td><code>null</code></td></tr><tr class="odd"><td><code>uniqueInstance = new Singleton();</code></td><td></td><td><code>&lt;object1&gt;</code></td></tr><tr class="even"><td><code>return uniqueInstance;</code></td><td></td><td><code>&lt;object1&gt;</code></td></tr><tr class="odd"><td></td><td><code>uniqueInstance = new Singleton();</code></td><td><code>&lt;object2&gt;</code></td></tr><tr class="even"><td></td><td><code>return uniqueInstance;</code></td><td><code>&lt;object2&gt;</code></td></tr></tbody></table><a id="more"></a><h1 id="å¤„ç†å¤šçº¿ç¨‹">å¤„ç†å¤šçº¿ç¨‹</h1><p>åªè¦æŠŠ <code>getInstance()</code> å˜æˆåŒæ­¥ï¼ˆsynchronizedï¼‰æ–¹æ³•ï¼Œå¤šçº¿ç¨‹ç¾éš¾å‡ ä¹Žå°±å¯ä»¥è½»æ˜“åœ°è§£å†³äº†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯åŒæ­¥ä¼šé™ä½Žæ€§èƒ½ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼šåªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œæ‰çœŸæ­£éœ€è¦åŒæ­¥ã€‚æ¢å¥è¯è¯´ï¼Œä¸€æ—¦è®¾ç½®å¥½ uniqueInstance å˜é‡ï¼Œå°±ä¸å†éœ€è¦åŒæ­¥è¿™ä¸ªæ–¹æ³•äº†ã€‚ä¹‹åŽæ¯æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ŒåŒæ­¥éƒ½æ˜¯ä¸€ç§ç´¯èµ˜ã€‚</p><h1 id="æ”¹å–„å¤šçº¿ç¨‹">æ”¹å–„å¤šçº¿ç¨‹</h1><h2 id="ç”¨å›žç»å…¸çš„å•ä»¶æ¨¡å¼">ç”¨å›žç»å…¸çš„å•ä»¶æ¨¡å¼</h2><p>æ²¡é”™ï¼Œå¦‚æžœä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥æŽ¥å— <code>getInstance()</code> é€ æˆçš„é¢å¤–è´Ÿæ‹…ï¼Œå°±å¿˜äº†è¿™ä»¶äº‹å§ã€‚</p><h2 id="ä½¿ç”¨æ€¥åˆ‡åˆ›å»ºå®žä¾‹">ä½¿ç”¨â€œæ€¥åˆ‡â€åˆ›å»ºå®žä¾‹</h2><p>å¦‚æžœåº”ç”¨ç¨‹åºæ€»æ˜¯åˆ›å»ºå¹¶ä½¿ç”¨å•ä»¶æ¨¡å¼ï¼Œæˆ–è€…åœ¨åˆ›å»ºå’Œè¿è¡Œæ—¶æ–¹é¢çš„è´Ÿæ‹…ä¸å¤ªç¹é‡ï¼Œä½ å¯èƒ½è¦æƒ³æ€¥åˆ‡ï¼ˆeagerlyï¼‰åˆ›å»ºæ­¤å•ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è¿™ä¸ªåšæ³•ï¼Œæˆ‘ä»¬ä¾èµ– JVM åœ¨åŠ è½½è¿™ä¸ªç±»æ—¶é©¬ä¸Šåˆ›å»ºæ­¤å”¯ä¸€çš„å•ä»¶ç¤ºä¾‹ã€‚JVM ä¿è¯åœ¨ä»»ä½•çº¿ç¨‹è®¿é—® uniqueInstance é™æ€å˜é‡ä¹‹å‰ï¼Œä¸€å®šå…ˆåˆ›å»ºæ­¤å®žä¾‹ã€‚</p><h2 id="åŒé‡æ£€æŸ¥åŠ é”">åŒé‡æ£€æŸ¥åŠ é”</h2><p>åˆ©ç”¨åŒé‡æ£€æŸ¥åŠ é”ï¼ˆdoule-checked lockingï¼‰ï¼Œé¦–å…ˆæ£€æŸ¥æ˜¯å¦å®žä¾‹å·²ç»åˆ›å»ºäº†ï¼Œå¦‚æžœå°šæœªåˆ›å»ºï¼Œâ€æ‰â€œè¿›è¡ŒåŒæ­¥ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¼šåŒæ­¥ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="comment">// volatile å…³é”®è¯ç¡®ä¿ï¼Œå½“uniqueInstanceå˜é‡è¢«åˆå§‹åŒ–æˆå®žä¾‹æ—¶ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¤šä¸ªçº¿ç¨‹æ­£ç¡®åœ°å¤„ç†uniqueInstanceå˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (uniqueInstance == <span class="keyword">null</span>) &#123;  <span class="comment">// è¿›å…¥åŒºå—åŽï¼Œå†æ£€æŸ¥ä¸€æ¬¡</span></span><br><span class="line">                    uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æžœæ€§èƒ½æ˜¯ä½ å…³å¿ƒçš„ç»ˆç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªåšæ³•å¯ä»¥å¸®ä½ å¤§å¤§åœ°å‡å°‘ <code>getInstance()</code> çš„æ—¶é—´è€—è´¹ã€‚</p><h2 id="iodh">IoDH</h2><p>ä¸€ç§è¢«ç§°ä¸º Initialization Demand Holderï¼ˆIoDHï¼‰çš„æŠ€æœ¯åŒæ ·å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¾¾åˆ°åŒé‡é”å®šçš„æ•ˆæžœã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HolderClass</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Singleton uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HolderClass.uniqueInstance;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŠ è½½ Singleton æ—¶ï¼Œç”±äºŽ uniqueInstance ä¸æ˜¯å…¶æˆå‘˜å˜é‡ï¼Œå› æ­¤ä¸ä¼šå®žä¾‹åŒ–ã€‚åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ getInstance æ—¶ï¼Œæ‰ä¼šåŠ è½½å†…éƒ¨ç±» HolderClassã€‚å…¶å†…éƒ¨æœ‰ä¸€ä¸ª static ä¿®é¥°çš„æˆå‘˜å˜é‡ uniqueInstanceï¼Œæ­¤æ—¶ä¼šåˆå§‹åŒ–è¿™ä¸ªæˆå‘˜å˜é‡ï¼Œç”± JVM è´Ÿè´£å…¶çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><h1 id="é—®ç­”">é—®ç­”</h1><ul><li><p><strong>é—®</strong>ï¼šéš¾é“æˆ‘ä¸èƒ½åˆ›å»ºä¸€ä¸ªç±»ï¼ŒæŠŠæ‰€æœ‰çš„æ–¹æ³•å’Œå˜é‡éƒ½å®šä¹‰ä¸ºé™æ€çš„ï¼ŒæŠŠç±»ç›´æŽ¥å½“åšä¸€ä¸ªå•ä»¶ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå¦‚æžœä½ çš„ç±»è‡ªç»™è‡ªè¶³ï¼Œè€Œä¸”ä¸ä¾èµ–äºŽå¤æ‚çš„åˆå§‹åŒ–ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™ä¹ˆåšã€‚ä½†æ˜¯ï¼Œå› ä¸ºé™æ€åˆå§‹åŒ–çš„æŽ§åˆ¶æƒæ˜¯åœ¨ Java æ‰‹ä¸Šï¼Œè¿™ä¹ˆåšæœ‰å¯èƒ½å¯¼è‡´æ··ä¹±ï¼Œç‰¹åˆ«æ˜¯å½“æœ‰è®¸å¤šç±»ç‰µæ¶‰å…¶ä¸­çš„æ—¶å€™ã€‚è¿™ä¹ˆåšå¸¸å¸¸ä¼šé€ æˆä¸€äº›å¾®å¦™çš„ã€ä¸å®¹æ˜“å‘çŽ°çš„å’Œåˆå§‹åŒ–æœ‰å…³çš„ bugã€‚<strong>é™¤éžä½ æœ‰ç»å¯¹çš„å¿…è¦ä½¿ç”¨ç±»çš„å•ä»¶ï¼Œå¦åˆ™è¿˜æ˜¯å»ºè®®ä½¿ç”¨å¯¹è±¡çš„å•ä»¶ï¼Œæ¯”è¾ƒä¿é™©ã€‚</strong></p></li><li><p><strong>é—®</strong>ï¼šå¬è¯´ä¸¤ä¸ªç±»åŠ è½½å™¨ï¼ˆclass loaderï¼‰å¯èƒ½æœ‰æœºä¼šå„è‡ªåˆ›å»ºè‡ªå·±çš„å•ä»¶å®žä¾‹ã€‚</p><p><strong>ç­”</strong>ï¼šæ˜¯çš„ã€‚æ¯ä¸ªç±»åŠ è½½å™¨éƒ½å®šä¹‰äº†ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¦‚æžœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„ç±»åŠ è½½å™¨ï¼Œä¸åŒçš„ç±»åŠ è½½å™¨å¯èƒ½ä¼šåŠ è½½åŒä¸€ä¸ªç±»ï¼Œä»Žæ•´ä¸ªç¨‹åºæ¥çœ‹ï¼ŒåŒä¸€ä¸ªç±»ä¼šè¢«åŠ è½½å¤šæ¬¡ã€‚å¦‚æžœè¿™æ ·çš„äº‹æƒ…å‘ç”Ÿåœ¨å•ä»¶ä¸Šï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ªå•ä»¶å¹¶å­˜çš„æ€ªå¼‚çŽ°è±¡ã€‚æ‰€ä»¥ï¼Œ<strong>å¦‚æžœä½ çš„ç¨‹åºæœ‰å¤šä¸ªç±»åŠ è½½å™¨åˆåŒæ—¶ä½¿ç”¨äº†å•ä»¶æ¨¡å¼ï¼Œè¯·å°å¿ƒã€‚æœ‰ä¸€ä¸ªè§£å†³åŠžæ³•ï¼šè‡ªè¡ŒæŒ‡å®šç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šåŒä¸€ä¸ªç±»åŠ è½½å™¨ã€‚</strong></p></li><li><p><strong>é—®</strong>ï¼šå•ä»¶æœ‰æ²¡æœ‰è¿åâ€œä¸€ä¸ªç±»ï¼Œä¸€ä¸ªè´£ä»»â€çš„åŽŸåˆ™å‘¢ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šæ˜¯è¿åäº†ã€‚å•ä»¶ç±»ä¸åªè´Ÿè´£ç®¡ç†è‡ªå·±çš„å®žä¾‹ï¼Œè¿˜åœ¨åº”ç”¨ç¨‹åºä¸­æ‹…å½“è§’è‰²ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è¢«è§†ä¸ºä¸¤ä¸ªè´£ä»»ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç”±ç±»ç®¡ç†è‡ªå·±çš„å®žä¾‹çš„åšæ³•å¹¶ä¸å°‘è§ã€‚è¿™å¯ä»¥è®©æ•´ä½“è®¾è®¡æ›´ç®€å•ã€‚æ›´ä½•å†µï¼Œè®¸å¤šå¼€å‘äººå‘˜éƒ½å·²ç»ç†Ÿæ‚‰äº†å•ä»¶æ¨¡å¼çš„è¿™ç§åšæ³•ã€‚</p></li></ul><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>å•ä»¶æ¨¡å¼ç¡®ä¿ç¨‹åºä¸­ä¸€ä¸ªç±»æœ€å¤šåªæœ‰ä¸€ä¸ªå®žä¾‹ã€‚</li><li>å•ä»¶æ¨¡å¼ä¹Ÿæä¾›è®¿é—®è¿™ä¸ªå®žä¾‹çš„å…¨å±€ç‚¹ã€‚</li><li>åœ¨ Java ä¸­å®žçŽ°å•ä»¶æ¨¡å¼éœ€è¦ç§æœ‰çš„æž„é€ å™¨ã€ä¸€ä¸ªé™æ€æ–¹æ³•å’Œä¸€ä¸ªé™æ€å˜é‡ã€‚</li><li>ç¡®å®šåœ¨æ€§èƒ½å’Œèµ„æºä¸Šçš„é™åˆ¶ï¼Œç„¶åŽå°å¿ƒåœ°é€‰æ‹©é€‚å½“çš„æ–¹æ³•æ¥å®žçŽ°å•ä»¶ï¼Œä»¥è§£å†³å¤šçº¿ç¨‹é—®é¢˜ï¼ˆæˆ‘ä»¬å¿…é¡»è®¤å®šæ‰€æœ‰çš„ç¨‹åºéƒ½æ˜¯å¤šçº¿ç¨‹çš„ï¼‰ã€‚</li><li>å°å¿ƒï¼Œä½ å¦‚æžœä½¿ç”¨å¤šä¸ªç±»åŠ è½½å™¨ï¼Œå¯èƒ½å¯¼è‡´å•ä»¶å¤±æ•ˆè€Œäº§ç”Ÿå¤šä¸ªå®žä¾‹ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å·¥åŽ‚æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/factory-pattern/"/>
      <url>/notes/head-first-design-patterns/factory-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥æ¯”è¨åº—">å¯¼å…¥ï¼šæ¯”è¨åº—</h1><p>èº«ä¸ºæ¯”è¨åº—çš„ä¸»äººï¼Œä½ çš„ä»£ç å¯èƒ½è¿™ä¹ˆå†™ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Pizza <span class="title">orderPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">new</span> Pizza();</span><br><span class="line"></span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">    pizza.cut();</span><br><span class="line">    pizza.box();</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å½“çœ‹åˆ°-newå°±ä¼šæƒ³åˆ°å…·ä½“">å½“çœ‹åˆ° &quot;new&quot;ï¼Œå°±ä¼šæƒ³åˆ°å…·ä½“</h2><p>æ˜¯çš„ï¼Œå½“ä½¿ç”¨ &quot;new&quot; æ—¶ï¼Œä½ çš„ç¡®æ˜¯åœ¨å®žä¾‹åŒ–ä¸€ä¸ªå…·ä½“ç±»ï¼Œæ‰€ä»¥ç”¨çš„çš„ç¡®æ˜¯å®žçŽ°ï¼Œè€Œä¸æ˜¯æŽ¥å£ã€‚</p><p>å½“ä½ éœ€è¦æ›´å¤šæ¯”è¨ç±»åž‹æ—¶ï¼Œé€šå¸¸ä¼šå†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Pizza <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza;</span><br><span class="line">    <span class="comment">// è¿™æ˜¯å˜åŒ–çš„éƒ¨åˆ†ï¼Œéšç€æ—¶é—´è¿‡åŽ»ï¼Œæ¯”è¨èœå•æ”¹å˜ï¼Œè¿™é‡Œå¿…é¡»ä¸€æ”¹å†æ”¹</span></span><br><span class="line">    <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"greek"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> GreekPizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"pepperoni"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> PepperoniPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯ä¸å˜çš„éƒ¨åˆ†</span></span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">    pizza.cut();</span><br><span class="line">    pizza.box();</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä»£ç ä½¿ç”¨å¤§é‡çš„å…·ä½“ç±»æ—¶ï¼Œç­‰äºŽæ˜¯è‡ªæ‰¾éº»çƒ¦ï¼Œå› ä¸ºä¸€æ—¦åŠ å…¥æ–°çš„å…·ä½“ç±»ï¼Œå°±å¿…é¡»ä¿®æ”¹ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„ä»£ç å¹¶éžâ€œå¯¹ä¿®æ”¹å…³é—­â€ã€‚</p><a id="more"></a><h2 id="ç®€å•å·¥åŽ‚">ç®€å•å·¥åŽ‚</h2><img src="http://www.plantuml.com/plantuml/svg/TOun2i9044NxFSMKMcGFe68ZM0i1-yrcD8i92PCLZ1fGEq4yWQsD5z03cPp3JJP2X5ZjylwRcHye7m6ZH6SGOUGXiQ0YKf4CaSbGf2dCr7OhN1qJmeu1k2fAGgpXL4Y3CrZOruGn-KXrrkl3xXjmIIWqDdm8d7F8MTxixrXOtVcPCRBmKaqcjtrg9I5C1A690JoniX-vrXR4ctgkLTyPTnmRG7avbhVp-tLulnx5yrvSJwoZ4-TZc0I8gSN_b3akbwfHMZgCzevZgxEMqi8V"><ul><li><p><strong>é—®</strong>ï¼šè¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¼¼ä¹Žåªæ˜¯æŠŠé—®é¢˜æ¬åˆ°å¦ä¸€ä¸ªå¯¹è±¡ç½¢äº†ï¼Œé—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚</p><p><strong>ç­”</strong>ï¼šSimplePizzaFactory å¯ä»¥æœ‰è®¸å¤šçš„å®¢æˆ·ã€‚è™½ç„¶ç›®å‰åªçœ‹åˆ° <code>orderPizza()</code> æ–¹æ³•æ˜¯å®ƒçš„å®¢æˆ·ã€‚æˆ‘ä»¬ä¹Ÿæ­£æŠŠå…·ä½“å®žä¾‹åŒ–çš„è¿‡ç¨‹ï¼Œä»Žå®¢æˆ·çš„ä»£ç ä¸­åˆ é™¤ã€‚å½“ä»¥åŽå®žçŽ°æ”¹å˜æ—¶ï¼Œåªéœ€ä¿®æ”¹è¿™ä¸ªå·¥åŽ‚ç±»å³å¯ã€‚</p></li><li><p><strong>é—®</strong>ï¼šæˆ‘æ›¾çœ‹è¿‡ä¸€ä¸ªç±»ä¼¼çš„è®¾è®¡æ–¹å¼ï¼ŒæŠŠå·¥åŽ‚å®šä¹‰æˆä¸€ä¸ªé™æ€çš„æ–¹æ³•ï¼Œè¿™æœ‰ä½•å·®åˆ«ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šåˆ©ç”¨é™æ€æ–¹æ³•å®šä¹‰ä¸€ä¸ªç®€å•çš„å·¥åŽ‚ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„æŠ€å·§ï¼Œå¸¸è¢«ç§°ä¸ºé™æ€å·¥åŽ‚ã€‚ä½†è¯·è®°ä½ï¼Œè¿™ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œä¸èƒ½é€šè¿‡ç»§æ‰¿æ¥æ”¹å˜åˆ›å»ºæ–¹æ³•çš„è¡Œä¸ºã€‚</p></li></ul><p><strong>ç®€å•å·¥åŽ‚å…¶å®žä¸æ˜¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œåè€Œæ¯”è¾ƒåƒæ˜¯ä¸€ç§ç¼–ç¨‹ä¹ æƒ¯ã€‚</strong>æœ‰äº›å¼€å‘äººå‘˜çš„ç¡®æ˜¯æŠŠè¿™ä¸ªç¼–ç¨‹ä¹ æƒ¯è¯¯è®¤ä¸ºæ˜¯â€œå·¥åŽ‚æ¨¡å¼â€ï¼ˆFactory Patternï¼‰ã€‚</p><h1 id="åŠ ç›Ÿæ¯”è¨åº—">åŠ ç›Ÿæ¯”è¨åº—</h1><p>èº«ä¸ºåŠ ç›Ÿå…¬å¸ç»è¥è€…ï¼Œä½ å¸Œæœ›ç¡®ä¿åŠ ç›Ÿåº—è¥è¿çš„è´¨é‡ï¼Œæ‰€ä»¥å¸Œæœ›è¿™äº›åº—éƒ½æ˜¯ç”¨ä½ é‚£äº›ç»è¿‡æ—¶é—´è€ƒéªŒçš„ä»£ç ï¼ˆPizzaStoreï¼‰ã€‚</p><p>ä½†æ˜¯åŒºåŸŸçš„å·®å¼‚å‘¢ï¼Ÿæ¯å®¶åŠ ç›Ÿåº—éƒ½å¯èƒ½æƒ³è¦æä¾›ä¸åŒé£Žå‘³çš„æ¯”è¨ï¼ˆæ¯”å¦‚è¯´çº½çº¦ã€èŠåŠ å“¥ã€åŠ å·žï¼‰ï¼Œè¿™å—åˆ°äº†å¼€åº—åœ°ç‚¹åŠè¯¥åœ°åŒºæ¯”è¨ç¾Žé£Ÿå®¶å£å‘³çš„å½±å“ã€‚</p><h2 id="å¤šä¸ªç®€å•å·¥åŽ‚">å¤šä¸ªç®€å•å·¥åŽ‚</h2><p>å¦‚æžœåˆ©ç”¨ SimplePizzaFactoryï¼Œå†™å‡ºä¸‰ç§ä¸åŒçš„å·¥åŽ‚ï¼Œåˆ†åˆ«æ˜¯ NYPizzaFactoryã€ChicagoPizzaFactoryã€CaliforniaPizzaFactoryï¼Œé‚£ä¹ˆå„åœ°åŠ ç›Ÿåº—éƒ½æœ‰åˆé€‚çš„å·¥åŽ‚å¯ä»¥ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ç§åšæ³•ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/ZPBDRi8m48JlVeezqWD-0IGkI1nH9KuSDsPfBEmwshXIWVBkzK_2J-88JebclXdlEgdrde1iuqzWoLR4eewAqgmC2MMmRU5Jdy-uzOu9BW9WgsrZA8bhL44-mI4_W-buJvoysGTSUaCg9lJKwGkGKi9LNBl-pUwfB9xnnD_0LQqLVhbtQJJwuFXRuyi0LgtduETL4z8mDSWKR80AZ_b5_VWikD-KUxYP-NmvM6Je5gOV8SMHnMQtgedQF700_vPvq6WOj2EvEsaYrBl5v6s0gV0TAEK7drBAU2aFLHD0NoLANpWouurUelVEyd-GsDAwRmRw_dy0"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">NYPizzaFactory nyFactory = <span class="keyword">new</span> NYPizzaFactory();  <span class="comment">// åˆ›å»ºä¸€ä¸ªå·¥åŽ‚</span></span><br><span class="line">PizzaStore nyStore = <span class="keyword">new</span> PizzaStore(nyFactory);   <span class="comment">// å»ºç«‹ä¸€ä¸ªæ¯”è¨åº—ï¼Œå°†çº½çº¦å·¥åŽ‚çš„å¼•ç”¨ä½œä¸ºå‚æ•°</span></span><br><span class="line">nyStore.orderPizza(<span class="string">"Cheese"</span>);  <span class="comment">// åˆ¶é€ çº½çº¦é£Žå‘³çš„æ¯”è¨</span></span><br></pre></td></tr></table></figure><h2 id="æ›´å…·å¼¹æ€§çš„è®¾è®¡">æ›´å…·å¼¹æ€§çš„è®¾è®¡</h2><p>åœ¨æŽ¨å¹¿ SimpleFactory æ—¶ï¼Œä½ å‘çŽ°åŠ ç›Ÿåº—çš„ç¡®æ˜¯é‡‡ç”¨ä½ çš„å·¥åŽ‚åˆ›å»ºæ¯”è¨ï¼Œä½†æ˜¯å…¶ä»–éƒ¨åˆ†ï¼Œå´å¼€å§‹é‡‡ç”¨ä»–ä»¬è‡ªåˆ›çš„æµç¨‹ï¼šçƒ˜çƒ¤çš„åšæ³•æœ‰äº›å·®å¼‚ã€ä¸è¦åˆ‡ç‰‡ã€ä½¿ç”¨å…¶ä»–åŽ‚å•†çš„ç›’å­ã€‚ä½ å¸Œæœ›èƒ½å¤Ÿç»™å»ºç«‹ä¸€ä¸ªæ¡†æž¶ï¼ŒæŠŠåŠ ç›Ÿåº—å’Œåˆ›å»ºæ¯”è¨æ†ç»‘åœ¨ä¸€èµ·çš„åŒæ—¶åˆä¿æŒä¸€å®šçš„å¼¹æ€§ã€‚</p><p>æˆ‘ä»¬å…ˆè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šè®©ä½ çš„åŠ ç›Ÿåº—å¯ä»¥é‡‡ç”¨å„è‡ªçš„æµç¨‹ã€‚å¾ˆç®€å•ï¼Œæå–å‡ºä¸€ä¸ªæŠ½è±¡æ¯”è¨åº—å³å¯ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA0HaLbKb1fVa5wKgL7CfA0HdvXRaf885tO3I-KML2caG6YYPNvIIMWIMqz1Kg5RGrrTuldBNiwsDprTqF-kOzdBtZ1Vhba2u2hLSjLp9EOd5nGf-aS4bbL0ZoRRdQUls9tidOvZjd96Pd9YUJpiB_29HJ00Pd5oKcbYI2jMCxXA2gb737Qoae2Yr8B4e5IYje92Kc0rX99UMG0JoAy3wa7ndKwEhYncg62gmXmqNPdJewjgX-PCBHxY2L6BnAD1CvupKr6A8Kg2g6Zk8zq0IEOcv6C9GCt1eWibYquaM7tfw8ASZcOD30SmeBcpH15A3wIA2Ic5c0W00"><p>æˆ‘ä»¬å‘çŽ°åŠ ç›Ÿåº—å’Œå·¥åŽ‚æ€»æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä½¿ç”¨ç»„åˆä»¤æ•´ä¸ªç³»ç»Ÿæœ‰äº›è¿‡äºŽå¤æ‚äº†ã€‚</p><p>çŽ°åœ¨è§£å†³æˆ‘ä»¬çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼šæŠŠåŠ ç›Ÿåº—å’Œåˆ›å»ºæ¯”è¨æ†â€œç»‘â€åœ¨ä¸€èµ·ã€‚åšæ³•æ˜¯åœ¨æ¯”è¨åº—ä¸­ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•ä»£æ›¿åŽŸæ¥çš„å·¥åŽ‚å¯¹è±¡ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA0HaLbKb1fVa5wKgL7CfAEGNfQGMWSKqD87SQfYwMeNaejJ4abIeb4ArWhw-mhEklIysBdm-g-NfzgLF-vgUJTlvRFDKXLgWleAYr8B4ebIm6Kc9sH16Sca9H22_0aZNSYNd91ONA_X51fTKvgJYTmSMov-sRd-oTp8soy7sG1Lrj3_hc02KUxft4L0EPgTpHcPoOde-jIs6-1IYoj3KuEckPS-RPpnlNc9ayBIZxUMa-M0Ne8Oys4wYGWl9dJOrkhgOuOQX0hilkVmYdJDIKuiXGWgwkZLs4AU0978ISp64eSRWq0IJnQOJCshrzEmKKEp7hGPc81UEo08fmtGQCQfX9WC0"><p>NYStylePizzaStore çš„å·¥åŽ‚æ–¹æ³•åº”è¯¥åƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza;</span><br><span class="line">    <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> NYCheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"clam"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> NYClamPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰å·¥åŽ‚æ–¹æ³•">å®šä¹‰å·¥åŽ‚æ–¹æ³•</h2><p>å·¥åŽ‚æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŽ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®žä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥åŽ‚æ–¹æ³•è®©ç±»æŠŠå®žä¾‹åŒ–æŽ¨è¿Ÿåˆ°å­ç±»ã€‚</p><p><strong>æ‰€è°“çš„â€œå†³å®šâ€ï¼Œå¹¶ä¸æ˜¯æŒ‡æ¨¡å¼å…è®¸å­ç±»æœ¬èº«åœ¨è¿è¡Œæ—¶åšå†³å®šï¼ˆå·¥åŽ‚å­ç±»èƒ½ç”Ÿäº§çš„äº§å“åœ¨ç¼–å†™æ—¶å°±å·²ç»å›ºå®šäº†ï¼‰</strong>ï¼Œè€Œæ˜¯æŒ‡åœ¨ç¼–å†™åˆ›å»ºè€… Creator ç±»æ—¶ï¼Œä¸éœ€è¦çŸ¥é“å®žé™…åˆ›å»ºçš„äº§å“æ˜¯å“ªä¸€ä¸ªã€‚é€‰æ‹©äº†ä½¿ç”¨å“ªä¸ªå­ç±»ï¼Œè‡ªç„¶å°±å†³å®šäº†å®žé™…åˆ›å»ºçš„äº§å“æ˜¯ä»€ä¹ˆã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VL9DIm916BxlhnWyrQ6WQtHfEqVz02_hEgAWip9EXx1Waom3jS2IoZAZfF2WIHzkg-AFQTzPFVKNcdLNApCl0_EypzSxJ3WIn0Z7ucmRnN0iWAaKTX0rGjKebfH0Wb55PMYJQi4jbNq3QnGhJACeAI6K7A6xA2HEZMwlOnRMWdFpOgYGZJYc2ejeHDnt9JMg919eJICgnGnxDgj3dqdnFsJv7xBN4QtiB2oCDHwuAeqA_vgEugL9EbgPGfeL8CyCa2S3v2a1iaGqXb4KXnZIGgCdNqQM-G25FUYb1xTjg9Vj_5E_Ts4PDKWtuIJByrKullliPFr4mBpIiWoTNrS5O7LxzkcZmpLBheTzkUydThCDJqquRbZjAdJEF8fH-scaPoqZnyyRa6vPtO9GVEYft-sypil8RMIP1_n8vrT7l92ppLS_6GVouZj_FXlMEH2maNC5qAf2FkKEn-Q-lpD7A7hMouEBD6JU1de53atNNCZynDsZ_tBJVxc3J0dQfjZVsIPJXFlBuIivAumLFgGa45cI_dp0nSKfiEp2Nm00"><ul><li><p><strong>é—®</strong>ï¼šå½“åªæœ‰ä¸€ä¸ª ConcreteCreator çš„æ—¶å€™ï¼Œå·¥åŽ‚æ–¹æ³•æ¨¡å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šå°½ç®¡åªæœ‰ä¸€ä¸ªå…·ä½“åˆ›å»ºè€…ï¼Œå·¥åŽ‚æ–¹æ³•æ¨¡å¼ä¾ç„¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒ<strong>å¸®åŠ©æˆ‘ä»¬å°†äº§å“çš„â€œå®žçŽ°â€ä»Žâ€œä½¿ç”¨â€ä¸­è§£è€¦</strong>ã€‚å¦‚æžœå¢žåŠ äº§å“æˆ–è€…æ”¹å˜äº§å“çš„å®žçŽ°ï¼ŒCreator å¹¶ä¸ä¼šå—åˆ°å½±å“ï¼ˆå› ä¸º Creator ä¸Žä»»ä½• ConcreteCreator ä¹‹é—´éƒ½ä¸æ˜¯ç´§è€¦åˆï¼‰ã€‚</p></li><li><p><strong>é—®</strong>ï¼šå¦‚æžœè¯´çº½çº¦å’ŒèŠåŠ å“¥çš„å•†åº—æ˜¯åˆ©ç”¨ç®€å•å·¥åŽ‚åˆ›å»ºçš„ï¼Œè¿™æ ·çš„è¯´æ³•æ˜¯å¦æ­£ç¡®ï¼Ÿçœ‹èµ·æ¥å€’æ˜¯å¾ˆåƒã€‚</p><p><strong>ç­”</strong>ï¼šä»–ä»¬å¾ˆç±»ä¼¼ï¼Œä½†ç”¨æ³•ä¸åŒã€‚<strong>åœ¨å·¥åŽ‚æ–¹æ³•ä¸­ï¼Œå·¥åŽ‚æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•ï¼Œç”±æ¯ä¸ªå­ç±»è‡ªè¡Œè´Ÿè´£æ–¹æ³•çš„è¡Œä¸ºã€‚åœ¨ç®€å•å·¥åŽ‚ä¸­ï¼Œå·¥åŽ‚æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ã€‚</strong></p></li></ul><h1 id="ä¸€ä¸ªå¾ˆä¾èµ–çš„æ¯”è¨åº—">ä¸€ä¸ªå¾ˆä¾èµ–çš„æ¯”è¨åº—</h1><p>å‡è®¾ä½ ä»Žæœªå¬è¿‡ OO å·¥åŽ‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¸ä½¿ç”¨å·¥åŽ‚æ¨¡å¼çš„æ¯”è¨åº—ç‰ˆæœ¬ã€‚æ•°ä¸€æ•°ï¼Œè¿™ä¸ªç±»æ‰€ä»¥æ¥çš„å…·ä½“æ¯”è¨å¯¹è±¡æœ‰å‡ ç§ã€‚å¦‚æžœåˆåŠ äº†ä¸€ç§åŠ å·žé£Žå‘³æ¯”è¨åˆ°è¿™ä¸ªæ¯”è¨åº—ä¸­ï¼Œé‚£ä¹ˆå±Šæ—¶åˆä¼šä¾èµ–å‡ ä¸ªå¯¹è±¡ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependentPizzaStore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String style, String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (style.equals(<span class="string">"NY"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> NYCheesePizza();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"veggie"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> NYVeggiePizza();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (style.equals(<span class="string">"Chicago"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> ChicagoCheesePizza();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"veggie"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> ChicagoVeggiePizza();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Error: invalid type of pizza"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½ ç›´æŽ¥å®žä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°±æ˜¯åœ¨ä¾èµ–å®ƒçš„å…·ä½“ç±»ã€‚å¦‚æžœæŠŠè¿™ä¸ªç‰ˆæœ¬çš„æ¯”è¨åº—å’Œå®ƒä¾èµ–çš„å¯¹è±¡ç”»æˆä¸€å¼ å›¾ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONAmHaLbKbSkNbbwGg56McPvHOAJpPD_V5rcbFTlKzwsnuDgVp-QoMP-kdl9YmukdwdIysBdo_foScx-di1Kzsx7gwhldvx2tF-fO-xPZzTFUk5_jdFjar6rdjuuOcBh3v2dfwTWf-aSuPgQd5gH0RaSN3KjFJCp74dJCoanFJyx5hWaeYwGG0"><h2 id="ä¾èµ–å€’ç½®åŽŸåˆ™">ä¾èµ–å€’ç½®åŽŸåˆ™</h2><blockquote><p>è¦ä¾èµ–æŠ½è±¡ï¼Œä¸è¦ä¾èµ–å…·ä½“ç±»ã€‚</p></blockquote><p>é¦–å…ˆï¼Œè¿™ä¸ªåŽŸåˆ™å¬èµ·æ¥å¾ˆåƒæ˜¯â€œé’ˆå¯¹æŽ¥å£ç¼–ç¨‹ï¼Œä¸é’ˆå¯¹å®žçŽ°ç¼–ç¨‹â€ï¼Œä¸æ˜¯å—ï¼Ÿçš„ç¡®å¾ˆç›¸ä¼¼ï¼Œç„¶è€Œ<strong>è¿™é‡Œæ›´å¼ºè°ƒâ€œæŠ½è±¡â€ã€‚</strong>è¿™ä¸ªåŽŸåˆ™è¯´æ˜Žäº†ï¼šä¸èƒ½è®©é«˜å±‚ç»„ä»¶ä¾èµ–ä½Žå±‚ç»„ä»¶ï¼Œè€Œä¸”ï¼Œä¸ç®¡é«˜å±‚æˆ–ä½Žå±‚ç»„ä»¶ï¼Œâ€œä¸¤è€…â€éƒ½åº”è¯¥ä¾èµ–äºŽæŠ½è±¡ã€‚</p><p>PizzaStore æ˜¯â€œé«˜å±‚ç»„ä»¶â€ï¼Œè€Œæ¯”è¨å®žçŽ°æ˜¯â€œä½Žå±‚ç»„ä»¶â€ã€‚éžå¸¸ä¾èµ–æ¯”è¨åº—çš„ä¸»è¦é—®é¢˜åœ¨äºŽï¼šå®ƒä¾èµ–æ¯ä¸ªæ¯”è¨ç±»åž‹ã€‚å› ä¸ºå®ƒæ˜¯åœ¨è‡ªå·±çš„ <code>orderPizza()</code> æ–¹æ³•ä¸­ï¼Œå®žä¾‹åŒ–è¿™äº›å…·ä½“ç±»åž‹çš„ã€‚</p><p>è™½ç„¶æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯ Pizzaï¼Œä½†æˆ‘ä»¬ä»ç„¶åœ¨ä»£ç ä¸­ï¼Œå®žé™…åœ°åˆ›å»ºäº†å…·ä½“çš„ Pizzaï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæŠ½è±¡æ²¡ä»€ä¹ˆå½±å“åŠ›ã€‚</p><p>å¦‚ä½•åœ¨ <code>orderPizza()</code> æ–¹æ³•ä¸­ï¼Œå°†è¿™äº›å®žä¾‹åŒ–å¯¹è±¡çš„ä»£ç ç‹¬ç«‹å‡ºæ¥ï¼Ÿå·¥åŽ‚æ–¹æ³•åˆšå¥½èƒ½æ´¾ä¸Šç”¨åœºã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA0HaLbKb1fVa5wLovUMNf2eKPQPdb5WfFDatzyNMQKzsD3pPiUfPrzuN6nS-txWRJHSNGg-2dfuTig22JOskhe9Vf7D6QcfnAZQ9dCHS367dZCpanFHy79fWiZ2T0000"><p>åœ¨åº”ç”¨å·¥åŽ‚æ–¹æ³•ä¹‹åŽï¼Œé«˜å±‚ç»„ä»¶ï¼ˆPizzaStoreï¼‰å’Œä½Žå±‚ç»„ä»¶ï¼ˆä¹Ÿå°±æ˜¯è¿™äº›æ¯”è¨ï¼‰éƒ½ä¾èµ–äº† Pizza æŠ½è±¡ã€‚æƒ³è¦éµå¾ªä¾èµ–å€’ç½®åŽŸåˆ™ï¼Œå·¥åŽ‚æ–¹æ³•å¹¶éžæ˜¯å”¯ä¸€çš„æŠ€å·§ï¼Œä½†å´æ˜¯æœ€æœ‰å¨åŠ›çš„æŠ€å·§ä¹‹ä¸€ã€‚</p><h2 id="æŒ‡å¯¼æ–¹é’ˆ">æŒ‡å¯¼æ–¹é’ˆ</h2><p>ä¸‹é¢çš„æŒ‡å¯¼æ–¹é’ˆï¼Œèƒ½å¸®ä½ é¿å…åœ¨ OO è®¾è®¡ä¸­è¿åä¾èµ–å€’ç½®åŽŸåˆ™ï¼š</p><ul><li>å˜é‡ä¸å¯ä»¥æŒæœ‰å…·ä½“ç±»çš„å¼•ç”¨ã€‚å¦‚æžœä½¿ç”¨ newï¼Œå°±ä¼šæŒæœ‰å…·ä½“ç±»çš„å¼•ç”¨ã€‚ä½ å¯ä»¥æ”¹ç”¨å·¥åŽ‚æ–¹æ³•æ¥é¿å¼€è¿™æ ·çš„åšæ³•ã€‚</li><li>ä¸è¦è®©ç±»æ´¾ç”Ÿè‡ªå…·ä½“ç±»ã€‚å¦‚æžœæ´¾ç”Ÿè‡ªå…·ä½“ç±»ï¼Œä½ å°±ä¼šä¾èµ–å…·ä½“ç±»ã€‚è¯·æ´¾ç”Ÿè‡ªä¸€ä¸ªæŠ½è±¡ï¼ˆæŽ¥å£æˆ–æŠ½è±¡ç±»ï¼‰ã€‚</li><li>ä¸è¦è¦†ç›–åŸºç±»ä¸­å·²å®žçŽ°çš„æ–¹æ³•ã€‚å¦‚æžœè¦†ç›–åŸºç±»å·²å®žçŽ°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä½ çš„åŸºç±»å°±ä¸æ˜¯ä¸€ä¸ªçœŸæ­£é€‚åˆè¢«ç»§æ‰¿çš„æŠ½è±¡ã€‚åŸºç±»ä¸­å·²å®žçŽ°çš„æ–¹æ³•ï¼Œåº”è¯¥ç”±æ‰€æœ‰çš„å­ç±»å…±äº«ã€‚</li></ul><p>è¦å®Œå…¨éµå®ˆè¿™äº›æŒ‡å¯¼æ–¹é’ˆä¸å¤ªå¯èƒ½ï¼Œæ­£å¦‚åŒæˆ‘ä»¬çš„è®¸å¤šåŽŸåˆ™ä¸€æ ·ï¼Œåº”è¯¥å°½é‡è¾¾åˆ°è¿™ä¸ªåŽŸåˆ™ï¼Œè€Œä¸æ˜¯éšæ—¶éƒ½è¦éµå¾ªè¿™ä¸ªåŽŸåˆ™ã€‚</p><p>å¦‚æžœä½ æ·±å…¥ä½“éªŒè¿™äº›æ–¹é’ˆï¼Œå°†è¿™äº›æ–¹é’ˆåŒ–æˆä½ æ€è€ƒçš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆåœ¨è®¾è®¡æ—¶ï¼Œä½ å°†çŸ¥é“ä½•æ—¶æœ‰è¶³å¤Ÿçš„ç†ç”±è¿åè¿™æ ·çš„åŽŸåˆ™ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æžœæœ‰ä¸€ä¸ªä¸åƒæ˜¯ä¼šæ”¹å˜çš„ç±»ï¼Œé‚£ä¹ˆåœ¨ä»£ç ä¸­ç›´æŽ¥å®žä¾‹åŒ–å…·ä½“ç±»ä¹Ÿå°±æ²¡ä»€ä¹ˆå¤§ç¢ã€‚æƒ³æƒ³çœ‹ï¼Œæˆ‘ä»¬å¹³å¸¸è¿˜ä¸æ˜¯åœ¨ç¨‹åºä¸­ä¸å‡æ€ç´¢åœ°å°±å®žä¾‹åŒ–å­—ç¬¦ä¸²å¯¹è±¡å—ï¼Ÿå°±æ²¡æœ‰è¿åè¿™ä¸ªåŽŸåˆ™ï¼Ÿå½“ç„¶æœ‰ï¼å¯ä»¥è¿™ä¹ˆåšå—ï¼Ÿå¯ä»¥ï¼ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå­—ç¬¦ä¸²ä¸å¯èƒ½æ”¹å˜ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æžœæœ‰ä¸ªç±»å¯èƒ½æ”¹å˜ï¼Œä½ å¯ä»¥é‡‡ç”¨ä¸€äº›å¥½æŠ€å·§ï¼ˆä¾‹å¦‚å·¥åŽ‚æ–¹æ³•ï¼‰æ¥å°è£…æ”¹å˜ã€‚</p><h1 id="ç¡®ä¿åŽŸæ–™çš„ä¸€è‡´">ç¡®ä¿åŽŸæ–™çš„ä¸€è‡´</h1><p>æ¯”è¨åº—æˆåŠŸçš„å…³é”®åœ¨äºŽæ–°é²œã€é«˜è´¨é‡çš„åŽŸæ–™ï¼Œè€Œä¸”é€šè¿‡å¯¼å…¥æ–°çš„æ¡†æž¶ï¼ŒåŠ ç›Ÿåº—å°†éµå¾ªä½ çš„æµç¨‹ï¼Œä½†æ˜¯æœ‰ä¸€äº›åŠ ç›Ÿåº—ï¼Œä½¿ç”¨ä½Žä»·åŽŸæ–™æ¥å¢žåŠ åˆ©æ¶¦ã€‚ä½ å¿…é¡»é‡‡å–ä¸€äº›æ‰‹æ®µï¼Œä»¥å…é•¿æ­¤ä»¥å¾€æ¯æŽ‰äº†æ¯”è¨åº—çš„å“ç‰Œã€‚</p><p>ä½ æ‰“ç®—å»ºé€ ä¸€å®¶ç”Ÿäº§åŽŸæ–™çš„å·¥åŽ‚ï¼Œå¹¶å°†åŽŸæ–™è¿é€åˆ°å„å®¶åŠ ç›Ÿåº—ã€‚å¯¹äºŽè¿™ä¸ªåšæ³•ï¼ŒçŽ°åœ¨è¿˜å‰©ä¸‹äº†ä¸€ä¸ªé—®é¢˜ï¼šåŠ ç›Ÿåº—åè½åœ¨ä¸åŒçš„åŒºåŸŸï¼Œçº½çº¦çš„çº¢é…±æ–™å’ŒèŠåŠ å“¥çš„çº¢é…±æ–™æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><h2 id="åŽŸæ–™å®¶æ—">åŽŸæ–™å®¶æ—</h2><p>çº½çº¦ä½¿ç”¨ä¸€ç»„åŽŸæ–™ï¼Œè€ŒèŠåŠ å“¥ä½¿ç”¨å¦ä¸€ç»„åŽŸæ–™ã€‚å¯èƒ½ä¸ä¹…ä¹‹åŽåŠ å·žå°±æœ‰åŠ ç›Ÿåº—äº†ï¼Œåˆ°æ—¶å€™åˆéœ€è¦è¿é€å¦ä¸€ç»„åŒºåŸŸçš„åŽŸæ–™ã€‚æƒ³è¦è¡Œå¾—é€šï¼Œå¿…é¡»å…ˆæ¸…æ¥šå¦‚ä½•å¤„ç†åŽŸæ–™å®¶æ—ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/RP8zJWCn48NxFSLSm3T0D45qaH2aGnGJPxIsuf_8zXOiuG9fgP5eu12HE4uKZW74krcFeTmte_dUUrwbLmHaD-aHBDabXKRzAb87QQZ1PKm1POAPGHkdppliP36zybshYcL55AdPe5nZIt3SVnxt7_3K04Y3CS9reAZonL6QOz0E0-R3exfGsir25rC6ZF8jjQr6vmVEyvdqjNizxDuEB-yCvdjod7PZEhlm5fF_mvFhVu1pt_SOo1Wy8qy7uM8hH1c7gHFtHCao3reCQa-L5n1YUpaKpMif9xoPF1airndOS8e0ulxd1rYHUn1r_SnwkLUzHv6ykiRAhGANgxNNRm00"><h2 id="å»ºé€ åŽŸæ–™å·¥åŽ‚">å»ºé€ åŽŸæ–™å·¥åŽ‚</h2><p>æˆ‘ä»¬è¦å»ºé€ ä¸€ä¸ªå·¥åŽ‚æ¥ç”Ÿäº§åŽŸæ–™ï¼Œè¿™ä¸ªå·¥åŽ‚å°†è´Ÿè´£åˆ›å»ºåŽŸæ¥å®¶æ—ä¸­çš„æ¯ä¸€ç§åŽŸæ–™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå·¥åŽ‚å°†éœ€è¦ç”Ÿäº§é¢å›¢ã€é…±æ–™ã€èŠå£«ç­‰ã€‚å¼€å§‹å…ˆä¸ºå·¥åŽ‚å®šä¹‰ä¸€ä¸ªæŽ¥å£ï¼Œè¿™ä¸ªæŽ¥å£è´Ÿè´£åˆ›å»ºæ‰€æœ‰çš„åŽŸæ–™ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dough <span class="title">createDough</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cheese <span class="title">createCheese</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Clams <span class="title">createClam</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> Veggies[] createVeggies();    <span class="comment">// è¿™é‡Œè¿˜æœ‰æ–°çš„åŽŸæ–™</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pepperoni <span class="title">createPepperoni</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŽ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…æ˜¯ï¼š</p><ol type="1"><li>ä¸ºæ¯ä¸ªåŒºåŸŸå»ºé€ ä¸€ä¸ªå·¥åŽ‚ã€‚ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª PizzaIngredientFactory çš„å­ç±»æ¥å®žçŽ°æ¯ä¸€ä¸ªåˆ›å»ºæ–¹æ³•ã€‚</li><li>å®žçŽ°ä¸€ç»„åŽŸæ–™ç±»åŠŸå·¥åŽ‚ä½¿ç”¨ã€‚è¿™äº›ç±»å¯ä»¥åœ¨åˆé€‚çš„åŒºåŸŸé—´å…±äº«ã€‚</li><li>ç„¶åŽä½ ä»ç„¶éœ€è¦å°†è¿™ä¸€åˆ‡ç»„ç»‡èµ·æ¥ï¼Œå°†æ–°çš„åŽŸæ–™å·¥åŽ‚æ•´åˆè¿›æ—§çš„ PizzaStore ä»£ç ä¸­ã€‚</li></ol><img src="http://www.plantuml.com/plantuml/svg/dLHDJnf16BxFhtYFzS3-04gvs3JfeOs9NfhQmxWCx4PsrWn36WKIDRL4WZHDQHE_earL6c-c1-YgvSUuimkd_eKEiw2movAsfytCyxpF-xmViuQP8K2iDRuE5h5M24F6u4OtcPud2AyKECCwXqLSrCUEJ-rYpa0cvOHbiKvWmTpOmCzfZf6CIIX_9ZasMuTKwfwIJaC90PH64XNG6S6SAAL7SzCWbLD25QJdSQ40Br-fD94i0zsms7I5USFKSSx-Vvc7ViWGea9YIiy6tsbrgOWn-M4wA8s2j8dxnr09EubGX_S3QgXRVsiKdW0bR-DwBANlFOpiLr3Sr1D1UvBWrRUyertHFXUDRV_WdRZvx3U_8rKNf3Gje25bVloiBAVAYOaQq0lCJ8eP3kY9H3aztCg5VD5QiYtCxGYq90U-Ei-A1HuaLL2ml1AYqv6uiihIOKn_ak1VjxpThbUxxLrz3GgUgJDh4r7SecjQ6YPjpwHED4mwR9wuJiljRFhEhUzSzByrnCSVed7YVTb7Cn_6G2lKuv5QhtOiQgVYq_c_gON64ftWQ_aJoX3w9agbDYV0p9p1mSw6qIIu7QU_rHKxU-BmbpYxx7MhNhlj_hpwVLDVfhtkVhzQ5nyk_UQrg3gkyzxjdFcjlS3stURs7m00"><h2 id="å®šä¹‰æŠ½è±¡å·¥åŽ‚">å®šä¹‰æŠ½è±¡å·¥åŽ‚</h2><p>æŠ½è±¡å·¥åŽ‚æ¨¡å¼æä¾›ä¸€ä¸ªæŽ¥å£ï¼Œç”¨äºŽåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„<strong>å®¶æ—</strong>ï¼Œè€Œä¸éœ€è¦æ˜Žç¡®æŒ‡å®šå…·ä½“ç±»ã€‚</p><p>æŠ½è±¡å·¥åŽ‚å…è®¸å®¢æˆ·ä½¿ç”¨æŠ½è±¡çš„æŽ¥å£æ¥åˆ›å»ºä¸€ç»„ç›¸å…³çš„äº§å“ï¼Œè€Œä¸éœ€è¦çŸ¥é“å®žé™…äº§å‡ºçš„å…·ä½“äº§å“æ˜¯ä»€ä¹ˆã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·å°±ä»Žå…·ä½“çš„äº§å“ä¸­è¢«è§£è€¦ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/bLDDI-j05DtFhnXSwQ92iXGfD89hzzP5JASsq4ua7HUYGjGML4gLPnKjxob-eIX-50NZH-cFiJEfA_-2jpRMT5Bx51hAt7FlkMVkFPCo4mIJp3IRnHcIcIGsIZKZXcaRQOBqoIopTOFXCTjAp1WiXeU7JSg8dTGD4es6S4t2ZRIUpRQBrSwpfaYuTDPKrER2CR_JA7oMFTlP1yyXZES-nInWmoOw8v-q_GCzK0tG1R_lY4K1OyJleNpGTk7wAO7w2uBs94VI9g7ierA-SxBr3zcXQKJykY7Chmx5odszMlDAPtNNgRld_Fw45vUGJno9HDi3xXABeQzLpmyE1dRNFQwWhzK7ufhwJLm9Qs_2ykX_bAMYqCQ2jrDwmh4Gh7R0QazOwzRRDgTIR1pUJuBGYSX_rQgXYl0ElidG4BKOmMcIPDXAoaOPmcBL4NzNlNAEvy4Acoq7nEdhSfNNygy7J_ngpolUYCjZKJo9Kxv-zFPSQDHsmImGW2Clv26ySG46yfvoOlj1t6w1dyG_oFPA-_N7K_ZnpSKNPwbJYJmKa7AztlHWG0UeYDC6I3dUzxbSHspTGICWB-SavZwnLcrK3lnIfynT5vJmbPjMfAKDikLdnlyKv6ScTgw3HN1dhrJXbnjUnHy8qFHXFOkfWgY2mN3IODy1"><h2 id="å·¥åŽ‚æ–¹æ³•æ½œä¼åœ¨æŠ½è±¡å·¥åŽ‚é‡Œé¢">å·¥åŽ‚æ–¹æ³•æ½œä¼åœ¨æŠ½è±¡å·¥åŽ‚é‡Œé¢</h2><p>æ˜¯çš„ï¼ŒæŠ½è±¡å·¥åŽ‚çš„æ–¹æ³•ç»å¸¸ä»¥å·¥åŽ‚æ–¹æ³•çš„æ–¹å¼å®žçŽ°ã€‚æŠ½è±¡å·¥åŽ‚çš„ä»»åŠ¡æ˜¯å®šä¹‰ä¸€ä¸ªè´Ÿè´£<strong>åˆ›å»ºä¸€ç»„äº§å“çš„æŽ¥å£</strong>ï¼ˆcreateProductAã€createProductBï¼‰ã€‚è¿™ä¸ªæŽ¥å£å†…çš„<strong>æ¯ä¸ªæ–¹æ³•</strong>éƒ½è´Ÿè´£åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ï¼ŒåŒæ—¶æˆ‘ä»¬åˆ©ç”¨æŠ½è±¡å·¥åŽ‚çš„å­ç±»æ¥æä¾›è¿™äº›å…·ä½“çš„åšæ³•ã€‚æ‰€ä»¥ï¼Œåœ¨æŠ½è±¡å·¥åŽ‚ä¸­åˆ©ç”¨å·¥åŽ‚æ–¹æ³•å®žçŽ°ç”Ÿäº§æ–¹æ³•æ˜¯ç›¸å½“è‡ªç„¶çš„åšæ³•ã€‚</p><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>æ‰€æœ‰çš„å·¥åŽ‚éƒ½æ˜¯ç”¨æ¥å°è£…å¯¹è±¡çš„åˆ›å»ºã€‚</li><li>ç®€å•å·¥åŽ‚ï¼Œè™½ç„¶ä¸æ˜¯çœŸæ­£çš„è®¾è®¡æ¨¡å¼ï¼Œä½†ä»ä¸å¤±ä¸ºä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥å°†å®¢æˆ·ç¨‹åºä»Žå…·ä½“ç±»ä¸­è§£è€¦ã€‚</li><li><strong>å·¥åŽ‚æ–¹æ³•ä½¿ç”¨ç»§æ‰¿ï¼šæŠŠå¯¹è±¡çš„åˆ›å»ºå§”æ‰˜ç»™å­ç±»ï¼Œå­ç±»å®žçŽ°å·¥åŽ‚æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚</strong></li><li><strong>æŠ½è±¡å·¥åŽ‚ä½¿ç”¨å¯¹è±¡ç»„åˆï¼šå¯¹è±¡çš„åˆ›å»ºè¢«æ˜¯çŽ°åœ¨å·¥åŽ‚æŽ¥å£æ‰€æš´éœ²å‡ºæ¥çš„æ–¹æ³•ä¸­ã€‚</strong></li><li>å·¥åŽ‚æ–¹æ³•å…è®¸ç±»å°†å®žä¾‹åŒ–å»¶è¿Ÿåˆ°å­ç±»è¿›è¡Œã€‚</li><li>æŠ½è±¡å·¥åŽ‚åˆ›å»ºç›¸å…³çš„å¯¹è±¡å®¶æ—ï¼Œè€Œä¸éœ€è¦ä¾èµ–å®ƒä»¬çš„å…·ä½“ç±»ã€‚</li><li>ä¾èµ–å€’ç½®åŽŸåˆ™ï¼ŒçŸ¥é“æˆ‘ä»¬é¿å…ä¾èµ–å…·ä½“ç±»åž‹ï¼Œè€Œè¦å°½é‡ä¾èµ–æŠ½è±¡ç±»åž‹ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è£…é¥°è€…æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/decorator-pattern/"/>
      <url>/notes/head-first-design-patterns/decorator-pattern/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç« å¯ä»¥æˆä¸º <strong>â€œç»™çˆ±ç”¨ç»§æ‰¿çš„äººä¸€ä¸ªå…¨æ–°çš„è®¾è®¡çœ¼ç•Œâ€ã€‚</strong>æˆ‘ä»¬å³å°†å†åº¦æŽ¢è®¨å…¸åž‹çš„ç»§æ‰¿æ»¥ç”¨é—®é¢˜ã€‚ä½ å°†åœ¨æœ¬ç« å­¦åˆ°å¦‚ä½•ä½¿ç”¨å¯¹è±¡ç»„åˆçš„æ–¹å¼ï¼Œåšåˆ°åœ¨è¿è¡Œæ—¶è£…é¥°ç±»ã€‚ä¸€æ—¦ä½ ç†Ÿæ‚‰äº†è£…é¥°çš„æŠ€å·§ï¼Œä½ å°†èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ä»»ä½•åº•å±‚ä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™ä½ çš„ï¼ˆæˆ–åˆ«äººçš„ï¼‰å¯¹è±¡èµ‹äºˆæ–°çš„èŒè´£ã€‚</p><h1 id="å¯¼å…¥æ˜Ÿå·´å…¹å’–å•¡">å¯¼å…¥ï¼šæ˜Ÿå·´å…¹å’–å•¡</h1><p>æ˜Ÿå·´å…¹ï¼ˆStarbuzzï¼‰æ˜¯ä»¥æ‰©å¼ é€Ÿåº¦æœ€å¿«è€Œé—»åçš„å’–å•¡è¿žé”åº—ã€‚å› ä¸ºæ‰©å¼ é€Ÿåº¦å®žåœ¨å¤ªå¿«äº†ï¼Œä»–ä»¬å‡†å¤‡æ›´æ–°è®¢å•ç³»ç»Ÿï¼Œä»¥åˆä¹Žä»–ä»¬çš„é¥®æ–™ä¾›åº”ç³»ç»Ÿã€‚ä»–ä»¬åŽŸå…ˆçš„ç±»è®¾è®¡æ˜¯è¿™æ ·çš„â€¦â€¦</p><img src="http://www.plantuml.com/plantuml/svg/ROyn2i90403xUyMMMaW-O1KYMFk3osKrmSGBjwSWCM2XXRrQYBNO2uBu6z7a6oPgeeR0DZV3xR2kvo1W4Eef11ZOg9YR4-4fuIFZDcd5XGOJ9wZu025Y00wIK5weFJdANWFKrXSqcXcAYdyn24dwpGBKhdHYC0nuBC_twpRPhzBrCTqjakqbEMrkyqCsB6R2vqJGbMD2qyUHysf-zXJMuchOavnqhKJ1-tMYGw528ldlojlQirRhfriHPRBAyrg55Q4d"><p>è´­ä¹°å’–å•¡æ—¶ï¼Œä¹Ÿå¯ä»¥è¦æ±‚åœ¨å…¶ä¸­åŠ å…¥å„ç§è°ƒæ–™ï¼Œä¾‹å¦‚ï¼šè’¸å¥¶ï¼ˆSteamed Milkï¼‰ã€è±†æµ†ï¼ˆSoyï¼‰ã€æ‘©å¡ï¼ˆMochaï¼Œä¹Ÿå°±æ˜¯å·§å…‹åŠ›é£Žå‘³æˆ–è¦†ç›–å¥¶æ³¡ï¼ˆWhipï¼‰ã€‚æ˜Ÿå·´å…¹ä¼šæ ¹æ®æ‰€åŠ å…¥çš„è°ƒæ–™æ”¶å–ä¸åŒçš„è´¹ç”¨ã€‚æ‰€ä»¥è®¢å•ç³»ç»Ÿå¿…é¡»è€ƒè™‘åˆ°è¿™äº›è°ƒæ–™éƒ¨åˆ†ã€‚</p><p>åˆ©ç”¨å®žä¾‹å˜é‡å’Œç»§æ‰¿ï¼Œè¿½è¸ªè¿™äº›è°ƒæ–™ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/RL5DIyD04BtdLyonHThYiUYfLF3YHG-Ujvkn2KswOMUhb1WGr4EleX75YpTFHH4KwT-fIVqNJbgprk1fvhqt7szsFTz5m30oOmWnxA5sl8AHlfO1Eg97HWjfe8F7g4KV8NO0N2If_SZuQiWez8C11rBZ0YZf2OuddXznwAFf_XRNwan9HQPMXnXQBLXC7_FfRJOvonucY-VpBBtBxo_ci_UlgnT872xs1Etn-6KZeR4vymTgND9bMbGN-ssv1QmSigDI-CaPn24QJxb9uURpycq-IzbAVlt4FhBq8tkzSH971e88TjM8i1FWq5s-mUeCgtQ57kmhGMPDv1ircf4UmcQptOODe564khaIj_X0sunI7FqtTOSYZKJghsR_OlkqqLZpLH6ifIfVRAjmvQ9l"><p>å½“å“ªäº›éœ€æ±‚æˆ–å› ç´ æ”¹å˜æ—¶ä¼šå½±å“è¿™ä¸ªè®¾è®¡ï¼Ÿ</p><ul><li>è°ƒæ–™ä»·é’±çš„æ”¹å˜ä¼šä½¿æˆ‘ä»¬æ›´æ”¹çŽ°æœ‰ä»£ç ã€‚ï¼ˆè¿™ä¸ªæ¯”è¾ƒå¥½è§£å†³ï¼Œå¢žåŠ è®¾ç½®è°ƒæ–™ä»·æ ¼çš„ <code>setter</code> æ–¹æ³•å³å¯ï¼‰</li><li>ä¸€æ—¦å‡ºçŽ°æ–°çš„è°ƒæ–™ï¼Œæˆ‘ä»¬å°±éœ€è¦åŠ ä¸Šæ–°çš„æ–¹æ³•ï¼Œå¹¶æ”¹å˜è¶…ç±»ä¸­çš„ <code>cost()</code> æ–¹æ³•ã€‚ï¼ˆæ— è§£ï¼‰</li><li>ä»¥åŽå¯èƒ½ä¼šå¼€å‘å¤„æ–°é¥®æ–™ï¼Œå¯¹è¿™äº›é¥®æ–™è€Œè¨€ï¼ˆä¾‹å¦‚ï¼Œå†°èŒ¶ï¼‰ï¼ŒæŸäº›è°ƒæ–™å¯èƒ½å¹¶ä¸åˆé€‚ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè®¾è®¡æ–¹å¼ä¸­ï¼ŒTea å­ç±»ä»å°†ç»§æ‰¿å“ªäº›ä¸é€‚åˆçš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<code>hasWhip()</code>ã€‚</li><li>ä¸‡ä¸€é¡¾å®¢æƒ³è¦åŒå€æ‘©å¡å’–å•¡ï¼Œæ€Žä¹ˆåŠžï¼Ÿï¼ˆè¿™ä¸ªä¹Ÿæ¯”è¾ƒå¥½è§£å†³ï¼Œå°† <code>soy</code> çš„ç±»åž‹è®¾ç½®ä¸º <code>int</code>ï¼‰</li></ul><a id="more"></a><h1 id="å¼€æ”¾-å…³é—­åŽŸåˆ™">å¼€æ”¾-å…³é—­åŽŸåˆ™</h1><blockquote><p>ç±»åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p></blockquote><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å…è®¸ç±»å®¹æ˜“æ‰©å±•ï¼Œåœ¨ä¸ä¿®æ”¹çŽ°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå°±å¯æ­é…æ–°çš„è¡Œä¸ºã€‚å¦‚æžœå®žçŽ°è¿™æ ·çš„ç›®æ ‡ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿè¿™æ ·çš„è®¾è®¡å…·æœ‰å¼¹æ€§å¯ä»¥åº”å¯¹æ”¹å˜ï¼Œå¯ä»¥æŽ¥å—æ–°çš„åŠŸèƒ½æ¥åº”å¯¹æ”¹å˜çš„éœ€æ±‚ã€‚</p><p><strong>é—®</strong>ï¼šæˆ‘å¦‚ä½•è®©è®¾è®¡çš„æ¯ä¸ªéƒ¨åˆ†éƒ½éµå¾ªå¼€æ”¾-å…³é—­åŽŸåˆ™ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šé€šå¸¸ï¼Œä½ åŠžä¸åˆ°ã€‚éµå¾ªå¼€æ”¾-å…³é—­åŽŸåˆ™ï¼Œé€šå¸¸ä¼šå¼•å…¥æ–°çš„æŠ½è±¡å±‚æ¬¡ï¼Œå¢žåŠ ä»£ç çš„å¤æ‚åº¦ã€‚ä½ éœ€è¦æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨è®¾è®¡ä¸­æœ€æœ‰å¯èƒ½æ”¹å˜çš„åœ°æ–¹ï¼Œç„¶åŽåº”ç”¨å¼€æ”¾-å…³é—­åŽŸåˆ™ã€‚</p><h1 id="å®šä¹‰è£…é¥°è€…æ¨¡å¼">å®šä¹‰è£…é¥°è€…æ¨¡å¼</h1><p>è£…é¥°è€…æ¨¡å¼åŠ¨æ€åœ°å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚è‹¥è¦æ‰©å±•åŠŸèƒ½ï¼Œè£…é¥°è€…æä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p><img src="http://www.plantuml.com/plantuml/svg/jPF1IiD048RlUOezwg7qBY9OlNlmQ3sawMWgxQPi5qLg8OZ1jbRZGOk8YhKKH4LRn5fDnNVHP9EU-Wfk6aoY5XN1Io3_plx_DpE9d4e2WaoMhg8CP1901DbLf1IHqY28YHmbeaJHb9B9AXWmHNa1eVoxNk2NgAma9qT6XyanJ_PU2YWQHPRMDeqggpwmstsX84XfCPVZvbWYGE5ZIDZvbtO-xZH82X6fGluJrm-P7AG4z2j4p6Q1G78ciVHD8nXMOY2Booc5_34uzdqmVm8V1i-PfIA5lyqqS1zVYqI-xkfpWGyNFWZhOuZTw6RdmgbhlKRJKRKNzOWTbSoEoiKNzJYE-zsYLT7ukQVrkoNRs32DzgkwBWIR_O0JxEB7YfY05Gee3GiKAGjV6nf3NfgbtvX6mzhUjxUkpATdU--ytwt4CIjMERDpTkdpkwntz-ouuLMvb8C4abgK1n6XreDBMilQhLZN9_PECuxjmmssqx3qUfILdvnMpMuPlirdqA3Li9q7MpurEsLMRNA_E7Pg5RFpw0vJF-Xjwb5lfNoQhlMGZpWont_z9E3vYI53UmC0"><h1 id="è£…é¥°æˆ‘ä»¬çš„é¥®æ–™">è£…é¥°æˆ‘ä»¬çš„é¥®æ–™</h1><p>è£…é¥°è€…æ¨¡å¼å®Œå…¨éµå¾ªå¼€æ”¾-å…³é—­åŽŸåˆ™ï¼šæˆ‘ä»¬ä»¥é¥®æ–™ä¸ºä¸»ä½“ï¼Œç„¶åŽåœ¨è¿è¡Œæ—¶ä»¥è°ƒæ–™æ¥â€è£…é¥°â€œï¼ˆdecorateï¼‰é¥®æ–™ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æžœé¡¾å®¢æƒ³è¦æ‘©å¡å’Œå¥¶æ³¡æ·±ç„™å’–å•¡ï¼Œé‚£ä¹ˆï¼Œè¦åšçš„æ˜¯ï¼š</p><ol type="1"><li>æ‹¿ä¸€ä¸ªæ·±ç„™å’–å•¡ï¼ˆDarkRoastï¼‰å¯¹è±¡</li><li>ä»¥æ‘©å¡ï¼ˆMochaï¼‰å¯¹è±¡è£…é¥°å®ƒ</li><li>ä»¥å¥¶æ³¡ï¼ˆWhipï¼‰å¯¹è±¡è£…é¥°å®ƒ</li><li>è°ƒç”¨ <code>cost()</code> æ–¹æ³•ï¼Œå¹¶ä¾èµ–å§”æ‰˜ï¼ˆdelegateï¼‰å°†è°ƒæ–™çš„ä»·é’±åŠ ä¸ŠåŽ»</li></ol><img src="http://www.plantuml.com/plantuml/svg/XL8zJy9G5DtxA-w8CO2wWHy3ChYukAf3QI-qeUqZhmyJWqs8WKGZnaKOZ2uQ4gCccXWHKuq_njBYv5_mbK91FkBstZddzfnx-XHLHa2zmFP1Hps3L51yH5AffA4WPan6HOb12lUGYZc4aW0WeobHjS1KOl1R3bbw24JcE5GQp5aW4PC5c8vC8R85yJXqgYt7RhYNnzxvhNTHSHjlxdDTi0H94qqJDaZHn9I6XjnpwtzXmAP5cjyYeib6I2W1HLQa1Yp64ebbiBWwZBvE35dLqU0f9K95HcXlCjmeqpzmR58Q6Sfybu4MLY7Zs_nPTQA8GUHD8YdYJDFn5M9B2p0V2c817PZDTb2r_3y6qyT3_Sf1D3hI_1WHbZw6JnOs8fZA9w5JgtPlgawxxBJlkjVt_FpTVEgMgr_bGs7Al-hv-FlD9lrwXQ3aw3P_lZ8Qksl1Z44OWePP1YGRbfC4pwuuTgjpzkZOpSvftJjvS3u--MFyUQ_j6EvHWySPZUP7Vdbrhvg1YYVz1G00"><p>å¦‚æžœæœ‰ä¸€å¼ å•å­ç‚¹çš„æ˜¯ï¼šâ€œåŒå€æ‘©å¡è±†æµ†å¥¶æ³¡æ‹¿é“å’–å•¡â€ï¼Œå®ƒçš„ä»·é’±æ˜¯ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">beverage = <span class="keyword">new</span> HouseBlend();</span><br><span class="line">beverage = <span class="keyword">new</span> Mocha(beverage); <span class="comment">// ç”¨æ‘©å¡è£…é¥°</span></span><br><span class="line">beverage = <span class="keyword">new</span> Mocha(beverage); <span class="comment">// ç”¨ç¬¬äºŒä¸ªæ‘©å¡è£…é¥°</span></span><br><span class="line">beverage = <span class="keyword">new</span> Soy(beverage);   <span class="comment">// ç”¨è±†æµ†è£…é¥°</span></span><br><span class="line">beverage = <span class="keyword">new</span> Whip(beverage);  <span class="comment">// ç”¨å¥¶æ³¡è£…é¥°</span></span><br><span class="line">System.out.println(<span class="string">"$"</span> + beverage.cost());  <span class="comment">// é¥®æ–™çš„ä»·æ ¼</span></span><br></pre></td></tr></table></figure><p>CondimentDecorator æ‰©å±•è‡ª Beverage ç±»ï¼Œè¿™ç”¨åˆ°äº†ç»§æ‰¿ã€‚è¿™ä¹ˆåšçš„ç»ˆç‚¹åœ¨äºŽï¼Œ<strong>è£…é¥°è€…å’Œè¢«è£…é¥°è€…å¿…é¡»æ˜¯ä¸€æ ·çš„ç±»åž‹</strong>ï¼Œä¹Ÿå°±æ˜¯æœ‰å…±åŒçš„è¶…ç±»ï¼Œè¿™ç›¸å½“å…³é”®çš„åœ°æ–¹ï¼Œå› ä¸ºè£…é¥°è€…å¿…é¡»èƒ½å–ä»£è¢«è£…é¥°è€…ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ©ç”¨ç»§æ‰¿è¾¾åˆ°â€œç±»åž‹åŒ¹é…â€ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ç»§æ‰¿èŽ·å¾—â€œè¡Œä¸ºâ€ã€‚è¡Œä¸ºæ¥è‡ªè£…é¥°è€…å’ŒåŸºç¡€ç»„ä»¶ï¼Œæˆ–ä¸Žå…¶ä»–è£…é¥°è€…ä¹‹é—´çš„ç»„åˆå…³ç³»ã€‚æ­£æ˜¯å› ä¸ºä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œå¯ä»¥æŠŠæ‰€æœ‰é¥®æ–™å’Œè°ƒæ–™æœ‰å¼¹æ€§åœ°åŠ ä»¥æ··åˆã€‚</p><h1 id="çœŸå®žä¸–ç•Œçš„è£…é¥°è€…java-io">çœŸå®žä¸–ç•Œçš„è£…é¥°è€…ï¼šJava I/O</h1><img src="http://www.plantuml.com/plantuml/svg/TPAnJiCm48PtFuNLFPNeY10I5KAgL24aHiJW99V6Qc8gsnaYCJ2GXPKdG8WT5XYglas1y1OaSHIvyNcB__y_t_dBfJm62lb6bpI7F0H9qbQ9k8mo82nKMh98quNO5FfQIs0v4NSQQ0Q9FgO_Jxlwu-Lt-xZVVf8eOqhH2vw1dJPgS-1YDI-I1AJhpaiDPrAoqhQ6tisD-h2gcq3oLJgCKBzMVs_lzKFLttXLg3HaqHhfrSq0iUkSCyrSTSa5N1Oj6Tkplkd9VH0uptO2FW9E48M1zHj1SHGJn4XueXWQJtJCoXF3uOrOqU2csRaOnEsfbv97jqjHRfXe5tbsQ_9TVUrtpsQn9vGfAeuEd67VZ3bptZITjYM-iOsB3jTRxg_ed1aPaUzL57Jl8HjWd7y0"><p>å’Œæ˜Ÿå·´å…¹çš„è®¾è®¡ç›¸æ¯”ï¼Œ<code>java.io</code> å…¶å®žæ²¡æœ‰å¤šå¤§çš„å·®å¼‚ã€‚ä½ ä¼šå‘çŽ°â€œè¾“å‡ºâ€æµçš„è®¾è®¡ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ä½ å¯èƒ½è¿˜ä¼šå‘çŽ° Reader/Writter æµï¼ˆä½œä¸ºåŸºäºŽå­—ç¬¦æ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºï¼‰å’Œè¾“å…¥æµ/è¾“å‡ºæµçš„ç±»ç›¸å½“ç±»ä¼¼ï¼ˆè™½ç„¶æœ‰ä¸€äº›å°å·®å¼‚å’Œä¸ä¸€è‡´ä¹‹å¤„ï¼Œä½†æ˜¯ç›¸å½“é›·åŒï¼Œæ‰€ä»¥ä½ åº”è¯¥å¯ä»¥äº†è§£è¿™äº›ç±»ï¼‰ã€‚</p><p>Java I/O ä¹Ÿå¼•å‡ºè£…é¥°è€…æ¨¡å¼çš„ä¸€ä¸ªâ€œç¼ºç‚¹â€ï¼šåˆ©ç”¨è£…é¥°è€…æ¨¡å¼ï¼Œå¸¸å¸¸é€ æˆè®¾è®¡ä¸­æœ‰å¤§é‡çš„å°ç±»ï¼Œæ•°é‡å®žåœ¨å¤ªå¤šï¼Œå¯èƒ½ä¼šé€ æˆä½¿ç”¨æ­¤ API ç¨‹åºå‘˜çš„å›°æ‰°ã€‚ä½†æ˜¯ï¼ŒçŽ°åœ¨ä½ å·²ç»äº†è§£äº†è£…é¥°è€…çš„å·¥ä½œåŽŸç†ï¼Œä»¥åŽå½“ä½¿ç”¨åˆ«äººçš„å¤§é‡è£…é¥°çš„ API æ—¶ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°è¾¨åˆ«å‡ºä»–ä»¬çš„è£…é¥°è€…ç±»æ˜¯å¦‚ä½•ç»„ç»‡çš„ï¼Œä»¥æ–¹ä¾¿ç”¨åŒ…è£…æ–¹å¼å–å¾—æƒ³è¦çš„è¡Œä¸ºã€‚</p><h2 id="ç¼–å†™è‡ªå·±çš„-java-io-è£…é¥°è€…">ç¼–å†™è‡ªå·±çš„ Java I/O è£…é¥°è€…</h2><p>ç¼–å†™ä¸€ä¸ªè£…é¥°è€…ï¼ŒæŠŠè¾“å…¥æµå†…çš„æ‰€æœ‰å¤§å†™å­—ç¬¦è½¬æˆå°å†™ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆï¼Œæ‰©å±•FilterInputStream</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LowerCaseInputStream</span> <span class="keyword">extends</span> <span class="title">FilterInputStream</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LowerCaseInputStream</span><span class="params">(InputStream in)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é’ˆå¯¹å­—èŠ‚çš„ read() æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c = <span class="keyword">super</span>.read();</span><br><span class="line">        <span class="keyword">return</span> (c == -<span class="number">1</span> ? c : Character.toLowerCase((<span class="keyword">char</span>) c));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é’ˆå¯¹å­—èŠ‚æ•°ç»„çš„ read() æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="keyword">super</span>.read(b, offset, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = offset; i &lt; offset + result; i++) &#123;</span><br><span class="line">            b[i] = (<span class="keyword">byte</span>)Character.toLowerCase((<span class="keyword">char</span>)b[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InputTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in =</span><br><span class="line">                <span class="keyword">new</span> LowerCaseInputStream(</span><br><span class="line">                    <span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">                        <span class="keyword">new</span> FileInputStream(<span class="string">"test.txt"</span>)));</span><br><span class="line">            <span class="keyword">while</span> ((c = in.read()) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println((<span class="keyword">char</span>)c);</span><br><span class="line">            &#125;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>ç»§æ‰¿å±žäºŽæ‰©å±•å½¢å¼ä¹‹ä¸€ï¼Œä½†ä¸è§å¾—æ˜¯è¾¾åˆ°å¼¹æ€§è®¾è®¡çš„æœ€ä½³æ–¹æ¡ˆã€‚</li><li>ç»„åˆå’Œå§”æ‰˜å¯ç”¨äºŽåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ ä¸Šæ–°çš„è¡Œä¸ºã€‚</li><li>è£…é¥°è€…æ¨¡å¼æ„å‘³ç€ä¸€ç¾¤è£…é¥°è€…ç±»ï¼Œè¿™äº›ç±»ç”¨æ¥åŒ…è£…å…·ä½“ç»„ä»¶ã€‚</li><li>è£…é¥°è€…ç±»åæ˜ å‡ºè¢«è£…é¥°çš„ç»„ä»¶ç±»åž‹ï¼ˆäº‹å®žä¸Šï¼Œä»–ä»¬å…·æœ‰ç›¸åŒçš„ç±»åž‹ï¼Œéƒ½ç»è¿‡æŽ¥å£æˆ–ç»§æ‰¿å®žçŽ°ï¼‰ã€‚</li><li>è£…é¥°è€…å¯ä»¥åœ¨è¢«è£…é¥°è€…çš„è¡Œä¸ºå‰é¢ä¸Ž/æˆ–åŽé¢åŠ ä¸Šè‡ªå·±çš„è¡Œä¸ºï¼Œç”šè‡³å°†è¢«è£…é¥°è€…çš„è¡Œä¸ºæ•´ä¸ªå–ä»£æŽ‰ï¼Œè€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚</li><li>å¯ä»¥ç”¨æ— æ•°ä¸ªè£…é¥°è€…åŒ…è£…ä¸€ä¸ªç»„ä»¶ã€‚</li><li>è£…é¥°è€…ä¸€èˆ¬å¯¹ç»„ä»¶çš„å®¢æˆ·æ˜¯é€æ˜Žçš„ï¼Œé™¤éžå®¢æˆ·ä¾èµ–äºŽç»„ä»¶çš„å…·ä½“ç±»åž‹ã€‚</li><li>è£…é¥°è€…ä¼šå¯¼è‡´è®¾è®¡ä¸­å‡ºçŽ°è®¸å¤šå°å¯¹è±¡ï¼Œå¦‚æžœè¿‡åº¦ä½¿ç”¨ï¼Œä¼šè®©ç¨‹åºå˜å¾—å¾ˆå¤æ‚ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§‚å¯Ÿè€…æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/observer-pattern/"/>
      <url>/notes/head-first-design-patterns/observer-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥internetæ°”è±¡è§‚æµ‹ç«™">å¯¼å…¥ï¼šInternetæ°”è±¡è§‚æµ‹ç«™</h1><p>æ°”è±¡ç«™å»ºç«‹åœ¨ WeatherData å¯¹è±¡ä¸Šï¼Œç”± WeatherData å¯¹è±¡è´Ÿè´£è¿½è¸ªç›®å‰çš„å¤©æ°”çŠ¶å†µï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€æ°”åŽ‹ï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›èƒ½å»ºç«‹ä¸€ä¸ªåº”ç”¨ï¼Œæœ‰ä¸‰ç§å¸ƒå‘Šæ¿ï¼Œåˆ†åˆ«æ˜¾ç¤ºç›®å‰çš„çŠ¶å†µã€æ°”è±¡ç»Ÿè®¡ä»¥åŠç®€å•çš„é¢„æŠ¥ã€‚å½“ WeatherData å¯¹è±¡èŽ·å¾—æœ€æ–°çš„æµ‹é‡æ•°æ®æ—¶ï¼Œä¸‰ç§å¸ƒå‘Šæ¿å¿…é¡»å®žæ—¶æ›´æ–°ã€‚</p><p>è€Œä¸”ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥æ‰©å±•çš„æ°”è±¡ç«™ï¼Œæˆ‘ä»¬å¸Œæœ›å…¬å¸ƒä¸€ç»„ APIï¼Œå¥½è®©å…¶ä»–å¼€å‘äººå‘˜å¯ä»¥å†™å‡ºè‡ªå·±çš„å¸ƒå‘Šæ¿ï¼Œå¹¶æ’å…¥æ­¤åº”ç”¨ä¸­ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONAuId9fPaf1Qv99OaAbHpAIYafvQ40BMa5YMMb1QbQcX2X3nASpDJCaigOVo0ejJYOfXyRceYY9sRcbTIx9oHc9UUcgAXgL2jeA-ly6H7mxFfovvjcF9Yuy9dMxjVjlS_cxtbsRGDx_VqF5kxvDcqdSysJtsoPzQBHQjVR6X-FcM5GYrNBG00"><h2 id="é”™è¯¯ç¤ºèŒƒ">é”™è¯¯ç¤ºèŒƒ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherData</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å®žä¾‹å˜é‡å£°æ˜Ž</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measurementsChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">float</span> temp = getTemperature();</span><br><span class="line">      <span class="keyword">float</span> humidity = getHumidity();</span><br><span class="line">      <span class="keyword">float</span> pressure = getPressure();</span><br><span class="line"></span><br><span class="line">      currentConditionsDisplay.update(temp, humidity, pressure);</span><br><span class="line">      statisticsDisplay.update(temp, humidity, pressure);</span><br><span class="line">      forecastDisplay.update(temp, humidity, pressure);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–WeatherDataæ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå®žçŽ°ä¸­ï¼Œä¸‹åˆ—å“ªç§è¯´æ³•æ­£ç¡®ï¼Ÿï¼ˆå¤šé€‰ï¼‰</p><ul><li>[x] A. æˆ‘ä»¬æ˜¯é’ˆå¯¹å…·ä½“å®žçŽ°ç¼–ç¨‹ï¼Œè€Œéžé’ˆå¯¹æŽ¥å£ã€‚ï¼ˆä¸‰ä¸ªå¸ƒå‘Šæ¿éƒ½æ˜¯å®žçŽ°ï¼‰</li><li>[x] B. å¯¹äºŽæ¯ä¸ªæ–°çš„å¸ƒå‘Šæ¿ï¼Œæˆ‘ä»¬éƒ½å¾—ä¿®æ”¹ä»£ç ã€‚</li><li>[x] C. æˆ‘ä»¬æ— æ³•åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å¢žåŠ ï¼ˆæˆ–åˆ é™¤ï¼‰å¸ƒå‘Šæ¿ã€‚</li><li>[ ] D. å¸ƒå‘Šæ¿æ²¡æœ‰å®žçŽ°ä¸€ä¸ªå…±åŒçš„æŽ¥å£ã€‚ï¼ˆ<code>update(temp, humidity, pressure)</code> çœ‹æ°é‡Œåƒæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æŽ¥å£ï¼‰</li><li>[x] E. æˆ‘ä»¬å°šæœªå°è£…æ”¹å˜çš„éƒ¨åˆ†ã€‚ï¼ˆ<code>display.update</code> æ˜¯ä¼šæ”¹å˜çš„éƒ¨åˆ†ï¼‰</li><li>[ ] F. æˆ‘ä»¬ä¾µçŠ¯äº† WeatherData ç±»çš„å°è£…ã€‚</li></ul><a id="more"></a><h1 id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</h1><p>æˆ‘ä»¬çœ‹çœ‹æŠ¥çº¸å’Œæ‚å¿—çš„è®¢é˜…æ˜¯æ€Žä¹ˆå›žäº‹ï¼š</p><ol type="1"><li>æŠ¥ç¤¾çš„ä¸šåŠ¡å°±æ˜¯å‡ºç‰ˆæŠ¥çº¸ã€‚</li><li>å‘æŸå®¶æŠ¥ç¤¾è®¢é˜…æŠ¥çº¸ï¼Œåªè¦ä»–ä»¬æœ‰æ–°æŠ¥çº¸å‡ºç‰ˆï¼Œå°±ä¼šç»™ä½ é€æ¥ã€‚åªè¦ä½ æ˜¯ä»–ä»¬çš„è®¢æˆ·ï¼Œä½ å°±ä¼šä¸€ç›´æ”¶åˆ°æ–°æŠ¥çº¸ã€‚</li><li>å½“ä½ ä¸æƒ³å†çœ‹æŠ¥çº¸çš„æ—¶å€™ï¼Œå–æ¶ˆè®¢é˜…ï¼Œä»–ä»¬å°±ä¸ä¼šå†é€æ–°æŠ¥çº¸æ¥ã€‚</li><li>åªè¦æŠ¥ç¤¾è¿˜åœ¨è¿è¥ï¼Œå°±ä¼šä¸€ç›´æœ‰äººï¼ˆæˆ–å•ä½ï¼‰å‘ä»–ä»¬è®¢é˜…æŠ¥çº¸æˆ–å–æ¶ˆè®¢é˜…æŠ¥çº¸ã€‚</li></ol><p>å‡ºç‰ˆè€… + è®¢é˜…è€… = è§‚å¯Ÿè€…æ¨¡å¼</p><p>åªè¦ä½ äº†è§£æŠ¥çº¸çš„è®¢é˜…æ˜¯æ€Žä¹ˆå›žäº‹ï¼Œå…¶å®žå°±çŸ¥é“è§‚å¯Ÿè€…æ¨¡å¼æ˜¯æ€Žä¹ˆå›žäº‹ï¼Œåªæ˜¯åç§°ä¸å¤ªä¸€æ ·ï¼šå‡ºç‰ˆè€…æ”¹ç§°ä¸ºâ€œä¸»é¢˜â€ï¼ˆSubjectï¼‰ï¼Œè®¢é˜…è€…æ”¹ç§°ä¸ºâ€œè§‚å¯Ÿè€…â€ï¼ˆObserverï¼‰ã€‚</p><h2 id="å®šä¹‰">å®šä¹‰</h2><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–ç€éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/ZP71IiD048RlUOeX9oianNieY5V1Wq-msKpDIZTRPgU5K7EpJo3jeQzHK4HycxQ-XXjrrzfKyRJm___-ymrJgW81zPXhqAXpfAXi5Qb8ZZ1I5ICDXKIudkItA1coB6Y30SmYW9d8BPEGt03XZRBElSejqXJff7VeQpF5tzpAi1hMUswpDz_BVmDCneLW_FWgHy9Qk32L96Jq-6t-d4ZKbmuKp5UfTUfHzYF07Ke7e95BKpJGxyDs_hXvMRwjxhVpfythmsxvl5ilEZXXcvR7izdFrobXZVzrXxRuD8OiIHA8p-B3rIC_flKw8LyHKjbTcgQTZkyh_B2z_0u0"><h2 id="æ¾è€¦åˆçš„å¨åŠ›">æ¾è€¦åˆçš„å¨åŠ›</h2><p><strong>å½“ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ¾è€¦åˆï¼Œå®ƒä»¬ä¾ç„¶å¯ä»¥äº¤äº’ï¼Œä½†æ˜¯ä¸å¤ªæ¸…æ¥šå½¼æ­¤çš„ç»†èŠ‚ã€‚</strong>è§‚å¯Ÿè€…æ¨¡å¼æä¾›äº†ä¸€ç§å¯¹è±¡è®¾è®¡ï¼Œè®©ä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´æ¾è€¦åˆã€‚æ”¹å˜ä¸»é¢˜æˆ–è§‚å¯Ÿè€…å…¶ä¸­ä¸€æ–¹ï¼Œå¹¶ä¸ä¼šå½±å“å¦ä¸€æ–¹ã€‚å› ä¸ºä¸¤è€…æ˜¯æ¾è€¦åˆçš„ï¼Œæ‰€ä»¥åªè¦ä»–ä»¬ä¹‹é—´çš„æŽ¥å£ä»è¢«éµå®ˆï¼ˆè§‚å¯Ÿè€…å®žçŽ°äº† Observer æŽ¥å£ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªç”±åœ°æ”¹å˜ä»–ä»¬ã€‚</p><blockquote><p>ä¸ºäº†äº¤äº’å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆè®¾è®¡è€ŒåŠªåŠ›ã€‚</p></blockquote><p><strong>æ¾è€¦åˆçš„è®¾è®¡ä¹‹æ‰€ä»¥èƒ½è®©æˆ‘ä»¬å»ºç«‹æœ‰å¼¹æ€§çš„ OO ç³»ç»Ÿï¼Œèƒ½å¤Ÿåº”å¯¹å˜åŒ–ï¼Œæ˜¯å› ä¸ºå¯¹è±¡ä¹‹é—´çš„äº’ç›¸ä¾èµ–é™åˆ°äº†æœ€ä½Žã€‚</strong></p><h2 id="è®¾è®¡æ°”è±¡ç«™">è®¾è®¡æ°”è±¡ç«™</h2><img src="http://www.plantuml.com/plantuml/svg/hLDDIyD04BtdLynH3wrtARcqYWT1GS63UDXifirAFihkfX9geOWUL3pfeJUXLCIJNWJnwzUOsFuBDxL9qvZsv6tptkJDUxEp5ZCHq6dA01nq3EIQ5IEKSMgZnbo9l4uemevl72ALKAcacAv3MmFOP4A2PmZaBUH20MrY2Ca9bHtWs50iygq9lRISvnslXVDOrvEi7cJOJiPG0XSuIhmUMIWjv3KYoQomtpI9n9nWZOccJO8r6nrqYuAQlmNZtwXDX82zQOFYKHJcBmZz9wd26YXtrSKW9zBdE2vJq8RlC9F98FdUvYX4mZj8udFiNrGjuZRGpBYj-fmhfkgvIe1vhfWaNZ2pT52PzD26bHM8Uf_VWzVmupeylnhUdqJFbs7t7JffitMF8oL2_aEFmKFqT3FgdqONT-C6YKn9JvTW5PI7yF5ss3rBwKefGt-zl8twlIbtN2vdRq-RRbFCp9kKbj-HXSMpchc154hbQrA5qhvwbIQw1tfkJNy0"><h1 id="java-å†…ç½®çš„è§‚å¯Ÿè€…æ¨¡å¼">Java å†…ç½®çš„è§‚å¯Ÿè€…æ¨¡å¼</h1><p><code>java.util</code> åŒ…å†…åŒ…å«æœ€åŸºæœ¬çš„ Observer æŽ¥å£ä¸Ž Observable ç±»ï¼Œè¿™å’Œæˆ‘ä»¬çš„ Observer æŽ¥å£ä¸Ž Subject æŽ¥å£å¾ˆç›¸ä¼¼ã€‚ Observer æŽ¥å£ä¸Ž Observable ç±»ä½¿ç”¨ä¸Šæ›´æ–¹ä¾¿ï¼Œå› ä¸ºè®¸å¤šåŠŸèƒ½éƒ½å·²ç»äº‹å…ˆå‡†å¤‡å¥½äº†ã€‚ä½ ç”šè‡³å¯ä»¥ç”¨â€œæŽ¨â€ï¼ˆpushï¼‰æˆ–â€œæ‹‰â€ï¼ˆpullï¼‰çš„æ–¹å¼ä¼ é€æ•°æ®ï¼Œç¨åŽå°±ä¼šçœ‹åˆ°è¿™æ ·çš„ä¾‹å­ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/hLD1JnD15BxlhvWZ7XRkJTDBaN0mmOE91_4mtNbb9zcTRMQc9arfiX8aW4KEAYczOB0DwWK98QaKzSUmEzkU_0kEMxfEDvMJj_U--VPxxttlhKi98F1hie5yy2l0BVSFub3kU60v7XO2hLK4y1UuuW5gMWWzeaAY8CM02mrWGjRkqeK7EYVWWOGPY0MILXjJIAIO05bsCTi0ejEMHPa4NiKEe2aD5OiPM2gbjOrMWYpKU1DNXEJOaIrKhn4i8IUvJ4NDmus77lZ0v1nXCY6adqscVkg2T84lOuddZxq1yebs3ZYMTGxfI1fQhVkKKDcOveyv235vdogNwvphBie1qqGQC77NtRqJPcCPlQ8cMbf2glCZwLt7tz_6UmUZiorrzJeERr0hAxSIS72maF-bIk-p-lfkVBgjzljf2KF8BcMRAo3TI7n-CWfVcOoYRJ2YmN1ysfbvthHjqtRhxo5iBYx-qpOhlznxoREQEM_cIkKvcOBzJFyh1DZpKkw-B7tkW3oeweEf6buNZ5XrpgD160s-91V3NpVjTJOAsz7W88FLctvy-F4st9eLC-mfe6HuflP-HjSxwl9JlDE-3L_6kn_6npqThBDns4rE-jaUakwsElgcBjzhoTy0"><p>Java å†…ç½®çš„è§‚å¯Ÿè€…æ¨¡å¼è¿ä½œæ–¹å¼ï¼Œå’Œæˆ‘ä»¬åœ¨æ°”è±¡ç«™ä¸­çš„å®žçŽ°ç±»ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹å°å·®å¼‚ã€‚æœ€æ˜Žæ˜¾çš„å·®å¼‚æ˜¯ WeatherData ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ä¸»é¢˜ï¼‰çŽ°åœ¨<strong>æ‰©å±•</strong>è‡ª Observable ç±»ï¼Œå¹¶ç»§æ‰¿åˆ°ä¸€äº›å¢žåŠ ã€åˆ é™¤ã€é€šçŸ¥è§‚å¯Ÿè€…çš„æ–¹æ³•ï¼ˆä»¥åŠå…¶ä»–æ–¹æ³•ï¼‰ã€‚</p><h2 id="å¯è§‚å¯Ÿè€…å¦‚ä½•é€å‡ºé€šçŸ¥">å¯è§‚å¯Ÿè€…å¦‚ä½•é€å‡ºé€šçŸ¥</h2><ol type="1"><li>å…ˆè°ƒç”¨ <code>setChanged()</code> æ–¹æ³•ï¼Œæ ‡è®°çŠ¶æ€å·²ç»æ”¹å˜çš„äº‹å®žã€‚</li><li>ç„¶åŽè°ƒç”¨ <code>notifyObservers()</code> æˆ– <code>notifyObservers(Object arg)</code>ã€‚åŽè€…å¯ä»¥ä¼ é€ä»»ä½•çš„æ•°æ®å¯¹è±¡ç»™æ¯ä¸€ä¸ªè§‚å¯Ÿè€…ã€‚</li></ol><h2 id="è§‚å¯Ÿè€…å¦‚ä½•æŽ¥å—é€šçŸ¥">è§‚å¯Ÿè€…å¦‚ä½•æŽ¥å—é€šçŸ¥</h2><p>è§‚å¯Ÿè€…å®žçŽ°äº†æ›´æ–°çš„æ–¹æ³•ï¼Œä½†æ˜¯æ–¹æ³•çš„ç­¾åä¸å¤ªä¸€æ ·ï¼š<code>update(Observable o, Object arg)</code>ã€‚ä¸»é¢˜æœ¬èº« o å½“ä½œç¬¬ä¸€ä¸ªå˜é‡ï¼Œå¥½è®©è§‚å¯Ÿè€…çŸ¥é“æ˜¯å“ªä¸ªä¸»é¢˜é€šçŸ¥å®ƒçš„ã€‚arg æ­£æ˜¯ä¼ å…¥ <code>notifyObservers()</code> çš„æ•°æ®å¯¹è±¡ï¼Œå¦‚æžœæ²¡æœ‰è¯´æ˜Žåˆ™ä¸ºç©ºã€‚</p><p>å¦‚æžœä½ æƒ³â€œæŽ¨â€ï¼ˆpushï¼‰æ•°æ®ç»™è§‚å¯Ÿè€…ï¼Œä½ å¯ä»¥æŠŠæ•°æ®å½“ä½œå¯¹è±¡ä¼ é€ç»™ <code>notifyObservers(arg)</code> æ–¹æ³•ã€‚å¦åˆ™ï¼Œè§‚å¯Ÿè€…å°±å¿…é¡»ä»Žå¯è§‚å¯Ÿè€…å¯¹è±¡ä¸­â€œæ‹‰â€ï¼ˆpullï¼‰æ•°æ®ã€‚</p><h2 id="setchanged-æ˜¯æ€Žä¹ˆä¸€å›žäº‹"><code>setChanged()</code> æ˜¯æ€Žä¹ˆä¸€å›žäº‹</h2><p><code>setChanged()</code> æ–¹æ³•ç”¨æ¥æ ‡è®°çŠ¶æ€å·²ç»æ”¹å˜çš„äº‹å®žï¼Œå¥½è®© <code>notifyObservers()</code> çŸ¥é“å½“å®ƒè¢«è°ƒç”¨æ—¶åº”è¯¥é€šçŸ¥è§‚å¯Ÿè€…ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ Observable å†…éƒ¨ï¼Œä»¥äº†è§£è¿™ä¸€åˆ‡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setChanged() &#123;</span><br><span class="line">    changed = <span class="keyword">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">notifyObservers(Object arg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (changed) &#123;</span><br><span class="line">        <span class="keyword">for</span> every observer on the list &#123;</span><br><span class="line">            <span class="function">call <span class="title">update</span> <span class="params">(<span class="keyword">this</span>, arg)</span></span></span><br><span class="line"><span class="function">        &#125;</span></span><br><span class="line"><span class="function">        changed </span>= <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">notifyObservers() &#123;</span><br><span class="line">    notifyObservers(<span class="keyword">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšæœ‰å…¶å¿…è¦æ€§ã€‚<code>setChanged()</code> æ–¹æ³•å¯ä»¥è®©ä½ åœ¨é€šçŸ¥è§‚å¯Ÿè€…æ—¶ï¼Œæœ‰æ›´å¤šçš„å¼¹æ€§ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æžœæ²¡æœ‰ <code>setChanged()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬çš„æ°”è±¡ç«™æµ‹é‡æ˜¯å¦‚æ­¤æ•é”ï¼Œä»¥è‡´äºŽæ¸©åº¦è®¡è¯»æ•°æ¯ååˆ†ä¹‹ä¸€åº¦å°±ä¼šæ›´æ–°ï¼Œè¿™ä¼šé€ æˆ WeatherData å¯¹è±¡æŒç»­ä¸æ–­åœ°é€šçŸ¥è§‚å¯Ÿè€…ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›çœ‹åˆ°è¿™æ ·çš„äº‹æƒ…å‘ç”Ÿã€‚å¦‚æžœæˆ‘ä»¬å¸Œæœ›åŠåº¦ä»¥ä¸Šæ‰æ›´æ–°ï¼Œå°±å¯ä»¥åœ¨æ¸©åº¦å·®è·è¾¾åˆ°åŠåº¦æ—¶ï¼Œè°ƒç”¨ <code>setChanged()</code>ï¼Œè¿›è¡Œæœ‰æ•ˆçš„æ›´æ–°ã€‚ä½ ä¹Ÿè®¸ä¸ä¼šç»å¸¸ç”¨åˆ°æ­¤åŠŸèƒ½ï¼Œä½†æ˜¯æŠŠè¿™æ ·çš„åŠŸèƒ½å‡†å¤‡å¥½ï¼Œå½“éœ€è¦æ—¶é©¬ä¸Šå°±å¯ä»¥ä½¿ç”¨ã€‚</p><h2 id="java.util.observable-çš„é»‘æš—é¢"><code>java.util.Observable</code> çš„é»‘æš—é¢</h2><p>å¯è§‚å¯Ÿè€…æ˜¯ä¸€ä¸ªâ€œç±»â€è€Œä¸æ˜¯ä¸€ä¸ªâ€œæŽ¥å£â€ï¼Œæ›´ç³Ÿçš„æ˜¯ï¼Œå®ƒç”šè‡³æ²¡æœ‰å®žçŽ°ä¸€ä¸ªæŽ¥å£ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ<code>java.util.Observable</code> çš„å®žçŽ°æœ‰è®¸å¤šé—®é¢˜ï¼Œé™åˆ¶äº†å®ƒçš„ä½¿ç”¨å’Œå¤ç”¨ã€‚</p><ul><li><p>Observable æ˜¯ä¸€ä¸ªç±»</p><p>é¦–å…ˆï¼Œå› ä¸º Observable æ˜¯ä¸€ä¸ªâ€œç±»â€ï¼Œä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªç±»ç»§æ‰¿å®ƒã€‚å¦‚æžœæŸç±»ç›¸åŒæ—¶å…·æœ‰ Observable ç±»å’Œå¦ä¸€ä¸ªè¶…ç±»çš„è¡Œä¸ºï¼Œå°±ä¼šé™·å…¥ä¸¤éš¾ï¼Œæ¯•ç«Ÿ Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ã€‚å†è€…ï¼Œå› ä¸ºæ²¡æœ‰ Observable æŽ¥å£ï¼Œæ‰€ä»¥ä½ æ— æ³•å»ºç«‹è‡ªå·±çš„å®žçŽ°ï¼Œå’Œ Java å†…ç½®çš„ Observer API æ­é…ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å°† <code>java.util</code> çš„å®žçŽ°æ¢æˆå¦ä¸€å¥—åšæ³•çš„å®žçŽ°ã€‚</p></li><li><p>Observable å°†å…³é”®çš„æ–¹æ³•ä¿æŠ¤èµ·æ¥</p><p><code>setChanged()</code> æ–¹æ³•è¢«ä¿æŠ¤èµ·æ¥äº†ï¼ˆè¢«å®šä¹‰æˆ protectedï¼‰ã€‚è¿™æ„å‘³ç€ï¼šé™¤éžä½ ç»§æ‰¿è‡ª Observableï¼Œå¦åˆ™ä½ æ— æ³•åˆ›å»º Observable å®žä¾‹å¹¶ç»„åˆåˆ°ä½ çš„å¯¹è±¡ä¸­æ¥ã€‚è¿™ä¸ªè®¾è®¡è¿åäº†â€œå¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿â€çš„è®¾è®¡åŽŸåˆ™ã€‚</p></li></ul><h1 id="jdk-ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼">JDK ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼</h1><p>åœ¨ JDK ä¸­ï¼Œå¹¶éžåªæœ‰åœ¨ <code>java.util</code> ä¸­æ‰èƒ½æ‰¾åˆ°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå…¶å®žåœ¨ JavaBeans å’Œ Swing ä¸­ï¼Œä¹Ÿéƒ½å®žçŽ°äº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ Swing APIï¼šJButtonã€‚å¦‚æžœä½ è§‚å¯Ÿä¸€ä¸‹ JButton çš„è¶…ç±» AbstractButtonï¼Œä½ ä¼šçœ‹åˆ°è®¸å¤šå¢žåŠ ä¸Žåˆ é™¤å€¾å¬è€…ï¼ˆlistenerï¼‰çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥è®©è§‚å¯Ÿè€…æ„Ÿåº”åˆ° Swing ç»„å»ºçš„ä¸åŒç±»åž‹äº‹ä»¶ã€‚æ¯”æ–¹è¯´ï¼šActionListener è®©ä½ â€œå€¾å¬â€å¯èƒ½å‘ç”Ÿåœ¨æŒ‰é’®ä¸Šçš„åŠ¨ä½œï¼Œä¾‹å¦‚æŒ‰ä¸‹æŒ‰é’®ã€‚ä½ å¯ä»¥åœ¨ Swing API ä¸­æ‰¾åˆ°è®¸å¤šä¸åŒç±»åž‹çš„å€¾å¬è€…ã€‚</p><h2 id="ä¸€ä¸ªå°çš„æ”¹å˜ç”Ÿæ´»çš„ç¨‹åº">ä¸€ä¸ªå°çš„ã€æ”¹å˜ç”Ÿæ´»çš„ç¨‹åº</h2><p>æˆ‘ä»¬çš„ç¨‹åºå¾ˆç®€å•ï¼Œä½ æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œä¸Šé¢å†™ç€ &quot;Should I do it?&quot;ã€‚å½“ä½ æŒ‰ä¸‹æŒ‰é’®ï¼Œå€¾å¬è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰å¿…é¡»å›žç­”æ­¤é—®é¢˜ã€‚æˆ‘ä»¬å®žçŽ°äº†ä¸¤ä¸ªå€¾å¬è€…ï¼Œä¸€ä¸ªæ˜¯å¤©ä½¿ï¼ˆAngelListenerï¼‰ï¼Œä¸€ä¸ªæ˜¯æ¶é­”ï¼ˆDevilListenerï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwingObserverExample</span> </span>&#123;</span><br><span class="line">    JFrame frame;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SwingObserverExample example = <span class="keyword">new</span> SwingObserverExample();</span><br><span class="line">        example.go();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        frame = <span class="keyword">new</span> JFrame();</span><br><span class="line"></span><br><span class="line">        JButton button = <span class="keyword">new</span> JButton(<span class="string">"Should I do it?"</span>);</span><br><span class="line">        button.addActionListener(<span class="keyword">new</span> AngelListener());</span><br><span class="line">        button.addActionListener(<span class="keyword">new</span> DevilListener());</span><br><span class="line">        frame.getContentPane().add(BorderLayout.CENTER, button);</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œè®¾ç½®frameå±žæ€§</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">AngelListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Dont't do it, you might regret it!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">DevilListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"Come on, do it!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>è§‚å¯Ÿè€…å®šä¹‰äº†å¯¹è±¡ä¹‹é—´ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</li><li>ä¸»é¢˜ï¼ˆä¹Ÿå°±æ˜¯å¯è§‚å¯Ÿè€…ï¼‰ç”¨ä¸€ä¸ªå…±åŒçš„æŽ¥å£æ¥æ›´æ–°è§‚å¯Ÿè€…ã€‚</li><li>è§‚å¯Ÿè€…å’Œå¯è§‚å¯Ÿè€…ä¹‹é—´ç”¨æ¾è€¦åˆï¼ˆloosecouplingï¼‰æ–¹å¼ç»“åˆï¼Œå¯è§‚å¯Ÿè€…ä¸çŸ¥é“è§‚å¯Ÿè€…çš„ç»†èŠ‚ï¼ŒåªçŸ¥é“è§‚å¯Ÿè€…å®žçŽ°äº†è§‚å¯Ÿè€…æŽ¥å£ã€‚</li><li>ä½¿ç”¨æ­¤æ¨¡å¼æ—¶ï¼Œä½ å¯ä»Žè¢«è§‚å¯Ÿè€…å¤„æŽ¨æˆ–æ‹‰æ•°æ®ã€‚</li><li>æœ‰å¤šä¸ªè§‚å¯Ÿè€…æ—¶ï¼Œä¸å¯ä»¥ä¾èµ–ç‰¹å®šçš„é€šçŸ¥æ¬¡åºã€‚å¦‚æžœæˆ‘ä»¬çš„ä»£ç ä¾èµ–è¿™æ ·çš„æ¬¡åºï¼Œå°±æ˜¯é”™çš„ã€‚å› ä¸ºä¸€æ—¦è§‚å¯Ÿè€…/å¯è§‚å¯Ÿè€…çš„å®žçŽ°æœ‰æ‰€æ”¹å˜ï¼ˆæ¯”å¦‚ä¸ºä¸åŒçš„è§‚å¯Ÿè€…èµ‹äºˆä¼˜å…ˆçº§ï¼ŒæŒ‰ä¼˜å…ˆçº§å¤§å°æ¬¡åºæŽ¨é€ï¼‰ï¼Œé€šçŸ¥æ¬¡åºå°±ä¼šæ”¹å˜ï¼Œå¾ˆå¯èƒ½å°±ä¼šäº§ç”Ÿé”™è¯¯çš„ç»“æžœã€‚è¿™ç»å¯¹ä¸æ˜¯æˆ‘ä»¬æ‰€è®¤ä¸ºçš„æ¾è€¦åˆã€‚</li><li>Java æœ‰å¤šç§è§‚å¯Ÿè€…æ¨¡å¼çš„å®žçŽ°ï¼ŒåŒ…æ‹¬äº†é€šç”¨çš„ <code>java.util.Observable</code>ã€‚</li><li>è¦æ³¨æ„ <code>java.util.Observable</code> å®žçŽ°ä¸Šæ‰€å¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚</li><li>å¦‚æžœæœ‰å¿…è¦çš„è¯ï¼Œå¯ä»¥å®žçŽ°è‡ªå·±çš„ Observableï¼Œè¿™å¹¶ä¸éš¾ï¼Œä¸è¦å®³æ€•ã€‚</li><li>Swing å¤§é‡ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè®¸å¤š GUI æ¡†æž¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li><li>æ­¤æ¨¡å¼ä¹Ÿè¢«åº”ç”¨åœ¨è®¸å¤šåœ°æ–¹ï¼Œä¾‹å¦‚ï¼šJavaBeansã€RMIã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç­–ç•¥æ¨¡å¼</title>
      <link href="/notes/head-first-design-patterns/strategy-pattern/"/>
      <url>/notes/head-first-design-patterns/strategy-pattern/</url>
      
        <content type="html"><![CDATA[<h1 id="å¯¼å…¥é¸­å­æ¸¸æˆ">å¯¼å…¥ï¼šé¸­å­æ¸¸æˆ</h1><p>é¸­å­æ¸¸æˆï¼šæ¸¸æˆä¸­ä¼šå‡ºçŽ°å„ç§é¸­å­ï¼Œä¸€è¾¹æ¸¸æ³³æˆæ°´ï¼Œä¸€è¾¹å‘±å‘±å«ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNABYK9cShL7CfA1IM9YPdQsW2MSNbcRbWHZLCLQr2IcPnGKvY9KGuDxKa8p-bLa5VN-7bZhLFrqvuFglbQUks9xkdFPksyzdcgLorNCavYSN52hw9EJc9HIbmE-2cA5I3D3zTCkt5ygPdCzO_txt_wP8j2hLmZK6fAHcfYKHetBK8JMDf4j2hw9w2w7gnhEtvx6dFEYOydR0HXFfN0pNYDllPoeNFPwq3UX1iFDX8cnfTNMHF8OaYkHXP5EuS0000"><p>çŽ°åœ¨æˆ‘ä»¬è®©é¸­å­ä¼šé£žã€‚åªéœ€è¦åœ¨ Duck ç±»ä¸­åŠ ä¸Š <code>fly()</code> æ–¹æ³•ï¼Œç„¶åŽæ‰€æœ‰é¸­å­éƒ½ä¼šç»§æ‰¿ <code>fly()</code>ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNABYK9cShL7CfA1IM9YPdQsW2MSNbcRbWXfPMMawbXgQM5f1T3TDHgv2IMLoGarW9LbATcrgIaPzIgw2lh_1onzgdQoSydzNoj7NRaztJdatR-MppLAvQhkISnE9Y1T_4d9p4eXIuVN1J5Af1cfykcVPYUTEp6UkVxzx_TCaMXLgung3Kb8pKH28qxbg4fh4q2UXjT0z2TBrOrlPyzhHd7HEUJjW8GlshWHfnc_rivSBdizO1FGWs7coaJOskBhAda4IHN8mi2dSELrv-IQf2JcfQYK9-6ZW6h1IURT_zj6i1EBmX0GS0"><p>ä½†æ˜¯ï¼Œå¯æ€•çš„é—®é¢˜å‘ç”Ÿäº†ï¼Œæœ‰å¾ˆå¤šâ€œæ©¡çš®é¸­å­â€é£žæ¥é£žåŽ»ã€‚åœ¨è¶…ç±»ä¸­åŠ ä¸Š <code>fly()</code>ï¼Œå°±ä¼šå¯¼è‡´æ‰€æœ‰çš„å­ç±»éƒ½å…·å¤‡ <code>fly()</code>ï¼Œè¿žé‚£äº›ä¸è¯¥å…·å¤‡ <code>fly()</code> çš„å­ç±»ä¹Ÿæ— æ³•å…é™¤ã€‚</p><p><strong>å½“æ¶‰åŠâ€œç»´æŠ¤â€æ—¶ï¼Œä¸ºäº†â€œå¤ç”¨â€ï¼ˆreuseï¼‰ç›®çš„è€Œä½¿ç”¨ç»§æ‰¿ï¼Œç»“å±€å¹¶ä¸å®Œç¾Žã€‚</strong></p><a id="more"></a><h2 id="åˆ©ç”¨ç»§æ‰¿">åˆ©ç”¨ç»§æ‰¿</h2><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNABYK9cShL7CfA1IM9YPdQsW2MSNbcRbWXfPMMawbXgQM5f1T3TDHgv2IMLoGarW9LbATcrgIaPzIgw2lh_1onzgdQoSydzNoj7NRaztJdatR-MppLAvQhkISnE9Y1T_4d9p4eXIuVN1J5Af1cfykcVPYUTEp6UkVxzx_TCaMXLgung3Kb8pKH28qxbg4fh4q2UXjT0z2TBrOrlPyzhHd7HEUJjW8GlshWHfnc_rivSBdizO1FGXM1GuLP7FUx-bvihlXoSwE9xkwNpRlVRAZzsdZB2INkAGcvrVYSmWk0p1Sz6BznfTBjvBX4B3jDZMwkiWHWIIA5Ch8el0WH1A4-mO0"><p>é¸­å­çš„è¡Œä¸ºåœ¨å­ç±»é‡Œä¸æ–­åœ°æ”¹å˜ï¼Œå¹¶ä¸”è®©æ‰€æœ‰çš„å­ç±»éƒ½æœ‰è¿™äº›è¡Œä¸ºæ˜¯ä¸æ°å½“çš„ã€‚ä¾‹å­ï¼Œæ©¡çš®é¸­å­ä¸ä¼šé£žï¼Œå‡é¸­å­ä¸ä¼šé£žä¹Ÿä¸ä¼šå«ã€‚æ¯å½“æœ‰æ–°çš„é¸­å­ç±»å‡ºçŽ°ï¼Œéƒ½è¦è¢«è¿«æ£€æŸ¥å¹¶å¯èƒ½éœ€è¦è¦†ç›– <code>fly()</code> å’Œ <code>quark()</code>ã€‚</p><p>åˆ©ç”¨ç»§æ‰¿æ¥æä¾› Duck çš„è¡Œä¸ºï¼Œè¿™ä¼šå¯¼è‡´ä¸‹åˆ—å“ªäº›ç¼ºç‚¹ï¼Ÿï¼ˆå¤šé€‰ï¼‰</p><ul><li>[x] A. ä»£ç åœ¨å¤šä¸ªå­ç±»ä¸­é‡å¤ã€‚ï¼ˆRubberDuck å’Œ DecoyDuck éƒ½ä¸ä¼šé£žï¼‰</li><li>[x] B. è¿è¡Œæ—¶çš„è¡Œä¸ºä¸å®¹æ˜“æ”¹å˜ã€‚ï¼ˆé™¤éžä¿®æ”¹ä»£ç ï¼‰</li><li>[ ] C. æˆ‘ä»¬ä¸èƒ½è®©é¸­å­è·³èˆžã€‚ï¼ˆå¯ä»¥ï¼Œå°±å¦‚æˆ‘ä»¬è®©é¸­å­ä¼šâ€œé£žâ€ï¼‰</li><li>[x] D. å¾ˆéš¾çŸ¥é“æ‰€æœ‰é¸­å­çš„å…¨éƒ¨è¡Œä¸ºã€‚ï¼ˆå”è€é¸­ï¼šæˆ‘æƒ³è¯´å¥è¯ï¼‰</li><li>[ ] E. é¸­å­ä¸èƒ½åŒæ—¶åˆé£žåˆå«ã€‚ï¼ˆMallardDuck å’Œ RedheadDuck å¯ä»¥åˆé£žåˆå«ï¼‰</li><li>[x] F. æ”¹å˜ä¼šç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œé€ æˆå…¶ä»–é¸­å­ä¸æƒ³è¦çš„æ”¹å˜ã€‚ï¼ˆæ©¡çš®é¸­ï¼šæˆ‘æœ¬ä¸æƒ³é£žï¼‰</li></ul><h2 id="åˆ©ç”¨æŽ¥å£">åˆ©ç”¨æŽ¥å£</h2><img src="http://www.plantuml.com/plantuml/svg/bL3B3W4n5DttA-wI1Nx0Kkmi-8CxxPLfj1vj9p9XTknjMFW7AuaGl-CHVy6C6FM8nAuzhtjoGYa8IFTT39fqG8Q5ASAbuOeO1jOPv0vg4U_0Y07OeTI5ukqnUd0926dx2kCxhCc5FP50fGANxUgucfsNa-DqSzWlJelTQJrd2PDTHwQDdA2kOWmKPSbjbIRuR3D2tidvGVhB55oXjT10fT28l9dVufxrwMcH20d_z4J1RPQlbdTfZNWl_g9CM0PMnwMINzj3lM8-cf_smFm8UwnN7PVBBxalX1_zNFJ3yqRzS3rRNG40"><p>Flyable ä¸Ž Quackable æŽ¥å£ä¸€å¼€å§‹ä¼¼ä¹Žè¿˜æŒºä¸é”™ï¼Œè§£å†³äº†é—®é¢˜ï¼ˆåªæœ‰ä¼šé£žçš„é¸­å­æ‰ç»§æ‰¿ Flyableï¼‰ï¼Œ<strong>ä½†æ˜¯ Java æŽ¥å£ä¸å…·æœ‰å®žçŽ°ä»£ç ï¼Œæ‰€ä»¥ç»§æ‰¿æŽ¥å£æ— æ³•è¾¾åˆ°ä»£ç çš„å¤ç”¨ã€‚</strong>è¿™æ„å‘³ç€ï¼šæ— è®ºä½•æ—¶ä½ éœ€è¦ä¿®æ”¹æŸä¸ªè¡Œä¸ºï¼Œä½ å¿…é¡»å¾—å¾€ä¸‹è¿½è¸ªå¹¶åœ¨æ¯ä¸€ä¸ªå®šä¹‰æ­¤è¡Œä¸ºçš„ç±»ä¸­ä¿®æ”¹å®ƒï¼Œä¸€ä¸å°å¿ƒï¼Œå¯èƒ½ä¼šé€ æˆæ–°çš„é”™è¯¯ã€‚</p><h1 id="å°è£…å˜åŒ–">å°è£…å˜åŒ–</h1><blockquote><p>æ‰¾å‡ºåº”ç”¨ä¸­å¯èƒ½éœ€è¦å˜åŒ–ä¹‹å¤„ï¼ŒæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œé‚£äº›ä¸éœ€è¦å˜åŒ–çš„ä»£ç æ··åœ¨ä¸€èµ·ã€‚</p></blockquote><p>æˆ‘ä»¬çŸ¥é“ Duck ç±»å†…çš„ <code>fly()</code> å’Œ <code>quack()</code> ä¼šéšç€é¸­å­çš„ä¸åŒè€Œæ”¹å˜ã€‚ä¸ºäº†è¦æŠŠè¿™ä¸¤ä¸ªè¡Œä¸ºä»Ž Duck ç±»ä¸­åˆ†å¼€ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬ä»Ž Duck ç±»ä¸­å–å‡ºæ¥ï¼Œå»ºç«‹ä¸€ç»„æ–°ç±»æ¥ä»£è¡¨æ¯ä¸ªè¡Œä¸ºã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONAxZbL8PdbcI4P-Qb5ojKSoaefELKLjSgL2lewoiyNJVlUT-6bplMFbqxuUNYUIyMzYZKSjKYDFhbXoTMmZHfQ48qFTdTy6HdnylclKzsz3vjdFL-Jm-GyMJFBA01IBe3InEJiy5Q2q4icEQd4pU2KFzg9AN1XQMfYLZKFbkvyFciTH3NFPsm4OHGzFcMbgJYi0QN6w460000"><h1 id="é’ˆå¯¹æŽ¥å£ç¼–ç¨‹">é’ˆå¯¹æŽ¥å£ç¼–ç¨‹</h1><p>æˆ‘ä»¬å¸Œæœ›ä¸€åˆ‡èƒ½æœ‰å¼¹æ€§ï¼Œæ¯•ç«Ÿï¼Œæ­£æ˜¯å› ä¸ºä¸€å¼€å§‹é¸­å­è¡Œä¸ºæ²¡æœ‰å¼¹æ€§ï¼Œæ‰è®©æˆ‘ä»¬èµ°ä¸ŠçŽ°åœ¨è¿™æ¡è·¯ã€‚æˆ‘ä»¬è¿˜æƒ³èƒ½å¤Ÿâ€œæŒ‡å®šâ€è¡Œä¸ºåˆ°é¸­å­å®žä¾‹ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è¦ç”Ÿäº§ä¸€ä¸ªæ–°çš„ç»¿å¤´é¸­å®žä¾‹ï¼Œå¹¶æŒ‡å®šç‰¹å®šâ€œç±»åž‹â€çš„é£žè¡Œè¡Œä¸ºç»™å®ƒã€‚å¹²è„†é¡ºä¾¿è®©é¸­å­çš„è¡Œä¸ºå¯ä»¥åŠ¨æ€åœ°æ”¹å˜å¥½äº†ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨é¸­å­ç±»ä¸­åŒ…å«è®¾è®¡è¡Œä¸ºçš„æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨â€œè¿è¡Œæ—¶â€åŠ¨æ€åœ°â€œæ”¹å˜â€ç»¿å¤´é¸­çš„é£žè¡Œè¡Œä¸ºã€‚</p><blockquote><p>é’ˆå¯¹æŽ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®žçŽ°ç¼–ç¨‹ã€‚</p></blockquote><p>â€œé’ˆå¯¹æŽ¥å£ç¼–ç¨‹â€œçœŸæ­£çš„æ„æ€æ˜¯â€é’ˆå¯¹è¶…ç±»åž‹ï¼ˆsupertypeï¼‰ç¼–ç¨‹â€œã€‚â€é’ˆå¯¹æŽ¥å£ç¼–ç¨‹â€œï¼Œå…³é”®å°±åœ¨äºŽå¤šæ€ã€‚åˆ©ç”¨å¤šæ€ï¼Œç¨‹åºå¯ä»¥é’ˆå¯¹è¶…ç±»åž‹ç¼–ç¨‹ï¼Œæ‰§è¡Œæ—¶ä¼šæ ¹æ®å®žé™…æƒ…å†µæ‰§è¡Œåˆ°çœŸæ­£çš„è¡Œä¸ºï¼Œä¸ä¼šè¢«ç»‘æ­»åœ¨è¶…ç±»åž‹çš„è¡Œä¸ºä¸Šã€‚</p><p>æˆ‘ä»¬åˆ©ç”¨æŽ¥å£ä»£è¡¨æ¯ä¸ªè¡Œä¸ºï¼Œæ¯”æ–¹è¯´ï¼ŒFlyBehavior ä¸Ž QuackBehavior è€Œè¡Œä¸ºçš„æ¯ä¸ªå®žçŽ°éƒ½å°†å®žçŽ°å…¶ä¸­ä¸€ä¸ªæŽ¥å£ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/VL4zRi8m5DvzYZU60JW0b05Lx1p1SLuKYvWaZW55KJROMSh07PYG45MlmuzwYpfEIkqCtUplvttFdoCU8A18LG42XO-IH3N2k6Gn4hvKA4FA46PnCSM8hdaYOJn-uPC9b0GWZ0klHofBFrzHjlZ7aTMyyL0_Lv8o1UyhjZ2SdHN-dJNZJiticsRp3HTw943vExE2WETfJ0i3vwYiqPuJu_UWjCFWJMCZg1gRa-jrjZ1MPnTjpbfpgb-TI35ldjiL3jeQ7EsiBjFTPc0ARbIbG1KbGGN38NnVJ_VJ_ddStdUNszVXSVXyd3zqfvts-trJBd4-iGL_0000"><p>è¿™æ ·çš„åšæ³•è¿¥å¼‚äºŽä»¥å¾€ï¼Œä»¥å‰çš„åšæ³•æ˜¯ï¼šè¡Œä¸ºæ¥è‡ª Duck è¶…ç±»çš„å…·ä½“å®žçŽ°ï¼Œæˆ–æ˜¯ç»§æ‰¿æŸä¸ªæŽ¥å£å¹¶ç”±å­ç±»è‡ªè¡Œå®žçŽ°è€Œæ¥ã€‚è¿™ä¸¤ç§åšæ³•éƒ½æ˜¯ä¾èµ–äºŽâ€å®žçŽ°â€œï¼Œæˆ‘ä»¬è¢«å®žçŽ°ç»‘å¾—æ­»æ­»çš„ï¼Œæ²¡åŠžæ³•æ›´æ”¹è¡Œä¸ºï¼ˆé™¤éžå†™æ›´å¤šä»£ç ï¼‰ã€‚</p><p>åœ¨æˆ‘ä»¬çš„æ–°è®¾è®¡ä¸­ï¼Œé¸­å­çš„å­ç±»å°†ä½¿ç”¨æŽ¥å£æ‰€è¡¨ç¤ºçš„è¡Œä¸ºï¼Œæ‰€ä»¥å®žé™…çš„â€œå®žçŽ°â€ä¸ä¼šè¢«ç»‘æ­»åœ¨é¸­å­çš„å­ç±»ä¸­ã€‚ç‰¹å®šçš„å…·ä½“è¡Œä¸ºç¼–å†™åœ¨å®žçŽ°äº† FlyBehavior ä¸Ž QuackBehavior çš„ç±»ä¸­ã€‚</p><h1 id="å®žçŽ°é¸­å­çš„è¡Œä¸º">å®žçŽ°é¸­å­çš„è¡Œä¸º</h1><p>åœ¨æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæŽ¥å£ï¼ŒFlyBehavior å’Œ QuackBehaviorï¼Œè¿˜æœ‰å®ƒä»¬å¯¹åº”çš„ç±»ï¼Œè´Ÿè½½å®žçŽ°å…·ä½“çš„è¡Œä¸ºã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaScNcbQGMfIKcfoguvLGwfMOabcNc5odOsC35xUmKghaK5D9oAZKqkMgvadCIYuj1QiCpIpB2C_FIYs7IrRKArGhw-WfFryrxthVXvOwrJzTEUBbutek5FGgro1hzyiCJAn5cGZGzsTtmP6V7o-QzJtRqFcsSzNvF3v3nPCyie05WtGXd1fOc9cVZSMWXI1x9gM3ro39GLqxS24Bzgv4S5rnOcfg8HUspbGkVpre7yT7J2Hj124MVRsb9AWvhSFaBPW1AeDVewQ64B5PPSF1neOK2I0uiX4q2uYriCd270m00"><p>è¿™æ ·çš„è®¾è®¡ï¼Œå¯ä»¥è®©é£žè¡Œå’Œå‘±å‘±å«çš„åŠ¨ä½œè¢«å…¶ä»–çš„å¯¹è±¡å¤ç”¨ï¼Œå› ä¸ºè¿™äº›è¡Œä¸ºå·²ç»ä¸Žé¸­å­ç±»æ— å…³äº†ã€‚</p><p>è€Œæˆ‘ä»¬å¯ä»¥æ–°å¢žä¸€äº›è¡Œä¸ºï¼Œä¸ä¼šå½±å“åˆ°æ—¢æœ‰çš„è¡Œä¸ºç±»ï¼Œä¹Ÿä¸ä¼šå½±å“â€œä½¿ç”¨â€åˆ°é£žè¡Œè¡Œä¸ºçš„é¸­å­ç±»ã€‚</p><p><strong>é—®</strong>ï¼šç”¨ä¸€ä¸ªç±»ä»£è¡¨ä¸€ä¸ªè¡Œä¸ºï¼Œæ„Ÿè§‰ä¼¼ä¹Žæœ‰ç‚¹å¥‡æ€ªã€‚ç±»ä¸æ˜¯åº”è¯¥ä»£è¡¨æŸç§â€œä¸œè¥¿â€å—ï¼Ÿç±»ä¸æ˜¯åº”è¯¥åŒæ—¶å…·å¤‡çŠ¶æ€â€œä¸Žâ€è¡Œä¸ºå—ï¼Ÿ</p><p><strong>ç­”</strong>ï¼šåœ¨ OO ç³»ç»Ÿä¸­ï¼Œæ˜¯çš„ç±»ä»£è¡¨çš„ä¸œè¥¿ä¸€èˆ¬éƒ½æ˜¯æ—¢æœ‰çŠ¶æ€ï¼ˆå®žä¾‹å˜é‡ï¼‰åˆæœ‰æ–¹æ³•ã€‚åªæ˜¯åœ¨æœ¬ä¾‹ä¸­ï¼Œç¢°å·§â€œä¸œè¥¿â€æ˜¯ä¸ªè¡Œä¸ºã€‚ä½†æ˜¯å³ä½¿æ˜¯è¡Œä¸ºï¼Œä¹Ÿä»ç„¶å¯ä»¥æœ‰çŠ¶æ€å’Œæ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œé£žè¡Œçš„è¡Œä¸ºå¯ä»¥å…·æœ‰å®žä¾‹å˜é‡ï¼Œè®°å½•é£žè¡Œè¡Œä¸ºçš„å±žæ€§ï¼ˆæ¯ç§’ç¿…è†€æ‹åŠ¨å‡ ä¸‹ï¼Œæœ€å¤§é«˜åº¦å’Œé€Ÿåº¦ç­‰ï¼‰ã€‚</p><h1 id="æ•´ä½“æ ¼å±€">æ•´ä½“æ ¼å±€</h1><img src="http://www.plantuml.com/plantuml/svg/ZLFBJi905DttA-vI5y0F41R6iDD4NR0Usi4sjhJqeMcWYKPDN8ZYGXSiID2LCHADYOBWtxGWAt_1wRIqCrgYoP2KS-uzzp5dP4N2W3N3Ta73MXMRWXmYecAAAXOC9EwXNGppkzvd_vmSV_WEJG50gTlOh24HGrbrrx2CzXNTX68nmKib6WTGKzsLLVBbaP-e8iiACogABLUK-gwL1ZKzQ4AX0C6WDxjucWyVWyTEL9QcSkcRUWMvh7wKweyF_T7P_FZ37xQ3e-xNXBJRzYTT8XDhUCb4mU1sUlP6DL3Liaqash3kY7knAZjLBVsct9P3D1AsmVwZl7MWQ7HaWEP2smD9iGmLkJ5Xa2tffaQbUAYiBc8iR3Djf21NVr58mxQiIrwuXcXti-v9SFhgZs-cDwFfopMtmWsagiYKc7dPxjAuRIp96FqZpgaIv_mPjev5tLqQnTpDrNDuBXyo3SUlFyjoZMIhQMsQnVEntnR5VjXif-5Wb9anlU_FkeDeoq7dEJo_iZSS6oyjkSodgOmdSC-gbSzphoQJfOz2-B6TaADG5X6DcCKaxGlqkegjN8ur3OCo5c7Hn10Cc5n_XELAx2kBiHn1kNw-0G00"><h1 id="å¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿">å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿</h1><p>æ¯ä¸€é¸­å­éƒ½æœ‰ä¸€ä¸ª FlyBehavior å’Œä¸€ä¸ª QuackBehaviorï¼Œå¥½å°†é£žè¡Œå’Œå‘±å‘±å«å§”æ‰˜ç»™å®ƒä»¬ä»£ä¸ºå¤„ç†ã€‚è¿™å°±æ˜¯ç»„åˆï¼ˆcompositionï¼‰ã€‚è¿™ç§åšæ³•å’Œâ€œç»§æ‰¿â€ä¸åŒçš„åœ°æ–¹åœ¨äºŽï¼Œé¸­å­çš„è¡Œä¸ºä¸æ˜¯ç»§æ‰¿æ¥çš„ï¼Œè€Œæ˜¯å’Œé€‚å½“çš„è¡Œä¸ºå¯¹è±¡â€œç»„åˆâ€æ¥çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æŠ€å·§ã€‚</p><blockquote><p>å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ã€‚</p></blockquote><p>ä½¿ç”¨ç»„åˆå»ºç«‹ç³»ç»Ÿå…·æœ‰å¾ˆå¤§çš„å¼¹æ€§ï¼Œä¸ä»…å¯å°†ç®—æ³•æ—å°è£…æˆç±»ï¼Œæ›´å¯ä»¥â€œåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ”¹å˜è¡Œä¸ºâ€ï¼Œåªè¦ç»„åˆçš„è¡Œä¸ºå¯¹è±¡ç¬¦åˆæ­£ç¡®çš„æŽ¥å£æ ‡å‡†å³å¯ã€‚</p><h1 id="å®šä¹‰ç­–ç•¥æ¨¡å¼">å®šä¹‰ç­–ç•¥æ¨¡å¼</h1><p>ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºŽä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA0Ia5gNb5-Mc5YbKSoae10C5IrBJAnMAeGoWM3LCRQr20KInXYPNBLToJc9niO9pVbvoKMf9AgenoEhWDi7DhaOrDB6W8ASIYv4mzOvW3OHKEQ6fGZZ8faPN5zETI0fqxU1kir9GUZQdyycEXYSxLYbnmLsCOWJSNGJadRZoyajI5OeoqpDA5FBJaEnush_-oUwbpsQiVzQrzyN6XSytxdw_f-V9pla8yRwbJ_iNFsve0W00"><h1 id="è¦ç‚¹">è¦ç‚¹</h1><ul><li>çŸ¥é“ OO åŸºç¡€ï¼ˆå³<strong>æŠ½è±¡ã€å°è£…ã€å¤šæ€å’Œç»§æ‰¿</strong>ï¼‰ï¼Œå¹¶ä¸è¶³ä»¥è®©ä½ è®¾è®¡å‡ºè‰¯å¥½çš„ OO ç³»ç»Ÿã€‚</li><li>è‰¯å¥½çš„ OO è®¾è®¡å¿…é¡»å…·å¤‡<strong>å¯å¤ç”¨ã€å¯æ‰©å……ã€å¯ç»´æŠ¤</strong>ä¸‰ä¸ªç‰¹æ€§ã€‚</li><li>æ¨¡å¼å¯ä»¥è®©æˆ‘ä»¬å»ºé€ å‡ºå…·æœ‰è‰¯å¥½ OO è®¾è®¡è´¨é‡çš„ç³»ç»Ÿã€‚</li><li>æ¨¡å¼è¢«è®¤ä¸ºæ˜¯åŽ†ç»éªŒè¯çš„ OO è®¾è®¡ç»éªŒã€‚</li><li>æ¨¡å¼ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯é’ˆå¯¹è®¾è®¡é—®é¢˜çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬åº”ç”¨åˆ°ç‰¹å®šçš„åº”ç”¨ä¸­ã€‚</li><li>å¤§å¤šæ•°çš„æ¨¡å¼å’ŒåŽŸåˆ™ï¼Œéƒ½ç€çœ¼äºŽè½¯ä»¶å˜åŒ–çš„ä¸»é¢˜ã€‚</li><li>å¤§å¤šæ•°çš„æ¨¡å¼éƒ½å…è®¸ç³»ç»Ÿå±€éƒ¨æ”¹å˜ç‹¬ç«‹äºŽå…¶ä»–éƒ¨åˆ†ã€‚</li><li>æˆ‘ä»¬å¸¸æŠŠç³»ç»Ÿä¸­ä¼šå˜åŒ–çš„éƒ¨åˆ†æŠ½å‡ºæ¥å°è£…ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Head First Design Patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Range Sum Query</title>
      <link href="/programming/leetcode/range-sum-query/"/>
      <url>/programming/leetcode/range-sum-query/</url>
      
        <content type="html"><![CDATA[<h1 id="range-sum-query---immutable">Range Sum Query - Immutable</h1><p>Given an integer array <em>nums</em>, find the sum of the elements between indices <em>i</em> and <em>j (i â‰¤ j)</em>, inclusive.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given nums = [-2, 0, 3, -5, 2, -1]</span><br><span class="line"></span><br><span class="line">sumRange(0, 2) -&gt; 1</span><br><span class="line">sumRange(2, 5) -&gt; -1</span><br><span class="line">sumRange(0, 5) -&gt; -3</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ol type="1"><li>You may assume that the array does not change.</li><li>There are many calls to <em>sumRange</em> function.</li></ol><h2 id="caching-on2-space">Caching: O(n^2) Space</h2><p>Imagine that <em>sumRange</em> is called one thousand times with the exact same arguments. How could we speed that up?</p><p>We could trade in extra space for speed. By pre-computing all range sum possibilities and store its results in a hash table, we can speed up the query to constant time.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2) time pre-computing + O(1) time per query</span></span><br><span class="line"><span class="comment"># Space: O(n^2)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumArray</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, nums: list)</span>:</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        self.data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            s = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i, n):</span><br><span class="line">                s += nums[j]</span><br><span class="line">                self.data[i, j] = s</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sumRange</span><span class="params">(self, i: int, j: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.data[i, j]</span><br></pre></td></tr></table></figure><h2 id="caching-on-space">Caching: O(n) Space</h2><p>Imagine that we pre-compute the cummulative sum from index <code>0</code> to <code>k</code>. Could we use this information to derive <code>sumRange(i, j)</code>?</p><p>Let us define <code>sum[k]</code> as the cumulative sum for <code>nums[0 .. k-1]</code>: <code>sumRange(i, j) = sum[j + 1] - sum[i]</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n) time pre-computing and O(1) time per query</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumArray</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, nums: list)</span>:</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        self.sum = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(n):</span><br><span class="line">            self.sum[k + <span class="number">1</span>] = self.sum[k] + nums[k]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sumRange</span><span class="params">(self, i: int, j: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.sum[j + <span class="number">1</span>] - self.sum[i]</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="range-sum-query-2d---immutable">Range Sum Query 2D - Immutable</h1><p>Given a 2D matrix <em>matrix</em>, find the sum of the elements inside the rectangle defined by its upper left corner <em>(row1, col1)</em> and lower right corner <em>(row2, col2)</em>.</p><p><img src="/uploads/image/leetcode/range_sum_query_2d.png"></p><p>The above rectangle (with the red border) is defined by (row1, col1) = <strong>(2, 1)</strong> and (row2, col2) = <strong>(4, 3)</strong>, which contains sum = <strong>8</strong>.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given matrix = [</span><br><span class="line">  [3, 0, 1, 4, 2],</span><br><span class="line">  [5, 6, 3, 2, 1],</span><br><span class="line">  [1, 2, 0, 1, 5],</span><br><span class="line">  [4, 1, 0, 1, 7],</span><br><span class="line">  [1, 0, 3, 0, 5]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">sumRegion(2, 1, 4, 3) -&gt; 8</span><br><span class="line">sumRegion(1, 1, 2, 2) -&gt; 11</span><br><span class="line">sumRegion(1, 2, 2, 4) -&gt; 12</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ol type="1"><li>You may assume that the matrix does not change.</li><li>There are many calls to <em>sumRegion</em> function.</li><li>You may assume that <em>row1 â‰¤ row2</em> and <em>col1 â‰¤ col2</em>.</li></ol><h2 id="caching-rows">Caching Rows</h2><p>Remember from the 1D version, try to see the 2D matrix as <em>m</em> rows of 1D arrays. To find the region sum, we just accumulate the sum in the region row by row.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn) time pre-computing + O(m) time per query</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumArray</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, matrix: list)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m, n = len(matrix), len(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                self.dp[i][j + <span class="number">1</span>] = self.dp[i][j] + matrix[i][j]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sumRegion</span><span class="params">(self, row1: int, col1: int, row2: int, col2: int)</span> -&gt; int:</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(row1, row2 + <span class="number">1</span>):</span><br><span class="line">            res += self.dp[i][col2 + <span class="number">1</span>] - self.dp[i][col1]</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="caching-smarter">Caching Smarter</h2><p>We used a cumulative sum array in the 1D version. We notice that the cumulative sum is computed with respect to the origin at index 0. Extending this analogy to the 2D case, we could pre-compute a cumulative region sum with respect to the origin at (0, 0).</p><p><img src="/uploads/image/leetcode/sum_od.png"> <img src="/uploads/image/leetcode/sum_ob.png"> <img src="/uploads/image/leetcode/sum_oc.png"> <img src="/uploads/image/leetcode/sum_oa.png"></p><p><code>sum(A, D) = sum(O, D) - sum(O, B) - sum(O, C) + sum(O, A)</code></p><p>Let us define <code>dp[i][j] = sumRegion(0, 0, i - 1, j - 1)</code>, the sum of region that has upper left corner <code>(0, 0)</code> and lower right corner <code>(i - 1, j - 1)</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn) time pre-computing and O(1) time per query</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumArray</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, matrix: list)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m, n = len(matrix), len(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                self.dp[i + <span class="number">1</span>][j + <span class="number">1</span>] = self.dp[i + <span class="number">1</span>][j] + self.dp[i][j + <span class="number">1</span>] \</span><br><span class="line">                                        + matrix[i][j] - self.dp[i][j]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sumRegion</span><span class="params">(self, row1: int, col1: int, row2: int, col2: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.dp[row2 + <span class="number">1</span>][col2 + <span class="number">1</span>] - self.dp[row2 + <span class="number">1</span>][col1] \</span><br><span class="line">               - self.dp[row1][col2 + <span class="number">1</span>] + self.dp[row1][col1]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Longest Increasing Subsequence</title>
      <link href="/programming/leetcode/longest-increasing-subsequence/"/>
      <url>/programming/leetcode/longest-increasing-subsequence/</url>
      
        <content type="html"><![CDATA[<p>Given an unsorted array of integers, find the length of longest increasing subsequence.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [10,9,2,5,3,7,101,18]</span><br><span class="line">Output: 4</span><br><span class="line">Explanation: The longest increasing subsequence is [2,3,7,101], therefore the lenght is 4.</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ul><li>There may be more than on LIS combination, it is only necessary for you to return the length.</li><li>Your algorithm shoud run in O(n^2) complexity.</li></ul><p><strong>Follow up:</strong> Could you improve it to O(nlog(n)) time complexity?</p><h1 id="recursion">Recursion</h1><p>Define a function <code>helper(i)</code> returns the length of LIS that ends at <code>i</code>. Then answer of an input shoule be <code>max([helper(i) | 0 &lt;= i &lt; n])</code>.</p><p>To calculate <code>helper(i)</code>, we use a variable <code>res</code> which initialized to 1 to store the result. Then we find every number <code>nums[j] &lt; nums[i], 0 &lt;= j &lt; i</code>, let <code>res = max(res, helper(j) + 1)</code>.</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(2^n), every num is checked twice: included and not included.</span></span><br><span class="line"><span class="comment"># Space: O(n^2)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(i)</span>:</span></span><br><span class="line">            res = <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">                <span class="keyword">if</span> nums[j] &lt; nums[i]:</span><br><span class="line">                    res = max(res, helper(j) + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> max(helper(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)))</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Save results of <code>helper(i)</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        n, res = len(nums), <span class="number">1</span></span><br><span class="line">        dp = [<span class="number">1</span>] * n</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">                <span class="keyword">if</span> nums[j] &lt; nums[i]:</span><br><span class="line">                    dp[i] = max(dp[i], dp[j] + <span class="number">1</span>)</span><br><span class="line">            res = max(res, dp[i])</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="dp-binary-search">DP + Binary Search</h1><p>In this approach, <code>dp</code> array stores the current longest increasing &quot;subsequence&quot;, and length of <code>dp</code> is 0 at the beginning. We scan the array from left to right, finding the correct position <code>i</code> for current item by binary search:</p><ul><li>If it happens to be the end of <code>dp</code> array (<code>i == len(dp)</code>), then we append it to then end of <code>dp</code> and increase our result <code>res</code> by 1, because we find a longer &quot;subsequence&quot;.</li><li>If not, just set current item to <code>dp[i]</code>, don't increase the <code>res</code>.</li></ul><p>Consider the example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [0, 8, 4, 12, 2, 13]</span><br><span class="line">Output: 4</span><br><span class="line">Explanation: LIS is [0, 4, 12, 13]</span><br><span class="line"></span><br><span class="line">dp: [0]             # i = 0, i is the insertion position of 0</span><br><span class="line">dp: [0, 8]          # i = 1</span><br><span class="line">dp: [0, 4]          # i = 1</span><br><span class="line">dp: [0, 4, 12]      # i = 2</span><br><span class="line">dp: [0, 2, 12]      # i = 1</span><br><span class="line">dp: [0, 2, 12, 13]  # i = 3</span><br><span class="line"></span><br><span class="line">dp is not a subsequence, but has the same length with LIS.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bisect <span class="keyword">import</span> bisect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n log(n))</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLIS</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [<span class="number">0</span>] * len(nums)</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">            i = bisect(dp, num, <span class="number">0</span>, res)</span><br><span class="line">            dp[i] = num</span><br><span class="line">            <span class="keyword">if</span> i == res:</span><br><span class="line">                res += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> binary search </tag>
            
            <tag> recursion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Perfect Squares</title>
      <link href="/programming/leetcode/perfect-squares/"/>
      <url>/programming/leetcode/perfect-squares/</url>
      
        <content type="html"><![CDATA[<p>Given a positive integer <em>n</em>, find the least number of perfect square numbers (for example, <code>1, 4, 9, 16, ...</code>) which sum to <em>n</em>.</p><p>Example 1:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Input: n = <span class="number">12</span></span><br><span class="line">Output: <span class="number">3</span></span><br><span class="line">Explanation: <span class="number">12</span> = <span class="number">4</span> + <span class="number">4</span> + <span class="number">4.</span></span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Input: n = <span class="number">13</span></span><br><span class="line">Output: <span class="number">2</span></span><br><span class="line">Explanation: <span class="number">13</span> = <span class="number">4</span> + <span class="number">9.</span></span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp[i]</code> denotes the least number of perfect square numbers which sum to <code>i</code>.</p><p>We can't find the largest square number <code>j &lt;= i</code>, then let <code>dp[i] = dp[i - j] + 1</code>. See example 1, the correct answer is <code>dp[12] = 3</code>. If we let <code>j = 9</code>, then <code>dp[12] = 1 + dp[12 - 9] = 1 + 3 = 4</code>, which is wrong. We should check every <code>j &lt;= i</code> like below.</p><p>If <code>1 &lt;= j &lt;= i</code> and <code>j</code> is a square number, then <code>i</code> can be summed by <code>j</code> and <code>i - j</code>, there are <code>1 + dp[i - j]</code> numbers.</p><a id="more"></a><p>Base case: <code>dp[0] = 0, dp[1] = 1</code>.</p><p>Induction rule: <code>dp[i] = min(dp[i - j] + 1 | 1 &lt;= j &lt;= i)</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numSquares</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        dp = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            j, res = <span class="number">1</span>, i</span><br><span class="line">            <span class="keyword">while</span> j * j &lt;= i:</span><br><span class="line">                res = min(res, dp[i - j * j] + <span class="number">1</span>)</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            dp.append(res)</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ugly Number</title>
      <link href="/programming/leetcode/ugly-number/"/>
      <url>/programming/leetcode/ugly-number/</url>
      
        <content type="html"><![CDATA[<h1 id="ugly-number-i">Ugly Number I</h1><p>Write a program to check whether a given number is an ugly number.</p><p>Ugly numbers are <strong>positive numbers</strong> whose prime factors only include <code>2, 3, 5</code>.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 6</span><br><span class="line">Output: true</span><br><span class="line">Explanation: 6 = 2 * 3</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 8</span><br><span class="line">Output: true</span><br><span class="line">Explanation: 8 = 2 * 2 * 2</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 14</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ol type="1"><li><code>1</code> is typically treated as ugly number.</li><li>Input is within the 32-bit signed integer range: <code>[-2^31, 2^31 - 1]</code>.</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isUgly</span><span class="params">(self, num: int)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>):</span><br><span class="line">            <span class="keyword">while</span> num % x == <span class="number">0</span> &lt; num:</span><br><span class="line">                num /= x</span><br><span class="line">        <span class="keyword">return</span> num == <span class="number">1</span></span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="ugly-number-ii">Ugly Number II</h1><p>Write a program to find the <code>n</code>-th ugly number.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: n = 10</span><br><span class="line">Output: 12</span><br><span class="line">Explanation: 1, 2, 3, 4, 5, 6, 8, 9, 10, 12</span><br></pre></td></tr></table></figure><p><strong>Note:</strong></p><ol type="1"><li><code>1</code> is typically treated as an ugly number.</li><li><code>n</code> <strong>does not exceed 1690.</strong></li></ol><h2 id="dynamic-programming">Dynamic Programming</h2><p>The first ugly number is 1. New ugly number can be computed by known ugly numbers.</p><p>For example, once we get a new ugly number <code>x</code>, then we add <code>x*2, x*3, x*5</code> to candidate set. And then pick the minimum number as the next ugly number, replace the procedure.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ugly_num, candidates = <span class="number">-1</span>, &#123;<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(n):</span><br><span class="line">    ugly_num = min(candidates)</span><br><span class="line">    candidates.remove(ugly_num)</span><br><span class="line">    candidates.update([ugly_num * <span class="number">2</span>, ugly_num * <span class="number">3</span>, ugly_num * <span class="number">5</span>])</span><br><span class="line"><span class="keyword">return</span> ugly_num</span><br></pre></td></tr></table></figure><p>If <code>n</code> is large, the <code>candidates</code> can be very large. We note that the candidates are <code>x * 2, y * 3, z * 5</code> where <code>x, y, z</code> are all ugly numbers. <code>x = y = z = 1</code> at the beginning. Once a candidate (say <code>2</code>) is chosen, we replace the corresponding ugly number (<code>x=1</code>) by the next ugly number (<code>x=2</code>).</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nthUglyNumber</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        ugly = [<span class="number">1</span>] * n</span><br><span class="line">        ind2, ind3, ind5 = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        can2, can3, can5 = <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            ugly[i] = min(can2, can3, can5)</span><br><span class="line">            <span class="keyword">if</span> can2 == ugly[i]:</span><br><span class="line">                ind2 += <span class="number">1</span></span><br><span class="line">                can2 = ugly[ind2] * <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> can3 == ugly[i]:</span><br><span class="line">                ind3 += <span class="number">1</span></span><br><span class="line">                can3 = ugly[ind3] * <span class="number">3</span></span><br><span class="line">            <span class="keyword">if</span> can5 == ugly[i]:</span><br><span class="line">                ind5 += <span class="number">1</span></span><br><span class="line">                can5 = ugly[ind5] * <span class="number">5</span></span><br><span class="line">        <span class="keyword">return</span> ugly[n - <span class="number">1</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nthUglyNumber</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        ugly = [<span class="number">1</span>] * n</span><br><span class="line">        ind, fac = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], (<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">        can = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            ugly[i] = min(can)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(fac)):</span><br><span class="line">                <span class="keyword">if</span> can[j] == ugly[i]:</span><br><span class="line">                    ind[j] += <span class="number">1</span></span><br><span class="line">                    can[j] = ugly[ind[j]] * fac[j]</span><br><span class="line">        <span class="keyword">return</span> ugly[n - <span class="number">1</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dungeon Game</title>
      <link href="/programming/leetcode/dungeon-game/"/>
      <url>/programming/leetcode/dungeon-game/</url>
      
        <content type="html"><![CDATA[<p>The demons had captured the princess (<strong>P</strong>) and imprisoned her in the bottom-right corner of a dungeon. The dungeon consists M x N rooms laid out in a 2D grid. Our valiant knight (<strong>K</strong>) was initially positioned in the top-left room and must fight his way through the dungeon to rescue the princess.</p><p>The knight has an initial health point represented by a positive integer. If at any point his health point drops to 0 or below, he dies immediately.</p><p>Some of the rooms are guarded by demons, so the knight loses health (<em>negative</em> integers) upon entering these rooms; other rooms are either empty (<em>0's</em>) or contain magic orbs that increase the knight's health (<em>positive</em> integers).</p><p>In order to reach the princess as quickly as possible, the knight decides to move only rightward or downward in each step.</p><p><strong>Write a function to determine the knight's minimum initial health so that he is able to rescue the princess.</strong></p><p>For example, given the dungeon below, the initial health of the knight must be at least <strong>7</strong> if he follows the optimal path <code>RIGHT -&gt; RIGHT -&gt; DOWN -&gt; DOWN</code>.</p><table style="width: auto; text-align: center;"><tbody style="border-style: solid;"><tr><td>-2(K)</td><td>-3</td><td>3</td></tr><tr><td>-5</td><td>-10</td><td>1</td></tr><tr><td>10</td><td>30</td><td>-5(P)</td></tr></tbody></table><p><strong>Note:</strong></p><ul><li>The knight's health has no upper bound.</li><li>Any room can contain threats or power-ups, even the first room the knight enters and the bottom-right room where the princess is imprisoned.</li></ul><h1 id="recursion">Recursion</h1><p>We use two variables <code>curr</code> and <code>init</code> to represent the current and minimum health. Define a function <code>helper(i, j, init, curr)</code> which returns the minimum health so that the knight can move from <code>(i, j)</code> to <code>(m, n)</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculateMinimumHP</span><span class="params">(self, dungeon: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(i, j, init, curr)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> i == len(dungeon) <span class="keyword">or</span> j == len(dungeon[i]):  <span class="comment"># reach the boundary</span></span><br><span class="line">                <span class="keyword">return</span> float(<span class="string">'inf'</span>)</span><br><span class="line">            curr = curr + dungeon[i][j]                    <span class="comment"># fight demons</span></span><br><span class="line">            <span class="keyword">if</span> curr &lt;= <span class="number">0</span>:</span><br><span class="line">                init = init - curr + <span class="number">1</span></span><br><span class="line">                curr = <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> i == len(dungeon) - <span class="number">1</span> <span class="keyword">and</span> j == len(dungeon[i]) - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> init</span><br><span class="line">            <span class="keyword">return</span> min(helper(i + <span class="number">1</span>, j, init, curr),</span><br><span class="line">                       helper(i, j + <span class="number">1</span>, init, curr))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> helper(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="dynamic-programming">Dynamic Programming</h1><p>Denote <code>dp[i][j]</code> as the knight's minimum health if he start from room <code>(i, j)</code>.</p><p>It the knight positioned in <code>(i, j)</code>, he has two ways to go next: <code>(i + 1, j)</code> (downward) or <code>(i, j + 1)</code> (rightward).</p><ul><li>Downward: <code>dp[i][j] + dungeon[i][j] = dp[i + 1][j]</code>.</li><li>Rightward: <code>dp[i][j] + dungeon[i][j] = dp[i][j + 1]</code>.</li></ul><p>Pick the better one: <code>dp[i][j] + dungeon[i][j] = min(dp[i + 1][j], dp[i][j + 1])</code>.</p><p>So, <code>dp[i][j] = min(dp[i + 1][j], dp[i][j + 1]) - dungeon[i][j]</code>, and we need it greater than 0.</p><p>Induction rule: <code>dp[i][j] = max(1, min(dp[i + 1][j], dp[i][j + 1]) - dungeon[i][j])</code>.</p><p>Base cases: <code>dp[m][j] = dp[i][n] = inf</code>, but <code>dp[m][n - 1] = dp[m - 1][n] = 1</code> (At least 1 HP to be alive).</p><p>The last row and last column are meaningless, we add them to simplify the calculation.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">      0    1    2    3</span><br><span class="line"></span><br><span class="line">0     K             inf</span><br><span class="line">1                   inf</span><br><span class="line">2               P    1</span><br><span class="line">3    inf  inf   1   inf</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculateMinimumHP</span><span class="params">(self, dungeon: list)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(dungeon), len(dungeon[<span class="number">0</span>])</span><br><span class="line">        dp = [[float(<span class="string">'inf'</span>)] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        dp[m][n - <span class="number">1</span>] = dp[m - <span class="number">1</span>][n] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">                before = min(dp[i + <span class="number">1</span>][j], dp[i][j + <span class="number">1</span>]) - dungeon[i][j]</span><br><span class="line">                dp[i][j] = max(before, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculateMinimumHP</span><span class="params">(self, dungeon: list)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(dungeon), len(dungeon[<span class="number">0</span>])</span><br><span class="line">        dp = [float(<span class="string">'inf'</span>)] * (n + <span class="number">1</span>)</span><br><span class="line">        dp[n - <span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">                before = min(dp[j], dp[j + <span class="number">1</span>]) - dungeon[i][j]</span><br><span class="line">                dp[j] = max(before, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Palindrome Partitioning</title>
      <link href="/programming/leetcode/palindrome-partitioning/"/>
      <url>/programming/leetcode/palindrome-partitioning/</url>
      
        <content type="html"><![CDATA[<h1 id="palindrome-partitioning-i">Palindrome Partitioning I</h1><p>Given a string <em>s</em>, partition <em>s</em> such that every substring of the partition is a palindrome.</p><p>Return all possible palindrome partitioning of <em>s</em>.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;aab&quot;</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  [&quot;aa&quot;, &quot;b&quot;],</span><br><span class="line">  [&quot;a&quot;, &quot;a&quot;, &quot;b&quot;]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="backtracking">Backtracking</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(2^n * n^2)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, s: str)</span> -&gt; list:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(i, res, cur)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> i == len(s):</span><br><span class="line">                res.append(cur[:])</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i, len(s)):  <span class="comment"># O(n)</span></span><br><span class="line">                <span class="keyword">if</span> self.is_palindrome(s, i, j):  <span class="comment"># O(n)</span></span><br><span class="line">                    cur.append(s[i:j + <span class="number">1</span>])</span><br><span class="line">                    helper(j + <span class="number">1</span>, res, cur)</span><br><span class="line">                    cur.pop()</span><br><span class="line"></span><br><span class="line">        res = []</span><br><span class="line">        helper(<span class="number">0</span>, res, [])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_palindrome</span><span class="params">(s: str, l: int, r: int)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> l == r:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">while</span> l &lt; r:</span><br><span class="line">            <span class="keyword">if</span> s[l] != s[r]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            l, r = l + <span class="number">1</span>, r - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="dynamic-programming">Dynamic Programming</h2><p>Instead of checking <code>s[l .. r]</code> is a palindrome or not, we using dynamic programming to compute the result for each pair <code>(l, r)</code>. See <a href="/programming/leetcode/longest-palindromic-substring/" title="Longest Palindromic Substring">Longest Palindromic Substring</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, s: str)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        n = len(s)</span><br><span class="line">        dp = [[<span class="literal">False</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)]</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(r + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> s[l] == s[r] <span class="keyword">and</span> (r - l &lt;= <span class="number">2</span> <span class="keyword">or</span> dp[l + <span class="number">1</span>][r - <span class="number">1</span>]):</span><br><span class="line">                    dp[l][r] = <span class="literal">True</span></span><br><span class="line">        res = []</span><br><span class="line">        self.helper(s, <span class="number">0</span>, dp, res, [])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(self, s, i, dp, res, cur)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i == len(s):</span><br><span class="line">            res.append(cur[:])</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i, len(s)):  <span class="comment"># O(n)</span></span><br><span class="line">            <span class="keyword">if</span> dp[i][j]:  <span class="comment"># O(1)</span></span><br><span class="line">                cur.append(s[i:j + <span class="number">1</span>])</span><br><span class="line">                self.helper(s, j + <span class="number">1</span>, dp, res, cur)</span><br><span class="line">                cur.pop()</span><br></pre></td></tr></table></figure><h1 id="palindrome-partitioning-ii">Palindrome Partitioning II</h1><p>Given a string <em>s</em>, partition <em>s</em> such that every substring of the partition is a palindrome.</p><p>Return the minimum cuts needed for a palindrome partitioning of <em>s</em>.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;aab&quot;</span><br><span class="line">Output: 1</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming-1">Dynamic Programming</h2><p>Let <code>cut[i]</code> be the minimum cuts needed for substring <code>s[0 .. i]</code>.</p><p>Base case: <code>cut[i] = i - 1</code>. At most <code>i - 1</code> cuts needed for substring <code>s[0 .. i]</code>.</p><p>Induction rule: <code>cut[i] = min(cut[i], cut[j - 1] | 0 &lt;= j &lt;= i where s[j .. i] is a palindrome) + 1</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0   1   2   3   4   5   6</span><br><span class="line">a   a   a   a   b   a   a</span><br><span class="line"></span><br><span class="line">cut[6] = min(cut[6], cut[1] + 1, cut[4] + 1)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n^2)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minCut</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        n = len(s)</span><br><span class="line">        dp = [[<span class="literal">False</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)]</span><br><span class="line">        cut = list(range(n))  <span class="comment"># initial, at most i-1 cuts for s[:i]</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(r + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> s[l] == s[r] <span class="keyword">and</span> (r - l &lt;= <span class="number">2</span> <span class="keyword">or</span> dp[l + <span class="number">1</span>][r - <span class="number">1</span>]):</span><br><span class="line">                    dp[l][r] = <span class="literal">True</span></span><br><span class="line">                    cut[r] = <span class="number">0</span> <span class="keyword">if</span> l == <span class="number">0</span> <span class="keyword">else</span> min(cut[r], cut[l - <span class="number">1</span>] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> cut[n - <span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>If we let <code>cut[i]</code> be the minimum cuts needed for substring <code>s[0 .. i)</code> (<code>i</code> not included), and let <code>cut[0] = -1</code>, we can tackle with the boundary ingeniously.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n^2)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minCut</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        n = len(s)</span><br><span class="line">        dp = [[<span class="literal">False</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)]</span><br><span class="line">        cut = list(range(<span class="number">-1</span>, n))  <span class="comment"># tiny change</span></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(r + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> s[l] == s[r] <span class="keyword">and</span> (r - l &lt;= <span class="number">2</span> <span class="keyword">or</span> dp[l + <span class="number">1</span>][r - <span class="number">1</span>]):</span><br><span class="line">                    dp[l][r] = <span class="literal">True</span></span><br><span class="line">                    cut[r + <span class="number">1</span>] = min(cut[r + <span class="number">1</span>], cut[l] + <span class="number">1</span>)  <span class="comment"># tiny change</span></span><br><span class="line">        <span class="keyword">return</span> cut[n]  <span class="comment"># tiny change</span></span><br></pre></td></tr></table></figure><h2 id="using-on-space">Using O(n) space</h2><p>Let <code>cut[i]</code> be the minimum cuts needed for substring <code>s[0 .. i)</code>.</p><p>For each <code>0 &lt;= i &lt; n</code> we find every palindrome that centered at <code>i</code>. (See <a href="/programming/leetcode/longest-palindromic-substring/" title="Longest Palindromic Substring">Longest Palindromic Substring</a>: Expand Around Center)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    l     m     h</span><br><span class="line">... a  a  b  a  a ...</span><br><span class="line">    |&lt;--  y  --&gt;|</span><br><span class="line">|&lt;--    x    --&gt;|</span><br><span class="line"></span><br><span class="line">Say y is a palindrome around m.</span><br><span class="line">The minimum cuts needed for substring x is:</span><br><span class="line">cut[h + 1] = min(cut[h + 1], cut[l] + 1)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minCut</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        n = len(s)</span><br><span class="line">        cut = list(range(<span class="number">-1</span>, n))</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> l, h <span class="keyword">in</span> (m, m), (m - <span class="number">1</span>, m):</span><br><span class="line">                <span class="keyword">while</span> l &gt;= <span class="number">0</span> <span class="keyword">and</span> h &lt; n <span class="keyword">and</span> s[l] == s[h]:</span><br><span class="line">                    cut[h + <span class="number">1</span>] = min(cut[h + <span class="number">1</span>], cut[l] + <span class="number">1</span>)</span><br><span class="line">                    l, h = l - <span class="number">1</span>, h + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> cut[n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
            <tag> palindrome </tag>
            
            <tag> backtracking </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maximum Square</title>
      <link href="/programming/leetcode/maximum-square/"/>
      <url>/programming/leetcode/maximum-square/</url>
      
        <content type="html"><![CDATA[<p>Given a 2D binary matrix filled with 0's and 1's, find the largest square containing only 1's and return its area.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  [&apos;1&apos;, &apos;0&apos;, &apos;1&apos;, &apos;0&apos;, &apos;0&apos;],</span><br><span class="line">  [&apos;1&apos;, &apos;0&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;],</span><br><span class="line">  [&apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;],</span><br><span class="line">  [&apos;1&apos;, &apos;0&apos;, &apos;0&apos;, &apos;1&apos;, &apos;0&apos;]</span><br><span class="line">]</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><h1 id="broute-force">Broute Force</h1><p>We use a variable to contain the size of the largest square found so far and another variable to store the size of the current, both initialized to 0.</p><p>Starting from the left uppermost point in the matrix, we search for a 1. No operation needs to be done for a 0.</p><p>Whenever a 1 is found, we try to find out the largest square that can be formed including that 1. For this, we move diagonally (right and downwards), i.e. we increment the row index and column index temporarily and then check whether all the elements of that row and column are 1 or not.</p><p>If all the elements happen to be 1, we move diagonally further as previously. If even one element turns out to be 0, we stop this diagonal movement and update the size of the largest square.</p><p>Now we, continue the traversal of the matrix from the element next to the initial 1 found, till all the elements of the matrix have been traversed.</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O((mn)^2)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximalSquare</span><span class="params">(self, matrix: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m, n = len(matrix), len(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        max_sq = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                <span class="keyword">if</span> matrix[i][j] != <span class="string">'1'</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                sq, flag = <span class="number">1</span>, <span class="literal">True</span></span><br><span class="line">                <span class="keyword">while</span> sq + i &lt; m <span class="keyword">and</span> sq + j &lt; n <span class="keyword">and</span> flag:</span><br><span class="line">                    flag = all(matrix[sq + i][k] == <span class="string">'1'</span>  <span class="comment"># sq+i column</span></span><br><span class="line">                               <span class="keyword">for</span> k <span class="keyword">in</span> range(j, sq + j + <span class="number">1</span>)) <span class="keyword">and</span> \</span><br><span class="line">                           all(matrix[k][sq + j] == <span class="string">'1'</span>  <span class="comment"># sq+j row</span></span><br><span class="line">                               <span class="keyword">for</span> k <span class="keyword">in</span> range(i, sq + i + <span class="number">1</span>))</span><br><span class="line">                    <span class="keyword">if</span> flag:</span><br><span class="line">                        sq += <span class="number">1</span></span><br><span class="line">                max_sq = max(max_sq, sq)</span><br><span class="line">        <span class="keyword">return</span> max_sq ** <span class="number">2</span></span><br></pre></td></tr></table></figure><!-- more --><h1 id="dynamic-programming">Dynamic Programming</h1><p>We initialize another matrix (dp) with the same dimensions as the original one initialized with all 0's.</p><p><code>dp[i][j]</code> represents the side length of the maximum square whose bottom right corner is the cell with index <code>(i, j)</code> in the original matrix.</p><p>Starting from index <code>(0, 0)</code>, for every 1 found in the original matrix, we update the value of the current element as <code>dp[i][j] = min(dp[i - 1][j], dp[i - 1][j - 1], dp[i][j - 1]) + 1</code>.</p><p>We also remember the size of the largest square found so far. In this way, we traverse the original matrix once and find out the required maximum size.</p><p>To understand how this solution works, see the figure below.</p><p><img src="/uploads/image/leetcode/maximal_square.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximalSquare</span><span class="params">(self, matrix: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m, n = len(matrix), len(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        max_sq = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> matrix[i - <span class="number">1</span>][j - <span class="number">1</span>] == <span class="string">'1'</span>:</span><br><span class="line">                    dp[i][j] = min(dp[i][j - <span class="number">1</span>], dp[i - <span class="number">1</span>][j], dp[i - <span class="number">1</span>][j - <span class="number">1</span>]) + <span class="number">1</span></span><br><span class="line">                    max_sq = max(max_sq, dp[i][j])</span><br><span class="line">        <span class="keyword">return</span> max_sq ** <span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximalSquare</span><span class="params">(self, matrix: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m, n = len(matrix), len(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">        max_sq = prev = <span class="number">0</span>  <span class="comment"># prev = dp[i - 1][j - 1]</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                temp = dp[j]</span><br><span class="line">                <span class="keyword">if</span> matrix[i - <span class="number">1</span>][j - <span class="number">1</span>] == <span class="string">'1'</span>:</span><br><span class="line">                    dp[j] = min(dp[j - <span class="number">1</span>], dp[j], prev) + <span class="number">1</span></span><br><span class="line">                    max_sq = max(max_sq, dp[j])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[j] = <span class="number">0</span></span><br><span class="line">                prev = temp</span><br><span class="line">        <span class="keyword">return</span> max_sq ** <span class="number">2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House Robber</title>
      <link href="/programming/leetcode/house-robber/"/>
      <url>/programming/leetcode/house-robber/</url>
      
        <content type="html"><![CDATA[<h1 id="house-robber-i">House Robber I</h1><p>You are a professional robber planning to rob houses along a streat. Each house has a certain amount of money stashed, the only constraint stopping you from robbing each of them is that adjacent houses have securtiy system connected and <strong>it will automatically contact the police if two adjacent houses were broken into on the same night.</strong></p><p>Given a list of non-negative integers representing the amount of money of each house, determine the maximum amount of money you can rob tonight <strong>without alerting the police.</strong></p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,1]</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [2,7,9,3,1]</span><br><span class="line">Output: 12</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming">Dynamic Programming</h2><p>Let <code>dp[i]</code> denotes the maximum amount money you can rob from <code>nums[0 .. i]</code>.</p><p>The action you can do is,</p><ul><li>Rob <code>nums[i]</code>, then <code>dp[i] = dp[i - 2] + nums[i]</code>.</li><li>Don't rob, then <code>dp[i] = dp[i - 1]</code>.</li></ul><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rob</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        dp = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> nums:</span><br><span class="line">            dp.append(max(dp[<span class="number">-2</span>] + x, dp[<span class="number">-1</span>]))</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rob</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        prev2 = prev1 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> nums:</span><br><span class="line">            temp = prev1</span><br><span class="line">            prev1 = max(prev2 + x, prev1)</span><br><span class="line">            prev2 = temp</span><br><span class="line">        <span class="keyword">return</span> prev1</span><br></pre></td></tr></table></figure><h1 id="house-robber-ii">House Robber II</h1><p>All houses at this place are <strong>arranged in a circle.</strong> That means the first house is the neighbor of the last one.</p><p>Determine the maximum amount of money you can rob tonight <strong>without alerting the police.</strong></p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [2,3,2]</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,1]</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><h2 id="two-pass">Two Pass</h2><p>There are two cases: rob <code>nums[0]</code> or rob <code>nums[n - 1]</code>. So we can utilize the method of House Robber I, the maximum amount should be <code>max(rob(nums[:n-1], rob(nums[1:]))</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rob</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(start, stop)</span>:</span></span><br><span class="line">            prev2 = prev1 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(start, stop):</span><br><span class="line">                temp = prev1</span><br><span class="line">                prev1 = max(prev2 + nums[i], prev1)</span><br><span class="line">                prev2 = temp</span><br><span class="line">            <span class="keyword">return</span> prev1</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> max(helper(<span class="number">0</span>, len(nums) - <span class="number">1</span>),</span><br><span class="line">                   helper(<span class="number">1</span>, len(nums)))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maximum Product Subarray</title>
      <link href="/programming/leetcode/maximum-product-subarray/"/>
      <url>/programming/leetcode/maximum-product-subarray/</url>
      
        <content type="html"><![CDATA[<p>Given an integer array <code>nums</code>, find the contiguous subarray within an array (contaning at least one number) which has the largest product.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [2,3,-2,4]</span><br><span class="line">Output: 6</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [-2,0,-1]</span><br><span class="line">Output: 0</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp_max[i]</code> be the maximum product of subarray and <code>dp_min[i]</code> be the minimum product of subarray that ends with <code>nums[i]</code>. The maximum value of array <code>dp_max</code> is the answer.</p><p>Base case: <code>dp_max[0] = dp_min[0] = nums[0]</code>.</p><p>Induction rules:</p><ul><li>If <code>nums[i] &gt;= 0</code>, <code>dp_max[i] = max(dp_max[i - 1] * nums[i], nums[i])</code>, <code>dp_min[i] = min(dp_min[i - 1] * nums[i], nums[i])</code>.</li><li>If <code>nums[i] &lt; 0</code>, <code>dp_max[i] = max(dp_min[i - 1] * nums[i], nums[i])</code>, <code>dp_min[i] = min(dp_max[i - 1] * nums[i], nums[i])</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProduct</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        imax = imin = res = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">            <span class="keyword">if</span> nums[i] &lt; <span class="number">0</span>:</span><br><span class="line">                imax, imin = imin, imax</span><br><span class="line">            imax = max(imax * nums[i], nums[i])</span><br><span class="line">            imin = min(imin * nums[i], nums[i])</span><br><span class="line">            res = max(res, imax)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Word Break</title>
      <link href="/programming/leetcode/word-break/"/>
      <url>/programming/leetcode/word-break/</url>
      
        <content type="html"><![CDATA[<h1 id="word-break-i">Word Break I</h1><p>Given a <strong>non-empty</strong> string <em>s</em> and a dictionary <em>wordDict</em> containing a list of <strong>non-empty</strong> words, determine if <em>s</em> can be segmented into a space-separated sequence of one or more dictionary words.</p><p><strong>Note:</strong></p><ul><li>The same word in the dictionary may be reused multiple times in the segmentation.</li><li>You may assume the dictionary does not contain duplicate words.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;leetcode&quot;, wordDict = [&quot;leet&quot;, &quot;code&quot;]</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;applepenapple&quot;, wordDict = [&quot;apple&quot;, &quot;pen&quot;]</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;catsandog&quot;, wordDict = [&quot;cats&quot;, &quot;dog&quot;, &quot;sand&quot;, &quot;and&quot;, &quot;cat&quot;]</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming">Dynamic Programming</h2><p>Let <code>dp[i]</code> denotes whether <code>s[0 .. i)</code> can be segmented into a space-separated sequence of one or more dictionary words.</p><a id="more"></a><p>Base case: <code>dp[0] = true</code>.</p><p>Induction rule:</p><p>For filling in the entry of <code>dp[i]</code>, if there exist any <code>j &lt; i</code> where <code>dp[j] = true</code> and <code>s[j .. i)</code> is contained in <code>wordDict</code>, then <code>dp[i] = true</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wordBreak</span><span class="params">(self, s: str, wordDict: list)</span> -&gt; bool:</span></span><br><span class="line">        n, wordDict = len(s), set(wordDict)</span><br><span class="line">        dp = [<span class="literal">True</span>] + [<span class="literal">False</span>] * n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            dp[i] = any(dp[j] <span class="keyword">and</span> s[j:i] <span class="keyword">in</span> wordDict</span><br><span class="line">                        <span class="keyword">for</span> j <span class="keyword">in</span> reversed(range(i)))  <span class="comment"># backward may improve performace a little bit</span></span><br><span class="line">            <span class="comment"># This is equivalent to:</span></span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">            for j in reversed(range(i)):</span></span><br><span class="line"><span class="string">                if dp[j] and s[j:i] in wordDict:</span></span><br><span class="line"><span class="string">                    dp[i] = True</span></span><br><span class="line"><span class="string">                    break</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure><h1 id="word-break-ii">Word Break II</h1><p>Given a <strong>non-empty</strong> string <em>s</em> and a dictionary <em>wordDict</em> containing a list of <strong>non-empty</strong> words, add spaces in <em>s</em> to construct a sentence where each word is valid dictionary word. Return all such possible sentences.</p><p><strong>Note:</strong></p><ul><li>The same word in the dictionary may be reused multiple times in the segmentation.</li><li>You may assume the dictionary does not contain duplicate words.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;catsanddog&quot;</span><br><span class="line">wordDict = [&quot;cat&quot;, &quot;cats&quot;, &quot;and&quot;, &quot;sand&quot;, &quot;dog&quot;]</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  &quot;cats and dog&quot;,</span><br><span class="line">  &quot;cat sand dog&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">s = &quot;pineapplepenapple&quot;</span><br><span class="line">wordDict = [&quot;apple&quot;, &quot;pen&quot;, &quot;applepen&quot;, &quot;pine&quot;, &quot;pineapple&quot;]</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  &quot;pine apple pen apple&quot;,</span><br><span class="line">  &quot;pineapple pen apple&quot;,</span><br><span class="line">  &quot;pine applepen apple&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Example 3:</span><br><span class="line"></span><br><span class="line">```text</span><br><span class="line">Input:</span><br><span class="line">s = &quot;catsandog&quot;</span><br><span class="line">wordDict = [&quot;cats&quot;, &quot;dog&quot;, &quot;sand&quot;, &quot;and&quot;, &quot;cat&quot;]</span><br><span class="line">Output:</span><br><span class="line">[]</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming-1">Dynamic Programming</h2><p>Just let <code>dp[i]</code> be the all such possible sentences of <code>s[0 .. i)</code>. The induction rule is absolutely the same with Word Break I.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wordBreak</span><span class="params">(self, s: str, wordDict: list)</span> -&gt; list:</span></span><br><span class="line">        n, wordDict = len(s), set(wordDict)</span><br><span class="line">        dp = [[<span class="string">""</span>]] + [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i):</span><br><span class="line">                <span class="keyword">if</span> dp[j] <span class="keyword">and</span> s[j:i] <span class="keyword">in</span> wordDict:</span><br><span class="line">                    dp[i].extend((x + <span class="string">' '</span> + s[j:i]).lstrip()</span><br><span class="line">                                 <span class="keyword">for</span> x <span class="keyword">in</span> dp[j])</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Best Time to Buy and Sell Stock</title>
      <link href="/programming/leetcode/best-time-to-buy-and-sell-stock/"/>
      <url>/programming/leetcode/best-time-to-buy-and-sell-stock/</url>
      
        <content type="html"><![CDATA[<h1 id="at-most-1-transaction">At most 1 transaction</h1><p>Say you have an array for which the <code>i</code>-th element is the price of a given stock on day <code>i</code>.</p><p>If you were only permitted to complete at most one transaction (i.e., buy one and sell one share of the stock), design an algorithm to find the maximum profit.</p><p>Not that you cannnot sell a stock before you buy one.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [7,1,5,3,6,4]</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [7,6,4,3,1]</span><br><span class="line">Output: 0</span><br></pre></td></tr></table></figure><h2 id="broute-force">Broute Force</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> sell <span class="keyword">in</span> range(<span class="number">1</span>, len(prices)):</span><br><span class="line">            <span class="comment"># range(sell + 1) also works.</span></span><br><span class="line">            <span class="comment"># prices[sell] is the minimum price by far,</span></span><br><span class="line">            <span class="comment"># prices[sell] - prices[min_price] = 0,</span></span><br><span class="line">            <span class="comment"># hence, res = max(res, 0)</span></span><br><span class="line">            min_price = min(prices[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(sell))</span><br><span class="line">            res = max(res, prices[sell] - prices[min_price])</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>We can use a variable to save the minimum price by far instead of computing repetitively.</p><a id="more"></a><h2 id="one-pass">One Pass</h2><p>Say the given array is <code>[7,1,5,3,6,4]</code>. If we plot the numbers of the given array on a graph, we get:</p><p><img src="/uploads/image/leetcode/maximum_profit_graph.png"></p><p><strong>The points of interest are the peaks and valleys in the given graph. We need to find the largest peak following the smallest valley.</strong> We can maintain two variables - <code>minprice</code> and <code>maxprofit</code> corresponding to the smallest valley and maximum profit obtained so far respectively.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        min_price, max_profit = float(<span class="string">'inf'</span>), <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            min_price = min(min_price, p)</span><br><span class="line">            max_profit = max(max_profit, p - min_price)</span><br><span class="line">        <span class="keyword">return</span> max_profit</span><br></pre></td></tr></table></figure><h2 id="maximum-subarray">Maximum Subarray</h2><p>We can transform the problem to the Maximum Subarray problem. Here gives the Dynamic Programming solution of the Maximum Subarray problem, see <a href="/programming/leetcode/maximum-subarray/" title="Maximum Subarray">Maximum Subarray</a> for other solutions.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        cur = res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(prices)):</span><br><span class="line">            cur = max(cur, <span class="number">0</span>) + prices[i] - prices[i - <span class="number">1</span>]</span><br><span class="line">            res = max(res, cur)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="at-most-2-transactions">At most 2 transactions</h1><p>Design an algorithm to find the maximum profit. You may complete at most two transactions.</p><p><strong>Note:</strong> You may not engage in multiple transactions at the same time (i.e., you must sell the stock before you buy again).</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [3,3,5,0,0,3,1,4]</span><br><span class="line">Output: 6</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,4,5]</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [7,6,4,3,1]</span><br><span class="line">Output: 0</span><br></pre></td></tr></table></figure><h2 id="one-pass-1">One Pass</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Variation 1</span></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        profit1 = profit2 = <span class="number">0</span></span><br><span class="line">        min_price1 = min_price2 = float(<span class="string">'inf'</span>)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            profit2 = max(profit2, p - min_price2)</span><br><span class="line">            min_price2 = min(min_price2, p - profit1)</span><br><span class="line">            profit1 = max(profit1, p - min_price1)</span><br><span class="line">            min_price1 = min(min_price1, p)</span><br><span class="line">        <span class="keyword">return</span> profit2</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Variation 2</span></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        profit1 = profit2 = <span class="number">0</span></span><br><span class="line">        min_price1 = min_price2 = float(<span class="string">'inf'</span>)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            min_price1 = min(min_price1, p)</span><br><span class="line">            profit1 = max(profit1, p - min_price1)</span><br><span class="line">            <span class="comment"># considering how much we can earned if we have `profit1`</span></span><br><span class="line">            min_price2 = min(min_price2, p - profit1)</span><br><span class="line">            profit2 = max(profit2, p - min_price2)</span><br><span class="line">        <span class="keyword">return</span> profit2</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">e.g. prices = [1, 2, 0, 3, 1, 2, 0, 4]</span><br><span class="line">                     ^  ^        ^  ^</span><br><span class="line"></span><br><span class="line"> p                 1   2   0   3   1   2   0   4</span><br><span class="line">m1=min(m1, p)      1   1   0   0   0   0   0   0  &lt;- minimum price by far</span><br><span class="line">p1=max(p1, p-m1)   0   1   1   3   3   3   3   4  &lt;- maximum profit by far</span><br><span class="line">           p-p1    1   1  -1   0  -2  -1  -3   0  &lt;- the price we buy a stock if we&apos;ve earned p1</span><br><span class="line">m2=min(m2, p-p1)   1   1  -1  -1  -2  -2  -3  -3  &lt;- minimum price if we&apos;ve earned p1</span><br><span class="line">p2=max(p2, p-m2)   0   1   1   4   4   4   4   7  &lt;- total profit</span><br></pre></td></tr></table></figure><h1 id="at-most-k-transactions">At most k transactions</h1><p>Design an algorithm to find the maximum profit. You may complete at most <strong>k</strong> transactions.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [2,4,1], k = 2</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [3,2,6,5,0,3], k = 2</span><br><span class="line">Output: 7</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming">Dynamic Programming</h2><p>Let <code>dp[k][n]</code> be the maximum profit completing at most <code>k</code> transactions on <code>n</code>-th day. <code>n</code> start from 1. Hence, <code>n</code>-th day's price is <code>prices[n - 1]</code>.</p><p>Base case: <code>dp[0][n] = dp[k][0] =  0</code>. Say <code>prices = [1,2,0,3]</code>, the base case is:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">prices      1   2   0   3</span><br><span class="line">       d0  d1  d2  d3  d4</span><br><span class="line">   t0   0   0   0   0   0</span><br><span class="line">   t1   0</span><br><span class="line">   t2   0</span><br></pre></td></tr></table></figure><p>Induction rules:</p><p>For filling in the entry of <code>dp[i][j]</code>,</p><ul><li>If we don't sell a stock on <code>j</code>-th day, <code>dp[i][j] = dp[i][j - 1]</code>.</li><li>If we sell a stock on <code>j</code>-th day, we must buy a stock on <code>x</code>-th day where <code>1 &lt;= x &lt; j</code>, <code>dp[i][j] = max(dp[i - 1][x - 1] - prices[x - 1] + prices[j - 1] | 1 &lt;= x &lt; j)</code>. <strong>If <code>x = j</code>, means we buy and sell a stock on one day, which is effectively trading nothing.</strong> So, <code>1 &lt;= x &lt;= j</code> also works well. This helps when we reduce the time complexity later.</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dp[i][j] = max(dp[i][j - 1],</span><br><span class="line">               max(dp[i - 1][x - 1] - prices[x - 1] | 1 &lt;= x &lt;= j) + prices[j - 1])</span><br><span class="line">                                      ^ buy on x-th day              ^ sell on j-th day</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn^2)</span></span><br><span class="line"><span class="comment"># Space: O(kn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, k: int, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n = len(prices)</span><br><span class="line">        dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(k + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, k + <span class="number">1</span>):  <span class="comment"># O(k), add an outer loop, dealing with transactions</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):  <span class="comment"># O(n)</span></span><br><span class="line">                val = max(dp[i - <span class="number">1</span>][x] - prices[x] <span class="keyword">for</span> x <span class="keyword">in</span> range(j))  <span class="comment"># O(n), 0 &lt;= x &lt;= j - 1</span></span><br><span class="line">                dp[i][j] = max(dp[i][j - <span class="number">1</span>], val + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[k][n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn)</span></span><br><span class="line"><span class="comment"># Space: O(kn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, k: int, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n = len(prices)</span><br><span class="line">        dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(k + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, k + <span class="number">1</span>):  <span class="comment"># O(k)</span></span><br><span class="line">            val = float(<span class="string">'-inf'</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):  <span class="comment"># O(n)</span></span><br><span class="line">                val = max(val, dp[i - <span class="number">1</span>][j - <span class="number">1</span>] - prices[j - <span class="number">1</span>])  <span class="comment"># O(1)</span></span><br><span class="line">                dp[i][j] = max(dp[i][j - <span class="number">1</span>], val + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[k][n]</span><br></pre></td></tr></table></figure><h1 id="from-dp-to-one-pass">From DP to One Pass</h1><ul><li>Exchange the two <code>for</code> loop. <code>val</code> is different with different <code>i</code>, so we need a vector to store values separately.</li><li>Transpose array <code>dp</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn)</span></span><br><span class="line"><span class="comment"># Space: O(kn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n, k = len(prices), <span class="number">2</span></span><br><span class="line">        dp = [[<span class="number">0</span>] * (k + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n + <span class="number">1</span>)]  <span class="comment"># transposed</span></span><br><span class="line">        val = [float(<span class="string">'-inf'</span>)] * (k + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):  <span class="comment"># on j-th day</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, k + <span class="number">1</span>):</span><br><span class="line">                val[i] = max(val[i], dp[j - <span class="number">1</span>][i - <span class="number">1</span>] - prices[j - <span class="number">1</span>])</span><br><span class="line">                dp[j][i] = max(dp[j - <span class="number">1</span>][i], val[i] + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[n][k]</span><br></pre></td></tr></table></figure><h2 id="loop-backward">Loop backward</h2><p>It seems like <code>dp[j][i]</code> is dependent on <code>dp[j - 1][i]</code> and <code>dp[j - 1][i - 1]</code>. So, if we want to use a vector to instead array, we need to loop backwards from <code>k</code> to 1.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn)</span></span><br><span class="line"><span class="comment"># Space: O(k)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n, k = len(prices), <span class="number">2</span></span><br><span class="line">        dp = [<span class="number">0</span>] * (k + <span class="number">1</span>)  <span class="comment"># using vector</span></span><br><span class="line">        val = [float(<span class="string">'-inf'</span>)] * (k + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(k, <span class="number">0</span>, <span class="number">-1</span>):  <span class="comment"># backward</span></span><br><span class="line">                val[i] = max(val[i], dp[i - <span class="number">1</span>] - prices[j - <span class="number">1</span>])</span><br><span class="line">                dp[i] = max(dp[i], val[i] + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[k]</span><br></pre></td></tr></table></figure><p>Let <code>dp = [sell_0, sell_1, sell_2]</code> and <code>val = [buy_0, buy_1, buy_2]</code>, we can reduce the space complexity further.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        buy_1 = buy_2 = float(<span class="string">'-inf'</span>)</span><br><span class="line">        sell_1 = sell_2 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            buy_2 = max(buy_2, sell_1 - p)  <span class="comment"># buy_2 &lt;- val[2]</span></span><br><span class="line">            sell_2 = max(sell_2, buy_2 + p)</span><br><span class="line">            buy_1 = max(buy_1, -p)</span><br><span class="line">            sell_1 = max(sell_1, buy_1 + p)</span><br><span class="line">        <span class="keyword">return</span> sell_2</span><br></pre></td></tr></table></figure><h2 id="loop-forward">Loop forward</h2><p>Actually, loop forwards from 1 to k is also feasible. <strong>Because even if <code>dp[j - 1][i - 1]</code> is updated to <code>dp[j][i - 1]</code>, <code>var[i]</code> has the same value.</strong></p><p><code>dp[j][i - 1]</code> can be larger than or equal to <code>dp[j - 1][i - 1]</code>.</p><ul><li>If <code>dp[j][i - 1] = dp[j - 1][i - 1]</code>, obviously <code>var[i]</code> won't change.</li><li>If <code>dp[j][i - 1] &gt; dp[j - 1][i - 1]</code>, means we have sold a stock on <code>j</code>-th day. Since <code>var[i] = max(var[i], dp[j][i - 1] - price[j - 1])</code>, buy and sell a stock on one day is effectively trading noting.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        buy_1 = buy_2 = float(<span class="string">'-inf'</span>)</span><br><span class="line">        sell_1 = sell_2 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            buy_1 = max(buy_1, -p)</span><br><span class="line">            sell_1 = max(sell_1, buy_1 + p)</span><br><span class="line">            buy_2 = max(buy_2, sell_1 - p)</span><br><span class="line">            sell_2 = max(sell_2, buy_2 + p)</span><br><span class="line">        <span class="keyword">return</span> sell_2</span><br></pre></td></tr></table></figure><h1 id="with-cooldown">with Cooldown</h1><p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (ie, buy one and sell one share of the stock multiple times) with the following restrictions:</p><ul><li>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</li><li>After you sell your stock, you cannot buy stock on next day. (ie, cooldown 1 day)</li></ul><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,0,2]</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: transactions = [buy, sell, cooldown, buy, sell]</span><br></pre></td></tr></table></figure><h2 id="one-pass-2">One Pass</h2><p>Let <code>dp[i]</code> represents the maximum profit on the <code>i</code>-th day.</p><p>Base case: <code>dp[0] = 0</code>.</p><p>Induction rules:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dp[i] = max(dp[i - 1],</span><br><span class="line">            max(dp[j - 2] - prices[j - 1] | 1 &lt;= j &lt;= i) + prices[i - 1])</span><br><span class="line">                ^           ^ buy on j-th day                     ^ sell on i-th day</span><br><span class="line">       max profit on (j-2)-th day</span><br></pre></td></tr></table></figure><p>When <code>j = 1</code>, <code>dp[j - 2] = dp[-1]</code> should be 0.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n = len(prices)</span><br><span class="line">        dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)  <span class="comment"># dp[-1] = dp[n] = 0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            val = max(dp[j - <span class="number">1</span>] - prices[j] <span class="keyword">for</span> j <span class="keyword">in</span> range(i))</span><br><span class="line">            dp[i] = max(dp[i - <span class="number">1</span>], val + prices[i - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        prev1 = prev2 = <span class="number">0</span>  <span class="comment"># maximum profits</span></span><br><span class="line">        val = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            val = max(val, prev2 - p)</span><br><span class="line">            prev2 = prev1</span><br><span class="line">            prev1 = max(prev1, val + p)</span><br><span class="line">        <span class="keyword">return</span> prev1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Triangle</title>
      <link href="/programming/leetcode/triangle/"/>
      <url>/programming/leetcode/triangle/</url>
      
        <content type="html"><![CDATA[<p>Given a triangle, find the minimum path sum from top to bottom. Each step you may move to adjacent numbers on the row below.</p><p>For example, given the follwing triangle</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">     [2],</span><br><span class="line">    [3,4],</span><br><span class="line">   [6,5,7],</span><br><span class="line">  [4,1,8,3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>The minimum path sum from top to bottom is 11 (i.e., 2 + 3 + 5 + 1 = 11).</p><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp[i][j]</code> denotes the sum of minimum path that end at <code>triangle[i][j]</code>.</p><p>Base case: <code>dp[m - 1][j] = triangle[m - 1][j]</code>. Where <code>m</code> is the length of <code>triangle</code>.</p><p>Induction rule: <code>dp[i][j] = triangle[i][j] + min(dp[i + 1][j], dp[i + 1][j + 1])</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn), where n is the length of last row in triangle.</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minimumTotal</span><span class="params">(self, triangle: list)</span> -&gt; int:</span></span><br><span class="line">        m, dp = len(triangle), triangle[<span class="number">-1</span>][:]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m - <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(triangle[i])):</span><br><span class="line">                dp[j] = triangle[i][j] + min(dp[j], dp[j + <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Distinct Subsequences</title>
      <link href="/programming/leetcode/distinct-subsequences/"/>
      <url>/programming/leetcode/distinct-subsequences/</url>
      
        <content type="html"><![CDATA[<p>Given a string <strong>S</strong> and a string <strong>T</strong>, count the number of distinct subsequences of <strong>S</strong> which equals <strong>T</strong>.</p><p>A subsequence of a string is a new string which is formed from the original string by deleting some (can be none) of the characters without disturbing the relative positions of the remaining characters. (ie, &quot;ACE&quot; is a subsequence of &quot;ABCDE&quot; while &quot;AEC&quot; is not).</p><p>It's guaranteed the answer fits on a 32-bit signed integer.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: S = &quot;rabbbit&quot;, T = &quot;rabbit&quot;</span><br><span class="line">Ouput: 3</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: S = &quot;babgbag&quot;, T = &quot;bag&quot;</span><br><span class="line">Ouput: 5</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp[i][j]</code> denotes the number of distinct subsequences of <code>s[0 .. i - 1]</code> which equals <code>t[0 .. j - 1]</code>.</p><p>Base cases:</p><ul><li>If <code>j == 0</code>, <code>dp[i][0] = 1</code>. An empty string is a subsequences of any strings.</li><li>If <code>i == 0</code>, <code>dp[0][j] = 0</code>. A non-empty string is not a subsequences of an empty string. Specially, <code>dp[0][0] = 1</code>.</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">e.g. s = &apos;baag&apos;, t = &apos;bag&apos;</span><br><span class="line"></span><br><span class="line">  s 0  1  2  3  4</span><br><span class="line">t   +--+--+--+--+</span><br><span class="line">0   1  1  1  1  1</span><br><span class="line">1   0</span><br><span class="line">2   0</span><br><span class="line">3   0</span><br></pre></td></tr></table></figure><a id="more"></a><p>Induction rules:</p><p>For filling in the entry of <code>dp[i][j]</code>,</p><ul><li>If <code>s[i - 1] != t[j - 1]</code>, then we have the same number of distinct subsequences as we had without the new character. <code>dp[i][j] = dp[i - 1][j]</code>.</li><li>If <code>s[i - 1] == t[j - 1]</code>, <code>dp[i][j] = dp[i - 1][j - 1] + dp[i - 1][j]</code>. The number of distinct subsequences is the number when character <code>s[i - 1]</code> is chosen <strong>plus</strong> when it's not.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numDistinct</span><span class="params">(self, s: str, t: str)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(s), len(t)</span><br><span class="line">        <span class="keyword">if</span> m &lt; n:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> m == n:</span><br><span class="line">            <span class="keyword">return</span> s == t</span><br><span class="line">        dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> s[i - <span class="number">1</span>] == t[j - <span class="number">1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + dp[i - <span class="number">1</span>][j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j]</span><br><span class="line">        <span class="keyword">return</span> dp[m][n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numDistinct</span><span class="params">(self, s: str, t: str)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(s), len(t)</span><br><span class="line">        <span class="keyword">if</span> m &lt; n:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> m == n:</span><br><span class="line">            <span class="keyword">return</span> s == t</span><br><span class="line">        dp = [<span class="number">1</span>] + [<span class="number">0</span>] * n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            cur = dp[:]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> s[i - <span class="number">1</span>] == t[j - <span class="number">1</span>]:</span><br><span class="line">                    cur[j] = dp[j - <span class="number">1</span>] + dp[j]</span><br><span class="line">            dp = cur</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Interleaving String</title>
      <link href="/programming/leetcode/interleaving-string/"/>
      <url>/programming/leetcode/interleaving-string/</url>
      
        <content type="html"><![CDATA[<p>Given <em>s1, s2, s3</em>, find whether <em>s3</em> is formed by the interleaving of <em>s1</em> and <em>s2</em>.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s1 = &quot;aabcc&quot;, s2 = &quot;dbbca&quot;, s3 = &quot;aadbbcbcac&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s1 = &quot;aabcc&quot;, s2 = &quot;dbbca&quot;, s3 = &quot;aadbbaccc&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h1 id="brute-force">Brute Force</h1><p>The most basic idea is to find every string possible by all interleavings of the two given strings <code>s1</code> and <code>s2</code>. <code>m</code> is the length of <code>s1</code>, <code>n</code> is the length of <code>s2</code>.</p><p>If <code>s3[0 .. i + j - 1]</code> is formed by the interleaving of <code>s1[0 .. i - 1]</code> and <code>s2[0 .. j - 1]</code>,</p><ul><li>If <code>s3[i + j] == s1[i]</code>, then check if <code>s3[i + j + 1 .. m + n - 1]</code> can be obtained by <code>s1[i + 1 .. m - 1]</code> and <code>s2[j .. n - 1]</code>.</li><li>If <code>s3[i + j] == s2[j]</code>, then check if <code>s3[i + j + 1 .. m + n - 1]</code> can be obtained by <code>s1[i .. m - 1]</code> and <code>s2[j + 1 .. n - 1]</code>.</li><li>Else, return false.</li></ul><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(2^(m + n))</span></span><br><span class="line"><span class="comment"># Space: O(m + n). The size of stack for recursive calls can go upto m + n.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isInterleave</span><span class="params">(self, s1: str, s2: str, s3: str)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> len(s1) + len(s2) != len(s3):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> self.is_interleave(s1, <span class="number">0</span>, s2, <span class="number">0</span>, s3)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_interleave</span><span class="params">(self, s1, i, s2, j, s3)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i == len(s1):</span><br><span class="line">            <span class="keyword">return</span> s2[j:] == s3[i + j:]</span><br><span class="line">        <span class="keyword">if</span> j == len(s2):</span><br><span class="line">            <span class="keyword">return</span> s1[i:] == s3[i + j:]</span><br><span class="line">        res = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> s1[i] == s3[i + j]:</span><br><span class="line">            res |= self.is_interleave(s1, i + <span class="number">1</span>, s2, j, s3)</span><br><span class="line">        <span class="keyword">if</span> s2[j] == s3[i + j]:</span><br><span class="line">            res |= self.is_interleave(s1, i, s2, j + <span class="number">1</span>, s3)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="recursion-with-memoization">Recursion with memoization</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn). Each (i, j) combination is computed only once.</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isInterleave</span><span class="params">(self, s1: str, s2: str, s3: str)</span> -&gt; bool:</span></span><br><span class="line">        m, n = len(s1), len(s2)</span><br><span class="line">        <span class="keyword">if</span> m + n != len(s3):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        memo = [[<span class="literal">None</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">return</span> self.is_interleave(s1, <span class="number">0</span>, s2, <span class="number">0</span>, s3, memo)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_interleave</span><span class="params">(self, s1, i, s2, j, s3, memo)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> memo[i][j] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> memo[i][j]</span><br><span class="line">        res = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> i == len(s1):</span><br><span class="line">            res = s2[j:] == s3[i + j:]</span><br><span class="line">        <span class="keyword">elif</span> j == len(s2):</span><br><span class="line">            res = s1[i:] == s3[i + j:]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> s1[i] == s3[i + j]:</span><br><span class="line">                res |= self.is_interleave(s1, i + <span class="number">1</span>, s2, j, s3, memo)</span><br><span class="line">            <span class="keyword">if</span> s2[j] == s3[i + j]:</span><br><span class="line">                res |= self.is_interleave(s1, i, s2, j + <span class="number">1</span>, s3, memo)</span><br><span class="line">        memo[i][j] = res</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p><code>dp[i][j] = true</code> if it is possible to obtain a substring <code>s3[0 .. i + j - 1]</code> by some interleaving of substring <code>s1[0 .. i - 1]</code> and <code>s2[0 .. j - 1]</code>.</p><p>Base case: <code>dp[0][0] = true</code>.</p><p>Induction rules:</p><p>For filling in the entry of <code>dp[i][j]</code>, we need to consider three cases:</p><ul><li>If <code>s3[i + j - 1] == s1[i - 1]</code>, the <code>s3[0 .. i + j - 2]</code> may formed by <code>s1[0 .. i - 2]</code> and <code>s2[0 .. j - 1]</code>. i.e. <code>dp[i][j] = dp[i - 1][j]</code>.</li><li>If <code>s3[i + j - 1] == s2[j - 1]</code>, similarily, <code>dp[i][j] = dp[i][j - 1]</code>.</li><li>If either, <code>s3[0 .. i + j - 1]</code> can't be formed by <code>s1[0 .. i - 1]</code> and <code>s2[0 .. j - 1]</code>. i.e. <code>dp[i][j] = false</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isInterleave</span><span class="params">(self, s1: str, s2: str, s3: str)</span> -&gt; bool:</span></span><br><span class="line">        m, n = len(s1), len(s2)</span><br><span class="line">        <span class="keyword">if</span> m + n != len(s3):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        dp = [[<span class="literal">False</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> i == j == <span class="number">0</span>:</span><br><span class="line">                    dp[i][j] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">elif</span> i == <span class="number">0</span>:</span><br><span class="line">                    dp[i][j] = dp[i][j - <span class="number">1</span>] <span class="keyword">and</span> s2[j - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> j == <span class="number">0</span>:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j] <span class="keyword">and</span> s1[i - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = (dp[i][j - <span class="number">1</span>] <span class="keyword">and</span> s2[j - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>]) <span class="keyword">or</span> \</span><br><span class="line">                               (dp[i - <span class="number">1</span>][j] <span class="keyword">and</span> s1[i - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[m][n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isInterleave</span><span class="params">(self, s1: str, s2: str, s3: str)</span> -&gt; bool:</span></span><br><span class="line">        m, n = len(s1), len(s2)</span><br><span class="line">        <span class="keyword">if</span> m + n != len(s3):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        dp = [<span class="literal">False</span>] * (n + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> i == j == <span class="number">0</span>:</span><br><span class="line">                    dp[j] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">elif</span> i == <span class="number">0</span>:</span><br><span class="line">                    dp[j] = dp[j - <span class="number">1</span>] <span class="keyword">and</span> s2[j - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> j == <span class="number">0</span>:</span><br><span class="line">                    dp[j] = dp[j] <span class="keyword">and</span> s1[i - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[j] = (dp[j - <span class="number">1</span>] <span class="keyword">and</span> s2[j - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>]) <span class="keyword">or</span> \</span><br><span class="line">                            (dp[j] <span class="keyword">and</span> s1[i - <span class="number">1</span>] == s3[i + j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unique Binary Search Trees</title>
      <link href="/programming/leetcode/unique-binary-search-trees/"/>
      <url>/programming/leetcode/unique-binary-search-trees/</url>
      
        <content type="html"><![CDATA[<h1 id="unique-binary-search-tree">Unique Binary Search Tree</h1><p>Given <em>n</em>, how many structurally unique <strong>BST's</strong> (binary search trees) that store values <em>1 ... n</em>?</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming">Dynamic Programming</h2><p>Let <code>dp[n]</code> denotes the number of unique BST's that store values <code>1 .. n</code>.</p><p>Base case: <code>dp[1] = 1</code>.</p><p>Induction rules:</p><p>Let <code>i</code> be the root node of a BST that store values <code>1 .. n</code>. For <code>i = 1 .. n</code>,</p><ul><li>In left subtree, values <code>1 .. i - 1</code> are stored, have <code>dp[i - 1]</code> unique structures.</li><li>In right subtree, values <code>i + 1 .. n</code> are stored. Number of unique structures is equal to <code>dp[n - i]</code>.</li></ul><a id="more"></a><p>So, we have <code>dp[i - 1] * dp[n - i]</code> unique BST's when <code>i</code> is root node. In particular, we let <code>dp[0] = 1</code>.</p><p>Therefore,</p><p><span class="math display">\[dp[n]=\sum_{i=1}^n \big(dp[i-1]*dp[n-i]\big)\]</span></p><p>e.g.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">n = 1, dp[1] = 1</span><br><span class="line">n = 2,</span><br><span class="line">    If 1 is root, we have dp[0] * dp[1] = 1 unique BST.</span><br><span class="line">    If 2 is root, we have dp[1] * dp[0] = 1 unique BST.</span><br><span class="line">n = 3,</span><br><span class="line">    If 1 is root, we have dp[0] * dp[2] = 2 unique BST&apos;s.</span><br><span class="line">    If 2 is root, we have dp[1] * dp[1] = 1 unique BST.</span><br><span class="line">    If 3 is root, we have dp[2] * dp[0] = 2 unique BST&apos;s.</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numTrees</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">        dp[<span class="number">0</span>] = dp[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> nn <span class="keyword">in</span> range(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, nn + <span class="number">1</span>):</span><br><span class="line">                dp[nn] += dp[i - <span class="number">1</span>] * dp[nn - i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure><h1 id="unique-binary-search-tree-ii">Unique Binary Search Tree II</h1><p>Given an integer <em>n</em>, generate all structurally unique <strong>BST's</strong> (binary search trees) that store values <em>1 ... n</em>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br></pre></td></tr></table></figure><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  1         3     3     2     1</span><br><span class="line">   \       /     /     / \     \</span><br><span class="line">    3     2     1     1   3     2</span><br><span class="line">   /     /       \               \</span><br><span class="line">  2     1         2               3</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming-1">Dynamic Programming</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generateTrees</span><span class="params">(self, n: int)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        dp = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(n + <span class="number">1</span>)]</span><br><span class="line">        dp[<span class="number">0</span>].append(<span class="literal">None</span>)</span><br><span class="line">        dp[<span class="number">1</span>].append(TreeNode(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> nn <span class="keyword">in</span> range(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, nn + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">for</span> left <span class="keyword">in</span> dp[i - <span class="number">1</span>]:</span><br><span class="line">                    <span class="keyword">for</span> right <span class="keyword">in</span> dp[nn - i]:</span><br><span class="line">                        dp[nn].append(TreeNode(i, left, self.clone_tree(right, i)))</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clone_tree</span><span class="params">(self, node, sift)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        clone = TreeNode(node.val + sift)</span><br><span class="line">        clone.left = self.clone_tree(node.left, sift)</span><br><span class="line">        clone.right = self.clone_tree(node.right, sift)</span><br><span class="line">        <span class="keyword">return</span> clone</span><br></pre></td></tr></table></figure><h2 id="divide-and-conquer">Divide and Conquer</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generateTrees</span><span class="params">(self, n: int)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        <span class="keyword">return</span> self.generateSubtrees(<span class="number">1</span>, n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generateSubtrees</span><span class="params">(self, s, e)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> s &gt; e:</span><br><span class="line">            <span class="keyword">return</span> [<span class="literal">None</span>]</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(s, e + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> left <span class="keyword">in</span> self.generateSubtrees(s, i - <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">for</span> right <span class="keyword">in</span> self.generateSubtrees(i + <span class="number">1</span>, e):</span><br><span class="line">                    res.append(TreeNode(i, left, right))</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> divide and conquer </tag>
            
            <tag> tree </tag>
            
            <tag> BST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Decode Ways</title>
      <link href="/programming/leetcode/decode-ways/"/>
      <url>/programming/leetcode/decode-ways/</url>
      
        <content type="html"><![CDATA[<p>A message containing letters from <code>A-Z</code> is being encoded to numbers using the follwing mapping:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;A&apos; -&gt; 1</span><br><span class="line">&apos;B&apos; -&gt; 2</span><br><span class="line">...</span><br><span class="line">&apos;Z&apos; -&gt; 26</span><br></pre></td></tr></table></figure><p>Given a <strong>non-empty</strong> string containing only digits, determine the total number of ways to decode it.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;12&quot;</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;226&quot;</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;606&quot;</span><br><span class="line">Ouput: 0</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp[i]</code> denotes the number of ways to decode the first <code>i</code> characters <code>s[0 .. i - 1]</code>.</p><a id="more"></a><p>Base cases:</p><ul><li>If <code>s[0] != '0'</code>, <code>dp[1] = 1</code>, only one decode way for one non-zero character.</li><li>If <code>s[0] == '0'</code>, <code>dp[1] = 0</code>.</li></ul><p>Induction rules:</p><p>To compute <code>dp[i]</code>, we define <code>t1 = int(s[i - 1])</code> and <code>t2 = int(s[i - 2:i])</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s      0  ... i-3 i-2 i-1</span><br><span class="line">                      |t1|</span><br><span class="line">                  |  t2  |</span><br><span class="line"></span><br><span class="line">dp  0  1  ... i-2 i-1  i</span><br></pre></td></tr></table></figure><ul><li>If <code>1 &lt;= t1 &lt;= 9</code>, then we can decode <code>t1</code> separately, there are <code>dp[i - 1]</code> ways to decode first <code>i</code> characters.</li><li>If <code>10 &lt;= t2 &lt;= 26</code>, then we can decode <code>t2</code> separately, there are <code>dp[i - 2]</code> ways to decode first <code>i</code> characters.</li></ul><p><code>dp[0]</code> is used when <code>i == 2</code>, let <code>dp[0] = 1</code> is a good idea. Or, give the base cases of <code>i = 1, 2</code>, then start from <code>i = 3</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numDecodings</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        n = len(s)</span><br><span class="line">        dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">        dp[<span class="number">0</span>], dp[<span class="number">1</span>] = <span class="number">1</span>, int(s[<span class="number">0</span>] != <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="number">1</span> &lt;= int(s[i - <span class="number">1</span>]) &lt;= <span class="number">9</span>:</span><br><span class="line">                dp[i] += dp[i - <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="number">10</span> &lt;= int(s[i - <span class="number">2</span>: i]) &lt;= <span class="number">26</span>:</span><br><span class="line">                dp[i] += dp[i - <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">numDecodings</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        n = len(s)</span><br><span class="line">        pre, res = <span class="number">1</span>, int(s[<span class="number">0</span>] != <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            nxt = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> <span class="number">1</span> &lt;= int(s[i - <span class="number">1</span>]) &lt;= <span class="number">9</span>:</span><br><span class="line">                nxt += res</span><br><span class="line">            <span class="keyword">if</span> <span class="number">10</span> &lt;= int(s[i - <span class="number">2</span>: i]) &lt;= <span class="number">26</span>:</span><br><span class="line">                nxt += pre</span><br><span class="line">            pre = res</span><br><span class="line">            res = nxt</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘æ ¼æœç´¢</title>
      <link href="/notes/introduction-to-ml-with-python/grid-search/"/>
      <url>/notes/introduction-to-ml-with-python/grid-search/</url>
      
        <content type="html"><![CDATA[<p>æ‰¾åˆ°ä¸€ä¸ªæ¨¡åž‹çš„é‡è¦å‚æ•°ï¼ˆæä¾›æœ€ä½³æ³›åŒ–æ€§èƒ½çš„å‚æ•°ï¼‰çš„å–å€¼æ˜¯ä¸€é¡¹æ£˜æ‰‹çš„ä»»åŠ¡ï¼Œä½†å¯¹äºŽå‡ ä¹Žæ‰€æœ‰æ¨¡åž‹å’Œæ•°æ®é›†æ¥è¯´éƒ½æ˜¯å¿…è¦çš„ã€‚ç”±äºŽè¿™é¡¹ä»»åŠ¡å¦‚æ­¤å¸¸è§ï¼Œæ‰€ä»¥ scikit-learn ä¸­æœ‰ä¸€äº›æ ‡å‡†æ–¹æ³•å¯ä»¥å¸®ä½ å®Œæˆã€‚æœ€å¸¸è§çš„å°±æ˜¯<strong>ç½‘æ ¼æœç´¢</strong>ï¼ˆgrid searchï¼‰ï¼Œå®ƒä¸»è¦æŒ‡å°è¯•æˆ‘ä»¬å…³å¿ƒçš„å‚æ•°çš„æ‰€æœ‰å¯èƒ½ç»„åˆã€‚</p><p>è€ƒè™‘ä¸€ä¸ªå…·æœ‰ RBFï¼ˆå¾„å‘åŸºå‡½æ•°ï¼‰æ ¸çš„æ ¸ SVM çš„ä¾‹å­ï¼Œå®ƒåœ¨ SVC ç±»ä¸­å®žçŽ°ã€‚å®ƒæœ‰ 2 ä¸ªé‡è¦å‚æ•°ï¼šæ ¸å®½åº¦ gamma æ ¸æ­£åˆ™åŒ–å‚æ•° Cã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›å°è¯• C çš„å–å€¼ä¸º 0.001ã€0.01ã€0.1ã€1ã€10 å’Œ 100ï¼Œgamma ä¹Ÿå–è¿™ 6 ä¸ªå€¼ï¼Œæ‰€ä»¥æ€»å…±æœ‰ 36 ç§å‚æ•°ç»„åˆã€‚</p><a id="more"></a><h1 id="ç®€å•ç½‘æ ¼æœç´¢">ç®€å•ç½‘æ ¼æœç´¢</h1><p>æˆ‘ä»¬å¯ä»¥å®žçŽ°ä¸€ä¸ªç®€å•çš„ç½‘æ ¼æœç´¢ï¼Œåœ¨ 2 ä¸ªå‚æ•°ä¸Šä½¿ç”¨ for å¾ªçŽ¯ï¼Œå¯¹æ¯ç§å‚æ•°ç»„åˆåˆ†åˆ«è®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªåˆ†ç±»å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç®€å•çš„ç½‘æ ¼æœç´¢å®žçŽ°</span></span><br><span class="line">iris = load_iris()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    iris.data, iris.target, random_state=<span class="number">0</span>)</span><br><span class="line">print(<span class="string">'Size of training set: &#123;&#125;  size of test set: &#123;&#125;'</span>.format(</span><br><span class="line">    X_train.shape[<span class="number">0</span>], X_test.shape[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">best_score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> gamma <span class="keyword">in</span> [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]:</span><br><span class="line">    <span class="keyword">for</span> C <span class="keyword">in</span> [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]:</span><br><span class="line">        <span class="comment"># å¯¹æ¯ç§å‚æ•°ç»„åˆéƒ½è®­ç»ƒä¸€ä¸ªSVC</span></span><br><span class="line">        svm = SVC(gamma=gamma, C=C)</span><br><span class="line">        svm.fit(X_train, y_train)</span><br><span class="line">        <span class="comment"># åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°SVC</span></span><br><span class="line">        score = svm.score(X_test, y_test)</span><br><span class="line">        <span class="keyword">if</span> score &gt; best_score:</span><br><span class="line">            best_score = score</span><br><span class="line">            best_parameters = &#123;<span class="string">'C'</span>: C, <span class="string">'gamma'</span>: gamma&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Best score: &#123;:.2f&#125;'</span>.format(best_score))</span><br><span class="line">print(<span class="string">'Best parameters: &#123;&#125;'</span>.format(best_parameters))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Size of training set: 112  size of test set: 38</span><br><span class="line">Best score: 0.97</span><br><span class="line">Best parameters: &#123;&apos;C&apos;: 100, &apos;gamma&apos;: 0.001&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚æ•°è¿‡æ‹Ÿåˆçš„é£Žé™©ä¸ŽéªŒè¯é›†">å‚æ•°è¿‡æ‹Ÿåˆçš„é£Žé™©ä¸ŽéªŒè¯é›†</h1><p>çœ‹åˆ°è¿™ä¸ªç»“æžœï¼Œæˆ‘ä»¬å¯èƒ½å¿ä¸ä½è¦æŠ¥å‘Šï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªåœ¨æ•°æ®é›†ä¸Šç²¾åº¦è¾¾åˆ° 97% çš„æ¨¡åž‹ã€‚ç„¶è€Œï¼Œè¿™ç§è¯´æ³•å¯èƒ½è¿‡äºŽä¹è§‚äº†ï¼ˆæˆ–è€…å°±æ˜¯é”™è¯¯çš„ï¼‰ï¼Œå…¶åŽŸå› å¦‚ä¸‹ï¼šæˆ‘ä»¬å°è¯•äº†è®¸å¤šä¸åŒçš„å‚æ•°ï¼Œå¹¶é€‰æ‹©äº†åœ¨æµ‹è¯•é›†ä¸Šç²¾åº¦æœ€é«˜çš„é‚£ä¸ªï¼Œä½†è¿™ä¸ªç²¾åº¦ä¸ä¸€å®šèƒ½æŽ¨å¹¿åˆ°æ–°æ•°æ®ä¸Šã€‚<strong>ç”±äºŽæˆ‘ä»¬ä½¿ç”¨æµ‹è¯•æ•°æ®è¿›è¡Œè°ƒå‚ï¼Œæ‰€ä»¥ä¸èƒ½å†ç”¨å®ƒæ¥è¯„ä¼°æ¨¡åž‹çš„å¥½åã€‚</strong>æˆ‘ä»¬æœ€å¼€å§‹éœ€è¦å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŽŸå› ã€‚<strong>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®é›†æ¥è¿›è¡Œè¯„ä¼°ï¼Œä¸€ä¸ªåœ¨åˆ›å»ºæ¨¡åž‹æ—¶æ²¡æœ‰ç”¨åˆ°çš„æ•°æ®é›†ã€‚</strong></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯å†æ¬¡åˆ’åˆ†æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å¾—åˆ°äº† 3 ä¸ªæ•°æ®é›†ï¼šç”¨äºŽæž„å»ºæ¨¡åž‹çš„è®­ç»ƒé›†ï¼Œç”¨äºŽé€‰æ‹©æ¨¡åž‹çš„éªŒè¯é›†ï¼ˆå¼€å‘é›†ï¼‰ï¼Œç”¨äºŽè¯„ä¼°æ‰€é€‰å‚æ•°æ€§èƒ½çš„æµ‹è¯•é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_threefold_split()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/threefold-split.png"></p><p><strong>åˆ©ç”¨éªŒè¯é›†é€‰å®šæœ€ä½³å‚æ•°ä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°çš„å‚æ•°è®¾ç½®é‡æ–°æž„å»ºä¸€ä¸ªæ¨¡åž‹ï¼Œä½†æ˜¯è¦åŒæ—¶åœ¨è®­ç»ƒæ•°æ®å’ŒéªŒè¯æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒã€‚</strong>è¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å°½å¯èƒ½å¤šçš„æ•°æ®æ¥æž„å»ºæ¨¡åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒ+éªŒè¯é›†ä¸Žæµ‹è¯•é›†</span></span><br><span class="line">X_trainval, X_test, y_trainval, y_test = train_test_split(</span><br><span class="line">    iris.data, iris.target, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># å°†è®­ç»ƒ+éªŒè¯é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†</span></span><br><span class="line">X_train, X_valid, y_train, y_valid = train_test_split(</span><br><span class="line">    X_trainval, y_trainval, random_state=<span class="number">1</span>)</span><br><span class="line">print(<span class="string">'Size of training set: &#123;&#125;  size of validation set: &#123;&#125;  size of test set: &#123;&#125;'</span>.format(</span><br><span class="line">    X_train.shape[<span class="number">0</span>], X_valid.shape[<span class="number">0</span>], X_test.shape[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">best_score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> gamma <span class="keyword">in</span> [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]:</span><br><span class="line">    <span class="keyword">for</span> C <span class="keyword">in</span> [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]:</span><br><span class="line">        <span class="comment"># å¯¹æ¯ç§å‚æ•°ç»„åˆéƒ½è®­ç»ƒä¸€ä¸ªSVC</span></span><br><span class="line">        svm = SVC(gamma=gamma, C=C)</span><br><span class="line">        svm.fit(X_train, y_train)</span><br><span class="line">        <span class="comment"># åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°SVC</span></span><br><span class="line">        score = svm.score(X_valid, y_valid)</span><br><span class="line">        <span class="keyword">if</span> score &gt; best_score:</span><br><span class="line">            best_score = score</span><br><span class="line">            best_parameters = &#123;<span class="string">'C'</span>: C, <span class="string">'gamma'</span>: gamma&#125;</span><br><span class="line"><span class="comment"># åœ¨è®­ç»ƒ+éªŒè¯é›†ä¸Šé‡æ–°æž„å»ºä¸€ä¸ªæ¨¡åž‹ï¼Œå¹¶åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°</span></span><br><span class="line">svm = SVC(**best_parameters)</span><br><span class="line">svm.fit(X_trainval, y_trainval)</span><br><span class="line">test_score = svm.score(X_test, y_test)</span><br><span class="line">print(<span class="string">'Best score on validation set: &#123;:.2f&#125;'</span>.format(best_score))</span><br><span class="line">print(<span class="string">'Best parameters: &#123;&#125;'</span>.format(best_parameters))</span><br><span class="line">print(<span class="string">'Test set score with best parameters: &#123;:.2f&#125;'</span>.format(test_score))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Size of training set: 84  size of validation set: 28  size of test set: 38</span><br><span class="line">Best score on validation set: 0.96</span><br><span class="line">Best parameters: &#123;&apos;C&apos;: 10, &apos;gamma&apos;: 0.001&#125;</span><br><span class="line">Test set score with best parameters: 0.92</span><br></pre></td></tr></table></figure><p>éªŒè¯é›†ä¸Šçš„æœ€é«˜åˆ†æ•°æ˜¯ 96%ï¼Œè¿™æ¯”ä¹‹å‰ç•¥ä½Žï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†æ›´å°‘çš„æ•°æ®æ¥è®­ç»ƒæ¨¡åž‹ã€‚æµ‹è¯•é›†ä¸Šçš„åˆ†æ•°æ›´ä½Žï¼Œä¸º 92%ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªèƒ½å£°ç§°å¯¹ 92% çš„æ–°æ•°æ®æ­£ç¡®åˆ†ç±»ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¹‹å‰è®¤ä¸ºçš„ 97%ã€‚</p><p>è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ä¹‹é—´çš„åŒºåˆ«å¯¹äºŽåœ¨å®žè·µä¸­åº”ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•è‡³å…³é‡è¦ã€‚ä»»ä½•æ ¹æ®æµ‹è¯•é›†ç²¾åº¦æ‰€åšçš„é€‰æ‹©éƒ½ä¼šå°†æµ‹è¯•é›†çš„ä¿¡æ¯â€œæ³„æ¼â€ï¼ˆleakï¼‰åˆ°æ¨¡åž‹ä¸­ã€‚å› æ­¤ï¼Œ<strong>ä¿ç•™ä¸€ä¸ªå•ç‹¬çš„æµ‹è¯•é›†æ˜¯å¾ˆé‡è¦çš„ï¼Œå®ƒä»…ç”¨äºŽæœ€ç»ˆè¯„ä¼°ã€‚</strong>ä¸¥æ ¼æ¥è¯´ï¼Œåœ¨æµ‹è¯•é›†ä¸Šå¯¹ä¸æ­¢ä¸€ä¸ªæ¨¡åž‹è¿›è¡Œè¯„ä¼°å¹¶é€‰æ‹©æ›´å¥½çš„é‚£ä¸ªï¼Œå°†ä¼šå¯¼è‡´å¯¹æ¨¡åž‹ç²¾åº¦è¿‡äºŽä¹è§‚çš„ä¼°è®¡ã€‚</p><h1 id="å¸¦äº¤å‰éªŒè¯çš„ç½‘æ ¼æœç´¢">å¸¦äº¤å‰éªŒè¯çš„ç½‘æ ¼æœç´¢</h1><p>è™½ç„¶å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†çš„æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä¹Ÿç›¸å¯¹å¸¸ç”¨ï¼Œä½†è¿™ç§æ–¹æ³•å¯¹æ•°æ®çš„åˆ’åˆ†æ–¹æ³•ç›¸å½“æ•æ„Ÿã€‚ä¸ºäº†å¾—åˆ°å¯¹æ³›åŒ–æ€§èƒ½çš„æ›´å¥½ä¼°è®¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äº¤å‰éªŒè¯æ¥è¯„ä¼°æ¯ç§å‚æ•°ç»„åˆçš„æ€§èƒ½ï¼Œè€Œä¸æ˜¯ä»…å°†æ•°æ®å•æ¬¡åˆ’åˆ†ä¸ºè®­ç»ƒé›†ä¸ŽéªŒè¯é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> gamma <span class="keyword">in</span> [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]:</span><br><span class="line">    <span class="keyword">for</span> C <span class="keyword">in</span> [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]:</span><br><span class="line">        <span class="comment"># å¯¹æ¯ç§å‚æ•°ç»„åˆéƒ½è®­ç»ƒä¸€ä¸ªSVC</span></span><br><span class="line">        svm = SVC(gamma=gamma, C=C)</span><br><span class="line">        svm.fit(X_train, y_train)</span><br><span class="line">        <span class="comment"># æ‰§è¡Œäº¤å‰éªŒè¯</span></span><br><span class="line">        scores = cross_val_score(svm, X_trainval, y_trainval, cv=<span class="number">5</span>)</span><br><span class="line">        <span class="comment"># è®¡ç®—äº¤å‰éªŒè¯çš„å¹³å‡ç²¾åº¦</span></span><br><span class="line">        score = np.mean(scores)</span><br><span class="line">        <span class="keyword">if</span> score &gt; best_score:</span><br><span class="line">            best_score = score</span><br><span class="line">            best_parameters = &#123;<span class="string">'C'</span>: C, <span class="string">'gamma'</span>: gamma&#125;</span><br><span class="line"><span class="comment"># åœ¨è®­ç»ƒ+éªŒè¯é›†ä¸Šé‡æ–°æž„å»ºä¸€ä¸ªæ¨¡åž‹ï¼Œå¹¶åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°</span></span><br><span class="line">svm = SVC(**best_parameters)</span><br><span class="line">svm.fit(X_trainval, y_trainval)</span><br></pre></td></tr></table></figure><p>è¦æƒ³ä½¿ç”¨ 5 æŠ˜äº¤å‰éªŒè¯å¯¹ C å’Œ gamma ç‰¹å®šå–å€¼çš„ SVM çš„ç²¾åº¦è¿›è¡Œè¯„ä¼°ï¼Œéœ€è¦è®­ç»ƒ 36 x 5 = 180 ä¸ªæ¨¡åž‹ã€‚ä½ å¯ä»¥æƒ³è±¡ï¼Œä½¿ç”¨äº¤å‰éªŒè¯çš„ä¸»è¦ç¼ºç‚¹å°±æ˜¯è®­ç»ƒæ‰€æœ‰è¿™äº›æ¨¡åž‹æ‰€éœ€èŠ±è´¹çš„æ—¶é—´ã€‚</p><p>ä¸‹é¢çš„å¯è§†åŒ–è¯´æ˜Žäº†ä¸Šè¿°ä»£ç å¦‚ä½•é€‰æ‹©æœ€ä½³å‚æ•°è®¾ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_cross_val_selection()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/cross-val-grid-search.png"></p><p>å¯¹äºŽæ¯ç§å‚æ•°è®¾ç½®ï¼ˆå›¾ä¸­ä»…æ˜¾ç¤ºäº†ä¸€éƒ¨åˆ†ï¼‰ï¼Œéœ€è¦è®¡ç®— 5 ä¸ªç²¾åº¦å€¼ï¼Œäº¤å‰éªŒè¯çš„æ¯æ¬¡åˆ’åˆ†éƒ½è¦è®¡ç®—ä¸€ä¸ªç²¾åº¦å€¼ã€‚ç„¶åŽï¼Œå¯¹æ¯ç§å‚æ•°è®¾ç½®è®¡ç®—å¹³å‡éªŒè¯ç²¾åº¦ã€‚æœ€åŽï¼Œé€‰æ‹©å¹³å‡éªŒè¯ç²¾åº¦æœ€é«˜çš„å‚æ•°ï¼Œç”¨åœ†åœˆæ ‡è®°ã€‚</p><blockquote><p>äº¤å‰éªŒè¯æ˜¯åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šå¯¹ç»™å®šæ¨¡åž‹è¿›è¡Œè¯„ä¼°çš„ä¸€ç§æ–¹æ³•ã€‚ä½†å®ƒé€šå¸¸ä¸Žç½‘æ ¼æœç´¢ç­‰å‚æ•°æœç´¢æ–¹æ³•ç»“åˆä½¿ç”¨ã€‚å› æ­¤ï¼Œè®¸å¤šäººä½¿ç”¨<strong>äº¤å‰éªŒè¯</strong>ï¼ˆcross-validationï¼‰è¿™ä¸€æœ¯è¯­æ¥é€šä¿—åœ°æŒ‡ä»£å¸¦äº¤å‰éªŒè¯çš„ç½‘æ ¼æœç´¢ã€‚</p></blockquote><p>ç”±äºŽå¸¦äº¤å‰éªŒè¯çš„ç½‘æ ¼æœç´¢æ˜¯ä¸€ç§å¸¸ç”¨çš„è°ƒå‚æ–¹æ³•ï¼Œå› æ­¤ scikit-learn æä¾›äº† GridSearchCV ç±»ï¼Œå®ƒä»¥ä¼°è®¡å™¨ï¼ˆestimatorï¼‰çš„å½¢å¼å®žçŽ°äº†è¿™ç§æ–¹æ³•ã€‚è¦ä½¿ç”¨ GridSearchCV ç±»ï¼Œä½ é¦–å…ˆéœ€è¦ç”¨ä¸€ä¸ªå­—å…¸æŒ‡å®šè¦æœç´¢çš„å‚æ•°ã€‚ç„¶åŽ GridSearchCV ä¼šæ‰§è¡Œæ‰€æœ‰å¿…è¦çš„æ¨¡åž‹æ‹Ÿåˆã€‚å­—å…¸çš„é”®æ˜¯æˆ‘ä»¬è¦è°ƒèŠ‚çš„å‚æ•°åç§°ï¼Œå­—å…¸çš„å€¼æ˜¯æˆ‘ä»¬æƒ³è¦å°è¯•çš„å‚æ•°è®¾ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¦‚æžœ C å’Œ gamma æƒ³è¦å°è¯•çš„å–å€¼ä¸º 0.001ã€0.01ã€0.1ã€1ã€10 å’Œ 100</span></span><br><span class="line"><span class="comment"># å¯ä»¥å°†å…¶è½¬åŒ–ä¸ºä¸‹é¢è¿™ä¸ªå­—å…¸</span></span><br><span class="line">param_grid = &#123;<span class="string">'C'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>],</span><br><span class="line">              <span class="string">'gamma'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"><span class="comment"># å°† GridSearchCV å®žä¾‹åŒ–</span></span><br><span class="line">grid_search = GridSearchCV(SVC(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GridSearchCV å°†ä½¿ç”¨äº¤å‰éªŒè¯æ¥ä»£æ›¿ä¹‹å‰çš„åˆ’åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†æ–¹æ³•</span></span><br><span class="line"><span class="comment"># ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»éœ€è¦å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œä»¥é¿å…å‚æ•°è¿‡æ‹Ÿåˆ</span></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    iris.data, iris.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºçš„ grid_search å¯¹è±¡çš„è¡Œä¸ºå°±åƒä¸€ä¸ªåˆ†ç±»å™¨</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥å¯¹å®ƒè°ƒç”¨æ ‡å‡†çš„ fitã€predict å’Œ score æ–¹æ³•</span></span><br><span class="line"><span class="comment"># ä½†æˆ‘ä»¬åœ¨è°ƒç”¨ fit æ—¶ï¼Œå®ƒä¼šå¯¹ param_grid æŒ‡å®šçš„æ¯ç§å‚æ•°ç»„åˆéƒ½è¿è¡Œäº¤å‰éªŒè¯</span></span><br><span class="line">grid_search.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹Ÿåˆ GridSearchCV å¯¹è±¡ä¸ä»…ä¼šæœç´¢æœ€ä½³å‚æ•°ï¼Œè¿˜ä¼šåˆ©ç”¨å¾—åˆ°çš„æœ€ä½³å‚æ•°åœ¨æ•´ä¸ª</span></span><br><span class="line"><span class="comment"># è®­ç»ƒæ•°æ®é›†ä¸Šè‡ªåŠ¨æ‹Ÿåˆä¸€ä¸ªæ–°æ¨¡åž‹</span></span><br><span class="line"><span class="comment"># GridSearchCV ç±»æä¾›äº†éžå¸¸æ–¹ä¾¿çš„æŽ¥å£ï¼Œå¯ä»¥ç”¨ predict å’Œ score æ–¹æ³•æ¥è®¿é—®</span></span><br><span class="line"><span class="comment"># é‡æ–°è®­ç»ƒè¿‡çš„æ¨¡åž‹</span></span><br><span class="line"><span class="comment"># ä¸ºäº†è¯„ä¼°æ‰¾åˆ°çš„æœ€ä½³å‚æ•°çš„æ³›åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•é›†ä¸Šè°ƒç”¨ score</span></span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(grid_search.score(X_test, y_test)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬æ‰¾åˆ°çš„å‚æ•°ä¿å­˜åœ¨ best_params_ å±žæ€§ä¸­ï¼Œè€Œäº¤å‰éªŒè¯æœ€ä½³ç²¾åº¦ä¿å­˜åœ¨ best_score_ ä¸­</span></span><br><span class="line">print(<span class="string">'Best parameters: &#123;&#125;'</span>.format(grid_search.best_params_))</span><br><span class="line">print(<span class="string">'Best cross-validation score: &#123;:.2f&#125;'</span>.format(grid_search.best_score_))</span><br><span class="line"></span><br><span class="line"><span class="comment"># èƒ½å¤Ÿè®¿é—®å®žé™…æ‰¾åˆ°çš„æ¨¡åž‹ï¼Œè¿™æœ‰æ—¶æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œæ¯”å¦‚æŸ¥çœ‹ç³»æ•°æˆ–ç‰¹å¾é‡è¦æ€§</span></span><br><span class="line"><span class="comment"># ä½ å¯ä»¥ç”¨ best_estimator_ å±žæ€§æ¥è®¿é—®æœ€ä½³å‚æ•°å¯¹åº”çš„æ¨¡åž‹</span></span><br><span class="line"><span class="comment"># ç”±äºŽ grid_search æœ¬èº«å…·æœ‰ predict å’Œ score æ–¹æ³•</span></span><br><span class="line"><span class="comment"># æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨ best_estimator_ æ¥è¿›è¡Œé¢„æµ‹å’Œè¯„ä¼°æ¨¡åž‹</span></span><br><span class="line">print(<span class="string">'Best estimator:\n&#123;&#125;'</span>.format(grid_search.best_estimator_))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test set score: 0.97</span><br><span class="line">Best parameters: &#123;&apos;C&apos;: 100, &apos;gamma&apos;: 0.01&#125;</span><br><span class="line">Best cross-validation score: 0.97</span><br><span class="line">Best estimator:</span><br><span class="line">SVC(C=100, cache_size=200, class_weight=None, coef0=0.0,</span><br><span class="line">    decision_function_shape=&apos;ovr&apos;, degree=3, gamma=0.01, kernel=&apos;rbf&apos;,</span><br><span class="line">    max_iter=-1, probability=False, random_state=None, shrinking=True,</span><br><span class="line">    tol=0.001, verbose=False)</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨äº¤å‰éªŒè¯é€‰æ‹©å‚æ•°ï¼Œæˆ‘ä»¬å®žé™…ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªåœ¨æµ‹è¯•é›†ä¸Šç²¾åº¦ä¸º 97% çš„æ¨¡åž‹ã€‚é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬<strong>æ²¡æœ‰ä½¿ç”¨æµ‹è¯•é›†</strong>åœ¨é€‰æ‹©å‚æ•°ã€‚</p><p>æ³¨æ„ä¸è¦å°† <code>best_score_</code> ä¸Ž æ¨¡åž‹åœ¨æµ‹è¯•é›†ä¸Šè°ƒç”¨ <code>score</code> æ–¹æ³•è®¡ç®—å¾—åˆ°çš„æ³›åŒ–æ€§èƒ½å¼„æ··ã€‚ä½¿ç”¨ <code>score</code> æ–¹æ³•ï¼ˆæˆ–è€…å¯¹ <code>predict</code> æ–¹æ³•çš„è¾“å‡ºç»“æžœè¿›è¡Œè¯„ä¼°ï¼‰é‡‡ç”¨çš„æ˜¯<strong>åœ¨æ•´ä¸ªè®­ç»ƒé›†ä¸Š</strong>è®­ç»ƒçš„æ¨¡åž‹ã€‚è€Œ <code>best_score_</code> å±žæ€§ä¿å­˜çš„æ˜¯äº¤å‰éªŒè¯çš„å¹³å‡ç²¾åº¦ï¼Œæ˜¯<strong>åœ¨è®­ç»ƒé›†ä¸Šè¿›è¡Œäº¤å‰éªŒè¯</strong>å¾—åˆ°çš„ã€‚</p><h2 id="åˆ†æžäº¤å‰éªŒè¯çš„ç»“æžœ">åˆ†æžäº¤å‰éªŒè¯çš„ç»“æžœ</h2><p>å°†äº¤å‰éªŒè¯çš„ç»“æžœå¯è§†åŒ–é€šå¸¸æœ‰åŠ©äºŽç†è§£æ¨¡åž‹æ³›åŒ–èƒ½åŠ›å¯¹æ‰€æœç´¢å‚æ•°çš„ä¾èµ–å…³ç³»ã€‚ç”±äºŽè¿è¡Œç½‘æ ¼æœç´¢çš„è®¡ç®—æˆæœ¬ç›¸å½“é«˜ï¼Œæ‰€ä»¥é€šå¸¸æœ€å¥½ä»Žç›¸å¯¹æ¯”è¾ƒç¨€ç–ä¸”è¾ƒå°çš„ç½‘æ ¼å¼€å§‹æœç´¢ã€‚ç„¶åŽæˆ‘ä»¬å¯ä»¥æ£€æŸ¥äº¤å‰éªŒè¯ç½‘æ ¼æœç´¢çš„ç»“æžœï¼Œå¯èƒ½ä¹Ÿä¼šæ‰©å±•æœç´¢èŒƒå›´ã€‚ç½‘æ ¼æœç´¢çš„ç»“æžœå¯ä»¥åœ¨ <code>cv_results_</code> å±žæ€§ä¸­æ‰¾åˆ°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­ä¿å­˜äº†æœç´¢çš„æ‰€æœ‰å†…å®¹ã€‚å®ƒé‡Œé¢åŒ…å«è®¸å¤šç»†èŠ‚ï¼Œæœ€å¥½å°†å…¶è½¬æ¢æˆ pandas æ•°æ®æ¡†åŽæŸ¥çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">results = pd.DataFrame(grid_search.cv_results_)</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå‰ 5 è¡Œ</span></span><br><span class="line">display(results.head())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   mean_fit_time  std_fit_time  ...  std_test_score  rank_test_score</span><br><span class="line">0       0.000551      0.000136  ...        0.011371               22</span><br><span class="line">1       0.000453      0.000039  ...        0.011371               22</span><br><span class="line">2       0.000471      0.000039  ...        0.011371               22</span><br><span class="line">3       0.000438      0.000004  ...        0.011371               22</span><br><span class="line">4       0.000459      0.000028  ...        0.011371               22</span><br><span class="line"></span><br><span class="line">[5 rows x 15 columns]</span><br></pre></td></tr></table></figure><p>results ä¸­æ¯ä¸€è¡Œå¯¹åº”ä¸€ç§ç‰¹å®šçš„å‚æ•°è®¾ç½®ã€‚å¯¹äºŽæ¯ç§å‚æ•°è®¾ç½®ï¼Œäº¤å‰éªŒè¯æ‰€æœ‰åˆ’åˆ†çš„ç»“æžœéƒ½è¢«è®°å½•ä¸‹æ¥ï¼Œæ‰€æœ‰åˆ’åˆ†çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®ä¹Ÿè¢«è®°å½•ä¸‹æ¥ã€‚ç”±äºŽæˆ‘ä»¬æœç´¢çš„æ˜¯ä¸€ä¸ªäºŒç»´å‚æ•°ç½‘æ ¼ï¼ˆC å’Œ gammaï¼‰ï¼Œæ‰€ä»¥æœ€é€‚åˆç”¨çƒ­å›¾å¯è§†åŒ–ã€‚æˆ‘ä»¬é¦–å…ˆæå–å¹³å‡éªŒè¯åˆ†æ•°ï¼Œç„¶åŽæ”¹å˜åˆ†æ•°æ•°ç»„çš„å½¢çŠ¶ï¼Œä½¿å…¶åæ ‡è½´åˆ†åˆ«å¯¹åº”äºŽ C å’Œ gammaï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">scores = np.array(results.mean_test_score).reshape(<span class="number">6</span>, <span class="number">6</span>)</span><br><span class="line"><span class="comment"># å¯¹äº¤å‰éªŒè¯å¹³å‡åˆ†æ•°ä½œå›¾</span></span><br><span class="line">mglearn.tools.heatmap(scores, xlabel=<span class="string">'gamma'</span>, xticklabels=param_grid[<span class="string">'gamma'</span>],</span><br><span class="line">    ylabel=<span class="string">'C'</span>, yticklabels=param_grid[<span class="string">'C'</span>], cmap=<span class="string">'viridis'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/grid-search-heatmap.png"></p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒSVC å¯¹å‚æ•°è®¾ç½®éžå¸¸æ•æ„Ÿã€‚å¯¹äºŽè®¸å¤šç§å‚æ•°è®¾ç½®ï¼Œç²¾åº¦éƒ½åœ¨ 40% å·¦å³ï¼Œè¿™æ˜¯éžå¸¸ç³Ÿç³•çš„ï¼›å¯¹äºŽå…¶ä»–å‚æ•°è®¾ç½®ï¼Œç²¾åº¦çº¦ä¸º 96%ã€‚æˆ‘ä»¬å¯ä»¥ä»Žè¿™å¼ å›¾ä¸­çœ‹å‡ºä»¥ä¸‹å‡ ç‚¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒèŠ‚çš„å‚æ•°å¯¹äºŽèŽ·å¾—è‰¯å¥½çš„æ€§èƒ½<strong>éžå¸¸é‡è¦</strong>ã€‚è¿™ä¸¤ä¸ªå‚æ•° éƒ½å¾ˆé‡è¦ï¼Œå› ä¸ºè°ƒèŠ‚å®ƒä»¬å¯ä»¥å°†ç²¾åº¦ä»Ž 40% æé«˜åˆ° 96%ã€‚æ­¤å¤–ï¼Œåœ¨æˆ‘ä»¬é€‰æ‹©çš„å‚æ•°èŒƒå›´ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°è¾“å‡ºå‘ç”Ÿäº†æ˜¾è‘—çš„å˜åŒ–ã€‚åŒæ ·é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå‚æ•°çš„èŒƒå›´è¦è¶³å¤Ÿå¤§ï¼šæ¯ä¸ªå‚æ•°çš„æœ€ä½³å–å€¼ä¸èƒ½ä½äºŽå›¾åƒçš„è¾¹ç•Œä¸Šã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹å‡ å¼ å›¾ï¼Œå…¶ç»“æžœä¸é‚£ä¹ˆç†æƒ³ï¼Œå› ä¸ºé€‰æ‹©çš„æœç´¢èŒƒå›´ä¸åˆé€‚ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">3</span>, figsize=(<span class="number">13</span>, <span class="number">5</span>))</span><br><span class="line">param_grid_linear = &#123;<span class="string">'C'</span>: np.linspace(<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>),</span><br><span class="line">                     <span class="string">'gamma'</span>: np.linspace(<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>)&#125;</span><br><span class="line"></span><br><span class="line">param_grid_one_log = &#123;<span class="string">'C'</span>: np.linspace(<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>),</span><br><span class="line">                     <span class="string">'gamma'</span>: np.logspace(<span class="number">-3</span>, <span class="number">2</span>, <span class="number">6</span>)&#125;</span><br><span class="line"></span><br><span class="line">param_grid_range = &#123;<span class="string">'C'</span>: np.logspace(<span class="number">-3</span>, <span class="number">2</span>, <span class="number">6</span>),</span><br><span class="line">                     <span class="string">'gamma'</span>: np.logspace(<span class="number">-7</span>, <span class="number">-2</span>, <span class="number">6</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> param_grid, ax <span class="keyword">in</span> zip([param_grid_linear, param_grid_one_log, </span><br><span class="line">                           param_grid_range], axes):</span><br><span class="line">    grid_search = GridSearchCV(SVC(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">    grid_search.fit(X_train, y_train)</span><br><span class="line">    scores = grid_search.cv_results_[<span class="string">'mean_test_score'</span>].reshape(<span class="number">6</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    scores_image = mglearn.tools.heatmap(scores, xlabel=<span class="string">'gamma'</span>,</span><br><span class="line">        ylabel=<span class="string">'C'</span>, xticklabels=param_grid[<span class="string">'gamma'</span>],</span><br><span class="line">        yticklabels=param_grid[<span class="string">'C'</span>], cmap=<span class="string">'viridis'</span>, ax=ax)</span><br><span class="line"></span><br><span class="line">plt.colorbar(scores_image, ax=axes.tolist())</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/grid-search-heatmaps.png"></p><p>ç¬¬ä¸€å¼ å›¾æ²¡æœ‰æ˜¾ç¤ºä»»ä½•å˜åŒ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ç”±å‚æ•° C å’Œ gamma ä¸æ­£ç¡®çš„ç¼©æ”¾ä»¥åŠä¸æ­£ç¡®çš„èŒƒå›´é€ æˆçš„ã€‚ä½†å¦‚æžœå¯¹äºŽä¸åŒçš„å‚æ•°è®¾ç½®éƒ½çœ‹ä¸åˆ°ç²¾åº¦çš„å˜åŒ–ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªå‚æ•°æ ¹æœ¬ä¸é‡è¦ã€‚<strong>é€šå¸¸æœ€å¥½åœ¨å¼€å§‹æ—¶å°è¯•éžå¸¸æžç«¯çš„å€¼ï¼Œä»¥è§‚å¯Ÿæ”¹å˜å‚æ•°æ˜¯å¦ä¼šå¯¼è‡´ç²¾åº¦å‘ç”Ÿå˜åŒ–ã€‚</strong></p><p>ç¬¬äºŒå¼ å›¾æ˜¾ç¤ºçš„æ˜¯åž‚ç›´æ¡å½¢æ¨¡å¼ã€‚è¿™è¡¨ç¤ºåªæœ‰ gamma çš„è®¾ç½®å¯¹ç²¾åº¦æœ‰å½±å“ã€‚è¿™å¯èƒ½æ„å‘³ç€ gamma å‚æ•°çš„æœç´¢èŒƒå›´æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„ï¼Œè€Œ C å‚æ•°å¹¶ä¸æ˜¯â€”â€”ä¹Ÿå¯èƒ½æ„å‘³ç€ C å‚æ•°å¹¶ä¸é‡è¦ã€‚</p><p>ç¬¬ä¸‰å¼ å›¾ä¸­ C å’Œ gamma å¯¹åº”çš„ç²¾åº¦éƒ½æœ‰å˜åŒ–ã€‚ä½†å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å›¾åƒçš„æ•´ä¸ªå·¦ä¸‹è§’éƒ½æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆæœ‰è¶£çš„äº‹æƒ…ã€‚æˆ‘ä»¬åœ¨åŽé¢çš„ç½‘æ ¼æœç´¢ä¸­å¯ä»¥ä¸è€ƒè™‘éžå¸¸å°çš„å€¼ã€‚æœ€ä½³å‚æ•°è®¾ç½®å‡ºçŽ°åœ¨å³ä¸Šè§’ã€‚ç”±äºŽæœ€ä½³å‚æ•°ä½äºŽå›¾åƒçš„è¾¹ç•Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œåœ¨è¿™ä¸ªè¾¹ç•Œä¹‹å¤–å¯èƒ½è¿˜æœ‰æ›´å¥½çš„å–å€¼ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æ”¹å˜æœç´¢èŒƒå›´ä»¥åŒ…å«è¿™ä¸€åŒºåŸŸå†…çš„æ›´å¤šå‚æ•°ã€‚</p><p>åŸºäºŽäº¤å‰éªŒè¯åˆ†æ•°æ¥è°ƒèŠ‚å‚æ•°ç½‘æ ¼æ˜¯éžå¸¸å¥½çš„ï¼Œä¹Ÿæ˜¯æŽ¢ç´¢ä¸åŒå‚æ•°çš„é‡è¦æ€§çš„å¥½æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œä½ ä¸åº”è¯¥åœ¨æœ€ç»ˆæµ‹è¯•é›†ä¸Šæµ‹è¯•ä¸åŒçš„å‚æ•°èŒƒå›´ï¼ˆåœ¨éªŒè¯é›†ä¸Šè¿›è¡Œè°ƒå‚ï¼‰â€”â€”åªæœ‰ç¡®åˆ‡çŸ¥é“äº†æƒ³è¦ä½¿ç”¨çš„æ¨¡åž‹ï¼Œæ‰èƒ½å¯¹æµ‹è¯•é›†è¿›è¡Œè¯„ä¼°ï¼ˆåœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°ï¼‰ã€‚</p><h2 id="åœ¨éžç½‘æ ¼çš„ç©ºé—´ä¸­æœç´¢">åœ¨éžç½‘æ ¼çš„ç©ºé—´ä¸­æœç´¢</h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°è¯•æ‰€æœ‰å‚æ•°çš„æ‰€æœ‰å¯èƒ½ç»„åˆå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¾‹å¦‚ï¼ŒSVC æœ‰ä¸€ä¸ª kernel å‚æ•°ï¼Œæ ¹æ®æ‰€é€‰æ‹©çš„ kernelï¼ˆå†…æ ¸ï¼‰ï¼Œå…¶ä»–å‚æ•°ä¹Ÿæ˜¯ä¸Žä¹‹ç›¸å…³çš„ã€‚å¦‚æžœ <code>kernel='linear'</code>ï¼Œé‚£ä¹ˆæ¨¡åž‹æ˜¯çº¿æ€§çš„ï¼Œåªä¼šç”¨åˆ° C å‚æ•°ã€‚å¦‚æžœ <code>kernel='rbf'</code>ï¼Œåˆ™éœ€è¦ä½¿ç”¨ C å’Œ gamma ä¸¤ä¸ªå‚æ•°ï¼ˆä½†ç”¨ä¸åˆ°ç±»ä¼¼ degree çš„å…¶ä»–å‚æ•°ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœç´¢ Cã€gamma å’Œ kernel æ‰€æœ‰å¯èƒ½çš„ç»„åˆæ²¡æœ‰æ„ä¹‰ï¼šå¦‚æžœ <code>kernel='linear'</code>ï¼Œé‚£ä¹ˆ gamma æ˜¯ç”¨ä¸åˆ°çš„ï¼Œå°è¯• gamma çš„ä¸åŒå–å€¼å°†ä¼šæµªè´¹æ—¶é—´ã€‚ä¸ºäº†å¤„ç†è¿™ç§â€œæ¡ä»¶â€ï¼ˆconditionalï¼‰å‚æ•°ï¼ŒGridSearchCV çš„ <code>param_grid</code> å¯ä»¥æ˜¯å­—å…¸ç»„æˆçš„åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­æ¯ä¸ªå­—å…¸å¯æ‰©å±•ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç½‘æ ¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">param_grid = [&#123;<span class="string">'kernel'</span>: [<span class="string">'rbf'</span>],  <span class="comment"># kernel æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 1 çš„åˆ—è¡¨</span></span><br><span class="line">               <span class="string">'C'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>],</span><br><span class="line">               <span class="string">'gamma'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]&#125;,</span><br><span class="line">              &#123;<span class="string">'kernel'</span>: [<span class="string">'linear'</span>],</span><br><span class="line">               <span class="string">'C'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]&#125;]</span><br><span class="line">grid_search = GridSearchCV(SVC(), param_grid, cv=<span class="number">5</span>)</span><br><span class="line">grid_search.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Best parameters: &#123;&#125;'</span>.format(grid_search.best_params_))</span><br><span class="line">print(<span class="string">'Best cross-validation score: &#123;:.2f&#125;'</span>.format(grid_search.best_score_))</span><br><span class="line"></span><br><span class="line">results = pd.DataFrame(grid_search.cv_results_)</span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹ cv_results_ï¼Œå¦‚æžœ kernel='linear'ï¼Œé‚£ä¹ˆåªæœ‰ C æ˜¯å˜åŒ–çš„</span></span><br><span class="line">display(results.T)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Best parameters: &#123;&apos;C&apos;: 100, &apos;gamma&apos;: 0.01, &apos;kernel&apos;: &apos;rbf&apos;&#125;</span><br><span class="line">Best cross-validation score: 0.97</span><br><span class="line">                                                               0  ...                              41</span><br><span class="line">mean_fit_time                                        0.000518799  ...                     0.000275612</span><br><span class="line">std_fit_time                                         8.65673e-05  ...                     1.92715e-05</span><br><span class="line">mean_score_time                                      0.000243187  ...                     0.000154543</span><br><span class="line">std_score_time                                       5.89067e-05  ...                     1.61281e-06</span><br><span class="line">param_C                                                    0.001  ...                             100</span><br><span class="line">param_gamma                                                0.001  ...                             NaN</span><br><span class="line">param_kernel                                                 rbf  ...                          linear</span><br><span class="line">params             &#123;&apos;C&apos;: 0.001, &apos;gamma&apos;: 0.001, &apos;kernel&apos;: &apos;rbf&apos;&#125;  ...  &#123;&apos;C&apos;: 100, &apos;kernel&apos;: &apos;linear&apos;&#125;</span><br><span class="line">split0_test_score                                          0.375  ...                        0.958333</span><br><span class="line">split1_test_score                                       0.347826  ...                               1</span><br><span class="line">split2_test_score                                       0.363636  ...                               1</span><br><span class="line">split3_test_score                                       0.363636  ...                        0.909091</span><br><span class="line">split4_test_score                                       0.380952  ...                        0.952381</span><br><span class="line">mean_test_score                                         0.366071  ...                        0.964286</span><br><span class="line">std_test_score                                         0.0113708  ...                       0.0338387</span><br><span class="line">rank_test_score                                               27  ...                               3</span><br><span class="line"></span><br><span class="line">[16 rows x 42 columns]</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ä¸åŒçš„äº¤å‰éªŒè¯ç­–ç•¥è¿›è¡Œç½‘æ ¼æœç´¢">ä½¿ç”¨ä¸åŒçš„äº¤å‰éªŒè¯ç­–ç•¥è¿›è¡Œç½‘æ ¼æœç´¢</h2><p>ä¸Ž <code>cross_val_score</code> ç±»ä¼¼ï¼ŒGridSearchCV å¯¹åˆ†ç±»é—®é¢˜é»˜è®¤ä½¿ç”¨åˆ†å±‚ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯ï¼Œå¯¹å›žå½’é—®é¢˜é»˜è®¤ä½¿ç”¨ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ä¼ å…¥ä»»ä½•äº¤å‰éªŒè¯åˆ†ç¦»å™¨ä½œä¸º GridSearchCV çš„ cv å‚æ•°ã€‚ç‰¹åˆ«åœ°ï¼Œå¦‚æžœåªæƒ³å°†æ•°æ®å•è¯åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œä½ å¯ä»¥ä½¿ç”¨ ShuffleSplit æˆ– StratifiedShuffleSplitï¼Œå¹¶è®¾ç½® <code>n_iter=1</code>ã€‚è¿™å¯¹äºŽéžå¸¸å¤§çš„æ•°æ®é›†æˆ–éžå¸¸æ…¢çš„æ¨¡åž‹å¯èƒ½ä¼šæœ‰å¸®åŠ©ã€‚</p><h3 id="åµŒå¥—äº¤å‰éªŒè¯">åµŒå¥—äº¤å‰éªŒè¯</h3><p>å‰é¢åœ¨ä½¿ç”¨ GridSearchCV æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶å°†æ•°æ®å•æ¬¡åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç»“æžœä¸ç¨³å®šï¼Œä¹Ÿè®©æˆ‘ä»¬è¿‡äºŽä¾èµ–æ•°æ®çš„æ­¤æ¬¡åˆ’åˆ†ã€‚æˆ‘ä»¬å¯ä»¥å†æ·±å…¥ä¸€ç‚¹ï¼Œä¸æ˜¯åªå°†åŽŸå§‹æ•°æ®ä¸€æ¬¡åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè€Œæ˜¯ä½¿ç”¨äº¤å‰éªŒè¯è¿›è¡Œå¤šæ¬¡åˆ’åˆ†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„<strong>åµŒå¥—äº¤å‰éªŒè¯</strong>ï¼ˆnested cross-validationï¼‰ã€‚åœ¨åµŒå¥—äº¤å‰éªŒè¯ä¸­ï¼Œæœ‰ä¸€ä¸ªå¤–å±‚å¾ªçŽ¯ï¼ŒéåŽ†å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ‰€æœ‰åˆ’åˆ†ã€‚å¯¹äºŽæ¯ç§åˆ’åˆ†éƒ½è¿è¡Œä¸€æ¬¡ç½‘æ ¼æœç´¢ï¼ˆå¯¹äºŽå¤–å±‚å¾ªçŽ¯çš„æ¯ç§åˆ’åˆ†å¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„æœ€ä½³å‚æ•°ï¼‰ã€‚ç„¶åŽï¼Œå¯¹äºŽæ¯ç§å¤–å±‚åˆ’åˆ†ï¼Œåˆ©ç”¨æœ€ä½³å‚æ•°è®¾ç½®è®¡ç®—å¾—åˆ°æµ‹è¯•é›†åˆ†æ•°ã€‚</p><p>è¿™ä¸€è¿‡ç¨‹çš„ç»“æžœæ˜¯ç”±åˆ†æ•°ç»„æˆçš„åˆ—è¡¨â€”â€”ä¸æ˜¯ä¸€ä¸ªæ¨¡åž‹ï¼Œä¹Ÿä¸æ˜¯ä¸€ç§å‚æ•°è®¾ç½®ã€‚è¿™äº›åˆ†æ•°å‘Šè¯‰æˆ‘ä»¬åœ¨ç½‘æ ¼æ‰¾åˆ°çš„æœ€ä½³å‚æ•°ä¸‹æ¨¡åž‹çš„æ³›åŒ–èƒ½åŠ›å¥½åã€‚<strong>ç”±äºŽåµŒå¥—äº¤å‰éªŒè¯ä¸æä¾›å¯ç”¨äºŽæ–°æ•°æ®çš„æ¨¡åž‹ï¼Œæ‰€ä»¥åœ¨å¯»æ‰¾å¯ç”¨äºŽæœªæ¥æ•°æ®çš„é¢„æµ‹æ¨¡åž‹æ—¶å¾ˆå°‘ç”¨åˆ°å®ƒã€‚</strong>ä½†æ˜¯ï¼Œå®ƒå¯¹äºŽè¯„ä¼°ç»™å®šæ¨¡åž‹åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šçš„æ•ˆæžœå¾ˆæœ‰ç”¨ã€‚</p><p>åœ¨ scikit-learn ä¸­å®žçŽ°åµŒå¥—äº¤å‰éªŒè¯å¾ˆç®€å•ã€‚æˆ‘ä»¬è°ƒç”¨ <code>cross_val_score</code>ï¼Œå¹¶ç”¨ GridSearchCV çš„ä¸€ä¸ªå®žä¾‹ä½œä¸ºæ¨¡åž‹ï¼š</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.parametergrid#sklearn.model_selection.ParameterGrid" target="_blank" rel="noopener"><code>class sklearn.model_selection.ParameterGrid(param_grid)</code></a></p><p>Grid of parameters with a discrete number of values for each.</p><p>Can be used to iterate over parameter value combinations with the Python built-in function iter.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> ParameterGrid</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>param_grid = &#123;<span class="string">'a'</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="string">'b'</span>: [<span class="literal">True</span>, <span class="literal">False</span>]&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(ParameterGrid(param_grid)) == (</span><br><span class="line"><span class="meta">... </span>   [&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="literal">True</span>&#125;, &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="literal">False</span>&#125;,</span><br><span class="line"><span class="meta">... </span>    &#123;<span class="string">'a'</span>: <span class="number">2</span>, <span class="string">'b'</span>: <span class="literal">True</span>&#125;, &#123;<span class="string">'a'</span>: <span class="number">2</span>, <span class="string">'b'</span>: <span class="literal">False</span>&#125;])</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">param_grid = &#123;<span class="string">'C'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>],</span><br><span class="line">              <span class="string">'gamma'</span>: [<span class="number">0.001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>]&#125;</span><br><span class="line"></span><br><span class="line">scores = cross_val_score(GridSearchCV(SVC(), param_grid, cv=<span class="number">5</span>),</span><br><span class="line">                         iris.data, iris.target, cv=<span class="number">5</span>)</span><br><span class="line">print(<span class="string">'Cross-validation scores:'</span>, scores)</span><br><span class="line">print(<span class="string">'Mean cross-validation score:'</span>, scores.mean())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cross-validation scores: [0.96666667 1.         0.96666667 0.96666667 1.        ]</span><br><span class="line">Mean cross-validation score: 0.9800000000000001</span><br></pre></td></tr></table></figure><p>åµŒå¥—äº¤å‰éªŒè¯çš„ç»“æžœå¯ä»¥æ€»ç»“ä¸º â€œSVC åœ¨ iris æ•°æ®é›†ä¸Šçš„äº¤å‰éªŒè¯å¹³å‡ç²¾åº¦ä¸º 98%â€â€”â€”ä¸å¤šä¹Ÿä¸å°‘ï¼ˆä¸Žä¸Šä¸€ä¸ªç»“æžœå¤§è‡´ç›¸åŒï¼‰ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åœ¨å†…å±‚å¾ªçŽ¯å’Œå¤–å±‚å¾ªçŽ¯ä¸­éƒ½ä½¿ç”¨äº†åˆ†å±‚ 5 æŠ˜äº¤å‰éªŒè¯ã€‚ç”±äºŽ <code>param_grid</code> åŒ…å« 36 ä¸­å‚æ•°ç»„åˆï¼Œæ‰€ä»¥éœ€è¦æž„å»º 36 x 5 x 5 = 900 ä¸ªæ¨¡åž‹ï¼Œå¯¼è‡´åµŒå¥—äº¤å‰éªŒè¯è¿‡ç¨‹çš„ä»£ä»·å¾ˆé«˜ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨å†…å±‚å¾ªçŽ¯å’Œå¤–å±‚å¾ªçŽ¯ä¸­ä½¿ç”¨ç›¸åŒçš„äº¤å‰éªŒè¯åˆ†ç¦»å™¨ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œä½ å¯ä»¥åœ¨å†…å±‚å¾ªçŽ¯å’Œå¤–å±‚å¾ªçŽ¯ä¸­ä½¿ç”¨äº¤å‰éªŒè¯ç­–ç•¥çš„ä»»æ„ç»„åˆã€‚ç†è§£ä¸Šé¢å•è¡Œä»£ç çš„å†…å®¹å¯èƒ½æœ‰ç‚¹å›°éš¾ï¼Œå°†å…¶å±•å¼€ä¸º for å¾ªçŽ¯å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œæ­£å¦‚æˆ‘ä¹ˆåœ¨ä¸‹é¢è¿™ä¸ªç®€åŒ–çš„å®žçŽ°ä¸­æ‰€åšçš„é‚£æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> StratifiedKFold, ParameterGrid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nested_cv</span><span class="params">(X, y, inner_cv, outer_cv, Classifier, parameter_grid)</span>:</span></span><br><span class="line">    outer_scores = []</span><br><span class="line">    <span class="comment"># å¯¹äºŽå¤–å±‚äº¤å‰éªŒè¯çš„æ¯æ¬¡æ•°æ®åˆ’åˆ†ï¼Œsplitæ–¹æ³•è¿”å›žç´¢å¼•å€¼</span></span><br><span class="line">    <span class="keyword">for</span> training_samples, test_samples <span class="keyword">in</span> outer_cv.split(X, y):</span><br><span class="line">        <span class="comment"># åˆ©ç”¨å†…å±‚äº¤å‰éªŒè¯æ‰¾åˆ°æœ€ä½³å‚æ•°</span></span><br><span class="line">        best_params = &#123;&#125;</span><br><span class="line">        best_score = -np.inf</span><br><span class="line">        <span class="comment"># éåŽ†å‚æ•°</span></span><br><span class="line">        <span class="keyword">for</span> parameters <span class="keyword">in</span> parameter_grid:</span><br><span class="line">            <span class="comment"># åœ¨å†…å±‚åˆ’åˆ†ä¸­ç´¯åŠ åˆ†æ•°</span></span><br><span class="line">            cv_scores = []</span><br><span class="line">            <span class="comment"># éåŽ†å†…å±‚äº¤å‰éªŒè¯</span></span><br><span class="line">            <span class="keyword">for</span> inner_train, inner_test <span class="keyword">in</span> inner_cv.split(X[training_samples], y[training_samples]):</span><br><span class="line">                <span class="comment"># å¯¹äºŽç»™å®šçš„å‚æ•°å’Œè®­ç»ƒæ•°æ®æ¥æž„å»ºåˆ†ç±»å™¨</span></span><br><span class="line">                clf = Classifier(**parameters)</span><br><span class="line">                clf.fit(X[inner_train], y[inner_train])</span><br><span class="line">                <span class="comment"># åœ¨å†…å±‚æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„ä¼°</span></span><br><span class="line">                score = clf.score(X[inner_test], y[inner_test])</span><br><span class="line">                cv_scores.append(score)</span><br><span class="line">            <span class="comment"># è®¡ç®—å†…å±‚äº¤å‰éªŒè¯çš„å¹³å‡åˆ†æ•°</span></span><br><span class="line">            mean_score = np.mean(cv_scores)</span><br><span class="line">            <span class="keyword">if</span> mean_score &gt; best_score:</span><br><span class="line">                best_score = mean_score</span><br><span class="line">                best_params = parameters</span><br><span class="line">        <span class="comment"># åˆ©ç”¨å¤–å±‚è®­ç»ƒé›†å’Œæœ€ä½³å‚æ•°æ¥æž„å»ºæ¨¡åž‹</span></span><br><span class="line">        clf = Classifier(**best_params)</span><br><span class="line">        clf.fit(X[training_samples], y[training_samples])</span><br><span class="line">        <span class="comment"># è¯„ä¼°æ¨¡åž‹</span></span><br><span class="line">        outer_scores.append(clf.score(X[test_samples], y[test_samples]))</span><br><span class="line">    <span class="keyword">return</span> np.array(outer_scores)</span><br><span class="line"></span><br><span class="line">scores = nested_cv(iris.data, iris.target, StratifiedKFold(<span class="number">5</span>),</span><br><span class="line">    StratifiedKFold(<span class="number">5</span>), SVC, ParameterGrid(param_grid))</span><br><span class="line">print(<span class="string">'Cross-validation scores:'</span>, scores)</span><br><span class="line">print(<span class="string">'Mean cross-validation score:'</span>, scores.mean())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cross-validation scores: [0.96666667 1.         0.96666667 0.96666667 1.        ]</span><br><span class="line">Mean cross-validation score: 0.9800000000000001</span><br></pre></td></tr></table></figure><h3 id="äº¤å‰éªŒè¯ä¸Žç½‘æ ¼æœç´¢å¹¶è¡Œ">äº¤å‰éªŒè¯ä¸Žç½‘æ ¼æœç´¢å¹¶è¡Œ</h3><p>è™½ç„¶åœ¨è®¸å¤šå‚æ•°ä¸Šè¿è¡Œç½‘æ ¼æœç´¢å’Œåœ¨å¤§åž‹æ•°æ®é›†ä¸Šè¿è¡Œç½‘æ ¼æœç´¢çš„è®¡ç®—é‡å¯èƒ½å¾ˆå¤§ï¼Œä½†ä»¤äººå°´å°¬çš„æ˜¯ï¼Œè¿™äº›è®¡ç®—éƒ½æ˜¯<strong>å¹¶è¡Œçš„</strong>ï¼ˆparallelï¼‰ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ç§äº¤å‰éªŒè¯åˆ’åˆ†ä¸‹ä½¿ç”¨ç‰¹å®šå‚æ•°è®¾ç½®æ¥æž„å»ºä¸€ä¸ªæ¨¡åž‹ï¼Œä¸Žåˆ©ç”¨å…¶ä»–å‚æ•°çš„æ¨¡åž‹æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚è¿™ä½¿å¾—ç½‘æ ¼æœç´¢ä¸Žäº¤å‰éªŒè¯æˆä¸ºå¤šä¸ª CPU å†…æ ¸æˆ–é›†ç¾¤ä¸Šå¹¶è¡ŒåŒ–çš„ç†æƒ³é€‰æ‹©ã€‚ä½ å¯ä»¥å°† <code>n_jobs</code> å‚æ•°è®¾ç½®ä¸ºä½ æƒ³ä½¿ç”¨çš„ CPU å†…æ ¸æ•°é‡ï¼Œä»Žè€Œåœ¨ GridSearchCV å’Œ <code>cross_val_score</code> ä¸­ä½¿ç”¨å¤šä¸ªå†…æ ¸ã€‚ä½ å¯ä»¥è®¾ç½® <code>n_jobs=-1</code> æ¥ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„å†…æ ¸ã€‚</p><p>ä½ åº”è¯¥çŸ¥é“ï¼Œ<strong>scikit-learn ä¸å…è®¸å¹¶è¡Œæ“ä½œçš„åµŒå¥—</strong>ã€‚å› æ­¤ï¼Œå¦‚æžœä½ åœ¨æ¨¡åž‹ï¼ˆæ¯”å¦‚éšæœºæ£®æž—ï¼‰ä¸­ä½¿ç”¨äº† <code>n_jobs</code> é€‰é¡¹ï¼Œé‚£ä¹ˆå°±ä¸èƒ½åœ¨ GridSearchCV ä½¿ç”¨å®ƒæ¥æœç´¢è¿™ä¸ªæ¨¡åž‹ã€‚å¦‚æžœä½ çš„æ•°æ®é›†å’Œæ¨¡åž‹éƒ½éžå¸¸å¤§ï¼Œé‚£ä¹ˆä½¿ç”¨å¤šä¸ªå†…æ ¸å¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œä½ åº”è¯¥åœ¨å¹¶è¡Œæž„å»ºå¤§åž‹æ¨¡åž‹æ—¶ç›‘è§†å†…å­˜çš„ä½¿ç”¨æƒ…å†µã€‚</p><p>è¿˜å¯ä»¥åœ¨é›†ç¾¤å†…çš„å¤šå°æœºå™¨ä¸Šå¹¶è¡Œè¿è¡Œç½‘æ ¼æœç´¢å’Œäº¤å‰éªŒè¯ã€‚å¯¹äºŽ Spark ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ spark-sklearn åŒ…ï¼Œå®ƒå…è®¸åœ¨å·²ç»å»ºç«‹å¥½çš„ Spark é›†ç¾¤ä¸Šè¿è¡Œç½‘æ ¼æœç´¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> grid search </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scramble String</title>
      <link href="/programming/leetcode/scramble-string/"/>
      <url>/programming/leetcode/scramble-string/</url>
      
        <content type="html"><![CDATA[<p>Given a string <code>s1</code>, we may represent it as a binary tree by partitioning it to <strong>two non-empty substrings</strong> recursively.</p><p>Below is one possible representation of <code>s1 = great</code>:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    great</span><br><span class="line">   /     \</span><br><span class="line">  gr     eat</span><br><span class="line"> / \     /  \</span><br><span class="line">g   r   e   at</span><br><span class="line">           /  \</span><br><span class="line">          a    t</span><br></pre></td></tr></table></figure><p>To scramble the string, we may choose any non-leaf node and swap its two children.</p><p>For example, if we choose the node <code>&quot;gr&quot;</code> and swap its two children, it produces a scrambled string <code>&quot;rgeat&quot;</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    rgeat</span><br><span class="line">   /     \</span><br><span class="line">  rg     eat</span><br><span class="line"> / \     /  \</span><br><span class="line">r   g   e   at</span><br><span class="line">           /  \</span><br><span class="line">          a    t</span><br></pre></td></tr></table></figure><p>We say that <code>&quot;rgeat&quot;</code> is a scrambled string of <code>&quot;great&quot;</code>.</p><a id="more"></a><p>Similarly, if we continue to swap the children of nodes <code>&quot;eat&quot;</code> and <code>&quot;at&quot;</code>, it produces a scrambled string <code>&quot;rgtae&quot;</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    rgtae</span><br><span class="line">   /     \</span><br><span class="line">  rg     tae</span><br><span class="line"> / \     /  \</span><br><span class="line">r   g   ta   e</span><br><span class="line">       /  \</span><br><span class="line">      t    a</span><br></pre></td></tr></table></figure><p>We say that <code>&quot;rgtae&quot;</code> is a scrambled string of <code>&quot;great&quot;</code>.</p><p>Given two strings <code>s1</code> and <code>s2</code> of the same length, determine if <code>s2</code> is a scrambled string of <code>s1</code>.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s1 = &quot;great&quot;, s2 = &quot;rgeat&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s1 = &quot;abcde&quot;, s2 = &quot;caebd&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p><strong>Note:</strong> String can be partitioned at ANY position. But can only be partitioned (maybe) once.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">e.g. s1 = &quot;abcde&quot;, s2 = &quot;bcade&quot;, s3 = &quot;bcead&quot;</span><br><span class="line"></span><br><span class="line">s2 is a scramble of s1</span><br><span class="line"></span><br><span class="line">        abcde</span><br><span class="line">       /     \</span><br><span class="line">      abc     de</span><br><span class="line">     /  \    /  \</span><br><span class="line">    a   bc  d    e</span><br><span class="line">       /  \</span><br><span class="line">      b    c</span><br><span class="line"></span><br><span class="line">    swap &quot;a&quot; and &quot;bc&quot;</span><br><span class="line"></span><br><span class="line">          bcade</span><br><span class="line">         /     \</span><br><span class="line">        bca     de</span><br><span class="line">       /  \    /  \</span><br><span class="line">      bc   a  d    e</span><br><span class="line">     /  \</span><br><span class="line">    b    c</span><br><span class="line"></span><br><span class="line">s3 is a scramble of s2</span><br><span class="line"></span><br><span class="line">        bcade</span><br><span class="line">       /     \</span><br><span class="line">      bc     ade</span><br><span class="line">     / \     / \</span><br><span class="line">    b   c   ad  e</span><br><span class="line">           / \</span><br><span class="line">          a   d</span><br><span class="line"></span><br><span class="line">    swap &quot;ad&quot; and &quot;e&quot;</span><br><span class="line"></span><br><span class="line">        bcead</span><br><span class="line">       /     \</span><br><span class="line">      bc     ead</span><br><span class="line">     / \     / \</span><br><span class="line">    b   c   e  ad</span><br><span class="line">               / \</span><br><span class="line">              a   d</span><br><span class="line"></span><br><span class="line">But s3 is NOT a scramble of s1</span><br><span class="line"></span><br><span class="line">s1 ---&gt; s2</span><br><span class="line">s2 ---&gt; s3</span><br><span class="line">s1 -x-&gt; s3</span><br></pre></td></tr></table></figure><h1 id="recursion">Recursion</h1><p>Let <code>m</code> denotes the lenght of <code>s1</code>, and <code>n</code> denotes the length of <code>s2</code>.</p><p>Base cases:</p><ul><li>If <code>m != n</code>, <code>isScramble(s1, s2) = False</code>.</li><li>If <code>m == n == 1</code>, which means <code>s1</code> and <code>s2</code> are leaf nodes, <code>isScramble(s1, s2) = s1 == s2</code>.</li></ul><p>Recursion:</p><p>If there exist <code>1 &lt;= i &lt;= m-1</code>, where</p><ul><li><code>s1[0:i]</code> is a scramble of <code>s2[0:i]</code> and <code>s1[i:m]</code> is a scramble of <code>s2[i:n]</code>. Or,</li><li><code>s1[0:i]</code> is a scramble of <code>s2[n-i:n]</code> and <code>s1[i:m]</code> is a scramble of <code>s2[0:m-i]</code>.</li></ul><p>Then, <code>isScramble(s1, s2) = True</code>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isScramble</span><span class="params">(self, s1: str, s2: str)</span> -&gt; bool:</span></span><br><span class="line">        m, n = len(s1), len(s2)</span><br><span class="line">        <span class="keyword">if</span> m != n:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> m == n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> s1 == s2</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            <span class="keyword">if</span> self.isScramble(s1[:i], s2[:i]) <span class="keyword">and</span> self.isScramble(s1[i:], s2[i:]):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> self.isScramble(s1[:i], s2[-i:]) <span class="keyword">and</span> self.isScramble(s1[i:], s2[:n - i]):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Let F(i, j, k) denotes wheter the substring s1[i..i + k - 1] is a scramble of s2[j..j + k - 1].</span><br><span class="line">Since each of these substrings is a potential node in the tree, we need to check for all possible cuts.</span><br><span class="line"></span><br><span class="line">If s1 is a scrible of s2, let q be the length of a cut (hence, q &lt; k),</span><br><span class="line">then we are in the folloing situation:</span><br><span class="line"></span><br><span class="line">s1  [     x1     |       x2       ]</span><br><span class="line">    i            i + q            i + k - 1</span><br><span class="line"></span><br><span class="line">here, s2 has two possibilities:</span><br><span class="line"></span><br><span class="line">s2  [     y1     |       y2       ]</span><br><span class="line">    j            j + q            j + k - 1</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">s2  [       y1       |     y2     ]</span><br><span class="line">    j                j + k - q    j + k - 1</span><br><span class="line"></span><br><span class="line">which in terms of F means:</span><br><span class="line"></span><br><span class="line">F(i, j, k) = for some 1 &lt;= q &lt; k we have:</span><br><span class="line">    (F(i, j, q) AND F(i + q, j + q, k - q)) OR</span><br><span class="line">    (F(i, j + k - q, q) AND F(i + q, j, k - q))</span><br><span class="line"></span><br><span class="line">Base case is k = 1, where we simply need to check for s1[i] == s2[j]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isScramble</span><span class="params">(self, s1: str, s2: str)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> len(s1) != len(s2):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        n = len(s1)</span><br><span class="line">        dp = [[[<span class="literal">False</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)] <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(n - k + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(n - k + <span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">if</span> k == <span class="number">1</span>:</span><br><span class="line">                        dp[i][j][k] = s1[i] == s2[j]</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        dp[i][j][k] = any(</span><br><span class="line">                            (dp[i][j][q] <span class="keyword">and</span> dp[i + q][j + q][k - q]) <span class="keyword">or</span></span><br><span class="line">                            (dp[i][j + k - q][q] <span class="keyword">and</span> dp[i + q][j][k - q])</span><br><span class="line">                            <span class="keyword">for</span> q <span class="keyword">in</span> range(<span class="number">1</span>, k)</span><br><span class="line">                        )</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>][n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> recursion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maximal Rectangle</title>
      <link href="/programming/leetcode/maximal-rectangle/"/>
      <url>/programming/leetcode/maximal-rectangle/</url>
      
        <content type="html"><![CDATA[<p>Given an 2D binary matrix filled with 0's and 1's, find the largest rectangle containing only 1's and return its area.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  [&apos;1&apos;, &apos;0&apos;, &apos;1&apos;, &apos;0&apos;, &apos;0&apos;],</span><br><span class="line">  [&apos;1&apos;, &apos;0&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;],</span><br><span class="line">  [&apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;1&apos;],</span><br><span class="line">  [&apos;1&apos;, &apos;0&apos;, &apos;0&apos;, &apos;1&apos;, &apos;0&apos;]</span><br><span class="line">]</span><br><span class="line">Output: 6</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>In this approach, we use three DP arrays, <code>left</code>, <code>right</code> and <code>height</code>. The DP solution proceeds row by row, starting from the first row. Let the maximal rectangle area at row <code>i</code> and column <code>j</code> be computed by <code>(right[i][j] - left[i][j]) * height[i][j]</code>.</p><p>Let <code>m</code> denotes the height of matrix and <code>n</code> denotes the width of matrix. Define <code>lm</code> and <code>rm</code> as follows.</p><ul><li><code>lm</code>: the leftmost index of consecutive 1's ending at current cell. <code>lm</code> can be updated during a left to right scan.</li><li><code>rm</code>: 1 + the rightmost index of consecutive 1's starting from current cell. <code>rm</code> can be updated during a right to left scan.</li></ul><p>The meaning of <code>left</code>, <code>right</code> and <code>height</code>:</p><ul><li><code>height[i][j]</code>: the height of consecutive 1's above <code>matrix[i][j]</code>.</li><li><code>left[i][j]</code>: the leftmost of consecutive 1's with height <code>height[i][j]</code>.</li><li><code>right[i][j]</code>: the rightmost of consecutive 1's with height <code>height[i][j]</code>.</li></ul><p>First rows are given by:</p><ul><li><code>left[0][j] = max(0, lm) if matrix[0][j] == '1' else 0</code></li><li><code>right[0][j] = min(n, rm) if matrix[0][j] == '1' else n</code></li><li><code>height[0][j] = 1 if matrix[0][j] == '1' else 0</code></li></ul><p>The transition equations are:</p><ul><li><code>left[i][j] = max(left[i - 1][j], lm) if matrix[i][j] == '1' else 0</code></li><li><code>right[i][j] = min(right[i - 1][j], rm) if matrix[i][j] == '1' else n</code></li><li><code>height[i][j] = height[i - 1][j] + 1 if matrix[i][j] == '1' else 0</code></li></ul><a id="more"></a><p>e.g.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">matrix:</span><br><span class="line">0  1  0</span><br><span class="line">1  1  1</span><br><span class="line"></span><br><span class="line">height:   height array is easier to understand</span><br><span class="line">0  1  0</span><br><span class="line">1  2  1</span><br><span class="line"></span><br><span class="line">left:</span><br><span class="line">0  1  0</span><br><span class="line">0  1  0</span><br><span class="line"></span><br><span class="line">left[1][1] = 1, because rectangle with height 2 can&apos;t expand left anymore</span><br><span class="line">left[1][2] = 0, because rectangle with height 1 can expand left to 0</span><br><span class="line"></span><br><span class="line">right:</span><br><span class="line">3  2  3</span><br><span class="line">3  2  3</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximalRectangle</span><span class="params">(self, matrix: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m, n = len(matrix), len(matrix[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        left, right, height = [<span class="number">0</span>] * n, [n] * n, [<span class="number">0</span>] * n  <span class="comment"># using vector replace the matrix</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            rm = n</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> reversed(range(n)):  <span class="comment"># right to left scan</span></span><br><span class="line">                <span class="keyword">if</span> matrix[i][j] == <span class="string">'1'</span>:</span><br><span class="line">                    right[j] = min(right[j], rm)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    right[j] = n</span><br><span class="line">                    rm = j</span><br><span class="line">            lm = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):  <span class="comment"># left to right scan</span></span><br><span class="line">                <span class="keyword">if</span> matrix[i][j] == <span class="string">'1'</span>:</span><br><span class="line">                    left[j] = max(left[j], lm)</span><br><span class="line">                    height[j] = height[j] + <span class="number">1</span></span><br><span class="line">                    res = max(res, (right[j] - left[j]) * height[j])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    left[j] = <span class="number">0</span></span><br><span class="line">                    height[j] = <span class="number">0</span></span><br><span class="line">                    lm = j + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Climbing Stairs</title>
      <link href="/programming/leetcode/climbing-stairs/"/>
      <url>/programming/leetcode/climbing-stairs/</url>
      
        <content type="html"><![CDATA[<p>You are climbnig a stair case. It takes <em>n</em> steps to reach the top.</p><p>Each time you can either climb 1 or 2 steps. In how many distinct ways can you climb to the top?</p><p>Note: Given <em>n</em> will be a positive integer.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 2</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: 3</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp[i]</code> denotes the number of ways to reach on <code>i</code>-th step.</p><p>Base cases:</p><ul><li><code>dp[1] = 1</code>.</li><li><code>dp[2] = 2</code>.</li></ul><p>One can reach <code>i</code>-th step in one of the two ways:</p><ol type="1"><li>Taking a single step from <code>(i - 1)</code>-th step.</li><li>Taking a step of 2 from <code>(i - 2)</code>-th step.</li></ol><p>So, the total number of ways to reach <code>i</code>-th is equal to sum of ways of reaching <code>(i - 1)</code>-th step and ways of reach <code>(i - 2)</code>-th step. i.e. <code>dp[n] = dp[n - 1] + dp[n - 2]</code>.</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">climbStairs</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        dp = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">            dp.append(dp[<span class="number">-1</span>] + dp[<span class="number">-2</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><h1 id="fibonacci-number">Fibonacci Number</h1><p>In the above approach we have used <code>dp</code> array where <code>dp[i] = dp[i - 1] + dp[i - 2]</code>. It can be easily analysed that <code>dp[i]</code> is nothing but <code>i</code>-th fibonacci number.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">climbStairs</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        first, second = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">            third = first + second</span><br><span class="line">            first, second = second, third</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> second</span><br></pre></td></tr></table></figure><h1 id="binets-method">Binets Method</h1><p>This is an interesting solution which uses matrix multiplication to obtain the <code>n</code>-th Fibonacci Number. The matrix takes the following form: <span class="math inline">\(\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}\)</span>.</p><p>Let's say <span class="math inline">\(Q^n=\begin{bmatrix}F_n&amp;F_{n-1}\\F_{n-1}&amp;F_{n-2}\end{bmatrix}\)</span>, the <code>n</code>-th Fibonacci Number is given by <span class="math inline">\(Q^n[0][0]\)</span>.</p><p>In particular, we denote <span class="math inline">\(Q^1=\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}\)</span>, where <span class="math inline">\(F_1=Q^1[0][0]=1\)</span>.</p><p>We can prove this method using Mathematical Induction.</p><p><span class="math inline">\(Q^2=Q^1\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}=\begin{bmatrix}2&amp;1\\1&amp;1\end{bmatrix} \quad F_2=Q^2[0][0]=2\)</span> holds.</p><p><span class="math inline">\(Q^3=Q^2\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}=\begin{bmatrix}3&amp;2\\2&amp;1\end{bmatrix} \quad F_3=Q^3[0][0]=3\)</span> holds.</p><p>Thus, the base case holds.</p><p>Assume that this method holds for finding the <code>n</code>-th Fibonacci Number, i.e. <span class="math inline">\(F_n = Q^n[0][0]\)</span>, where, <span class="math inline">\(Q^n=\begin{bmatrix}F_n&amp;F_{n-1}\\F_{n-1}&amp;F_{n-2}\end{bmatrix}\)</span>.</p><p>Now, we need to prove that with the above two conditions holding true, the method is valid for finding the <code>(n + 1)</code>-th Fibonacci Number, i.e. <span class="math inline">\(F_{n+1} = Q^{n+1}[0][0]\)</span>.</p><p>Proof: <span class="math inline">\(Q^{n+1}=\begin{bmatrix}F_n&amp;F_{n-1}\\F_{n-1}&amp;F_{n-2}\end{bmatrix}\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}=\begin{bmatrix}F_n+F_{n-1}&amp;F_n\\F_{n-1}+F_{n-2}&amp;F_{n-1}\end{bmatrix} = \begin{bmatrix}F_{n+1}&amp;F_n\\F_n&amp;F_{n-1}\end{bmatrix}\)</span>.</p><p>Thus, <span class="math inline">\(F_{n+1} = Q^{n+1}[0][0]\)</span>. This completes the proof of this method.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(log n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">climbStairs</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        q = [[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">0</span>]]</span><br><span class="line">        res = self.pow(q, n)</span><br><span class="line">        <span class="keyword">return</span> res[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pow</span><span class="params">(self, a, n)</span>:</span></span><br><span class="line">        ret = [[<span class="number">1</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>]]</span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">1</span>:  <span class="comment"># when n is odd</span></span><br><span class="line">                ret = self.multiply(ret, a)</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>         <span class="comment"># n = n // 2</span></span><br><span class="line">            a = self.multiply(a, a)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(a, b)</span>:</span></span><br><span class="line">        c = [[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                c[i][j] = a[i][<span class="number">0</span>] * b[<span class="number">0</span>][j] + a[i][<span class="number">1</span>] * b[<span class="number">1</span>][j]</span><br><span class="line">        <span class="keyword">return</span> c</span><br></pre></td></tr></table></figure><p>Proof of time complexity:</p><p>Suppose, <span class="math inline">\(n\)</span> is the power of 2. To calculate <span class="math inline">\(Q^n\)</span> matrix, we should calculate <span class="math inline">\(Q^{n/2}\)</span> matrix and multiply it by itself. To calculate <span class="math inline">\(Q^{n/2}\)</span> we should have to do the same with <span class="math inline">\(Q^{n/4}\)</span> and so on. Meaning that: <span class="math inline">\(Q^{n}=Q^{n/2}\cdot Q^{n/2}=\dots=\prod_1^n Q^1\)</span>.</p><p>e.g. <span class="math inline">\(Q^8=(Q^4)^2=((Q^2)^2)^2=(((Q^1)^2)^2)^2\)</span>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">         Q^n</span><br><span class="line">      /       \</span><br><span class="line">  Q^&#123;n/2&#125;   Q^&#123;n/2&#125;</span><br><span class="line">   ...        ...</span><br><span class="line">  /   \      /   \</span><br><span class="line">Q^1   Q^1  Q^1   Q^1</span><br></pre></td></tr></table></figure><p>Obviously, the tree height is <span class="math inline">\(\log_2 n\)</span>.</p><p>In case, the number <span class="math inline">\(n\)</span> is not a power of 2, we can <strong>break it in terms of powers of 2</strong> using its binary representation: <span class="math inline">\(n=\sum_{p\in P}2^p\)</span>, where <span class="math inline">\(P\subset \mathbb{N}\)</span>.</p><p>Thus, we can obtain the final result using: <span class="math inline">\(Q^n=\prod_{p\in P}Q^{2^p}\)</span>.</p><p>e.g. <span class="math inline">\(Q^7=Q^4\cdot Q^2 \cdot Q^1\)</span>.</p><p>This is the method we've used in implementation. Again, the complexity remains <span class="math inline">\(O(\log_2 n)\)</span> as we have limited the number of multiplications to <span class="math inline">\(O(\log_2 n)\)</span>.</p><h1 id="fibonacci-formula">Fibonacci Formula</h1><p>We can find <code>n</code>-th fibonacci number using this formula: <span class="math inline">\(F_n=1/\sqrt 5\Big[\Big(\frac{1+\sqrt 5}{2}\Big)^n-\Big(\frac{1-\sqrt 5}{2}\Big)^n\Big]\)</span>.</p><p>For the given problem, the Fibonacci sequence is defined by <span class="math inline">\(F_0=1, F_1=1, F_2=2, F_{n+2}=F_{n+1}+F_n\)</span>.</p><p>A standard method of trying to sovle such recursion formulas is assume <span class="math inline">\(F_n\)</span> of the form <span class="math inline">\(F_n=a^n\)</span>.</p><p>Then, of cource, <span class="math inline">\(F_{n+1}=a^{n+1}\)</span> and <span class="math inline">\(F_{n+2}=a^{n+2}\)</span> so the equation becomes <span class="math inline">\(a^{n+2}=a^{n+1}+a^n\)</span>. If we divide the entire equation by <span class="math inline">\(a^n\)</span> we arrive at <span class="math inline">\(a^2=a+1\)</span>.</p><p>Solving this by the quadratic formula, we get: <span class="math inline">\(a=1/\sqrt 5\Big(\frac{1\pm\sqrt 5}{2}\Big)\)</span>.</p><p>The general solution, thus takes the form: <span class="math inline">\(F_n=A\Big(\frac{1+\sqrt 5}{2}\Big)^n+B\Big(\frac{1-\sqrt 5}{2}\Big)^n\)</span>.</p><p>For <span class="math inline">\(n=0\)</span>, we get <span class="math inline">\(A+B=1\)</span>. For <span class="math inline">\(n=1\)</span>, we get <span class="math inline">\(A\Big(\frac{1+\sqrt 5}{2}\Big)+B\Big(\frac{1-\sqrt 5}{2}\Big)=1\)</span>. Solving the above equations, we get <span class="math inline">\(A=\Big(\frac{1+\sqrt 5}{2\sqrt 5}\Big), B=\Big(\frac{1-\sqrt 5}{2\sqrt 5}\Big)\)</span>.</p><p>Putting these values of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> in the above general solution equation, we get:</p><p><span class="math inline">\(F_n=1/\sqrt 5\Big[\Big(\frac{1+\sqrt 5}{2}\Big)^n-\Big(\frac{1-\sqrt 5}{2}\Big)^n\Big]\)</span></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(log n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">climbStairs</span><span class="params">(self, n: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">import</span> math</span><br><span class="line">        sqrt5 = math.sqrt(<span class="number">5</span>)</span><br><span class="line">        fibn = math.pow((<span class="number">1</span> + sqrt5) / <span class="number">2</span>, n + <span class="number">1</span>) - math.pow((<span class="number">1</span> - sqrt5) / <span class="number">2</span>, n + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> int(fibn / sqrt5)</span><br></pre></td></tr></table></figure><p><em>zhoubowei</em> commented on leetcode that Fibonacci Formula would be invalid while the answer is larger than 10^15.</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> fibonacci </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Minimum Path Sum</title>
      <link href="/programming/leetcode/minimum-path-sum/"/>
      <url>/programming/leetcode/minimum-path-sum/</url>
      
        <content type="html"><![CDATA[<p>Given a m x n grid filled with non-negative numbers, find a path from top left to bottom right which <em>minimizes</em> the sum of all numbers along its path.</p><p><strong>Note:</strong> You can only move either down or right at any point in time.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  [1,3,1],</span><br><span class="line">  [1,5,1],</span><br><span class="line">  [4,2,1]</span><br><span class="line">]</span><br><span class="line">Output: 7</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p><code>dp[i][j]</code> denotes the minimum sum of all numbers along the path that start from <code>(1, 1)</code> to <code>(i, j)</code>. Indices start from 1.</p><ul><li><code>dp[i][1] = dp[i - 1][1] + grid[i][1]</code>. Any cell in the first column can only be reached from the cell above it.</li><li><code>dp[1][j] = dp[1][j - 1] + grid[1][j]</code>. Any cell in the first row can only be reached from the cell left to it.</li><li><code>dp[i][j] = min(dp[i - 1][j], dp[i][j - 1]) + grid[i][j]</code>. Cell <code>(i, j)</code> can be reached from the cell above it or the left to it.</li></ul><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minPathSum</span><span class="params">(self, grid: list)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(grid), len(grid[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line">            grid[i][<span class="number">0</span>] = grid[i - <span class="number">1</span>][<span class="number">0</span>] + grid[i][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            grid[<span class="number">0</span>][j] = grid[<span class="number">0</span>][j - <span class="number">1</span>] + grid[<span class="number">0</span>][j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">                grid[i][j] = min(grid[i - <span class="number">1</span>][j], grid[i][j - <span class="number">1</span>]) + grid[i][j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> grid[<span class="number">-1</span>][<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><h1 id="dijkstra">Dijkstra</h1><p>For more details, see <a href="/notes/introduction-to-algorithms/single-source-shortest-paths/" title="Single Source Shortest Paths">Single Source Shortest Paths</a>.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minPathSum</span><span class="params">(self, grid: list)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">        m, n = len(grid), len(grid[<span class="number">0</span>])</span><br><span class="line">        heap = [(grid[<span class="number">0</span>][<span class="number">0</span>], (<span class="number">0</span>, <span class="number">0</span>))]</span><br><span class="line">        visited = set()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> heap:</span><br><span class="line">            curr, (i, j) = heapq.heappop(heap)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i, j) == (m - <span class="number">1</span>, n - <span class="number">1</span>):  <span class="comment"># got the result</span></span><br><span class="line">                <span class="keyword">return</span> curr</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i, j) <span class="keyword">not</span> <span class="keyword">in</span> visited:</span><br><span class="line">                visited.add((i, j))</span><br><span class="line">                <span class="keyword">for</span> x, y <span class="keyword">in</span> &#123;(i + <span class="number">1</span>, j), (i, j + <span class="number">1</span>)&#125;:  <span class="comment"># relax neighbor</span></span><br><span class="line">                    <span class="keyword">if</span> x &lt; m <span class="keyword">and</span> y &lt; n <span class="keyword">and</span> (x, y) <span class="keyword">not</span> <span class="keyword">in</span> visited:</span><br><span class="line">                        heapq.heappush(heap, (curr + grid[x][y], (x, y)))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> shortest path </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unique Paths</title>
      <link href="/programming/leetcode/unique-paths/"/>
      <url>/programming/leetcode/unique-paths/</url>
      
        <content type="html"><![CDATA[<h1 id="unique-paths">Unique Paths</h1><p>A robot is located at the top-left corner of a m x n grid (marked 'Start' in the diagram below).</p><p>The robot can only move either down or right at any point in time. The robot is trying to reach the bottom-right corner of the grid (marked 'Finish' in the diagram below).</p><p><img src="/uploads/image/leetcode/robot_maze.png"></p><p>How many possible unique paths are there?</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: m = 3, n = 2</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: m = 7, n = 3</span><br><span class="line">Output: 28</span><br></pre></td></tr></table></figure><p>Constraints:</p><ul><li><code>1 &lt;= m, n &lt;= 100</code>.</li><li>It's guaranteed that the answer will be less than or equal to <code>2 * 10 ^ 9</code>.</li></ul><h2 id="dynamic-programming">Dynamic Programming</h2><p><code>dp[i][j]</code> denotes the number of possible unique paths that from <code>(i, j)</code> to <code>(m, n)</code>. Indices start from 1 here.</p><ul><li><code>i = m</code>, robot can only move right. So, <code>dp[m][j] = 1</code>.</li><li><code>j = n</code>, robot can only move down. So, <code>dp[i][n] = 1</code>.</li><li><code>i &lt; m and j &lt; n</code>, robot can move down or right. When move right, robot has <code>dp[i][j + 1]</code> unique paths. When move down, robot has <code>dp[i + 1][j]</code> unique paths. So, <code>dp[i][j] = dp[i][j + 1] + dp[i + 1][j]</code>.</li></ul><p>Also, you can denote <code>dp[i][j]</code> as the number of possible unique paths that from <code>(1, 1)</code> to <code>(i, j)</code>. Then,</p><ul><li><code>dp[1][j] = dp[i][1] = 1</code>.</li><li><code>dp[i][j] = dp[i - 1][j] + dp[i][j - 1]</code>.</li><li><code>dp[m][n]</code> is the answer of problem.</li></ul><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePaths</span><span class="params">(self, m: int, n: int)</span> -&gt; int:</span></span><br><span class="line">        dp = [[<span class="number">1</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> range(m)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(m - <span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> reversed(range(n - <span class="number">1</span>)):</span><br><span class="line">                dp[i][j] = dp[i + <span class="number">1</span>][j] + dp[i][j + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePaths</span><span class="params">(self, m: int, n: int)</span> -&gt; int:</span></span><br><span class="line">        dp = [<span class="number">1</span>] * n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> reversed(range(m - <span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> reversed(range(n - <span class="number">1</span>)):</span><br><span class="line">                dp[j] = dp[j] + dp[j + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h1 id="unique-paths-ii">Unique Paths II</h1><p>Now consider if some obstacles are aded to the grids. How many unique paths would there be?</p><p>An obstale and empty space is marked as <code>1</code> and <code>0</code> respectively in the grid.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">[</span><br><span class="line">  [0,0,0],</span><br><span class="line">  [0,1,0],</span><br><span class="line">  [0,0,0]</span><br><span class="line">]</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming-1">Dynamic Programming</h2><p>Base cases:</p><ul><li>If <code>grid[i][j] == 1</code>, which means a obstacle, <code>dp[i][j] = 0</code>.</li><li><code>i = m</code>, robot can move right only if <code>grid[i][j + 1] == 0</code>. So, <code>dp[i][j] = dp[i][j + 1]</code>.</li><li><code>j = n</code>, robot can move down only if <code>grid[i + 1][j] == 0</code>. So, <code>dp[i][j] = dp[i + 1][j]</code>.</li></ul><p>Induction rules:</p><ul><li>If <code>grid[i][j] == 1</code>, <code>dp[i][j] = 0</code>.</li><li>If <code>grid[i][j] == 0</code>, <code>dp[i][j] = dp[i + 1][j] + dp[i][j + 1]</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(1). We are utilizing the `obstacleGrid` as the DP array. Hence, no extra space.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(self, obstacleGrid: list)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(obstacleGrid), len(obstacleGrid[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the start or finish cell has an obstacle</span></span><br><span class="line">        <span class="keyword">if</span> obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] + obstacleGrid[<span class="number">-1</span>][<span class="number">-1</span>] &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Utilizing input obstacleGrid as dp</span></span><br><span class="line">        obstacleGrid[<span class="number">-1</span>][<span class="number">-1</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(m - <span class="number">1</span>)):</span><br><span class="line">            obstacleGrid[i][- <span class="number">1</span>] = int(obstacleGrid[i][<span class="number">-1</span>] == <span class="number">0</span> <span class="keyword">and</span> obstacleGrid[i + <span class="number">1</span>][<span class="number">-1</span>] == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> reversed(range(n - <span class="number">1</span>)):</span><br><span class="line">            obstacleGrid[<span class="number">-1</span>][j] = int(obstacleGrid[<span class="number">-1</span>][j] == <span class="number">0</span> <span class="keyword">and</span> obstacleGrid[<span class="number">-1</span>][j + <span class="number">1</span>] == <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(m - <span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> reversed(range(n - <span class="number">1</span>)):</span><br><span class="line">                <span class="keyword">if</span> obstacleGrid[i][j] == <span class="number">0</span>:</span><br><span class="line">                    obstacleGrid[i][j] = obstacleGrid[i + <span class="number">1</span>][j] + obstacleGrid[i][j + <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    obstacleGrid[i][j] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obstacleGrid[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wildcard Matching</title>
      <link href="/programming/leetcode/wildcard-matching/"/>
      <url>/programming/leetcode/wildcard-matching/</url>
      
        <content type="html"><![CDATA[<p>Given an input string (<code>s</code>) and a pattern (<code>p</code>), implement wildcard pattern matching with support for <code>'?'</code> and <code>'*'</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;?&apos; Matches any single character.</span><br><span class="line">&apos;*&apos; Matches any sequence of characters (including the empty sequence).</span><br></pre></td></tr></table></figure><p>The matching should cover the <strong>entire</strong> input string (not partial).</p><p><strong>Note:</strong></p><ul><li><code>s</code> could be empty and contains only lowercase latters <code>a-z</code>.</li><li><code>p</code> could be empty and contains only lowercase latters <code>a-z</code>, and characters like <code>?</code> or <code>*</code>.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;aa&quot;, p = &quot;a&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;aa&quot;, p = &quot;*&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;cb&quot;, p = &quot;?a&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p>Example 4:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;adceb&quot;, p = &quot;*a*b&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 5:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;acdcb&quot;, p = &quot;a*c?b&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Similar to the problem <a href="/programming/leetcode/regular-expression-matching/" title="Regular Expression Matching">Regular Expression Matching</a>.</p><p><code>dp[i][j]</code> denotes whether <code>s[i..m)</code> matches <code>p[j..n)</code>. Index of strings start from 0.</p><p>Assuming <code>m</code> is the length of string <code>s</code>, <code>n</code> is the length of pattern <code>p</code>.</p><p>Base cases:</p><ul><li>origin: <code>dp[m][n] = true</code>. <code>s[m:] == p[n:] == ''</code>, they do match.</li><li>last row: <code>dp[m][j]</code>, expect for string <code>p</code> is <code>*</code>, which can match empty sequence, otherwise all false.</li><li>last column: <code>dp[i][n] = false</code>. <code>s[i:] != ''</code> but <code>p[n:] == ''</code>, they can't match.</li></ul><p>Induction rules:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if s[i] == p[j] or p[j] == &apos;?&apos;:   # the matches are single to single.</span><br><span class="line">    dp[i][j] = dp[i + 1][j + 1]   # the result depends on whether the last characters are match.</span><br><span class="line"></span><br><span class="line">elif p[j] == &apos;*&apos;:</span><br><span class="line">    dp[i][j] = dp[i][j + 1] or dp[i + 1][j]  # if * matches empty sequence, dp[i][j] = dp[i][j + 1]</span><br><span class="line">                                             # if * matches any not empty sequence, dp[i][j] = dp[i + 1][j]</span><br><span class="line">else:</span><br><span class="line">    dp[i][j] = False              # can&apos;t match</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, s: str, p: str)</span> -&gt; bool:</span></span><br><span class="line">        m, n = len(s), len(p)</span><br><span class="line"></span><br><span class="line">        dp = [[<span class="literal">False</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        dp[<span class="number">-1</span>][<span class="number">-1</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                dp[m][j] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">                <span class="comment"># first, check if s[i] and p[j] is single to single match</span></span><br><span class="line">                <span class="keyword">if</span> p[j] == s[i] <span class="keyword">or</span> p[j] == <span class="string">'?'</span>:</span><br><span class="line">                    dp[i][j] = dp[i + <span class="number">1</span>][j + <span class="number">1</span>]</span><br><span class="line">                <span class="comment"># then, deal with *</span></span><br><span class="line">                <span class="keyword">elif</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                    dp[i][j] = dp[i + <span class="number">1</span>][j] <span class="keyword">or</span> dp[i][j + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>There also exists another variation, where <code>dp[i][j]</code> denotes whether <code>s[0..i-1]</code> matches <code>p[0..j-1]</code>. It's similar to the solution above, but be careful about the indices.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, s: str, p: str)</span> -&gt; bool:</span></span><br><span class="line">        m, n = len(s), len(p)</span><br><span class="line"></span><br><span class="line">        dp = [[<span class="literal">False</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line">            <span class="keyword">if</span> p[j - <span class="number">1</span>] == <span class="string">'*'</span>:</span><br><span class="line">                dp[<span class="number">0</span>][j] = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> p[j - <span class="number">1</span>] == s[i - <span class="number">1</span>] <span class="keyword">or</span> p[j - <span class="number">1</span>] == <span class="string">'?'</span>:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">elif</span> p[j - <span class="number">1</span>] == <span class="string">'*'</span>:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j] <span class="keyword">or</span> dp[i][j - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> dp[m][n]</span><br></pre></td></tr></table></figure><h1 id="another-approach">Another approach</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">If s[i] == p[j] or p[j] == &apos;?&apos;, which means this is a match,</span><br><span class="line">    goes to next element, i++, j++.</span><br><span class="line"></span><br><span class="line">If p[j] == &apos;*&apos;, this is also a match, but zero or many chars may be available,</span><br><span class="line">    save this * position and the matched s position ii.</span><br><span class="line"></span><br><span class="line">If not match, then we check if there was a * previously showd up,</span><br><span class="line">    if there is no *, return false;</span><br><span class="line">    if there is a *, we set current j to the next element of *, and set current i to the next saved ii position.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e.g. s=&apos;abed&apos;, p=&apos;?b*d**&apos;</span><br><span class="line"></span><br><span class="line">a = ?, go on, i++, j++</span><br><span class="line">b = b, go on, i++, j++</span><br><span class="line">e = *, save * position, star = 3, save s position, ii = 3, j++</span><br><span class="line">e != d, check if there was a *, yes, j = star + 1, ii++, i = ii</span><br><span class="line">d = d, go on, i++, j++, i meet the end</span><br><span class="line">check the rest element in p, if all are *, return true, else false</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, s: str, p: str)</span> -&gt; bool:</span></span><br><span class="line">        i = j = match = <span class="number">0</span></span><br><span class="line">        star = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; len(s):</span><br><span class="line">            <span class="keyword">if</span> j &lt; len(p) <span class="keyword">and</span> (p[j] == <span class="string">'?'</span> <span class="keyword">or</span> s[i] == p[j]):</span><br><span class="line">                i = i + <span class="number">1</span></span><br><span class="line">                j = j + <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> j &lt; len(p) <span class="keyword">and</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">                match = i   <span class="comment"># the character to match * if there exist not match latter</span></span><br><span class="line">                star = j    <span class="comment"># save star position</span></span><br><span class="line">                j = j + <span class="number">1</span>   <span class="comment"># only move j</span></span><br><span class="line">            <span class="keyword">elif</span> star != <span class="number">-1</span>:       <span class="comment"># not match happend, check if there was a *</span></span><br><span class="line">                j = star + <span class="number">1</span>       <span class="comment"># move j to the next of *</span></span><br><span class="line">                match = match + <span class="number">1</span>  <span class="comment"># let s[match] to match *</span></span><br><span class="line">                i = match          <span class="comment"># move i</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> j &lt; len(p) <span class="keyword">and</span> p[j] == <span class="string">'*'</span>:</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> j == len(p)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> matching </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº¤å‰éªŒè¯</title>
      <link href="/notes/introduction-to-ml-with-python/cross-validation/"/>
      <url>/notes/introduction-to-ml-with-python/cross-validation/</url>
      
        <content type="html"><![CDATA[<p>äº¤å‰éªŒè¯ï¼ˆcross-validationï¼‰æ˜¯ä¸€ç§è¯„ä¼°æ³›åŒ–æ€§èƒ½çš„ç»Ÿè®¡å­¦æ–¹æ³•ï¼Œå®ƒæ¯”å•æ¬¡åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ–¹æ³•æ›´åŠ ç¨³å®šã€å…¨é¢ã€‚åœ¨äº¤å‰éªŒè¯ä¸­ï¼Œæ•°æ®è¢«å¤šæ¬¡åˆ’åˆ†ï¼Œå¹¶ä¸”éœ€è¦è®­ç»ƒå¤šä¸ªæ¨¡åž‹ã€‚æœ€å¸¸ç”¨çš„äº¤å‰éªŒè¯æ˜¯ <strong><span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯</strong>ï¼ˆ <span class="math inline">\(k\)</span>-fold cross-validationï¼‰ï¼Œå…¶ä¸­ <span class="math inline">\(k\)</span> æ˜¯ç”±ç”¨æˆ·æŒ‡å®šçš„æ•°å­—ï¼Œé€šå¸¸å– 5 æˆ– 10ã€‚åœ¨æ‰§è¡Œ 5 æŠ˜äº¤å‰éªŒè¯æ—¶ï¼Œé¦–å…ˆå°†æ•°æ®åˆ’åˆ†ä¸ºï¼ˆå¤§è‡´ï¼‰ç›¸ç­‰çš„ 5 éƒ¨åˆ†ï¼Œæ¯ä¸€éƒ¨åˆ†å«ä½œ<strong>æŠ˜</strong>ï¼ˆfoldï¼‰ã€‚æŽ¥ä¸‹æ¥è®­ç»ƒä¸€ç³»åˆ—æ¨¡åž‹ã€‚ä½¿ç”¨ç¬¬ 1 æŠ˜ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä»–æŠ˜ï¼ˆ2-5ï¼‰ä½œä¸ºè®­ç»ƒé›†æ¥è®­ç»ƒç¬¬ä¸€ä¸ªæ¨¡åž‹ã€‚ä¹‹åŽæž„å»ºå¦ä¸€ä¸ªæ¨¡åž‹ï¼Œè¿™æ¬¡ä½¿ç”¨ç¬¬ 2 æŠ˜ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä»–æŠ˜ä½œä¸ºè®­ç»ƒé›†â€¦â€¦å¯¹äºŽå°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„è¿™ 5 æ¬¡åˆ’åˆ†ï¼Œæ¯ä¸€æ¬¡éƒ½è¦è®¡ç®—ç²¾åº¦ã€‚æœ€åŽæˆ‘ä»¬å¾—åˆ°äº† 5 ä¸ªç²¾åº¦å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_cross_validation()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/cross-validation.png"></p><a id="more"></a><h1 id="scikit-learn-ä¸­çš„äº¤å‰éªŒè¯">scikit-learn ä¸­çš„äº¤å‰éªŒè¯</h1><p>scikit-learn æ˜¯åˆ©ç”¨ <code>model_selection</code> æ¨¡å—ä¸­çš„ <code>cross_val_score</code> å‡½æ•°æ¥å®žçŽ°äº¤å‰éªŒè¯çš„ã€‚<code>cross_val_score</code> å‡½æ•°çš„å‚æ•°æ˜¯æˆ‘ä»¬æƒ³è¦è¯„ä¼°çš„æ¨¡åž‹ã€è®­ç»ƒæ•°æ®ä¸ŽçœŸå®žæ ‡ç­¾ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.cross_val_score#sklearn.model_selection.cross_val_score" target="_blank" rel="noopener"><code>sklearn.model_selection.cross_val_score(estimator, X, y=None, groups=None, scoring=None, cv=â€™warnâ€™, n_jobs=None, verbose=0, fit_params=None, pre_dispatch=â€˜2*n_jobsâ€™, error_score=â€™raise-deprecatingâ€™)</code></a></p><p>Evaluate a score by cross-validation</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</span><br><span class="line"></span><br><span class="line">iris = load_iris()</span><br><span class="line">logreg = LogisticRegression()</span><br><span class="line"></span><br><span class="line">scores = cross_val_score(logreg, iris.data, iris.target)  <span class="comment"># é»˜è®¤æ‰§è¡Œ 3 æŠ˜äº¤å‰éªŒè¯</span></span><br><span class="line">print(<span class="string">'Cross-validation scores:'</span>, scores)</span><br><span class="line"></span><br><span class="line">scores = cross_val_score(logreg, iris.data, iris.target, cv=<span class="number">5</span>)</span><br><span class="line">print(<span class="string">'Cross-validation scores:'</span>, scores)</span><br><span class="line"><span class="comment"># æ€»ç»“äº¤å‰éªŒè¯ç²¾åº¦çš„ä¸€ç§å¸¸ç”¨æ–¹æ³•æ˜¯è®¡ç®—å¹³å‡å€¼</span></span><br><span class="line">print(<span class="string">'Average cross-validation score: &#123;:.2f&#125;'</span>.format(scores.mean()))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cross-validation scores: [0.96078431 0.92156863 0.95833333]</span><br><span class="line">Cross-validation scores: [1.         0.96666667 0.93333333 0.9        1.        ]</span><br><span class="line">Average cross-validation score: 0.96</span><br></pre></td></tr></table></figure><p>æ¨¡åž‹çš„å¹³å‡ç²¾åº¦çº¦ä¸º 96%ã€‚è§‚å¯Ÿ 5 æŠ˜äº¤å‰éªŒè¯å¾—åˆ°çš„æ‰€æœ‰ 5 ä¸ªç²¾åº¦å€¼ï¼Œè¿˜å¯ä»¥å‘çŽ°ï¼ŒæŠ˜ä¸ŽæŠ˜ä¹‹é—´çš„ç²¾åº¦æœ‰è¾ƒå¤§çš„å˜åŒ–ï¼ŒèŒƒå›´ä»Ž 100% ç²¾åº¦åˆ° 90% ç²¾åº¦ã€‚è¿™å¯èƒ½æ„å‘³ç€æ¨¡åž‹å¼ºçƒˆä¾èµ–äºŽå°†æŸä¸ªæŠ˜ç”¨äºŽè®­ç»ƒï¼Œä½†ä¹Ÿå¯èƒ½åªæ˜¯å› ä¸ºæ•°æ®é›†çš„æ•°æ®é‡å¤ªå°ã€‚</p><h1 id="äº¤å‰éªŒè¯çš„ä¼˜ç¼ºç‚¹">äº¤å‰éªŒè¯çš„ä¼˜ç¼ºç‚¹</h1><p>ä½¿ç”¨äº¤å‰éªŒè¯è€Œä¸æ˜¯å°†æ•°æ®å•æ¬¡åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œè¿™ç§åšæ³•å…·æœ‰ä¸‹åˆ—ä¼˜ç‚¹ã€‚é¦–å…ˆï¼Œ<code>train_test_split</code> å¯¹æ•°æ®è¿›è¡Œéšæœºåˆ’åˆ†ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨éšæœºåˆ’åˆ†æ•°æ®æ—¶æˆ‘ä»¬å¾ˆâ€œå¹¸è¿â€ï¼Œæ‰€æœ‰éš¾ä»¥åˆ†ç±»çš„æ ·ä¾‹éƒ½åœ¨è®­ç»ƒé›†ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•é›†å°†ä»…åŒ…å«â€œå®¹æ˜“åˆ†ç±»çš„â€æ ·ä¾‹ï¼Œå¹¶ä¸”æµ‹è¯•é›†ç²¾åº¦ä¼šé«˜å¾—ä¸åˆ‡å®žé™…ã€‚ç›¸åï¼Œå¦‚æžœæˆ‘ä»¬â€œä¸å¤Ÿå¹¸è¿â€ï¼Œåˆ™å¯èƒ½éšæœºåœ°å°†æ‰€æœ‰éš¾ä»¥åˆ†ç±»çš„æ ·ä¾‹éƒ½æ”¾åœ¨æµ‹è¯•é›†ä¸­ï¼Œå› æ­¤å¾—åˆ°ä¸€ä¸ªä¸åˆ‡å®žé™…çš„ä½Žåˆ†æ•°ã€‚ä½†å¦‚æžœä½¿ç”¨äº¤å‰éªŒè¯ï¼Œæ¯ä¸ªæ ·ä¾‹éƒ½ä¼šåˆšå¥½åœ¨æµ‹è¯•é›†ä¸­å‡ºçŽ°ä¸€æ¬¡ï¼šæ¯ä¸ªæ ·ä¾‹ä½äºŽä¸€ä¸ªæŠ˜ä¸­ï¼Œè€Œæ¯ä¸ªæŠ˜éƒ½åœ¨æµ‹è¯•é›†ä¸­å‡ºçŽ°ä¸€æ¬¡ã€‚å› æ­¤ï¼Œæ¨¡åž‹éœ€è¦å¯¹æ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬çš„æ³›åŒ–èƒ½åŠ›éƒ½å¾ˆå¥½ï¼Œæ‰èƒ½è®©æ‰€æœ‰çš„äº¤å‰éªŒè¯å¾—åˆ†ï¼ˆåŠå…¶å¹³å‡å€¼ï¼‰éƒ½å¾ˆé«˜ã€‚</p><p>å¯¹æ•°æ®è¿›è¡Œå¤šæ¬¡åˆ’åˆ†ï¼Œè¿˜å¯ä»¥æä¾›æˆ‘ä»¬çš„æ¨¡åž‹å¯¹è®­ç»ƒé›†é€‰æ‹©çš„æ•æ„Ÿæ€§ä¿¡æ¯ã€‚å¯¹äºŽ iris æ•°æ®é›†ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ç²¾åº¦åœ¨ 90% åˆ° 100% ä¹‹é—´ã€‚è¿™æ˜¯ä¸€ä¸ªä¸å°çš„èŒƒå›´ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬å°†æ¨¡åž‹åº”ç”¨äºŽæ–°æ•°æ®æ—¶åœ¨æœ€åæƒ…å†µå’Œæœ€å¥½æƒ…å†µä¸‹çš„å¯èƒ½è¡¨çŽ°ã€‚</p><p>ä¸Žæ•°æ®çš„å•è¯åˆ’åˆ†ç›¸æ¯”ï¼Œäº¤å‰éªŒè¯çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯æˆ‘ä»¬å¯¹æ•°æ®çš„ä½¿ç”¨æ›´åŠ é«˜æ•ˆã€‚åœ¨ä½¿ç”¨ <code>train_test_split</code> æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å°† 75% çš„æ•°æ®ç”¨äºŽè®­ç»ƒï¼Œ25% çš„æ•°æ®ç”¨äºŽè¯„ä¼°ã€‚åœ¨ä½¿ç”¨ 5 æŠ˜äº¤å‰éªŒè¯æ—¶ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ 4/5ï¼ˆ80%ï¼‰çš„æ•°æ®æ¥æ‹Ÿåˆæ¨¡åž‹ã€‚åœ¨ä½¿ç”¨ 10 æŠ˜äº¤å‰éªŒè¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ 9/10ï¼ˆ90%ï¼‰çš„æ•°æ®æ¥æ‹Ÿåˆæ¨¡åž‹ã€‚æ›´å¤šçš„æ•°æ®é€šå¸¸å¯ä»¥å¾—åˆ°æ›´ä¸ºç²¾ç¡®çš„æ¨¡åž‹ã€‚</p><p>äº¤å‰éªŒè¯çš„ä¸»è¦ç¼ºç‚¹æ˜¯å¢žåŠ äº†è®¡ç®—æˆæœ¬ã€‚çŽ°åœ¨æˆ‘ä»¬è¦è®­ç»ƒ <span class="math inline">\(k\)</span> ä¸ªæ¨¡åž‹è€Œä¸æ˜¯å•ä¸ªæ¨¡åž‹ï¼Œæ‰€ä»¥äº¤å‰éªŒè¯çš„é€Ÿåº¦è¦æ¯”æ•°æ®çš„å•æ¬¡åˆ’åˆ†å¤§çº¦æ…¢ <span class="math inline">\(k\)</span> å€ã€‚</p><h1 id="åˆ†å±‚-k-æŠ˜äº¤å‰éªŒè¯å’Œå…¶ä»–ç­–ç•¥">åˆ†å±‚ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯å’Œå…¶ä»–ç­–ç•¥</h1><p>å°†æ•°æ®é›†åˆ’åˆ†ä¸º <span class="math inline">\(k\)</span> æŠ˜æ—¶ï¼Œä»Žæ•°æ®çš„å‰ <span class="math inline">\(k\)</span> åˆ†ä¹‹ä¸€å¼€å§‹åˆ’åˆ†ï¼ˆæ­£å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°ï¼‰ï¼Œè¿™å¯èƒ½å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ iris æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Iris labels:\n&#123;&#125;'</span>.format(iris.target))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Iris labels:</span><br><span class="line">[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br><span class="line"> 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span><br><span class="line"> 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2</span><br><span class="line"> 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span><br><span class="line"> 2 2]</span><br></pre></td></tr></table></figure><p>å¦‚ä½ æ‰€è§ï¼Œæ•°æ®çš„å‰ä¸‰åˆ†ä¹‹ä¸€æ˜¯ç±»åˆ« 0ï¼Œä¸­é—´ä¸‰åˆ†ä¹‹ä¸€æ˜¯ç±»åˆ« 1ï¼Œæœ€åŽä¸‰åˆ†ä¹‹ä¸€æ˜¯ç±»åˆ« 2ã€‚æƒ³è±¡ä¸€ä¸‹åœ¨è¿™ä¸ªæ•°æ®é›†ä¸Šè¿›è¡Œ 3 æŠ˜äº¤å‰éªŒè¯ã€‚ç¬¬ 1 æŠ˜å°†åªåŒ…å«ç±»åˆ« 0ï¼Œæ‰€ä»¥åœ¨æ•°æ®çš„ç¬¬ä¸€æ¬¡åˆ’åˆ†ä¸­ï¼Œæµ‹è¯•é›†å°†åªåŒ…å«ç±»åˆ« 0ï¼Œè€Œè®­ç»ƒé›†åªåŒ…å«ç±»åˆ« 1 å’Œ 2ã€‚ç”±äºŽåœ¨ 3 æ¬¡åˆ’åˆ†ä¸­è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„ç±»åˆ«éƒ½ä¸ç›¸åŒï¼Œå› æ­¤è¿™ä¸ªæ•°æ®é›†ä¸Šçš„ 3 æŠ˜äº¤å‰éªŒè¯ç²¾åº¦ä¸º 0ã€‚è¿™æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ iris ä¸Šå¯ä»¥çš„å¾—åˆ°æ¯” 0% å¥½å¾—å¤šçš„ç²¾åº¦ã€‚</p><p>ç”±äºŽç®€å•çš„ <span class="math inline">\(k\)</span> æŠ˜ç­–ç•¥åœ¨è¿™é‡Œå¤±æ•ˆäº†ï¼Œæ‰€ä»¥ scikit-learn åœ¨åˆ†ç±»é—®é¢˜ä¸­ä¸ä½¿ç”¨è¿™ç§ç­–ç•¥ï¼Œè€Œæ˜¯ä½¿ç”¨<strong>åˆ†å±‚ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯</strong>ï¼ˆstratified <span class="math inline">\(k\)</span>-fold cross-validationï¼‰ã€‚åœ¨åˆ†å±‚äº¤å‰éªŒè¯ä¸­ï¼Œæˆ‘ä»¬åˆ’åˆ†æ•°æ®ï¼Œä½¿æ¯ä¸ªæŠ˜ä¸­ç±»åˆ«ä¹‹é—´çš„æ¯”ä¾‹ä¸Žæ•´ä¸ªæ•°æ®é›†ä¸­çš„æ¯”ä¾‹ç›¸åŒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Iris labels:\n&#123;&#125;'</span>.format(iris.target))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/stratified-cross-validation.png"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœ 90% çš„æ ·æœ¬å±žäºŽç±»åˆ« A è€Œ 10% çš„æ ·æœ¬å±žäºŽç±»åˆ« Bï¼Œé‚£ä¹ˆåˆ†å±‚äº¤å‰éªŒè¯å¯ä»¥ç¡®ä¿ï¼Œåœ¨æ¯ä¸ªæŠ˜ä¸­ 90% çš„æ ·æœ¬å±žäºŽç±»åˆ« A è€Œ 10% çš„æ ·æœ¬å±žäºŽç±»åˆ« Bã€‚</p><p>ä½¿ç”¨åˆ†å±‚ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯è€Œä¸æ˜¯ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯æ¥è¯„ä¼°ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå®ƒå¯ä»¥å¯¹æ³›åŒ–æ€§èƒ½åšå‡ºæ›´å¯é çš„ä¼°è®¡ã€‚åœ¨åªæœ‰ 10% çš„æ ·æœ¬å±žäºŽç±»åˆ« B çš„æƒ…å†µä¸‹ï¼Œå¦‚æžœä½¿ç”¨æ ‡å‡† <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯ï¼Œå¾ˆå¯èƒ½æŸä¸ªæŠ˜ä¸­åªåŒ…å«ç±»åˆ« A çš„æ ·æœ¬ã€‚åˆ©ç”¨è¿™ä¸ªæŠ˜ä½œä¸ºæµ‹è¯•é›†çš„è¯ï¼Œæ— æ³•ç»™å‡ºåˆ†ç±»å™¨æ•´ä½“æ€§èƒ½çš„ä¿¡æ¯ã€‚</p><p>å¯¹äºŽå›žå½’é—®é¢˜ï¼Œscikit-learn é»˜è®¤ä½¿ç”¨æ ‡å‡† <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯ã€‚ä¹Ÿå¯ä»¥å°è¯•è®©æ¯ä¸ªæŠ˜è¡¨ç¤ºå›žå½’ç›®æ ‡çš„ä¸åŒå–å€¼ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ç§å¸¸ç”¨çš„ç­–ç•¥ï¼Œä¹Ÿä¼šè®©å¤§å¤šæ•°ç”¨æˆ·æ„Ÿåˆ°ä»¥å¤–ã€‚</p><h2 id="å¯¹äº¤å‰éªŒè¯çš„æ›´å¤šæŽ§åˆ¶">å¯¹äº¤å‰éªŒè¯çš„æ›´å¤šæŽ§åˆ¶</h2><p>æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°ï¼Œå¯ä»¥åˆ©ç”¨ cv å‚æ•°æ¥è°ƒèŠ‚ <code>cross_val_score</code> æ‰€ä½¿ç”¨çš„æŠ˜æ•°ã€‚ä½† scikit-learn å…è®¸æä¾›ä¸€ä¸ª<strong>äº¤å‰éªŒè¯åˆ†ç¦»å™¨</strong>ï¼ˆcross-validation spliterï¼‰ä½œä¸º cv å‚æ•°ï¼Œæ¥å¯¹æ•°æ®åˆ’åˆ†è¿‡ç¨‹è¿›è¡Œæ›´ç²¾ç¡®çš„æŽ§åˆ¶ã€‚å¯¹äºŽå¤§å¤šæ•°ä½¿ç”¨åœºæ™¯è€Œè¨€ï¼Œå›žå½’é—®é¢˜é»˜è®¤çš„ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯ä¸Žåˆ†ç±»é—®é¢˜çš„åˆ†å±‚ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯çš„è¡¨çŽ°éƒ½å¾ˆå¥½ï¼Œä½†æœ‰äº›æƒ…å†µä¸‹ä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ä¸åŒçš„ç­–ç•¥ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨ä¸€ä¸ªåˆ†ç±»æ•°æ®é›†ä¸Šä½¿ç”¨æ ‡å‡† <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯æ¥é‡çŽ°åˆ«äººçš„ç»“æžœã€‚ä¸ºäº†å®žçŽ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆå¿…é¡»ä»Ž <code>model_selection</code> æ¨¡å—ä¸­å¯¼å…¥ <code>KFold</code> åˆ†ç¦»å™¨ç±»ï¼Œå¹¶ç”¨æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æŠ˜æ•°æ¥å°†å…¶å®žä¾‹åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> KFold</span><br><span class="line"></span><br><span class="line">kfold = KFold(n_splits=<span class="number">5</span>)</span><br><span class="line"><span class="comment"># å°†kfoldåˆ†ç¦»å™¨å¯¹è±¡ä½œä¸ºcvå‚æ•°ä¼ å…¥cross_val_score</span></span><br><span class="line">print(<span class="string">'Cross-validation scores:\n&#123;&#125;\n'</span>.format(</span><br><span class="line">    cross_val_score(logreg, iris.data, iris.target, cv=kfold)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥éªŒè¯ï¼Œåœ¨irisæ•°æ®é›†ä¸Šä½¿ç”¨æ ‡å‡† 3 æŠ˜äº¤å‰éªŒè¯ç¡®å®žæ˜¯ä¸€ä¸ªéžå¸¸ç³Ÿç³•çš„æ³¨æ„</span></span><br><span class="line">kfold = KFold(n_splits=<span class="number">3</span>)</span><br><span class="line">print(<span class="string">'Cross-validation scores:\n&#123;&#125;\n'</span>.format(</span><br><span class="line">    cross_val_score(logreg, iris.data, iris.target, cv=kfold)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³è¿™ç§é—®é¢˜çš„å¦ä¸€ä¸ªæ–¹æ³•æ˜¯å°†æ•°æ®æ‰“ä¹±æ¥ä»£æ›¿åˆ†å±‚</span></span><br><span class="line">kfold = KFold(n_splits=<span class="number">3</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">0</span>)</span><br><span class="line">print(<span class="string">'Cross-validation scores:\n&#123;&#125;'</span>.format(</span><br><span class="line">    cross_val_score(logreg, iris.data, iris.target, cv=kfold)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cross-validation scores:</span><br><span class="line">[1.         0.93333333 0.43333333 0.96666667 0.43333333]</span><br><span class="line"></span><br><span class="line">Cross-validation scores:</span><br><span class="line">[0. 0. 0.]</span><br><span class="line"></span><br><span class="line">Cross-validation scores:</span><br><span class="line">[0.9  0.96 0.96]</span><br></pre></td></tr></table></figure><h2 id="ç•™ä¸€æ³•äº¤å‰éªŒè¯">ç•™ä¸€æ³•äº¤å‰éªŒè¯</h2><p>å¦ä¸€ç§å¸¸ç”¨çš„äº¤å‰éªŒè¯æ–¹æ³•æ˜¯<strong>ç•™ä¸€æ³•</strong>ï¼ˆleave-one-outï¼‰ã€‚ä½ å¯ä»¥å°†ç•™ä¸€æ³•äº¤å‰éªŒè¯çœ‹ä½œæ˜¯æ¯æŠ˜åªåŒ…å«å•ä¸ªæ ·æœ¬çš„ <span class="math inline">\(k\)</span> æŠ˜äº¤å‰éªŒè¯ã€‚å¯¹äºŽæ¯æ¬¡åˆ’åˆ†ï¼Œé€‰æ‹©å•ä¸ªæ•°æ®ç‚¹ä½œä¸ºæµ‹è¯•é›†ã€‚è¿™ç§æ–¹æ³•å¯èƒ½éžå¸¸è€—æ—¶ï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽå¤§åž‹æ•°æ®é›†æ¥è¯´ï¼Œä½†åœ¨å°åž‹æ•°æ®é›†ä¸Šæœ‰æ—¶å¯ä»¥ç»™å‡ºæ›´å¥½çš„ä¼°è®¡ç»“æžœã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.leaveoneout" target="_blank" rel="noopener"><code>class sklearn.model_selection.LeaveOneOut</code></a></p><p>Leave-One-Out cross-validator</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> LeaveOneOut</span><br><span class="line"></span><br><span class="line">loo = LeaveOneOut()</span><br><span class="line">scores = cross_val_score(logreg, iris.data, iris.target, cv=loo)</span><br><span class="line">print(<span class="string">'Number of cv iterations:'</span>, len(scores))</span><br><span class="line">print(<span class="string">'Mean accuracy: &#123;:.2f&#125;'</span>.format(scores.mean()))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Number of cv iterations: 150</span><br><span class="line">Mean accuracy: 0.95</span><br></pre></td></tr></table></figure><h2 id="æ‰“ä¹±åˆ’åˆ†äº¤å‰éªŒè¯">æ‰“ä¹±åˆ’åˆ†äº¤å‰éªŒè¯</h2><p>å¦ä¸€ç§éžå¸¸çµæ´»çš„äº¤å‰éªŒè¯ç­–ç•¥æ˜¯<strong>æ‰“ä¹±åˆ’åˆ†äº¤å‰éªŒè¯</strong>ï¼ˆshuffle-split cross-validationï¼‰ã€‚åœ¨æ‰“ä¹±åˆ’åˆ†äº¤å‰éªŒè¯ä¸­ï¼Œæ¯æ¬¡åˆ’åˆ†ä¸ºè®­ç»ƒé›†å–æ · <code>train_size</code> ä¸ªç‚¹ï¼Œä¸ºæµ‹è¯•é›†å–æ · <code>test_size</code> ä¸ªï¼ˆä¸ç›¸äº¤çš„ï¼‰ç‚¹ã€‚å°†è¿™ä¸€åˆ’åˆ†æ–¹æ³•é‡å¤ <code>n_iter</code> æ¬¡ã€‚ä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯å¯¹åŒ…å« 10 ä¸ªç‚¹çš„æ•°æ®é›†è¿›è¡Œ 4 æ¬¡è¿­ä»£åˆ’åˆ†ï¼Œæ¯æ¬¡çš„è®­ç»ƒé›†åŒ…å« 5 ä¸ªç‚¹ï¼Œæµ‹è¯•é›†åŒ…å« 2 ä¸ªç‚¹ï¼ˆä½ å¯ä»¥å°† <code>train_size</code> å’Œ <code>test_size</code> è®¾ä¸ºæ•´æ•°æ¥è¡¨ç¤ºè¿™ä¸¤ä¸ªé›†åˆçš„ç»å¯¹å¤§å°ï¼Œä¹Ÿå¯ä»¥è®¾ä¸ºæµ®ç‚¹æ•°æ¥è¡¨ç¤ºå æ•´ä¸ªæ•°æ®é›†çš„æ¯”ä¾‹ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_shuffle_split()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/shuffle-split.png"></p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.shufflesplit" target="_blank" rel="noopener"><code>class sklearn.model_selection.ShuffleSplit(n_splits=10, test_size=â€™defaultâ€™, train_size=None, random_state=None)</code></a></p><p>Random permutation cross-validator</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> ShuffleSplit</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†ä¸º 50% çš„è®­ç»ƒé›†å’Œ 50% çš„æµ‹è¯•é›†ï¼Œå…±è¿è¡Œ 10 æ¬¡è¿­ä»£</span></span><br><span class="line">shuffle_split = ShuffleSplit(test_size=<span class="number">.5</span>, train_size=<span class="number">.5</span>, n_splits=<span class="number">10</span>, random_state=<span class="number">0</span>)</span><br><span class="line">scores = cross_val_score(logreg, iris.data, iris.target, cv=shuffle_split)</span><br><span class="line">print(<span class="string">'Cross-validation scores:\n&#123;&#125;'</span>.format(scores))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cross-validation scores:</span><br><span class="line">[0.84       0.93333333 0.90666667 1.         0.90666667 0.93333333</span><br><span class="line"> 0.94666667 1.         0.90666667 0.88      ]</span><br></pre></td></tr></table></figure><p>æ‰“ä¹±åˆ’åˆ†äº¤å‰éªŒè¯å¯ä»¥åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†å¤§å°ä¹‹å¤–ç‹¬ç«‹æŽ§åˆ¶è¿­ä»£æ¬¡æ•°ï¼Œè¿™æœ‰æ—¶æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚å®ƒè¿˜å…è®¸åœ¨æ¯æ¬¡è¿­ä»£ä¸­ä»…ä½¿ç”¨éƒ¨åˆ†æ•°æ®ã€‚ç”¨è¿™ç§æ–¹æ³•å¯¹æ•°æ®è¿›è¡ŒäºŒæ¬¡é‡‡æ ·å¯èƒ½å¯¹å¤§åž‹æ•°æ®é›†ä¸Šçš„è¯•éªŒå¾ˆæœ‰å¸®åŠ©ã€‚</p><p><code>ShuufleSplit</code> è¿˜æœ‰ä¸€ç§åˆ†å±‚çš„å½¢å¼ï¼Œï¼Œå…¶åç§°ä¸º <code>StratifiedShuffleSplit</code>ï¼Œå®ƒå¯ä»¥ä¸ºåˆ†ç±»ä»»åŠ¡æä¾›æ›´å¯é çš„ç»“æžœã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.stratifiedshufflesplit" target="_blank" rel="noopener"><code>class sklearn.model_selection.StratifiedShuffleSplit(n_splits=10, test_size=â€™defaultâ€™, train_size=None, random_state=None)</code></a></p><p>Stratified ShuffleSplit cross-validator</p></blockquote><h2 id="åˆ†ç»„äº¤å‰éªŒè¯">åˆ†ç»„äº¤å‰éªŒè¯</h2><p>å¦ä¸€ç§éžå¸¸å¸¸è§çš„äº¤å‰éªŒè¯é€‚ç”¨äºŽ<strong>æ•°æ®ä¸­çš„åˆ†ç»„é«˜åº¦ç›¸å…³</strong>æ—¶ã€‚æ¯”å¦‚ä½ æƒ³æž„å»ºä¸€ä¸ªä»Žäººè„¸å›¾ç‰‡ä¸­è¯†åˆ«æƒ…æ„Ÿçš„ç³»ç»Ÿï¼Œå¹¶ä¸”æ”¶é›†äº† 100 ä¸ªäººçš„ç…§ç‰‡çš„æ•°æ®é›†ï¼Œå…¶ä¸­æ¯ä¸ªäººéƒ½è¿›è¡Œäº†å¤šæ¬¡æ‹æ‘„ï¼Œåˆ†åˆ«å±•ç¤ºäº†ä¸åŒçš„æƒ…æ„Ÿã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æž„å»ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œèƒ½å¤Ÿæ­£ç¡®è¯†åˆ«æœªåŒ…å«åœ¨æ•°æ®é›†ä¸­çš„äººçš„æƒ…æ„Ÿã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨é»˜è®¤çš„åˆ†å±‚äº¤å‰éªŒè¯æ¥åº¦é‡åˆ†ç±»å™¨çš„æ€§èƒ½ã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼ŒåŒä¸€ä¸ªäººçš„ç…§ç‰‡å¯èƒ½ä¼šåŒæ—¶å‡ºçŽ°åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­ã€‚å¯¹äºŽåˆ†ç±»å™¨è€Œè¨€ï¼Œæ£€æµ‹è®­ç»ƒé›†ä¸­å‡ºçŽ°è¿‡çš„äººè„¸æƒ…æ„Ÿæ¯”å…¨æ–°çš„äººè„¸è¦å®¹æ˜“å¾—å¤šã€‚å› æ­¤ï¼Œä¸ºäº†å‡†ç¡®è¯„ä¼°æ¨¡åž‹å¯¹æ–°çš„äººè„¸çš„æ³›åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­åŒ…å«ä¸åŒäººçš„å›¾åƒã€‚</p><p>ä¸ºäº†å®žçŽ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>GroupKFold</code>ï¼Œå®ƒä»¥ <code>groups</code> æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥ç”¨æ¥è¯´æ˜Žç…§ç‰‡ä¸­å¯¹åº”çš„æ˜¯å“ªä¸ªäººã€‚è¿™é‡Œçš„ <code>groups</code> æ•°ç»„è¡¨ç¤ºæ•°æ®ä¸­çš„åˆ†ç»„ï¼Œåœ¨åˆ›å»ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ—¶å€™ä¸åº”è¯¥å°†å…¶åˆ†å¼€ï¼Œä¹Ÿä¸åº”è¯¥ä¸Žç±»åˆ«æ ‡ç­¾å¼„æ··ã€‚</p><p>æ•°æ®åˆ†ç»„çš„è¿™ç§ä¾‹å­å¸¸è§äºŽåŒ»ç–—åº”ç”¨ï¼Œä½ å¯èƒ½ç”¨æ¥æ¥è‡ªåŒä¸€åç—…äººçš„å¤šä¸ªæ ·æœ¬ï¼Œä½†æƒ³è¦å°†å…¶æ³›åŒ–åˆ°æ–°çš„ç—…äººã€‚åŒæ ·ï¼Œåœ¨è¯­éŸ³è¯†åˆ«é¢†åŸŸï¼Œä½ çš„æ•°æ®é›†ä¸­å¯èƒ½åŒ…å«åŒä¸€åå‘è¨€äººçš„å¤šæ¡è®°å½•ï¼Œä½†ä½ å¸Œæœ›èƒ½å¤Ÿè¯†åˆ«æ–°çš„å‘è¨€äººçš„è®²è¯ã€‚</p><p>ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ç”¨åˆ°äº†ä¸€ä¸ªç”± <code>groups</code> æ•°ç»„æŒ‡å®šåˆ†ç»„çš„æ¨¡æ‹Ÿæ•°æ®é›†ã€‚è¿™ä¸ªæ•°æ®é›†åŒ…å« 12 ä¸ªæ•°æ®ç‚¹ï¼Œä¸”å¯¹äºŽæ¯ä¸ªæ•°æ®ç‚¹ï¼Œ<code>groups</code> æŒ‡å®šäº†è¯¥ç‚¹æ‰€å±žçš„åˆ†ç»„ã€‚ä¸€å…±åˆ†æˆ 4 ä¸ªç»„ï¼Œå‰ 3 ä¸ªæ ·æœ¬å±žäºŽç¬¬ä¸€ç»„ï¼ŒæŽ¥ä¸‹æ¥çš„ 4 ä¸ªæ ·æœ¬å±žäºŽç¬¬äºŒç»„ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.groupkfold" target="_blank" rel="noopener"><code>class sklearn.model_selection.GroupKFold(n_splits=â€™warnâ€™)</code></a></p><p>K-fold iterator variant with non-overlapping groups.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GroupKFold</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(n_samples=<span class="number">12</span>, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># æ ·æœ¬ä¸éœ€è¦æŒ‰åˆ†ç»„è¿›è¡ŒæŽ’åºï¼Œè¿™ä¹ˆåšåªæ˜¯ä¸ºäº†ä¾¿äºŽè¯´æ˜Ž</span></span><br><span class="line">groups = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>]</span><br><span class="line">scores = cross_val_score(logreg, X, y, groups, cv=GroupKFold(n_splits=<span class="number">3</span>))</span><br><span class="line">print(<span class="string">'Cross-validation scores:\n&#123;&#125;'</span>.format(scores))</span><br></pre></td></tr></table></figure><p>åŸºäºŽè¿™äº›æ ‡ç­¾è®¡ç®—å¾—åˆ°çš„åˆ’åˆ†å¦‚å›¾æ‰€ç¤ºã€‚å¯¹äºŽæ¯æ¬¡åˆ’åˆ†ï¼Œæ¯ä¸ªåˆ†ç»„éƒ½æ˜¯æ•´ä½“å‡ºçŽ°åœ¨è®­ç»ƒé›†æˆ–æµ‹è¯•é›†ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_group_kfold()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/group-kfold.png"></p><p>scikit-learn ä¸­è¿˜æœ‰å¾ˆå¤šäº¤å‰éªŒè¯çš„åˆ’åˆ†ç­–ç•¥ï¼Œé€‚ç”¨äºŽæ›´å¤šçš„ä½¿ç”¨åœºæ™¯ã€‚æ ‡å‡†çš„ <code>KFold</code>ã€<code>StratifiedKFold</code> å’Œ <code>GroupKFold</code> æ˜¯ç›®å‰æœ€å¸¸ç”¨çš„é›†ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> cross-validation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maximum Subarray</title>
      <link href="/programming/leetcode/maximum-subarray/"/>
      <url>/programming/leetcode/maximum-subarray/</url>
      
        <content type="html"><![CDATA[<p>Given an integer array <code>nums</code>, find the contiguous subarray (containing at least one number) which has the largest sum and return its sum.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [-2,1,-3,4,-1,2,1,-5,4]</span><br><span class="line">Output: 6</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p>Let <code>dp[j]</code> denotes the largest sum of the subarray ending at j-th index.</p><ul><li>When <code>j = 0</code>, <code>dp[j] = A[j]</code>.</li><li>When <code>j &gt; 0</code>, since subarray must ending at j-th index <code>dp[j]</code>, there are two cases: <code>A[i..j]</code> (more than one element) or <code>A[j]</code> (just the last one element). Thus, <code>dp[j] = max(dp[j - 1] + A[j], A[j])</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubarray</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        curr = res = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">            curr = max(curr, <span class="number">0</span>) + nums[i]</span><br><span class="line">            res = max(res, curr)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>Save the start and end index of the maximum subarray.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubarray</span><span class="params">(self, nums: list)</span> -&gt; tuple:</span></span><br><span class="line">        curr = res = nums[<span class="number">0</span>]</span><br><span class="line">        start = end = <span class="number">0</span></span><br><span class="line">        temp = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(nums)):</span><br><span class="line">            <span class="keyword">if</span> curr &lt; <span class="number">0</span>:</span><br><span class="line">                curr, temp = <span class="number">0</span>, i</span><br><span class="line">            curr = curr + nums[i]</span><br><span class="line">            <span class="keyword">if</span> res &lt; curr:</span><br><span class="line">                res = curr</span><br><span class="line">                start, end = temp, i</span><br><span class="line">        <span class="keyword">return</span> start, end, res</span><br></pre></td></tr></table></figure><h1 id="divide-and-conquer">Divide and Conquer</h1><a href="/notes/introduction-to-algorithms/maximum-subarray-problems/" title="æœ€å¤§å­æ•°ç»„é—®é¢˜">æœ€å¤§å­æ•°ç»„é—®é¢˜</a>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> divide and conquer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Edit Distance</title>
      <link href="/programming/leetcode/edit-distance/"/>
      <url>/programming/leetcode/edit-distance/</url>
      
        <content type="html"><![CDATA[<p>Given two words <em>word1</em> and <em>word2</em>, find the minimum number of operations required to convert <em>word1</em> to <em>word2</em>.</p><p>You have the following 3 operations permitted on a word:</p><ol type="1"><li>Insert a character</li><li>Delete a character</li><li>Replace a character</li></ol><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: word1 = &quot;horse&quot;, word2 = &quot;ros&quot;</span><br><span class="line">Output: 3</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: word1 = &quot;intention&quot;, word2 = &quot;execution&quot;</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p><code>dp[i][j]</code> denotes minimum number of operations required to convert <code>word1[0..i)</code> to <code>word2[0..j)</code>ã€‚</p><p>Base cases:</p><p><code>m</code> is the length of <code>word1</code>, <code>n</code> is the length of <code>word2</code>.</p><ul><li><code>dp[i][0] = i</code>, convert <code>word1[0..i)</code> to <code>''</code>.</li><li><code>dp[0][j] = j</code>, convert <code>''</code> to <code>word2[0..j]</code>.</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dp   0   1   2   ...   n</span><br><span class="line"> 0   0   1   2   ...   n</span><br><span class="line"> 1   1</span><br><span class="line"> 2   2</span><br><span class="line">... ...</span><br><span class="line"> m   m</span><br></pre></td></tr></table></figure><p>Induction rules:</p><ul><li>If <code>word1[i - 1] == word2[j - 1]</code>, then <code>dp[i][j] = dp[i - 1][j - 1]</code>. Since we need do nothing after we converted <code>word1[0..i - 1)</code> to <code>word2[0..j - 1)</code>.</li><li>If <code>word1[i - 1] != word2[j - 1]</code>, we have three cases to complete this convertion:<ul><li>Convert <code>word1[0..i - 1)</code> to <code>word2[0..j - 1)</code>, then replace <code>word1[i - 1]</code> by <code>word2[j - 1]</code>. So, <code>dp[i][j] = dp[i - 1][j - 1] + 1</code>.</li><li>Convert <code>word1[0..i)</code> to <code>word2[0..j - 1)</code>, then insert <code>word2[j - 1]</code>. So, <code>dp[i][j] = dp[i][j - 1] + 1</code>.</li><li>Delete <code>word1[i - 1]</code>. Then convert <code>word1[0..i - 1)</code> to <code>word2[0..j)</code>. So, <code>dp[i][j] = dp[i - 1][j] + 1</code>.</li></ul></li></ul><a id="more"></a><h2 id="bottom-up-variation">Bottom-Up Variation</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance</span><span class="params">(self, word1: str, word2: str)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(word1), len(word2)</span><br><span class="line">        dp = [[<span class="number">-1</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(m + <span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m + <span class="number">1</span>):</span><br><span class="line">            dp[i][<span class="number">0</span>] = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(n + <span class="number">1</span>):</span><br><span class="line">            dp[<span class="number">0</span>][j] = j</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> word1[i - <span class="number">1</span>] == word2[j - <span class="number">1</span>]:</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = min(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>], dp[i - <span class="number">1</span>][j - <span class="number">1</span>]) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> dp[m][n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance</span><span class="params">(self, word1: str, word2: str)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(word1), len(word2)</span><br><span class="line">        pre = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            curr = [i] * (n + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                curr[j] = min(pre[j] + <span class="number">1</span>,</span><br><span class="line">                              curr[j - <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">                              pre[j - <span class="number">1</span>] + (word1[i - <span class="number">1</span>] != word2[j - <span class="number">1</span>]))</span><br><span class="line">            pre = curr</span><br><span class="line">        <span class="keyword">return</span> pre[n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minDistance</span><span class="params">(self, word1: str, word2: str)</span> -&gt; int:</span></span><br><span class="line">        m, n = len(word1), len(word2)</span><br><span class="line">        curr = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, m + <span class="number">1</span>):</span><br><span class="line">            pre = curr[<span class="number">0</span>]</span><br><span class="line">            curr[<span class="number">0</span>] = i</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                temp = curr[j]              <span class="comment"># curr[j] is not updated yet, curr[j] == dp[i - 1][j - 1]</span></span><br><span class="line">                curr[j] = min(curr[j] + <span class="number">1</span>,  <span class="comment"># update curr[j]</span></span><br><span class="line">                              curr[j - <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">                              pre + (word1[i - <span class="number">1</span>] != word2[j - <span class="number">1</span>]))</span><br><span class="line">                pre = temp                  <span class="comment"># save dp[i - 1][j - 1] to pre</span></span><br><span class="line">        <span class="keyword">return</span> curr[n]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Binary Tree Traversal</title>
      <link href="/programming/leetcode/binary-tree-traversal/"/>
      <url>/programming/leetcode/binary-tree-traversal/</url>
      
        <content type="html"><![CDATA[<h1 id="preinpost-order">Pre/In/Post Order</h1><p>Given a binary tree, return the <em>preorder/inorder/postorder</em> traversal of its nodes' values.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br></pre></td></tr></table></figure><h2 id="recursion">Recursion</h2><p><img src="/uploads/image/leetcode/traversal.png"></p><p>Here the nodes are enumerated in the order you visit them, and you could follow <code>1-2-3-4-5</code> to compare different strategies.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(root, res)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> root:</span><br><span class="line">                res.append(root.val)</span><br><span class="line">                helper(root.left, res)</span><br><span class="line">                helper(root.right, res)</span><br><span class="line"></span><br><span class="line">        res = []</span><br><span class="line">        helper(root, res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(root, res)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> root:</span><br><span class="line">                helper(root.left, res)</span><br><span class="line">                res.append(root.val)</span><br><span class="line">                helper(root.right, res)</span><br><span class="line"></span><br><span class="line">        res = []</span><br><span class="line">        helper(root, res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">postorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">helper</span><span class="params">(root, res)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> root:</span><br><span class="line">                helper(root.left, res)</span><br><span class="line">                helper(root.right, res)</span><br><span class="line">                res.append(root.val)</span><br><span class="line"></span><br><span class="line">        res = []</span><br><span class="line">        helper(root, res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="iterating-method-using-stack">Iterating method using stack</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        res, stack = [], [root]</span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            curr = stack.pop()   <span class="comment"># first, visit</span></span><br><span class="line">            res.append(curr.val)</span><br><span class="line">            <span class="keyword">if</span> curr.right:       <span class="comment"># then, push right child</span></span><br><span class="line">                stack.append(curr.right)</span><br><span class="line">            <span class="keyword">if</span> curr.left:        <span class="comment"># last, push left child</span></span><br><span class="line">                stack.append(curr.left)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        res, stack = [], []</span><br><span class="line">        curr = root</span><br><span class="line">        <span class="keyword">while</span> curr <span class="keyword">or</span> stack:</span><br><span class="line">            <span class="keyword">while</span> curr:</span><br><span class="line">                stack.append(curr)</span><br><span class="line">                curr = curr.left</span><br><span class="line">            curr = stack.pop()    <span class="comment"># Visit leftmost node, or you can image it as</span></span><br><span class="line">            res.append(curr.val)  <span class="comment"># the parent of a None node. Then, we need to</span></span><br><span class="line">            curr = curr.right     <span class="comment"># visit it's right subtree.</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">postorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        res, stack = [], []</span><br><span class="line">        curr, last_visit = root, <span class="literal">None</span>  <span class="comment"># need a variable to record if right subtree is visited</span></span><br><span class="line">        <span class="keyword">while</span> curr <span class="keyword">or</span> stack:</span><br><span class="line">            <span class="keyword">while</span> curr:</span><br><span class="line">                stack.append(curr)</span><br><span class="line">                curr = curr.left</span><br><span class="line">            peek = stack[<span class="number">-1</span>]           <span class="comment"># leftmost node (parent node of a None node)</span></span><br><span class="line">            <span class="keyword">if</span> peek.right <span class="keyword">and</span> peek.right != last_visit:  <span class="comment"># if it's right subtree is not visited yet</span></span><br><span class="line">                curr = peek.right                          <span class="comment"># to visit it</span></span><br><span class="line">            <span class="keyword">else</span>:                                        <span class="comment"># else</span></span><br><span class="line">                last_visit = stack.pop()</span><br><span class="line">                res.append(last_visit.val)                 <span class="comment"># visit parent</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">    1</span><br><span class="line">   / \</span><br><span class="line">  2   3</span><br><span class="line"> / \</span><br><span class="line">4   5</span><br><span class="line">   / \</span><br><span class="line">  6   7</span><br></pre></td></tr></table></figure><ul><li>Preorder: [1, 2, 4, 5, 6, 7, 3]</li></ul><table><thead><tr class="header"><th>res</th><th>stack</th></tr></thead><tbody><tr class="odd"><td>1</td><td>3, 2</td></tr><tr class="even"><td>1, 2</td><td>3, 5, 4</td></tr><tr class="odd"><td>1, 2, 4</td><td>3, 5</td></tr><tr class="even"><td>1, 2, 4, 5</td><td>3, 7, 6</td></tr><tr class="odd"><td>1, 2, 4, 5, 6</td><td>3, 7</td></tr><tr class="even"><td>1, 2, 4, 5, 6, 7</td><td>3</td></tr><tr class="odd"><td>1, 2, 4, 5, 6, 7, 3</td><td></td></tr></tbody></table><ul><li>Inorder: [4, 2, 6, 5, 7, 1, 3]</li></ul><table><thead><tr class="header"><th>res</th><th>curr</th><th>stack</th><th>explanation</th></tr></thead><tbody><tr class="odd"><td></td><td>1</td><td></td><td></td></tr><tr class="even"><td></td><td>None</td><td>1, 2, 4</td><td>state when exit the inner loop</td></tr><tr class="odd"><td>4</td><td>None</td><td>1, 2</td><td>curr = 4.right</td></tr><tr class="even"><td>4, 2</td><td>5</td><td>1</td><td>curr = 2.right</td></tr><tr class="odd"><td>4, 2</td><td>None</td><td>1, 5, 6</td><td>state when exit the inner loop</td></tr><tr class="even"><td>4, 2, 6</td><td>None</td><td>1, 5</td><td>curr = 6.right</td></tr><tr class="odd"><td>4, 2, 6, 5</td><td>7</td><td>1</td><td>curr = 5.right</td></tr><tr class="even"><td>4, 2, 6, 5</td><td>None</td><td>1, 7</td><td>state when exit the inner loop</td></tr><tr class="odd"><td>4, 2, 6, 5, 7</td><td>None</td><td>1</td><td>curr = 7.right</td></tr><tr class="even"><td>4, 2, 6, 5, 7, 1</td><td>3</td><td></td><td>stack is empty</td></tr><tr class="odd"><td>4, 2, 6, 5, 7, 1</td><td>None</td><td>3</td><td>state when exit the inner loop</td></tr><tr class="even"><td>4, 2, 6, 5, 7, 1, 3</td><td></td><td></td><td></td></tr></tbody></table><ul><li>Postorder: [4, 6, 7, 5, 2, 3, 1]</li></ul><table><thead><tr class="header"><th>res</th><th>curr</th><th>stack</th><th>last_visit</th><th>explanation</th></tr></thead><tbody><tr class="odd"><td></td><td>1</td><td></td><td>None</td><td></td></tr><tr class="even"><td></td><td>None</td><td>1, 2, 4</td><td>None</td><td>state when exit the inner loop</td></tr><tr class="odd"><td>4</td><td>None</td><td>1, 2</td><td>4</td><td>stack[-1].right is None</td></tr><tr class="even"><td>4</td><td>5</td><td>1, 2</td><td>4</td><td></td></tr><tr class="odd"><td>4</td><td>None</td><td>1, 2, 5, 6</td><td>4</td><td>state when exit the inner loop</td></tr><tr class="even"><td>4, 6</td><td>None</td><td>1, 2, 5</td><td>6</td><td></td></tr><tr class="odd"><td>4, 6</td><td>7</td><td>1, 2, 5</td><td>6</td><td>curr = stack[-1].right</td></tr><tr class="even"><td>4, 6</td><td>None</td><td>1, 2, 5, 7</td><td>6</td><td>state when exit the inner loop</td></tr><tr class="odd"><td>4, 6, 7</td><td>None</td><td>1, 2, 5</td><td>7</td><td>stack[-1].right == last_visit, goto else</td></tr><tr class="even"><td>4, 6, 7, 5</td><td>None</td><td>1, 2</td><td>5</td><td>stack[-1].right == last_visit, goto else</td></tr><tr class="odd"><td>4, 6, 7, 5, 2</td><td>None</td><td>1</td><td>2</td><td></td></tr><tr class="even"><td>4, 6, 7, 5, 2</td><td>3</td><td>1</td><td>2</td><td>curr = stack[-1].right</td></tr><tr class="odd"><td>4, 6, 7, 5, 2</td><td>None</td><td>1, 3</td><td>2</td><td>state when exit the inner loop</td></tr><tr class="even"><td>4, 6, 7, 5, 2, 3</td><td>None</td><td>1</td><td>3</td><td>stack[-1].right == last_visit, goto else</td></tr><tr class="odd"><td>4, 6, 7, 5, 2, 3, 1</td><td>None</td><td></td><td>1</td><td></td></tr></tbody></table><h1 id="morris-inorder-traversal">Morris Inorder Traversal</h1><p>In this method, we have to use a new data structure -- Threaded Binary Tree, and the strategy is as follows:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. Initialize current as root</span><br><span class="line">2. While current is not None</span><br><span class="line">    2.1 If current does not have left child</span><br><span class="line">        a. Add current&apos;s data</span><br><span class="line">        b. Go to the right, i.e. current = current.right</span><br><span class="line">    2.2 Else</span><br><span class="line">        a. In current&apos;s left subtree, make current the right child of the rightmost node</span><br><span class="line">        b. Go to this left child, i.e. current = current.left</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        res = []</span><br><span class="line">        curr, pre = root, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> curr:</span><br><span class="line">            <span class="keyword">if</span> curr.left:</span><br><span class="line">                pre = curr.left</span><br><span class="line">                <span class="keyword">while</span> pre.right:  <span class="comment"># find rightmost</span></span><br><span class="line">                    pre = pre.right</span><br><span class="line">                pre.right = curr   <span class="comment"># add an edge</span></span><br><span class="line">                temp = curr</span><br><span class="line">                curr = curr.left   <span class="comment"># move to left subtree</span></span><br><span class="line">                temp.left = <span class="literal">None</span>   <span class="comment"># delete an edge, avoid infinite loop</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(curr.val)</span><br><span class="line">                curr = curr.right  <span class="comment"># move to next right node</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>See a simple example to understand how it works:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  2</span><br><span class="line"> / \     Let N(2) represent the node which has value 2.</span><br><span class="line">1   3    curr = N(2) at the beginning.</span><br><span class="line"></span><br><span class="line">  2     N(1) is the rightmost node in left subtree,</span><br><span class="line"> ^ \    which means curr = N(2) is the successor node of N(1).</span><br><span class="line">1   3   So we add an edge N(1).right = N(2), we use &apos;^&apos; represent such edges.</span><br><span class="line">        Then, move curr = N(2).left = N(1).</span><br><span class="line">        And, we deleted the edge N(2).left.</span><br><span class="line"></span><br><span class="line">  2     Now, N(1).left is None, we can visit it.</span><br><span class="line"> ^ \    We added a &apos;.&apos; to represent a node has been visited.</span><br><span class="line">1.  3   Then, move curr = N(1).right = N(2).    &lt;-- The edge we added makes sense.</span><br><span class="line"></span><br><span class="line">  2.     Again, we check if curr has left child?</span><br><span class="line"> ^ \     No, since we has deleted the edge.</span><br><span class="line">1.  3.   So, we visit N(2).</span><br><span class="line">         Then, move curr = N(2).right = N(3). Visit it.</span><br></pre></td></tr></table></figure><p>As you can see, the tree is modified by algorithm. Can we avoid it?</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        res = []</span><br><span class="line">        curr, pre = root, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> curr:</span><br><span class="line">            <span class="keyword">if</span> curr.left:</span><br><span class="line">                pre = curr.left</span><br><span class="line">                <span class="comment"># add a condition: pre.right != curr</span></span><br><span class="line">                <span class="keyword">while</span> pre.right <span class="keyword">and</span> pre.right != curr:  <span class="comment"># find rightmost</span></span><br><span class="line">                    pre = pre.right</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> pre.right:  <span class="comment"># right child is None</span></span><br><span class="line">                    pre.right = curr  <span class="comment"># add an edge</span></span><br><span class="line">                    curr = curr.left  <span class="comment"># move to left subtree</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:  <span class="comment"># pre.right == curr, means pre has benn visited</span></span><br><span class="line">                    pre.right = <span class="literal">None</span>  <span class="comment"># delete the edge we added before</span></span><br><span class="line">            res.append(curr.val)</span><br><span class="line">            curr = curr.right  <span class="comment"># move to next right node</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  2</span><br><span class="line"> / \</span><br><span class="line">1   3    curr = N(2) at the beginning.</span><br><span class="line"></span><br><span class="line">   2     N(1).right is None,</span><br><span class="line"> /^ \    So we add an edge N(1).right = N(2).</span><br><span class="line">1    3   Then, move curr = N(2).left = N(1).</span><br><span class="line"></span><br><span class="line">   2     Now, N(1).left is None, we can visit it.</span><br><span class="line"> /^ \    Then, move curr = N(1).right = N(2).</span><br><span class="line">1.   3</span><br><span class="line"></span><br><span class="line">  2.     Here comes the difference.</span><br><span class="line"> /  \    N(2).left = N(1), but N(1).right = curr.</span><br><span class="line">1.   3   Which means, N(1).right is the edge we added before.</span><br><span class="line">         So, we delete N(1).right, and visit curr N(2).</span><br><span class="line">         Then, move curr = curr.right = N(3).</span><br><span class="line"></span><br><span class="line">  2.     Visit N(3).</span><br><span class="line"> /  \    See, the tree is recovered after we traversed it.</span><br><span class="line">1.   3.</span><br></pre></td></tr></table></figure><h1 id="level-order">Level Order</h1><p>Given a binary tree, return the level order traversal of its nodes' values. (ie, from left to right, level by level).</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>Performance of stack and queue:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">list, used as stack, append() and pop()</span><br><span class="line">    similar to</span><br><span class="line">collections.deque, used as stack, append() and pop()</span><br><span class="line">    similar to</span><br><span class="line">collections.deque, used as queue, append() and popleft() (or appendleft() and pop())</span><br><span class="line">    better than</span><br><span class="line">queue.Queue, queue, put() and get() (queue is synchronized)</span><br><span class="line">    similar to</span><br><span class="line">queue.LifoQueue, stack, put() and get()</span><br><span class="line">    much much better than</span><br><span class="line">list, used as queue, append() and pop(0) ()</span><br></pre></td></tr></table></figure><p>Docs:</p><p><a href="https://devdocs.io/python~3.6/library/queue" target="_blank" rel="noopener"><code>queue â€” A synchronized queue class</code></a></p><p><a href="https://devdocs.io/python~3.6/library/collections#collections.deque" target="_blank" rel="noopener"><code>collections.deque</code></a></p><h2 id="using-two-queues">Using two queues</h2><p>One queue stores nodes in current level, another stores nodes in next level.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">levelOrder</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        res, cur = [], deque([root])</span><br><span class="line">        <span class="keyword">while</span> cur:</span><br><span class="line">            res.append([])</span><br><span class="line">            nxt = deque()  <span class="comment"># next level</span></span><br><span class="line">            <span class="keyword">while</span> cur:</span><br><span class="line">                n = cur.popleft()  <span class="comment"># queue</span></span><br><span class="line">                res[<span class="number">-1</span>].append(n.val)</span><br><span class="line">                <span class="keyword">if</span> n.left:</span><br><span class="line">                    nxt.append(n.left)</span><br><span class="line">                <span class="keyword">if</span> n.right:</span><br><span class="line">                    nxt.append(n.right)</span><br><span class="line">            cur = nxt</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h2 id="using-a-queue-and-a-variable">Using a queue and a variable</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">levelOrder</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        cur, res = deque([root]), []</span><br><span class="line">        <span class="keyword">while</span> cur:</span><br><span class="line">            res.append([])</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(cur)):  <span class="comment"># number of nodes in current level</span></span><br><span class="line">                n = cur.popleft()  <span class="comment"># queue</span></span><br><span class="line">                res[<span class="number">-1</span>].append(n.val)</span><br><span class="line">                <span class="keyword">if</span> n.left:</span><br><span class="line">                    cur.append(n.left)</span><br><span class="line">                <span class="keyword">if</span> n.right:</span><br><span class="line">                    cur.append(n.right)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="zigzag-level-order">Zigzag Level Order</h1><p>Given a binary tree, return the zigzag level order traversal of its nodes' values. (ie, from left to right, then right to left for the next level and alternate between).</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">    3</span><br><span class="line">   / \</span><br><span class="line">  9  20</span><br><span class="line">    /  \</span><br><span class="line">   15   7</span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [20,9],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="using-two-stacks">Using two stacks</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input:</span><br><span class="line">           1</span><br><span class="line">      /         \</span><br><span class="line">     2           3</span><br><span class="line">   /   \       /   \</span><br><span class="line">  4     5     6     7</span><br><span class="line"> / \   / \   / \   / \</span><br><span class="line">8   9 10 11 12 13 14 15</span><br></pre></td></tr></table></figure><table><thead><tr class="header"><th>visit</th><th>stack1 (current level)</th><th>stack2 (next level)</th></tr></thead><tbody><tr class="odd"><td>1</td><td>2, 3</td><td></td></tr><tr class="even"><td>3</td><td>2</td><td>7, 6</td></tr><tr class="odd"><td>2</td><td></td><td>7, 6, 5, 4</td></tr><tr class="even"><td>4</td><td>8, 9</td><td>7, 6, 5</td></tr><tr class="odd"><td>5</td><td>8, 9, 10, 11</td><td>7, 6</td></tr><tr class="even"><td>6</td><td>8, 9, 10, 11, 12, 13</td><td>7</td></tr><tr class="odd"><td>7</td><td>8, 9, 10, 11, 12, 13, 14, 15</td><td></td></tr><tr class="even"><td>15</td><td>8, 9, 10, 11, 12, 13, 14</td><td></td></tr><tr class="odd"><td>...</td><td></td><td></td></tr></tbody></table><p>We need stack becacuse the visit order is changed each level, the node visit later in previous level, it's children will be visited earlier. That's exactly the property of stack.</p><p>And we need to note that the order to push children into stack is also different by level. From the example, we know if current level is visited from left, the order to push it's childern is (left, right); otherwise, (right, left).</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">zigzagLevelOrder</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        res, cur = [], deque([root])</span><br><span class="line">        reverse = <span class="literal">True</span>  <span class="comment"># add a flag</span></span><br><span class="line">        <span class="keyword">while</span> cur:</span><br><span class="line">            res.append([])</span><br><span class="line">            nxt = deque()</span><br><span class="line">            reverse = <span class="keyword">not</span> reverse  <span class="comment"># flip when a new level started</span></span><br><span class="line">            <span class="keyword">while</span> cur:</span><br><span class="line">                n = cur.pop()</span><br><span class="line">                res[<span class="number">-1</span>].append(n.val)</span><br><span class="line">                <span class="keyword">if</span> reverse:</span><br><span class="line">                    <span class="keyword">if</span> n.right:</span><br><span class="line">                        nxt.append(n.right)</span><br><span class="line">                    <span class="keyword">if</span> n.left:</span><br><span class="line">                        nxt.append(n.left)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> n.left:</span><br><span class="line">                        nxt.append(n.left)</span><br><span class="line">                    <span class="keyword">if</span> n.right:</span><br><span class="line">                        nxt.append(n.right)</span><br><span class="line">            cur = nxt</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> stack </tag>
            
            <tag> recursion </tag>
            
            <tag> tree </tag>
            
            <tag> traversal </tag>
            
            <tag> level order </tag>
            
            <tag> morris </tag>
            
            <tag> preorder </tag>
            
            <tag> inorder </tag>
            
            <tag> postorder </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Longest Valid Parentheses</title>
      <link href="/programming/leetcode/longest-valid-parentheses/"/>
      <url>/programming/leetcode/longest-valid-parentheses/</url>
      
        <content type="html"><![CDATA[<p>Given a string <code>s</code> containing just the characters <code>(</code> and <code>)</code>, find the length of the longest valid (well-formed) parentheses substring.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;(()&quot;</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;)()())&quot;</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><h1 id="dynamic-programming">Dynamic Programming</h1><p><code>dp[i]</code> denotes length of the longest valid substring ending at ith index.</p><p>Induction rules:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if s[i] == &apos;(&apos;:        # valid parentheses never end with &apos;(&apos;</span><br><span class="line">    dp[i] = 0</span><br><span class="line"></span><br><span class="line">if s[i] == &apos;)&apos;:</span><br><span class="line">    if s[i - 1] == &apos;(&apos;:                   # &apos;x()&apos;</span><br><span class="line">        # dp[i - 2] is the length of &apos;x&apos;, 2 is the length of &apos;()&apos;</span><br><span class="line">        dp[i] = dp[i - 2] + 2</span><br><span class="line"></span><br><span class="line">    # dp[i - 1] is the length of &apos;x&apos;</span><br><span class="line">    elif s[i - dp[i - 1] - 1] == &apos;(&apos;:     # &apos;y(x)&apos;</span><br><span class="line">        # dp[i - dp[i - 1] - 2] is the length of &apos;y&apos;</span><br><span class="line">        dp[i] = dp[i - dp[i - 1] - 2] + dp[i - 1] + 2</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestValidParentheses</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        maxans = <span class="number">0</span></span><br><span class="line">        dp = [<span class="number">0</span>] * len(s)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(s)):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">')'</span>:</span><br><span class="line">                <span class="keyword">if</span> s[i - <span class="number">1</span>] == <span class="string">'('</span>:</span><br><span class="line">                    dp[i] = dp[i - <span class="number">2</span>] + <span class="number">2</span></span><br><span class="line">                <span class="keyword">elif</span> i - dp[i - <span class="number">1</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> s[i - dp[i - <span class="number">1</span>] - <span class="number">1</span>] == <span class="string">'('</span>:</span><br><span class="line">                    dp[i] = dp[i - dp[i - <span class="number">1</span>] - <span class="number">2</span>] + dp[i - <span class="number">1</span>] + <span class="number">2</span></span><br><span class="line">            maxans = max(maxans, dp[i])</span><br><span class="line">        <span class="keyword">return</span> maxans</span><br></pre></td></tr></table></figure><h1 id="using-stack">Using Stack</h1><p>Initial, push -1 onto stack.</p><p>For every <code>'('</code> encountered, push its index onto the stack.</p><p>For every <code>')'</code> encountered, pop the topmost element and substract the current element's index from the new top element of the stack, which gives the length of the currently encountered valid string of parentheses. If while popping the element, the stack becomes empty, we push the current element's index onto the stack.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestValidParentheses</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        maxans = <span class="number">0</span></span><br><span class="line">        stack = [<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">'('</span>:</span><br><span class="line">                stack.append(i)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stack.pop()</span><br><span class="line">                <span class="keyword">if</span> stack:</span><br><span class="line">                    maxans = max(maxans, i - stack[<span class="number">-1</span>])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    stack.append(i)</span><br><span class="line">        <span class="keyword">return</span> maxans</span><br></pre></td></tr></table></figure><h1 id="without-extra-space">Without extra space</h1><p>In this approach, we make use of two counters <code>left</code> and <code>right</code>.</p><p>First, we start traversing the string from the left towards the right and for every <code>'('</code> encountered, we increment the <code>left</code> counter and for every <code>')'</code> encountered, we increment the <code>right</code> counter. Whenever <code>left</code> becomes equal to <code>right</code>, we calculate the length of the current valid string and keep track of maximum length substring found so far. If <code>right</code> becomes greater than <code>left</code> we reset <code>left</code> and <code>right</code> to 0.</p><p>Next, we start traversing the string from right to left and similar procedure is applied.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestValidParentheses</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        maxans = left = right = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> s:            <span class="comment"># left to right scan</span></span><br><span class="line">            <span class="keyword">if</span> c == <span class="string">'('</span>:</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> left == right:</span><br><span class="line">                maxans = max(maxans, <span class="number">2</span> * left)</span><br><span class="line">            <span class="keyword">elif</span> right &gt; left:</span><br><span class="line">                left = right = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> reversed(s):  <span class="comment"># right to left scan</span></span><br><span class="line">            <span class="keyword">if</span> c == <span class="string">'('</span>:</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> left == right:</span><br><span class="line">                maxans = max(maxans, <span class="number">2</span> * left)</span><br><span class="line">            <span class="keyword">elif</span> right &gt; left:</span><br><span class="line">                left = right = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> maxans</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Longest Palindromic Substring</title>
      <link href="/programming/leetcode/longest-palindromic-substring/"/>
      <url>/programming/leetcode/longest-palindromic-substring/</url>
      
        <content type="html"><![CDATA[<p>Given a string <strong>s</strong>, find the longest palindromic substring in <strong>s</strong>. You may assume that the maximum length of <strong>s</strong> is 1000ã€‚</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;babad&quot;</span><br><span class="line">Output: &quot;bab&quot;</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: &quot;cbbd&quot;</span><br><span class="line">Output: &quot;bb&quot;</span><br></pre></td></tr></table></figure><h1 id="dynamic-progromming">Dynamic Progromming</h1><p><code>dp[i][j]</code> denotes whether the substring <code>s[i..j]</code> is a palindrome.</p><p>Base cases:</p><ul><li><p><code>dp[i][i] = true</code>.</p></li><li><p><code>dp[i][i + 1] = s[i] == s[i + 1]</code>.</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s=&quot;xabaa&quot;</span><br><span class="line"></span><br><span class="line">dp  0  1  2  3  4</span><br><span class="line"> 0  T  F</span><br><span class="line"> 1     T  F</span><br><span class="line"> 2        T  F</span><br><span class="line"> 3           T  T</span><br><span class="line"> 4              T</span><br></pre></td></tr></table></figure><p>Induction rule:</p><p>If <code>s[i] == s[j]</code>, then <code>dp[i][j] = dp[i + 1][j - 1]</code>. i.e. <code>dp[i][j] = dp[i + 1][j - 1] and s[i] == s[j]</code>.</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n^2)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestPalindrome</span><span class="params">(self, s: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">        n, start, stop = len(s), <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        dp = [[<span class="literal">False</span>] * n <span class="keyword">for</span> _ <span class="keyword">in</span> range(n)]</span><br><span class="line">        <span class="keyword">for</span> right <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> left <span class="keyword">in</span> range(right + <span class="number">1</span>):</span><br><span class="line">                <span class="keyword">if</span> s[left] == s[right] <span class="keyword">and</span> \</span><br><span class="line">                        (right - left &lt;= <span class="number">2</span> <span class="keyword">or</span> dp[left + <span class="number">1</span>][right - <span class="number">1</span>]):</span><br><span class="line">                    dp[left][right] = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">if</span> stop - start &lt; right - left + <span class="number">1</span>:</span><br><span class="line">                        start, stop = left, right + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> s[start:stop]</span><br></pre></td></tr></table></figure><h1 id="expand-around-center">Expand Around Center</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestPalindrome</span><span class="params">(self, s: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">        start, end = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">            len1 = self.expandAroundCenter(s, i, i)      <span class="comment"># length is odd</span></span><br><span class="line">            len2 = self.expandAroundCenter(s, i, i + <span class="number">1</span>)  <span class="comment"># length is even</span></span><br><span class="line">            len_max = max(len1, len2)</span><br><span class="line">            <span class="keyword">if</span> len_max &gt; end - start:  <span class="comment"># calculate the start and end of palindromic string</span></span><br><span class="line">                <span class="comment"># what a smart way</span></span><br><span class="line">                start = i - (len_max - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">                end = i + len_max // <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> s[start:end + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">expandAroundCenter</span><span class="params">(self, s: str, left: int, right: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">while</span> left &gt;= <span class="number">0</span> <span class="keyword">and</span> right &lt; len(s) <span class="keyword">and</span> s[left] == s[right]:</span><br><span class="line">            left, right = left - <span class="number">1</span>, right + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> right - left - <span class="number">1</span>  <span class="comment"># length of palindromic string</span></span><br></pre></td></tr></table></figure><h1 id="manachers-algorithm">Manacher's Algorithm</h1><p>// TODO //</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> palindrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Regular Expression Matching</title>
      <link href="/programming/leetcode/regular-expression-matching/"/>
      <url>/programming/leetcode/regular-expression-matching/</url>
      
        <content type="html"><![CDATA[<p>Given an input string (<code>s</code>) and a pattern (<code>p</code>), implement regular expression matching with support for <code>'.'</code> and <code>'*'</code>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;.&apos; Matches any single character.</span><br><span class="line">&apos;*&apos; Matches zero or more of the preceding element.</span><br></pre></td></tr></table></figure><p>The matching should cover the <strong>entire</strong> input string (not partial).</p><p><strong>Note:</strong></p><ul><li><code>s</code> could be empty and contains only lowercase letters <code>a-z</code>.</li><li><code>p</code> could be empty and contains only lowercase letters <code>a-z</code>, and characters like <code>.</code> or <code>*</code>.</li></ul><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;aa&quot;, p = &quot;a&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;aa&quot;, p = &quot;a*&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;ab&quot;, p = &quot;.*&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 4:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;aab&quot;, p = &quot;c*a*b&quot;</span><br><span class="line">Output: true</span><br></pre></td></tr></table></figure><p>Example 5:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: s = &quot;mississippi&quot;, p = &quot;mis*is*p*&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h1 id="recursion">Recursion</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, text: str, pattern: str)</span> -&gt; bool:</span></span><br><span class="line">        first_match = bool(text) <span class="keyword">and</span> pattern[<span class="number">0</span>] <span class="keyword">in</span> &#123;text[<span class="number">0</span>], <span class="string">'.'</span>&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(pattern) &gt;= <span class="number">2</span> <span class="keyword">and</span> pattern[<span class="number">1</span>] == <span class="string">'*'</span>:</span><br><span class="line">            <span class="keyword">return</span> (self.isMatch(text, pattern[<span class="number">2</span>:]) <span class="keyword">or</span>                  <span class="comment"># pattern[0:2] matches empty sequence</span></span><br><span class="line">                    first_match <span class="keyword">and</span> self.isMatch(text[<span class="number">1</span>:], pattern))    <span class="comment"># pattern[0:2] matches one character</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> first_match <span class="keyword">and</span> self.isMatch(text[<span class="number">1</span>:], pattern[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure><p>Time complexity: <span class="math inline">\(O((m+n)2^{m+\frac{n}{2}})\)</span>, where <code>m</code> is the length of text and <code>n</code> is the length of pattern.</p><p>Space complexity: <span class="math inline">\(O((m+n)2^{m+\frac{n}{2}})\)</span>.</p><a id="more"></a><h1 id="dynamic-programming">Dynamic Programming</h1><p><code>dp[i][j]</code> denotes wether <code>text[i..m]</code> matches <code>pattern[j..n]</code>. Indices start from 0.</p><p>Base cases:</p><ul><li><p><code>dp[i][n] = False</code>. when <code>i = 0, 1, ..., m-1</code>. Because <code>text[i:] != ''</code> but <code>pattern[n:] == ''</code>.</p></li><li><p><code>dp[m][n] = True</code>. Because <code>text[m:] == ''</code> and <code>pattern[n:] == ''</code>.</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dp  0  1  2  ... n</span><br><span class="line"> 0               F</span><br><span class="line"> 1               F</span><br><span class="line"> 2               F</span><br><span class="line">...              F</span><br><span class="line"> m               T</span><br></pre></td></tr></table></figure><p>Induction rules:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">If p[j + 1] == &apos;*&apos;:                 # p[j]p[j + 1] may match zero or many chars in text</span><br><span class="line">    dp[i][j] = dp[i][j + 2] or      # when match zero char, s[i] != p[j] is also acceptable</span><br><span class="line">               dp[i + 1][j] and (s[i] == p[j] or p[j] == &apos;.&apos;)  # or match one char</span><br><span class="line"></span><br><span class="line">if p[j + 1] != &apos;*&apos;:             # s[i] must match p[j] and s[i+1:] must match p[j+1:]</span><br><span class="line">    dp[i][j] = (s[i] == p[j] or p[j] == &apos;.&apos;) and dp[i + 1][j + 1]</span><br></pre></td></tr></table></figure><h2 id="top-down-variation">Top-Down Variation</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, text: str, pattern: str)</span> -&gt; bool:</span></span><br><span class="line">        memo = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">dp</span><span class="params">(i, j)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> (i, j) <span class="keyword">not</span> <span class="keyword">in</span> memo:</span><br><span class="line">                <span class="keyword">if</span> j == len(pattern):</span><br><span class="line">                    ans = i == len(text)  <span class="comment"># dp(m, n) is true, otherwise false</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    first_match = i &lt; len(text) <span class="keyword">and</span> pattern[j] <span class="keyword">in</span> &#123;text[i], <span class="string">'.'</span>&#125;</span><br><span class="line">                    <span class="keyword">if</span> j + <span class="number">1</span> &lt; len(pattern) <span class="keyword">and</span> pattern[j + <span class="number">1</span>] == <span class="string">'*'</span>:</span><br><span class="line">                        ans = dp(i, j + <span class="number">2</span>) <span class="keyword">or</span> first_match <span class="keyword">and</span> dp(i + <span class="number">1</span>, j)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        ans = first_match <span class="keyword">and</span> dp(i + <span class="number">1</span>, j + <span class="number">1</span>)</span><br><span class="line">                memo[i, j] = ans</span><br><span class="line">            <span class="keyword">return</span> memo[i, j]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp(<span class="number">0</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h2 id="bottom-up-variation">Bottom-Up Variation</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(mn)</span></span><br><span class="line"><span class="comment"># Space: O(mn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isMatch</span><span class="params">(self, text: str, pattern: str)</span> -&gt; bool:</span></span><br><span class="line">        dp = [[<span class="literal">False</span>] * (len(pattern) + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(text) + <span class="number">1</span>)]</span><br><span class="line">        dp[<span class="number">-1</span>][<span class="number">-1</span>] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(text), <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(len(pattern) - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">                first_match = i &lt; len(text) <span class="keyword">and</span> pattern[j] <span class="keyword">in</span> &#123;text[i], <span class="string">'.'</span>&#125;</span><br><span class="line">                <span class="keyword">if</span> j + <span class="number">1</span> &lt; len(pattern) <span class="keyword">and</span> pattern[j + <span class="number">1</span>] == <span class="string">'*'</span>:</span><br><span class="line">                    dp[i][j] = dp[i][j + <span class="number">2</span>] <span class="keyword">or</span> first_match <span class="keyword">and</span> dp[i + <span class="number">1</span>][j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    dp[i][j] = first_match <span class="keyword">and</span> dp[i + <span class="number">1</span>][j + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> leetcode </tag>
            
            <tag> matching </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®è¡¨ç¤ºä¸Žç‰¹å¾å·¥ç¨‹</title>
      <link href="/notes/introduction-to-ml-with-python/representing-data-and-engineering-features/"/>
      <url>/notes/introduction-to-ml-with-python/representing-data-and-engineering-features/</url>
      
        <content type="html"><![CDATA[<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´å‡è®¾æ•°æ®æ˜¯ç”±æµ®ç‚¹æ•°ç»„æˆçš„äºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€åˆ—æ˜¯æè¿°æ•°æ®ç‚¹çš„<strong>è¿žç»­ç‰¹å¾</strong>ï¼ˆcontinuous featureï¼‰ã€‚å¯¹äºŽè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œæ•°æ®çš„æ”¶é›†æ–¹å¼å¹¶ä¸æ˜¯è¿™æ ·ã€‚ä¸€ç§å¸¸è§çš„ç‰¹å¾ç±»åž‹å°±æ˜¯<strong>åˆ†ç±»ç‰¹å¾</strong>ï¼ˆcategorical featureï¼‰ï¼Œä¹Ÿå«<strong>ç¦»æ•£ç‰¹å¾</strong>ï¼ˆdiscrete featureï¼‰ã€‚åˆ†ç±»ç‰¹å¾çš„ä¾‹å­åŒ…æ‹¬äº§å“çš„å“ç‰Œã€äº§å“çš„é¢œè‰²æˆ–äº§å“çš„é”€å”®éƒ¨é—¨ã€‚è¿™äº›éƒ½æ˜¯æè¿°ä¸€ä»¶äº§å“çš„å±žæ€§ï¼Œä½†å®ƒä»¬ä¸ä»¥è¿žç»­çš„æ–¹å¼å˜åŒ–ã€‚</p><p>æ— è®ºæ•°æ®åŒ…å«å“ªç§ç±»åž‹çš„ç‰¹å¾ï¼Œæ•°æ®è¡¨ç¤ºæ–¹å¼éƒ½ä¼šå¯¹æœºå™¨å­¦ä¹ æ¨¡åž‹çš„æ€§èƒ½äº§ç”Ÿå·¨å¤§å½±å“ã€‚æ•°æ®ç¼©æ”¾éžå¸¸é‡è¦ã€‚å¦‚æžœä½ æ²¡æœ‰ç¼©æ”¾æ•°æ®ï¼ˆæ¯”å¦‚ï¼Œç¼©æ”¾åˆ°å•ä½æ–¹å·®ï¼‰ï¼Œé‚£ä¹ˆä½ ç”¨åŽ˜ç±³è¿˜æ˜¯è‹±å¯¸è¡¨ç¤ºæµ‹é‡æ•°æ®çš„ç»“æžœå°†ä¼šä¸åŒã€‚ç”¨é¢å¤–çš„ç‰¹å¾<strong>æ‰©å……</strong>ï¼ˆaugmentï¼‰æ•°æ®ä¹Ÿå¾ˆæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚æ·»åŠ ç‰¹å¾çš„äº¤äº’é¡¹ï¼ˆä¹˜ç§¯ï¼‰æˆ–æ›´ä¸€èˆ¬çš„å¤šé¡¹å¼ã€‚</p><p>å¯¹äºŽæŸä¸ªç‰¹å®šåº”ç”¨æ¥è¯´ï¼Œå¦‚ä½•æ‰¾åˆ°æœ€ä½³æ•°æ®è¡¨ç¤ºï¼Œè¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º<strong>ç‰¹å¾å·¥ç¨‹</strong>ï¼ˆfeature engineeringï¼‰ï¼Œå®ƒæ˜¯æ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ ä»Žä¸šè€…åœ¨å°è¯•è§£å†³çŽ°å®žä¸–ç•Œé—®é¢˜æ—¶ä¸»è¦ä»»åŠ¡ä¹‹ä¸€ã€‚ç”¨æ­£ç¡®çš„æ–¹å¼è¡¨ç¤ºæ•°æ®ï¼Œå¯¹ç›‘ç£æ¨¡åž‹æ€§èƒ½çš„å½±å“æ¯”æ‰€é€‰æ‹©çš„ç²¾ç¡®å‚æ•°è¿˜è¦å¤§ã€‚</p><a id="more"></a><h1 id="åˆ†ç±»å˜é‡">åˆ†ç±»å˜é‡</h1><p>ä½œä¸ºä¾‹å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¾Žå›½æˆå¹´äººæ”¶å…¥çš„æ•°æ®é›†ã€‚adultæ•°æ®é›†çš„ä»»åŠ¡æ˜¯é¢„æµ‹ä¸€åå·¥äººçš„æ”¶å…¥æ˜¯é«˜äºŽ50 000ç¾Žå…ƒè¿˜æ˜¯ä½ŽäºŽ50 000ç¾Žå…ƒã€‚è¿™ä¸ªæ•°æ®é›†çš„ç‰¹å¾åŒ…æ‹¬å·¥äººçš„å¹´é¾„ã€é›‡ä½£æ–¹å¼ã€æ•™è‚²æ°´å¹³ã€æ€§åˆ«ã€æ¯å‘¨å·¥ä½œæ—¶é•¿ã€èŒä¸šï¼Œç­‰ç­‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> display</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…å«åˆ—åç§°çš„è¡¨å¤´ï¼Œå› æ­¤æˆ‘ä»¬ä¼ å…¥header=None</span></span><br><span class="line"><span class="comment"># ç„¶åŽåœ¨"names"ä¸­æ˜¾å¼åœ°æä¾›åç§°</span></span><br><span class="line">data = pd.read_csv(os.path.join(mglearn.datasets.DATA_PATH, <span class="string">"adult.data"</span>),</span><br><span class="line">    header=<span class="literal">None</span>, index_col=<span class="literal">False</span>,</span><br><span class="line">    names=[<span class="string">'age'</span>, <span class="string">'workclass'</span>, <span class="string">'fnlwgt'</span>, <span class="string">'education'</span>, <span class="string">'education-num'</span>,</span><br><span class="line">           <span class="string">'marital-status'</span>, <span class="string">'occupation'</span>, <span class="string">'relationship'</span>, <span class="string">'race'</span>, <span class="string">'gender'</span>,</span><br><span class="line">           <span class="string">'capital-gain'</span>, <span class="string">'capital-loss'</span>, <span class="string">'hours-per-week'</span>, <span class="string">'native-country'</span>,</span><br><span class="line">           <span class="string">'income'</span>])</span><br><span class="line"><span class="comment"># åªé€‰å…¶ä¸­å‡ åˆ—</span></span><br><span class="line">data = data[[<span class="string">'age'</span>, <span class="string">'workclass'</span>, <span class="string">'education'</span>, <span class="string">'gender'</span>, <span class="string">'hours-per-week'</span>,</span><br><span class="line">             <span class="string">'occupation'</span>, <span class="string">'income'</span>]]</span><br><span class="line"></span><br><span class="line">display(data.head())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   age          workclass  ...          occupation  income</span><br><span class="line">0   39          State-gov  ...        Adm-clerical   &lt;=50K</span><br><span class="line">1   50   Self-emp-not-inc  ...     Exec-managerial   &lt;=50K</span><br><span class="line">2   38            Private  ...   Handlers-cleaners   &lt;=50K</span><br><span class="line">3   53            Private  ...   Handlers-cleaners   &lt;=50K</span><br><span class="line">4   28            Private  ...      Prof-specialty   &lt;=50K</span><br><span class="line"></span><br><span class="line">[5 rows x 7 columns]</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ•°æ®é›†ä¸­ï¼Œageï¼ˆå¹´é¾„ï¼‰å’Œhours-per-weekï¼ˆæ¯å‘¨å·¥ä½œæ—¶é•¿ï¼‰æ˜¯è¿žç»­ç‰¹å¾ã€‚ä½†workclassï¼ˆå·¥ä½œç±»åž‹ï¼‰ã€educationï¼ˆæ•™è‚²ç¨‹åº¦ï¼‰ã€genderï¼ˆæ€§åˆ«ï¼‰ã€occupationï¼ˆèŒä¸šï¼‰éƒ½æ˜¯åˆ†ç±»ç‰¹å¾ï¼Œå®ƒä»¬éƒ½æ¥è‡ªä¸€ç³»åˆ—å›ºå®šçš„å¯èƒ½å–å€¼ï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªèŒƒå›´ï¼‰ï¼Œè¡¨ç¤ºçš„æ˜¯å®šæ€§å±žæ€§ï¼ˆè€Œä¸æ˜¯æ•°é‡ï¼‰ã€‚</p><p>å‡è®¾æˆ‘ä»¬æƒ³è¦åœ¨è¿™ä¸ªæ•°æ®ä¸Šå­¦ä¹ ä¸€ä¸ªLogisticå›žå½’åˆ†ç±»å™¨ã€‚Logisticå›žå½’åˆ©ç”¨ä¸‹åˆ—å…¬å¼è¿›è¡Œé¢„æµ‹ï¼š</p><p><span class="math display">\[\hat y=w[0]*x[0]+w[1]*x[1]+\dots+w[p]*x[p]+b&gt;0\]</span></p><p>å…¶ä¸­ <span class="math inline">\(w[i]\)</span> å’Œ <span class="math inline">\(b\)</span> æ˜¯ä»Žè®­ç»ƒé›†ä¸­å­¦åˆ°çš„ç³»æ•°ï¼Œ<span class="math inline">\(x[i]\)</span> æ˜¯è¾“å…¥ç‰¹å¾ã€‚å½“ <span class="math inline">\(x[i]\)</span> æ˜¯æ•°å­—æ—¶è¿™ä¸ªå…¬å¼æ‰æœ‰æ„ä¹‰ï¼Œä½†å¦‚æžœ <span class="math inline">\(x[2]\)</span> æ˜¯ &quot;Masters&quot; æˆ– &quot;Bachelors&quot; çš„è¯ï¼Œè¿™ä¸ªå…¬å¼åˆ™æ²¡æœ‰æ„ä¹‰ã€‚æ˜¾ç„¶ï¼Œåœ¨åº”ç”¨Logisticå›žå½’æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸€ç§æ–¹å¼æ¥è¡¨ç¤ºæ•°æ®ã€‚</p><h2 id="one-hotç¼–ç è™šæ‹Ÿå˜é‡">One-Hotç¼–ç ï¼ˆè™šæ‹Ÿå˜é‡ï¼‰</h2><p>è¡¨ç¤ºåˆ†ç±»å˜é‡æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ <strong>one-hotç¼–ç </strong>ï¼ˆone-hot-encodingï¼‰æˆ– <strong>Nå–ä¸€ç¼–ç </strong>ï¼ˆone-out-of-N encodingï¼‰ï¼Œä¹Ÿå«<strong>è™šæ‹Ÿå˜é‡</strong>ï¼ˆdummy variableï¼‰ã€‚è™šæ‹Ÿå˜é‡èƒŒåŽçš„æ€æƒ³æ˜¯å°†ä¸€ä¸ªåˆ†ç±»å˜é‡æ›¿æ¢ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ–°ç‰¹å¾ï¼Œæ–°ç‰¹å¾å–å€¼ä¸º 0 å’Œ 1ã€‚å¯¹äºŽçº¿æ€§äºŒåˆ†ç±»ï¼ˆä»¥åŠ scikit-learn ä¸­å…¶ä»–æ‰€æœ‰æ¨¡åž‹ï¼‰çš„å…¬å¼è€Œè¨€ï¼Œ0 å’Œ 1 è¿™ä¸¤ä¸ªå€¼æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªç±»åˆ«å¼•å…¥ä¸€ä¸ªæ–°ç‰¹å¾ï¼Œä»Žè€Œè¡¨ç¤ºä»»æ„æ•°é‡çš„ç±»åˆ«ã€‚</p><p>æ¯”å¦‚è¯´ workclass ç‰¹å¾çš„å¯èƒ½å–å€¼åŒ…æ‹¬ &quot;Government Employee&quot;ã€&quot;Private Employee&quot;ã€&quot;Self Employed&quot; å’Œ &quot;Self Employed Incorporated&quot;ã€‚ä¸ºäº†ç¼–ç è¿™4ä¸ªå¯èƒ½çš„å–å€¼ï¼Œæˆ‘ä»¬åˆ›å»ºäº†4ä¸ªæ–°ç‰¹å¾ï¼Œåˆ†åˆ«å«ä½œ &quot;Government Employee&quot;ã€&quot;Private Employee&quot;ã€&quot;Self Employed&quot; å’Œ &quot;Self Employed Incorporated&quot;ã€‚å¦‚æžœä¸€ä¸ªäººçš„ workclass å–æŸä¸ªå€¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç‰¹å¾å–å€¼ä¸º 1ï¼Œå…¶ä»–ç‰¹å¾å‡å–å€¼ä¸º 0ã€‚å› æ­¤ï¼Œå¯¹æ¯ä¸ªæ•°æ®ç‚¹æ¥è¯´ï¼Œ4ä¸ªæ–°ç‰¹å¾ä¸­åªæœ‰ä¸€ä¸ªçš„å–å€¼ä¸º 1ã€‚è¿™å°±æ˜¯å®ƒå«ä½œ one-hot ç¼–ç æˆ– Nå–ä¸€ç¼–ç çš„åŽŸå› ã€‚</p><blockquote><p>æˆ‘ä»¬ä½¿ç”¨çš„ one-hot ç¼–ç ä¸Žç»Ÿè®¡å­¦ä¸­ä½¿ç”¨çš„è™šæ‹Ÿç¼–ç ï¼ˆdummy encodingï¼‰éžå¸¸ç›¸ä¼¼ï¼Œä½†å¹¶ä¸å®Œå…¨ç›¸åŒã€‚åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œé€šå¸¸å°†å…·æœ‰ k ä¸ªå¯èƒ½å–å€¼çš„åˆ†ç±»ç‰¹å¾ç¼–ç ä¸º k-1 ä¸ªç‰¹å¾ï¼ˆéƒ½ç­‰äºŽé›¶è¡¨ç¤ºæœ€åŽä¸€ä¸ªå¯èƒ½å–å€¼ï¼‰ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†ç®€åŒ–åˆ†æžï¼ˆæ›´ä¸“ä¸šçš„è¯´æ³•æ˜¯ï¼Œè¿™å¯ä»¥é¿å…ä½¿æ•°æ®çŸ©é˜µç§©äºï¼‰ã€‚</p></blockquote><p>å°†æ•°æ®è½¬æ¢ä¸ºåˆ†ç±»å˜é‡çš„ one-hot ç¼–ç æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯ä½¿ç”¨ pandasï¼Œä¸€ç§æ˜¯ä½¿ç”¨ scikit-learnã€‚</p><h3 id="æ£€æŸ¥å­—ç¬¦ä¸²ç¼–ç çš„åˆ†ç±»æ•°æ®">æ£€æŸ¥å­—ç¬¦ä¸²ç¼–ç çš„åˆ†ç±»æ•°æ®</h3><p>è¯»å–å®Œæ•°æ®é›†ä¹‹åŽï¼Œæœ€å¥½å…ˆæ£€æŸ¥æ¯ä¸€åˆ—æ˜¯å¦åŒ…å«æœ‰æ„ä¹‰çš„åˆ†ç±»æ•°æ®ã€‚åœ¨å¤„ç†äººå·¥ï¼ˆæ¯”å¦‚ç½‘ç«™ç”¨æˆ·ï¼‰è¾“å…¥çš„æ•°æ®æ—¶ï¼Œå¯èƒ½æ²¡æœ‰å›ºå®šçš„ç±»åˆ«ï¼Œæ‹¼å†™å’Œå¤§å°å†™ä¹Ÿå­˜åœ¨å·®å¼‚ï¼Œå› æ­¤å¯èƒ½éœ€è¦é¢„å¤„ç†ã€‚æ£€æŸ¥åˆ—çš„å†…å®¹æœ‰ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ pandas Seriesï¼ˆSeries æ˜¯ DataFrame ä¸­å•åˆ—å¯¹åº”çš„æ•°æ®ç±»åž‹ï¼‰çš„ values_counts å‡½æ•°ï¼Œä»¥æ˜¾ç¤ºå”¯ä¸€å€¼åŠå…¶å‡ºçŽ°æ¬¡æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(data.gender.value_counts())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> Male      21790</span><br><span class="line"> Female    10771</span><br><span class="line">Name: gender, dtype: int64</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ•°æ®é›†ä¸­æ€§åˆ«åˆšå¥½æœ‰ä¸¤ä¸ªå€¼ï¼šMale å’Œ Femaleï¼Œè¿™è¯´æ˜Žæ•°æ®æ ¼å¼å·²ç»å¾ˆå¥½ï¼Œå¯ä»¥ç”¨ one-hot ç¼–ç æ¥è¡¨ç¤ºã€‚åœ¨å®žé™…çš„åº”ç”¨ä¸­ï¼Œä½ åº”è¯¥æ£€æŸ¥æ‰€æœ‰åˆ—çš„å€¼ã€‚</p><p>ç”¨ pandas ç¼–ç æ•°æ®æœ‰ä¸€ç§éžå¸¸ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ get_dummies å‡½æ•°ã€‚get_dummies å‡½æ•°è‡ªåŠ¨å˜æ¢æ‰€æœ‰å…·æœ‰å¯¹è±¡ç±»åž‹ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²ï¼‰çš„åˆ—æˆ–æ‰€æœ‰åˆ†ç±»çš„åˆ—ï¼ˆè¿™æ˜¯ pandas ä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ¦‚å¿µï¼Œè¿˜æ²¡æœ‰è®²åˆ°ï¼‰ã€‚</p><blockquote><p><a href="https://devdocs.io/pandas~0.25/reference/api/pandas.get_dummies" target="_blank" rel="noopener"><code>pandas.get_dummies(data, prefix=None, prefix_sep='_', dummy_na=False, columns=None, sparse=False, drop_first=False, dtype=None)</code></a></p><p>Convert categorical variable into dummy/indicator variables.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">"Original features:\n"</span>, list(data.columns), <span class="string">"\n"</span>)</span><br><span class="line">data_dummies = pd.get_dummies(data)</span><br><span class="line">print(<span class="string">'Features after get_dummies:\n'</span>, list(data_dummies.columns))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Original features:</span><br><span class="line"> [&apos;age&apos;, &apos;workclass&apos;, &apos;education&apos;, &apos;gender&apos;, &apos;hours-per-week&apos;, &apos;occupation&apos;, &apos;income&apos;]</span><br><span class="line"></span><br><span class="line">Features after get_dummies:</span><br><span class="line"> [&apos;age&apos;, &apos;hours-per-week&apos;, &apos;workclass_ ?&apos;, &apos;workclass_ Federal-gov&apos;, &apos;workclass_ Local-gov&apos;, &apos;workclass_ Never-worked&apos;, &apos;workclass_ Private&apos;, &apos;workclass_ Self-emp-inc&apos;, &apos;workclass_ Self-emp-not-inc&apos;, &apos;workclass_ State-gov&apos;, &apos;workclass_ Without-pay&apos;, &apos;education_ 10th&apos;, &apos;education_ 11th&apos;, &apos;education_ 12th&apos;, &apos;education_ 1st-4th&apos;, &apos;education_ 5th-6th&apos;, &apos;education_ 7th-8th&apos;, &apos;education_ 9th&apos;, &apos;education_ Assoc-acdm&apos;, &apos;education_ Assoc-voc&apos;, &apos;education_ Bachelors&apos;, &apos;education_ Doctorate&apos;, &apos;education_ HS-grad&apos;, &apos;education_ Masters&apos;, &apos;education_ Preschool&apos;, &apos;education_ Prof-school&apos;, &apos;education_ Some-college&apos;, &apos;gender_ Female&apos;, &apos;gender_ Male&apos;, &apos;occupation_ ?&apos;, &apos;occupation_ Adm-clerical&apos;, &apos;occupation_ Armed-Forces&apos;, &apos;occupation_ Craft-repair&apos;, &apos;occupation_ Exec-managerial&apos;, &apos;occupation_ Farming-fishing&apos;, &apos;occupation_ Handlers-cleaners&apos;, &apos;occupation_ Machine-op-inspct&apos;, &apos;occupation_ Other-service&apos;, &apos;occupation_ Priv-house-serv&apos;, &apos;occupation_ Prof-specialty&apos;, &apos;occupation_ Protective-serv&apos;, &apos;occupation_ Sales&apos;, &apos;occupation_ Tech-support&apos;, &apos;occupation_ Transport-moving&apos;, &apos;income_ &lt;=50K&apos;, &apos;income_ &gt;50K&apos;]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿žç»­ç‰¹å¾ age å’Œ hours-per-week æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè€Œåˆ†ç±»ç‰¹å¾çš„æ¯ä¸ªå¯èƒ½å–å€¼éƒ½è¢«æ‰©å±•ä¸ºä¸€ä¸ªæ–°ç‰¹å¾ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ values å±žæ€§å°† data_dummies æ•°æ®æ¡†ï¼ˆDataFrameï¼‰è½¬æ¢ä¸º NumPy æ•°ç»„ï¼Œç„¶åŽåœ¨å…¶ä¸Šè®­ç»ƒä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡åž‹ã€‚åœ¨è®­ç»ƒæ¨¡åž‹ä¹‹å‰ï¼Œæ³¨æ„è¦æŠŠç›®æ ‡å˜é‡ï¼ˆçŽ°åœ¨è¢«ç¼–ç ä¸ºä¸¤ä¸ª income åˆ—ï¼‰ä»Žæ•°æ®ä¸­åˆ†ç¦»å‡ºæ¥ã€‚</p><blockquote><p>æ³¨æ„ï¼šandas ä¸­çš„åˆ—ç´¢å¼•åŒ…æ‹¬èŒƒå›´çš„ç»“å°¾ï¼Œå› æ­¤ 'age':'occupation_ Transport-moving' ä¸­åŒ…æ‹¬ occupation_ Transport-movingã€‚è¿™ä¸Ž NumPyæ•°ç»„çš„åˆ‡ç‰‡ä¸åŒï¼ŒåŽè€…ä¸åŒ…æ‹¬èŒƒå›´çš„æœ«å°¾ï¼Œä¾‹å¦‚ <code>np.arange(11)[0:10]</code>ä¸åŒ…æ‹¬ç´¢å¼•ç¼–å·ä¸º 10 çš„å…ƒç´ ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">features = data_dummies.ix[:, <span class="string">'age'</span>:<span class="string">'occupation_ Transport-moving'</span>]</span><br><span class="line"><span class="comment"># æå–NumPyæ•°ç»„</span></span><br><span class="line">X = features.values</span><br><span class="line">y = data_dummies[<span class="string">'income_ &gt;50K'</span>].values</span><br><span class="line">print(<span class="string">'X.shape: &#123;&#125;  y.shape: &#123;&#125;'</span>.format(X.shape, y.shape))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X.shape: (32561, 44)  y.shape: (32561,)</span><br></pre></td></tr></table></figure><p>çŽ°åœ¨æ•°æ®çš„è¡¨ç¤ºæ–¹å¼å¯ä»¥è¢« scikit-learn å¤„ç†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=<span class="number">0</span>)</span><br><span class="line">logreg = LogisticRegression()</span><br><span class="line">logreg.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Test score: &#123;:.2f&#125;'</span>.format(logreg.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test score: 0.81</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹åŒæ—¶åŒ…å«è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®çš„æ•°æ®æ¡†è°ƒç”¨ get_dummiesã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå¯ä»¥ç¡®ä¿è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­åˆ†ç±»å˜é‡çš„è¡¨ç¤ºæ–¹å¼ç›¸åŒã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä½äºŽä¸¤ä¸ªä¸åŒçš„æ•°æ®æ¡†ä¸­ã€‚å¦‚æžœ workclass ç‰¹å¾çš„ &quot;Private Employee&quot; å–å€¼æ²¡æœ‰å‡ºçŽ°åœ¨æµ‹è¯•é›†ä¸­ï¼Œé‚£ä¹ˆ pandas ä¼šè®¤ä¸ºè¿™ä¸ªç‰¹å¾åªæœ‰3ä¸ªå¯èƒ½çš„å–å€¼ï¼Œå› æ­¤åªä¼šåˆ›å»º 3 ä¸ªæ–°çš„è™šæ‹Ÿç‰¹å¾ã€‚çŽ°åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„ç‰¹å¾ä¸ªæ•°ä¸ç›¸åŒï¼Œæˆ‘ä»¬å°±æ— æ³•å°†åœ¨è®­ç»ƒé›†ä¸Šå­¦åˆ°çš„æ¨¡åž‹åº”ç”¨åˆ°æµ‹è¯•é›†ä¸Šã€‚</p><p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå‡è®¾ workclass ç‰¹å¾åœ¨è®­ç»ƒé›†ä¸­æœ‰ &quot;Government Employee&quot; å’Œ &quot;Private Employee&quot; ä¸¤ä¸ªå€¼ï¼Œè€Œåœ¨æµ‹è¯•é›†ä¸­æœ‰ &quot;Self Employed&quot; å’Œ &quot;Self Employed Incorporated&quot; ä¸¤ä¸ªå€¼ã€‚åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œpandas éƒ½ä¼šåˆ›å»ºä¸¤ä¸ªæ–°çš„è™šæ‹Ÿç‰¹å¾ï¼Œæ‰€æœ‰ç¼–ç åŽçš„æ•°æ®æ¡†çš„ç‰¹å¾ä¸ªæ•°ç›¸åŒã€‚ä½†åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸­çš„ä¸¤ä¸ªè™šæ‹Ÿç‰¹å¾å«ä¹‰å®Œå…¨ä¸åŒã€‚å¦‚æžœæˆ‘ä»¬åœ¨è¿™ä¸ªæ•°æ®ä¸Šæž„å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹ï¼Œé‚£ä¹ˆå®ƒçš„è¡¨çŽ°ä¼šå¾ˆå·®ã€‚è¦æƒ³é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨åŒæ—¶åŒ…å«è®­ç»ƒæ•°æ®ç‚¹å’Œæµ‹è¯•æ•°æ®ç‚¹çš„æ•°æ®æ¡†ä¸Šè°ƒç”¨ get_dummiesï¼Œç¡®ä¿è°ƒç”¨ get_dummiesåŽè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„åˆ—åç§°ç›¸åŒï¼Œä¿è¯å®ƒä»¬å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ã€‚</p><h2 id="æ•°å­—å¯ä»¥ç¼–ç åˆ†ç±»å˜é‡">æ•°å­—å¯ä»¥ç¼–ç åˆ†ç±»å˜é‡</h2><p>åœ¨ adult æ•°æ®é›†çš„ä¾‹å­ä¸­ï¼Œåˆ†ç±»å˜é‡è¢«ç¼–ç ä¸ºå­—ç¬¦ä¸²ã€‚ä¸€æ–¹é¢ï¼Œå¯èƒ½ä¼šæœ‰æ‹¼å†™é”™è¯¯ï¼›ä½†å¦ä¸€æ–¹é¢ï¼Œå®ƒæ˜Žç¡®åœ°å°†ä¸€ä¸ªå˜é‡æ ‡è®°ä¸ºåˆ†ç±»å˜é‡ã€‚ï¼ˆç„¶è€Œï¼‰æ— è®ºæ˜¯ä¸ºäº†ä¾¿äºŽå­˜å‚¨è¿˜æ˜¯å› ä¸ºæ•°æ®çš„æ”¶é›†æ–¹å¼ï¼Œåˆ†ç±»å˜é‡é€šå¸¸è¢«ç¼–ç ä¸ºæ•´æ•°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ adult æ•°æ®é›†ä¸­çš„äººå£æ™®æŸ¥æ•°æ®æ˜¯åˆ©ç”¨é—®å·æ”¶é›†çš„ï¼Œworkclass çš„å›žç­”è¢«è®°å½•ä¸º 0ï¼ˆåœ¨ç¬¬ä¸€ä¸ªæ¡†æ‰“å‹¾ï¼‰ã€1ã€2ï¼Œç­‰ç­‰ã€‚çŽ°åœ¨è¯¥åˆ—åŒ…å«æ•°å­— 0 åˆ° 8ï¼Œè€Œä¸æ˜¯åƒ &quot;Private&quot; è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚å¦‚æžœæœ‰äººè§‚å¯Ÿè¡¨ç¤ºæ•°æ®é›†çš„è¡¨æ ¼ï¼Œå¾ˆéš¾ä¸€çœ¼çœ‹å‡ºè¿™ä¸ªå˜é‡åº”è¯¥è¢«è§†ä¸ºè¿žç»­å˜é‡è¿˜æ˜¯åˆ†ç±»å˜é‡ã€‚ä½†æ˜¯ï¼Œå¦‚æžœçŸ¥é“è¿™äº›æ•°å­—è¡¨ç¤ºçš„æ˜¯å°±ä¸šçŠ¶å†µï¼Œé‚£ä¹ˆå¾ˆæ˜Žæ˜¾å®ƒä»¬æ˜¯ä¸åŒçš„çŠ¶æ€ï¼Œä¸åº”è¯¥ç”¨å•ä¸ªè¿žç»­å˜é‡æ¥å»ºæ¨¡ã€‚</p><blockquote><p>åˆ†ç±»ç‰¹å¾é€šå¸¸ç”¨æ•´æ•°è¿›è¡Œç¼–ç ã€‚å®ƒä»¬æ˜¯æ•°å­—å¹¶ä¸æ„å‘³ç€å®ƒä»¬å¿…é¡»è¢«è§†ä¸ºè¿žç»­ç‰¹å¾ã€‚ä¸€ä¸ªæ•´æ•°ç‰¹å¾åº”è¯¥è¢«è§†ä¸ºè¿žç»­çš„è¿˜æ˜¯ç¦»æ•£çš„ï¼Œæœ‰æ—¶å¹¶ä¸æ˜Žç¡®ã€‚å¦‚æžœåœ¨è¢«ç¼–ç çš„è¯­ä¹‰ä¹‹é—´æ²¡æœ‰é¡ºåºå…³ç³»ï¼ˆæ¯”å¦‚ workclass çš„ä¾‹å­ï¼‰ï¼Œé‚£ä¹ˆç‰¹å¾å¿…é¡»è¢«è§†ä¸ºç¦»æ•£ç‰¹å¾ã€‚å¯¹äºŽå…¶ä»–æƒ…å†µï¼ˆæ¯”å¦‚äº”æ˜Ÿè¯„åˆ†ï¼‰ï¼Œå“ªç§ç¼–ç æ›´å¥½å–å†³äºŽå…·ä½“çš„ä»»åŠ¡å’Œæ•°æ®ï¼Œä»¥åŠä½¿ç”¨å“ªç§æœºå™¨å­¦ä¹ ç®—æ³•ã€‚</p></blockquote><p>pandasçš„ get_dummies å‡½æ•°å°†æ‰€æœ‰æ•°å­—çœ‹ä½œæ˜¯è¿žç»­çš„ï¼Œä¸ä¼šä¸ºå…¶åˆ›å»ºè™šæ‹Ÿå˜é‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ scikit-learn çš„ OneHotEncoderï¼ŒæŒ‡å®šå“ªäº›å˜é‡æ˜¯è¿žç»­çš„ã€å“ªäº›å˜é‡æ˜¯ç¦»æ•£çš„ï¼Œä½ ä¹Ÿå¯ä»¥å°†æ•°æ®æ¡†ä¸­çš„æ•°å€¼åˆ—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªDataFrameï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ç‰¹å¾å’Œä¸€ä¸ªåˆ†ç±»å­—ç¬¦ä¸²ç‰¹å¾</span></span><br><span class="line">demo_df = pd.DataFrame(&#123;<span class="string">'Integer Feature'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">                        <span class="string">'Categorical Feature'</span>: [<span class="string">'socks'</span>, <span class="string">'fox'</span>, <span class="string">'socks'</span>, <span class="string">'box'</span>]&#125;)</span><br><span class="line">display(demo_df)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ get_dummies åªä¼šç¼–ç å­—ç¬¦ä¸²ç‰¹å¾ï¼Œä¸ä¼šæ”¹å˜æ•´æ•°ç‰¹å¾</span></span><br><span class="line">display(pd.get_dummies(demo_df))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   Integer Feature Categorical Feature</span><br><span class="line">0                0               socks</span><br><span class="line">1                1                 fox</span><br><span class="line">2                2               socks</span><br><span class="line">3                1                 box</span><br><span class="line">   Integer Feature  ...  Categorical Feature_socks</span><br><span class="line">0                0  ...                          1</span><br><span class="line">1                1  ...                          0</span><br><span class="line">2                2  ...                          1</span><br><span class="line">3                1  ...                          0</span><br><span class="line"></span><br><span class="line">[4 rows x 4 columns]</span><br></pre></td></tr></table></figure><p>å¦‚æžœä½ æƒ³ä¸º &quot;Integer Feature&quot; è¿™ä¸€åˆ—åˆ›å»ºè™šæ‹Ÿå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ columns å‚æ•°æ˜¾ç¤ºåœ°ç»™å‡ºæƒ³è¦ç¼–ç çš„åˆ—ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">demo_df[<span class="string">'Integer Feature'</span>] = demo_df[<span class="string">'Integer Feature'</span>].astype(str)</span><br><span class="line">display(pd.get_dummies(demo_df, columns=[<span class="string">'Integer Feature'</span>, <span class="string">'Categorical Feature'</span>]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">   Integer Feature_0  ...  Categorical Feature_socks</span><br><span class="line">0                  1  ...                          1</span><br><span class="line">1                  0  ...                          0</span><br><span class="line">2                  0  ...                          1</span><br><span class="line">3                  0  ...                          0</span><br><span class="line"></span><br><span class="line">[4 rows x 6 columns]</span><br></pre></td></tr></table></figure><h1 id="åˆ†ç®±ç¦»æ•£åŒ–çº¿æ€§æ¨¡åž‹ä¸Žæ ‘">åˆ†ç®±ã€ç¦»æ•£åŒ–ã€çº¿æ€§æ¨¡åž‹ä¸Žæ ‘</h1><p>æ•°æ®è¡¨ç¤ºçš„æœ€ä½³æ–¹æ³•ä¸ä»…å–å†³äºŽæ•°æ®çš„è¯­ä¹‰ï¼Œè¿˜å–å†³äºŽæ‰€ä½¿ç”¨çš„æ¨¡åž‹ç§ç±»ã€‚çº¿æ€§æ¨¡åž‹ä¸ŽåŸºäºŽæ ‘çš„æ¨¡åž‹ï¼ˆæ¯”å¦‚å†³ç­–æ ‘ã€æ¢¯åº¦æå‡æ ‘å’Œéšæœºæ£®æž—ï¼‰æ˜¯ä¸¤ç§æˆå‘˜å¾ˆå¤šåŒæ—¶åˆéžå¸¸å¸¸ç”¨çš„æ¨¡åž‹ï¼Œå®ƒä»¬åœ¨å¤„ç†ä¸åŒçš„ç‰¹å¾è¡¨ç¤ºæ—¶å°±å…·æœ‰éžå¸¸ä¸åŒçš„æ€§è´¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = mglearn.datasets.make_wave(n_samples=<span class="number">100</span>)</span><br><span class="line">line = np.linspace(<span class="number">-3</span>, <span class="number">3</span>, <span class="number">1000</span>, endpoint=<span class="literal">False</span>).reshape(<span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">reg = DecisionTreeRegressor(min_samples_split=<span class="number">3</span>).fit(X, y)</span><br><span class="line">plt.plot(line, reg.predict(line), label=<span class="string">"decision tree"</span>)</span><br><span class="line"></span><br><span class="line">reg = LinearRegression().fit(X, y)</span><br><span class="line">plt.plot(line, reg.predict(line), label=<span class="string">"linear regression"</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(X[:, <span class="number">0</span>], y, <span class="string">'o'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Regression output'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Input feature'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/difference-between-tree-and-linear.png"></p><p>çº¿æ€§æ¨¡åž‹åªèƒ½å¯¹çº¿æ€§å…³ç³»å»ºæ¨¡ï¼Œå¯¹äºŽå•ä¸ªç‰¹å¾çš„æƒ…å†µå°±æ˜¯ç›´çº¿ã€‚å†³ç­–æ ‘å¯ä»¥æž„å»ºæ›´ä¸ºå¤æ‚çš„æ•°æ®æ¨¡åž‹ï¼Œä½†è¿™å¼ºçƒˆä¾èµ–äºŽæ•°æ®è¡¨ç¤ºã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®©çº¿æ€§æ¨¡åž‹åœ¨è¿žç»­æ•°æ®ä¸Šå˜å¾—æ›´åŠ å¼ºå¤§ï¼Œå°±æ˜¯ä½¿ç”¨ç‰¹å¾<strong>åˆ†ç®±</strong>ï¼ˆbinningï¼Œä¹Ÿå«<strong>ç¦»æ•£åŒ–</strong>ï¼Œå³ discretizationï¼‰å°†å…¶åˆ’åˆ†ä¸ºå¤šä¸ªç‰¹å¾ã€‚</p><p>æˆ‘ä»¬å‡è®¾å°†ç‰¹å¾çš„è¾“å…¥èŒƒå›´åˆ’åˆ†æˆå›ºå®šä¸ªæ•°çš„<strong>ç®±å­</strong>ï¼ˆbinï¼‰ï¼Œæ¯”å¦‚ 10 ä¸ªï¼Œé‚£ä¹ˆæ•°æ®ç‚¹å°±å¯ä»¥ç”¨å®ƒæ‰€åœ¨çš„ç®±å­æ¥è¡¨ç¤ºã€‚ä¸ºäº†ç¡®å®šè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®šä¹‰ç®±å­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ -3 å’Œ 3 ä¹‹é—´å®šä¹‰ 10 ä¸ªå‡åŒ€åˆ†å¸ƒçš„ç®±å­ã€‚æˆ‘ä»¬ç”¨ np.linspace å‡½æ•°åˆ›å»º 11 ä¸ªå…ƒç´ ï¼Œä»Žè€Œåˆ›å»º 10 ä¸ªç®±å­ï¼Œå³ä¸¤ä¸ªè¿žç»­è¾¹ç•Œä¹‹é—´çš„ç©ºé—´ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bins = np.linspace(<span class="number">-3</span>, <span class="number">3</span>, <span class="number">11</span>)</span><br><span class="line">print(<span class="string">'bins: &#123;&#125;'</span>.format(bins))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bins: [-3.  -2.4 -1.8 -1.2 -0.6  0.   0.6  1.2  1.8  2.4  3. ]</span><br></pre></td></tr></table></figure><p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®°å½•æ¯ä¸ªæ•°æ®ç‚¹æ‰€å±žçš„ç®±å­ã€‚è¿™å¯ä»¥ç”¨ np.digitize å‡½æ•°è½»æ¾è®¡ç®—å‡ºæ¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">which_bin = np.digitize(X, bins=bins)</span><br><span class="line">print(<span class="string">'Data points:\n'</span>, X[:<span class="number">5</span>])</span><br><span class="line">print(<span class="string">'\nBin membership for data points:\n'</span>, which_bin[:<span class="number">5</span>])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Data points:</span><br><span class="line"> [[-0.75275929]</span><br><span class="line"> [ 2.70428584]</span><br><span class="line"> [ 1.39196365]</span><br><span class="line"> [ 0.59195091]</span><br><span class="line"> [-2.06388816]]</span><br><span class="line"></span><br><span class="line">Bin membership for data points:</span><br><span class="line"> [[ 4]</span><br><span class="line"> [10]</span><br><span class="line"> [ 8]</span><br><span class="line"> [ 6]</span><br><span class="line"> [ 2]]</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¿™é‡Œåšçš„æ˜¯å°† wave æ•°æ®é›†ä¸­å•ä¸ªè¿žç»­è¾“å…¥ç‰¹å¾å˜æ¢ä¸ºä¸€ä¸ªåˆ†ç±»ç‰¹å¾ï¼Œç”¨äºŽè¡¨ç¤ºæ•°æ®ç‚¹æ‰€åœ¨çš„ç®±å­ã€‚è¦æƒ³åœ¨è¿™ä¸ªæ•°æ®ä¸Šä½¿ç”¨ scikit-learn æ¨¡åž‹ï¼Œæˆ‘ä»¬åˆ©ç”¨ preprocessing æ¨¡å—çš„ OneHotEncoder å°†è¿™ä¸ªç¦»æ•£ç‰¹å¾å˜æ¢ä¸º one-hot ç¼–ç ã€‚ OneHotEncoder å®žçŽ°çš„ç¼–ç ä¸Ž pandas.get_dummies ç›¸åŒï¼Œä½†ç›®å‰å®ƒåªé€‚ç”¨äºŽå€¼ä¸ºæ•´æ•°çš„åˆ†ç±»å˜é‡ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.preprocessing.onehotencoder#sklearn.preprocessing.OneHotEncoder" target="_blank" rel="noopener"><code>class sklearn.preprocessing.OneHotEncoder(n_values=None, categorical_features=None, categories=None, sparse=True, dtype=&lt;class â€˜numpy.float64â€™&gt;, handle_unknown=â€™errorâ€™)</code></a></p><p>Encode categorical integer features as a one-hot numeric array.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨OneHotEncoderè¿›è¡Œå˜æ¢</span></span><br><span class="line">encoder = OneHotEncoder(sparse=<span class="literal">False</span>)</span><br><span class="line">encoder.fit(which_bin)</span><br><span class="line">X_binned = encoder.transform(which_bin)</span><br><span class="line">print(X_binned[:<span class="number">5</span>])</span><br><span class="line"><span class="comment"># ç”±äºŽæˆ‘ä»¬æŒ‡å®šäº† 10 ä¸ªç®±å­ï¼Œæ‰€ä»¥å˜æ¢åŽçš„ X_binned æ•°æ®é›†çŽ°åœ¨åŒ…å« 10 ä¸ªç‰¹å¾</span></span><br><span class="line">print(<span class="string">'X_binned.shape: &#123;&#125;'</span>.format(X_binned.shape))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[0. 0. 0. 1. 0. 0. 0. 0. 0. 0.]</span><br><span class="line"> [0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]</span><br><span class="line"> [0. 0. 0. 0. 0. 0. 0. 1. 0. 0.]</span><br><span class="line"> [0. 0. 0. 0. 0. 1. 0. 0. 0. 0.]</span><br><span class="line"> [0. 1. 0. 0. 0. 0. 0. 0. 0. 0.]]</span><br><span class="line">X_binned.shape: (100, 10)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬åœ¨ one-hot ç¼–ç åŽçš„æ•°æ®ä¸Šæž„å»ºæ–°çš„çº¿æ€§æ¨¡åž‹å’Œæ–°çš„å†³ç­–æ ‘æ¨¡åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line_binned = encoder.transform(np.digitize(line, bins=bins))</span><br><span class="line"></span><br><span class="line">reg = LinearRegression().fit(X_binned, y)</span><br><span class="line">plt.plot(line, reg.predict(line_binned), label=<span class="string">'linear regression binned'</span>)</span><br><span class="line"></span><br><span class="line">reg = DecisionTreeRegressor(min_samples_split=<span class="number">3</span>).fit(X_binned, y)</span><br><span class="line">plt.plot(line, reg.predict(line_binned), label=<span class="string">'decision tree binned'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(X[:, <span class="number">0</span>], y, <span class="string">'o'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">plt.vlines(bins, <span class="number">-3</span>, <span class="number">3</span>, linewidth=<span class="number">1</span>, alpha=<span class="number">.2</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Regresson output'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Input feature'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-and-tree-on-binned-data.png"></p><p>è™šçº¿å’Œå®žçº¿å®Œå…¨é‡åˆï¼Œè¯´æ˜Žçº¿æ€§å›žå½’æ¨¡åž‹å’Œå†³ç­–æ ‘æ¨¡åž‹åšå‡ºäº†å®Œå…¨ç›¸åŒçš„é¢„æµ‹ã€‚å¯¹äºŽæ¯ä¸ªç®±å­ï¼ŒäºŒè€…éƒ½é¢„æµ‹ä¸€ä¸ªå¸¸æ•°å€¼ã€‚å› ä¸ºæ¯ä¸ªç®±å­å†…çš„ç‰¹å¾æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å¯¹äºŽä¸€ä¸ªç®±å­å†…çš„æ‰€æœ‰ç‚¹ï¼Œä»»ä½•æ¨¡åž‹éƒ½ä¼šé¢„æµ‹ç›¸åŒçš„å€¼ã€‚</p><p>æ¯”è¾ƒå¯¹ç‰¹å¾è¿›è¡Œåˆ†ç®±å‰åŽæ¨¡åž‹å­¦åˆ°çš„å†…å®¹ï¼Œæˆ‘ä»¬å‘çŽ°ï¼Œçº¿æ€§æ¨¡åž‹å˜å¾—æ›´åŠ çµæ´»äº†ï¼Œå› ä¸ºçŽ°åœ¨å®ƒå¯¹æ¯ä¸ªç®±å­å…·æœ‰ä¸åŒçš„å–å€¼ï¼Œè€Œå†³ç­–æ ‘æ¨¡åž‹çš„çµæ´»æ€§é™ä½Žäº†ã€‚åˆ†ç®±ç‰¹å¾å¯¹åŸºäºŽæ ‘çš„æ¨¡åž‹é€šå¸¸ä¸ä¼šäº§ç”Ÿæ›´å¥½çš„æ•ˆæžœï¼Œå› ä¸ºè¿™ç§æ¨¡åž‹å¯ä»¥å­¦ä¹ åœ¨ä»»ä½•ä½ç½®åˆ’åˆ†æ•°æ®ã€‚ä»ŽæŸç§æ„ä¹‰ä¸Šæ¥çœ‹ï¼Œå†³ç­–æ ‘å¯ä»¥å­¦ä¹ å¦‚ä½•åˆ†ç®±å¯¹é¢„æµ‹è¿™äº›æ•°æ®æœ€ä¸ºæœ‰ç”¨ã€‚æ­¤å¤–ï¼Œå†³ç­–æ ‘å¯ä»¥åŒæ—¶æŸ¥çœ‹å¤šä¸ªç‰¹å¾ï¼Œè€Œåˆ†ç®±é€šå¸¸é’ˆå¯¹çš„æ˜¯å•ä¸ªç‰¹å¾ã€‚ä¸è¿‡ï¼Œçº¿æ€§æ¨¡åž‹çš„è¡¨çŽ°åŠ›åœ¨æ•°æ®å˜æ¢åŽå¾—åˆ°äº†æžå¤§çš„æé«˜ã€‚</p><p><strong>å¯¹äºŽç‰¹å®šçš„æ•°æ®é›†ï¼Œå¦‚æžœæœ‰å……åˆ†çš„ç†ç”±ä½¿ç”¨çº¿æ€§æ¨¡åž‹â€”â€”æ¯”å¦‚æ•°æ®é›†å¾ˆå¤§ã€ç»´åº¦å¾ˆé«˜ï¼Œä½†æœ‰äº›ç‰¹å¾ä¸Žè¾“å‡ºçš„å…³ç³»æ˜¯éžçº¿æ€§çš„â€”â€”é‚£ä¹ˆåˆ†ç®±æ˜¯æé«˜å»ºæ¨¡èƒ½åŠ›çš„å¥½æ–¹æ³•ã€‚</strong></p><h1 id="äº¤äº’ç‰¹å¾ä¸Žå¤šé¡¹å¼ç‰¹å¾">äº¤äº’ç‰¹å¾ä¸Žå¤šé¡¹å¼ç‰¹å¾</h1><p>æƒ³è¦ä¸°å¯Œç‰¹å¾è¡¨ç¤ºï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽçº¿æ€§æ¨¡åž‹è€Œè¨€ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯æ·»åŠ åŽŸå§‹æ•°æ®çš„<strong>äº¤äº’ç‰¹å¾</strong>ï¼ˆinteraction featureï¼‰å’Œ<strong>å¤šé¡¹å¼ç‰¹å¾</strong>ï¼ˆpolynomial featureï¼‰ã€‚è¿™ç§ç‰¹å¾å·¥ç¨‹é€šå¸¸ç”¨äºŽç»Ÿè®¡å»ºæ¨¡ï¼Œä½†ä¹Ÿå¸¸ç”¨äºŽè®¸å¤šå®žé™…çš„æœºå™¨å­¦ä¹ åº”ç”¨ä¸­ã€‚</p><p>çº¿æ€§æ¨¡åž‹å¯¹ wave æ•°æ®é›†ä¸­çš„æ¯ä¸ªç®±å­éƒ½å­¦åˆ°ä¸€ä¸ªå¸¸æ•°å€¼ã€‚ä½†æˆ‘ä»¬çŸ¥é“ï¼Œçº¿æ€§æ¨¡åž‹ä¸ä»…å¯ä»¥å­¦ä¹ åç§»ï¼Œè¿˜å¯ä»¥å­¦ä¹ æ–œçŽ‡ã€‚æƒ³è¦å‘åˆ†ç®±æ•°æ®ä¸Šçš„çº¿æ€§æ¨¡åž‹æ·»åŠ æ–œçŽ‡ï¼Œä¸€ç§æ–¹æ³•æ˜¯é‡æ–°åŠ å…¥åŽŸå§‹ç‰¹å¾ã€‚è¿™æ ·ä¼šå¾—åˆ° 11 ç»´çš„æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_combined = np.hstack([X, X_binned])</span><br><span class="line">print(<span class="string">'X_combined.shape: &#123;&#125;'</span>.format(X_combined.shape))</span><br><span class="line"></span><br><span class="line">line_combined = np.hstack([line, line_binned])</span><br><span class="line">reg = LinearRegression().fit(X_combined, y)</span><br><span class="line">plt.plot(line, reg.predict(line_combined), label=<span class="string">'linear regression combined'</span>)</span><br><span class="line">plt.plot(X[:, <span class="number">0</span>], y, <span class="string">'o'</span>, c=<span class="string">'k'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> bin <span class="keyword">in</span> bins:</span><br><span class="line">    plt.plot([bin, bin], [<span class="number">-3</span>, <span class="number">3</span>], <span class="string">':'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Regresson output'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Input feature'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_combined.shape: (100, 11)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-regression-combined-on-binned-data.png"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¨¡åž‹åœ¨æ¯ä¸ªç®±å­ä¸­éƒ½å­¦åˆ°ä¸€ä¸ªåç§»ï¼Œè¿˜å­¦åˆ°ä¸€ä¸ªæ–œçŽ‡ã€‚å­¦åˆ°çš„æ–œçŽ‡åœ¨æ‰€æœ‰ç®±å­ä¸­éƒ½ç›¸åŒâ€”â€”åªæœ‰ä¸€ä¸ª x è½´ç‰¹å¾ï¼Œä¹Ÿå°±åªæœ‰ä¸€ä¸ªæ–œçŽ‡ã€‚å› ä¸ºæ–œçŽ‡åœ¨æ‰€æœ‰ç®±å­ä¸­æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å®ƒä¼¼ä¹Žä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚æˆ‘ä»¬æ›´å¸Œæœ›æ¯ä¸ªç®±å­éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„æ–œçŽ‡ã€‚ä¸ºäº†å®žçŽ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ äº¤äº’ç‰¹å¾æˆ–ä¹˜ç§¯ç‰¹å¾ï¼Œç”¨æ¥è¡¨ç¤ºæ•°æ®ç‚¹æ‰€åœ¨ç®±å­ä»¥åŠæ•°æ®ç‚¹åœ¨ x è½´ä¸Šçš„ä½ç½®ã€‚è¿™ä¸ªç‰¹å¾æ˜¯ç®±å­æŒ‡ç¤ºç¬¦ä¸ŽåŽŸå§‹ç‰¹å¾çš„ä¹˜ç§¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_product = np.hstack([X_binned, X * X_binned])</span><br><span class="line">print(<span class="string">'X_product.shape: &#123;&#125;'</span>.format(X_product.shape))</span><br><span class="line"></span><br><span class="line">line_product = np.hstack([line_binned, line * line_binned])</span><br><span class="line"></span><br><span class="line">reg = LinearRegression().fit(X_product, y)</span><br><span class="line">plt.plot(line, reg.predict(line_product), label=<span class="string">'linear regression product'</span>)</span><br><span class="line">plt.plot(X[:, <span class="number">0</span>], y, <span class="string">'o'</span>, c=<span class="string">'k'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> bin <span class="keyword">in</span> bins:</span><br><span class="line">    plt.plot([bin, bin], [<span class="number">-3</span>, <span class="number">3</span>], <span class="string">':'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Regresson output'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Input feature'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_product.shape: (100, 20)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-regression-product-on-binned-data.png"></p><p>è¿™ä¸ªæ•°æ®é›†æœ‰20ä¸ªç‰¹å¾ï¼šæ•°æ®ç‚¹æ‰€åœ¨ç®±å­çš„æŒ‡ç¤ºç¬¦ï¼ˆ10 ä¸ªç‰¹å¾ï¼‰ä¸ŽåŽŸå§‹ç‰¹å¾å’Œç®±å­æŒ‡ç¤ºç¬¦çš„ä¹˜ç§¯ï¼ˆ10 ä¸ªç‰¹å¾ï¼‰ã€‚ä½ å¯ä»¥å°†ä¹˜ç§¯ç‰¹å¾çœ‹ä½œæ¯ä¸ªç®±å­ x è½´ç‰¹å¾çš„å•ç‹¬å‰¯æœ¬ã€‚å®ƒåœ¨ç®±å­å†…ç­‰äºŽåŽŸå§‹ç‰¹å¾ï¼Œåœ¨å…¶ä»–ä½ç½®ç­‰äºŽé›¶ã€‚çŽ°åœ¨è¿™ä¸ªæ¨¡åž‹ä¸­ï¼Œæ¯ä¸ªç®±å­éƒ½æœ‰è‡ªå·±çš„åç§»å’Œæ–œçŽ‡ã€‚</p><p>ä½¿ç”¨åˆ†ç®±æ˜¯æ‰©å±•è¿žç»­ç‰¹å¾çš„ä¸€ç§æ–¹æ³•ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åŽŸå§‹ç‰¹å¾çš„<strong>å¤šé¡¹å¼</strong>ï¼ˆpolynomialï¼‰ã€‚å¯¹äºŽç»™å®šç‰¹å¾ xï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ x ** 2ã€x ** 3ã€x ** 4ï¼Œç­‰ç­‰ã€‚è¿™åœ¨ preprocessing æ¨¡å—çš„ PolynomialFeatures ä¸­å®žçŽ°ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.preprocessing.polynomialfeatures#sklearn.preprocessing.PolynomialFeatures" target="_blank" rel="noopener"><code>class sklearn.preprocessing.PolynomialFeatures(degree=2, interaction_only=False, include_bias=True)</code></a></p><p>Generate polynomial and interaction features.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŒ…å«ç›´åˆ°x ** 10çš„å¤šé¡¹å¼</span></span><br><span class="line"><span class="comment"># é»˜è®¤çš„"include_bias=True"æ·»åŠ æ’ç­‰äºŽ1çš„å¸¸æ•°ç‰¹å¾</span></span><br><span class="line">poly = PolynomialFeatures(degree=<span class="number">10</span>, include_bias=<span class="literal">False</span>)</span><br><span class="line">poly.fit(X)</span><br><span class="line">X_poly = poly.transform(X)</span><br><span class="line">print(<span class="string">"X_poly.shape: &#123;&#125;"</span>.format(X_poly.shape))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯”è¾ƒX_polyå’ŒXçš„å…ƒç´ </span></span><br><span class="line">print(<span class="string">'Entries of X:\n'</span>, X[:<span class="number">5</span>])</span><br><span class="line">print(<span class="string">'Entries of X_poly:\n'</span>, X_poly[:<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡è°ƒç”¨get_feature_namesæ–¹æ³•æ¥èŽ·å–ç‰¹å¾çš„è¯­ä¹‰ï¼Œç»™å‡ºæ¯ä¸ªç‰¹å¾çš„æŒ‡æ•°</span></span><br><span class="line">print(<span class="string">'Polynomial feature names:\n'</span>, poly.get_feature_names())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_poly.shape: (100, 10)</span><br><span class="line">Entries of X:</span><br><span class="line"> [[-0.75275929]</span><br><span class="line"> [ 2.70428584]</span><br><span class="line"> [ 1.39196365]</span><br><span class="line"> [ 0.59195091]</span><br><span class="line"> [-2.06388816]]</span><br><span class="line">Entries of X_poly:</span><br><span class="line"> [[-7.52759287e-01  5.66646544e-01 -4.26548448e-01  3.21088306e-01</span><br><span class="line">  -2.41702204e-01  1.81943579e-01 -1.36959719e-01  1.03097700e-01</span><br><span class="line">  -7.76077513e-02  5.84199555e-02]</span><br><span class="line"> [ 2.70428584e+00  7.31316190e+00  1.97768801e+01  5.34823369e+01</span><br><span class="line">   1.44631526e+02  3.91124988e+02  1.05771377e+03  2.86036036e+03</span><br><span class="line">   7.73523202e+03  2.09182784e+04]</span><br><span class="line"> [ 1.39196365e+00  1.93756281e+00  2.69701700e+00  3.75414962e+00</span><br><span class="line">   5.22563982e+00  7.27390068e+00  1.01250053e+01  1.40936394e+01</span><br><span class="line">   1.96178338e+01  2.73073115e+01]</span><br><span class="line"> [ 5.91950905e-01  3.50405874e-01  2.07423074e-01  1.22784277e-01</span><br><span class="line">   7.26822637e-02  4.30243318e-02  2.54682921e-02  1.50759786e-02</span><br><span class="line">   8.92423917e-03  5.28271146e-03]</span><br><span class="line"> [-2.06388816e+00  4.25963433e+00 -8.79140884e+00  1.81444846e+01</span><br><span class="line">  -3.74481869e+01  7.72888694e+01 -1.59515582e+02  3.29222321e+02</span><br><span class="line">  -6.79478050e+02  1.40236670e+03]]</span><br><span class="line">Polynomial feature names:</span><br><span class="line"> [&apos;x0&apos;, &apos;x0^2&apos;, &apos;x0^3&apos;, &apos;x0^4&apos;, &apos;x0^5&apos;, &apos;x0^6&apos;, &apos;x0^7&apos;, &apos;x0^8&apos;, &apos;x0^9&apos;, &apos;x0^10&apos;]</span><br></pre></td></tr></table></figure><p>X_poly çš„ç¬¬ä¸€åˆ—ä¸Ž X å®Œå…¨å¯¹åº”ï¼Œè€Œå…¶ä»–åˆ—åˆ™æ˜¯ç¬¬ä¸€åˆ—çš„å¹‚ã€‚å°†å¤šé¡¹å¼ç‰¹å¾ä¸Žçº¿æ€§å›žå½’æ¨¡åž‹ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥å¾—åˆ°ç»å…¸çš„<strong>å¤šé¡¹å¼å›žå½’</strong>ï¼ˆpolynomial regressionï¼‰æ¨¡åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line_poly = poly.transform(line)</span><br><span class="line"></span><br><span class="line">reg = LinearRegression().fit(X_poly, y)</span><br><span class="line">plt.plot(line, reg.predict(line_poly), label=<span class="string">'polynomial linear regression'</span>)</span><br><span class="line">plt.plot(X[:, <span class="number">0</span>], y, <span class="string">'o'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Regression output'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Input feature'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/polynomial-linear-regression.png"></p><p>å¤šé¡¹å¼ç‰¹å¾åœ¨è¿™ä¸ªä¸€ç»´æ•°æ®ä¸Šå¾—åˆ°äº†éžå¸¸å¹³æ»‘çš„æ‹Ÿåˆã€‚ä½†é«˜æ¬¡å¤šé¡¹å¼åœ¨è¾¹ç•Œä¸Šæˆ–æ•°æ®å¾ˆå°‘çš„åŒºåŸŸå¯èƒ½æœ‰æžç«¯çš„è¡¨çŽ°ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œä¸‹é¢æ˜¯åœ¨åŽŸå§‹æ•°æ®ä¸Šå­¦åˆ°çš„æ ¸ SVM æ¨¡åž‹ï¼Œæ²¡æœ‰åšä»»ä½•å˜æ¢ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVR</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> gamma <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">10</span>]:</span><br><span class="line">    svr = SVR(gamma=gamma).fit(X, y)</span><br><span class="line">    plt.plot(line, svr.predict(line), label=<span class="string">'SVR gamma=&#123;&#125;'</span>.format(gamma))</span><br><span class="line"></span><br><span class="line">plt.plot(X[:, <span class="number">0</span>], y, <span class="string">'o'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Regression output'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Input feature'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/svr-on-source-data.png"></p><p>ä½¿ç”¨æ›´å¤æ‚çš„æ¨¡åž‹ï¼ˆå³æ ¸ SVMï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°ä¸€ä¸ªä¸Žå¤šé¡¹å¼å›žå½’çš„å¤æ‚åº¦ç±»ä¼¼çš„é¢„æµ‹ç»“æžœï¼Œä¸”ä¸éœ€è¦è¿›è¡Œæ˜¾ç¤ºçš„ç‰¹å¾å˜æ¢ã€‚</p><p>æˆ‘ä»¬å†æ¬¡è§‚å¯Ÿæ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†ï¼Œä½œä¸ºå¯¹äº¤äº’ç‰¹å¾å’Œå¤šé¡¹å¼ç‰¹å¾æ›´åŠ å®žé™…çš„åº”ç”¨ã€‚çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹è¿™äº›ç‰¹å¾çš„æž„é€ æ–¹å¼ï¼Œä»¥åŠå¤šé¡¹å¼ç‰¹å¾çš„å¸®åŠ©æœ‰å¤šå¤§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">boston = load_boston()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    boston.data, boston.target, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># ç¼©æ”¾æ•°æ®</span></span><br><span class="line">scaler = MinMaxScaler()</span><br><span class="line">X_train_scaled = scaler.fit_transform(X_train)</span><br><span class="line">X_test_scaled = scaler.fit_transform(X_test)</span><br><span class="line"><span class="comment"># æå–å¤šé¡¹å¼ç‰¹å¾å’Œäº¤äº’ç‰¹å¾ï¼Œæ¬¡æ•°æœ€é«˜ä¸º 2</span></span><br><span class="line">poly = PolynomialFeatures(degree=<span class="number">2</span>).fit(X_train_scaled)</span><br><span class="line">X_train_poly = poly.transform(X_train_scaled)</span><br><span class="line">X_test_poly = poly.transform(X_test_scaled)</span><br><span class="line">print(<span class="string">'X_train.shape: &#123;&#125;'</span>.format(X_train.shape))</span><br><span class="line">print(<span class="string">'X_train_poly.shape: &#123;&#125;'</span>.format(X_train_poly.shape))</span><br><span class="line"><span class="comment"># åˆ©ç”¨get_feature_nameså¾—åˆ°è¾“å…¥ç‰¹å¾å’Œè¾“å‡ºç‰¹å¾ä¹‹é—´çš„ç¡®åˆ‡å…³ç³»</span></span><br><span class="line">print(<span class="string">'Polynomial feature names:\n'</span>, poly.get_feature_names())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_train.shape: (379, 13)</span><br><span class="line">X_train_poly.shape: (379, 105)</span><br><span class="line">Polynomial feature names:</span><br><span class="line"> [&apos;1&apos;, &apos;x0&apos;, &apos;x1&apos;, &apos;x2&apos;, &apos;x3&apos;, &apos;x4&apos;, &apos;x5&apos;, &apos;x6&apos;, &apos;x7&apos;, &apos;x8&apos;, &apos;x9&apos;, &apos;x10&apos;, &apos;x11&apos;, &apos;x12&apos;, &apos;x0^2&apos;, &apos;x0 x1&apos;, &apos;x0 x2&apos;, &apos;x0 x3&apos;, &apos;x0 x4&apos;, &apos;x0 x5&apos;, &apos;x0 x6&apos;, &apos;x0 x7&apos;, &apos;x0 x8&apos;, &apos;x0 x9&apos;, &apos;x0 x10&apos;, &apos;x0 x11&apos;, &apos;x0 x12&apos;, &apos;x1^2&apos;, &apos;x1 x2&apos;, &apos;x1 x3&apos;, &apos;x1 x4&apos;, &apos;x1 x5&apos;, &apos;x1 x6&apos;, &apos;x1 x7&apos;, &apos;x1 x8&apos;, &apos;x1 x9&apos;, &apos;x1 x10&apos;, &apos;x1 x11&apos;, &apos;x1 x12&apos;, &apos;x2^2&apos;, &apos;x2 x3&apos;, &apos;x2 x4&apos;, &apos;x2 x5&apos;, &apos;x2 x6&apos;, &apos;x2 x7&apos;, &apos;x2 x8&apos;, &apos;x2 x9&apos;, &apos;x2 x10&apos;, &apos;x2 x11&apos;, &apos;x2 x12&apos;, &apos;x3^2&apos;, &apos;x3 x4&apos;, &apos;x3 x5&apos;, &apos;x3 x6&apos;, &apos;x3 x7&apos;, &apos;x3 x8&apos;, &apos;x3 x9&apos;, &apos;x3 x10&apos;, &apos;x3 x11&apos;, &apos;x3 x12&apos;, &apos;x4^2&apos;, &apos;x4 x5&apos;, &apos;x4 x6&apos;, &apos;x4 x7&apos;, &apos;x4 x8&apos;, &apos;x4 x9&apos;, &apos;x4 x10&apos;, &apos;x4 x11&apos;, &apos;x4 x12&apos;, &apos;x5^2&apos;, &apos;x5 x6&apos;, &apos;x5 x7&apos;, &apos;x5 x8&apos;, &apos;x5 x9&apos;, &apos;x5 x10&apos;, &apos;x5 x11&apos;, &apos;x5 x12&apos;, &apos;x6^2&apos;, &apos;x6 x7&apos;, &apos;x6 x8&apos;, &apos;x6 x9&apos;, &apos;x6 x10&apos;, &apos;x6 x11&apos;, &apos;x6 x12&apos;, &apos;x7^2&apos;, &apos;x7 x8&apos;, &apos;x7 x9&apos;, &apos;x7 x10&apos;, &apos;x7 x11&apos;, &apos;x7 x12&apos;, &apos;x8^2&apos;, &apos;x8 x9&apos;, &apos;x8 x10&apos;, &apos;x8 x11&apos;, &apos;x8 x12&apos;, &apos;x9^2&apos;, &apos;x9 x10&apos;, &apos;x9 x11&apos;, &apos;x9 x12&apos;, &apos;x10^2&apos;, &apos;x10 x11&apos;, &apos;x10 x12&apos;, &apos;x11^2&apos;, &apos;x11 x12&apos;, &apos;x12^2&apos;]</span><br></pre></td></tr></table></figure><p>åŽŸå§‹æ•°æ®æœ‰ 13 ä¸ªç‰¹å¾ï¼ŒçŽ°åœ¨è¢«æ‰©å±•åˆ° 105 ä¸ªäº¤äº’ç‰¹å¾ã€‚è¿™äº›æ–°ç‰¹å¾è¡¨ç¤ºä¸¤ä¸ªä¸åŒçš„åŽŸå§‹ç‰¹å¾ä¹‹é—´æ‰€æœ‰å¯èƒ½çš„äº¤äº’é¡¹ï¼Œä»¥åŠæ¯ä¸ªåŽŸå§‹ç‰¹å¾çš„å¹³æ–¹ã€‚ç¬¬ä¸€ä¸ªæ–°ç‰¹å¾æ˜¯å¸¸æ•°ç‰¹å¾ï¼Œè¿™é‡Œçš„åç§°æ˜¯ &quot;1&quot;ã€‚æŽ¥ä¸‹æ¥çš„ 13 ä¸ªç‰¹å¾æ˜¯åŽŸå§‹ç‰¹å¾ï¼ˆ&quot;x0&quot; åˆ° &quot;x12&quot;ï¼‰ã€‚ç„¶åŽæ˜¯ç¬¬ä¸€ä¸ªç‰¹å¾çš„å¹³æ–¹ï¼ˆ&quot;x0^2&quot;ï¼‰ä»¥åŠå®ƒä¸Žå…¶ä»–ç‰¹å¾çš„ç»„åˆã€‚</p><p>æˆ‘ä»¬å¯¹ Ridge åœ¨æœ‰äº¤äº’ç‰¹å¾çš„æ•°æ®é›†ä¸Šå’Œæ²¡æœ‰äº¤äº’ç‰¹å¾çš„æ•°æ®é›†ä¸Šçš„æ€§èƒ½è¿›è¡Œæ¯”è¾ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ridge = Ridge().fit(X_train_scaled, y_train)</span><br><span class="line">print(<span class="string">'Score without interactions: &#123;:.3f&#125;'</span>.format(ridge.score(X_test_scaled, y_test)))</span><br><span class="line">ridge = Ridge().fit(X_train_poly, y_train)</span><br><span class="line">print(<span class="string">'Score with interactions: &#123;:.3f&#125;'</span>.format(ridge.score(X_test_poly, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Score without interactions: 0.577</span><br><span class="line">Score with interactions: 0.741</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œåœ¨ä½¿ç”¨ Ridge æ—¶ï¼Œäº¤äº’ç‰¹å¾å’Œå¤šé¡¹å¼ç‰¹å¾å¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚ä½†å¦‚æžœä½¿ç”¨æ›´åŠ å¤æ‚çš„æ¨¡åž‹ï¼ˆæ¯”å¦‚éšæœºæ£®æž—ï¼‰ï¼Œæƒ…å†µä¼šç¨æœ‰ä¸åŒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rf = RandomForestRegressor(n_estimators=<span class="number">100</span>).fit(X_train_scaled, y_train)</span><br><span class="line">print(<span class="string">'Score without interactions: &#123;:.3f&#125;'</span>.format(rf.score(X_test_scaled, y_test)))</span><br><span class="line">rf = RandomForestRegressor(n_estimators=<span class="number">100</span>).fit(X_train_poly, y_train)</span><br><span class="line">print(<span class="string">'Score with interactions: &#123;:.3f&#125;'</span>.format(rf.score(X_test_poly, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Score without interactions: 0.780</span><br><span class="line">Score with interactions: 0.755</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ²¡æœ‰é¢å¤–çš„ç‰¹å¾ï¼Œéšæœºæ£®æž—çš„æ€§èƒ½ä¹Ÿè¦ä¼˜äºŽ Ridgeã€‚æ·»åŠ äº¤äº’ç‰¹å¾å’Œå¤šé¡¹å¼ç‰¹å¾å®žé™…ä¸Šä¼šç•¥å¾®é™ä½Žå…¶æ€§èƒ½ã€‚</p><h1 id="å•å˜é‡éžçº¿æ€§å˜æ¢">å•å˜é‡éžçº¿æ€§å˜æ¢</h1><p>æˆ‘ä»¬åˆšåˆšçœ‹åˆ°ï¼Œ<strong>æ·»åŠ ç‰¹å¾çš„å¹³æ–¹æˆ–ç«‹æ–¹å¯ä»¥æ”¹è¿›çº¿æ€§å›žå½’æ¨¡åž‹</strong>ã€‚å…¶ä»–å˜æ¢é€šå¸¸ä¹Ÿå¯¹å˜æ¢æŸäº›ç‰¹å¾æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åº”ç”¨æ•°å­¦å‡½æ•°ï¼Œæ¯”å¦‚ logã€exp æˆ– sinã€‚è™½ç„¶åŸºäºŽæ ‘çš„æ¨¡åž‹åªå…³æ³¨ç‰¹å¾çš„é¡ºåºï¼Œä½†çº¿æ€§æ¨¡åž‹å’Œç¥žç»ç½‘ç»œä¾èµ–äºŽæ¯ä¸ªç‰¹å¾çš„å°ºåº¦å’Œåˆ†å¸ƒã€‚å¦‚æžœåœ¨ç‰¹å¾å’Œç›®æ ‡ä¹‹é—´å­˜åœ¨éžçº¿æ€§å…³ç³»ï¼Œé‚£ä¹ˆå»ºæ¨¡å°±å˜å¾—éžå¸¸å›°éš¾ï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽå›žå½’é—®é¢˜ã€‚log å’Œ exp å‡½æ•°å¯ä»¥å¸®åŠ©è°ƒèŠ‚æ•°æ®çš„ç›¸å¯¹æ¯”ä¾‹ï¼Œä»Žè€Œæ”¹è¿›çº¿æ€§æ¨¡åž‹æˆ–ç¥žç»ç½‘ç»œçš„å­¦ä¹ æ•ˆæžœã€‚æˆ‘ä»¬åœ¨ç¬¬ 2 ç« ä¸­å¯¹å†…å­˜ä»·æ ¼æ•°æ®åº”ç”¨è¿‡è¿™ç§å‡½æ•°ã€‚åœ¨å¤„ç†å…·æœ‰å‘¨æœŸæ€§æ¨¡å¼çš„æ•°æ®æ—¶ï¼Œsin å’Œ cos å‡½æ•°éžå¸¸æœ‰ç”¨ã€‚</p><p>å¤§éƒ¨åˆ†æ¨¡åž‹éƒ½åœ¨æ¯ä¸ªç‰¹å¾ï¼ˆåœ¨å›žå½’é—®é¢˜ä¸­è¿˜åŒ…æ‹¬ç›®æ ‡å€¼ï¼‰å¤§è‡´éµå¾ªé«˜æ–¯åˆ†å¸ƒæ—¶è¡¨çŽ°æœ€å¥½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªç‰¹å¾çš„ç›´æ–¹å›¾åº”è¯¥å…·æœ‰ç±»ä¼¼äºŽâ€œé’Ÿå½¢æ›²çº¿â€çš„å½¢çŠ¶ã€‚ä½¿ç”¨è¯¸å¦‚ log å’Œ exp ä¹‹ç±»çš„å˜æ¢å¹¶ä¸ç¨€å¥‡ï¼Œå´å´æ˜¯å®žçŽ°è¿™ä¸€ç‚¹çš„ç®€å•åˆæœ‰æ•ˆçš„æ–¹æ³•ã€‚åœ¨ä¸€ç§ç‰¹åˆ«å¸¸è§çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„å˜æ¢éžå¸¸æœ‰ç”¨ï¼Œå°±æ˜¯å¤„ç†æ•´æ•°è®¡æ•°æ•°æ®æ—¶ã€‚è®¡æ•°æ•°æ®æ˜¯æŒ‡ç±»ä¼¼â€œç”¨æˆ·Aå¤šé•¿æ—¶é—´ç™»é™†ä¸€æ¬¡ï¼Ÿâ€è¿™æ ·çš„ç‰¹å¾ã€‚è®¡æ•°ä¸å¯èƒ½å–è´Ÿå€¼ï¼Œå¹¶ä¸”é€šå¸¸éµå¾ªç‰¹å®šçš„ç»Ÿè®¡æ¨¡å¼ã€‚ç‰¹å¾å…¨éƒ½æ˜¯æ•´æ•°å€¼ï¼Œè€Œå“åº”æ˜¯è¿žç»­çš„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rnd = np.random.RandomState(<span class="number">0</span>)</span><br><span class="line">X_org = rnd.normal(size=(<span class="number">1000</span>, <span class="number">3</span>))</span><br><span class="line">w = rnd.normal(size=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">X = rnd.poisson(<span class="number">10</span> * np.exp(X_org))</span><br><span class="line">y = np.dot(X_org, w)</span><br><span class="line"></span><br><span class="line">print(X[:<span class="number">10</span>, <span class="number">0</span>])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ 56  81  25  20  27  18  12  21 109   7]</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªç‰¹å¾çš„å‰ 10 ä¸ªå…ƒç´ éƒ½æ˜¯æ­£æ•´æ•°ï¼Œä½†é™¤æ­¤ä¹‹å¤–å¾ˆéš¾æ‰¾å‡ºç‰¹å®šçš„æ¨¡å¼ã€‚å¦‚æžœæˆ‘ä»¬è®¡ç®—æ¯ä¸ªå€¼çš„å‡ºçŽ°æ¬¡æ•°ï¼Œé‚£ä¹ˆæ•°å€¼çš„åˆ†å¸ƒå°†å˜å¾—æ›´æ¸…æ¥šã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Number of feature appearances:\n'</span>, np.bincount(X[:, <span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">bins = np.bincount(X[:, <span class="number">0</span>])</span><br><span class="line">plt.bar(range(len(bins)), bins, color=<span class="string">'gray'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Number of appearances'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Value'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Number of feature appearances:</span><br><span class="line"> [28 38 68 48 61 59 45 56 37 40 35 34 36 26 23 26 27 21 23 23 18 21 10  9</span><br><span class="line"> 17  9  7 14 12  7  3  8  4  5  5  3  4  2  4  1  1  3  2  5  3  8  2  5</span><br><span class="line">  2  1  2  3  3  2  2  3  3  0  1  2  1  0  0  3  1  0  0  0  1  3  0  1</span><br><span class="line">  0  2  0  1  1  0  0  0  0  1  0  0  2  2  0  1  1  0  0  0  0  1  1  0</span><br><span class="line">  0  0  0  0  0  0  1  0  0  0  0  0  1  1  0  0  1  0  0  0  0  0  0  0</span><br><span class="line">  1  0  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/appearances-count-of-poisson.png"></p><p>ç‰¹å¾ <code>X[:, 1]</code> å’Œ <code>X[:, 2]</code> å…·æœ‰ç±»ä¼¼çš„æ€§è´¨ã€‚è¿™ç§ç±»åž‹çš„æ•°å€¼åˆ†å¸ƒï¼ˆæ³Šæ¾åˆ†å¸ƒï¼‰åœ¨å®žè·µä¸­éžå¸¸å¸¸è§ã€‚ä½†å¤šæ•°çº¿æ€§æ¨¡åž‹æ— æ³•å¾ˆå¥½åœ°å¤„ç†è¿™ç§æ•°æ®ã€‚æˆ‘ä»¬å°è¯•æ‹Ÿåˆä¸€ä¸ªå²­å›žå½’æ¨¡åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=<span class="number">0</span>)</span><br><span class="line">score = Ridge().fit(X_train, y_train).score(X_test, y_test)</span><br><span class="line">print(<span class="string">'Test score: &#123;:.3f&#125;'</span>.format(score))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test score: 0.622</span><br></pre></td></tr></table></figure><p>ä»Žç›¸å¯¹è¾ƒå°çš„åˆ†æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼ŒRidge æ— æ³•çœŸæ­£æ•æ‰åˆ° X å’Œ y ä¹‹é—´çš„å…³ç³»ã€‚ä¸è¿‡åº”ç”¨å¯¹æ•°å˜æ¢å¯èƒ½æœ‰ç”¨ã€‚ç”±äºŽæ•°æ®å–å€¼ä¸­åŒ…æ‹¬ 0ï¼ˆå¯¹æ•°åœ¨ 0 å¤„æ²¡æœ‰å®šä¹‰ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æŽ¥åº”ç”¨ logï¼Œè€Œæ˜¯è¦è®¡ç®— log(X + 1)ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_train_log = np.log(X_train + <span class="number">1</span>)</span><br><span class="line">X_test_log = np.log(X_test + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.hist(X_train_log[:, <span class="number">0</span>], bins=<span class="number">25</span>, color=<span class="string">'gray'</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Number of apperances"</span>)</span><br><span class="line">plt.xlabel(<span class="string">"Value"</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/appearances-count-of-log-poisson.png"></p><p>åœ¨æ–°æ•°æ®ä¸Šæž„å»ºä¸€ä¸ªå²­å›žå½’æ¨¡åž‹ï¼Œå¯ä»¥å¾—åˆ°æ›´å¥½åœ°æ‹Ÿåˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">score = Ridge().fit(X_train_log, y_train).score(X_test_log, y_test)</span><br><span class="line">print(<span class="string">'Test score: &#123;:.3f&#125;'</span>.format(score))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test score: 0.875</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰ç‰¹å¾éƒ½å…·æœ‰ç›¸åŒçš„æ€§è´¨ï¼Œè¿™åœ¨å®žè·µä¸­æ˜¯éžå¸¸å°‘è§çš„æƒ…å†µã€‚é€šå¸¸æ¥è¯´ï¼Œåªæœ‰ä¸€éƒ¨åˆ†ç‰¹å¾åº”è¯¥è¿›è¡Œå˜æ¢ï¼Œæœ‰æ—¶æ¯ä¸ªç‰¹å¾çš„å˜æ¢æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒã€‚å‰é¢æåˆ°è¿‡ï¼Œ<strong>å¯¹åŸºäºŽæ ‘çš„æ¨¡åž‹è€Œè¨€ï¼Œè¿™ç§å˜æ¢å¹¶ä¸é‡è¦ï¼Œä½†å¯¹çº¿æ€§æ¨¡åž‹æ¥è¯´å¯èƒ½è‡³å…³é‡è¦ã€‚</strong>æœ€å›žå½’çš„ç›®æ ‡å˜é‡ y è¿›è¡Œå˜æ¢æœ‰æ—¶ä¹Ÿæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å°è¯•é¢„è®¡è®¡æ•°ï¼ˆæ¯”å¦‚è®¢å•æ•°é‡ï¼‰æ˜¯ä¸€é¡¹ç›¸å½“å¸¸è§çš„ä»»åŠ¡ï¼Œè€Œä¸”ä½¿ç”¨ log(y + 1) å˜æ¢ä¹Ÿå¾€å¾€æœ‰ç”¨ã€‚</p><p>åˆ†ç®±ã€å¤šé¡¹å¼å’Œäº¤äº’é¡¹éƒ½å¯¹æ¨¡åž‹åœ¨ç»™å®šæ•°æ®é›†ä¸Šçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œå¯¹äºŽå¤æ‚åº¦ä½Žçš„æ¨¡åž‹æ›´æ˜¯è¿™æ ·ï¼Œæ¯”å¦‚çº¿æ€§æ¨¡åž‹å’Œæœ´ç´ è´å¶æ–¯æ¨¡åž‹ã€‚ä¸Žä¹‹ç›¸åï¼ŒåŸºäºŽæ ‘çš„æ¨¡åž‹é€šå¸¸èƒ½å¤Ÿè‡ªå·±å‘çŽ°é‡è¦çš„äº¤äº’é¡¹ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦æ˜¾ç¤ºåœ°å˜æ¢æ•°æ®ã€‚å…¶ä»–æ¨¡åž‹ï¼Œæ¯”å¦‚ SVMã€æœ€è¿‘é‚»å’Œç¥žç»ç½‘ç»œï¼Œæœ‰æ—¶å¯èƒ½ä¼šä»Žåˆ†ç®±ã€äº¤äº’é¡¹æˆ–å¤šé¡¹å¼ä¸­å—ç›Šï¼Œä½†å…¶æ•ˆæžœé€šå¸¸ä¸å¦‚çº¿æ€§æ¨¡åž‹é‚£ä¹ˆæ˜Žæ˜¾ã€‚</p><h1 id="è‡ªåŠ¨åŒ–ç‰¹å¾é€‰æ‹©">è‡ªåŠ¨åŒ–ç‰¹å¾é€‰æ‹©</h1><p>æœ‰äº†è¿™ä¹ˆå¤šç§åˆ›å»ºæ–°ç‰¹å¾çš„æ–¹æ³•ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦å¢žå¤§æ•°æ®çš„ç»´åº¦ï¼Œä½¿å…¶è¿œå¤§äºŽåŽŸå§‹ç‰¹å¾çš„æ•°é‡ã€‚ä½†æ˜¯ï¼Œæ·»åŠ æ›´å¤šç‰¹å¾ä¼šä½¿æ‰€æœ‰æ¨¡åž‹å˜å¾—æ›´åŠ å¤æ‚ï¼Œä»Žè€Œå¢žå¤§è¿‡æ‹Ÿåˆçš„å¯èƒ½æ€§ã€‚åœ¨æ·»åŠ æ–°ç‰¹å¾æˆ–å¤„ç†ä¸€èˆ¬çš„é«˜çº¬åº¦æ•°æ®é›†æ—¶ï¼Œæœ€å¥½å°†ç‰¹å¾çš„æ•°é‡å‡å°‘åˆ°åªåŒ…å«æœ€æœ‰ç”¨çš„é‚£äº›ç‰¹å¾ï¼Œå¹¶åˆ é™¤å…¶ä½™ç‰¹å¾ã€‚è¿™æ ·ä¼šå¾—åˆ°æ³›åŒ–èƒ½åŠ›æ›´å¥½ã€æ›´ç®€å•çš„æ¨¡åž‹ã€‚ä½†ä½ å¦‚ä½•åˆ¤æ–­æ¯ä¸ªç‰¹å¾çš„ä½œç”¨æœ‰å¤šå¤§å‘¢ï¼Ÿæœ‰ä¸‰ç§åŸºæœ¬çš„ç­–ç•¥ï¼š<strong>å•å˜é‡ç»Ÿè®¡</strong>ï¼ˆunivariate statisticsï¼‰ã€<strong>åŸºäºŽæ¨¡åž‹çš„é€‰æ‹©</strong>ï¼ˆmodel-based selectionï¼‰å’Œ<strong>è¿­ä»£é€‰æ‹©</strong>ï¼ˆiterative selectionï¼‰ã€‚æ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ˜¯ç›‘ç£æ–¹æ³•ï¼Œå³å®ƒä»¬éœ€è¦ç›®æ ‡å€¼æ¥æ‹Ÿåˆæ¨¡åž‹ã€‚</p><h2 id="å•å˜é‡ç»Ÿè®¡">å•å˜é‡ç»Ÿè®¡</h2><p>åœ¨å•å˜é‡ç»Ÿè®¡ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—æ¯ä¸ªç‰¹å¾å’Œç›®æ ‡å€¼ä¹‹é—´çš„å…³ç³»æ˜¯å¦å­˜åœ¨ç»Ÿè®¡æ˜¾è‘—æ€§ï¼Œç„¶åŽé€‰æ‹©å…·æœ‰æœ€é«˜ç½®ä¿¡åº¦çš„ç‰¹å¾ã€‚å¯¹äºŽåˆ†ç±»é—®é¢˜ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸º<strong>æ–¹å·®åˆ†æž</strong>ï¼ˆanalysis of varianceï¼ŒANOVAï¼‰ã€‚è¿™äº›æµ‹è¯•çš„ä¸€ä¸ªå…³é”®æ€§è´¨å°±æ˜¯å®ƒä»¬æ˜¯<strong>å•å˜é‡çš„</strong>ï¼ˆunivariateï¼‰ï¼Œå³å®ƒä»¬åªå•ç‹¬è€ƒè™‘æ¯ä¸ªç‰¹å¾ã€‚å› æ­¤ï¼Œå¦‚æžœä¸€ä¸ªç‰¹å¾åªæœ‰åœ¨ä¸Žå¦ä¸€ä¸ªç‰¹å¾åˆå¹¶æ—¶æ‰å…·æœ‰ä¿¡æ¯é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹å¾å°†è¢«èˆå¼ƒã€‚å•å˜é‡æµ‹è¯•çš„è®¡ç®—é€Ÿåº¦é€šå¸¸å¾ˆå¿«ï¼Œå¹¶ä¸”ä¸éœ€è¦æž„å»ºæ¨¡åž‹ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒä»¬å®Œå…¨ç‹¬ç«‹äºŽä½ å¯èƒ½æƒ³è¦åœ¨ç‰¹å¾é€‰æ‹©ä¹‹åŽåº”ç”¨çš„æ¨¡åž‹ã€‚</p><p>æƒ³è¦åœ¨ scikit-learn ä¸­ä½¿ç”¨å•å˜é‡ç‰¹å¾é€‰æ‹©ï¼Œä½ éœ€è¦é€‰æ‹©ä¸€é¡¹æµ‹è¯•â€”â€”å¯¹åˆ†ç±»é—®é¢˜é€šå¸¸æ˜¯ f_classifï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå¯¹å›žå½’é—®é¢˜é€šå¸¸æ˜¯ f_regressionâ€”â€”ç„¶åŽåŸºäºŽæµ‹è¯•ä¸­ç¡®å®šçš„ p å€¼æ¥é€‰æ‹©ä¸€ç§èˆå¼ƒç‰¹å¾çš„æ–¹æ³•ã€‚æ‰€æœ‰èˆå¼ƒå‚æ•°çš„æ–¹æ³•éƒ½ä½¿ç”¨é˜ˆå€¼æ¥èˆå¼ƒæ‰€æœ‰ p å€¼è¿‡å¤§çš„ç‰¹å¾ï¼ˆæ„å‘³ç€å®ƒä»¬ä¸å¯èƒ½ä¸Žç›®æ ‡å€¼ç›¸å…³ï¼‰ã€‚è®¡ç®—é˜ˆå€¼çš„æ–¹æ³•å„æœ‰ä¸åŒï¼Œæœ€ç®€å•çš„æ˜¯ SelectKBest å’Œ SelectPercentileï¼Œå‰è€…é€‰æ‹©å›ºå®šæ•°é‡çš„ k ä¸ªç‰¹å¾ï¼ŒåŽè€…é€‰æ‹©å›ºå®šç™¾åˆ†æ¯”çš„ç‰¹å¾ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.feature_selection.selectkbest#sklearn.feature_selection.SelectKBest" target="_blank" rel="noopener"><code>class sklearn.feature_selection.SelectKBest(score_func=&lt;function f_classif&gt;, k=10)</code></a></p><p>Select features according to the k highest scores.</p><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.feature_selection.selectpercentile#sklearn.feature_selection.SelectPercentile" target="_blank" rel="noopener"><code>class sklearn.feature_selection.SelectPercentile(score_func=&lt;function f_classif&gt;, percentile=10)</code></a></p><p>Select features according to a percentile of the highest scores.</p></blockquote><p>æˆ‘ä»¬å°†åˆ†ç±»çš„ç‰¹å¾é€‰æ‹©åº”ç”¨äºŽ cancer æ•°æ®é›†ã€‚ä¸ºäº†ä½¿ä»»åŠ¡æ›´éš¾ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†å‘æ•°æ®ä¸­æ·»åŠ ä¸€äº›æ²¡æœ‰ä¿¡æ¯é‡çš„å™ªå£°ç‰¹å¾ã€‚æˆ‘ä»¬æœŸæœ›ç‰¹å¾é€‰æ‹©èƒ½å¤Ÿè¯†åˆ«æ²¡æœ‰ä¿¡æ¯é‡çš„ç‰¹å¾å¹¶åˆ é™¤å®ƒä»¬ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectPercentile</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŽ·å¾—ç¡®å®šæ€§çš„éšæœºæ•°</span></span><br><span class="line">rng = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">noise = rng.normal(size=(len(cancer.data), <span class="number">50</span>))</span><br><span class="line"><span class="comment"># å‘æ•°æ®ä¸­æ·»åŠ å™ªå£°ç‰¹å¾</span></span><br><span class="line"><span class="comment"># å‰30ä¸ªç‰¹å¾æ¥è‡ªæ•°æ®é›†ï¼ŒåŽ50ä¸ªæ˜¯å™ªå£°</span></span><br><span class="line">X_w_noise = np.hstack([cancer.data, noise])</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    X_w_noise, cancer.target, random_state=<span class="number">0</span>, test_size=<span class="number">.5</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨f_classifï¼ˆé»˜è®¤å€¼ï¼‰å’ŒSelectPercentileæ¥é€‰æ‹©50%çš„ç‰¹å¾</span></span><br><span class="line">select = SelectPercentile(percentile=<span class="number">50</span>)</span><br><span class="line">select.fit(X_train, y_train)</span><br><span class="line"><span class="comment"># å¯¹è®­ç»ƒé›†è¿›è¡Œå˜æ¢</span></span><br><span class="line">X_train_selected = select.transform(X_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'X_train.shape:'</span>, X_train.shape)</span><br><span class="line">print(<span class="string">'X_train_selected.shape:'</span>, X_train_selected.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨get_supportæ–¹æ³•æ¥æŸ¥çœ‹é‚£å“ªäº›ç‰¹å¾è¢«é€‰ä¸­ï¼Œå®ƒä¼šè¿”å›žæ‰€é€‰ç‰¹å¾çš„å¸ƒå°”é®ç½©ï¼ˆmaskï¼‰</span></span><br><span class="line">mask = select.get_support()</span><br><span class="line">print(mask)</span><br><span class="line"><span class="comment"># å°†é®ç½©å¯è§†åŒ–â€”â€”é»‘è‰²ä¸ºTrueï¼Œç™½è‰²ä¸ºFalse</span></span><br><span class="line">plt.matshow(mask.reshape(<span class="number">1</span>, <span class="number">-1</span>), cmap=<span class="string">'gray_r'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Sample index'</span>)</span><br><span class="line">plt.yticks([<span class="number">0</span>])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_train.shape: (284, 80)</span><br><span class="line">X_train_selected.shape: (284, 40)</span><br><span class="line">[ True  True  True  True  True  True  True  True  True False  True False</span><br><span class="line">  True  True  True  True  True  True False False  True  True  True  True</span><br><span class="line">  True  True  True  True  True  True False False False  True False  True</span><br><span class="line"> False False  True False False False False  True False False  True False</span><br><span class="line"> False  True False  True False False False False False False  True False</span><br><span class="line">  True False False False False  True False  True False False False False</span><br><span class="line">  True  True False  True False False False False]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/features-selected-by-selectpercentile.png"></p><p>ä»Žé®ç½©å±‚çš„å¯è§†åŒ–ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§å¤šæ•°æ‰€é€‰æ‹©çš„ç‰¹å¾éƒ½æ˜¯åŽŸå§‹ç‰¹å¾ï¼Œå¹¶ä¸”å¤§å¤šæ•°å™ªå£°ç‰¹å¾éƒ½å·²è¢«åˆ é™¤ã€‚ä½†åŽŸå§‹ç‰¹å¾çš„è¿˜åŽŸå¹¶ä¸å®Œç¾Žã€‚æˆ‘ä»¬æ¥æ¯”è¾ƒ Logistic å›žå½’åœ¨æ‰€æœ‰ç‰¹å¾ä¸Šçš„æ€§èƒ½ä¸Žä»…ä½¿ç”¨æ‰€é€‰ç‰¹å¾æ—¶çš„æ€§èƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¹æµ‹è¯•é›†è¿›è¡Œå˜æ¢</span></span><br><span class="line">X_test_selected = select.transform(X_test)</span><br><span class="line"></span><br><span class="line">lr = LogisticRegression()</span><br><span class="line">lr.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Score with all features: &#123;:.3f&#125;'</span>.format(lr.score(X_test, y_test)))</span><br><span class="line"></span><br><span class="line">lr.fit(X_train_selected, y_train)</span><br><span class="line">print(<span class="string">'Score with only selected features: &#123;:.3f&#125;'</span>.format(lr.score(X_test_selected, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Score with all features: 0.930</span><br><span class="line">Score with only selected features: 0.940</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ é™¤å™ªå£°ç‰¹å¾å¯ä»¥æé«˜æ€§èƒ½ï¼Œå³ä½¿ä¸¢å¤±äº†æŸäº›åŽŸå§‹ç‰¹å¾ã€‚è¿™æ˜¯ä¸€ä¸ªéžå¸¸ç®€å•çš„å‡æƒ³ç¤ºä¾‹ï¼Œåœ¨çœŸå®žæ•°æ®ä¸Šçš„ç»“æžœè¦æ›´åŠ å¤æ‚ã€‚ä¸è¿‡ï¼Œå¦‚æžœç‰¹å¾é‡å¤ªå¤§ä»¥è‡³äºŽæ— æ³•æž„å»ºæ¨¡åž‹ï¼Œæˆ–è€…ä½ æ€€ç–‘è®¸å¤šç‰¹å¾å®Œå…¨æ²¡æœ‰ä¿¡æ¯é‡ï¼Œé‚£ä¹ˆå•å˜é‡ç‰¹å¾é€‰æ‹©è¿˜æ˜¯éžå¸¸æœ‰ç”¨çš„ã€‚</p><h2 id="åŸºäºŽæ¨¡åž‹çš„ç‰¹å¾é€‰æ‹©">åŸºäºŽæ¨¡åž‹çš„ç‰¹å¾é€‰æ‹©</h2><p>åŸºäºŽæ¨¡åž‹çš„ç‰¹å¾é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªç›‘ç£æœºå™¨å­¦ä¹ æ¨¡åž‹æ¥åˆ¤æ–­æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§ï¼Œå¹¶ä¸”ä»…ä¿ç•™æœ€é‡è¦çš„ç‰¹å¾ã€‚ç”¨äºŽç‰¹å¾é€‰æ‹©çš„ç›‘ç£æ¨¡åž‹ä¸éœ€è¦ä¸Žç”¨äºŽæœ€ç»ˆç›‘ç£æ£€æ¨¡åž‹çš„æ¨¡åž‹ç›¸åŒã€‚ç‰¹å¾é€‰æ‹©æ¨¡åž‹éœ€è¦ä¸ºæ¯ä¸ªç‰¹å¾æä¾›æŸç§é‡è¦æ€§åº¦é‡ï¼Œä»¥ä¾¿ç”¨è¿™ä¸ªåº¦é‡å¯¹ç‰¹å¾è¿›è¡ŒæŽ’åºã€‚å†³ç­–æ ‘å’ŒåŸºäºŽå†³ç­–æ ‘çš„æ¨¡åž‹æä¾›äº† feature_importances_ å±žæ€§ï¼Œå¯ä»¥ç›´æŽ¥ç¼–ç æ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§ã€‚çº¿æ€§æ¨¡åž‹ç³»æ•°çš„ç»å¯¹å€¼ä¹Ÿå¯ä»¥ç”¨äºŽè¡¨ç¤ºç‰¹å¾é‡è¦æ€§ã€‚L1 æƒ©ç½šçš„çº¿æ€§æ¨¡åž‹å­¦åˆ°çš„æ˜¯ç¨€ç–ç³»æ•°ï¼Œå®ƒåªç”¨åˆ°äº†ç‰¹å¾çš„ä¸€ä¸ªå¾ˆå°çš„å­é›†ã€‚è¿™å¯ä»¥è¢«è§†ä¸ºæ¨¡åž‹æœ¬èº«çš„ä¸€ç§ç‰¹å¾é€‰æ‹©å½¢å¼ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ä½œå¦ä¸€ä¸ªæ¨¡åž‹é€‰æ‹©ç‰¹å¾çš„é¢„å¤„ç†æ­¥éª¤ã€‚ä¸Žå•å˜é‡é€‰æ‹©ä¸åŒï¼ŒåŸºäºŽæ¨¡åž‹çš„é€‰æ‹©åŒæ—¶è€ƒè™‘æ‰€æœ‰ç‰¹å¾ï¼Œå› æ­¤å¯ä»¥èŽ·å–äº¤äº’é¡¹ï¼ˆå¦‚æžœæ¨¡åž‹èƒ½å¤ŸèŽ·å–å®ƒä»¬çš„è¯ï¼‰ã€‚è¦æƒ³ä½¿ç”¨åŸºäºŽæ¨¡åž‹çš„ç‰¹å¾é€‰æ‹©ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ SelectFromModel å˜æ¢å™¨ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.feature_selection.selectfrommodel#sklearn.feature_selection.SelectFromModel" target="_blank" rel="noopener"><code>class sklearn.feature_selection.SelectFromModel(estimator, threshold=None, prefit=False, norm_order=1, max_features=None)</code></a></p><p>Meta-transformer for selecting features based on importance weights.</p></blockquote><p>SelectFromModelç±»é€‰å‡ºé‡è¦æ€§åº¦é‡ï¼ˆç”±ç›‘ç£æ¨¡åž‹æä¾›ï¼‰å¤§äºŽç»™å®šé˜ˆå€¼çš„æ‰€æœ‰ç‰¹å¾ã€‚æˆ‘ä»¬ç”¨åŒ…å« 100 æ£µæ ‘çš„éšæœºæ£®æž—åˆ†ç±»å™¨æ¥è®¡ç®—ç‰¹å¾é‡è¦æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„æ¨¡åž‹ï¼Œä¹Ÿæ¯”å•å˜é‡æµ‹è¯•è¦å¼ºå¤§å¾—å¤šã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectFromModel</span><br><span class="line"></span><br><span class="line">select = SelectFromModel(</span><br><span class="line">    RandomForestClassifier(n_estimators=<span class="number">100</span>, random_state=<span class="number">42</span>),</span><br><span class="line">    threshold=<span class="string">'median'</span>)</span><br><span class="line"></span><br><span class="line">select.fit(X_train, y_train)</span><br><span class="line">X_train_l1 = select.transform(X_train)</span><br><span class="line">print(<span class="string">'X_train.shape:'</span>, X_train.shape)</span><br><span class="line">print(<span class="string">'X_train_l1.shape:'</span>, X_train_l1.shape)</span><br><span class="line"></span><br><span class="line">X_test_l1 = select.transform(X_test)</span><br><span class="line">score = LogisticRegression().fit(X_train_l1, y_train).score(X_test_l1, y_test)</span><br><span class="line">print(<span class="string">'Test score: &#123;:.3f&#125;'</span>.format(score))</span><br><span class="line"></span><br><span class="line">mask = select.get_support()</span><br><span class="line">plt.matshow(mask.reshape(<span class="number">1</span>, <span class="number">-1</span>), cmap=<span class="string">'gray_r'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Sample index'</span>)</span><br><span class="line">plt.yticks([<span class="number">0</span>])</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_train.shape: (284, 80)</span><br><span class="line">X_train_l1.shape: (284, 40)</span><br><span class="line">Test score: 0.951</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/features-selected-by-selectfrommodel.png"></p><h2 id="è¿­ä»£ç‰¹å¾é€‰æ‹©">è¿­ä»£ç‰¹å¾é€‰æ‹©</h2><p>åœ¨å•å˜é‡æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨æ¨¡åž‹ï¼Œè€Œåœ¨åŸºäºŽæ¨¡åž‹çš„é€‰æ‹©ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å•ä¸ªæ¨¡åž‹æ¥é€‰æ‹©ç‰¹å¾ã€‚åœ¨è¿­ä»£ç‰¹å¾é€‰æ‹©ä¸­ï¼Œå°†ä¼šæž„å»ºä¸€ç³»åˆ—æ¨¡åž‹ï¼Œæ¯ä¸ªæ¨¡åž‹éƒ½ä½¿ç”¨ä¸åŒæ•°é‡çš„ç‰¹å¾ã€‚æœ‰ä¸¤ç§åŸºæœ¬æ–¹æ³•ï¼šå¼€å§‹æ—¶æ²¡æœ‰ç‰¹å¾ï¼Œç„¶åŽé€ä¸ªæ·»åŠ ç‰¹å¾ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªç»ˆæ­¢æ¡ä»¶ï¼›æˆ–è€…ä»Žæ‰€æœ‰ç‰¹å¾å¼€å§‹ï¼Œç„¶åŽé€ä¸ªåˆ é™¤ç‰¹å¾ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªç»ˆæ­¢æ¡ä»¶ã€‚ç”±äºŽæž„å»ºäº†ä¸€ç³»åˆ—æ¨¡åž‹ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ³•çš„è®¡ç®—æˆæœ¬è¦æ¯”å‰é¢çš„æ–¹æ³•æ›´é«˜ã€‚å…¶ä¸­ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•æ˜¯<strong>é€’å½’ç‰¹å¾æ¶ˆé™¤</strong>ï¼ˆrecursive feature eliminationï¼ŒRFEï¼‰ï¼Œå®ƒä»Žæ‰€æœ‰ç‰¹å¾å¼€å§‹æž„å»ºæ¨¡åž‹ï¼Œå¹¶æ ¹æ®æ¨¡åž‹èˆå¼ƒæœ€ä¸é‡è¦çš„ç‰¹å¾ï¼Œç„¶åŽä½¿ç”¨å‰©ä½™ç‰¹å¾æ¥æž„å»ºä¸€ä¸ªæ–°æ¨¡åž‹ï¼Œå¦‚æ­¤ç»§ç»­ï¼Œç›´åˆ°ä»…å‰©ä¸‹é¢„è®¾æ•°é‡çš„ç‰¹å¾ã€‚ä¸ºäº†è®©è¿™ç§æ–¹æ³•èƒ½å¤Ÿè¿è¡Œï¼Œç”¨äºŽé€‰æ‹©çš„æ¨¡åž‹éœ€è¦æä¾›æŸç§ç¡®å®šç‰¹å¾é‡è¦æ€§çš„æ–¹æ³•ï¼Œæ­£å¦‚åŸºäºŽæ¨¡åž‹çš„é€‰æ‹©æ‰€åšçš„é‚£æ ·ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.feature_selection.rfe#sklearn.feature_selection.RFE" target="_blank" rel="noopener"><code>class sklearn.feature_selection.RFE(estimator, n_features_to_select=None, step=1, verbose=0)</code></a></p><p>Feature ranking with recursive feature elimination.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> RFE</span><br><span class="line"></span><br><span class="line">select = RFE(RandomForestClassifier(n_estimators=<span class="number">100</span>, random_state=<span class="number">42</span>),</span><br><span class="line">    n_features_to_select=<span class="number">40</span>)</span><br><span class="line">select.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">mask = select.get_support()</span><br><span class="line">plt.matshow(mask.reshape(<span class="number">1</span>, <span class="number">-1</span>), cmap=<span class="string">'gray_r'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Sample index'</span>)</span><br><span class="line">plt.yticks([<span class="number">0</span>])</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/features-selected-by-rfe.png"></p><p>ä¸Žå•å˜é‡é€‰æ‹©å’ŒåŸºäºŽæ¨¡åž‹çš„é€‰æ‹©ç›¸æ¯”ï¼Œè¿­ä»£ç‰¹å¾é€‰æ‹©çš„ç»“æžœæ›´å¥½ï¼Œä½†ä»ç„¶æ¼æŽ‰äº†ä¸€ä¸ªç‰¹å¾ã€‚è¿è¡Œä¸Šè¿°ä»£ç éœ€è¦çš„æ—¶é—´ä¹Ÿæ¯”åŸºäºŽæ¨¡åž‹çš„é€‰æ‹©è¦é•¿å¾—å¤šï¼Œå› ä¸ºå¯¹ä¸€ä¸ªéšæœºæ£®æž—æ¨¡åž‹è®­ç»ƒäº† 40 æ¬¡ï¼Œæ¯è¿è¡Œä¸€æ¬¡åˆ é™¤ä¸€ä¸ªç‰¹å«ã€‚æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ä½¿ç”¨ RFE åšç‰¹å¾é€‰æ‹©æ—¶ Logistic å›žå½’æ¨¡åž‹çš„ç²¾åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">score = LogisticRegression().fit(X_train_rfe, y_train).score(X_test_rfe, y_test)</span><br><span class="line">print(<span class="string">'Test score: &#123;:.3f&#125;'</span>.format(score))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test score: 0.951</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨åœ¨ RFE å†…ä½¿ç”¨çš„æ¨¡åž‹æ¥è¿›è¡Œé¢„æµ‹ã€‚è¿™ä»…ä½¿ç”¨è¢«é€‰æ‹©çš„ç‰¹å¾é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Test score: &#123;:.3f&#125;'</span>.format(select.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test score: 0.951</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œåœ¨ RFE å†…éƒ¨ä½¿ç”¨çš„éšæœºæ£®æž—çš„æ€§èƒ½ï¼Œä¸Žåœ¨æ‰€é€‰ç‰¹å¾ä¸Šè®­ç»ƒä¸€ä¸ª Logistic å›žå½’æ¨¡åž‹å¾—åˆ°çš„æ€§èƒ½ç›¸åŒã€‚æ¢å¥è¯è¯´ï¼Œåªè¦æˆ‘ä»¬é€‰æ‹©äº†æ­£ç¡®çš„ç‰¹å¾ï¼Œçº¿æ€§æ¨¡åž‹çš„è¡¨çŽ°å°±ä¸Žéšæœºæ£®æž—ä¸€æ ·å¥½ã€‚</p><p>å¦‚æžœä½ ä¸ç¡®å®šä½•æ—¶é€‰æ‹©ä½¿ç”¨å“ªäº›ç‰¹å¾ä½œä¸ºæœºå™¨å­¦ä¹ ç®—æ³•çš„è¾“å…¥ï¼Œé‚£ä¹ˆè‡ªåŠ¨åŒ–ç‰¹å¾é€‰æ‹©å¯èƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚å®ƒè¿˜æœ‰åŠ©äºŽå‡å°‘æ‰€éœ€è¦çš„ç‰¹å¾æ•°é‡ï¼ŒåŠ å¿«é¢„æµ‹é€Ÿåº¦ï¼Œæˆ–å…è®¸å¯è§£é‡Šæ€§æ›´å¼ºçš„æ¨¡åž‹ã€‚åœ¨å¤§å¤šæ•°çŽ°å®žæƒ…å†µä¸‹ï¼Œä½¿ç”¨ç‰¹å¾é€‰æ‹©ä¸å¤ªå¯èƒ½å¤§å¹…æå‡æ€§èƒ½ï¼Œä½†å®ƒä»æ˜¯ç‰¹å¾å·¥ç¨‹å·¥å…·ç®±ä¸­ä¸€ä¸ªéžå¸¸æœ‰ä»·å€¼çš„å·¥å…·ã€‚</p><h1 id="åˆ©ç”¨ä¸“å®¶çŸ¥è¯†">åˆ©ç”¨ä¸“å®¶çŸ¥è¯†</h1><p>å¯¹äºŽç‰¹å®šåº”ç”¨æ¥è¯´ï¼Œåœ¨ç‰¹å¾å·¥ç¨‹ä¸­é€šå¸¸å¯ä»¥åˆ©ç”¨<strong>ä¸“å®¶çŸ¥è¯†</strong>ï¼ˆexpert knowledgeï¼‰ã€‚è™½ç„¶åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæœºå™¨å­¦ä¹ çš„ç›®çš„æ˜¯é¿å…åˆ›å»ºä¸€ç»„ä¸“å®¶è®¾è®¡çš„è§„åˆ™ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€åº”è¯¥èˆå¼ƒè¯¥åº”ç”¨æˆ–è¯¥é¢†åŸŸçš„å…ˆéªŒçŸ¥è¯†ã€‚é€šå¸¸æ¥è¯´ï¼Œé¢†åŸŸä¸“å®¶å¯ä»¥å¸®åŠ©æ‰¾å‡ºæœ‰ç”¨çš„ç‰¹å¾ï¼Œå…¶ä¿¡æ¯é‡æ¯”æ•°æ®åŽŸå§‹è¡¨ç¤ºè¦å¤§å¾—å¤šã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåˆ©ç”¨ä¸“å®¶çŸ¥è¯†çš„ç‰¹ä¾‹ã€‚ä»»åŠ¡æ˜¯é¢„æµ‹åœ¨ Andreas å®¶é—¨å£çš„è‡ªè¡Œè½¦å‡ºç§Ÿã€‚æˆ‘ä»¬æƒ³è¦è§£å†³çš„ä»»åŠ¡æ˜¯ï¼Œå¯¹äºŽç»™å®šçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œé¢„æµ‹æœ‰å¤šå°‘äººå°†ä¼šåœ¨ Andreas çš„å®¶é—¨å£ç§Ÿä¸€è¾†è‡ªè¡Œè½¦â€”â€”è¿™æ ·ä»–å°±çŸ¥é“æ˜¯å¦è¿˜æœ‰è‡ªè¡Œè½¦ç•™ç»™ä»–ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆå°† 2015 å¹´ 8 æœˆçš„æ•°æ®åŠ è½½ä¸ºä¸€ä¸ª pandas æ•°æ®æ¡†ã€‚æˆ‘ä»¬å°†æ•°æ®é‡æ–°é‡‡æ ·ä¸ºæ¯ 3 ä¸ªå°æ—¶ä¸€ä¸ªæ•°æ®ï¼Œä»¥å¾—åˆ°æ¯ä¸€å¤©çš„ä¸»è¦è¶‹åŠ¿ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">citibike = mglearn.datasets.load_citibike()</span><br><span class="line">print(<span class="string">'Citi Bike data:\n'</span>, citibike.head())</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">3</span>))</span><br><span class="line">xticks = pd.date_range(start=citibike.index.min(), end=citibike.index.max(), freq=<span class="string">'D'</span>)</span><br><span class="line">plt.xticks(xticks, xticks.strftime(<span class="string">'%a %m-%d'</span>), rotation=<span class="number">90</span>, ha=<span class="string">'left'</span>)</span><br><span class="line">plt.plot(citibike, linewidth=<span class="number">1</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Data'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Rentals'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Citi Bike data:</span><br><span class="line"> starttime</span><br><span class="line">2015-08-01 00:00:00     3</span><br><span class="line">2015-08-01 03:00:00     0</span><br><span class="line">2015-08-01 06:00:00     9</span><br><span class="line">2015-08-01 09:00:00    41</span><br><span class="line">2015-08-01 12:00:00    39</span><br><span class="line">Freq: 3H, Name: one, dtype: int64</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-citibike.png"></p><p>è§‚å¯Ÿæ­¤æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°åŒºåˆ†æ¯ 24 å°æ—¶ä¸­çš„ç™½å¤©å’Œå¤œé—´ã€‚å·¥ä½œæ—¥å’Œå‘¨æœ«çš„æ¨¡å¼ä¼¼ä¹Žä¹Ÿæœ‰å¾ˆå¤§ä¸åŒã€‚åœ¨å¯¹è¿™ç§æ—¶é—´åºåˆ—ä¸Šçš„é¢„æµ‹ä»»åŠ¡è¿›è¡Œè¯„ä¼°æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›<strong>ä»Žè¿‡åŽ»å­¦ä¹ </strong>å¹¶<strong>é¢„æµ‹æœªæ¥</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æŸä¸ªç‰¹å®šæ—¥æœŸä¹‹å‰çš„æ‰€æœ‰æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼Œè¯¥æ—¥æœŸä¹‹åŽçš„æ‰€æœ‰æ•°æ®ä½œä¸ºæµ‹è¯•é›†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å‰ 184 ä¸ªæ•°æ®ç‚¹ï¼ˆå¯¹åº”å‰ 23 å¤©ï¼‰ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„ 64 ä¸ªæ•°æ®ç‚¹ï¼ˆå¯¹åº”å‰©ä½™çš„ 8 å¤©ï¼‰ä½œä¸ºæµ‹è¯•é›†ã€‚</p><p>åœ¨æˆ‘ä»¬çš„é¢„æµ‹ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å”¯ä¸€ç‰¹å¾å°±æ˜¯æŸä¸€ç§Ÿè½¦æ•°é‡å¯¹åº”çš„æ—¥æœŸå’Œæ—¶é—´ã€‚å› æ­¤è¾“å…¥ç‰¹å¾æ˜¯æ—¥æœŸå’Œæ—¶é—´ï¼Œæ¯”å¦‚ 2014-08-01 00:00:00ï¼Œè€Œè¾“å‡ºæ˜¯åœ¨æŽ¥ä¸‹æ¥ 3 å°æ—¶å†…çš„ç§Ÿè½¦æ•°é‡ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ 3ï¼‰ã€‚</p><p>åœ¨è®¡ç®—æœºä¸Šå­˜å‚¨æ—¥æœŸçš„å¸¸ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ POSIX æ—¶é—´ï¼Œå®ƒæ˜¯ä»Ž 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00ï¼ˆä¹Ÿå°±æ˜¯ Unix æ—¶é—´çš„èµ·ç‚¹ï¼‰èµ·è‡³çŽ°åœ¨çš„æ€»ç§’æ•°ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ªå•ä¸€æ•´æ•°ç‰¹å¾ä½œä¸ºæ•°æ®è¡¨ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æå–ç›®æ ‡å€¼</span></span><br><span class="line">y = citibike.values</span><br><span class="line"><span class="comment"># åˆ©ç”¨"%s"å°†æ—¶é—´è½¬æ¢ä¸ºPOSIXæ—¶é—´</span></span><br><span class="line">X = np.reshape(citibike.index.strftime(<span class="string">"%s"</span>).astype(<span class="string">"int"</span>), (<span class="number">-1</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œæž„å»ºæ¨¡åž‹å¹¶å°†ç»“æžœå¯è§†åŒ–</span></span><br><span class="line">n_train = <span class="number">184</span>  <span class="comment"># ä½¿ç”¨å‰184ä¸ªæ•°æ®ç‚¹ç”¨äºŽè®­ç»ƒï¼Œå‰©ä½™çš„æ•°æ®ç‚¹ç”¨äºŽæµ‹è¯•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç»™å®šç‰¹å¾é›†ä¸Šçš„å›žå½’è¿›è¡Œè¯„ä¼°å’Œä½œå›¾çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eval_on_features</span><span class="params">(features, target, regressor)</span>:</span></span><br><span class="line">    <span class="comment"># å°†ç»™å®šç‰¹å¾åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">    X_train, X_test = features[:n_train], features[n_train:]</span><br><span class="line">    <span class="comment"># åŒæ ·åˆ’åˆ†ç›®æ ‡æ•°ç»„</span></span><br><span class="line">    y_train, y_test = target[:n_train], target[n_train:]</span><br><span class="line">    regressor.fit(X_train, y_train)</span><br><span class="line">    print(<span class="string">'Test-set R^2: &#123;:.2f&#125;'</span>.format(regressor.score(X_test, y_test)))</span><br><span class="line"></span><br><span class="line">    y_pred = regressor.predict(X_test)</span><br><span class="line">    y_pred_train = regressor.predict(X_train)</span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">3</span>))</span><br><span class="line">    plt.xticks(range(<span class="number">0</span>, len(X), <span class="number">8</span>), xticks.strftime(<span class="string">'%a %m-%d'</span>), rotation=<span class="number">90</span>, ha=<span class="string">'left'</span>)</span><br><span class="line">    plt.plot(range(n_train), y_train, label=<span class="string">'train'</span>)</span><br><span class="line">    plt.plot(range(n_train, len(y_test) + n_train), y_test, <span class="string">'-'</span>, label=<span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line">    plt.plot(range(n_train), y_pred_train, <span class="string">'--'</span>, label=<span class="string">'prediction train'</span>)</span><br><span class="line">    plt.plot(range(n_train, len(y_test) + n_train), y_pred, <span class="string">'--'</span>, label=<span class="string">'prediction test'</span>)</span><br><span class="line">    plt.legend(loc=(<span class="number">1.01</span>, <span class="number">0</span>))</span><br><span class="line">    plt.xlabel(<span class="string">'Date'</span>)</span><br><span class="line">    plt.ylabel(<span class="string">'Rentals'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨éšæœºæ£®æž—å›žå½’</span></span><br><span class="line">regressor = RandomForestRegressor(n_estimators=<span class="number">100</span>, random_state=<span class="number">0</span>)</span><br><span class="line">eval_on_features(X, y, regressor)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test-set R^2: -0.04</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/random-forest-on-citibike.png"></p><p>åœ¨è®­ç»ƒé›†ä¸Šçš„é¢„æµ‹ç»“æžœç›¸å½“å¥½ï¼Œè¿™ç¬¦åˆéšæœºæ£®æž—é€šå¸¸çš„è¡¨çŽ°ã€‚ä½†å¯¹äºŽæµ‹è¯•é›†æ¥è¯´ï¼Œé¢„æµ‹ç»“æžœæ˜¯ä¸€æ¡å¸¸æ•°ç›´çº¿ã€‚<span class="math inline">\(R^2\)</span>ä¸º -0.04ï¼Œè¯´æ˜Žæˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡æœ‰å­¦åˆ°ã€‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><p>é—®é¢˜åœ¨äºŽç‰¹å¾å’Œéšæœºæ£®æž—çš„ç»„åˆã€‚æµ‹è¯•é›†ä¸­ POSIX æ—¶é—´ç‰¹å¾çš„å€¼è¶…å‡ºäº†è®­ç»ƒé›†ä¸­ç‰¹å¾å–å€¼çš„èŒƒå›´ï¼šæµ‹è¯•é›†ä¸­æ•°æ®ç‚¹çš„æ—¶é—´æˆ³è¦æ™šäºŽè®­ç»ƒé›†ä¸­çš„æ‰€æœ‰æ•°æ®ç‚¹ã€‚æ ‘ä»¥åŠéšæœºæ£®æž—æ— æ³•<strong>å¤–æŽ¨</strong>ï¼ˆextrapolateï¼‰åˆ°è®­ç»ƒé›†ä¹‹å¤–çš„ç‰¹å¾èŒƒå›´ã€‚ç»“æžœå°±æ˜¯æ¨¡åž‹åªèƒ½é¢„æµ‹è®­ç»ƒé›†ä¸­æœ€è¿‘æ•°æ®ç‚¹çš„ç›®æ ‡å€¼ï¼Œå³æœ€åŽä¸€æ¬¡è§‚æµ‹åˆ°æ•°æ®çš„æ—¶é—´ã€‚</p><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°æ›´å¥½ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„â€œä¸“å®¶çŸ¥è¯†â€çš„ç”¨æ­¦ä¹‹åœ°ã€‚é€šè¿‡è§‚å¯Ÿè®­ç»ƒæ•°æ®ä¸­çš„ç§Ÿè½¦æ•°é‡å›¾åƒï¼Œæˆ‘ä»¬å‘çŽ°ä¸¤ä¸ªå› ç´ ä¼¼ä¹Žéžå¸¸é‡è¦ï¼šä¸€å¤©å†…çš„æ—¶é—´ä¸Žä¸€å‘¨çš„æ˜ŸæœŸå‡ ã€‚å› æ­¤æˆ‘ä»¬æ¥æ·»åŠ è¿™ä¸¤ä¸ªç‰¹å¾ã€‚æˆ‘ä»¬ä»Ž POSIX æ—¶é—´ä¸­å­¦ä¸åˆ°ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥åˆ æŽ‰è¿™ä¸ªç‰¹å¾ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨æ¯å¤©çš„æ—¶åˆ»ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_hour = np.reshape(citibike.index.hour, (<span class="number">-1</span>, <span class="number">1</span>))</span><br><span class="line">eval_on_features(X_hour, y, regressor)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test-set R^2: 0.60</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/random-forest-on-citibike-hour.png"></p><p><span class="math inline">\(R^2\)</span> å·²ç»å¥½å¤šäº†ï¼Œä½†é¢„æµ‹ç»“æžœæ˜¾ç„¶æ²¡æœ‰æŠ“ä½æ¯å‘¨çš„æ¨¡å¼ï¼ŒçŽ°åœ¨çš„é¢„æµ‹ç»“æžœå¯¹ä¸€å‘¨å†…çš„æ¯å¤©éƒ½å…·æœ‰ç›¸åŒçš„æ¨¡å¼ã€‚ä¸‹é¢æˆ‘ä»¬æ·»åŠ ä¸€å‘¨çš„æ˜ŸæœŸå‡ ä½œä¸ºç‰¹å¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_hour_week = np.hstack([np.reshape(citibike.index.dayofweek, (<span class="number">-1</span>, <span class="number">1</span>)),</span><br><span class="line">                          np.reshape(citibike.index.hour, (<span class="number">-1</span>, <span class="number">1</span>))])</span><br><span class="line">eval_on_features(X_hour_week, y, regressor)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test-set R^2: 0.84</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/random-forest-on-citibike-hour-week.png"></p><p>çŽ°åœ¨æˆ‘ä»¬çš„æ¨¡åž‹é€šè¿‡è€ƒè™‘ä¸€å‘¨çš„æ˜ŸæœŸå‡ å’Œä¸€å¤©å†…çš„æ—¶é—´æ•æ‰åˆ°äº†å‘¨æœŸæ€§çš„è¡Œä¸ºã€‚å®ƒçš„ <span class="math inline">\(R^2\)</span> ä¸º 0.84ï¼Œé¢„æµ‹æ€§èƒ½ç›¸å½“å¥½ã€‚æ¨¡åž‹å­¦åˆ°çš„å†…å®¹å¯èƒ½æ˜¯ 8 æœˆå‰ 23 å¤©ä¸­æ˜ŸæœŸå‡ ä¸Žæ—¶åˆ»æ¯ç§ç»„åˆçš„å¹³å‡ç§Ÿè½¦æ•°é‡ã€‚è¿™å®žé™…ä¸Šä¸éœ€è¦åƒéšæœºæ£®æž—è¿™æ ·å¤æ‚çš„æ¨¡åž‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•ä¸€ä¸ªæ›´ç®€å•çš„æ¨¡åž‹â€”â€”LinearRegressionã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval_on_features(X_hour_week, y, LinearRegression())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test-set R^2: 0.13</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-regression-on-citibike.png"></p><p><strong>LinearRegression çš„æ•ˆæžœå·®å¾—å¤šï¼Œè€Œä¸”å‘¨æœŸæ€§æ¨¡å¼çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚å…¶åŽŸå› åœ¨äºŽæˆ‘ä»¬ç”¨æ•´æ•°ç¼–ç ä¸€å‘¨çš„æ˜ŸæœŸå‡ å’Œä¸€å¤©å†…çš„æ—¶é—´ï¼Œå®ƒä»¬è¢«è§£é‡Šä¸ºè¿žç»­å˜é‡ã€‚</strong>å› æ­¤ï¼Œçº¿æ€§æ¨¡åž‹åªèƒ½å­¦åˆ°å…³äºŽæ¯å¤©æ—¶é—´çš„çº¿æ€§å‡½æ•°â€”â€”å®ƒå­¦åˆ°çš„æ˜¯ï¼Œæ—¶é—´è¶Šæ™šï¼Œç§Ÿè½¦æ•°é‡è¶Šå¤šã€‚ä½†å®žé™…æ¨¡å¼æ¯”è¿™è¦å¤æ‚å¾—å¤šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ•´æ•°è§£é‡Šä¸ºåˆ†ç±»å˜é‡ï¼ˆç”¨ OneHotEncoder è¿›è¡Œå˜æ¢ï¼‰æ¥èŽ·å¾—è¿™ç§æ¨¡å¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">enc = OneHotEncoder()</span><br><span class="line">X_hour_week_onehot = enc.fit_transform(X_hour_week).toarray()</span><br><span class="line">eval_on_features(X_hour_week_onehot, y, Ridge())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test-set R^2: 0.62</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/ridge-on-citibike.png"></p><p>å®ƒç»™å‡ºäº†æ¯”è¿žç»­ç‰¹å¾ç¼–ç å¥½å¾—å¤šçš„åŒ¹é…ã€‚çŽ°åœ¨çº¿æ€§æ¨¡åž‹ä¸ºä¸€å‘¨å†…çš„æ¯å¤©éƒ½å­¦åˆ°äº†ä¸€ä¸ªç³»æ•°ï¼Œä¸ºä¸€å¤©å†…çš„æ¯ä¸ªæ—¶åˆ»éƒ½å­¦åˆ°äº†ä¸€ä¸ªç³»æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å‘¨ä¸ƒå¤©å…±äº«â€œä¸€å¤©å†…æ¯ä¸ªæ—¶åˆ»â€çš„æ¨¡å¼ã€‚</p><p>åˆ©ç”¨äº¤äº’ç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥è®©æ¨¡åž‹ä¸ºæ˜ŸæœŸå‡ å’Œæ—¶åˆ»çš„æ¯ä¸€ç§ç»„åˆéƒ½å­¦åˆ°ä¸€ä¸ªç³»æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">poly_transformer = PolynomialFeatures(degree=<span class="number">2</span>, interaction_only=<span class="literal">True</span>, include_bias=<span class="literal">False</span>)</span><br><span class="line">X_hour_week_onehot_poly = poly_transformer.fit_transform(X_hour_week_onehot)</span><br><span class="line">lr = Ridge()</span><br><span class="line">eval_on_features(X_hour_week_onehot_poly, y, lr)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test-set R^2: 0.85</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/ridge-on-citibike-poly.png"></p><p>è¿™ä¸€å˜æ¢æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ€§èƒ½ä¸Žéšæœºæ£®æž—ç±»ä¼¼çš„æ¨¡åž‹ã€‚è¿™ä¸ªæ¨¡åž‹çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°å­¦åˆ°çš„å†…å®¹ï¼šå¯¹æ¯ä¸ªæ˜ŸæœŸå‡ å’Œæ—¶åˆ»çš„äº¤äº’é¡¹å­¦åˆ°äº†ä¸€ä¸ªç³»æ•°ã€‚æˆ‘ä»¬å¯ä»¥å°†æ¨¡åž‹å­¦åˆ°çš„ç³»æ•°ä½œå›¾ï¼Œè€Œè¿™å¯¹äºŽéšæœºæ£®æž—æ¥è¯´æ˜¯ä¸å¯èƒ½çš„ï¼ˆéšæœºæ£®æž—ä¹Ÿæœ‰å…³äºŽç‰¹å¾é‡è¦æ€§çš„å‚æ•° <code>feature_importances_</code>ï¼Œä¸ºä½•ä¸å¯èƒ½ï¼Ÿï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ºæ—¶åˆ»å’Œæ˜ŸæœŸå‡ åˆ›å»ºåç§°</span></span><br><span class="line">hour = [<span class="string">'%02d:00'</span> % i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">24</span>, <span class="number">3</span>)]</span><br><span class="line">day = [<span class="string">'Mon'</span>, <span class="string">'Tue'</span>, <span class="string">'Wed'</span>, <span class="string">'Thu'</span>, <span class="string">'Fri'</span>, <span class="string">'Sat'</span>, <span class="string">'Sun'</span>]</span><br><span class="line">features = day + hour</span><br><span class="line"><span class="comment"># åˆ©ç”¨ get_feature_names æ–¹æ³•å¯¹ PolynomialFeatures æå–çš„æ‰€æœ‰äº¤äº’ç‰¹å¾è¿›è¡Œå‘½å</span></span><br><span class="line">features_poly = poly_transformer.get_feature_names(features)</span><br><span class="line">features_nonzero = np.array(features_poly)[lr.coef_ != <span class="number">0</span>]</span><br><span class="line">coef_nonzero = lr.coef_[lr.coef_ != <span class="number">0</span>]</span><br><span class="line"><span class="comment"># å°†çº¿æ€§æ¨¡åž‹å­¦åˆ°çš„ç³»æ•°å¯è§†åŒ–</span></span><br><span class="line">plt.figure(figsize=(<span class="number">15</span>, <span class="number">2</span>))</span><br><span class="line">plt.plot(coef_nonzero, <span class="string">'o'</span>)</span><br><span class="line">plt.xticks(np.arange(len(coef_nonzero)), features_nonzero, rotation=<span class="number">90</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature name'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature magnitude'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/coef-of-linear-regression-on-citibike.png"></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Useful Mac Apps</title>
      <link href="/mac/useful-mac-apps/"/>
      <url>/mac/useful-mac-apps/</url>
      
        <content type="html"><![CDATA[<h1 id="è£…æœºå¿…å¤‡">è£…æœºå¿…å¤‡</h1><table><thead><tr class="header"><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a></td><td>æœ€å¥½ç”¨çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·</td></tr><tr class="even"><td><a href="https://theunarchiver.com/" target="_blank" rel="noopener">The Unarchiver</a></td><td>æœ€å¥½ç”¨çš„è§£åŽ‹ç¼©å·¥å…·</td></tr><tr class="odd"><td><a href="https://freemacsoft.net/appcleaner/" target="_blank" rel="noopener">AppCleaner</a></td><td>å®Œå…¨å¸è½½åº”ç”¨</td></tr><tr class="even"><td><a href="https://mounty.app/" target="_blank" rel="noopener">Mounty for NTFS</a></td><td>è¯»/å†™NTFSæ ¼å¼çš„å·</td></tr><tr class="odd"><td><a href="https://pock.dev/" target="_blank" rel="noopener">Pock</a></td><td>è‡ªå®šä¹‰Touch Bar</td></tr></tbody></table><a id="more"></a><h1 id="å¼€å‘å·¥å…·">å¼€å‘å·¥å…·</h1><table><thead><tr class="header"><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="https://www.jetbrains.com/toolbox-app/" target="_blank" rel="noopener">Jetbrains Toolbox</a></td><td>è½»æ¾ç®¡ç†Jetbrainså¼€å‘å·¥å…·</td></tr><tr class="even"><td><a href="https://devdocs.io/" target="_blank" rel="noopener">devdocs</a> / <a href="https://devdocs.egoist.moe/" target="_blank" rel="noopener">DevDocs Desktop</a></td><td>å…è´¹ã€å¼€æºçš„APIæ–‡æ¡£</td></tr><tr class="odd"><td><a href="https://sequelpro.com/test-builds" target="_blank" rel="noopener">Sequel Pro</a></td><td>å…è´¹çš„æ•°æ®åº“å®¢æˆ·ç«¯</td></tr></tbody></table><h1 id="ä¸‹è½½å·¥å…·">ä¸‹è½½å·¥å…·</h1><table><thead><tr class="header"><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="https://github.com/ytdl-org/youtube-dl" target="_blank" rel="noopener">youtube-dl</a></td><td>ä¸‹è½½æ²¹ç®¡ä¸Šçš„è§†é¢‘ï¼Œå‘½ä»¤è¡Œå·¥å…·</td></tr><tr class="even"><td><a href="https://www.jihosoft.cn/tubeget/" target="_blank" rel="noopener">Gihosoft TubeGet</a></td><td>ä¸‹è½½æ²¹ç®¡ä¸Šçš„è§†é¢‘ï¼Œapp</td></tr><tr class="odd"><td><a href="https://www.freedownloadmanager.org/zh/" target="_blank" rel="noopener">Free Download Manager(FDM)</a></td><td>IDMçš„ä¼˜ç§€æ›¿ä»£</td></tr></tbody></table><h1 id="è°·æ­Œæµè§ˆå™¨æ‰©å±•">è°·æ­Œæµè§ˆå™¨æ‰©å±•</h1><table><thead><tr class="header"><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="https://chrome.google.com/webstore/detail/free-download-manager/ahmpjcflkgiildlgicmcieglgoilbfdp" target="_blank" rel="noopener">Free Download Manager</a></td><td>æ­é…FDMä½¿ç”¨</td></tr><tr class="even"><td><a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="noopener">Tampermonkey</a></td><td>ç®¡ç†ç”¨æˆ·è„šæœ¬</td></tr><tr class="odd"><td></td><td><a href="https://greasyfork.org/zh-CN/scripts/25718-%E8%A7%A3%E9%99%A4b%E7%AB%99%E5%8C%BA%E5%9F%9F%E9%99%90%E5%88%B6" target="_blank" rel="noopener">è§£é™¤Bç«™åŒºåŸŸé™åˆ¶</a></td></tr><tr class="even"><td></td><td><a href="https://greasyfork.org/zh-CN/scripts/1682-google-hit-hider-by-domain-search-filter-block-sites" target="_blank" rel="noopener">Google Hit Hider by Domain (Search Filter / Block Sites)</a></td></tr><tr class="odd"><td><a href="https://chrome.google.com/webstore/detail/neteasemusicworld%2B/pjcgkmiglhiambjngnljkdpoggonlnfe" target="_blank" rel="noopener">NetEaseMusicWorld+</a></td><td>è§£é”ç½‘æ˜“äº‘éŸ³ä¹çš„æµ·å¤–æ’­æ”¾</td></tr><tr class="even"><td><a href="https://chrome.google.com/webstore/detail/%E5%B9%BF%E5%91%8A%E7%BB%88%E7%BB%93%E8%80%85/fpdnjdlbdmifoocedhkighhlbchbiikl" target="_blank" rel="noopener">å¹¿å‘Šç»ˆç»“è€…</a></td><td>æ¸…é™¤ç½‘é¡µä¸Šçš„æ‰€æœ‰å¹¿å‘Š</td></tr></tbody></table><h1 id="éŸ³ä¹è§†é¢‘">éŸ³ä¹è§†é¢‘</h1><table><thead><tr class="header"><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="https://iina.io/" target="_blank" rel="noopener">IINA</a></td><td>ï¼ˆæœ€ï¼‰å¥½ç”¨çš„è§†é¢‘æ’­æ”¾å™¨</td></tr><tr class="even"><td><a href="http://deadbeatsw.com/thetagger/" target="_blank" rel="noopener">The Tagger</a></td><td>ä¿®æ”¹MP3å’ŒAACçš„æ ‡ç­¾</td></tr></tbody></table><h1 id="ç¤¾äº¤">ç¤¾äº¤</h1><table><thead><tr class="header"><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td><a href="https://weiboformac.sinaapp.com/" target="_blank" rel="noopener">Maipo for Weibo</a></td><td>æ–°æµªå¾®åšçš„éžå®˜æ–¹å®¢æˆ·ç«¯</td></tr><tr class="even"><td><a href="https://sparkmailapp.com/zh" target="_blank" rel="noopener">Spark</a></td><td>ç®€å•æ˜“ç”¨çš„é‚®ä»¶å®¢æˆ·ç«¯</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> app </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>No Xcode or CLT version detected</title>
      <link href="/programming/no-xcode-or-clt-version-detected/"/>
      <url>/programming/no-xcode-or-clt-version-detected/</url>
      
        <content type="html"><![CDATA[<p>If your Mac has been upgraded to macOS Catalina (10.15), please read <a href="https://github.com/nodejs/node-gyp/blob/master/macOS_Catalina.md" target="_blank" rel="noopener">macOS_Catalina.md</a>.</p><p>è§£å†³æ–¹æ³•ï¼š</p><p>å®‰è£…æ‰€éœ€çš„ç¼–è¯‘å™¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure><p>æˆ–é‡æ–°å®‰è£…</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm -rf $(xcode-select -print-path)</span><br><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sklearn bunch</title>
      <link href="/source-code/sklearn-bunch/"/>
      <url>/source-code/sklearn-bunch/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><figcaption><span>utils.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bunch</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="string">"""Container object for datasets</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Dictionary-like object that exposes its keys as attributes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b = Bunch(a=1, b=2)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b['b']</span></span><br><span class="line"><span class="string">    2</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b.b</span></span><br><span class="line"><span class="string">    2</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b.a = 3</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b['a']</span></span><br><span class="line"><span class="string">    3</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b.c = 6</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; b['c']</span></span><br><span class="line"><span class="string">    6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__dir__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.keys()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(key)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dict </tag>
            
            <tag> sklearn </tag>
            
            <tag> special method </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cplex cutting stock</title>
      <link href="/source-code/cplex-cutting-stock/"/>
      <url>/source-code/cplex-cutting-stock/</url>
      
        <content type="html"><![CDATA[<h1 id="æºç ">æºç </h1><figure class="highlight python"><figcaption><span>cutstock.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># File: cutstock.py</span></span><br><span class="line"><span class="comment"># Version 12.9.0</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Licensed Materials - Property of IBM</span></span><br><span class="line"><span class="comment"># 5725-A06 5725-A29 5724-Y48 5724-Y49 5724-Y54 5724-Y55 5655-Y21</span></span><br><span class="line"><span class="comment"># Copyright IBM Corporation 2009, 2019. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># US Government Users Restricted Rights - Use, duplication or</span></span><br><span class="line"><span class="comment"># disclosure restricted by GSA ADP Schedule Contract with</span></span><br><span class="line"><span class="comment"># IBM Corp.</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Using column generation</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Problem Description:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The cutting stock problem in this example is sometimes known in math</span></span><br><span class="line"><span class="string">programming terms as a knapsack problem with reduced costs in the</span></span><br><span class="line"><span class="string">objective function. Generally, a cutting stock problem begins with a</span></span><br><span class="line"><span class="string">supply of rolls of material of fixed length (the stock). Strips are cut</span></span><br><span class="line"><span class="string">from these rolls. All the strips cut from one roll are known together as</span></span><br><span class="line"><span class="string">a pattern. The point of this example is to use as few rolls of stock as</span></span><br><span class="line"><span class="string">possible to satisfy some specified demand of strips. By convention, it is</span></span><br><span class="line"><span class="string">assumed that only one pattern is laid out across the stock; consequently,</span></span><br><span class="line"><span class="string">only one dimension (the width) of each roll of stock is important.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To run from the command line, use</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   python cutstock.py</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cplex</span><br><span class="line"><span class="keyword">from</span> cplex.exceptions <span class="keyword">import</span> CplexSolverError</span><br><span class="line"><span class="keyword">from</span> cplex <span class="keyword">import</span> SparsePair</span><br><span class="line"><span class="keyword">from</span> cplex.six.moves <span class="keyword">import</span> zip</span><br><span class="line"><span class="keyword">from</span> inputdata <span class="keyword">import</span> read_dat_file</span><br><span class="line"></span><br><span class="line">RC_EPS = <span class="number">1.0e-6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">report1</span><span class="params">(cut)</span>:</span></span><br><span class="line">    <span class="string">"""Print a report about the current solution in the cutting</span></span><br><span class="line"><span class="string">    optimization problem given by the cut argument.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    print()</span><br><span class="line">    print(<span class="string">"Using "</span> + str(cut.solution.get_objective_value()) + <span class="string">" rolls"</span>)</span><br><span class="line">    print()</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(cut.variables.get_num()):</span><br><span class="line">        print(<span class="string">"  Cut"</span> + str(v) + <span class="string">" = "</span> + str(cut.solution.get_values(v)))</span><br><span class="line">    print()</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(cut.linear_constraints.get_num()):</span><br><span class="line">        print(<span class="string">"  Fill"</span> + str(c) + <span class="string">" = "</span> + str(cut.solution.get_dual_values(c)))</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">report2</span><span class="params">(pat, use)</span>:</span></span><br><span class="line">    <span class="string">"""Print a report about the current solution in the pattern generation</span></span><br><span class="line"><span class="string">    problem given by the pat argument. The use argument specifies the indices</span></span><br><span class="line"><span class="string">    of variables that shall appear in the report.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print()</span><br><span class="line">    print(<span class="string">"Reduced cost is "</span> + str(pat.solution.get_objective_value()))</span><br><span class="line">    print()</span><br><span class="line">    <span class="keyword">if</span> pat.solution.get_objective_value() &lt;= -RC_EPS:</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> use:</span><br><span class="line">            print(<span class="string">"  Use"</span> + str(v) + <span class="string">" = "</span> + str(pat.solution.get_values(v)))</span><br><span class="line">        print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">report3</span><span class="params">(cut)</span>:</span></span><br><span class="line">    <span class="string">"""Print the final report for the current solution in the cutting</span></span><br><span class="line"><span class="string">    optimization problem given by the cut argument.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print()</span><br><span class="line">    print(<span class="string">"Best integer solution uses "</span> +</span><br><span class="line">          str(cut.solution.get_objective_value()) + <span class="string">" rolls"</span>)</span><br><span class="line">    print()</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> range(cut.variables.get_num()):</span><br><span class="line">        print(<span class="string">"  Cut"</span> + str(v) + <span class="string">" = "</span> + str(cut.solution.get_values(v)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cutstock</span><span class="params">(datafile)</span>:</span></span><br><span class="line">    <span class="comment"># Input data. If no file is given on the command line then use a</span></span><br><span class="line">    <span class="comment"># default file name. The data read is</span></span><br><span class="line">    <span class="comment"># width  - the width of the the roll,</span></span><br><span class="line">    <span class="comment"># size   - the sie of each strip,</span></span><br><span class="line">    <span class="comment"># amount - the demand for each strip.</span></span><br><span class="line">    width, size, amount = read_dat_file(datafile)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Setup cutting optimization (master) problem.</span></span><br><span class="line">    <span class="comment"># This is the problem to which columns will be added in the loop</span></span><br><span class="line">    <span class="comment"># below.</span></span><br><span class="line">    cut = cplex.Cplex()</span><br><span class="line">    cut.set_results_stream(<span class="literal">None</span>)</span><br><span class="line">    cutcons = list(range(len(amount)))   <span class="comment"># constraint indices</span></span><br><span class="line">    cutvars = list(range(len(size)))     <span class="comment"># variable indices</span></span><br><span class="line">    cut.variables.add(obj=[<span class="number">1</span>] * len(cutvars))</span><br><span class="line">    <span class="comment"># Add constraints. They have empty left-hand side initially. The</span></span><br><span class="line">    <span class="comment"># left-hand side is filled in the next loop.</span></span><br><span class="line">    cut.linear_constraints.add(lin_expr=[SparsePair()] * len(cutcons),</span><br><span class="line">                               senses=[<span class="string">"G"</span>] * len(cutcons),</span><br><span class="line">                               rhs=amount)</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> cutvars:</span><br><span class="line">        cut.linear_constraints.set_coefficients(v, v, int(width / size[v]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Setup pattern generation (worker) problem.</span></span><br><span class="line">    <span class="comment"># The constraints and variables in this problem always stay the same</span></span><br><span class="line">    <span class="comment"># but the objective function will change during the column generation</span></span><br><span class="line">    <span class="comment"># loop.</span></span><br><span class="line">    pat = cplex.Cplex()</span><br><span class="line">    pat.set_results_stream(<span class="literal">None</span>)</span><br><span class="line">    use = list(range(len(size)))         <span class="comment"># variable indices</span></span><br><span class="line">    pat.variables.add(types=[pat.variables.type.integer] * len(use))</span><br><span class="line">    <span class="comment"># Add a constant 1 to the objective.</span></span><br><span class="line">    pat.variables.add(obj=[<span class="number">1</span>], lb=[<span class="number">1</span>], ub=[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># Single constraint: total size must not exceed the width.</span></span><br><span class="line">    totalsize = SparsePair(ind=use, val=size)</span><br><span class="line">    pat.linear_constraints.add(lin_expr=[totalsize],</span><br><span class="line">                               senses=[<span class="string">"L"</span>],</span><br><span class="line">                               rhs=[width])</span><br><span class="line">    pat.objective.set_sense(pat.objective.sense.minimize)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Column generation procedure</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Optimize over current patterns</span></span><br><span class="line">        cut.solve()</span><br><span class="line">        report1(cut)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Find and add new pattern. The objective function of the</span></span><br><span class="line">        <span class="comment"># worker problem is constructed from the dual values of the</span></span><br><span class="line">        <span class="comment"># constraints of the master problem.</span></span><br><span class="line">        price = [-d <span class="keyword">for</span> d <span class="keyword">in</span> cut.solution.get_dual_values(cutcons)]</span><br><span class="line">        pat.objective.set_linear(list(zip(use, price)))</span><br><span class="line">        pat.solve()</span><br><span class="line">        report2(pat, use)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If reduced cost (worker problem objective function value) is</span></span><br><span class="line">        <span class="comment"># non-negative we are optimal. Otherwise we found a new column</span></span><br><span class="line">        <span class="comment"># to be added. Coefficients of the new column are given by the</span></span><br><span class="line">        <span class="comment"># optimal solution vector to the worker problem.</span></span><br><span class="line">        <span class="keyword">if</span> pat.solution.get_objective_value() &gt; -RC_EPS:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        newpat = pat.solution.get_values(use)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The new pattern constitutes a new variable in the cutting</span></span><br><span class="line">        <span class="comment"># optimization problem. Create that variable and add it to all</span></span><br><span class="line">        <span class="comment"># constraints with the coefficients read from the optimal solution</span></span><br><span class="line">        <span class="comment"># of the pattern generation problem.</span></span><br><span class="line">        idx = cut.variables.get_num()</span><br><span class="line">        cut.variables.add(obj=[<span class="number">1.0</span>])</span><br><span class="line">        cut.linear_constraints.set_coefficients(list(zip(cutcons,</span><br><span class="line">                                                         [idx] * len(use),</span><br><span class="line">                                                         newpat)))</span><br><span class="line">        cutvars.append(idx)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Perform a final solve on the cutting optimization problem.</span></span><br><span class="line">    <span class="comment"># Turn all variables into integers before doing that.</span></span><br><span class="line">    cut.variables.set_types(</span><br><span class="line">        list(zip(cutvars, [cut.variables.type.integer] * len(cutvars))))</span><br><span class="line">    cut.solve()</span><br><span class="line">    report3(cut)</span><br><span class="line">    print(<span class="string">"Solution status = "</span>, cut.solution.get_status())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    datafile = <span class="string">"../../../examples/data/cutstock.dat"</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">"Default data file : "</span> + datafile)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        datafile = sys.argv[<span class="number">1</span>]</span><br><span class="line">    cutstock(datafile)</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="è¯»å–é—®é¢˜">è¯»å–é—®é¢˜</h1><figure class="highlight python"><figcaption><span>inputdata.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># File: inputdata.py</span></span><br><span class="line"><span class="comment"># Version 12.9.0</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Licensed Materials - Property of IBM</span></span><br><span class="line"><span class="comment"># 5725-A06 5725-A29 5724-Y48 5724-Y49 5724-Y54 5724-Y55 5655-Y21</span></span><br><span class="line"><span class="comment"># Copyright IBM Corporation 2009, 2019. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># US Government Users Restricted Rights - Use, duplication or</span></span><br><span class="line"><span class="comment"># disclosure restricted by GSA ADP Schedule Contract with</span></span><br><span class="line"><span class="comment"># IBM Corp.</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">"""Utility for reading data from .dat files in examples/data/."""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_words</span><span class="params">(line)</span>:</span></span><br><span class="line">    <span class="string">"""Return a list of the tokens in line."""</span></span><br><span class="line">    line = line.replace(<span class="string">"\t"</span>, <span class="string">" "</span>)</span><br><span class="line">    line = line.replace(<span class="string">"\v"</span>, <span class="string">" "</span>)</span><br><span class="line">    line = line.replace(<span class="string">"\r"</span>, <span class="string">" "</span>)</span><br><span class="line">    line = line.replace(<span class="string">"\n"</span>, <span class="string">" "</span>)</span><br><span class="line">    <span class="keyword">while</span> line.count(<span class="string">"  "</span>):</span><br><span class="line">        line = line.replace(<span class="string">"  "</span>, <span class="string">" "</span>)</span><br><span class="line">    line = line.strip()</span><br><span class="line">    <span class="keyword">return</span> [word + <span class="string">" "</span> <span class="keyword">for</span> word <span class="keyword">in</span> line.split(<span class="string">" "</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_dat_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="string">"""Return a list containing the data stored in the dat file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Single integers or floats are stored as their natural type.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    1-d arrays are stored as lists</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    2-d arrays are stored as lists of lists.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    NOTE: the 2-d arrays are not in the list-of-lists matrix format</span></span><br><span class="line"><span class="string">    that the python methods take as input for constraints.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ret = []</span><br><span class="line">    continuation = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> get_words(line):</span><br><span class="line">                <span class="keyword">if</span> continuation:</span><br><span class="line">                    entity = <span class="string">""</span>.join([entity, word])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    entity = word</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    ret.append(eval(entity))</span><br><span class="line">                    continuation = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">except</span> SyntaxError:</span><br><span class="line">                    continuation = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹é—®é¢˜">ç¤ºä¾‹é—®é¢˜</h1><figure class="highlight plain"><figcaption><span>cutstock.dat</span></figcaption><table><tr><td class="code"><pre><span class="line">115</span><br><span class="line">[25, 40, 50, 55, 70]</span><br><span class="line">[50, 36, 24, 8, 30]</span><br></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹è¿è¡Œç»“æžœ">ç¤ºä¾‹è¿è¡Œç»“æžœ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python cutstock.py</span><br><span class="line">Default data file : ../../../examples/data/cutstock.dat</span><br><span class="line"></span><br><span class="line">Using 76.5 rolls</span><br><span class="line"></span><br><span class="line">  Cut0 = 12.5</span><br><span class="line">  Cut1 = 18.0</span><br><span class="line">  Cut2 = 12.0</span><br><span class="line">  Cut3 = 4.0</span><br><span class="line">  Cut4 = 30.0</span><br><span class="line"></span><br><span class="line">  Fill0 = 0.25</span><br><span class="line">  Fill1 = 0.5</span><br><span class="line">  Fill2 = 0.5</span><br><span class="line">  Fill3 = 0.5</span><br><span class="line">  Fill4 = 1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Reduced cost is -0.5</span><br><span class="line"></span><br><span class="line">  Use0 = 0.0</span><br><span class="line">  Use1 = 1.0</span><br><span class="line">  Use2 = 0.0</span><br><span class="line">  Use3 = 0.0</span><br><span class="line">  Use4 = 1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Using 61.5 rolls</span><br><span class="line"></span><br><span class="line">  Cut0 = 12.5</span><br><span class="line">  Cut1 = 3.0</span><br><span class="line">  Cut2 = 12.0</span><br><span class="line">  Cut3 = 4.0</span><br><span class="line">  Cut4 = 0.0</span><br><span class="line">  Cut5 = 30.0</span><br><span class="line"></span><br><span class="line">  Fill0 = 0.25</span><br><span class="line">  Fill1 = 0.5</span><br><span class="line">  Fill2 = 0.5</span><br><span class="line">  Fill3 = 0.5</span><br><span class="line">  Fill4 = 0.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Reduced cost is -0.25</span><br><span class="line"></span><br><span class="line">  Use0 = 1.0</span><br><span class="line">  Use1 = 2.0</span><br><span class="line">  Use2 = 0.0</span><br><span class="line">  Use3 = 0.0</span><br><span class="line">  Use4 = 0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Using 60.75 rolls</span><br><span class="line"></span><br><span class="line">  Cut0 = 11.75</span><br><span class="line">  Cut1 = 0.0</span><br><span class="line">  Cut2 = 12.0</span><br><span class="line">  Cut3 = 4.0</span><br><span class="line">  Cut4 = 0.0</span><br><span class="line">  Cut5 = 30.0</span><br><span class="line">  Cut6 = 3.0</span><br><span class="line"></span><br><span class="line">  Fill0 = 0.25</span><br><span class="line">  Fill1 = 0.375</span><br><span class="line">  Fill2 = 0.5</span><br><span class="line">  Fill3 = 0.5</span><br><span class="line">  Fill4 = 0.625</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Reduced cost is -0.125</span><br><span class="line"></span><br><span class="line">  Use0 = 3.0</span><br><span class="line">  Use1 = 1.0</span><br><span class="line">  Use2 = 0.0</span><br><span class="line">  Use3 = -0.0</span><br><span class="line">  Use4 = -0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Using 60.0 rolls</span><br><span class="line"></span><br><span class="line">  Cut0 = 8.0</span><br><span class="line">  Cut1 = 0.0</span><br><span class="line">  Cut2 = 12.0</span><br><span class="line">  Cut3 = 4.0</span><br><span class="line">  Cut4 = 0.0</span><br><span class="line">  Cut5 = 30.0</span><br><span class="line">  Cut6 = 0.0</span><br><span class="line">  Cut7 = 6.0</span><br><span class="line"></span><br><span class="line">  Fill0 = 0.25</span><br><span class="line">  Fill1 = 0.25</span><br><span class="line">  Fill2 = 0.5</span><br><span class="line">  Fill3 = 0.5</span><br><span class="line">  Fill4 = 0.75</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Reduced cost is 0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Best integer solution uses 60.0 rolls</span><br><span class="line"></span><br><span class="line">  Cut0 = 8.0</span><br><span class="line">  Cut1 = -0.0</span><br><span class="line">  Cut2 = 12.0</span><br><span class="line">  Cut3 = 4.0</span><br><span class="line">  Cut4 = -0.0</span><br><span class="line">  Cut5 = 30.0</span><br><span class="line">  Cut6 = -0.0</span><br><span class="line">  Cut7 = 6.0</span><br><span class="line">Solution status =  101</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> column generation </tag>
            
            <tag> cplex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èšç±»</title>
      <link href="/notes/introduction-to-ml-with-python/clustering/"/>
      <url>/notes/introduction-to-ml-with-python/clustering/</url>
      
        <content type="html"><![CDATA[<p>èšç±»ï¼ˆclusteringï¼‰æ˜¯å°†æ•°æ®é›†åˆ’åˆ†æˆç»„çš„ä»»åŠ¡ï¼Œè¿™äº›ç»„å«ä½œç°‡ï¼ˆclusterï¼‰ã€‚å…¶ç›®æ ‡æ˜¯åˆ’åˆ†æ•°æ®ï¼Œä½¿å¾—ä¸€ä¸ªç°‡å†…çš„æ•°æ®ç‚¹éžå¸¸ç›¸ä¼¼ä¸”ä¸åŒç°‡å†…çš„æ•°æ®ç‚¹éžå¸¸ä¸åŒã€‚ä¸Žåˆ†ç±»ç®—æ³•ç±»ä¼¼ï¼Œèšç±»ç®—æ³•ä¸ºæ¯ä¸ªæ•°æ®ç‚¹åˆ†é…ï¼ˆæˆ–é¢„æµ‹ï¼‰ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªç‚¹å±žäºŽå“ªä¸ªç°‡ã€‚</p><h1 id="kå‡å€¼èšç±»">kå‡å€¼èšç±»</h1><p>kå‡å€¼èšç±»æ˜¯æœ€ç®€å•ä¹Ÿæœ€å¸¸ç”¨çš„èšç±»ç®—æ³•ä¹‹ä¸€ã€‚å®ƒè¯•å›¾æ‰¾åˆ°ä»£è¡¨æ•°æ®ç‰¹å®šåŒºåŸŸçš„<strong>ç°‡ä¸­å¿ƒ</strong>ï¼ˆcluster centerï¼‰ã€‚ç®—æ³•äº¤æ›¿æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼šå°†æ¯ä¸ªæ•°æ®ç‚¹åˆ†é…ç»™æœ€è¿‘çš„ç°‡ä¸­å¿ƒï¼Œç„¶åŽå°†æ¯ä¸ªç°‡ä¸­å¿ƒè®¾ç½®ä¸ºæ‰€åˆ†é…çš„æ‰€æœ‰æ•°æ®ç‚¹çš„å¹³å‡å€¼ã€‚å¦‚æžœç°‡çš„åˆ†é…ä¸å†å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç®—æ³•ç»“æŸã€‚ä¸‹é¢çš„ä¾‹å­åœ¨ä¸€ä¸ªæ¨¡æ‹Ÿæ•°æ®é›†ä¸Šå¯¹è¿™ä¸€ç®—æ³•è¿›è¡Œè¯´æ˜Žã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_kmeans_algorithm()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-algorithm.png"></p><a id="more"></a><p>ç°‡ä¸­å¿ƒç”¨ä¸‰è§’å½¢è¡¨ç¤ºï¼Œè€Œæ•°æ®ç‚¹ç”¨åœ†å½¢è¡¨ç¤ºã€‚é¢œè‰²è¡¨ç¤ºç°‡æˆå‘˜ã€‚æˆ‘ä»¬æŒ‡å®šè¦å¯»æ‰¾ä¸‰ä¸ªç°‡ï¼Œæ‰€ä»¥é€šè¿‡å£°æ˜Žä¸‰ä¸ªéšæœºæ•°æ®ç‚¹ä¸ºç°‡ä¸­å¿ƒæ¥å°†ç®—æ³•åˆå§‹åŒ–ã€‚ç„¶åŽå¼€å§‹è¿­ä»£ç®—æ³•ã€‚é¦–å…ˆæ¯ä¸ªæ•°æ®ç‚¹è¢«åˆ†é…ç»™è·ç¦»æœ€è¿‘çš„ç°‡ä¸­å¿ƒã€‚æŽ¥ä¸‹æ¥ï¼Œå°†ç°‡ä¸­å¿ƒä¿®æ”¹ä¸ºæ‰€åˆ†é…ç‚¹çš„å¹³å‡å€¼ã€‚ç„¶åŽå°†è¿™ä¸€è¿‡ç¨‹å†é‡å¤ä¸¤æ¬¡ã€‚åœ¨ç¬¬ä¸‰æ¬¡è¿­ä»£ä¹‹åŽï¼Œä¸ºç°‡ä¸­å¿ƒåˆ†é…çš„æ•°æ®ç‚¹ä¿æŒä¸å˜ï¼Œå› æ­¤ç®—æ³•ç»“æŸã€‚</p><p>ç»™å®šæ–°çš„æ•°æ®ç‚¹ï¼Œkå‡å€¼ä¼šå°†å…¶åˆ†é…ç»™æœ€è¿‘çš„ç°‡ä¸­å¿ƒã€‚ä¸‹ä¸€ä¾‹å­å±•ç¤ºäº†å­¦åˆ°çš„ç°‡ä¸­å¿ƒçš„è¾¹ç•Œã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_kmeans_boundaries()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-boundaries.png"></p><p>ç”¨<code>scikit-learn</code>åº”ç”¨kå‡å€¼ç›¸å½“ç®€å•ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.cluster.kmeans" target="_blank" rel="noopener"><code>class sklearn.cluster.KMeans(n_clusters=8, init=â€™k-means++â€™, n_init=10, max_iter=300, tol=0.0001, precompute_distances=â€™autoâ€™, verbose=0, random_state=None, copy_x=True, n_jobs=None, algorithm=â€™autoâ€™)</code></a></p><p>K-Means clustering</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆæ¨¡æ‹Ÿçš„äºŒç»´æ•°æ®</span></span><br><span class="line">X, y = make_blobs(random_state=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># æž„å»ºèšç±»æ¨¡åž‹</span></span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">3</span>)</span><br><span class="line">kmeans.fit(X)</span><br><span class="line">print(<span class="string">'Cluster memberships:\n&#123;&#125;'</span>.format(kmeans.labels_))</span><br><span class="line"><span class="comment"># å¯¹è®­ç»ƒé›†è¿è¡Œpredictä¼šè¿”å›žä¸Žlabels_ç›¸åŒçš„ç»“æžœ</span></span><br><span class="line">print(kmeans.predict(X))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cluster memberships:</span><br><span class="line">[0 2 2 2 1 1 1 2 0 0 2 2 1 0 1 1 1 0 2 2 1 2 1 0 2 1 1 0 0 1 0 0 1 0 2 1 2</span><br><span class="line"> 2 2 1 1 2 0 2 2 1 0 0 0 0 2 1 1 1 0 1 2 2 0 0 2 1 1 2 2 1 0 1 0 2 2 2 1 0</span><br><span class="line"> 0 2 1 1 0 2 0 2 2 1 0 0 0 0 2 0 1 0 0 2 2 1 1 0 1 0]</span><br><span class="line">[0 2 2 2 1 1 1 2 0 0 2 2 1 0 1 1 1 0 2 2 1 2 1 0 2 1 1 0 0 1 0 0 1 0 2 1 2</span><br><span class="line"> 2 2 1 1 2 0 2 2 1 0 0 0 0 2 1 1 1 0 1 2 2 0 0 2 1 1 2 2 1 0 1 0 2 2 2 1 0</span><br><span class="line"> 0 2 1 1 0 2 0 2 2 1 0 0 0 0 2 0 1 0 0 2 2 1 1 0 1 0]</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¦ä»¬è¦æ‰¾çš„æ˜¯3ä¸ªç°‡ï¼Œæ‰€æœ‰ç°‡çš„ç¼–å·æ˜¯0åˆ°2ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨predictæ–¹æ³•ä¸ºæ–°æ•°æ®ç‚¹åˆ†é…æ ‡ç­¾ã€‚é¢„æµ‹æ—¶ä¼šå°†æœ€è¿‘çš„ç°‡ä¸­å¿ƒåˆ†é…ä¸ªæ¯ä¸ªæ–°æ•°æ®ç‚¹ï¼Œä½†çŽ°æœ‰æ¨¡åž‹ä¸ä¼šæ”¹å˜ï¼ˆå³ä¸ä¼šæ›´æ–°ç°‡ä¸­å¿ƒçš„ä½ç½®ï¼‰ã€‚</p><p>ä¸Žåˆ†ç±»ç®—æ³•ç±»ä¼¼ï¼Œèšç±»ç®—æ³•çš„æ¯ä¸ªå…ƒç´ ä¹Ÿæœ‰ä¸€ä¸ªæ ‡ç­¾ã€‚ä½†å¹¶ä¸å­˜åœ¨çœŸå®žçš„æ ‡ç­¾ï¼Œå› æ­¤æ ‡ç­¾æœ¬èº«å¹¶æ²¡æœ‰<strong>å…ˆéªŒ</strong>æ„ä¹‰ã€‚å›žåˆ°äººè„¸å›¾åƒèšç±»çš„ä¾‹å­ã€‚èšç±»çš„ç»“æžœå¯èƒ½æ˜¯ï¼Œç®—æ³•æ‰¾åˆ°çš„ç¬¬3ä¸ªç°‡ä»…åŒ…å«ä½ æœ‹å‹Belaçš„é¢å­”ã€‚ä½†åªæœ‰åœ¨æŸ¥çœ‹å›¾ç‰‡ä¹‹åŽæ‰èƒ½çŸ¥é“è¿™ä¸€ç‚¹ï¼Œè€Œä¸”æ•°å­—3æ˜¯ä»»æ„çš„ã€‚ç®—æ³•ç»™ä½ çš„å”¯ä¸€ä¿¡æ¯å°±æ˜¯æ‰€æœ‰æ ‡ç­¾ä¸º3çš„äººè„¸éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚</p><p>å¯¹äºŽæˆ‘ä»¬åˆšåˆšåœ¨äºŒç»´çŽ©å…·æ•°æ®é›†ä¸Šè¿è¡Œçš„èšç±»ç®—æ³•ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸åº”è¯¥ä¸ºå…¶ä¸­ä¸€ç»„çš„æ ‡ç­¾æ˜¯0ã€å¦ä¸€ç»„çš„æ ‡ç­¾æ˜¯1è¿™ä¸€äº‹å®žèµ‹äºˆä»»ä½•æ„ä¹‰ã€‚å†æ¬¡è¿è¡Œè¯¥ç®—æ³•å¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„ç°‡ç¼–å·ï¼ŒåŽŸå› åœ¨äºŽåˆå§‹åŒ–çš„éšæœºæ€§è´¨ã€‚</p><p>ä¸‹é¢åˆç»™å‡ºäº†è¿™ä¸ªæ•°æ®çš„å›¾åƒã€‚ç°‡ä¸­å¿ƒè¢«ä¿å­˜åœ¨<code>cluster_centers_</code>å±žæ€§ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸‰è§’å½¢è¡¨ç¤ºå®ƒä»¬ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], kmeans.labels_, markers=<span class="string">'o'</span>)</span><br><span class="line">mglearn.discrete_scatter(kmeans.cluster_centers_[:, <span class="number">0</span>],</span><br><span class="line">    kmeans.cluster_centers_[:, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], markers=<span class="string">'^'</span>, markeredgewidth=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-cluster-centers.png"></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´å¤šæˆ–æ›´å°‘çš„ç°‡ä¸­å¿ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">10</span>, <span class="number">5</span>))</span><br><span class="line"><span class="comment"># ä½¿ç”¨2ä¸ªç°‡ä¸­å¿ƒ</span></span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">2</span>)</span><br><span class="line">kmeans.fit(X)</span><br><span class="line">assignments = kmeans.labels_</span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], assignments, ax=axes[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># ä½¿ç”¨5ä¸ªç°‡ä¸­å¿ƒ</span></span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">5</span>)</span><br><span class="line">kmeans.fit(X)</span><br><span class="line">assignments = kmeans.labels_</span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], assignments, ax=axes[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-more-or-less-cluster-centers.png"></p><h2 id="kå‡å€¼çš„å¤±è´¥æ¡ˆä¾‹">kå‡å€¼çš„å¤±è´¥æ¡ˆä¾‹</h2><p>å³ä½¿ä½ çŸ¥é“ç»™å®šæ•°æ®é›†ä¸­ç°‡çš„â€œæ­£ç¡®â€ä¸ªæ•°ï¼Œkå‡å€¼å¯èƒ½ä¹Ÿä¸æ˜¯æ€»èƒ½æ‰¾åˆ°å®ƒä»¬ã€‚<strong>æ¯ä¸ªç°‡ä»…æœ‰å…¶ä¸­å¿ƒå®šä¹‰ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªç°‡éƒ½æ˜¯å‡¸å½¢ï¼ˆconvexï¼‰ã€‚å› æ­¤ï¼Œkå‡å€¼åªèƒ½æ‰¾åˆ°ç›¸å¯¹ç®€å•çš„å½¢çŠ¶ã€‚</strong>kå‡å€¼è¿˜å‡è®¾æ‰€æœ‰ç°‡åœ¨æŸç§ç¨‹åº¦ä¸Šå…·æœ‰ç›¸åŒçš„â€œç›´å¾„â€ï¼Œå®ƒæ€»æ˜¯å°†ç°‡ä¹‹é—´çš„è¾¹ç•Œåˆšå¥½ç”»åœ¨ç°‡ä¸­å¿ƒçš„ä¸­é—´ä½ç½®ã€‚æœ‰æ—¶è¿™ä¼šå¯¼è‡´ä»¤äººæƒŠè®¶çš„ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_varied, y_varied = make_blobs(n_samples=<span class="number">200</span>, cluster_std=[<span class="number">1.0</span>, <span class="number">2.5</span>, <span class="number">0.5</span>],</span><br><span class="line">    random_state=<span class="number">170</span>)</span><br><span class="line">y_pred = KMeans(n_clusters=<span class="number">3</span>, random_state=<span class="number">0</span>).fit_predict(X_varied)</span><br><span class="line"></span><br><span class="line">mglearn.discrete_scatter(X_varied[:, <span class="number">0</span>], X_varied[:, <span class="number">1</span>], y_pred)</span><br><span class="line">plt.legend([<span class="string">'cluster 0'</span>, <span class="string">'cluster 1'</span>, <span class="string">'cluster 2'</span>], loc=<span class="string">'best'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-different-density.png"></p><p>ä½ å¯èƒ½ä¼šè®¤ä¸ºï¼Œå·¦ä¸‹æ–¹çš„å¯†é›†åŒºåŸŸæ˜¯ç¬¬ä¸€ä¸ªç°‡ï¼Œå³ä¸Šæ–¹çš„å¯†é›†åŒºåŸŸæ˜¯ç¬¬äºŒä¸ªï¼Œä¸­é—´å¯†åº¦è¾ƒå°çš„åŒºåŸŸæ˜¯ç¬¬ä¸‰ä¸ªã€‚ä½†äº‹å®žä¸Šï¼Œç°‡0å’Œç°‡1éƒ½åŒ…å«ä¸€äº›è¿œç¦»ç°‡ä¸­å…¶ä»–ç‚¹çš„ç‚¹ã€‚</p><p>kå‡å€¼è¿˜å‡è®¾æ‰€æœ‰æ–¹å‘å¯¹æ¯ä¸ªç°‡éƒ½åŒç­‰é‡è¦ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªäºŒç»´æ•°æ®é›†ï¼Œæ•°æ®ä¸­åŒ…å«æ˜Žç¡®åˆ†å¼€çš„ä¸‰éƒ¨åˆ†ã€‚ä½†æ˜¯è¿™ä¸‰éƒ¨åˆ†è¢«æ²¿ç€å¯¹è§’çº¿æ–¹å‘æ‹‰é•¿ã€‚ç”±äºŽkå‡å€¼ä»…è€ƒè™‘åˆ°æœ€è¿‘ç°‡ä¸­å¿ƒçš„è·ç¦»ï¼Œæ‰€ä»¥å®ƒæ— æ³•å¤„ç†è¿™ç§ç±»åž‹çš„æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆä¸€äº›éšæœºåˆ†ç»„æ•°æ®</span></span><br><span class="line">X, y = make_blobs(random_state=<span class="number">170</span>, n_samples=<span class="number">600</span>)</span><br><span class="line">rng = np.random.RandomState(<span class="number">74</span>)</span><br><span class="line"><span class="comment"># å˜æ¢æ•°æ®ä½¿å…¶æ‹‰é•¿</span></span><br><span class="line">transformation = rng.normal(size=(<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">X = np.dot(X, transformation)</span><br><span class="line"><span class="comment"># å°†æ•°æ®èšç±»æˆ3ä¸ªç°‡</span></span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">3</span>)</span><br><span class="line">kmeans.fit(X)</span><br><span class="line">y_pred = kmeans.predict(X)</span><br><span class="line"><span class="comment"># ç”»å‡ºç°‡åˆ†é…å’Œç°‡ä¸­å¿ƒ</span></span><br><span class="line">plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=y_pred, cmap=mglearn.cm3)</span><br><span class="line">plt.scatter(kmeans.cluster_centers_[:, <span class="number">0</span>], kmeans.cluster_centers_[:, <span class="number">1</span>],</span><br><span class="line">    marker=<span class="string">'^'</span>, c=[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], s=<span class="number">100</span>, linewidth=<span class="number">2</span>, cmap=mglearn.cm3)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-aspherical.png"></p><p>å¦‚æžœç°‡çš„å½¢çŠ¶æ›´åŠ å¤æ‚ï¼Œé‚£ä¹ˆkå‡å€¼çš„è¡¨çŽ°ä¹Ÿå¾ˆå·®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆæ¨¡æ‹Ÿçš„two_moonsæ•°æ®</span></span><br><span class="line">X, y = make_moons(n_samples=<span class="number">200</span>, noise=<span class="number">0.05</span>, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># å°†æ•°æ®èšç±»æˆ2ä¸ªç°‡</span></span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">2</span>)</span><br><span class="line">kmeans.fit(X)</span><br><span class="line">y_pred = kmeans.predict(X)</span><br><span class="line"><span class="comment"># ç”»å‡ºç°‡åˆ†é…å’Œç°‡ä¸­å¿ƒ</span></span><br><span class="line">plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=y_pred, cmap=mglearn.cm3, s=<span class="number">60</span>)</span><br><span class="line">plt.scatter(kmeans.cluster_centers_[:, <span class="number">0</span>], kmeans.cluster_centers_[:, <span class="number">1</span>],</span><br><span class="line">    marker=<span class="string">'^'</span>, c=[mglearn.cm2(<span class="number">0</span>), mglearn.cm2(<span class="number">1</span>)], s=<span class="number">100</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-on-two-moons.png"></p><p>è¿™é‡Œæˆ‘ä»¬å¸Œæœ›èšç±»ç®—æ³•èƒ½å¤Ÿå‘çŽ°ä¸¤ä¸ªåŠæœˆå½¢ã€‚ä½†åˆ©ç”¨kå‡å€¼ç®—æ³•æ˜¯ä¸å¯èƒ½åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚</p><h2 id="çŸ¢é‡é‡åŒ–æˆ–è€…å°†kå‡å€¼çœ‹ä½œåˆ†è§£">çŸ¢é‡é‡åŒ–ï¼Œæˆ–è€…å°†kå‡å€¼çœ‹ä½œåˆ†è§£</h2><p>è™½ç„¶kå‡å€¼æ˜¯ä¸€ç§èšç±»ç®—æ³•ï¼Œä½†åœ¨kå‡å€¼å’Œåˆ†è§£æ–¹æ³•ï¼ˆæ¯”å¦‚PCAå’ŒNMFï¼‰ä¹‹é—´å­˜åœ¨ä¸€äº›æœ‰è¶£çš„ç›¸ä¼¼ä¹‹å¤„ã€‚PCAè¯•å›¾æ‰¾åˆ°æ•°æ®ä¸­æ–¹å·®æœ€å¤§çš„æ–¹å‘ï¼Œè€ŒNMFè¯•å›¾æ‰¾åˆ°ç´¯åŠ çš„åˆ†é‡ï¼Œè¿™é€šå¸¸å¯¹åº”äºŽæ•°æ®çš„â€œæžå€¼â€æˆ–â€œéƒ¨åˆ†â€ã€‚ä¸¤ç§æ–¹æ³•éƒ½è¯•å›¾å°†æ•°æ®ç‚¹è¡¨ç¤ºä¸ºä¸€äº›åˆ†é‡ä¹‹å’Œã€‚ä¸Žä¹‹ç›¸åï¼Œkå‡å€¼åˆ™å°è¯•åˆ©ç”¨ç°‡ä¸­å¿ƒæ¥è¡¨ç¤ºæ¯ä¸ªæ•°æ®ç‚¹ã€‚ä½ å¯ä»¥å°†å…¶çœ‹ä½œä»…ç”¨ä¸€ä¸ªåˆ†é‡æ¥è¡¨ç¤ºæ¯ä¸ªæ•°æ®ç‚¹ï¼Œè¯¥åˆ†é‡ç”±ç°‡ä¸­å¿ƒç»™å‡ºã€‚è¿™ç§è§‚ç‚¹å°†kå‡å€¼çœ‹ä½œæ˜¯ä¸€ç§åˆ†è§£æ–¹æ³•ï¼Œå…¶ä¸­æ¯ä¸ªç‚¹ç”¨å•ä¸€åˆ†é‡æ¥è¡¨ç¤ºï¼Œè¿™ç§è§‚ç‚¹è¢«ç§°ä¸º<strong>çŸ¢é‡é‡åŒ–</strong>ï¼ˆvector quantizationï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥å¹¶æŽ’æ¯”è¾ƒPCAã€NMFå’Œkå‡å€¼ï¼Œåˆ†åˆ«æ˜¾ç¤ºæå–çš„åˆ†é‡ï¼Œä»¥åŠåˆ©ç”¨100ä¸ªåˆ†é‡å¯¹æµ‹è¯•é›†ä¸­äººè„¸çš„é‡å»ºã€‚å¯¹äºŽkå‡å€¼ï¼Œé‡å»ºå°±æ˜¯åœ¨è®­ç»ƒé›†ä¸­æ‰¾åˆ°æœ€è¿‘çš„ç°‡ä¸­å¿ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    X_people, y_people, stratify=y_people, random_state=<span class="number">0</span>)</span><br><span class="line">nmf = NMF(n_components=<span class="number">100</span>, random_state=<span class="number">0</span>)</span><br><span class="line">nmf.fit(X_train)</span><br><span class="line">pca = PCA(n_components=<span class="number">100</span>, random_state=<span class="number">0</span>)</span><br><span class="line">pca.fit(X_train)</span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">100</span>, random_state=<span class="number">0</span>)</span><br><span class="line">kmeans.fit(X_train)</span><br><span class="line"></span><br><span class="line">X_reconstructed_pca = pca.inverse_transform(pca.transform(X_test))</span><br><span class="line">X_reconstructed_nmf = np.dot(nmf.transform(X_test), nmf.components_)</span><br><span class="line">X_reconstructed_kmeans = kmeans.cluster_centers_[kmeans.predict(X_test)]</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">3</span>, <span class="number">5</span>, figsize=(<span class="number">8</span>, <span class="number">8</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line">fig.suptitle(<span class="string">'Extracted Components'</span>)</span><br><span class="line"><span class="keyword">for</span> ax, comp_kmeans, comp_pca, comp_nmf <span class="keyword">in</span> zip(</span><br><span class="line">    axes.T, kmeans.cluster_centers_, pca.components_, nmf.components_):</span><br><span class="line">    ax[<span class="number">0</span>].imshow(comp_kmeans.reshape(image_shape))</span><br><span class="line">    ax[<span class="number">1</span>].imshow(comp_pca.reshape(image_shape), cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    ax[<span class="number">2</span>].imshow(comp_nmf.reshape(image_shape))</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">0</span>].set_ylabel(<span class="string">'kmeas'</span>)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">0</span>].set_ylabel(<span class="string">'pca'</span>)</span><br><span class="line">axes[<span class="number">2</span>, <span class="number">0</span>].set_ylabel(<span class="string">'nmf'</span>)</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">4</span>, <span class="number">5</span>, figsize=(<span class="number">8</span>, <span class="number">8</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line">fig.suptitle(<span class="string">'Reconstructions'</span>)</span><br><span class="line"><span class="keyword">for</span> ax, org, rec_kmeans, rec_pca, rec_nmf <span class="keyword">in</span> zip(axes.T, X_test,</span><br><span class="line">    X_reconstructed_kmeans, X_reconstructed_pca, X_reconstructed_nmf):</span><br><span class="line">    ax[<span class="number">0</span>].imshow(org.reshape(image_shape))</span><br><span class="line">    ax[<span class="number">1</span>].imshow(rec_kmeans.reshape(image_shape))</span><br><span class="line">    ax[<span class="number">2</span>].imshow(rec_pca.reshape(image_shape))</span><br><span class="line">    ax[<span class="number">3</span>].imshow(rec_nmf.reshape(image_shape))</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">0</span>].set_ylabel(<span class="string">'original'</span>)</span><br><span class="line">axes[<span class="number">1</span>, <span class="number">0</span>].set_ylabel(<span class="string">'kmeas'</span>)</span><br><span class="line">axes[<span class="number">2</span>, <span class="number">0</span>].set_ylabel(<span class="string">'pca'</span>)</span><br><span class="line">axes[<span class="number">3</span>, <span class="number">0</span>].set_ylabel(<span class="string">'nmf'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-pca-nmf-extract-components.png"></p><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-pca-nmf-reconstructions.png"></p><p><strong>åˆ©ç”¨kå‡å€¼åšçŸ¢é‡é‡åŒ–çš„ä¸€ä¸ªæœ‰è¶£ä¹‹å¤„åœ¨äºŽï¼Œå¯ä»¥ç”¨æ¯”è¾“å…¥ç»´åº¦æ›´å¤šçš„ç°‡æ¥å¯¹æ•°æ®è¿›è¡Œç¼–ç </strong>è®©æˆ‘ä»¬å›žåˆ°<code>two_moons</code>æ•°æ®ã€‚åˆ©ç”¨PCAæˆ–NMFï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªæ•°æ®æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸¤ä¸ªç»´åº¦ã€‚ä½¿ç”¨PCAæˆ–NMFå°†å…¶é™åˆ°ä¸€ç»´ï¼Œå°†ä¼šå®Œå…¨ç ´åæ•°æ®çš„ç»“æž„ã€‚ä½†é€šè¿‡ä½¿ç”¨æ›´å¤šçš„ç°‡ä¸­å¿ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨kå‡å€¼æ‰¾åˆ°ä¸€ç§æ›´å…·è¡¨çŽ°åŠ›çš„è¡¨ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = make_moons(n_samples=<span class="number">200</span>, noise=<span class="number">0.05</span>, random_state=<span class="number">0</span>)</span><br><span class="line">kmeans = KMeans(n_clusters=<span class="number">10</span>, random_state=<span class="number">0</span>)</span><br><span class="line">kmeans.fit(X)</span><br><span class="line">y_pred = kmeans.predict(X)</span><br><span class="line"></span><br><span class="line">plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=y_pred, s=<span class="number">60</span>, cmap=<span class="string">'Paired'</span>)</span><br><span class="line">plt.scatter(kmeans.cluster_centers_[:, <span class="number">0</span>], kmeans.cluster_centers_[:, <span class="number">1</span>],</span><br><span class="line">    s=<span class="number">60</span>, marker=<span class="string">'^'</span>, c=range(kmeans.n_clusters), linewidth=<span class="number">2</span>, cmap=<span class="string">'Paired'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">print(<span class="string">'Cluster memberships:\n&#123;&#125;'</span>.format(y_pred))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cluster memberships:</span><br><span class="line">[9 2 5 4 2 7 9 6 9 6 1 0 2 6 1 9 3 0 3 1 7 6 8 6 8 5 2 7 5 8 9 8 6 5 3 7 0</span><br><span class="line"> 9 4 5 0 1 3 5 2 8 9 1 5 6 1 0 7 4 6 3 3 6 3 8 0 4 2 9 6 4 8 2 8 4 0 4 0 5</span><br><span class="line"> 6 4 5 9 3 0 7 8 0 7 5 8 9 8 0 7 3 9 7 1 7 2 2 0 4 5 6 7 8 9 4 5 4 1 2 3 1</span><br><span class="line"> 8 8 4 9 2 3 7 0 9 9 1 5 8 5 1 9 5 6 7 9 1 4 0 6 2 6 4 7 9 5 5 3 8 1 9 5 6</span><br><span class="line"> 3 5 0 2 9 3 0 8 6 0 3 3 5 6 3 2 0 2 3 0 2 6 3 4 4 1 5 6 7 1 1 3 2 4 7 2 7</span><br><span class="line"> 3 8 6 4 1 4 3 9 9 5 1 7 5 8 2]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-on-two-moons-10-centers.png"></p><p>æˆ‘ä»¬ä½¿ç”¨äº†10ä¸ªç°‡ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒçŽ°åœ¨æ¯ä¸ªç‚¹éƒ½è¢«åˆ†é…äº†0åˆ°9ä¹‹é—´çš„ä¸€ä¸ªæ•°å­—ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶çœ‹ä½œ10ä¸ªåˆ†é‡è¡¨ç¤ºçš„æ•°æ®ï¼ˆæˆ‘ä»¬æœ‰æ˜¯10ä¸ªæ–°ç‰¹å¾ï¼‰ï¼Œåªæœ‰è¡¨ç¤ºè¯¥ç‚¹å¯¹åº”çš„ç°‡ä¸­å¿ƒçš„é‚£ä¸ªç‰¹å¾ä¸ä¸º0ï¼Œå…¶ä»–ç‰¹å¾å‡ä¸º0ã€‚åˆ©ç”¨è¿™ä¸ª10ç»´è¡¨ç¤ºï¼ŒçŽ°åœ¨å¯ä»¥ç”¨çº¿æ€§æ¨¡åž‹æ¥åˆ’åˆ†ä¸¤ä¸ªåŠæœˆå½¢ï¼Œè€Œåˆ©ç”¨åŽŸå§‹çš„ä¸¤ä¸ªç‰¹å¾æ˜¯ä¸å¯èƒ½åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚å°†åˆ°æ¯ä¸ªç°‡ä¸­å¿ƒçš„è·ç¦»ä½œä¸ºç‰¹å¾ï¼Œè¿˜å¯ä»¥å¾—åˆ°ä¸€ç§è¡¨çŽ°åŠ›æ›´å¼ºçš„æ•°æ®è¡¨ç¤ºã€‚å¯ä»¥åˆ©ç”¨kmeansçš„transformæ–¹æ³•æ¥å®Œæˆè¿™ä¸€ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">distance_features = kmeans.transform(X)</span><br><span class="line">print(<span class="string">'Distance feature shape: &#123;&#125;'</span>.format(distance_features.shape))</span><br><span class="line">print(<span class="string">'Distance features:\n&#123;&#125;'</span>.format(distance_features))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Distance feature shape: (200, 10)</span><br><span class="line">Distance features:</span><br><span class="line">[[0.9220768  1.46553151 1.13956805 ... 1.16559918 1.03852189 0.23340263]</span><br><span class="line"> [1.14159679 2.51721597 0.1199124  ... 0.70700803 2.20414144 0.98271691]</span><br><span class="line"> [0.78786246 0.77354687 1.74914157 ... 1.97061341 0.71561277 0.94399739]</span><br><span class="line"> ...</span><br><span class="line"> [0.44639122 1.10631579 1.48991975 ... 1.79125448 1.03195812 0.81205971]</span><br><span class="line"> [1.38951924 0.79790385 1.98056306 ... 1.97788956 0.23892095 1.05774337]</span><br><span class="line"> [1.14920754 2.4536383  0.04506731 ... 0.57163262 2.11331394 0.88166689]]</span><br></pre></td></tr></table></figure><p>kå‡å€¼æ˜¯éžå¸¸æµè¡Œçš„èšç±»ç®—æ³•ï¼Œå› ä¸ºå®ƒä¸ä»…ç›¸å¯¹å®¹æ˜“ç†è§£å’Œå®žçŽ°ï¼Œè€Œä¸”è¿è¡Œé€Ÿåº¦ä¹Ÿç›¸å¯¹è¾ƒå¿«ã€‚kå‡å€¼å¯ä»¥è½»æ¾æ‰©å±•åˆ°å¤§åž‹æ•°æ®é›†ï¼Œ<code>scikit-learn</code>ç”šè‡³åœ¨<code>MiniBatchKMeans</code>ç±»ä¸­åŒ…å«äº†ä¸€ç§æ›´å…·æ‰©å±•æ€§çš„å˜ä½“ï¼Œå¯ä»¥å¤„ç†éžå¸¸å¤§çš„æ•°æ®é›†ã€‚</p><p>kå‡å€¼çš„ç¼ºç‚¹ä¹‹ä¸€åœ¨äºŽï¼Œå®ƒä¾èµ–äºŽéšæœºåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç®—æ³•çš„è¾“å‡ºä¾èµ–äºŽéšæœºç§å­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>scikit-learn</code>ç”¨10ç§ä¸åŒçš„éšæœºåˆå§‹åŒ–å°†ç®—æ³•è¿è¡Œ10æ¬¡ï¼Œå¹¶è¿”å›žæœ€ä½³ï¼ˆç°‡çš„æ–¹å·®ä¹‹å’Œæœ€å°ï¼‰ç»“æžœã€‚kå‡å€¼è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å¯¹ç°‡å½¢çŠ¶çš„å‡è®¾çš„çº¦æŸæ€§è¾ƒå¼ºï¼Œè€Œä¸”è¿˜è¦æ±‚æŒ‡å®šæ‰€è¦å¯»æ‰¾çš„ç°‡çš„ä¸ªæ•°ï¼ˆåœ¨çŽ°å®žä¸–ç•Œçš„åº”ç”¨ä¸­å¯èƒ½å¹¶ä¸çŸ¥é“è¿™ä¸ªæ•°å­—ï¼‰ã€‚</p><p>æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦å¤–ä¸¤ç§èšç±»ç®—æ³•ï¼Œå®ƒä»¬éƒ½åœ¨æŸäº›æ–¹é¢å¯¹è¿™äº›æ€§è´¨åšäº†æ”¹è¿›ã€‚</p><h1 id="å‡èšèšç±»">å‡èšèšç±»</h1><p>å‡èšèšç±»ï¼ˆagglomerative clusteringï¼‰æŒ‡çš„æ˜¯è®¸å¤šåŸºäºŽç›¸åŒåŽŸåˆ™æž„å»ºçš„èšç±»ç®—æ³•ï¼Œè¿™ä¸€åŽŸåˆ™æ˜¯ï¼šç®—æ³•é¦–å…ˆå£°æ˜Žæ¯ä¸ªç‚¹æ˜¯è‡ªå·±çš„ç°‡ï¼Œç„¶åŽåˆå¹¶ä¸¤ä¸ªæœ€ç›¸ä¼¼çš„ç°‡ï¼Œç›´åˆ°æ»¡è¶³æŸç§åœæ­¢å‡†åˆ™ä¸ºæ­¢ã€‚<code>scikit-learn</code>ä¸­å®žçŽ°çš„åœæ­¢å‡†åˆ™æ˜¯ç°‡çš„ä¸ªæ•°ï¼Œå› æ­¤ç›¸ä¼¼çš„ç°‡è¢«åˆå¹¶ï¼Œç›´åˆ°ä»…å‰©ä¸‹æŒ‡å®šä¸ªæ•°çš„ç°‡ã€‚è¿˜æœ‰ä¸€äº›é“¾æŽ¥ï¼ˆlinkageï¼‰å‡†åˆ™ï¼Œè§„å®šå¦‚ä½•åº¦é‡â€œæœ€ç›¸ä¼¼çš„ç°‡â€ã€‚è¿™ç§åº¦é‡æ€»æ˜¯å®šä¹‰åœ¨ä¸¤ä¸ªçŽ°æœ‰çš„ç°‡ä¹‹é—´ã€‚</p><p><code>scikit-learn</code>ä¸­å®žçŽ°äº†ä»¥ä¸‹ä¸‰ç§é€‰é¡¹ã€‚</p><ul><li><p>ward</p><p>é»˜è®¤é€‰é¡¹ã€‚wardæŒ‘é€‰ä¸¤ä¸ªç°‡æ¥åˆå¹¶ï¼Œä½¿å¾—æ‰€æœ‰ç°‡ä¸­çš„æ–¹å·®å¢žåŠ æœ€å°ã€‚è¿™é€šå¸¸ä¼šå¾—åˆ°å¤§å°å·®ä¸å¤šç›¸ç­‰çš„ç°‡ã€‚</p></li><li><p>average</p><p>averageé“¾æŽ¥å°†ç°‡ä¸­æ‰€æœ‰ç‚¹ä¹‹é—´å¹³å‡è·ç¦»æœ€å°çš„ä¸¤ä¸ªç°‡åˆå¹¶ã€‚</p></li><li><p>complete</p><p>completeé“¾æŽ¥ï¼ˆä¹Ÿç§°ä¸ºæœ€å¤§é“¾æŽ¥ï¼‰å°†ç°‡ä¸­ç‚¹ä¹‹é—´æœ€å¤§è·ç¦»æœ€å°çš„ä¸¤ä¸ªç°‡åˆå¹¶ã€‚</p></li></ul><p>wardé€‚ç”¨äºŽå¤§å¤šæ•°æ•°æ®é›†ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å°†ä½¿ç”¨å®ƒã€‚å¦‚æžœç°‡ä¸­çš„æˆå‘˜ä¸ªæ•°éžå¸¸ä¸åŒï¼ˆæ¯”å¦‚å…¶ä¸­ä¸€ä¸ªæ¯”å…¶ä»–æ‰€æœ‰éƒ½å¤§å¾—å¤šï¼‰ï¼Œé‚£ä¹ˆaverageæˆ–completeå¯èƒ½æ•ˆæžœæ›´å¥½ã€‚</p><p>ä¸‹å›¾ç»™å‡ºäº†åœ¨ä¸€ä¸ªäºŒç»´æ•°æ®é›†ä¸Šçš„å‡èšèšç±»è¿‡ç¨‹ï¼Œè¦å¯»æ‰¾ä¸‰ä¸ªç°‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_agglomerative_algorithm()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/agglomerative-algorithm.png"></p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‡èšèšç±»å¯¹ç®€å•ä¸‰ç°‡æ•°æ®çš„æ•ˆæžœå¦‚ä½•ã€‚ç”±äºŽç®—æ³•çš„å·¥ä½œåŽŸç†ï¼Œå‡èšç®—æ³•ä¸èƒ½å¯¹æ–°æ•°æ®ç‚¹ä½œå‡ºé¢„æµ‹ã€‚å› æ­¤<code>AgglomerativeClustering</code>æ²¡æœ‰predictæ–¹æ³•ã€‚ä¸ºäº†æž„é€ æ¨¡åž‹å¹¶å¾—åˆ°è®­ç»ƒé›†ä¸Šç°‡çš„æˆå‘˜è¡¨ç¤ºï¼Œå¯ä»¥æ”¹ç”¨<code>fit_predict</code>æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨<code>labels_</code>å±žæ€§ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.cluster.agglomerativeclustering" target="_blank" rel="noopener"><code>class sklearn.cluster.AgglomerativeClustering(n_clusters=2, affinity=â€™euclideanâ€™, memory=None, connectivity=None, compute_full_tree=â€™autoâ€™, linkage=â€™wardâ€™, pooling_func=â€™deprecatedâ€™)</code></a></p><p>Agglomerative Clustering</p><p>Recursively merges the pair of clusters that minimally increases a given linkage distance.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> AgglomerativeClustering</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(random_state=<span class="number">1</span>)</span><br><span class="line">agg = AgglomerativeClustering(n_clusters=<span class="number">3</span>)</span><br><span class="line">assignment = agg.fit_predict(X)</span><br><span class="line"></span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], assignment)</span><br><span class="line">plt.legend([<span class="string">'Cluster 0'</span>, <span class="string">'Cluster 1'</span>, <span class="string">'Cluster 1'</span>], loc=<span class="number">2</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/agglomerative-clustering-on-blobs.png"></p><p>æ­£å¦‚ç¼©å°ï¼Œç®—æ³•å®Œç¾Žåœ°å®Œæˆäº†èšç±»ã€‚è™½ç„¶å‡èšèšç±»çš„<code>scikit-learn</code>å®žçŽ°éœ€è¦ä½ æŒ‡å®šå¸Œæœ›ç®—æ³•æ‰¾åˆ°çš„ç°‡çš„ä¸ªæ•°ï¼Œä½†å‡èšèšç±»æ–¹æ³•ä¸ºé€‰æ‹©æ­£ç¡®çš„ä¸ªæ•°æä¾›äº†ä¸€äº›å¸®åŠ©ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºã€‚</p><h2 id="å±‚æ¬¡èšç±»ä¸Žæ ‘çŠ¶å›¾">å±‚æ¬¡èšç±»ä¸Žæ ‘çŠ¶å›¾</h2><p>å‡èšèšç±»ç”Ÿæˆäº†æ‰€è°“çš„å±‚æ¬¡èšç±»ï¼ˆhierarchical clusteringï¼‰ã€‚èšç±»è¿‡ç¨‹è¿­ä»£è¿›è¡Œï¼Œæ¯ä¸ªç‚¹éƒ½ä»Žä¸€ä¸ªå•ç‚¹ç°‡å˜ä¸ºå±žäºŽæœ€ç»ˆçš„æŸä¸ªç°‡ã€‚æ¯ä¸ªä¸­é—´æ­¥éª¤éƒ½æä¾›äº†æ•°æ®çš„ä¸€ç§èšç±»ï¼ˆç°‡çš„ä¸ªæ•°ä¹Ÿä¸ç›¸åŒï¼‰ã€‚æœ‰æ—¶å€™ï¼ŒåŒæ—¶æŸ¥çœ‹æ‰€æœ‰å¯èƒ½çš„èšç±»æ˜¯æœ‰å¸®åŠ©çš„ã€‚ä¸‹ä¸€ä¸ªä¾‹å­å åŠ æ˜¾ç¤ºäº†æ‰€æœ‰å¯èƒ½çš„èšç±»ï¼Œæœ‰åŠ©äºŽæ·±å…¥äº†è§£æ¯ä¸ªç°‡å¦‚ä½•åˆ†è§£ä¸ºè¾ƒå°çš„ç°‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_agglomerative()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/agglomerative-hierarchical-clustering.png"></p><p>è™½ç„¶è¿™ç§å¯è§†åŒ–ä¸ºå±‚æ¬¡èšç±»æä¾›äº†éžå¸¸è¯¦ç»†çš„è¯•å›¾ï¼Œä½†å®ƒä¾èµ–äºŽæ•°æ®çš„äºŒç»´æ€§è´¨ï¼Œå› æ­¤ä¸èƒ½ç”¨äºŽå…·æœ‰ä¸¤ä¸ªä»¥ä¸Šç‰¹å¾çš„æ•°æ®é›†ã€‚ä½†è¿˜æœ‰å¦ä¸€ä¸ªå°†å±‚æ¬¡èšç±»å¯è§†åŒ–çš„å·¥å…·ï¼Œå«ä½œæ ‘çŠ¶å›¾ï¼ˆdendrogramï¼‰ï¼Œå®ƒå¯ä»¥å¤„ç†å¤šç»´æ•°æ®é›†ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œç›®å‰<code>scikit-learn</code>æ²¡æœ‰ç»˜åˆ¶æ ‘çŠ¶å›¾çš„åŠŸèƒ½ã€‚ä½†ä½ å¯ä»¥åˆ©ç”¨SciPyè½»æ¾ç”Ÿæˆæ ‘çŠ¶å›¾ã€‚SciPyçš„èšç±»ç®—æ³•æŽ¥å£ä¸Ž<code>scikit-learn</code>çš„èšç±»ç®—æ³•ç¨æœ‰ä¸åŒã€‚SciPyæä¾›äº†ä¸€ä¸ªå‡½æ•°ï¼ŒæŽ¥å—æ•°æ®æ•°ç»„Xå¹¶è®¡ç®—å‡ºä¸€ä¸ªé“¾æŽ¥æ•°æ®ï¼ˆlinkage arrayï¼‰ï¼Œå®ƒå¯¹å±‚æ¬¡èšç±»çš„ç›¸ä¼¼åº¦è¿›è¡Œç¼–ç ã€‚ç„¶åŽæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé“¾æŽ¥æ•°æ®æä¾›ç»™scipyçš„dendrogramå‡½æ•°æ¥ç»˜åˆ¶æ ‘çŠ¶å›¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»ŽSciPyä¸­å¯¼å…¥dendrogramå‡½æ•°å’Œwardèšç±»å‡½æ•°</span></span><br><span class="line"><span class="keyword">from</span> scipy.cluster.hierarchy <span class="keyword">import</span> dendrogram, ward</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(random_state=<span class="number">0</span>, n_samples=<span class="number">12</span>)</span><br><span class="line"><span class="comment"># å°†wardèšç±»åº”ç”¨äºŽæ•°æ®æ•°ç»„X</span></span><br><span class="line"><span class="comment"># SciPyçš„wardå‡½æ•°è¿”å›žä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‡å®šæ‰§è¡Œå‡èšèšç±»æ—¶è·¨è¶Šçš„è·ç¦»</span></span><br><span class="line">linkage_array = ward(X)</span><br><span class="line"><span class="comment"># çŽ°åœ¨ä¸ºåŒ…å«ç°‡ä¹‹é—´è·ç¦»çš„linkage_arrayç»˜åˆ¶æ ‘çŠ¶å›¾</span></span><br><span class="line">dendrogram(linkage_array)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ ‘ä¸­æ ‡è®°åˆ’åˆ†æˆä¸¤ä¸ªç°‡æˆ–ä¸‰ä¸ªç°‡çš„ä½ç½®</span></span><br><span class="line">ax = plt.gca()</span><br><span class="line">bounds = ax.get_xbound()</span><br><span class="line">ax.plot(bounds, [<span class="number">7.25</span>, <span class="number">7.25</span>], <span class="string">'--'</span>, c=<span class="string">'k'</span>)</span><br><span class="line">ax.plot(bounds, [<span class="number">4</span>, <span class="number">4</span>], <span class="string">'--'</span>, c=<span class="string">'k'</span>)</span><br><span class="line"></span><br><span class="line">ax.text(bounds[<span class="number">1</span>], <span class="number">7.25</span>, <span class="string">' two clusters'</span>, va=<span class="string">'center'</span>, fontdict=&#123;<span class="string">'size'</span>: <span class="number">15</span>&#125;)</span><br><span class="line">ax.text(bounds[<span class="number">1</span>], <span class="number">4</span>, <span class="string">' three clusters'</span>, va=<span class="string">'center'</span>, fontdict=&#123;<span class="string">'size'</span>: <span class="number">15</span>&#125;)</span><br><span class="line">plt.xlabel(<span class="string">'Sample index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Cluster distance'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/agglomerative-clustering-dendrogram.png"></p><p>æ ‘çŠ¶å›¾åœ¨åº•éƒ¨æ˜¾ç¤ºæ•°æ®ç‚¹ï¼ˆç¼–å·ä»Ž0åˆ°11ï¼‰ã€‚ç„¶åŽä»¥è¿™äº›ç‚¹ï¼ˆè¡¨ç¤ºå•ç‚¹ç°‡ï¼‰ä½œä¸ºå¶èŠ‚ç‚¹ç»˜åˆ¶ä¸€æ£µæ ‘ï¼Œæ¯åˆå¹¶ä¸¤ä¸ªç°‡å°±æ·»åŠ ä¸€ä¸ªæ–°çš„çˆ¶èŠ‚ç‚¹ã€‚</p><p>ä»Žä¸‹å¾€ä¸Šçœ‹ï¼Œæ•°æ®ç‚¹1å’Œ4é¦–å…ˆè¢«åˆå¹¶ã€‚æŽ¥ä¸‹æ¥ï¼Œç‚¹6å’Œ9è¢«åˆå¹¶ä¸ºä¸€ä¸ªç°‡ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚åœ¨é¡¶å±‚æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªç”±ç‚¹11ã€0ã€5ã€10ã€7ã€6å’Œ9ç»„æˆï¼Œå¦ä¸€ä¸ªç”±ç‚¹1ã€4ã€3ã€2å’Œ8ç»„æˆã€‚è¿™å¯¹åº”äºŽå›¾ä¸­ä¸¤ä¸ªæœ€å¤§çš„ç°‡ã€‚</p><p>æ ‘çŠ¶å›¾çš„yè½´ä¸ä»…è¯´æ˜Žå‡èšç®—æ³•ä¸­ä¸¤ä¸ªç°‡ä½•æ—¶åˆå¹¶ï¼Œæ¯ä¸ªåˆ†æ”¯çš„é•¿åº¦è¿˜è¡¨ç¤ºè¢«åˆå¹¶çš„ç°‡ä¹‹é—´çš„è·ç¦»ã€‚åœ¨è¿™å¼ æ ‘çŠ¶å›¾ä¸­ï¼Œæœ€é•¿çš„åˆ†æ”¯æ˜¯æ ‡è®°ä¸ºâ€œthree clustersâ€çš„è™šçº¿è¡¨ç¤ºçš„ä¸‰æ¡çº¿ã€‚å®ƒä»¬æ˜¯æœ€é•¿çš„åˆ†æ”¯ï¼Œè¿™è¡¨ç¤ºä»Žä¸‰ä¸ªç°‡åˆ°ä¸¤ä¸ªç°‡çš„è¿‡ç¨‹ä¸­åˆå¹¶äº†ä¸€äº›è·ç¦»éžå¸¸è¿œçš„ç‚¹ã€‚å°†å‰©ä¸‹çš„ä¸¤ä¸ªç°‡åˆå¹¶ä¸ºä¸€ä¸ªç°‡ä¹Ÿéœ€è¦è·¨è¶Šç›¸å¯¹è¾ƒå¤§çš„è·ç¦»ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œå‡èšç®—æ³•ä»ç„¶æ— æ³•åˆ†ç¦»åƒ<code>two_moons</code>æ•°æ®é›†è¿™æ ·å¤æ‚çš„å½¢çŠ¶ã€‚ä½†æˆ‘ä»¬è¦å­¦ä¹ çš„ä¸‹ä¸€ä¸ªç®—æ³•DBSCANå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="dbscan">DBSCAN</h1><p>å¦ä¸€ä¸ªéžå¸¸æœ‰ç”¨çš„èšç±»ç®—æ³•æ˜¯DBSCANï¼ˆdensity-based spatial clustering of applications with noiseï¼Œå³â€œå…·æœ‰å™ªå£°çš„åŸºäºŽå¯†åº¦çš„ç©ºé—´èšç±»åº”ç”¨â€ï¼‰ã€‚DBSCANçš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒä¸éœ€è¦ç”¨æˆ·å…ˆéªŒåœ°è®¾ç½®ç°‡çš„ä¸ªæ•°ï¼Œå¯ä»¥åˆ’åˆ†å…·æœ‰å¤æ‚å½¢çŠ¶çš„ç°‡ï¼Œè¿˜å¯ä»¥æ‰¾å‡ºä¸å±žäºŽä»»ä½•ç°‡çš„ç‚¹ã€‚DBSCANæ¯”å‡èšèšç±»å’Œkå‡å€¼ç¨æ…¢ï¼Œä½†ä»å¯ä»¥æ‰©å±•åˆ°ç›¸å¯¹è¾ƒå¤§çš„æ•°æ®é›†ã€‚</p><p>DBSCANçš„åŽŸç†æ˜¯è¯†åˆ«ç‰¹å¾ç©ºé—´çš„â€œæ‹¥æŒ¤â€åŒºåŸŸä¸­çš„ç‚¹ï¼Œåœ¨è¿™äº›åŒºåŸŸä¸­è®¸å¤šæ•°æ®ç‚¹é è¿‘åœ¨ä¸€èµ·ã€‚è¿™äº›åŒºåŸŸè¢«ç§°ä¸ºç‰¹å¾ç©ºé—´ä¸­çš„å¯†é›†ï¼ˆdenseï¼‰åŒºåŸŸã€‚DBSCANèƒŒåŽçš„æ€æƒ³æ˜¯ï¼Œç°‡å½¢æˆæ•°æ®çš„å¯†é›†åŒºåŸŸï¼Œå¹¶ç”±ç›¸å¯¹è¾ƒç©ºçš„åŒºåŸŸåˆ†éš”å¼€ã€‚</p><p>åœ¨å¯†é›†åŒºåŸŸå†…çš„ç‚¹è¢«ç§°ä¸º<strong>æ ¸å¿ƒæ ·æœ¬</strong>ï¼ˆcore sampleï¼Œæˆ–æ ¸å¿ƒç‚¹ï¼‰ï¼Œå®ƒä»¬çš„å®šä¹‰å¦‚ä¸‹ã€‚DBSCANæœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>min_samples</code>å’Œ<code>eps</code>ã€‚å¦‚æžœè·ä¸€ä¸ªç»™å®šæ•°æ®ç‚¹<code>eps</code>çš„è·ç¦»è‡³å°‘æœ‰<code>min_samples</code>ä¸ªæ•°æ®ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®ç‚¹å°±æ˜¯æ ¸å¿ƒæ ·æœ¬ã€‚DBSCANå°†å½¼æ­¤è·ç¦»å°äºŽ<code>eps</code>çš„æ ¸å¿ƒæ ·æœ¬æ”¾åˆ°åŒä¸€ä¸ªç°‡ä¸­ã€‚</p><p>ç®—æ³•é¦–å…ˆä»»æ„é€‰å–ä¸€ä¸ªç‚¹ï¼Œç„¶åŽæ‰¾åˆ°è¿™ä¸ªç‚¹çš„è·ç¦»å°äºŽç­‰äºŽepsçš„æ‰€æœ‰çš„ç‚¹ã€‚å¦‚æžœè·èµ·å§‹ç‚¹çš„è·ç¦»åœ¨epsä¹‹å†…çš„æ•°æ®ç‚¹ä¸ªæ•°å°äºŽ<code>min_samples</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹è¢«æ ‡è®°ä¸º<strong>å™ªå£°</strong>ï¼ˆnoiseï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸å±žäºŽä»»ä½•ç°‡ã€‚å¦‚æžœè·ç¦»åœ¨epsä¹‹å†…çš„æ•°æ®ç‚¹ä¸ªæ•°å¤§äºŽ<code>min_samples</code>ï¼Œåˆ™è¿™ä¸ªç‚¹è¢«æ ‡è®°ä¸ºæ ¸å¿ƒæ ·æœ¬ï¼Œå¹¶è¢«åˆ†é…ä¸€ä¸ªæ–°çš„ç°‡æ ‡ç­¾ã€‚ç„¶åŽè®¿é—®è¯¥ç‚¹çš„æ‰€æœ‰é‚»å±…ï¼ˆåœ¨è·ç¦»epsä¹‹å†…ï¼‰ã€‚å¦‚æžœå®ƒä»¬è¿˜æ²¡æœ‰è¢«åˆ†é…ä¸€ä¸ªç°‡ï¼Œé‚£ä¹ˆå°±å°†åˆšåˆšåˆ›å»ºçš„æ–°çš„ç°‡æ ‡ç­¾åˆ†é…ç»™å®ƒä»¬ã€‚å¦‚æžœå®ƒä»¬æ˜¯æ ¸å¿ƒæ ·æœ¬ï¼Œé‚£ä¹ˆå°±ä¾æ¬¡è®¿é—®å…¶é‚»å±…ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ç°‡é€æ¸å¢žå¤§ï¼Œç›´åˆ°åœ¨ç°‡çš„epsè·ç¦»å†…æ²¡æœ‰æ›´å¤šçš„æ ¸å¿ƒæ ·æœ¬ä¸ºæ­¢ã€‚ç„¶åŽé€‰å–å¦ä¸€ä¸ªå°šæœªè¢«è®¿é—®è¿‡çš„ç‚¹ï¼Œå¹¶é‡å¤ç›¸åŒçš„è¿‡ç¨‹ã€‚</p><p><strong>æœ€åŽï¼Œä¸€å…±æœ‰ä¸‰ç§ç±»åž‹çš„ç‚¹ï¼šæ ¸å¿ƒç‚¹ï¼Œä¸Žæ ¸å¿ƒç‚¹çš„è·ç¦»åœ¨epsä¹‹å†…çš„ç‚¹ï¼ˆå«ä½œè¾¹ç•Œç‚¹ï¼Œboundary pointï¼‰å’Œå™ªå£°ã€‚å¦‚æžœDBSCANç®—æ³•åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šå¤šæ¬¡è¿è¡Œï¼Œé‚£ä¹ˆæ ¸å¿ƒç‚¹çš„èšç±»å§‹ç»ˆç›¸åŒï¼ŒåŒæ ·çš„ç‚¹ä¹Ÿå§‹ç»ˆè¢«æ ‡è®°ä¸ºå™ªå£°ã€‚ä½†è¾¹ç•Œç‚¹å¯èƒ½ä¸Žä¸æ­¢ä¸€ä¸ªç°‡çš„æ ¸å¿ƒæ ·æœ¬ç›¸é‚»ã€‚å› æ­¤ï¼Œè¾¹ç•Œç‚¹æ‰€å±žçš„ç°‡ä¾èµ–äºŽæ•°æ®ç‚¹çš„è®¿é—®é¡ºåºã€‚ä¸€èˆ¬æ¥è¯´åªæœ‰å¾ˆå°‘çš„è¾¹ç•Œç‚¹ï¼Œè¿™ç§å¯¹è®¿é—®é¡ºåºçš„è½»åº¦ä¾èµ–å¹¶ä¸é‡è¦ã€‚</strong></p><p>æˆ‘ä»¬å°†DBSCANåº”ç”¨äºŽæ¼”ç¤ºå‡èšèšç±»çš„æ¨¡æ‹Ÿæ•°æ®é›†ã€‚ä¸Žå‡èšèšç±»ç±»ä¼¼ï¼ŒDBSCANä¹Ÿä¸å…è®¸å¯¹æ–°çš„æµ‹è¯•æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨<code>fit_predict</code>æ–¹æ³•æ¥æ‰§è¡Œèšç±»å¹¶è¿”å›žç°‡æ ‡ç­¾ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.cluster.dbscan" target="_blank" rel="noopener"><code>class sklearn.cluster.DBSCAN(eps=0.5, min_samples=5, metric=â€™euclideanâ€™, metric_params=None, algorithm=â€™autoâ€™, leaf_size=30, p=None, n_jobs=None)</code></a></p><p>Perform DBSCAN clustering from vector array or distance matrix.</p><p>DBSCAN - Density-Based Spatial Clustering of Applications with Noise. Finds core samples of high density and expands clusters from them. Good for data which contains clusters of similar density.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> DBSCAN</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(random_state=<span class="number">0</span>, n_samples=<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">dbscan = DBSCAN()</span><br><span class="line">clusters = dbscan.fit_predict(X)</span><br><span class="line">print(<span class="string">'Cluster memberships:\n&#123;&#125;'</span>.format(clusters))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cluster memberships:</span><br><span class="line">[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰æ•°æ®ç‚¹éƒ½è¢«åˆ†é…äº†æ ‡ç­¾-1ï¼Œè¿™ä»£è¡¨å™ªå£°ã€‚è¿™æ˜¯epså’Œ<code>min_samples</code>é»˜è®¤å‚æ•°è®¾ç½®çš„ç»“æžœï¼Œå¯¹äºŽå°åž‹çš„çŽ©å…·æ•°æ®é›†å¹¶æ²¡æœ‰è°ƒèŠ‚è¿™äº›å‚æ•°ã€‚<code>min_samples</code>å’Œepså–ä¸åŒå€¼æ—¶çš„ç°‡åˆ†ç±»å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_dbscan()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">min_samples: 2 eps: 1.000000  cluster: [-1  0  0 -1  0 -1  1  1  0  1 -1 -1]</span><br><span class="line">min_samples: 2 eps: 1.500000  cluster: [0 1 1 1 1 0 2 2 1 2 2 0]</span><br><span class="line">min_samples: 2 eps: 2.000000  cluster: [0 1 1 1 1 0 0 0 1 0 0 0]</span><br><span class="line">min_samples: 2 eps: 3.000000  cluster: [0 0 0 0 0 0 0 0 0 0 0 0]</span><br><span class="line">min_samples: 3 eps: 1.000000  cluster: [-1  0  0 -1  0 -1  1  1  0  1 -1 -1]</span><br><span class="line">min_samples: 3 eps: 1.500000  cluster: [0 1 1 1 1 0 2 2 1 2 2 0]</span><br><span class="line">min_samples: 3 eps: 2.000000  cluster: [0 1 1 1 1 0 0 0 1 0 0 0]</span><br><span class="line">min_samples: 3 eps: 3.000000  cluster: [0 0 0 0 0 0 0 0 0 0 0 0]</span><br><span class="line">min_samples: 5 eps: 1.000000  cluster: [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]</span><br><span class="line">min_samples: 5 eps: 1.500000  cluster: [-1  0  0  0  0 -1 -1 -1  0 -1 -1 -1]</span><br><span class="line">min_samples: 5 eps: 2.000000  cluster: [-1  0  0  0  0 -1 -1 -1  0 -1 -1 -1]</span><br><span class="line">min_samples: 5 eps: 3.000000  cluster: [0 0 0 0 0 0 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/dbscan-different-parameters.png"></p><p>åœ¨è¿™å¼ å›¾ä¸­ï¼Œå±žäºŽç°‡çš„ç‚¹æ˜¯å®žå¿ƒçš„ï¼Œè€Œå™ªå£°ç‚¹åˆ™æ˜¾ç¤ºä¸ºç©ºå¿ƒçš„ã€‚æ ¸å¿ƒæ ·æœ¬æ˜¾ç¤ºä¸ºè¾ƒå¤§çš„æ ‡è®°ï¼Œè€Œè¾¹ç•Œç‚¹åˆ™æ˜¾ç¤ºä¸ºè¾ƒå°çš„æ ‡è®°ã€‚å¢žå¤§epsï¼ˆåœ¨å›¾ä¸­ä»Žå·¦åˆ°å³ï¼‰ï¼Œæ›´å¤šçš„ç‚¹ä¼šè¢«åŒ…å«åœ¨ä¸€ä¸ªç°‡ä¸­ã€‚è¿™è®©ç°‡å˜å¤§ï¼Œä½†å¯èƒ½ä¹Ÿä¼šå¯¼è‡´å¤šä¸ªç°‡åˆå¹¶æˆä¸€ä¸ªã€‚å¢žå¤§<code>min_samples</code>ï¼ˆåœ¨å›¾ä¸­ä»Žä¸Šåˆ°ä¸‹ï¼‰ï¼Œæ ¸å¿ƒç‚¹ä¼šå˜å¾—æ›´å°‘ï¼Œæ›´å¤šçš„ç‚¹è¢«æ ‡è®°ä¸ºå™ªå£°ã€‚</p><p>å‚æ•°epsåœ¨æŸç§ç¨‹åº¦ä¸Šæ›´åŠ é‡è¦ï¼Œå› ä¸ºå®ƒå†³å®šäº†ç‚¹ä¸Žç‚¹ä¹‹é—´â€œæŽ¥è¿‘â€çš„å«ä¹‰ã€‚å°†epsè®¾ç½®çš„éžå¸¸å°ï¼Œæ„å‘³ç€æ²¡æœ‰ç‚¹æ˜¯æ ¸å¿ƒæ ·æœ¬ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰ç‚¹éƒ½è¢«æ ‡è®°ä¸ºå™ªå£°ã€‚å°†epsè®¾ç½®çš„éžå¸¸å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰ç‚¹å½¢æˆå•ä¸ªç°‡ã€‚</p><p>è®¾ç½®<code>min_samples</code>ä¸»è¦æ˜¯ä¸ºäº†åˆ¤æ–­ç¨€ç–åŒºåŸŸå†…çš„ç‚¹è¢«æ ‡è®°ä¸ºå¼‚å¸¸å€¼è¿˜æ˜¯å½¢æˆè‡ªå·±çš„ç°‡ã€‚å¦‚æžœå¢žå¤§<code>min_samples</code>ï¼Œä»»ä½•ä¸€ä¸ªåŒ…å«å°‘äºŽ<code>min_samples</code>ä¸ªæ ·æœ¬çš„ç°‡çŽ°åœ¨å°†è¢«æ ‡è®°ä¸ºå™ªå£°ã€‚å› æ­¤ï¼Œ<strong><code>min_samples</code>å†³å®šç°‡çš„æœ€å°å°ºå¯¸ã€‚</strong>åœ¨ä¸Šå›¾ä¸­ä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p><p><strong>è™½ç„¶DBSCANä¸éœ€è¦æ˜¾å¼åœ°è®¾ç½®ç°‡çš„ä¸ªæ•°ï¼Œä½†è®¾ç½®epså¯ä»¥éšå¼åœ°æŽ§åˆ¶æ‰¾åˆ°çš„ç°‡çš„ä¸ªæ•°ã€‚</strong>ä½¿ç”¨StandardScaleræˆ–MinMaxScalerå¯¹æ•°æ®è¿›è¡Œç¼©æ”¾ä¹‹åŽï¼Œæœ‰æ—¶ä¼šæ›´å®¹æ˜“æ‰¾åˆ°epsçš„è¾ƒå¥½å–å€¼ï¼Œå› ä¸ºä½¿ç”¨è¿™äº›ç¼©æ”¾æŠ€æœ¯å°†ç¡®ä¿æ‰€æœ‰ç‰¹å¾å…·æœ‰ç›¸ä¼¼çš„èŒƒå›´ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = make_moons(n_samples=<span class="number">200</span>, noise=<span class="number">0.05</span>, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®ç¼©æ”¾æˆå¹³å‡å€¼ä¸º0ã€æ–¹å·®ä¸º1</span></span><br><span class="line">scaler = StandardScaler()</span><br><span class="line">scaler.fit(X)</span><br><span class="line">X_scaled = scaler.transform(X)</span><br><span class="line"></span><br><span class="line">dbscan = DBSCAN()</span><br><span class="line">clusters = dbscan.fit_predict(X_scaled)</span><br><span class="line"><span class="comment"># ç»˜åˆ¶ç°‡åˆ†é…</span></span><br><span class="line">plt.scatter(X_scaled[:, <span class="number">0</span>], X_scaled[:, <span class="number">1</span>], c=clusters,</span><br><span class="line">    cmap=mglearn.cm2, s=<span class="number">60</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/dbscan-on-moons.png"></p><p>ç”±äºŽç®—æ³•æ‰¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç°‡çš„ä¸ªæ•°ï¼ˆ2ä¸ªï¼‰ï¼Œå› æ­¤å‚æ•°è®¾ç½®çš„æ•ˆæžœä¼¼ä¹Žå¾ˆå¥½ã€‚å¦‚æžœå°†epså‡å°åˆ°0.2ï¼ˆé»˜è®¤å€¼ä¸º0.5ï¼‰ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ°8ä¸ªç°‡ï¼Œè¿™æ˜¾ç„¶å¤ªå¤šäº†ã€‚å°†epså¢žå¤§åˆ°0.7åˆ™ä¼šå¯¼è‡´åªæœ‰ä¸€ä¸ªç°‡ã€‚</p><p>åœ¨ä½¿ç”¨DBSCANæ—¶ï¼Œä½ éœ€è¦è°¨æ…Žå¤„ç†è¿”å›žçš„ç°‡åˆ†é…ã€‚å¦‚æžœä½¿ç”¨ç°‡æ ‡ç­¾å¯¹å¦ä¸€ä¸ªæ•°æ®è¿›è¡Œç´¢å¼•ï¼Œé‚£ä¹ˆä½¿ç”¨-1è¡¨ç¤ºå™ªå£°å¯èƒ½ä¼šäº§ç”Ÿæ„æ–™ä¹‹å¤–çš„ç»“æžœã€‚</p><h1 id="èšç±»ç®—æ³•çš„å¯¹æ¯”ä¸Žè¯„ä¼°">èšç±»ç®—æ³•çš„å¯¹æ¯”ä¸Žè¯„ä¼°</h1><p>åœ¨åº”ç”¨èšç±»ç®—æ³•æ—¶ï¼Œå…¶æŒ‘æˆ˜ä¹‹ä¸€å°±æ˜¯å¾ˆéš¾è¯„ä¼°ä¸€ä¸ªç®—æ³•çš„æ•ˆæžœå¥½åï¼Œä¹Ÿå¾ˆéš¾æ¯”è¾ƒä¸åŒç®—æ³•çš„ç»“æžœã€‚</p><h2 id="ç”¨çœŸå®žå€¼è¯„ä¼°èšç±»">ç”¨çœŸå®žå€¼è¯„ä¼°èšç±»</h2><p>æœ‰ä¸€äº›æŒ‡æ ‡å¯ç”¨äºŽè¯„ä¼°èšç±»ç®—æ³•ç›¸å¯¹äºŽçœŸå®žèšç±»çš„ç»“æžœï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯<strong>è°ƒæ•´randæŒ‡æ•°</strong>ï¼ˆadjusted rand indexï¼ŒARIï¼‰å’Œ<strong>å½’ä¸€åŒ–äº’ä¿¡æ¯</strong>ï¼ˆnormalized mutual informationï¼ŒNMIï¼‰ï¼ŒäºŒè€…éƒ½ç»™å‡ºäº†å®šé‡çš„åº¦é‡ï¼Œå…¶æœ€ä½³å€¼ä¸º1ï¼Œ0è¡¨ç¤ºä¸ç›¸å…³çš„èšç±»ï¼ˆè™½ç„¶ARIå¯ä»¥å–è´Ÿå€¼ï¼‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ARIæ¥æ¯”è¾ƒkå‡å€¼ã€å‡èšèšç±»å’ŒDBSCANç®—æ³•ã€‚å¯¹äº†å¯¹æ¯”ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†å°†ç‚¹éšæœºåˆ†é…åˆ°ä¸¤ä¸ªç°‡ä¸­çš„å›¾åƒã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.metrics.adjusted_rand_score" target="_blank" rel="noopener"><code>sklearn.metrics.adjusted_rand_score(labels_true, labels_pred)</code></a></p><p>Rand index adjusted for chance.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics.cluster <span class="keyword">import</span> adjusted_rand_score</span><br><span class="line"></span><br><span class="line">X, y = make_moons(n_samples=<span class="number">200</span>, noise=<span class="number">0.05</span>, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># å°†æ•°æ®ç¼©æ”¾æˆå¹³å‡å€¼ä¸º0ã€æ–¹å·®ä¸º1</span></span><br><span class="line">scaler = StandardScaler()</span><br><span class="line">scaler.fit(X)</span><br><span class="line">X_scaled = scaler.transform(X)</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">4</span>, figsize=(<span class="number">15</span>, <span class="number">3</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="comment"># è¦ä½¿ç”¨çš„ç®—æ³•</span></span><br><span class="line">algorithms = [KMeans(n_clusters=<span class="number">2</span>), AgglomerativeClustering(n_clusters=<span class="number">2</span>),</span><br><span class="line">    DBSCAN() ]</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªéšæœºçš„ç°‡åˆ†é…ï¼Œä½œä¸ºå‚è€ƒ</span></span><br><span class="line">random_state = np.random.RandomState(seed=<span class="number">0</span>)</span><br><span class="line">random_clusters = random_state.randint(low=<span class="number">0</span>, high=<span class="number">2</span>, size=len(X))</span><br><span class="line"><span class="comment"># ç»˜åˆ¶éšæœºåˆ†é…</span></span><br><span class="line">axes[<span class="number">0</span>].scatter(X_scaled[:, <span class="number">0</span>], X_scaled[:, <span class="number">1</span>], c=random_clusters,</span><br><span class="line">    cmap=mglearn.cm3, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">0</span>].set_title(<span class="string">'Random assignment - ARI: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">    adjusted_rand_score(y, random_clusters)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ax, algorithm <span class="keyword">in</span> zip(axes[<span class="number">1</span>:], algorithms):</span><br><span class="line">    clusters = algorithm.fit_predict(X_scaled)</span><br><span class="line">    ax.scatter(X_scaled[:, <span class="number">0</span>], X_scaled[:, <span class="number">1</span>], c=clusters,</span><br><span class="line">    cmap=mglearn.cm3, s=<span class="number">60</span>)</span><br><span class="line">    ax.set_title(<span class="string">'&#123;&#125; - ARI: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">        algorithm.__class__.__name__, adjusted_rand_score(y, clusters)))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/ari-of-kmeans-agglomerative-clustering-and-dbscan.png"></p><p>ARIç»™å‡ºäº†ç¬¦åˆç›´è§‰çš„ç»“æžœï¼Œéšæœºç°‡åˆ†é…çš„åˆ†æ•°ä¸º0ï¼Œè€ŒDBSCANï¼ˆå®Œç¾Žåœ°æ‰¾åˆ°äº†æœŸæœ›ä¸­çš„ç°‡ï¼‰çš„åˆ†æ•°ä¸º1ã€‚</p><p>ç”¨è¿™ç§æ–¹å¼è¯„ä¼°èšç±»æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯ä½¿ç”¨<code>accuracy_score</code>è€Œä¸æ˜¯<code>adjusted_rand_score</code>ã€<code>normalized_mutual_info_score</code>æˆ–å…¶ä»–èšç±»æŒ‡æ ‡ã€‚<strong>ä½¿ç”¨ç²¾åº¦çš„é—®é¢˜åœ¨äºŽï¼Œå®ƒè¦æ±‚åˆ†é…çš„ç°‡æ ‡ç­¾ä¸ŽçœŸå®žå€¼å®Œå…¨åŒ¹é…ã€‚ä½†ç°‡æ ‡ç­¾æœ¬èº«æ¯«æ— æ„ä¹‰â€”â€”å”¯ä¸€é‡è¦çš„æ˜¯å“ªäº›ç‚¹ä½äºŽåŒä¸€ä¸ªç°‡ä¸­ã€‚</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸¤ç§ç‚¹æ ‡ç­¾å¯¹åº”äºŽç›¸åŒçš„èšç±»</span></span><br><span class="line">clusters1 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">clusters2 = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy: &#123;:.2f&#125;'</span>.format(accuracy_score(clusters1, clusters2)))</span><br><span class="line">print(<span class="string">'ARI: &#123;:.2f&#125;'</span>.format(adjusted_rand_score(clusters1, clusters2)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy: 0.00</span><br><span class="line">ARI: 1.00</span><br></pre></td></tr></table></figure><h2 id="åœ¨æ²¡æœ‰çœŸå®žå€¼çš„æƒ…å†µä¸‹è¯„ä¼°èšç±»">åœ¨æ²¡æœ‰çœŸå®žå€¼çš„æƒ…å†µä¸‹è¯„ä¼°èšç±»</h2><p>åœ¨å®žè·µä¸­ï¼Œä½¿ç”¨è¯¸å¦‚ARIä¹‹ç±»çš„æŒ‡æ ‡æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚<strong>åœ¨åº”ç”¨èšç±»ç®—æ³•æ—¶ï¼Œé€šå¸¸æ²¡æœ‰çœŸå®žå€¼æ¥æ¯”è¾ƒç»“æžœã€‚</strong>å¦‚æžœæˆ‘ä»¬çŸ¥é“äº†æ•°æ®çš„æ­£ç¡®èšç±»ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è¿™ä¸€ä¿¡æ¯æž„å»ºä¸€ä¸ªç›‘ç£æ¨¡åž‹ï¼ˆæ¯”å¦‚åˆ†ç±»å™¨ï¼‰ã€‚å› æ­¤ï¼Œä½¿ç”¨ç±»ä¼¼ARIå’ŒNMIçš„æŒ‡æ ‡é€šå¸¸ä»…æœ‰åŠ©äºŽå¼€å‘ç®—æ³•ï¼Œä½†å¯¹è¯„ä¼°åº”ç”¨æ˜¯å¦æˆåŠŸæ²¡æœ‰å¸®åŠ©ã€‚</p><p>æœ‰ä¸€äº›èšç±»çš„è¯„åˆ†æŒ‡æ ‡ä¸éœ€è¦çœŸå®žå€¼ï¼Œæ¯”å¦‚<strong>è½®å»“ç³»æ•°</strong>ï¼ˆsilhouette coefficientï¼‰ã€‚ä½†å®ƒä»¬åœ¨å®žè·µä¸­çš„æ•ˆæžœå¹¶ä¸å¥½ã€‚è½®å»“åˆ†æ•°è®¡ç®—ä¸€ä¸ªç°‡çš„ç´§è‡´åº¦ï¼Œå…¶å€¼è¶Šå¤§è¶Šå¥½ï¼Œæœ€é«˜åˆ†æ•°ä¸º1ã€‚<strong>è™½ç„¶ç´§è‡´çš„ç°‡å¾ˆå¥½ï¼Œä½†ç´§è‡´åº¦ä¸å…è®¸å¤æ‚çš„å½¢çŠ¶ã€‚</strong></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œåˆ©ç”¨è½®å»“åˆ†æ•°åœ¨<code>two_moons</code>æ•°æ®é›†ä¸Šæ¯”è¾ƒkå‡å€¼ã€å‡èšèšç±»å’ŒDBSCANã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.metrics.silhouette_score" target="_blank" rel="noopener"><code>sklearn.metrics.silhouette_score(X, labels, metric=â€™euclideanâ€™, sample_size=None, random_state=None, **kwds)</code></a></p><p>Compute the mean Silhouette Coefficient of all samples.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics.cluster <span class="keyword">import</span> silhouette_score</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">4</span>, figsize=(<span class="number">15</span>, <span class="number">3</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="comment"># ç»˜åˆ¶éšæœºåˆ†é…</span></span><br><span class="line">axes[<span class="number">0</span>].scatter(X_scaled[:, <span class="number">0</span>], X_scaled[:, <span class="number">1</span>], c=random_clusters,</span><br><span class="line">    cmap=mglearn.cm3, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">0</span>].set_title(<span class="string">'Random assignment: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">    silhouette_score(X_scaled, random_clusters)))</span><br><span class="line"><span class="keyword">for</span> ax, algorithm <span class="keyword">in</span> zip(axes[<span class="number">1</span>:], algorithms):</span><br><span class="line">    clusters = algorithm.fit_predict(X_scaled)</span><br><span class="line">    ax.scatter(X_scaled[:, <span class="number">0</span>], X_scaled[:, <span class="number">1</span>], c=clusters,</span><br><span class="line">    cmap=mglearn.cm3, s=<span class="number">60</span>)</span><br><span class="line">    ax.set_title(<span class="string">'&#123;&#125;: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">        algorithm.__class__.__name__, silhouette_score(X_scaled, clusters)))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/silhouette-score-of-kmeans-agglomerative-clustering-and-dbscan.png"></p><p>kå‡å€¼çš„è½®å»“åˆ†æ•°æœ€é«˜ï¼Œå°½ç®¡æˆ‘ä»¬å¯èƒ½æ›´å–œæ¬¢DBSCANçš„ç»“æžœã€‚å¯¹äºŽè¯„ä¼°èšç±»ï¼Œç¨å¥½çš„ç­–ç•¥æ˜¯ä½¿ç”¨<strong>åŸºäºŽé²æ£’æ€§çš„</strong>ï¼ˆrobustness-basedï¼‰èšç±»æŒ‡æ ‡ã€‚è¿™ç§æŒ‡æ ‡ä¼˜å…ˆå‘æ•°æ®ä¸­æ·»åŠ ä¸€äº›å™ªå£°ï¼Œæˆ–è€…ä½¿ç”¨ä¸åŒçš„å‚æ•°è®¾å®šï¼Œç„¶åŽè¿è¡Œç®—æ³•ï¼Œå¹¶å¯¹ç»“æžœè¿›è¡Œæ¯”è¾ƒã€‚å…¶æ€æƒ³æ˜¯ï¼Œå¦‚æžœè®¸å¤šç®—æ³•å‚æ•°å’Œè®¸å¤šæ•°æ®æ‰°åŠ¨è¿”å›žç›¸åŒçš„ç»“æžœï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½æ˜¯å¯ä¿¡çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ<code>scikit-learn</code>è¿˜æ²¡æœ‰å®žçŽ°è¿™ä¸€ç­–ç•¥ã€‚</p><p>å³ä½¿æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªé²æ£’æ€§å¾ˆå¥½çš„èšç±»æˆ–è€…éžå¸¸é«˜çš„è½®å»“åˆ†æ•°ï¼Œä½†ä»ç„¶ä¸çŸ¥é“èšç±»ä¸­æ˜¯å¦æœ‰ä»»ä½•è¯­ä¹‰å«ä¹‰ï¼Œæˆ–è€…èšç±»æ˜¯å¦åæ˜ äº†æ•°æ®ä¸­æˆ‘ä»¬æ„Ÿå…´è¶£çš„æŸä¸ªæ–¹é¢ã€‚å›žåˆ°äººè„¸å›¾åƒçš„ä¾‹å­ã€‚æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ç±»ä¼¼äººè„¸çš„åˆ†ç»„ï¼Œæ¯”å¦‚ç”·äººå’Œå¥³äººã€è€äººå’Œå¹´è½»äººï¼Œæˆ–è€…æœ‰èƒ¡å­çš„äººå’Œæ²¡èƒ¡å­çš„äººã€‚å‡è®¾æˆ‘ä»¬å°†æ•°æ®åˆ†ä¸ºä¸¤ä¸ªç°‡ï¼Œå…³äºŽå“ªäº›ç‚¹åº”è¯¥è¢«èšç±»åœ¨ä¸€èµ·ï¼Œæ‰€æœ‰ç®—æ³•çš„ç»“æžœä¸€è‡´ã€‚æˆ‘ä»¬ä»ä¸çŸ¥é“æ‰¾åˆ°çš„ç°‡æ˜¯å¦ä»¥æŸç§æ–¹å¼å¯¹åº”æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ¦‚å¿µã€‚ç®—æ³•æ‰¾åˆ°çš„å¯èƒ½æ˜¯ä¾§è§†å›¾å’Œæ­£é¢è§†å›¾ã€å¤œé—´æ‹æ‘„çš„ç…§ç‰‡å’Œç™½å¤©æ‹æ‘„çš„ç…§ç‰‡ï¼Œæˆ–è€…iPhoneæ‹æ‘„çš„ç…§ç‰‡å’Œå®‰å“æ‰‹æœºæ‹æ‘„çš„ç…§ç‰‡ã€‚è¦æƒ³çŸ¥é“èšç±»æ˜¯å¦å¯¹åº”äºŽæˆ‘ä»¬æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œå”¯ä¸€çš„åŠžæ³•å°±æ˜¯å¯¹ç°‡è¿›è¡Œäººå·¥åˆ†æžã€‚</p><h2 id="åœ¨äººè„¸æ•°æ®é›†ä¸Šæ¯”è¾ƒç®—æ³•">åœ¨äººè„¸æ•°æ®é›†ä¸Šæ¯”è¾ƒç®—æ³•</h2><h3 id="ç”¨dbscanåˆ†æž">ç”¨DBSCANåˆ†æž</h3><p>å°†kå‡å€¼ã€DBSCANå’Œå‡èšèšç±»ç®—æ³•åº”ç”¨äºŽäººè„¸æ•°æ®é›†ï¼Œå¹¶æŸ¥çœ‹å®ƒä»¬æ˜¯å¦æ‰¾åˆ°äº†æœ‰è¶£çš„ç»“æž„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»Žæ•°æ®ä¸­æå–ç‰¹å¾è„¸ï¼Œå¹¶å¯¹æ•°ç»„è¿›è¡Œå˜æ¢</span></span><br><span class="line">pca = PCA(n_components=<span class="number">100</span>, whiten=<span class="literal">True</span>, random_state=<span class="number">0</span>)</span><br><span class="line">X_pca = pca.fit_transform(X_people)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨é»˜è®¤å‚æ•°çš„DBSCAN</span></span><br><span class="line">dbscan = DBSCAN()</span><br><span class="line">labels = dbscan.fit_predict(X_pca)</span><br><span class="line">print(<span class="string">'Unique labels: &#123;&#125;'</span>.format(np.unique(labels)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Unique labels: [-1]</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰è¿”å›žçš„æ ‡ç­¾éƒ½æ˜¯-1ï¼Œå› æ­¤æ‰€æœ‰æ•°æ®éƒ½è¢«æ ‡è®°ä¸ºâ€œå™ªå£°â€ã€‚æˆ‘ä»¬å¯ä»¥æ”¹å˜ä¸¤ä¸ªå‚æ•°æ¥æ”¹è¿›è¿™ä¸€ç‚¹ï¼šç¬¬ä¸€ï¼Œæˆ‘ä»¬å¯ä»¥å¢žå¤§epsï¼Œä»Žè€Œæ‰©å±•æ¯ä¸ªç‚¹çš„é‚»åŸŸï¼›ç¬¬äºŒï¼Œæˆ‘ä»¬å¯ä»¥å‡å°<code>min_samples</code>ï¼Œä»Žè€Œå°†æ›´å°çš„ç‚¹ç»„è§†ä¸ºç°‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°è¯•æ”¹å˜min_samples</span></span><br><span class="line">dbscan = DBSCAN(min_samples=<span class="number">3</span>)</span><br><span class="line">labels = dbscan.fit_predict(X_pca)</span><br><span class="line">print(<span class="string">'Unique labels: &#123;&#125;'</span>.format(np.unique(labels)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Unique labels: [-1]</span><br></pre></td></tr></table></figure><p>å³ä½¿ä»…è€ƒè™‘ç”±ä¸‰ä¸ªç‚¹æž„æˆçš„ç»„ï¼Œæ‰€æœ‰ç‚¹ä¹Ÿéƒ½è¢«æ ‡è®°ä¸ºå™ªå£°ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å¢žå¤§epsã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dbscan = DBSCAN(min_samples=<span class="number">3</span>, eps=<span class="number">15</span>)</span><br><span class="line">labels = dbscan.fit_predict(X_pca)</span><br><span class="line">print(<span class="string">'Unique labels: &#123;&#125;'</span>.format(np.unique(labels)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Unique labels: [-1  0]</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ›´å¤§çš„epsï¼Œæˆ‘ä»¬å¾—åˆ°äº†å•ä¸€ç°‡å’Œå™ªå£°ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç»“æžœæ‰¾å‡ºâ€œå™ªå£°â€ç›¸å¯¹äºŽå…¶ä»–æ•°æ®çš„å½¢çŠ¶ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç†è§£å‘ç”Ÿçš„äº‹æƒ…ï¼Œæˆ‘ä»¬æŸ¥çœ‹æœ‰å¤šå°‘ç‚¹æ˜¯å™ªå£°ï¼Œæœ‰å¤šå°‘ç‚¹åœ¨ç°‡å†…ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—æ‰€æœ‰ç°‡ä¸­çš„ç‚¹æ•°å’Œå™ªå£°ä¸­çš„ç‚¹æ•°</span></span><br><span class="line"><span class="comment"># bincountä¸å…è®¸è´Ÿå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ 1</span></span><br><span class="line"><span class="comment"># ç»“æžœä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—å¯¹åº”äºŽå™ªå£°ç‚¹</span></span><br><span class="line">print(<span class="string">'Number of points per cluster: &#123;&#125;'</span>.format(np.bincount(labels + <span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">noise = X_people[labels == <span class="number">-1</span>]</span><br><span class="line">fig, axes = plt.subplots(<span class="number">3</span>, <span class="number">11</span>, figsize=(<span class="number">12</span>, <span class="number">4</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: (), <span class="string">'frameon'</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> image, ax <span class="keyword">in</span> zip(noise, axes.ravel()):</span><br><span class="line">    ax.imshow(image.reshape(image_shape), vmin=<span class="number">0</span>, vmax=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Number of points per cluster: [  32 2031]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/noise-in-dbscan.png"></p><p>æˆ‘ä»¬å¯ä»¥çŒœæµ‹å®ƒä»¬è¢«æ ‡è®°ä¸ºå™ªå£°çš„åŽŸå› ï¼šç¬¬2è¡Œç¬¬3å¼ å›¾åƒæ˜¾ç¤ºä¸€ä¸ªäººæ­£åœ¨ç”¨çŽ»ç’ƒæ¯å–æ°´ï¼Œè¿˜æœ‰äººæˆ´å¸½å­ï¼Œäººè„¸å‰é¢æœ‰ä¸€åªæ‰‹çš„å›¾åƒã€‚å…¶ä»–å›¾åƒéƒ½åŒ…å«å¥‡æ€ªçš„è§’åº¦ï¼Œæˆ–è€…å¤ªè¿‘æˆ–å¤ªå®½çš„å‰ªåˆ‡ã€‚è¿™ç§ç±»åž‹çš„åˆ†æžâ€”â€”å°è¯•æ‰¾å‡ºâ€œå¥‡æ€ªçš„å“ªä¸€ä¸ªâ€â€”â€”è¢«ç§°ä¸º<strong>å¼‚å¸¸å€¼æ£€æµ‹</strong>ï¼ˆoutlier detectionï¼‰ã€‚å¦‚æžœè¿™æ˜¯ä¸€ä¸ªçœŸå®žçš„åº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šå°è¯•æ›´å¥½åœ°è£åˆ‡å›¾åƒï¼Œä»¥å¾—åˆ°æ›´åŠ å‡åŒ€çš„æ•°æ®ã€‚å¯¹äºŽç…§ç‰‡ä¸­çš„äººæœ‰æ—¶æˆ´ç€å¸½å­ã€å–æ°´æˆ–åœ¨é¢å‰ä¸¾ç€æŸç‰©ï¼Œæˆ‘ä»¬èƒ½åšçš„äº‹æƒ…å¾ˆå°‘ã€‚ä½†éœ€è¦çŸ¥é“å®ƒä»¬æ˜¯æ•°æ®ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œæˆ‘ä»¬åº”ç”¨ä»»ä½•ç®—æ³•éƒ½éœ€è¦è§£å†³è¿™äº›é—®é¢˜ã€‚</p><p>å¦‚æžœæˆ‘ä»¬æƒ³è¦æ‰¾åˆ°æ›´æœ‰è¶£çš„ç°‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªéžå¸¸å¤§çš„ç°‡ï¼Œé‚£ä¹ˆéœ€è¦å°†epsè®¾ç½®çš„å¾ˆå°ï¼Œå–å€¼åœ¨15å’Œ0.5ï¼ˆé»˜è®¤å€¼ï¼‰ä¹‹é—´ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹epsä¸åŒå–å€¼å¯¹åº”çš„ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> eps <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>]:</span><br><span class="line">    print(<span class="string">'\neps=&#123;&#125;'</span>.format(eps))</span><br><span class="line">    dbscan = DBSCAN(eps=eps, min_samples=<span class="number">3</span>)</span><br><span class="line">    labels = dbscan.fit_predict(X_pca)</span><br><span class="line">    print(<span class="string">'Clusters present: &#123;&#125;'</span>.format(np.unique(labels)))</span><br><span class="line">    print(<span class="string">'Cluster sizes: &#123;&#125;'</span>.format(np.bincount(labels + <span class="number">1</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eps=1</span><br><span class="line">Clusters present: [-1]</span><br><span class="line">Cluster sizes: [2063]</span><br><span class="line"></span><br><span class="line">eps=3</span><br><span class="line">Clusters present: [-1]</span><br><span class="line">Cluster sizes: [2063]</span><br><span class="line"></span><br><span class="line">eps=5</span><br><span class="line">Clusters present: [-1]</span><br><span class="line">Cluster sizes: [2063]</span><br><span class="line"></span><br><span class="line">eps=7</span><br><span class="line">Clusters present: [-1  0  1  2  3  4  5  6  7  8  9 10 11 12]</span><br><span class="line">Cluster sizes: [2004    3   14    7    4    3    3    4    4    3    3    5    3    3]</span><br><span class="line"></span><br><span class="line">eps=9</span><br><span class="line">Clusters present: [-1  0  1  2]</span><br><span class="line">Cluster sizes: [1307  750    3    3]</span><br><span class="line"></span><br><span class="line">eps=11</span><br><span class="line">Clusters present: [-1  0]</span><br><span class="line">Cluster sizes: [ 413 1650]</span><br><span class="line"></span><br><span class="line">eps=13</span><br><span class="line">Clusters present: [-1  0]</span><br><span class="line">Cluster sizes: [ 120 1943]</span><br></pre></td></tr></table></figure><p>å¯¹äºŽè¾ƒå°çš„epsï¼Œæ‰€æœ‰ç‚¹éƒ½è¢«æ ‡è®°ä¸ºå™ªå£°ã€‚eps=7æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°è®¸å¤šå™ªå£°ç‚¹å’Œè®¸å¤šè¾ƒå°çš„ç°‡ã€‚eps=9æ—¶ï¼Œæˆ‘ä»¬ä»å¾—åˆ°è®¸å¤šå™ªå£°ç‚¹ï¼Œä½†æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªè¾ƒå¤§çš„ç°‡å’Œä¸€äº›è¾ƒå°çš„ç°‡ã€‚ä»Žeps=11å¼€å§‹ï¼Œæˆ‘ä»¬ä»…å¾—åˆ°ä¸€ä¸ªè¾ƒå¤§çš„ç°‡å’Œå™ªå£°ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œ<strong>è¾ƒå¤§çš„ç°‡ä»Žæ¥æ²¡æœ‰è¶…è¿‡ä¸€ä¸ªã€‚æœ€å¤šæœ‰ä¸€ä¸ªè¾ƒå¤§çš„ç°‡åŒ…å«å¤§å¤šæ•°ç‚¹ï¼Œè¿˜æœ‰ä¸€äº›è¾ƒå°çš„ç°‡ã€‚è¿™è¡¨ç¤ºæ•°æ®ä¸­æ²¡æœ‰ä¸¤ç±»æˆ–ä¸‰ç±»éžå¸¸ä¸åŒçš„äººè„¸å›¾åƒï¼Œè€Œæ˜¯æ‰€æœ‰å›¾åƒæˆ–å¤šæˆ–å°‘åœ°éƒ½ä¸Žå…¶ä»–å›¾åƒå…·æœ‰ç›¸åŒçš„ç›¸ä¼¼åº¦ï¼ˆæˆ–ä¸ç›¸ä¼¼åº¦ï¼‰ã€‚</strong></p><p>eps=7çš„ç»“æžœçœ‹èµ·æ¥æœ€æœ‰è¶£ï¼Œå®ƒæœ‰è®¸å¤šè¾ƒå°çš„ç°‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dbscan = DBSCAN(min_samples=<span class="number">3</span>, eps=<span class="number">7</span>)</span><br><span class="line">labels = dbscan.fit_predict(X_pca)</span><br><span class="line"></span><br><span class="line">n_clusters = max(labels) + <span class="number">1</span></span><br><span class="line">masks = [labels == i <span class="keyword">for</span> i <span class="keyword">in</span> range(n_clusters)]</span><br><span class="line">n_cols = max(np.sum(mask) <span class="keyword">for</span> mask <span class="keyword">in</span> masks)</span><br><span class="line"></span><br><span class="line">content = []</span><br><span class="line">i = j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> mask <span class="keyword">in</span> masks:</span><br><span class="line">    <span class="keyword">if</span> n_cols - j - <span class="number">1</span> &lt; np.sum(mask):</span><br><span class="line">        i, j = i + <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> image, label <span class="keyword">in</span> zip(X_people[mask], y_people[mask]):</span><br><span class="line">        content.append((image, label, i, j))</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">n_rows = i + <span class="number">1</span></span><br><span class="line">fig, axes = plt.subplots(n_rows, n_cols,</span><br><span class="line">    figsize=(n_cols * <span class="number">1.5</span>, n_rows * <span class="number">2</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: (), <span class="string">'frameon'</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> image, label, i, j <span class="keyword">in</span> content:</span><br><span class="line">    ax = axes[i, j]</span><br><span class="line">    ax.imshow(image.reshape(image_shape), vmin=<span class="number">0</span>, vmax=<span class="number">1</span>)</span><br><span class="line">    ax.set_title(people.target_names[label].split()[<span class="number">-1</span>])</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/clusters-of-7-eps-dbscan.png"></p><p>æœ‰ä¸€äº›ç°‡å¯¹åº”äºŽæ•°æ®é›†ä¸­è„¸éƒ¨éžå¸¸ä¸åŒçš„äººï¼Œæ¯”å¦‚Sharonï¼ˆæ²™é¾™ï¼‰æˆ–Koizumiï¼ˆå°æ³‰ï¼‰ã€‚åœ¨æ¯ä¸ªç°‡ä¸­ï¼Œäººè„¸æ–¹å‘å’Œé¢éƒ¨è¡¨æƒ…ä¹Ÿæ˜¯å›ºå®šçš„ã€‚æœ‰äº›ç°‡ä¸­åŒ…å«å¤šä¸ªäººçš„é¢å­”ï¼Œä½†ä»–ä»¬çš„è¡¨æƒ…å’Œæ–¹å‘éƒ½ç›¸ä¼¼ã€‚</p><p>è¿™å°±æ˜¯å°†DBSCANç®—æ³•åº”ç”¨äºŽäººè„¸æ•°æ®é›†çš„åˆ†æžç»“è®ºã€‚å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬è¿™é‡Œè¿›è¡Œäº†äººå·¥åˆ†æžï¼Œä¸åŒäºŽç›‘ç£å­¦ä¹ ä¸­åŸºäºŽ<span class="math inline">\(R^2\)</span>åˆ†æ•°æˆ–ç²¾åº¦çš„æ›´ä¸ºè‡ªåŠ¨åŒ–çš„æ–¹æ³•ã€‚</p><h3 id="ç”¨kå‡å€¼åˆ†æž">ç”¨kå‡å€¼åˆ†æž</h3><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåˆ©ç”¨DBSCANæ— æ³•åˆ›å»ºå¤šäºŽä¸€ä¸ªè¾ƒå¤§çš„ç°‡ã€‚å‡èšèšç±»å’Œkå‡å€¼æ›´å¯èƒ½åˆ›å»ºå›æ‚¦å¤§å°çš„ç°‡ï¼Œä½†æˆ‘ä»¬éœ€è¦è®¾ç½®ç°‡çš„ç›®æ ‡ä¸ªæ•°ã€‚æˆ‘ä»¬å¯ä»¥å°†ç°‡çš„æ•°é‡è®¾ç½®ä¸ºæ•°æ®é›†ä¸­çš„å·²çŸ¥äººæ•°ï¼Œè™½ç„¶æ— ç›‘ç£èšç±»ç®—æ³•ä¸å¤ªå¯èƒ½å®Œå…¨æ‰¾åˆ°å®ƒä»¬ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥é¦–å…ˆè®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå°çš„ç°‡çš„æ•°é‡ï¼Œæ¯”å¦‚10ä¸ªï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ†æžæ¯ä¸ªç°‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”¨kå‡å€¼æå–ç°‡</span></span><br><span class="line">km = KMeans(n_clusters=<span class="number">10</span>, random_state=<span class="number">0</span>)</span><br><span class="line">labels_km = km.fit_predict(X_pca)</span><br><span class="line">print(<span class="string">'Cluster sizes k-means: &#123;&#125;'</span>.format(np.bincount(labels_km)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cluster sizes k-means: [155 175 238  75 358 257  91 219 323 172]</span><br></pre></td></tr></table></figure><p>kå‡å€¼èšç±»å°†æ•°æ®åˆ’åˆ†æˆå¤§å°ç›¸ä¼¼çš„ç°‡ï¼Œå…¶å¤§å°åœ¨75å’Œ358ä¹‹é—´ã€‚è¿™ä¸ŽDBSCANçš„ç»“æžœéžå¸¸ä¸åŒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç°‡ä¸­å¿ƒå¯è§†åŒ–æ¥è¿›ä¸€æ­¥åˆ†æžkå‡å€¼çš„ç»“æžœã€‚ç”±äºŽæˆ‘ä»¬æ˜¯åœ¨PCAç”Ÿæˆçš„è¡¨ç¤ºä¸­è¿›è¡Œèšç±»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>pca.inverse_transform</code>å°†ç°‡ä¸­å¿ƒæ—‹è½¬å›žåˆ°åŽŸå§‹ç©ºé—´å¹¶å¯è§†åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">5</span>, figsize=(<span class="number">12</span>, <span class="number">4</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> center, ax <span class="keyword">in</span> zip(km.cluster_centers_, axes.ravel()):</span><br><span class="line">    ax.imshow(pca.inverse_transform(center).reshape(image_shape),</span><br><span class="line">        vmin=<span class="number">0</span>, vmax=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/cluster-centers-of-kmeans-faces.png"></p><p>kå‡å€¼æ‰¾åˆ°çš„ç°‡ä¸­å¿ƒæ˜¯éžå¸¸å¹³æ»‘çš„äººè„¸ã€‚è¿™å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸ºæ¯ä¸ªç°‡ä¸­å¿ƒéƒ½æ˜¯è®¸å¤šå¼ äººè„¸å›¾åƒçš„å¹³å‡ã€‚ä½¿ç”¨é™ç»´çš„PCAè¡¨ç¤ºï¼Œå¯ä»¥å¢žåŠ å›¾åƒçš„å¹³æ»‘åº¦ï¼ˆå¯¹æ¯”åˆ©ç”¨100ä¸ªPCAç»´åº¦é‡å»ºçš„äººç‰©å›¾åƒï¼‰ã€‚èšç±»ä¼¼ä¹Žæ•æ‰åˆ°äººè„¸çš„ä¸åŒæ–¹å‘ï¼ˆä¸‹å›¾çš„ç¬¬7ä¸ªç°‡ï¼‰ã€ä¸åŒè¡¨æƒ…ï¼ˆä¸‹å›¾çš„ç¬¬4ä¸ªç°‡ï¼‰ã€‚ä¸‹å›¾ç»™å‡ºäº†æ›´è¯¦ç»†çš„è§†å›¾ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªç°‡ä¸­å¿ƒç»™å‡ºäº†ç°‡ä¸­5å¼ æœ€å…¸åž‹çš„å›¾åƒï¼ˆè¯¥ç°‡ä¸­ä¸Žç°‡ä¸­å¿ƒè·ç¦»æœ€è¿‘çš„å›¾åƒï¼‰ä¸Ž5å¼ æœ€ä¸å…¸åž‹çš„å›¾åƒï¼ˆè¯¥ç°‡ä¸­ä¸Žç°‡ä¸­å¿ƒè·ç¦»æœ€è¿œçš„å›¾åƒï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_kmeans_faces(km, pca, X_pca, X_people, y_people,</span><br><span class="line">    people.target_names)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/kmeans-faces-close-and-far.png"></p><p>â€œéžå…¸åž‹çš„â€ç‚¹ä¸Žç°‡ä¸­å¿ƒä¸å¤ªç›¸ä¼¼ï¼Œè€Œä¸”å®ƒä»¬çš„åˆ†é…ä¼¼ä¹Žæœ‰äº›éšæ„ã€‚è¿™å¯ä»¥å½’å› äºŽä»¥ä¸‹äº‹å®žï¼škå‡å€¼å¯¹æ‰€æœ‰æ•°æ®ç‚¹è¿›è¡Œåˆ’åˆ†ï¼Œä¸åƒDBSCANé‚£æ ·å…·æœ‰â€œå™ªå£°â€ç‚¹çš„æ¦‚å¿µã€‚åˆ©ç”¨æ›´å¤šæ•°é‡çš„ç°‡ï¼Œç®—æ³•å¯ä»¥æ‰¾åˆ°æ›´ç»†å¾®çš„åŒºåˆ«ã€‚ä½†æ·»åŠ æ›´å¤šçš„ç°‡ä¼šä½¿å¾—äººå·¥æ£€æŸ¥æ›´åŠ å›°éš¾ã€‚</p><h3 id="ç”¨å‡èšèšç±»åˆ†æž">ç”¨å‡èšèšç±»åˆ†æž</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”¨wardå‡èšèšç±»æå–ç°‡</span></span><br><span class="line">agglomerative = AgglomerativeClustering(n_clusters=<span class="number">10</span>)</span><br><span class="line">labels_agg = agglomerative.fit_predict(X_pca)</span><br><span class="line">print(<span class="string">'Cluster sizes agglomerative clustering: &#123;&#125;'</span>.format(</span><br><span class="line">    np.bincount(labels_agg)))</span><br><span class="line"><span class="comment"># é€šè¿‡è®¡ç®—ARIæ¥åº¦é‡å‡èšèšç±»å’Œkå‡å€¼ç»™å‡ºçš„ä¸¤ç§æ•°æ®åˆ’åˆ†æ˜¯å¦ç›¸ä¼¼</span></span><br><span class="line">print(<span class="string">'ARI: &#123;:.2f&#125;'</span>.format(adjusted_rand_score(labels_agg, labels_km)))</span><br><span class="line"><span class="comment"># ç»˜åˆ¶æ ‘çŠ¶å›¾ï¼Œé™åˆ¶äº†æ ‘çš„æ·±åº¦ï¼Œå› ä¸ºå¦‚æžœåˆ†æ”¯åˆ°2063ä¸ªæ•°æ®ç‚¹ï¼Œå›¾åƒå°†å¯†å¯†éº»éº»æ— æ³•é˜…è¯»</span></span><br><span class="line">linkage_array = ward(X_pca)</span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>, <span class="number">5</span>))</span><br><span class="line">dendrogram(linkage_array, p=<span class="number">7</span>, truncate_mode=<span class="string">'level'</span>, no_labels=<span class="literal">True</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Sample index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Cluster distance'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cluster sizes agglomerative clustering: [169 660 144 329 217  85  18 261  31 149]</span><br><span class="line">ARI: 0.09</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/agglomerative-clustering-dendrogram-on-faces.png"></p><p>å‡èšèšç±»ç”Ÿæˆçš„ç°‡å¤§å°åœ¨18å’Œ660ä¹‹é—´ã€‚è¿™æ¯”kå‡å€¼ç”Ÿæˆçš„ç°‡æ›´ä¸å‡åŒ€ï¼Œä½†æ¯”DBSCANç”Ÿæˆçš„ç°‡è¦æ›´å‡åŒ€ã€‚ARIåªæœ‰0.09ï¼Œè¯´æ˜Ž<code>labels_agg</code>å’Œ<code>labels_km</code>è¿™ä¸¤ç§èšç±»çš„å…±åŒç‚¹å¾ˆå°‘ã€‚è¿™ä¸å¥‡æ€ªï¼ŒåŽŸå› åœ¨äºŽä»¥ä¸‹äº‹å®žï¼šå¯¹äºŽkå‡å€¼ï¼Œè¿œç¦»ç°‡ä¸­å¿ƒçš„ç‚¹ä¼¼ä¹Žæ²¡æœ‰ä»€ä¹ˆå…±åŒç‚¹ã€‚</p><p>è¦æƒ³åˆ›å»º10ä¸ªç°‡ï¼Œæˆ‘ä»¬åœ¨é¡¶éƒ¨æœ‰10æ¡ç«–çº¿çš„ä½ç½®å°†æ ‘æ¨ªåˆ‡ã€‚åœ¨å›¾ç¤ºçš„çŽ©å…·æ•°æ®çš„æ ‘çŠ¶å›¾ä¸­ï¼Œä½ å¯ä»¥ä»Žåˆ†æ”¯é•¿åº¦ä¸­çœ‹å‡ºï¼Œä¸¤ä¸ªæˆ–ä¸‰ä¸ªç°‡å°±å¯ä»¥å¾ˆå¥½åœ°åˆ’åˆ†æ•°æ®ã€‚å¯¹äºŽäººè„¸æ•°æ®è€Œè¨€ï¼Œä¼¼ä¹Žæ²¡æœ‰éžå¸¸è‡ªç„¶çš„åˆ‡å‰²ç‚¹ã€‚æœ‰ä¸€äº›åˆ†æ”¯ä»£è¡¨æ›´ä¸ºä¸åŒçš„ç»„ï¼Œä½†ä¼¼ä¹Žæ²¡æœ‰ä¸€ä¸ªç‰¹åˆ«åˆé€‚çš„ç°‡çš„æ•°é‡ã€‚è¿™å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸ºDBSCANï¼ˆåŽŸä¹¦å¯èƒ½æœ‰é”™è¯¯ï¼Œæ­¤å¤„åº”è¯¥æ˜¯å‡èšèšç±»ï¼‰çš„ç»“æžœæ˜¯è§†å›¾å°†æ‰€æœ‰ç‚¹éƒ½èšç±»åœ¨ä¸€èµ·ã€‚</p><p>æˆ‘ä»¬å°†10ä¸ªç°‡å¯è§†åŒ–ï¼Œæ­£å¦‚ä¹‹å‰å¯¹kå‡å€¼æ‰€åšçš„é‚£æ ·ã€‚åœ¨å‡èšèšç±»ä¸­æ²¡æœ‰ç°‡ä¸­å¿ƒçš„æ¦‚å¿µï¼ˆè™½ç„¶æˆ‘ä»¬è®¡ç®—å¹³å‡å€¼ï¼‰ï¼Œæˆ‘ä»¬åªæ˜¯ç»™å‡ºäº†æ¯ä¸ªç°‡çš„å‰å‡ ä¸ªç‚¹ã€‚æˆ‘ä»¬åœ¨ç¬¬ä¸€å¼ å›¾çš„å·¦ä¾§ç»™å‡ºäº†æ¯ä¸ªç°‡ä¸­çš„ç‚¹çš„æ•°é‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n_clusters = <span class="number">10</span></span><br><span class="line">flg, axes = plt.subplots(n_clusters, <span class="number">10</span>, figsize=(<span class="number">15</span>, <span class="number">2</span> * n_clusters),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> cluster <span class="keyword">in</span> range(n_clusters):</span><br><span class="line">    mask = labels_agg == cluster</span><br><span class="line">    axes[cluster, <span class="number">0</span>].set_ylabel(np.sum(mask))</span><br><span class="line">    <span class="keyword">for</span> image, label, asdf, ax <span class="keyword">in</span> zip(X_people[mask],</span><br><span class="line">            y_people[mask], labels_agg[mask], axes[cluster]):</span><br><span class="line">        ax.imshow(image.reshape(image_shape), vmin=<span class="number">0</span>, vmax=<span class="number">1</span>)</span><br><span class="line">        ax.set_title(people.target_names[label].split()[<span class="number">-1</span>],</span><br><span class="line">            fontdict=&#123;<span class="string">'fontsize'</span>: <span class="number">9</span>&#125;)</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/clusters-of-agglomerative-clustering.png"></p><p>è™½ç„¶æŸäº›ç°‡ä¼¼ä¹Žå…·æœ‰è¯­ä¹‰ä¸Šçš„ä¸»é¢˜ï¼Œä½†è®¸å¤šç°‡éƒ½å¤ªå¤§è€Œå®žé™…ä¸Šå¾ˆéš¾æ˜¯å‡åŒ€çš„ã€‚</p><h3 id="èšç±»æ–¹æ³•å°ç»“">èšç±»æ–¹æ³•å°ç»“</h3><p>èšç±»çš„åº”ç”¨ä¸Žè¯„ä¼°æ˜¯ä¸€ä¸ªéžå¸¸å®šæ€§çš„è¿‡ç¨‹ï¼Œé€šå¸¸åœ¨æ•°æ®åˆ†æžçš„æŽ¢ç´¢é˜¶æ®µå¾ˆæœ‰å¸®åŠ©ã€‚æˆ‘ä»¬å­¦ä¹ äº†ä¸‰ç§èšç±»ç®—æ³•ï¼škå‡å€¼ã€DBSCANå’Œå‡èšèšç±»ã€‚è¿™ä¸‰ç§ç®—æ³•éƒ½å¯ä»¥æŽ§åˆ¶èšç±»çš„ç²’åº¦ï¼ˆgranularityï¼‰ã€‚kå‡å€¼å’Œå‡èšèšç±»å…è®¸ä½ æŒ‡å®šæƒ³è¦çš„ç°‡çš„æ•°é‡ï¼Œè€ŒDBSCANå…è®¸ä½ ç”¨epså‚æ•°å®šä¹‰æŽ¥è¿‘ç¨‹åº¦ï¼Œä»Žè€Œé—´æŽ¥å½±å“ç°‡çš„å¤§å°ã€‚</p><p>æ¯ç§ç®—æ³•çš„ä¼˜ç‚¹ç¨æœ‰ä¸åŒã€‚kå‡å€¼å¯ä»¥ç”¨ç°‡çš„å¹³å‡å€¼æ¥è¡¨ç¤ºç°‡ã€‚å®ƒè¿˜å¯ä»¥è¢«çœ‹ä½œä¸€ç§åˆ†è§£æ–¹æ³•ï¼Œæ¯ä¸ªæ•°æ®ç‚¹éƒ½ç”±å…¶ç°‡ä¸­å¿ƒè¡¨ç¤ºã€‚DBSCANå¯ä»¥æ£€æµ‹åˆ°æ²¡æœ‰åˆ†é…ä»»ä½•ç°‡çš„â€œå™ªå£°ç‚¹â€ï¼Œè¿˜å¯ä»¥å¸®åŠ©è‡ªåŠ¨åˆ¤æ–­ç°‡çš„æ•°é‡ã€‚ä¸Žå…¶ä»–ä¸¤ç§æ–¹æ³•ä¸åŒï¼Œå®ƒå…è®¸ç°‡å…·æœ‰å¤æ‚çš„å½¢çŠ¶ã€‚DBSCANæœ‰æ—¶ä¼šç”Ÿæˆå¤§å°å·®åˆ«å¾ˆå¤§çš„ç°‡ï¼Œè¿™å¯èƒ½æ˜¯å®ƒçš„ä¼˜ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¼ºç‚¹ã€‚å‡èšèšç±»å¯ä»¥æä¾›æ•°æ®çš„å¯èƒ½åˆ’åˆ†çš„æ•´ä¸ªå±‚æ¬¡ç»“æž„ï¼Œå¯ä»¥é€šè¿‡æ ‘çŠ¶å›¾è½»æ¾æŸ¥çœ‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> unsupervised </tag>
            
            <tag> clustering </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é™ç»´ã€ç‰¹å¾æå–ä¸Žæµå½¢å­¦ä¹ </title>
      <link href="/notes/introduction-to-ml-with-python/dimensionality-reduction-feature-extraction-and-manifold-learning/"/>
      <url>/notes/introduction-to-ml-with-python/dimensionality-reduction-feature-extraction-and-manifold-learning/</url>
      
        <content type="html"><![CDATA[<p>åˆ©ç”¨æ— ç›‘ç£å­¦ä¹ è¿›è¡Œæ•°æ®å˜æ¢å¯èƒ½æœ‰å¾ˆå¤šç§ç›®çš„ã€‚æœ€å¸¸è§çš„ç›®çš„å°±æ˜¯å¯è§†åŒ–ã€åŽ‹ç¼©æ•°æ®ï¼Œä»¥åŠå¯»æ‰¾ä¿¡æ¯é‡æ›´å¤§çš„æ•°æ®è¡¨ç¤ºä»¥ç”¨äºŽè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</p><p>ä¸ºäº†å®žçŽ°è¿™äº›ç›®çš„ï¼Œæœ€ç®€å•ä¹Ÿæœ€å¸¸ç”¨çš„ä¸€ç§ç®—æ³•å°±æ˜¯ä¸»æˆåˆ†åˆ†æžã€‚æˆ‘ä»¬ä¹Ÿå°†å­¦ä¹ å¦å¤–ä¸¤ç§ç®—æ³•ï¼šéžè´ŸçŸ©é˜µåˆ†è§£ï¼ˆNMFï¼‰å’Œt-SNEï¼Œå‰è€…é€šå¸¸ç”¨äºŽç‰¹å¾æå–ï¼ŒåŽè€…é€šå¸¸ç”¨äºŽäºŒç»´æ•£ç‚¹çš„å¯è§†åŒ–ã€‚</p><h1 id="ä¸»æˆåˆ†åˆ†æž">ä¸»æˆåˆ†åˆ†æž</h1><p>ä¸»æˆåˆ†åˆ†æžï¼ˆprincipal component analysisï¼ŒPCAï¼‰æ˜¯ä¸€ç§æ—‹è½¬æ•°æ®é›†çš„æ–¹æ³•ï¼Œæ—‹è½¬åŽçš„ç‰¹å¾åœ¨ç»Ÿè®¡ä¸Šä¸ç›¸å…³ã€‚åœ¨åšå®Œè¿™ç§æ—‹è½¬ä¹‹åŽï¼Œé€šå¸¸æ˜¯æ ¹æ®æ–°ç‰¹å¾å¯¹è§£é‡Šæ•°æ®çš„é‡è¦æ€§æ¥é€‰æ‹©å®ƒçš„ä¸€ä¸ªå­é›†ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†PCAå¯¹ä¸€ä¸ªæ¨¡æ‹ŸäºŒç»´æ•°æ®é›†çš„ä½œç”¨ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.decomposition.pca" target="_blank" rel="noopener"><code>class sklearn.decomposition.PCA(n_components=None, copy=True, whiten=False, svd_solver=â€™autoâ€™, tol=0.0, iterated_power=â€™autoâ€™, random_state=None)</code></a></p><p>Principal component analysis (PCA)</p></blockquote><a id="more"></a><h2 id="å°†pcaåº”ç”¨äºŽæ¨¡æ‹Ÿæ•°æ®">å°†PCAåº”ç”¨äºŽæ¨¡æ‹Ÿæ•°æ®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡½æ•°æºç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_pca_illustration</span><span class="params">()</span>:</span></span><br><span class="line">    rnd = np.random.RandomState(<span class="number">5</span>)</span><br><span class="line">    X_ = rnd.normal(size=(<span class="number">300</span>, <span class="number">2</span>))</span><br><span class="line">    X_blob = np.dot(X_, rnd.normal(size=(<span class="number">2</span>, <span class="number">2</span>))) + rnd.normal(size=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    pca = PCA()</span><br><span class="line">    pca.fit(X_blob)</span><br><span class="line">    X_pca = pca.transform(X_blob)</span><br><span class="line"></span><br><span class="line">    S = X_pca.std(axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">    axes = axes.ravel()</span><br><span class="line"></span><br><span class="line">    axes[<span class="number">0</span>].set_title(<span class="string">"Original data"</span>)</span><br><span class="line">    axes[<span class="number">0</span>].scatter(X_blob[:, <span class="number">0</span>], X_blob[:, <span class="number">1</span>], c=X_pca[:, <span class="number">0</span>], linewidths=<span class="number">0</span>,</span><br><span class="line">                    s=<span class="number">60</span>, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    axes[<span class="number">0</span>].set_xlabel(<span class="string">"feature 1"</span>)</span><br><span class="line">    axes[<span class="number">0</span>].set_ylabel(<span class="string">"feature 2"</span>)</span><br><span class="line">    axes[<span class="number">0</span>].arrow(pca.mean_[<span class="number">0</span>], pca.mean_[<span class="number">1</span>], S[<span class="number">0</span>] * pca.components_[<span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                  S[<span class="number">0</span>] * pca.components_[<span class="number">0</span>, <span class="number">1</span>], width=<span class="number">.1</span>, head_width=<span class="number">.3</span>,</span><br><span class="line">                  color=<span class="string">'k'</span>)</span><br><span class="line">    axes[<span class="number">0</span>].arrow(pca.mean_[<span class="number">0</span>], pca.mean_[<span class="number">1</span>], S[<span class="number">1</span>] * pca.components_[<span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">                  S[<span class="number">1</span>] * pca.components_[<span class="number">1</span>, <span class="number">1</span>], width=<span class="number">.1</span>, head_width=<span class="number">.3</span>,</span><br><span class="line">                  color=<span class="string">'k'</span>)</span><br><span class="line">    axes[<span class="number">0</span>].text(<span class="number">-1.5</span>, <span class="number">-.5</span>, <span class="string">"Component 2"</span>, size=<span class="number">14</span>)</span><br><span class="line">    axes[<span class="number">0</span>].text(<span class="number">-4</span>, <span class="number">-4</span>, <span class="string">"Component 1"</span>, size=<span class="number">14</span>)</span><br><span class="line">    axes[<span class="number">0</span>].set_aspect(<span class="string">'equal'</span>)</span><br><span class="line"></span><br><span class="line">    axes[<span class="number">1</span>].set_title(<span class="string">"Transformed data"</span>)</span><br><span class="line">    axes[<span class="number">1</span>].scatter(X_pca[:, <span class="number">0</span>], X_pca[:, <span class="number">1</span>], c=X_pca[:, <span class="number">0</span>], linewidths=<span class="number">0</span>,</span><br><span class="line">                    s=<span class="number">60</span>, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    axes[<span class="number">1</span>].set_xlabel(<span class="string">"First principal component"</span>)</span><br><span class="line">    axes[<span class="number">1</span>].set_ylabel(<span class="string">"Second principal component"</span>)</span><br><span class="line">    axes[<span class="number">1</span>].set_aspect(<span class="string">'equal'</span>)</span><br><span class="line">    axes[<span class="number">1</span>].set_ylim(<span class="number">-8</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    pca = PCA(n_components=<span class="number">1</span>)</span><br><span class="line">    pca.fit(X_blob)</span><br><span class="line">    X_inverse = pca.inverse_transform(pca.transform(X_blob))</span><br><span class="line"></span><br><span class="line">    axes[<span class="number">2</span>].set_title(<span class="string">"Transformed data w/ second component dropped"</span>)</span><br><span class="line">    axes[<span class="number">2</span>].scatter(X_pca[:, <span class="number">0</span>], np.zeros(X_pca.shape[<span class="number">0</span>]), c=X_pca[:, <span class="number">0</span>],</span><br><span class="line">                    linewidths=<span class="number">0</span>, s=<span class="number">60</span>, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    axes[<span class="number">2</span>].set_xlabel(<span class="string">"First principal component"</span>)</span><br><span class="line">    axes[<span class="number">2</span>].set_aspect(<span class="string">'equal'</span>)</span><br><span class="line">    axes[<span class="number">2</span>].set_ylim(<span class="number">-8</span>, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">    axes[<span class="number">3</span>].set_title(<span class="string">"Back-rotation using only first component"</span>)</span><br><span class="line">    axes[<span class="number">3</span>].scatter(X_inverse[:, <span class="number">0</span>], X_inverse[:, <span class="number">1</span>], c=X_pca[:, <span class="number">0</span>],</span><br><span class="line">                    linewidths=<span class="number">0</span>, s=<span class="number">60</span>, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    axes[<span class="number">3</span>].set_xlabel(<span class="string">"feature 1"</span>)</span><br><span class="line">    axes[<span class="number">3</span>].set_ylabel(<span class="string">"feature 2"</span>)</span><br><span class="line">    axes[<span class="number">3</span>].set_aspect(<span class="string">'equal'</span>)</span><br><span class="line">    axes[<span class="number">3</span>].set_xlim(<span class="number">-8</span>, <span class="number">4</span>)</span><br><span class="line">    axes[<span class="number">3</span>].set_ylim(<span class="number">-8</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">mglearn.plots.plot_pca_illustration()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/pca.png"></p><p>ç®—æ³•é¦–å…ˆæ‰¾åˆ°æ–¹æ³•æœ€å¤§çš„æ–¹å‘ï¼Œå°†å…¶æ ‡è®°ä¸ºâ€œæˆåˆ†1â€ï¼ˆComponent 1ï¼‰ã€‚è¿™æ˜¯æ•°æ®ä¸­åŒ…å«æœ€å¤šä¿¡æ¯çš„æ–¹å‘ï¼ˆæˆ–å‘é‡ï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œæ²¿ç€è¿™ä¸ªæ–¹å‘çš„ç‰¹å¾ä¹‹é—´æœ€ä¸ºç›¸å…³ã€‚ç„¶åŽï¼Œç®—æ³•æ‰¾åˆ°ä¸Žç¬¬ä¸€ä¸ªæ–¹å‘æ­£äº¤ï¼ˆæˆç›´è§’ï¼‰ä¸”åŒ…å«æœ€å¤šä¿¡æ¯çš„æ–¹å‘ã€‚åœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæˆç›´è§’çš„æ–¹å‘ï¼Œä½†åœ¨æ›´é«˜ç»´çš„ç©ºé—´ä¸­ä¼šæœ‰ï¼ˆæ— ç©·ï¼‰å¤šçš„æ­£äº¤æ–¹å‘ã€‚è™½ç„¶è¿™ä¸¤ä¸ªæˆåˆ†éƒ½ç”»æˆç®­å¤´ï¼Œä½†å…¶å¤´å°¾çš„ä½ç½®å¹¶ä¸é‡è¦ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç¬¬ä¸€ä¸ªæˆåˆ†åŒ–æˆä»Žä¸­å¿ƒæŒ‡å‘å·¦ä¸Šï¼Œè€Œä¸æ˜¯å³ä¸‹ã€‚åˆ©ç”¨è¿™ä¸€è¿‡ç¨‹æ‰¾åˆ°çš„æ–¹å‘è¢«ç§°ä¸ºä¸»æˆåˆ†ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æ•°æ®æ–¹å·®çš„ä¸»è¦æ–¹å‘ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸»æˆåˆ†çš„ä¸ªæ•°ä¸ŽåŽŸå§‹ç‰¹å¾ç›¸åŒã€‚</p><p>ç¬¬äºŒå¼ å›¾ï¼ˆå³ä¸Šï¼‰æ˜¾ç¤ºçš„æ˜¯åŒæ ·çš„æ•°æ®ï¼Œä½†çŽ°åœ¨å°†å…¶æ—‹è½¬ï¼Œä½¿å¾—ç¬¬ä¸€ä¸»æˆåˆ†ä¸Žxè½´å¹³è¡Œä¸”ç¬¬äºŒä¸»æˆåˆ†ä¸Žyè½´å¹³è¡Œã€‚åœ¨æ—‹è½¬ä¹‹å‰ï¼Œä»Žæ•°æ®ä¸­å‡åŽ»å¹³å‡å€¼ï¼Œä½¿å¾—å˜æ¢åŽçš„æ•°æ®ä»¥é›¶ä¸ºä¸­å¿ƒã€‚åœ¨PCAæ‰¾åˆ°çš„æ—‹è½¬è¡¨ç¤ºä¸­ï¼Œä¸¤ä¸ªåæ ‡è½´æ˜¯ä¸ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽè¿™ç§æ•°æ®è¡¨ç¤ºï¼Œé™¤äº†å¯¹è§’çº¿ï¼Œç›¸å…³çŸ©é˜µå…¨éƒ¨ä¸ºé›¶ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä¿ç•™ä¸€éƒ¨åˆ†ä¸»æˆåˆ†æ¥ä½¿ç”¨PCAè¿›è¡Œé™ç»´ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä¿ç•™ç¬¬ä¸€ä¸»æˆåˆ†ï¼Œæ­£å¦‚ç¬¬ä¸‰å¼ å›¾ï¼ˆå·¦ä¸‹ï¼‰æ‰€ç¤ºã€‚è¿™å°†æ•°æ®ä»ŽäºŒç»´æ•°æ®é›†é™ä¸ºä¸€ç»´æ•°æ®é›†ã€‚ä½†è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¿ç•™åŽŸå§‹ç‰¹å¾ä¹‹ä¸€ï¼Œè€Œæ˜¯æ‰¾åˆ°äº†æœ€æœ‰è¶£çš„æ–¹å‘ï¼ˆç¬¬ä¸€å¼ å›¾ä¸­ä»Žå·¦ä¸Šåˆ°å³ä¸‹ï¼‰å¹¶ä¿ç•™è¿™ä¸€æ–¹å‘ï¼Œå³ç¬¬ä¸€ä¸»æˆåˆ†ã€‚</p><p>æœ€åŽï¼Œæˆ‘ä»¬å¯ä»¥åå‘æ—‹è½¬å¹¶å°†å¹³å‡å€¼é‡æ–°åŠ åˆ°æ•°æ®é›†ä¸­ã€‚è¿™æ ·ä¼šå¾—åˆ°æœ€åŽä¸€å¼ å›¾ä¸­çš„æ•°æ®ã€‚è¿™äº›æ•°æ®ç‚¹ä½äºŽåŽŸå§‹ç‰¹å¾ç©ºé—´ä¸­ï¼Œä½†æˆ‘ä»¬ä»…ä¿ç•™äº†ç¬¬ä¸€ä¸»æˆåˆ†ä¸­åŒ…å«çš„ä¿¡æ¯ã€‚è¿™ç§å˜æ¢æœ‰æ—¶ç”¨äºŽåŽ»é™¤æ•°æ®ä¸­çš„å™ªå£°å½±å“ï¼Œæˆ–è€…å°†ä¸»æˆåˆ†ä¸­ä¿ç•™çš„é‚£éƒ¨åˆ†ä¿¡æ¯å¯è§†åŒ–ã€‚</p><h2 id="å°†pcaåº”ç”¨äºŽcanceræ•°æ®é›†å¹¶å¯è§†åŒ–">å°†PCAåº”ç”¨äºŽcanceræ•°æ®é›†å¹¶å¯è§†åŒ–</h2><p>PCAæœ€å¸¸è§çš„åº”ç”¨ä¹‹ä¸€å°±æ˜¯å°†é«˜ç»´æ•°æ®å¯è§†åŒ–ã€‚å¯¹äºŽæœ‰ä¸¤ä¸ªä»¥ä¸Šç‰¹å¾çš„æ•°æ®ï¼Œå¾ˆéš¾ç»˜åˆ¶æ•£ç‚¹å›¾ã€‚å¯¹äºŽIrisï¼ˆé¸¢å°¾èŠ±ï¼‰æ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæ•£ç‚¹å›¾çŸ©é˜µï¼Œé€šè¿‡å±•ç¤ºç‰¹å¾æ‰€æœ‰å¯èƒ½çš„ä¸¤ä¸¤ç»„å’Œæ¥å±•ç¤ºæ•°æ®çš„å±€éƒ¨å›¾åƒã€‚ä½†å¦‚æžœæˆ‘ä»¬æƒ³è¦æŸ¥çœ‹ä¹³è…ºç™Œæ•°æ®é›†ï¼Œå³ä¾¿ç”¨æ•£ç‚¹å›¾çŸ©é˜µä¹Ÿå¾ˆå›°éš¾ã€‚è¿™ä¸ªæ•°æ®é›†åŒ…å«30ä¸ªç‰¹å¾ï¼Œè¿™å°±å¯¼è‡´éœ€è¦ç»˜åˆ¶<code>30*14=420</code>å¼ æ•£ç‚¹å›¾ï¼æˆ‘ä»¬æ°¸è¿œä¸å¯èƒ½ä»”ç»†è§‚å¯Ÿæ‰€æœ‰è¿™äº›å›¾åƒï¼Œæ›´ä¸ç”¨è¯´è¯•å›¾ç†è§£å®ƒä»¬äº†ã€‚</p><p>ä¸è¿‡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æ›´ç®€å•çš„å¯è§†åŒ–æ–¹æ³•â€”â€”å¯¹æ¯ä¸ªç‰¹å¾åˆ†åˆ«è®¡ç®—ä¸¤ä¸ªç±»åˆ«ï¼ˆè‰¯æ€§è‚¿ç˜¤å’Œæ¶æ€§è‚¿ç˜¤ï¼‰çš„ç›´æ–¹å›¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">15</span>, <span class="number">2</span>, figsize=(<span class="number">10</span>, <span class="number">20</span>))</span><br><span class="line">malignant = cancer.data[cancer.target == <span class="number">0</span>]</span><br><span class="line">benign = cancer.data[cancer.target == <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">ax = axes.ravel()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">    _, bins = np.histogram(cancer.data[:, i], bins=<span class="number">50</span>)</span><br><span class="line">    ax[i].hist(malignant[:, i], bins=bins, color=mglearn.cm3(<span class="number">0</span>), alpha=<span class="number">.5</span>)</span><br><span class="line">    ax[i].hist(benign[:, i], bins=bins, color=mglearn.cm3(<span class="number">2</span>), alpha=<span class="number">.5</span>)</span><br><span class="line">    ax[i].set_title(cancer.feature_names[i])</span><br><span class="line">    ax[i].set_yticks(())</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>].set_xlabel(<span class="string">'Feature magnitude'</span>)</span><br><span class="line">ax[<span class="number">0</span>].set_ylabel(<span class="string">'Frequency'</span>)</span><br><span class="line">ax[<span class="number">0</span>].legend([<span class="string">'malignant'</span>, <span class="string">'benign'</span>], loc=<span class="string">'best'</span>)</span><br><span class="line">fig.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/feature-hist.png"></p><p>è¿™é‡Œæˆ‘ä»¬ä¸ºæ¯ä¸ªç‰¹å¾åˆ›å»ºä¸€ä¸ªç›´æ–¹å›¾ï¼Œè®¡ç®—å…·æœ‰æŸä¸€ç‰¹å¾çš„æ•°æ®ç‚¹åœ¨ç‰¹å®šèŒƒå›´å†…ï¼ˆå«ä½œbinï¼‰çš„å‡ºçŽ°é¢‘çŽ‡ã€‚æ¯å¼ å›¾éƒ½åŒ…å«ä¸¤ä¸ªç›´æ–¹å›¾ï¼Œä¸€ä¸ªæ˜¯è‰¯æ€§ç±»åˆ«çš„æ‰€æœ‰ç‚¹ï¼ˆè“è‰²ï¼‰ï¼Œä¸€ä¸ªæ˜¯æ¶æ€§ç±»åˆ«çš„æ‰€æœ‰ç‚¹ï¼ˆçº¢è‰²ï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥äº†è§£æ¯ä¸ªç‰¹å¾åœ¨ä¸¤ä¸ªç±»åˆ«ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä¹Ÿå¯ä»¥çŒœæµ‹å“ªäº›ç‰¹å¾èƒ½å¤Ÿæ›´å¥½åœ°åŒºåˆ†è‰¯æ€§æ ·æœ¬å’Œæ¶æ€§æ ·æœ¬ã€‚ä¾‹å¦‚ï¼Œâ€œsmoothness errorâ€ç‰¹å¾ä¼¼ä¹Žæ²¡æœ‰ä»€ä¹ˆä¿¡æ¯é‡ï¼Œå› ä¸ºä¸¤ä¸ªç›´æ–¹å›¾å¤§éƒ¨åˆ†éƒ½é‡å åœ¨ä¸€èµ·ï¼Œè€Œâ€œworst concave pointsâ€ç‰¹å¾çœ‹èµ·æ¥ä¿¡æ¯é‡ç›¸å½“å¤§ï¼Œå› ä¸ºä¸¤ä¸ªç›´æ–¹å›¾çš„äº¤é›†å¾ˆå°ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§å›¾æ— æ³•å‘æˆ‘ä»¬å±•ç¤ºå˜é‡ä¹‹é—´çš„ç›¸äº’ä½œç”¨ä»¥åŠè¿™ç§ç›¸äº’ä½œç”¨ä¸Žç±»åˆ«ä¹‹é—´çš„å…³ç³»ã€‚<strong>åˆ©ç”¨PCAï¼Œæˆ‘ä»¬å¯ä»¥èŽ·å–åˆ°ä¸»è¦çš„ç›¸äº’ä½œç”¨ï¼Œå¹¶å¾—åˆ°ç¨ä¸ºå®Œæ•´çš„å›¾åƒã€‚</strong>æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å‰ä¸¤ä¸ªä¸»æˆåˆ†ï¼Œå¹¶åœ¨è¿™ä¸ªæ–°çš„äºŒç»´ç©ºé—´ä¸­ç”¨æ•£ç‚¹å›¾å°†æ•°æ®å¯è§†åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨åº”ç”¨PCAä¹‹å‰ï¼Œåˆ©ç”¨StandardScalerç¼©æ”¾æ•°æ®ï¼Œä½¿æ¯ä¸ªç‰¹å¾çš„æ–¹å·®å‡ä¸º1</span></span><br><span class="line">scaler = StandardScaler()</span><br><span class="line">scaler.fit(cancer.data)</span><br><span class="line">X_scaled = scaler.transform(cancer.data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿ç•™æ•°æ®çš„å‰ä¸¤ä¸ªä¸»è¦æˆåˆ†</span></span><br><span class="line">pca = PCA(n_components=<span class="number">2</span>)</span><br><span class="line"><span class="comment"># å¯¹ä¹³è…ºç™Œæ•°æ®æ‹ŸåˆPCAæ¨¡åž‹</span></span><br><span class="line">pca.fit(X_scaled)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®å˜æ¢åˆ°å‰ä¸¤ä¸ªä¸»è¦æˆåˆ†ä¸Š</span></span><br><span class="line">X_pca = pca.transform(X_scaled)</span><br><span class="line">print(<span class="string">'Original shape: &#123;&#125;'</span>.format(str(X_scaled.shape)))</span><br><span class="line">print(<span class="string">'Reduced shape: &#123;&#125;'</span>.format(str(X_pca.shape)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªä¸»æˆåˆ†ä½œå›¾ï¼ŒæŒ‰ç±»åˆ«ç€è‰²</span></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">mglearn.discrete_scatter(X_pca[:, <span class="number">0</span>], X_pca[:, <span class="number">1</span>], cancer.target)</span><br><span class="line">plt.legend(cancer.target_names, loc=<span class="string">'best'</span>)</span><br><span class="line">plt.gca().set_aspect(<span class="string">'equal'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'First principal component'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Second principal component'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Original shape: (569, 30)</span><br><span class="line">Reduced shape: (569, 2)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/pca-on-cancer.png"></p><p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒPCAæ˜¯ä¸€ç§æ— ç›‘ç£æ–¹æ³•ï¼Œåœ¨å¯»æ‰¾æ—‹è½¬æ–¹å‘æ—¶æ²¡æœ‰ç”¨åˆ°ä»»ä½•ç±»åˆ«ä¿¡æ¯ã€‚å®ƒåªæ˜¯è§‚å¯Ÿæ•°æ®ä¸­çš„ç›¸å…³æ€§ã€‚å¯¹äºŽè¿™é‡Œæ‰€ç¤ºçš„æ•£ç‚¹å›¾ï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†ç¬¬ä¸€ä¸»æˆåˆ†å’Œç¬¬äºŒä¸»æˆåˆ†ä¹‹é—´çš„å…³ç³»ï¼Œç„¶åŽåˆ©ç”¨ç±»åˆ«ä¿¡æ¯å¯¹æ•°æ®ç‚¹è¿›è¡Œç€è‰²ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªäºŒç»´ç©ºé—´ä¸­ä¸¤ä¸ªç±»åˆ«è¢«å¾ˆå¥½çš„åˆ†ç¦»ã€‚è¿™è®©æˆ‘ä»¬ç›¸ä¿¡ï¼Œå³ä½¿æ˜¯çº¿æ€§åˆ†ç±»å™¨ï¼ˆåœ¨è¿™ä¸ªç©ºé—´ä¸­å­¦ä¹ ä¸€æ¡ç›´çº¿ï¼‰ä¹Ÿå¯ä»¥åœ¨åŒºåˆ†è¿™ä¸¤ä¸ªç±»åˆ«æ—¶è¡¨çŽ°å¾—ç›¸å½“ä¸é”™ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œæ¶æ€§ç‚¹æ¯”è‰¯æ€§ç‚¹æ›´åŠ åˆ†æ•£ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥åœ¨ç›´æ–¹å›¾ä¸­çœ‹å‡ºæ¥ã€‚</p><p>PCAçš„ä¸€ä¸ªç¼ºç‚¹åœ¨äºŽï¼Œé€šå¸¸ä¸å®¹æ˜“å¯¹å›¾ä¸­çš„ä¸¤ä¸ªè½´åšå‡ºè§£é‡Šã€‚ä¸»æˆåˆ†å¯¹åº”äºŽåŽŸå§‹æ•°æ®ä¸­çš„æ–¹å‘ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯åŽŸå§‹ç‰¹å¾çš„ç»„åˆã€‚ä½†è¿™äº›ç»„åˆå¾€å¾€éžå¸¸å¤æ‚ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ã€‚åœ¨æ‹Ÿåˆè¿‡ç¨‹ä¸­ï¼Œä¸»æˆåˆ†è¢«ä¿å­˜åœ¨PCAå¯¹è±¡çš„<code>components_</code>å±žæ€§ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'PCA component shape: &#123;&#125;'</span>.format(pca.components_.shape))</span><br><span class="line">print(<span class="string">'PCA components:\n&#123;&#125;'</span>.format(pca.components_))</span><br><span class="line"><span class="comment"># ç”¨çƒ­å›¾å°†ç³»æ•°å¯è§†åŒ–</span></span><br><span class="line">plt.matshow(pca.components_, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">plt.yticks([<span class="number">0</span>, <span class="number">1</span>], [<span class="string">'First component'</span>, <span class="string">'Second component'</span>])</span><br><span class="line">plt.colorbar()</span><br><span class="line">plt.xticks(range(len(cancer.feature_names)),</span><br><span class="line">    cancer.feature_names, rotation=<span class="number">60</span>, ha=<span class="string">'left'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Principal components'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PCA component shape: (2, 30)</span><br><span class="line">PCA components:</span><br><span class="line">[[ 0.21890244  0.10372458  0.22753729  0.22099499  0.14258969  0.23928535</span><br><span class="line">   0.25840048  0.26085376  0.13816696  0.06436335  0.20597878  0.01742803</span><br><span class="line">   0.21132592  0.20286964  0.01453145  0.17039345  0.15358979  0.1834174</span><br><span class="line">   0.04249842  0.10256832  0.22799663  0.10446933  0.23663968  0.22487053</span><br><span class="line">   0.12795256  0.21009588  0.22876753  0.25088597  0.12290456  0.13178394]</span><br><span class="line"> [-0.23385713 -0.05970609 -0.21518136 -0.23107671  0.18611302  0.15189161</span><br><span class="line">   0.06016536 -0.0347675   0.19034877  0.36657547 -0.10555215  0.08997968</span><br><span class="line">  -0.08945723 -0.15229263  0.20443045  0.2327159   0.19720728  0.13032156</span><br><span class="line">   0.183848    0.28009203 -0.21986638 -0.0454673  -0.19987843 -0.21935186</span><br><span class="line">   0.17230435  0.14359317  0.09796411 -0.00825724  0.14188335  0.27533947]]</span><br></pre></td></tr></table></figure><p><code>components_</code>ä¸­çš„æ¯ä¸€è¡Œå¯¹åº”äºŽä¸€ä¸ªä¸»æˆåˆ†ï¼Œå®ƒä»¬æŒ‰é‡è¦æ€§æŽ’åºï¼ˆç¬¬ä¸€ä¸»æˆåˆ†æŽ’åœ¨é¦–ä½ï¼Œä»¥æ­¤ç±»æŽ¨ï¼‰ã€‚åˆ—å¯¹åº”äºŽPCAçš„åŽŸå§‹ç‰¹å¾å±žæ€§ã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/2-principal-components-of-cancer.png"></p><p>åœ¨ç¬¬ä¸€ä¸ªä¸»æˆåˆ†ä¸­ï¼Œ<strong>æ‰€æœ‰ç‰¹å¾çš„ç¬¦å·ç›¸åŒï¼ˆå‡ä¸ºæ­£ï¼Œä½†å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼Œç®­å¤´æŒ‡å‘å“ªä¸ªæ–¹å‘æ— å…³ç´§è¦ï¼‰ã€‚è¿™æ„å‘³ç€åœ¨æ‰€æœ‰ç‰¹å¾ä¹‹é—´å­˜åœ¨æ™®éçš„ç›¸å…³æ€§ã€‚</strong>å¦‚æžœä¸€ä¸ªæµ‹é‡å€¼è¾ƒå¤§çš„è¯ï¼Œå…¶ä»–çš„æµ‹é‡å€¼å¯èƒ½ä¹Ÿè¾ƒå¤§ã€‚ç¬¬äºŒä¸ªä¸»æˆåˆ†çš„ç¬¦å·æœ‰æ­£æœ‰è´Ÿï¼Œè€Œä¸”ä¸¤ä¸ªä¸»æˆåˆ†éƒ½åŒ…å«30ä¸ªç‰¹å¾ã€‚è¿™ç§æ‰€æœ‰ç‰¹å¾çš„æ··åˆä½¿å¾—è§£é‡Šä¸Šå›¾ä¸­çš„åæ ‡è½´å˜å¾—ååˆ†å›°éš¾ã€‚</p><h2 id="ç‰¹å¾æå–çš„ç‰¹å¾è„¸">ç‰¹å¾æå–çš„ç‰¹å¾è„¸</h2><p>PCAçš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯ç‰¹å¾æå–ã€‚ç‰¹å¾æå–èƒŒåŽçš„æ€æƒ³æ˜¯ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ç§æ•°æ®è¡¨ç¤ºï¼Œæ¯”ç»™å®šçš„åŽŸå§‹è¡¨ç¤ºæ›´é€‚åˆäºŽåˆ†æžã€‚ç‰¹å¾æå–å¾ˆæœ‰ç”¨ï¼Œå®ƒçš„ä¸€ä¸ªå¾ˆå¥½çš„åº”ç”¨å®žä¾‹å°±æ˜¯å›¾åƒã€‚å›¾åƒç”±åƒç´ ç»„æˆï¼Œé€šå¸¸å­˜å‚¨ä¸ºçº¢ç»¿è“ï¼ˆRGBï¼‰å¼ºåº¦ã€‚å›¾åƒä¸­çš„å¯¹è±¡é€šå¸¸ç”±åƒä¸‡ä¸ªåƒç´ ç»„æˆï¼Œå®ƒä»¬åªæœ‰æ”¾åœ¨ä¸€èµ·æ‰æœ‰æ„ä¹‰ã€‚</p><p>æˆ‘ä»¬å°†ç»™å‡ºç”¨PCAå¯¹å›¾åƒåšç‰¹å¾æå–çš„ä¸€ä¸ªç®€å•åº”ç”¨ï¼Œå³å¤„ç†Wildæ•°æ®é›†Labeled Facesä¸­çš„äººè„¸å›¾åƒã€‚è¿™ä¸€æ•°æ®é›†åŒ…å«ä»Žäº’è”ç½‘ä¸‹è½½çš„åäººè„¸éƒ¨å›¾åƒï¼Œå®ƒåŒ…å«ä»Ž21ä¸–çºªåˆå¼€å§‹çš„æ”¿æ²»å®¶ã€æ­Œæ‰‹ã€æ¼”å‘˜å’Œè¿åŠ¨å‘˜çš„äººè„¸å›¾åƒã€‚æˆ‘ä»¬ä½¿ç”¨è¿™äº›å›¾åƒçš„ç°åº¦ç‰ˆæœ¬ï¼Œå¹¶å°†å®ƒä»¬æŒ‰æ¯”ä¾‹ç¼©å°ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> fetch_lfw_people</span><br><span class="line"></span><br><span class="line">people = fetch_lfw_people(min_faces_per_person=<span class="number">20</span>, resize=<span class="number">.7</span>)</span><br><span class="line">image_shape = people.images[<span class="number">0</span>].shape</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">5</span>, figsize=(<span class="number">15</span>, <span class="number">8</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> target, image, ax <span class="keyword">in</span> zip(people.target, people.images, axes.ravel()):</span><br><span class="line">    ax.imshow(image, cmap=plt.cm.gray_r)</span><br><span class="line">    ax.set_title(people.target_names[target])</span><br><span class="line"></span><br><span class="line">print(<span class="string">'people.images.shape: &#123;&#125;'</span>.format(people.images.shape))</span><br><span class="line">print(<span class="string">'Number of classes: &#123;&#125;'</span>.format(len(people.target_names)))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-lfw-people.png"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">people.images.shape: (3023, 87, 65)  # ä¸€å…±æœ‰3023å¼ å›¾åƒï¼Œæ¯å¼ å¤§å°ä¸º87åƒç´ x65åƒç´ </span><br><span class="line">Number of classes: 62  # åˆ†åˆ«å±žäºŽ62ä¸ªä¸åŒçš„äºº</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ•°æ®é›†æœ‰äº›åæ–œï¼Œå…¶ä¸­åŒ…å«George W. Bushï¼ˆå°å¸ƒä»€ï¼‰å’ŒColin Powellï¼ˆç§‘æž—Â·é²å¨å°”ï¼‰çš„å¤§é‡å›¾åƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—æ¯ä¸ªç›®æ ‡å‡ºçŽ°çš„æ¬¡æ•°</span></span><br><span class="line">counts = np.bincount(people.target)</span><br><span class="line"><span class="comment"># å°†æ¬¡æ•°ä¸Žç›®æ ‡åç§°ä¸€èµ·æ‰“å°å‡ºæ¥</span></span><br><span class="line"><span class="keyword">for</span> i, (count, name) <span class="keyword">in</span> enumerate(zip(counts, people.target_names)):</span><br><span class="line">    print(<span class="string">'&#123;0:25&#125; &#123;1:3&#125;'</span>.format(name, count), end=<span class="string">'    '</span>)</span><br><span class="line">    <span class="keyword">if</span> (i + <span class="number">1</span>) % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        print()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Alejandro Toledo           39    Alvaro Uribe               35    Amelie Mauresmo            21</span><br><span class="line">Andre Agassi               36    Angelina Jolie             20    Ariel Sharon               77</span><br><span class="line">Arnold Schwarzenegger      42    Atal Bihari Vajpayee       24    Bill Clinton               29</span><br><span class="line">Carlos Menem               21    Colin Powell              236    David Beckham              31</span><br><span class="line">Donald Rumsfeld           121    George Robertson           22    George W Bush             530</span><br><span class="line">Gerhard Schroeder         109    Gloria Macapagal Arroyo    44    Gray Davis                 26</span><br><span class="line">Guillermo Coria            30    Hamid Karzai               22    Hans Blix                  39</span><br><span class="line">Hugo Chavez                71    Igor Ivanov                20    Jack Straw                 28</span><br><span class="line">Jacques Chirac             52    Jean Chretien              55    Jennifer Aniston           21</span><br><span class="line">Jennifer Capriati          42    Jennifer Lopez             21    Jeremy Greenstock          24</span><br><span class="line">Jiang Zemin                20    John Ashcroft              53    John Negroponte            31</span><br><span class="line">Jose Maria Aznar           23    Juan Carlos Ferrero        28    Junichiro Koizumi          60</span><br><span class="line">Kofi Annan                 32    Laura Bush                 41    Lindsay Davenport          22</span><br><span class="line">Lleyton Hewitt             41    Luiz Inacio Lula da Silva  48    Mahmoud Abbas              29</span><br><span class="line">Megawati Sukarnoputri      33    Michael Bloomberg          20    Naomi Watts                22</span><br><span class="line">Nestor Kirchner            37    Paul Bremer                20    Pete Sampras               22</span><br><span class="line">Recep Tayyip Erdogan       30    Ricardo Lagos              27    Roh Moo-hyun               32</span><br><span class="line">Rudolph Giuliani           26    Saddam Hussein             23    Serena Williams            52</span><br><span class="line">Silvio Berlusconi          33    Tiger Woods                23    Tom Daschle                25</span><br><span class="line">Tom Ridge                  33    Tony Blair                144    Vicente Fox                32</span><br><span class="line">Vladimir Putin             49    Winona Ryder               24</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é™ä½Žæ•°æ®åæ–œï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªäººæœ€å¤šåªå–50å¼ å›¾åƒï¼ˆå¦åˆ™ï¼Œç‰¹å¾æå–å°†ä¼šè¢«George w. Bushå½±å“çš„å¯èƒ½æ€§å¤§å¤§å¢žåŠ ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mask = np.zeros(people.target.shape, dtype=np.bool)</span><br><span class="line"><span class="keyword">for</span> target <span class="keyword">in</span> np.unique(people.target):</span><br><span class="line">    mask[np.where(people.target == target)[<span class="number">0</span>][:<span class="number">50</span>]] = <span class="number">1</span>  <span class="comment"># å„å–å‰50ä¸ª</span></span><br><span class="line"></span><br><span class="line">X_people = people.data[mask]</span><br><span class="line">y_people = people.target[mask]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ç°åº¦å€¼ç¼©æ”¾åˆ°0åˆ°1ä¹‹é—´ï¼Œè€Œä¸æ˜¯åœ¨0åˆ°255ä¹‹é—´</span></span><br><span class="line"><span class="comment"># ä»¥å¾—åˆ°æ›´å¥½çš„æ•°æ®ç¨³å®šæ€§</span></span><br><span class="line">X_people = X_people / <span class="number">255</span></span><br></pre></td></tr></table></figure><p>äººè„¸è¯†åˆ«çš„ä¸€ä¸ªå¸¸è§ä»»åŠ¡å°±æ˜¯çœ‹æŸä¸ªå‰æ‰€æœªè§çš„äººè„¸æ˜¯å¦å±žäºŽæ•°æ®åº“ä¸­æŸä¸ªå·²çŸ¥äººç‰©ã€‚è¿™åœ¨ç…§ç‰‡æ”¶é›†ã€ç¤¾äº¤åª’ä½“å’Œå®‰å…¨åº”ç”¨ä¸­éƒ½æœ‰åº”ç”¨ã€‚<strong>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯æž„å»ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œæ¯ä¸ªäººéƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»åˆ«ã€‚ä½†äººè„¸æ•°æ®åº“ä¸­é€šå¸¸æœ‰è®¸å¤šä¸åŒçš„äººï¼Œè€ŒåŒä¸€ä¸ªäººçš„å›¾åƒå¾ˆå°‘ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªç±»åˆ«çš„è®­ç»ƒæ ·ä¾‹å¾ˆå°‘ï¼‰ã€‚è¿™ä½¿å¾—å¤§å¤šæ•°åˆ†ç±»å™¨çš„è®­ç»ƒéƒ½å¾ˆå›°éš¾ã€‚å¦å¤–ï¼Œé€šå¸¸ä½ è¿˜æƒ³è¦èƒ½å¤Ÿè½»æ¾æ·»åŠ æ–°çš„äººç‰©ï¼Œä¸éœ€è¦é‡æ–°è®­ç»ƒä¸€ä¸ªå¤§åž‹æ¨¡åž‹ã€‚</strong></p><p><strong>ä¸€ç§ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨å•ä¸€æœ€è¿‘é‚»åˆ†ç±»å™¨ï¼Œå¯»æ‰¾ä¸Žä½ è¦åˆ†ç±»çš„äººè„¸æœ€ä¸ºç›¸ä¼¼çš„äººè„¸ã€‚è¿™ä¸ªåˆ†ç±»å™¨åŽŸåˆ™ä¸Šå¯ä»¥å¤„ç†æ¯ä¸ªç±»åˆ«åªæœ‰ä¸€ä¸ªè®­ç»ƒæ ·ä¾‹çš„æƒ…å†µã€‚</strong>ä¸‹é¢çœ‹ä¸€ä¸‹<code>KNeighborsClassifier</code>çš„è¡¨çŽ°å¦‚ä½•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    X_people, y_people, stratify=y_people, random_state=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸€ä¸ªé‚»å±…æž„å»º</span></span><br><span class="line">knn = KNeighborsClassifier(n_neighbors=<span class="number">1</span>)</span><br><span class="line">knn.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Test set score of 1-nn: &#123;:.2f&#125;'</span>.format(knn.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test set score of 1-nn: 0.23</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°çš„ç²¾åº¦ä¸º23%ã€‚å¯¹äºŽåŒ…å«62ä¸ªç±»åˆ«çš„åˆ†ç±»é—®é¢˜æ¥è¯´ï¼Œè¿™å®žé™…ä¸Šä¸ç®—å¤ªå·®ï¼Œä½†ä¹Ÿä¸ç®—å¥½ã€‚</p><p>è¿™é‡Œå°±å¯ä»¥ç”¨åˆ°PCAã€‚<strong>æƒ³è¦åº¦é‡äººè„¸çš„ç›¸ä¼¼åº¦ï¼Œè®¡ç®—åŽŸå§‹åƒç´ ç©ºé—´ä¸­çš„è·ç¦»æ˜¯ä¸€ç§ç›¸å½“ç³Ÿç³•çš„æ–¹æ³•ã€‚ç”¨åƒç´ è¡¨ç¤ºæ¥æ¯”è¾ƒä¸¤å¼ å›¾æ—¶ï¼Œæˆ‘ä»¬æ¯”è¾ƒçš„æ˜¯æ¯ä¸ªåƒç´ çš„ç°åº¦å€¼ä¸Žå¦ä¸€å¼ å›¾åƒå¯¹åº”ä½ç½®çš„åƒç´ ç°åº¦å€¼ã€‚è¿™ç§è¡¨ç¤ºä¸Žäººä»¬å¯¹äººè„¸å›¾åƒçš„è§£é‡Šæ–¹å¼æœ‰å¾ˆå¤§ä¸åŒï¼Œä½¿ç”¨è¿™ç§åŽŸå§‹è¡¨ç¤ºå¾ˆéš¾èŽ·å–åˆ°é¢éƒ¨ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä½¿ç”¨åƒç´ è·ç¦»ï¼Œé‚£ä¹ˆå°†äººè„¸å‘å³ç§»åŠ¨ä¸€ä¸ªåƒç´ å°†ä¼šå‘ç”Ÿå·¨å¤§çš„å˜åŒ–ï¼Œå¾—åˆ°ä¸€ä¸ªå®Œå…¨ä¸åŒçš„è¡¨ç¤ºã€‚</strong>æˆ‘ä»¬å¸Œæœ›ï¼Œä½¿ç”¨æ²¿ç€ä¸»æˆåˆ†æ–¹å‘çš„è·ç¦»å¯ä»¥æé«˜ç²¾åº¦ã€‚è¿™é‡Œæˆ‘ä»¬å¯åŠ¨PCAçš„<strong>ç™½åŒ–</strong>ï¼ˆwhiteningï¼‰é€‰é¡¹ï¼Œå®ƒå°†ä¸»æˆåˆ†ç¼©æ”¾åˆ°ç›¸åŒçš„å°ºåº¦ã€‚å˜æ¢åŽçš„ç»“æžœä¸Žä½¿ç”¨<code>StandardScaler</code>ç›¸åŒã€‚ç™½åŒ–ä¸ä»…å¯¹åº”äºŽæ—‹è½¬æ•°æ®ï¼Œè¿˜å¯¹åº”äºŽç¼©æ”¾æ•°æ®ä½¿å…¶å½¢çŠ¶æ˜¯åœ†å½¢è€Œä¸æ˜¯æ¤­åœ†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_pca_whitening()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/pca-whitening.png"></p><p>æˆ‘ä»¬å¯¹è®­ç»ƒæ•°æ®æ‹ŸåˆPCAå¯¹è±¡ï¼Œå¹¶æå–å‰100ä¸ªä¸»æˆåˆ†ã€‚ç„¶åŽå¯¹è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®è¿›è¡Œå˜æ¢ã€‚å†å¯¹æ–°è¡¨ç¤ºä½¿ç”¨å•ä¸€æœ€è¿‘é‚»åˆ†ç±»å™¨æ¥å°†å›¾åƒåˆ†ç±»ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pca = PCA(n_components=<span class="number">100</span>, whiten=<span class="literal">True</span>, random_state=<span class="number">0</span>).fit(X_train)</span><br><span class="line">X_train_pca = pca.transform(X_train)</span><br><span class="line">X_test_pca = pca.transform(X_test)</span><br><span class="line">print(<span class="string">'X_train_pca.shape: &#123;&#125;'</span>.format(X_train_pca.shape))</span><br><span class="line"></span><br><span class="line">knn = KNeighborsClassifier(n_neighbors=<span class="number">1</span>)</span><br><span class="line">knn.fit(X_train_pca, y_train)</span><br><span class="line">print(<span class="string">'Test set accuracy: &#123;:.2f&#125;'</span>.format(knn.score(X_test_pca, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test set accuracy: 0.31</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç²¾åº¦æœ‰äº†ç›¸å½“æ˜¾è‘—çš„æé«˜ï¼Œè¿™è¯å®žäº†æˆ‘ä»¬çš„ç›´è§‰ï¼Œå³<strong>ä¸»æˆåˆ†å¯èƒ½æä¾›äº†ä¸€ç§æ›´å¥½çš„æ•°æ®è¡¨ç¤ºã€‚</strong></p><p><strong>å¯¹äºŽå›¾åƒæ•°æ®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†æ‰¾åˆ°çš„ä¸»æˆåˆ†å¯è§†åŒ–ã€‚è¯·è®°ä½ï¼Œæˆåˆ†å¯¹åº”äºŽè¾“å…¥ç©ºé—´é‡Œçš„æ–¹å‘ã€‚</strong>è¿™é‡Œçš„è¾“å…¥ç©ºé—´æ˜¯87åƒç´ x65åƒç´ çš„ç°åº¦å›¾åƒï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªç©ºé—´ä¸­çš„æ–¹å‘ä¹Ÿæ˜¯87åƒç´ x65åƒç´ çš„ç°åº¦å›¾åƒã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‰å‡ ä¸ªä¸»æˆåˆ†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'pca.components_.shape: &#123;&#125;'</span>.format(pca.components_.shape))</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">3</span>, <span class="number">5</span>, figsize=(<span class="number">15</span>, <span class="number">12</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> i, (component, ax) <span class="keyword">in</span> enumerate(zip(pca.components_, axes.ravel())):</span><br><span class="line">    ax.imshow(component.reshape(image_shape), cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    ax.set_title(<span class="string">"&#123;&#125;. component"</span>.format(i + <span class="number">1</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pca.components_.shape: (100, 5655)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/visualization-of-image-pca.png"></p><p>è™½ç„¶æˆ‘ä»¬è‚¯å®šæ— æ³•ç†è§£è¿™äº›æˆåˆ†çš„æ‰€æœ‰å†…å®¹ï¼Œä½†å¯ä»¥çŒœæµ‹ä¸€äº›ä¸»æˆåˆ†æ•æ‰åˆ°äº†äººè„¸å›¾åƒçš„å“ªäº›æ–¹é¢ã€‚ç¬¬ä¸€ä¸ªä¸»æˆåˆ†ä¼¼ä¹Žä¸»è¦ç¼–ç çš„æ˜¯äººè„¸ä¸ŽèƒŒæ™¯çš„å¯¹æ¯”ï¼Œç¬¬äºŒä¸ªä¸»æˆåˆ†ç¼–ç çš„æ˜¯äººè„¸å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†çš„æ˜Žæš—ç¨‹åº¦å·®å¼‚ï¼Œå¦‚æ­¤ç­‰ç­‰ã€‚è™½ç„¶è¿™ç§è¡¨ç¤ºæ¯”åŽŸå§‹åƒç´ å€¼çš„è¯­ä¹‰ç¨å¼ºï¼Œä½†å®ƒä»ä¸Žäººä»¬æ„ŸçŸ¥äººè„¸çš„æ–¹å¼ç›¸åŽ»ç”šè¿œã€‚<strong>ç”±äºŽPCAæ¨¡åž‹æ˜¯åŸºäºŽåƒç´ çš„ï¼Œå› æ­¤äººè„¸çš„ç›¸å¯¹ä½ç½®ï¼ˆçœ¼ç›ã€ä¸‹å·´å’Œé¼»å­çš„ä½ç½®ï¼‰å’Œæ˜Žæš—ç¨‹åº¦éƒ½å¯¹ä¸¤å¼ å›¾åƒåœ¨åƒç´ è¡¨ç¤ºä¸­çš„ç›¸ä¼¼ç¨‹åº¦æœ‰å¾ˆå¤§å°è±¡ã€‚ä½†äººè„¸çš„ç›¸å¯¹ä½ç½®å’Œæ˜Žæš—ç¨‹åº¦å¯èƒ½å¹¶ä¸æ˜¯äººä»¬é¦–å…ˆæ„ŸçŸ¥çš„å†…å®¹ã€‚</strong>åœ¨è¦æ±‚äººä»¬è¯„ä»·äººè„¸çš„ç›¸ä¼¼åº¦æ—¶ï¼Œä»–ä»¬æ›´å¯èƒ½ä¼šä½¿ç”¨å¹´é¾„ã€æ€§åˆ«ã€é¢éƒ¨è¡¨æƒ…å’Œå‘åž‹ç­‰å±žæ€§ï¼Œè€Œè¿™äº›å±žæ€§å¾ˆéš¾ä»Žåƒç´ å¼ºåº¦ä¸­æŽ¨æ–­å‡ºæ¥ã€‚é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œç®—æ³•å¯¹æ•°æ®ï¼ˆç‰¹åˆ«æ˜¯è§†è§‰æ•°æ®ï¼Œæ¯”å¦‚äººä»¬éžå¸¸ç†Ÿæ‚‰çš„å›¾åƒï¼‰çš„è§£é‡Šé€šå¸¸ä¸Žäººç±»çš„è§£é‡Šæ–¹å¼æœ‰å¾ˆå¤§ä¸åŒã€‚</p><p>ä¸è¿‡è®©æˆ‘ä»¬å›žåˆ°PCAçš„å…·ä½“æ¡ˆä¾‹ã€‚æˆ‘ä»¬å¯¹PCAå˜æ¢çš„ä»‹ç»æ˜¯ï¼šå…ˆæ—‹è½¬æ•°æ®ï¼Œç„¶åŽåˆ é™¤æ–¹å·®è¾ƒå°çš„æˆåˆ†ã€‚å¦ä¸€ç§æœ‰ç”¨çš„è§£é‡Šæ˜¯å°è¯•æ‰¾åˆ°ä¸€äº›æ•°å­—ï¼ˆPCAæ—‹è½¬åŽçš„æ–°ç‰¹å¾å€¼ï¼‰ï¼Œä½¿æˆ‘ä»¬å¯ä»¥å°†æµ‹è¯•ç‚¹è¡¨ç¤ºä¸ºä¸»æˆåˆ†çš„åŠ æƒæ±‚å’Œã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/break-down-image-to-weighted-summation-of-pca.png"></p><p>è¿™é‡Œ<span class="math inline">\(x_0ã€x_1\)</span>ç­‰æ˜¯è¿™ä¸ªæ•°æ®ç‚¹çš„ä¸»æˆåˆ†çš„ç³»æ•°ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯å›¾åƒåœ¨æ—‹è½¬åŽçš„ç©ºé—´ä¸­çš„è¡¨ç¤ºã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¦ä¸€ç§æ–¹æ³•æ¥ç†è§£PCAæ¨¡åž‹ã€‚å°±æ˜¯ä»…ä½¿ç”¨ä¸€äº›æˆåˆ†å¯¹åŽŸå§‹æ•°æ®è¿›è¡Œé‡å»ºã€‚åœ¨<code>plot_pca_illustration</code>å‡½æ•°ä¸­ï¼ŒåŽ»æŽ‰ç¬¬äºŒä¸ªä¸»æˆåˆ†ï¼Œå†åå‘æ—‹è½¬å¹¶åŠ ä¸Šå¹³å‡å€¼ï¼Œè¿™æ ·å°±åœ¨åŽŸå§‹ç©ºé—´ä¸­èŽ·å¾—åŽ»æŽ‰ç¬¬äºŒä¸ªæˆåˆ†çš„æ–°æ•°æ®ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥å¯¹äººè„¸åšç±»ä¼¼çš„å˜æ¢ï¼Œå°†æ•°æ®é™ç»´åˆ°åªåŒ…å«ä¸€äº›ä¸»æˆåˆ†ï¼Œç„¶åŽåå‘æ—‹è½¬å›žåˆ°åŽŸå§‹ç©ºé—´ã€‚å›žåˆ°åŽŸå§‹ç‰¹å¾ç©ºé—´å¯ä»¥é€šè¿‡<code>inverse_transform(X)</code>æ–¹æ³•æ¥å®žçŽ°ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.decomposition.pca#sklearn.decomposition.PCA.inverse_transform" target="_blank" rel="noopener"><code>inverse_transform(X)</code></a></p><p>Transform data back to its original space.</p><p>In other words, return an input X_original whose transform would be X.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«åˆ©ç”¨10ä¸ªã€50ä¸ªã€100ä¸ªå’Œ500ä¸ªæˆåˆ†å¯¹ä¸€äº›äººè„¸è¿›è¡Œé‡å»ºå¹¶å°†å…¶å¯è§†åŒ–</span></span><br><span class="line">mglearn.plots.plot_pca_faces(X_train, X_test, image_shape)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/pca-faces.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä»…ä½¿ç”¨å‰10ä¸ªä¸»æˆåˆ†æ—¶ï¼Œä»…æ•æ‰åˆ°äº†å›¾ç‰‡çš„åŸºæœ¬ç‰¹ç‚¹ï¼Œæ¯”å¦‚äººè„¸æ–¹å‘å’Œæ˜Žæš—ç¨‹åº¦ã€‚éšç€ä½¿ç”¨çš„ä¸»æˆåˆ†è¶Šæ¥è¶Šå¤šï¼Œå›¾åƒä¸­ä¹Ÿä¿ç•™äº†è¶Šæ¥è¶Šå¤šçš„ç»†èŠ‚ã€‚è¿™å¯¹åº”äºŽå‰ä¸€å¹…å›¾çš„æ±‚å’Œä¸­åŒ…å«è¶Šæ¥è¶Šå¤šçš„é¡¹ã€‚å¦‚æžœä½¿ç”¨çš„æˆåˆ†ä¸ªæ•°ä¸Žåƒç´ ä¸ªæ•°ç›¸ç­‰ï¼Œæ„å‘³ç€æˆ‘ä»¬åœ¨æ—‹è½¬åŽä¸ä¼šä¸¢å¼ƒä»»ä½•ä¿¡æ¯ï¼Œå¯ä»¥å®Œç¾Žé‡å»ºå›¾åƒã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥å°è¯•ä½¿ç”¨PCAçš„å‰ä¸¤ä¸ªä¸»æˆåˆ†ï¼Œå°†æ•°æ®é›†ä¸­çš„æ‰€æœ‰äººè„¸åœ¨æ•£ç‚¹å›¾ä¸­å¯è§†åŒ–ï¼Œå…¶ç±»åˆ«åœ¨å›¾ä¸­ç»™å‡ºã€‚è¿™ä¸Žæˆ‘ä»¬å¯¹canceræ•°æ®é›†æ‰€åšçš„ç±»ä¼¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.discrete_scatter(X_train_pca[:, <span class="number">0</span>], X_train_pca[:, <span class="number">1</span>], y_train)</span><br><span class="line">plt.xlabel(<span class="string">'First principal component'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Second principal component'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/pca-faces-scatter.png"></p><p>å¦‚ä½ æ‰€è§ï¼Œå¦‚æžœæˆ‘ä»¬åªä½¿ç”¨å‰ä¸¤ä¸ªä¸»æˆåˆ†ï¼Œæ•´ä¸ªæ•°æ®åªæ˜¯ä¸€å¤§å›¢ï¼Œçœ‹ä¸åˆ°ç±»åˆ«ä¹‹é—´çš„åˆ†ç•Œã€‚è¿™å¹¶ä¸æ„å¤–ï¼Œå› ä¸ºå³ä½¿æœ‰10ä¸ªæˆåˆ†ï¼ŒPCAä¹Ÿä»…æ•æ‰åˆ°äººè„¸éžå¸¸ç²—ç•¥çš„ç‰¹å¾ã€‚</p><h1 id="éžè´ŸçŸ©é˜µåˆ†è§£">éžè´ŸçŸ©é˜µåˆ†è§£</h1><p>éžè´ŸçŸ©é˜µåˆ†è§£ï¼ˆnon-negative matrix factorizationï¼ŒNMFï¼‰æ˜¯å¦ä¸€ç§æ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œå…¶ç›®çš„åœ¨äºŽæå–æœ‰ç”¨çš„ç‰¹å¾ã€‚å®ƒçš„å·¥ä½œåŽŸç†ç±»ä¼¼PCAï¼Œä¹Ÿå¯ä»¥ç”¨äºŽé™ç»´ã€‚ä¸ŽPCAç›¸åŒï¼Œæˆ‘ä»¬è¯•å›¾å°†æ¯ä¸ªæ•°æ®ç‚¹å†™æˆä¸€äº›åˆ†é‡çš„åŠ æƒæ±‚å’Œã€‚ä½†åœ¨PCAä¸­ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯æ­£äº¤åˆ†é‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿè§£é‡Šå°½å¯èƒ½å¤šçš„æ•°æ®æ–¹å·®ï¼›è€Œåœ¨NMFä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ†é‡å’Œç³»æ•°å‡ä¸ºéžè´Ÿã€‚å› æ­¤ï¼Œè¿™ç§æ–¹æ³•åªèƒ½åº”ç”¨äºŽæ¯ä¸ªç‰¹å¾éƒ½æ˜¯éžè´Ÿçš„æ•°æ®ï¼Œå› ä¸ºéžè´Ÿåˆ†é‡çš„éžè´Ÿæ±‚å’Œä¸å¯èƒ½å˜ä¸ºè´Ÿå€¼ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.decomposition.nmf" target="_blank" rel="noopener"><code>class sklearn.decomposition.NMF(n_components=None, init=None, solver=â€™cdâ€™, beta_loss=â€™frobeniusâ€™, tol=0.0001, max_iter=200, random_state=None, alpha=0.0, l1_ratio=0.0, verbose=0, shuffle=False)</code></a></p><p>Non-Negative Matrix Factorization (NMF)</p></blockquote><p>å°†æ•°æ®åˆ†è§£æˆéžè´ŸåŠ æƒæ±‚å’Œçš„è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯¹ç”±å¤šä¸ªç‹¬ç«‹æºç›¸åŠ ï¼ˆæˆ–å åŠ ï¼‰åˆ›å»ºè€Œæˆçš„æ•°æ®ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚å¤šäººè¯´è¯çš„éŸ³è½¨æˆ–åŒ…å«å¤šç§ä¹å™¨çš„éŸ³ä¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNMFå¯ä»¥è¯†åˆ«å‡ºç»„åˆåˆæˆæ•°æ®çš„åŽŸå§‹åˆ†é‡ã€‚æ€»çš„æ¥è¯´ï¼Œä¸ŽPCAç›¸æ¯”ï¼ŒNMFå¾—åˆ°çš„åˆ†é‡æ›´å®¹æ˜“ç†è§£ï¼Œå› ä¸ºè´Ÿçš„åˆ†é‡å’Œç³»æ•°å¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥ç†è§£çš„æŠµæ¶ˆæ•ˆåº”ï¼ˆcancellation effectï¼‰ã€‚</p><h2 id="å°†nmfåº”ç”¨äºŽæ¨¡æ‹Ÿæ•°æ®">å°†NMFåº”ç”¨äºŽæ¨¡æ‹Ÿæ•°æ®</h2><p>ä¸Žä½¿ç”¨PCAä¸åŒï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ•°æ®æ˜¯æ­£çš„ï¼ŒNMFèƒ½å¤Ÿå¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚è¿™è¯´æ˜Žæ•°æ®ç›¸å¯¹äºŽåŽŸç‚¹(0, 0)çš„ä½ç½®å®žé™…ä¸Šå¯¹NMFå¾ˆé‡è¦ã€‚å› æ­¤ï¼Œä½ å¯ä»¥å°†æå–å‡ºæ¥çš„éžè´Ÿåˆ†é‡çœ‹ä½œæ˜¯ä»Ž(0, 0)åˆ°æ•°æ®çš„æ–¹å‘ã€‚ä¸‹é¢çš„ä¾‹å­ç»™å‡ºäº†NMFåœ¨äºŒç»´çŽ©å…·æ•°æ®ä¸Šçš„ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_nmf_illustration()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/nmf.png"></p><p>å¯¹äºŽä¸¤ä¸ªåˆ†é‡çš„NMFï¼ˆå·¦å›¾ï¼‰ï¼Œæ˜¾ç„¶æ‰€æœ‰æ•°æ®ç‚¹éƒ½å¯ä»¥å†™æˆè¿™ä¸¤ä¸ªåˆ†é‡çš„æ­£æ•°ç»„åˆã€‚å¦‚æžœæœ‰è¶³å¤Ÿå¤šçš„åˆ†é‡èƒ½å¤Ÿå®Œç¾Žåœ°é‡å»ºæ•°æ®ï¼ˆåˆ†é‡ä¸ªæ•°ä¸Žç‰¹å¾ä¸ªæ•°ç›¸åŒï¼‰ï¼Œé‚£ä¹ˆç®—æ³•ä¼šé€‰æ‹©æŒ‡å‘æ•°æ®æžå€¼çš„æ–¹å‘ã€‚</p><p>å¦‚æžœæˆ‘ä»¬ä»…ä½¿ç”¨ä¸€ä¸ªåˆ†é‡ï¼Œé‚£ä¹ˆNMFä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å‘å¹³å‡å€¼çš„åˆ†é‡ï¼Œå› ä¸ºæŒ‡å‘è¿™é‡Œå¯ä»¥å¯¹æ•°æ®åšå‡ºæœ€å¥½çš„è§£é‡Šã€‚<strong>ä¸ŽPCAä¸åŒï¼Œå‡å°‘åˆ†é‡ä¸ªæ•°ä¸ä»…ä¼šåˆ é™¤ä¸€äº›æ–¹å‘ï¼Œè€Œä¸”ä¼šåˆ›å»ºä¸€ç»„å®Œå…¨ä¸åŒçš„åˆ†é‡ï¼NMFçš„åˆ†é‡ä¹Ÿæ²¡æœ‰æŒ‰ä»»ä½•ç‰¹å®šæ–¹æ³•æŽ’åºï¼Œæ‰€ä»¥ä¸å­˜åœ¨â€œç¬¬ä¸€éžè´Ÿåˆ†é‡â€ï¼šæ‰€æœ‰åˆ†é‡çš„åœ°ä½å¹³ç­‰ã€‚</strong></p><p>NMFä½¿ç”¨äº†éšæœºåˆå§‹åŒ–ï¼Œæ ¹æ®éšæœºç§å­çš„ä¸åŒå¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æžœã€‚åœ¨ç›¸å¯¹ç®€å•çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ä¸¤ä¸ªåˆ†é‡çš„æ¨¡æ‹Ÿæ•°æ®ï¼‰ï¼Œæ‰€æœ‰æ•°æ®éƒ½å¯ä»¥è¢«å®Œç¾Žåœ°è§£é‡Šï¼Œé‚£ä¹ˆéšæœºæ€§çš„å½±å“å¾ˆå°ï¼ˆè™½ç„¶å¯èƒ½ä¼šå½±å“åˆ†é‡çš„é¡ºåºæˆ–å°ºåº¦ï¼‰ã€‚åœ¨æ›´åŠ å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå½±å“å¯èƒ½ä¼šå¾ˆå¤§ã€‚</p><h2 id="å°†nmfåº”ç”¨äºŽäººè„¸å›¾åƒ">å°†NMFåº”ç”¨äºŽäººè„¸å›¾åƒ</h2><p>NMFçš„ä¸»è¦å‚æ•°æ˜¯æˆ‘ä»¬æƒ³è¦æå–çš„åˆ†é‡ä¸ªæ•°ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™ä¸ªæ•°å­—è¦å°äºŽè¾“å…¥ç‰¹å¾çš„ä¸ªæ•°ï¼ˆå¦åˆ™çš„è¯ï¼Œå°†æ¯ä¸ªåƒç´ ä½œä¸ºå•ç‹¬çš„åˆ†é‡å°±å¯ä»¥å¯¹æ•°æ®è¿›è¡Œè§£é‡Šï¼‰ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿåˆ†é‡ä¸ªæ•°å¦‚ä½•å½±å“NMFé‡å»ºæ•°æ®çš„å¥½åã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_nmf_faces(X_train, X_test, image_shape)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/nmf-faces.png"></p><p><strong>åå‘å˜æ¢çš„æ•°æ®è´¨é‡ä¸Žä½¿ç”¨PCAæ—¶ç±»ä¼¼ï¼Œä½†è¦ç¨å·®ä¸€äº›ã€‚è¿™æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œå› ä¸ºPCAæ‰¾åˆ°çš„æ˜¯é‡å»ºçš„æœ€ä½³æ–¹å‘ã€‚NMFé€šå¸¸å¹¶ä¸ç”¨äºŽå¯¹æ•°æ®è¿›è¡Œé‡å»ºæˆ–è€…ç¼–ç ï¼Œè€Œæ˜¯ç”¨äºŽåœ¨æ•°æ®ä¸­å¯»æ‰¾æœ‰è¶£çš„æ¨¡å¼ã€‚</strong></p><p>æˆ‘ä»¬å°è¯•ä»…æå–ä¸€éƒ¨åˆ†åˆ†é‡ï¼Œåˆæ­¥è§‚å¯Ÿä¸€ä¸‹æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> NMF</span><br><span class="line"></span><br><span class="line">nmf = NMF(n_components=<span class="number">15</span>, random_state=<span class="number">0</span>)</span><br><span class="line">nmf.fit(X_train)</span><br><span class="line">X_train_nmf = nmf.transform(X_train)</span><br><span class="line">X_test_nmf = nmf.transform(X_test)</span><br><span class="line"></span><br><span class="line">fix, axes = plt.subplots(<span class="number">3</span>, <span class="number">5</span>, figsize=(<span class="number">15</span>, <span class="number">12</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> i, (component, ax) <span class="keyword">in</span> enumerate(zip(nmf.components_, axes.ravel())):</span><br><span class="line">    ax.imshow(component.reshape(image_shape))</span><br><span class="line">    ax.set_title(<span class="string">'&#123;&#125;. component'</span>.format(i))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/nmf-components.png"></p><p>è¿™äº›åˆ†é‡éƒ½æ˜¯æ­£çš„ï¼Œå› æ­¤æ¯”PCAåˆ†é‡æ›´åƒäººè„¸æ¨¡åž‹ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œåˆ†é‡3æ˜¾ç¤ºäº†ç¨å¾®å‘å³è½¬åŠ¨çš„äººè„¸ï¼Œè€Œåˆ†é‡7åˆ™æ˜¾ç¤ºäº†ç¨å¾®å‘å·¦è½¬åŠ¨çš„äººè„¸ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªåˆ†é‡ç‰¹åˆ«å¤§çš„é‚£äº›å›¾åƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> compn <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">7</span>):</span><br><span class="line">    inds = np.argsort(X_train_nmf[:, compn])[::<span class="number">-1</span>]</span><br><span class="line">    fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">5</span>, figsize=(<span class="number">15</span>, <span class="number">8</span>),</span><br><span class="line">        subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line">    <span class="keyword">for</span> i, (ind, ax) <span class="keyword">in</span> enumerate(zip(inds, axes.ravel())):</span><br><span class="line">        ax.imshow(X_train[ind].reshape(image_shape))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/nmf-components-argsort-3.png"></p><p><img src="/uploads/image/introduction-to-ml-with-python/nmf-components-argsort-7.png"></p><p>æ­£å¦‚æ‰€æ–™ï¼Œåˆ†é‡3ç³»æ•°è¾ƒå¤§çš„äººè„¸éƒ½æ˜¯å‘å³çœ‹çš„äººè„¸ï¼Œè€Œåˆ†é‡7ç³»æ•°è¾ƒå¤§çš„äººè„¸éƒ½å‘å·¦çœ‹ã€‚<strong>æå–è¿™æ ·çš„æ¨¡å¼æœ€é€‚åˆäºŽå…·æœ‰å åŠ ç»“æž„çš„æ•°æ®ï¼ŒåŒ…æ‹¬éŸ³é¢‘ã€åŸºå› è¡¨è¾¾å’Œæ–‡æœ¬æ•°æ®ã€‚</strong></p><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¨¡æ‹Ÿæ•°æ®çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹è¿™ç§ç”¨æ³•ã€‚åŠ å…¥æˆ‘ä»¬å¯¹ä¸€ä¸ªä¿¡å·æ„Ÿå…´è¶£ï¼Œå®ƒæ˜¯ä¸‰ä¸ªä¸åŒä¿¡å·æºåˆæˆçš„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">S = mglearn.datasets.make_signals()</span><br><span class="line">plt.figure(figsize=(<span class="number">6</span>, <span class="number">1</span>))</span><br><span class="line">plt.plot(S, <span class="string">'-'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Time'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Signal'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-signals.png"></p><p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•è§‚æµ‹åˆ°åŽŸå§‹ä¿¡å·ï¼Œåªèƒ½è§‚æµ‹åˆ°ä¸‰ä¸ªä¿¡å·çš„å åŠ æ··åˆã€‚æˆ‘ä»¬æƒ³è¦å°†æ··åˆä¿¡å·åˆ†è§£æˆåŽŸå§‹åˆ†é‡ã€‚å‡è®¾æˆ‘ä»¬æœ‰è®¸å¤šç§ä¸åŒçš„æ–¹æ³•æ¥è§‚æµ‹ä¿¡å·ï¼ˆæ¯”å¦‚æœ‰100å°æµ‹é‡è£…ç½®ï¼‰ï¼Œæ¯ç§æ–¹æ³•éƒ½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›åˆ—è§‚æµ‹ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†æ•°æ®æ··åˆæˆ100ç»´çš„çŠ¶æ€</span></span><br><span class="line">A = np.random.RandomState(<span class="number">0</span>).uniform(size=(<span class="number">100</span>, <span class="number">3</span>))</span><br><span class="line">X = np.dot(S, A.T)</span><br><span class="line">print(<span class="string">'Shape of measurements: &#123;&#125;'</span>.format(X.shape))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨NMFæ¥è¿˜åŽŸè¿™ä¸‰ä¸ªä¿¡å·</span></span><br><span class="line">nmf = NMF(n_components=<span class="number">3</span>, random_state=<span class="number">42</span>)</span><br><span class="line">S_ = nmf.fit_transform(X)</span><br><span class="line">print(<span class="string">'Recovered signal shape: &#123;&#125;'</span>.format(S_.shape))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºäº†å¯¹æ¯”ï¼Œåº”ç”¨PCA</span></span><br><span class="line">pca = PCA(n_components=<span class="number">3</span>)</span><br><span class="line">H = pca.fit_transform(X)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™å‡ºNMFå’ŒPCAå‘çŽ°çš„ä¿¡å·æ´»åŠ¨</span></span><br><span class="line">models = [X, S, S_, H]</span><br><span class="line">names = [<span class="string">'Observations (first three measurements)'</span>, <span class="string">'True sources'</span>,</span><br><span class="line">    <span class="string">'NMF recovered signals'</span>, <span class="string">'PCA recovered signals'</span>]</span><br><span class="line">fig, axes = plt.subplots(<span class="number">4</span>, figsize=(<span class="number">8</span>, <span class="number">4</span>), gridspec_kw=&#123;<span class="string">'hspace'</span>: <span class="number">.5</span>&#125;,</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> model, name, ax <span class="keyword">in</span> zip(models, names, axes):</span><br><span class="line">    ax.set_title(name)</span><br><span class="line">    ax.plot(model[:, :<span class="number">3</span>], <span class="string">'-'</span>)  <span class="comment"># ç»˜åˆ¶Xæ—¶ï¼Œä»…åŒ…å«100æ¬¡ä¸­çš„å‰3æ¬¡æµ‹é‡</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/nmf-and-pca-on-signals.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒNMFåœ¨å‘çŽ°åŽŸå§‹ä¿¡å·æºæ—¶å¾—åˆ°äº†ä¸é”™çš„ç»“æžœï¼Œè€ŒPCAåˆ™å¤±è´¥äº†ï¼Œä»…ä½¿ç”¨ç¬¬ä¸€ä¸ªæˆåˆ†æ¥è§£é‡Šæ•°æ®ä¸­çš„å¤§éƒ¨åˆ†å˜åŒ–ã€‚<strong>è¦è®°ä½ï¼ŒNMFç”Ÿæˆçš„åˆ†é‡æ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒNMFåˆ†é‡çš„é¡ºåºä¸ŽåŽŸå§‹ä¿¡å·å®Œå…¨ç›¸åŒï¼ˆå‚è§ä¸‰æ¡æ›²çº¿çš„é¢œè‰²ï¼‰ï¼Œä½†è¿™çº¯å±žå¶ç„¶ã€‚</strong></p><p>è¿˜æœ‰è®¸å¤šå…¶ä»–ç®—æ³•å¯ç”¨äºŽå°†æ¯ä¸ªæ•°æ®ç‚¹åˆ†è§£æˆä¸€ç³»åˆ—å›ºå®šåˆ†é‡çš„åŠ æƒæ±‚å’Œï¼Œæ­£å¦‚PCAå’ŒNMFæ‰€åšçš„é‚£æ ·ã€‚å¦‚æžœä½ å¯¹è¿™ç§ç±»åž‹çš„æ¨¡å¼æå–æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬æŽ¨èä½ å­¦ä¹ <code>scikit-learn</code>ç”¨æˆ·æŒ‡å—ä¸­å…³äºŽç‹¬ç«‹æˆåˆ†åˆ†æžï¼ˆICAï¼‰ã€å› å­åˆ†æžï¼ˆFAï¼‰å’Œç¨€ç–ç¼–ç ï¼ˆå­—å…¸å­¦ä¹ ï¼‰ç­‰çš„å†…å®¹ï¼Œæ‰€æœ‰è¿™äº›å†…å®¹éƒ½å¯ä»¥åœ¨å…³äºŽåˆ†è§£æ–¹æ³•çš„é¡µé¢ä¸­æ‰¾åˆ°ï¼ˆ<a href="http://scikit-learn.org/stable/modules/decomposition.html" class="uri" target="_blank" rel="noopener">http://scikit-learn.org/stable/modules/decomposition.html</a>ï¼‰ã€‚</p><h1 id="ç”¨t-sneè¿›è¡Œæµå½¢å­¦ä¹ ">ç”¨t-SNEè¿›è¡Œæµå½¢å­¦ä¹ </h1><p>è™½ç„¶PCAé€šå¸¸æ˜¯ç”¨äºŽå˜æ¢æ•°æ®çš„é¦–é€‰æ–¹æ³•ï¼Œä½¿ä½ èƒ½å¤Ÿç”¨æ•£ç‚¹å›¾å°†å…¶å¯è§†åŒ–ï¼Œä½†è¿™ä¸€æ–¹æ³•çš„æ€§è´¨ï¼ˆå…ˆæ—‹è½¬ç„¶åŽå‡å°‘æ–¹å‘ï¼‰é™åˆ¶äº†å…¶æœ‰æ•ˆæ€§ã€‚æœ‰ä¸€ç±»ç”¨äºŽå¯è§†åŒ–çš„ç®—æ³•å«ä½œ<strong>æµå½¢å­¦ä¹ ç®—æ³•</strong>ï¼ˆmanifold learning algorithmï¼‰ï¼Œå®ƒå…è®¸è¿›è¡Œæ›´å¤æ‚çš„æ˜ å°„ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥ç»™å‡ºæ›´å¥½çš„å¯è§†åŒ–ã€‚å…¶ä¸­ç‰¹åˆ«æœ‰ç”¨çš„ä¸€ä¸ªå°±æ˜¯t-SNEï¼ˆt-distributed Stochastic Neighbor Embeddingï¼‰ç®—æ³•ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.manifold.tsne" target="_blank" rel="noopener"><code>class sklearn.manifold.TSNE(n_components=2, perplexity=30.0, early_exaggeration=12.0, learning_rate=200.0, n_iter=1000, n_iter_without_progress=300, min_grad_norm=1e-07, metric=â€™euclideanâ€™, init=â€™randomâ€™, verbose=0, random_state=None, method=â€™barnes_hutâ€™, angle=0.5)</code></a></p><p>t-distributed Stochastic Neighbor Embedding.</p></blockquote><p><strong>æµå½¢å­¦ä¹ ç®—æ³•ä¸»è¦ç”¨äºŽå¯è§†åŒ–ï¼Œå› æ­¤å¾ˆå°‘ç”¨æ¥ç”Ÿæˆä¸¤ä¸ªä»¥ä¸Šçš„æ–°ç‰¹å¾ã€‚å…¶ä¸­ä¸€äº›ç®—æ³•ï¼ˆåŒ…æ‹¬t-SNEï¼‰è®¡ç®—è®­ç»ƒæ•°æ®çš„ä¸€ç§æ–°è¡¨ç¤ºï¼Œä½†ä¸å…è®¸å˜æ¢æ–°æ•°æ®ã€‚è¿™æ„å‘³ç€è¿™äº›ç®—æ³•ä¸èƒ½ç”¨äºŽæµ‹è¯•é›†ï¼šæ›´ç¡®åˆ‡åœ°è¯´ï¼Œå®ƒä»¬åªèƒ½å˜æ¢ç”¨äºŽè®­ç»ƒçš„æ•°æ®ã€‚</strong>æµå½¢å­¦ä¹ å¯¹æŽ¢ç´¢æ€§æ•°æ®åˆ†æžæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†å¦‚æžœæœ€ç»ˆç›®æ ‡æ˜¯ç›‘ç£å­¦ä¹ çš„è¯ï¼Œåˆ™å¾ˆå°‘ä½¿ç”¨ã€‚t-SNEèƒŒåŽçš„æ€æƒ³æ˜¯æ‰¾åˆ°æ•°æ®çš„ä¸€ä¸ªäºŒç»´è¡¨ç¤ºï¼Œå°½å¯èƒ½åœ°ä¿æŒæ•°æ®ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚t-SNEé¦–å…ˆç»™å‡ºæ¯ä¸ªæ•°æ®ç‚¹çš„éšæœºäºŒç»´è¡¨ç¤ºï¼Œç„¶åŽå°è¯•è®©åœ¨åŽŸå§‹ç‰¹å¾ç©ºé—´ä¸­è·ç¦»è¾ƒè¿‘çš„ç‚¹æ›´åŠ é è¿‘ï¼ŒåŽŸå§‹ç‰¹å¾ç©ºé—´ä¸­ç›¸è·è¾ƒè¿œçš„ç‚¹æ›´åŠ è¿œç¦»ã€‚t-SNEé‡ç‚¹å…³æ³¨è·ç¦»è¾ƒè¿‘çš„ç‚¹ï¼Œè€Œä¸æ˜¯ä¿æŒè·ç¦»è¾ƒè¿œçš„ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒè¯•å›¾ä¿å­˜é‚£äº›è¡¨ç¤ºå“ªäº›ç‚¹æ¯”è¾ƒé è¿‘çš„ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬å°†å¯¹<code>scikit-learn</code>åŒ…å«çš„ä¸€ä¸ªæ‰‹å†™æ•°å­—æ•°æ®é›†åº”ç”¨t-SNEæµå½¢å­¦ä¹ ç®—æ³•ã€‚åœ¨è¿™ä¸ªæ•°æ®é›†ä¸­ï¼Œæ¯ä¸ªæ•°æ®ç‚¹éƒ½æ˜¯0åˆ°9ä¹‹é—´æ‰‹å†™æ•°å­—çš„ä¸€å¼ 8x8ç°åº¦å›¾åƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_digits</span><br><span class="line"></span><br><span class="line">digits = load_digits()</span><br><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">5</span>, figsize=(<span class="number">10</span>, <span class="number">5</span>),</span><br><span class="line">    subplot_kw=&#123;<span class="string">'xticks'</span>: (), <span class="string">'yticks'</span>: ()&#125;)</span><br><span class="line"><span class="keyword">for</span> ax, img <span class="keyword">in</span> zip(axes.ravel(), digits.images):</span><br><span class="line">    ax.imshow(img)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-digits.png"></p><p>æˆ‘ä»¬ç”¨PCAå°†é™åˆ°äºŒç»´çš„æ•°æ®å¯è§†åŒ–ã€‚å¯¹å‰ä¸¤ä¸ªä¸»æˆåˆ†ä½œå›¾ï¼Œå¹¶æŒ‰ç±»åˆ«å¯¹æ•°æ®ç‚¹ç€è‰²ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pca = PCA(n_components=<span class="number">2</span>)</span><br><span class="line">pca.fit(digits.data)</span><br><span class="line">digits_pca = pca.transform(digits.data)</span><br><span class="line">colors = [<span class="string">"#476A2A"</span>, <span class="string">"#7851B8"</span>, <span class="string">"#BD3430"</span>, <span class="string">"#4A2D4E"</span>, <span class="string">"#875525"</span>,</span><br><span class="line">          <span class="string">"#A83683"</span>, <span class="string">"#4E655E"</span>, <span class="string">"#853541"</span>, <span class="string">"#3A3120"</span>, <span class="string">"#535D8E"</span>]</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">plt.xlim(digits_pca[:, <span class="number">0</span>].min(), digits_pca[:, <span class="number">0</span>].max())</span><br><span class="line">plt.ylim(digits_pca[:, <span class="number">1</span>].min(), digits_pca[:, <span class="number">1</span>].max())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(digits.data)):</span><br><span class="line">    <span class="comment"># ç”¨æ¯ä¸ªç±»åˆ«å¯¹åº”çš„æ•°å­—åˆ†åˆ«ä½œä¸ºç¬¦å·æ¥æ˜¾ç¤ºæ¯ä¸ªç±»åˆ«çš„ä½ç½®</span></span><br><span class="line">    plt.text(digits_pca[i, <span class="number">0</span>], digits_pca[i, <span class="number">1</span>], str(digits.target[i]),</span><br><span class="line">        color=colors[digits.target[i]], fontdict=&#123;<span class="string">'weight'</span>: <span class="string">'bold'</span>, <span class="string">'size'</span>: <span class="number">9</span>&#125;)</span><br><span class="line">plt.xlabel(<span class="string">'First principal component'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Second principal component'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/pca-digits.png"></p><p>åˆ©ç”¨å‰ä¸¤ä¸ªä¸»æˆåˆ†å¯ä»¥å°†æ•°å­—0ã€6å’Œ4ç›¸å¯¹è¾ƒå¥½åœ°åˆ†å¼€ï¼Œå°½ç®¡ä»æœ‰é‡å ã€‚å¤§éƒ¨åˆ†å…¶ä»–æ•°å­—éƒ½å¤§é‡é‡å åœ¨ä¸€èµ·ã€‚</p><p>æˆ‘ä»¬å°†t-SNEåº”ç”¨äºŽåŒä¸€ä¸ªæ•°æ®é›†ï¼Œå¹¶å¯¹ç»“æžœè¿›è¡Œæ¯”è¾ƒã€‚ç”±äºŽt-SNEä¸æ”¯æŒå˜æ¢æ–°æ•°æ®ï¼Œæ‰€ä»¥<code>TSNE</code>ç±»æ²¡æœ‰transformæ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨<code>fit_transform</code>æ–¹æ¥æ¥ä»£æ›¿ï¼Œå®ƒä¼šæž„å»ºæ¨¡åž‹å¹¶ç«‹å³è¿”å›žå˜æ¢åŽçš„æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.manifold <span class="keyword">import</span> TSNE</span><br><span class="line"></span><br><span class="line">tsne = TSNE(random_state=<span class="number">42</span>)</span><br><span class="line">digits_tsne = tsne.fit_transform(digits.data)</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">plt.xlim(digits_tsne[:, <span class="number">0</span>].min(), digits_tsne[:, <span class="number">0</span>].max() + <span class="number">1</span>)</span><br><span class="line">plt.ylim(digits_tsne[:, <span class="number">1</span>].min(), digits_tsne[:, <span class="number">1</span>].max() + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(digits.data)):</span><br><span class="line">    plt.text(digits_tsne[i, <span class="number">0</span>], digits_tsne[i, <span class="number">1</span>], str(digits.target[i]),</span><br><span class="line">        color=colors[digits.target[i]], fontdict=&#123;<span class="string">'weight'</span>: <span class="string">'bold'</span>, <span class="string">'size'</span>: <span class="number">9</span>&#125;)</span><br><span class="line">plt.xlabel(<span class="string">'t-SNE feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'t-SNE feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/t-sne-digits.png"></p><p>t-SNEçš„ç»“æžœéžå¸¸æ£’ã€‚æ‰€æœ‰ç±»åˆ«éƒ½è¢«æ˜Žç¡®åˆ†å¼€ã€‚æ•°å­—1å’Œ9è¢«åˆ†æˆå‡ å—ï¼Œä½†å¤§å¤šæ•°ç±»åˆ«éƒ½å½¢æˆä»¥ä¸€ä¸ªå¯†é›†çš„ç»„ã€‚<strong>è¦è®°ä½ï¼Œè¿™ç§æ–¹æ³•å¹¶ä¸çŸ¥é“ç±»åˆ«æ ‡ç­¾ï¼šå®ƒå®Œå…¨æ˜¯æ— ç›‘ç£çš„ã€‚ä½†å®ƒèƒ½å¤Ÿæ‰¾åˆ°æ•°æ®çš„ä¸€ç§äºŒç»´è¡¨ç¤ºï¼Œä»…æ ¹æ®åŽŸå§‹ç©ºé—´ä¸­æ•°æ®ç‚¹ä¹‹é—´çš„é è¿‘ç¨‹åº¦å°±èƒ½å¤Ÿå°†å„ä¸ªç±»åˆ«æ˜Žç¡®åˆ†å¼€ã€‚</strong></p><p>t-SNEç®—æ³•è¿˜æœ‰ä¸€äº›è°ƒèŠ‚å‚æ•°ï¼Œè™½ç„¶é»˜è®¤å‚æ•°çš„æ•ˆæžœé€šå¸¸å°±å¾ˆå¥½ã€‚ä½ å¯ä»¥å°è¯•ä¿®æ”¹<code>perplexity</code>å’Œ<code>early_exaggeration</code>ï¼Œä½†ä½œç”¨ä¸€èˆ¬å¾ˆå°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> unsupervised </tag>
            
            <tag> preprocessing </tag>
            
            <tag> PCA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢„å¤„ç†ä¸Žç¼©æ”¾</title>
      <link href="/notes/introduction-to-ml-with-python/preprocess-and-scaling/"/>
      <url>/notes/introduction-to-ml-with-python/preprocess-and-scaling/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›ç®—æ³•ï¼ˆå¦‚ç¥žç»ç½‘ç»œå’ŒSVMï¼‰å¯¹æ•°æ®ç¼©æ”¾éžå¸¸æ•æ„Ÿã€‚å› æ­¤ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å¯¹ç‰¹å¾è¿›è¡Œè°ƒèŠ‚ï¼Œä½¿æ•°æ®è¡¨ç¤ºæ›´é€‚åˆäºŽè¿™äº›ç®—æ³•ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™æ˜¯å¯¹æ•°æ®çš„ä¸€ç§ç®€å•çš„æŒ‰ç‰¹å¾çš„ç¼©æ”¾å’Œç§»åŠ¨ã€‚ä¸‹å›¾ç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_scaling()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/scaling.png"></p><a id="more"></a><h1 id="ä¸åŒç±»åž‹çš„é¢„å¤„ç†">ä¸åŒç±»åž‹çš„é¢„å¤„ç†</h1><p>ä¸Šå›¾ä¸­ï¼Œå·¦å›¾æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„æœ‰ä¸¤ä¸ªç‰¹å¾çš„äºŒåˆ†ç±»æ•°æ®é›†ã€‚ç¬¬ä¸€ä¸ªç‰¹å¾ï¼ˆxè½´ï¼‰ä½äºŽ10åˆ°15ä¹‹é—´ã€‚ç¬¬äºŒä¸ªç‰¹å¾ï¼ˆyè½´ï¼‰å¤§çº¦ä½äºŽ1åˆ°9ä¹‹é—´ã€‚</p><p>æŽ¥ä¸‹æ¥çš„4å¼ å›¾å±•ç¤ºäº†4ç§æ•°æ®å˜æ¢æ–¹æ³•ï¼Œéƒ½ç”Ÿæˆäº†æ›´åŠ æ ‡å‡†çš„èŒƒå›´ã€‚<code>scikit-learn</code>ä¸­çš„<code>StandardScaler</code>ç¡®ä¿æ¯ä¸ªç‰¹å¾çš„å¹³å‡å€¼ä¸º0ã€æ–¹å·®ä¸º1ï¼Œä½¿æ‰€æœ‰ç‰¹å¾éƒ½ä½äºŽåŒä¸€é‡çº§ã€‚ä½†è¿™ç§ç¼©æ”¾ä¸èƒ½ä¿è¯ç‰¹å¾ä»»ä½•ç‰¹å®šçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚<code>RobustScaler</code>çš„å·¥ä½œåŽŸç†ä¸Ž<code>StandardScaler</code>ç±»ä¼¼ï¼Œç¡®ä¿æ¯ä¸ªç‰¹å¾çš„ç»Ÿè®¡å±žæ€§éƒ½ä½äºŽç»Ÿä¸€èŒƒå›´ã€‚ä½†<code>RobustScaler</code>ä½¿ç”¨çš„æ˜¯ä¸­ä½æ•°å’Œå››åˆ†ä½æ•°ï¼Œè€Œä¸æ˜¯å¹³å‡å€¼å’Œæ–¹å·®ã€‚è¿™æ ·<code>RobustScaler</code>ä¼šå¿½ç•¥ä¸Žå…¶ä»–ç‚¹æœ‰å¾ˆå¤§ä¸åŒçš„æ•°æ®ç‚¹ï¼ˆæ¯”å¦‚æµ‹é‡è¯¯å·®ï¼‰ã€‚è¿™äº›ä¸Žä¼—ä¸åŒçš„æ•°æ®ç‚¹ä¹Ÿå«<strong>å¼‚å¸¸å€¼</strong>ï¼ˆoutlierï¼‰ï¼Œå¯èƒ½ä¼šç»™å…¶ä»–ç¼©æ”¾æ–¹æ³•é€ æˆéº»çƒ¦ã€‚</p><p>ä¸Žä¹‹ç›¸åï¼Œ<code>MinMaxScaler</code>ç§»åŠ¨æ•°æ®ï¼Œä½¿æ‰€æœ‰ç‰¹å¾éƒ½åˆšå¥½ä½äºŽ0åˆ°1ä¹‹é—´ã€‚å¯¹äºŽäºŒç»´æ•°æ®é›†æ¥è¯´ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½åŒ…å«åœ¨xè½´0åˆ°1ä¸Žyè½´0åˆ°1ç»„æˆçš„çŸ©å½¢ä¸­ã€‚</p><p>æœ€åŽï¼Œ<code>Normalizer</code>ç”¨åˆ°ä¸€ç§å®Œå…¨ä¸åŒçš„ç¼©æ”¾æ–¹æ³•ã€‚å®ƒå¯¹æ¯ä¸ªæ•°æ®ç‚¹è¿›è¡Œç¼©æ”¾ï¼Œä½¿å¾—ç‰¹å¾å‘é‡çš„æ¬§å¼é•¿åº¦ç­‰äºŽ1ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå°†æ¯ä¸€ä¸ªæ•°æ®ç‚¹æŠ•å°„åˆ°åŠå¾„ä¸º1çš„åœ†ä¸Šï¼ˆå¯¹äºŽæ›´é«˜ç»´åº¦çš„æƒ…å†µï¼Œæ˜¯çƒé¢ï¼‰ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæ•°æ®ç‚¹çš„ç¼©æ”¾æ¯”ä¾‹éƒ½ä¸ç›¸åŒï¼ˆä¹˜ä»¥å…¶é•¿åº¦çš„å€’æ•°ï¼‰ã€‚å¦‚æžœåªæœ‰æ•°æ®çš„æ–¹å‘ï¼ˆæˆ–è§’åº¦ï¼‰æ˜¯é‡è¦çš„ï¼Œè€Œç‰¹å¾å‘é‡çš„é•¿åº¦æ— å…³ç´§è¦ï¼Œé‚£ä¹ˆé€šå¸¸ä¼šä½¿ç”¨è¿™ç§å½’ä¸€åŒ–ã€‚</p><h1 id="åº”ç”¨æ•°æ®å˜æ¢">åº”ç”¨æ•°æ®å˜æ¢</h1><p>é€šå¸¸åœ¨åº”ç”¨ç›‘ç£å­¦ä¹ ç®—æ³•ä¹‹å‰ä½¿ç”¨é¢„å¤„ç†æ–¹æ³•ï¼ˆæ¯”å¦‚ç¼©æ”¾ï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦å°†æ ¸SVMåº”ç”¨åœ¨canceræ•°æ®é›†ä¸Šï¼Œå¹¶ä½¿ç”¨MinMaxScaleræ¥é¢„å¤„ç†æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_breast_cancer</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, random_state=<span class="number">1</span>)</span><br><span class="line">print(X_train.shape)</span><br><span class="line">print(X_test.shape)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(426, 30)</span><br><span class="line">(143, 30)</span><br></pre></td></tr></table></figure><p>ä¸Žæž„å»ºç›‘ç£æ¨¡åž‹ä¸€æ ·ï¼Œé¦–å…ˆå¯¼å…¥å®žçŽ°é¢„å¤„ç†çš„ç±»ï¼Œç„¶åŽå°†å…¶å®žä¾‹åŒ–ã€‚ç„¶åŽï¼Œä½¿ç”¨fitæ–¹æ³•æ‹Ÿåˆç¼©æ”¾å™¨ï¼ˆscalerï¼‰ï¼Œå¹¶å°†å…¶åº”ç”¨äºŽè®­ç»ƒæ•°æ®ã€‚å¯¹äºŽ<code>MinMaxScaler</code>æ¥è¯´ï¼Œfitæ–¹æ³•è®¡ç®—è®­ç»ƒé›†ä¸­æ¯ä¸ªç‰¹å¾çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚ä¸Žåˆ†ç±»å™¨å’Œå›žå½’å™¨ä¸åŒï¼Œåœ¨å¯¹ç¼©æ”¾å™¨è°ƒç”¨fitæ—¶åªæä¾›<code>X_train</code>ï¼Œè€Œä¸ç”¨<code>y_train</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"></span><br><span class="line">scaler = MinMaxScaler()</span><br><span class="line">scaler.fit(X_train)</span><br><span class="line"><span class="comment"># å˜æ¢æ•°æ®</span></span><br><span class="line">X_train_scaled = scaler.transform(X_train)</span><br><span class="line"><span class="comment"># åœ¨ç¼©æ”¾ä¹‹å‰å’Œä¹‹åŽåˆ†åˆ«æ‰“å°æ•°æ®é›†å±žæ€§</span></span><br><span class="line">print(<span class="string">"Transformed shape: &#123;&#125;"</span>.format(X_train_scaled.shape))</span><br><span class="line">print(<span class="string">'per-feature minimum before scaling:\n&#123;&#125;'</span>.format(X_train.min(axis=<span class="number">0</span>)))</span><br><span class="line">print(<span class="string">'per-feature maximum before scaling:\n&#123;&#125;'</span>.format(X_train.max(axis=<span class="number">0</span>)))</span><br><span class="line">print(<span class="string">'per-feature minimum after scaling:\n&#123;&#125;'</span>.format(X_train_scaled.min(axis=<span class="number">0</span>)))</span><br><span class="line">print(<span class="string">'per-feature maximum after scaling:\n&#123;&#125;'</span>.format(X_train_scaled.max(axis=<span class="number">0</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Transformed shape: (426, 30)</span><br><span class="line">per-feature minimum before scaling:</span><br><span class="line">[6.981e+00 9.710e+00 4.379e+01 1.435e+02 5.263e-02 1.938e-02 0.000e+00</span><br><span class="line"> 0.000e+00 1.060e-01 5.024e-02 1.153e-01 3.602e-01 7.570e-01 6.802e+00</span><br><span class="line"> 1.713e-03 2.252e-03 0.000e+00 0.000e+00 9.539e-03 8.948e-04 7.930e+00</span><br><span class="line"> 1.202e+01 5.041e+01 1.852e+02 7.117e-02 2.729e-02 0.000e+00 0.000e+00</span><br><span class="line"> 1.566e-01 5.521e-02]</span><br><span class="line">per-feature maximum before scaling:</span><br><span class="line">[2.811e+01 3.928e+01 1.885e+02 2.501e+03 1.634e-01 2.867e-01 4.268e-01</span><br><span class="line"> 2.012e-01 3.040e-01 9.575e-02 2.873e+00 4.885e+00 2.198e+01 5.422e+02</span><br><span class="line"> 3.113e-02 1.354e-01 3.960e-01 5.279e-02 6.146e-02 2.984e-02 3.604e+01</span><br><span class="line"> 4.954e+01 2.512e+02 4.254e+03 2.226e-01 9.379e-01 1.170e+00 2.910e-01</span><br><span class="line"> 5.774e-01 1.486e-01]</span><br><span class="line">per-feature minimum after scaling:</span><br><span class="line">[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.</span><br><span class="line"> 0. 0. 0. 0. 0. 0.]</span><br><span class="line">per-feature maximum after scaling:</span><br><span class="line">[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.</span><br><span class="line"> 1. 1. 1. 1. 1. 1.]</span><br></pre></td></tr></table></figure><p>å˜æ¢åŽçš„æ•°æ®å½¢çŠ¶ä¸ŽåŽŸå§‹æ•°æ®ç›¸åŒï¼Œç‰¹å¾åªæ˜¯å‘ç”Ÿäº†ç§»åŠ¨å’Œç¼©æ”¾ã€‚ä¸ºäº†å°†SVMåº”ç”¨åˆ°ç¼©æ”¾åŽçš„æ•°æ®ä¸Šï¼Œè¿˜éœ€è¦å¯¹æµ‹è¯•é›†è¿›è¡Œå˜æ¢ã€‚è¿™å¯ä»¥é€šè¿‡å¯¹<code>X_test</code>è°ƒç”¨transformæ–¹æ³•æ¥å®Œæˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œå˜æ¢</span></span><br><span class="line">X_test_scaled = scaler.transform(X_test)</span><br><span class="line"><span class="comment"># åœ¨ç¼©æ”¾ä¹‹åŽæ‰“å°æµ‹è¯•æ•°æ®çš„å±žæ€§</span></span><br><span class="line">print(<span class="string">'per-feature minimum after scaling:\n&#123;&#125;'</span>.format(X_test_scaled.min(axis=<span class="number">0</span>)))</span><br><span class="line">print(<span class="string">'per-feature maximum after scaling:\n&#123;&#125;'</span>.format(X_test_scaled.max(axis=<span class="number">0</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">per-feature minimum after scaling:</span><br><span class="line">[ 0.0336031   0.0226581   0.03144219  0.01141039  0.14128374  0.04406704</span><br><span class="line">  0.          0.          0.1540404  -0.00615249 -0.00137796  0.00594501</span><br><span class="line">  0.00430665  0.00079567  0.03919502  0.0112206   0.          0.</span><br><span class="line"> -0.03191387  0.00664013  0.02660975  0.05810235  0.02031974  0.00943767</span><br><span class="line">  0.1094235   0.02637792  0.          0.         -0.00023764 -0.00182032]</span><br><span class="line">per-feature maximum after scaling:</span><br><span class="line">[0.9578778  0.81501522 0.95577362 0.89353128 0.81132075 1.21958701</span><br><span class="line"> 0.87956888 0.9333996  0.93232323 1.0371347  0.42669616 0.49765736</span><br><span class="line"> 0.44117231 0.28371044 0.48703131 0.73863671 0.76717172 0.62928585</span><br><span class="line"> 1.33685792 0.39057253 0.89612238 0.79317697 0.84859804 0.74488793</span><br><span class="line"> 0.9154725  1.13188961 1.07008547 0.92371134 1.20532319 1.63068851]</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥å‘çŽ°ï¼Œå¯¹æµ‹è¯•é›†ç¼©æ”¾åŽçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ä¸æ˜¯1å’Œ0ï¼Œè¿™æˆ–è®¸æœ‰äº›å‡ºä¹Žæ„æ–™ã€‚æœ‰äº›ç‰¹å¾ç”šè‡³åœ¨0ï½ž1ä¹‹å¤–ï¼<strong>å¯¹æ­¤çš„è§£é‡Šæ˜¯ï¼Œ<code>MinMaxScaler</code>ï¼ˆä»¥åŠå…¶ä»–æ‰€æœ‰ç¼©æ”¾å™¨ï¼‰æ€»æ˜¯å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†åº”ç”¨å®Œå…¨ç›¸åŒçš„å˜æ¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œtransformæ–¹æ³•æ€»æ˜¯å‡åŽ»è®­ç»ƒé›†çš„æœ€å°å€¼ï¼Œç„¶åŽå¤„ç†è®­ç»ƒé›†èŒƒå›´ï¼Œè€Œè¿™ä¸¤ä¸ªå€¼å¯èƒ½ä¸Žæµ‹è¯•é›†çš„æœ€å°å€¼å’ŒèŒƒå›´å¹¶ä¸ç›¸åŒã€‚</strong></p><h1 id="å¯¹è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®è¿›è¡Œç›¸åŒçš„ç¼©æ”¾">å¯¹è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®è¿›è¡Œç›¸åŒçš„ç¼©æ”¾</h1><p><strong>ä¸ºäº†è®©ç›‘ç£æ¨¡åž‹èƒ½å¤Ÿåœ¨æµ‹è¯•é›†ä¸Šè¿è¡Œï¼Œå¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†åº”ç”¨å®Œå…¨ç›¸åŒçš„å˜æ¢æ˜¯å¾ˆé‡è¦çš„ã€‚</strong>å¦‚æžœæˆ‘ä»¬ä½¿ç”¨æµ‹è¯•é›†çš„æœ€å°å€¼å’ŒèŒƒå›´ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æž„é€ æ•°æ®</span></span><br><span class="line">X, _ = make_blobs(n_samples=<span class="number">50</span>, centers=<span class="number">5</span>, random_state=<span class="number">4</span>, cluster_std=<span class="number">2</span>)</span><br><span class="line"><span class="comment"># å°†å…¶åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">X_train, X_test = train_test_split(X, random_state=<span class="number">5</span>, test_size=<span class="number">.1</span>)</span><br><span class="line"><span class="comment"># ç»˜åˆ¶è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">3</span>, figsize=(<span class="number">13</span>, <span class="number">4</span>))</span><br><span class="line">axes[<span class="number">0</span>].scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>],</span><br><span class="line">    c=mglearn.cm2(<span class="number">0</span>), label=<span class="string">'Training set'</span>, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">0</span>].scatter(X_test[:, <span class="number">0</span>], X_test[:, <span class="number">1</span>], marker=<span class="string">'^'</span>,</span><br><span class="line">    c=mglearn.cm2(<span class="number">1</span>), label=<span class="string">'Test set'</span>, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">0</span>].legend(loc=<span class="string">'upper left'</span>)</span><br><span class="line">axes[<span class="number">0</span>].set_title(<span class="string">'Original Data'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨MinMaxScalerç¼©æ”¾æ•°æ®</span></span><br><span class="line">scaler = MinMaxScaler()</span><br><span class="line">scaler.fit(X_train)</span><br><span class="line">X_train_scaled = scaler.transform(X_train)</span><br><span class="line">X_test_scaled = scaler.transform(X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ­£ç¡®ç¼©æ”¾çš„æ•°æ®å¯è§†åŒ–</span></span><br><span class="line">axes[<span class="number">1</span>].scatter(X_train_scaled[:, <span class="number">0</span>], X_train_scaled[:, <span class="number">1</span>],</span><br><span class="line">    c=mglearn.cm2(<span class="number">0</span>), label=<span class="string">'Training set'</span>, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">1</span>].scatter(X_test_scaled[:, <span class="number">0</span>], X_test_scaled[:, <span class="number">1</span>], marker=<span class="string">'^'</span>,</span><br><span class="line">    c=mglearn.cm2(<span class="number">1</span>), label=<span class="string">'Test set'</span>, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">1</span>].set_title(<span class="string">'Scaled Data'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•ç‹¬å¯¹æµ‹è¯•é›†è¿›è¡Œç¼©æ”¾</span></span><br><span class="line"><span class="comment"># ä½¿å¾—æµ‹è¯•é›†çš„æœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1</span></span><br><span class="line"><span class="comment"># åƒä¸‡ä¸è¦è¿™ä¹ˆåšï¼è¿™é‡Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹</span></span><br><span class="line">test_scaler = MinMaxScaler()</span><br><span class="line">test_scaler.fit(X_test)</span><br><span class="line">X_test_scaled_badly = test_scaler.transform(X_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†é”™è¯¯ç¼©æ”¾çš„æ•°æ®å¯è§†åŒ–</span></span><br><span class="line">axes[<span class="number">2</span>].scatter(X_train_scaled[:, <span class="number">0</span>], X_train_scaled[:, <span class="number">1</span>],</span><br><span class="line">    c=mglearn.cm2(<span class="number">0</span>), label=<span class="string">'Training set'</span>, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">2</span>].scatter(X_test_scaled_badly[:, <span class="number">0</span>], X_test_scaled_badly[:, <span class="number">1</span>],</span><br><span class="line">    marker=<span class="string">'^'</span>, c=mglearn.cm2(<span class="number">1</span>), label=<span class="string">'Test set'</span>, s=<span class="number">60</span>)</span><br><span class="line">axes[<span class="number">2</span>].set_title(<span class="string">'Improperly Scaled Data'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ax <span class="keyword">in</span> axes:</span><br><span class="line">    ax.set_xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/minmaxscaling-of-blobs.png"></p><p>ä½ å¯ä»¥å‘çŽ°ï¼Œç¬¬äºŒå¼ å›¾ä¸­çš„æ•°æ®é›†çœ‹èµ·æ¥ä¸Žç¬¬ä¸€å¼ å›¾ä¸­çš„å®Œå…¨ç›¸åŒï¼Œåªæ˜¯åæ ‡è½´åˆ»åº¦å‘ç”Ÿäº†å˜åŒ–ã€‚çŽ°åœ¨æ‰€æœ‰ç‰¹å¾éƒ½ä½äºŽ0åˆ°1ä¹‹é—´ã€‚ä½ è¿˜å¯ä»¥å‘çŽ°ï¼Œæµ‹è¯•æ•°æ®çš„ç‰¹å¾æœ€å¤§å€¼å’Œæœ€å°å€¼å¹¶ä¸æ˜¯1å’Œ0ã€‚ç¬¬ä¸‰å¼ å›¾å±•ç¤ºäº†å¦‚æžœæˆ‘ä»¬å¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†åˆ†åˆ«è¿›è¡Œç¼©æ”¾ä¼šå‘ç”Ÿä»€ä¹ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è®­ç»ƒé›†å’Œæµ‹è¯•é›†è€Œè¨€ï¼Œç‰¹å¾çš„æœ€å¤§å€¼å’Œæœ€å°å€¼éƒ½æ˜¯1å’Œ0ã€‚ä½†çŽ°åœ¨æ•°æ®é›†çœ‹èµ·æ¥ä¸ä¸€æ ·ã€‚æµ‹è¯•é›†ç›¸å¯¹è®­ç»ƒé›†çš„ç§»åŠ¨ä¸ä¸€è‡´ï¼Œå› ä¸ºå®ƒä»¬åˆ†åˆ«åšäº†ä¸åŒçš„ç¼©æ”¾ã€‚æˆ‘ä»¬éšæ„æ”¹å˜äº†æ•°æ®çš„æŽ’åˆ—ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦åšçš„äº‹ã€‚</p><p>é€šå¸¸æ¥æ‰€ï¼Œä½ æƒ³è¦åœ¨æŸä¸ªæ•°æ®é›†ä¸Šfitä¸€ä¸ªæ¨¡åž‹ï¼Œç„¶åŽå†å°†å…¶transformã€‚è¿™æ˜¯ä¸€ä¸ªéžå¸¸å¸¸è§çš„ä»»åŠ¡ã€‚</p><ul><li><p>å¿«æ·æ–¹å¼ï¼šä½¿ç”¨æ–¹æ³•é“¾ã€‚ä¾‹å¦‚ï¼Œ<code>X_scaled = scaler.fit(X).transform(X)</code>ã€‚</p></li><li><p>é«˜æ•ˆçš„æ›¿ä»£æ–¹æ³•ï¼šä½¿ç”¨<code>fit_transform</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ<code>X_scaled = scaler.fit_transform(X)</code>ã€‚</p></li></ul><p>æ‰€æœ‰å…·æœ‰<code>transform</code>æ–¹æ³•çš„æ¨¡åž‹ï¼Œä¹Ÿéƒ½å…·æœ‰ä¸€ä¸ª<code>fit_transform</code>æ–¹æ³•ã€‚è™½ç„¶<code>fit_transform</code>ä¸ä¸€å®šå¯¹æ‰€æœ‰æ¨¡åž‹éƒ½æ›´åŠ é«˜æ•ˆï¼Œä½†åœ¨å°è¯•å˜æ¢è®­ç»ƒé›†æ—¶ï¼Œä½¿ç”¨è¿™ä¸€æ–¹æ³•ä»ç„¶æ˜¯å¾ˆå¥½çš„åšæ³•ã€‚</p><h1 id="é¢„å¤„ç†å¯¹ç›‘ç£å­¦ä¹ çš„ä½œç”¨">é¢„å¤„ç†å¯¹ç›‘ç£å­¦ä¹ çš„ä½œç”¨</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, random_state=<span class="number">1</span>)</span><br><span class="line">svm = SVC(C=<span class="number">100</span>)</span><br><span class="line">svm.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Test set accuracy: &#123;:.2f&#125;'</span>.format(svm.score(X_test, y_test)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨0-1ç¼©æ”¾è¿›è¡Œé¢„å¤„ç†</span></span><br><span class="line">scaler = MinMaxScaler()</span><br><span class="line">scaler.fit(X_train)</span><br><span class="line">X_train_scaled = scaler.transform(X_train)</span><br><span class="line">X_test_scaled = scaler.transform(X_test)</span><br><span class="line"><span class="comment"># åœ¨ç¼©æ”¾åŽçš„è®­ç»ƒæ•°æ®ä¸Šå­¦ä¹ SVM</span></span><br><span class="line">svm.fit(X_train_scaled, y_train)</span><br><span class="line"><span class="comment"># åœ¨ç¼©æ”¾åŽçš„æµ‹è¯•é›†ä¸Šè®¡ç®—åˆ†æ•°</span></span><br><span class="line">print(<span class="string">'Scaled test set accuracy: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">    svm.score(X_test_scaled, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test set accuracy: 0.62</span><br><span class="line">Scaled test set accuracy: 0.97</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> unsupervised </tag>
            
            <tag> preprocessing </tag>
            
            <tag> scaling </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— ç›‘ç£å­¦ä¹ ä¸Žé¢„å¤„ç†</title>
      <link href="/notes/introduction-to-ml-with-python/unsupervised-learning-and-preprocessing/"/>
      <url>/notes/introduction-to-ml-with-python/unsupervised-learning-and-preprocessing/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— ç›‘ç£å­¦ä¹ çš„ç±»åž‹">æ— ç›‘ç£å­¦ä¹ çš„ç±»åž‹</h1><p>æœ¬ç« å°†ç ”ç©¶ä¸¤ç§ç±»åž‹çš„æ— ç›‘ç£å­¦ä¹ ï¼šæ•°æ®é›†å˜æ¢ä¸Žèšç±»ã€‚</p><p>æ•°æ®é›†çš„<strong>æ— ç›‘ç£å˜æ¢</strong>ï¼ˆunsupervised transformationï¼‰æ˜¯åˆ›å»ºæ•°æ®æ–°çš„è¡¨ç¤ºçš„ç®—æ³•ï¼Œä¸Žæ•°æ®çš„åŽŸå§‹è¡¨ç¤ºç›¸æ¯”ï¼Œæ–°çš„è¡¨ç¤ºå¯èƒ½æ›´å®¹æ˜“è¢«äººæˆ–å…¶ä»–æœºå™¨å­¦ä¹ ç®—æ³•æ‰€ç†è§£ã€‚æ— ç›‘ç£å˜æ¢çš„ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯<strong>é™ç»´</strong>ï¼ˆdimensionality reductionï¼‰ï¼Œå®ƒæŽ¥å—åŒ…å«è®¸å¤šç‰¹å¾çš„æ•°æ®çš„é«˜ç»´è¡¨ç¤ºï¼Œå¹¶æ‰¾åˆ°è¡¨ç¤ºè¯¥æ•°æ®çš„ä¸€ç§æ–°æ–¹æ³•ï¼Œç”¨è¾ƒå°‘çš„ç‰¹å¾å°±å¯ä»¥æ¦‚æ‹¬å…¶ç‰¹æ€§ã€‚é™ç»´çš„ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯ä¸ºäº†å¯è§†åŒ–å°†æ•°æ®é™ä¸ºäºŒç»´ã€‚</p><p>æ— ç›‘ç£å˜æ¢çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯æ‰¾åˆ°â€œæž„æˆâ€æ•°æ®çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚è¿™æ–¹é¢çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å¯¹æ–‡æœ¬æ–‡æ¡£é›†åˆè¿›è¡Œä¸»é¢˜æå–ã€‚è¿™é‡Œçš„ä»»åŠ¡æ˜¯æ‰¾åˆ°æ¯ä¸ªæ–‡æ¡£ä¸­è®¨è®ºçš„æœªçŸ¥ä¸»é¢˜ï¼Œå¹¶å­¦ä¹ æ¯ä¸ªæ–‡æ¡£ä¸­å‡ºçŽ°äº†å“ªäº›ä¸»é¢˜ã€‚è¿™å¯ä»¥ç”¨äºŽè¿½è¸ªç¤¾äº¤åª’ä½“ä¸Šçš„è¯é¢˜è®¨è®ºï¼Œæ¯”å¦‚é€‰ä¸¾ã€æžªæ”¯ç®¡åˆ¶æˆ–æµè¡Œæ­Œæ‰‹ç­‰è¯é¢˜ã€‚</p><p>ä¸Žä¹‹ç›¸åï¼Œ<strong>èšç±»ç®—æ³•</strong>ï¼ˆclustering algorithmï¼‰å°†æ•°æ®åˆ’åˆ†æˆä¸åŒçš„ç»„ï¼Œæ¯ç»„åŒ…å«ç›¸ä¼¼çš„ç‰©é¡¹ã€‚æ€è€ƒå‘ç¤¾äº¤åª’ä½“ç½‘ç«™ä¸Šä¼ ç…§ç‰‡çš„ä¾‹å­ã€‚ä¸ºäº†æ–¹ä¾¿ä½ æ•´ç†ç…§ç‰‡ï¼Œç½‘ç«™å¯èƒ½æƒ³è¦å°†åŒä¸€ä¸ªäººçš„ç…§ç‰‡åˆ†åœ¨ä¸€ç»„ã€‚ä½†ç½‘ç«™å¹¶ä¸çŸ¥é“æ¯å¼ ç…§ç‰‡æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“ä½ çš„ç…§ç‰‡é›†ä¸­å‡ºçŽ°äº†å¤šå°‘ä¸ªäººã€‚æ˜Žæ™ºçš„åšæ³•æ˜¯æå–æ‰€æœ‰çš„äººè„¸ï¼Œå¹¶å°†çœ‹èµ·æ¥ç›¸ä¼¼çš„äººè„¸åˆ†åœ¨ä¸€ç»„ã€‚ä½†æ„¿è¿™äº›äººè„¸å¯¹åº”åŒä¸€ä¸ªäººï¼Œè¿™æ ·ç…§ç‰‡çš„åˆ†ç»„ä¹Ÿå°±å®Œæˆäº†ã€‚</p><a id="more"></a><h1 id="æ— ç›‘ç£å­¦ä¹ çš„æŒ‘æˆ˜">æ— ç›‘ç£å­¦ä¹ çš„æŒ‘æˆ˜</h1><p>æ— ç›‘ç£å­¦ä¹ çš„ä¸€ä¸ªä¸»è¦æŒ‘æˆ˜å°±æ˜¯è¯„ä¼°ç®—æ³•æ˜¯å¦å­¦åˆ°äº†æœ‰ç”¨çš„ä¸œè¥¿ã€‚æ— ç›‘ç£å­¦ä¹ ç®—æ³•ä¸€èˆ¬ç”¨äºŽä¸åŒ…å«ä»»ä½•æ ‡ç­¾ä¿¡æ¯çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸çŸ¥é“æ­£ç¡®çš„è¾“å‡ºåº”è¯¥æ˜¯ä»€ä¹ˆã€‚å› æ­¤å¾ˆéš¾åˆ¤æ–­ä¸€ä¸ªæ¨¡åž‹æ˜¯å¦â€œè¡¨çŽ°å¾ˆå¥½â€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„èšç±»ç®—æ³•å·²ç»å°†æ‰€æœ‰çš„ä¾§è„¸ç…§ç‰‡å’Œæ‰€æœ‰çš„æ­£é¢ç…§ç‰‡è¿›è¡Œåˆ†ç»„ã€‚è¿™è‚¯å®šæ˜¯äººè„¸ç…§ç‰‡é›†åˆçš„ä¸€ç§å¯èƒ½çš„åˆ’åˆ†æ–¹æ³•ï¼Œä½†å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„é‚£ç§æ–¹æ³•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ²¡æœ‰åŠžæ³•â€œå‘Šè¯‰â€ç®—æ³•æˆ‘ä»¬è¦çš„æ˜¯ä»€ä¹ˆï¼Œé€šå¸¸æ¥è¯´ï¼Œè¯„ä¼°æ— ç›‘ç£ç®—æ³•ç»“æžœçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯äººå·¥æ£€æŸ¥ã€‚</p><p>å› æ­¤ï¼Œå¦‚æžœæ•°æ®ç§‘å­¦å®¶æƒ³è¦æ›´å¥½åœ°ç†è§£æ•°æ®ï¼Œé‚£ä¹ˆæ— ç›‘ç£ç®—æ³•é€šå¸¸å¯ç”¨äºŽæŽ¢ç´¢çš„ç›®çš„ï¼Œè€Œä¸æ˜¯ä½œä¸ºå¤§åž‹è‡ªåŠ¨åŒ–ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚æ— ç›‘ç£ç®—æ³•çš„å¦ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯ä½œä¸ºç›‘ç£ç®—æ³•çš„é¢„å¤„ç†æ­¥éª¤ã€‚å­¦ä¹ æ•°æ®çš„ä¸€ç§æ–°çš„è¡¨ç¤ºï¼Œæœ‰æ—¶å¯ä»¥æé«˜ç›‘ç£ç®—æ³•çš„ç²¾åº¦ï¼Œæˆ–è€…å¯ä»¥å‡å°‘å†…å­˜å ç”¨å’Œæ—¶é—´å¼€é”€ã€‚</p><p>åœ¨å¼€å§‹å­¦ä¹ â€œçœŸæ­£çš„â€æ— ç›‘ç£ç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€è¦è®¨è®ºå‡ ç§ç®€å•åˆå¸¸ç”¨çš„é¢„å¤„ç†æ–¹æ³•ã€‚è™½ç„¶é¢„å¤„ç†å’Œç¼©æ”¾é€šå¸¸ä¸Žç›‘ç£å­¦ä¹ ç®—æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä½†ç¼©æ”¾æ–¹æ³•å¹¶æ²¡æœ‰ç”¨åˆ°ä¸Žâ€œç›‘ç£â€æœ‰å…³çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å®ƒæ˜¯æ— ç›‘ç£çš„ã€‚</p><h1 id="é¢„å¤„ç†ä¸Žç¼©æ”¾">é¢„å¤„ç†ä¸Žç¼©æ”¾</h1><a href="/notes/introduction-to-ml-with-python/preprocess-and-scaling/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h1 id="é™ç»´ç‰¹å¾æå–ä¸Žæµå½¢å­¦ä¹ ">é™ç»´ã€ç‰¹å¾æå–ä¸Žæµå½¢å­¦ä¹ </h1><a href="/notes/introduction-to-ml-with-python/dimensionality-reduction-feature-extraction-and-manifold-learning/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h1 id="èšç±»">èšç±»</h1><a href="/notes/introduction-to-ml-with-python/clustering/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h1 id="å°ç»“">å°ç»“</h1><p>æœ¬ç« ä»‹ç»äº†ä¸€ç³»åˆ—æ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œå¯ç”¨äºŽæŽ¢ç´¢æ€§æ•°æ®åˆ†æžå’Œé¢„å¤„ç†ã€‚æ‰¾åˆ°æ•°æ®çš„æ­£ç¡®è¡¨ç¤ºå¯¹äºŽç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ çš„æˆåŠŸé€šå¸¸éƒ½è‡³å…³é‡è¦ï¼Œé¢„å¤„ç†å’Œåˆ†è§£æ–¹æ³•åœ¨æ•°æ®å‡†å¤‡ä¸­å…·æœ‰é‡è¦ä½œç”¨ã€‚</p><p>åˆ†è§£ã€æµå½¢å­¦ä¹ å’Œèšç±»éƒ½æ˜¯åŠ æ·±æ•°æ®ç†è§£çš„é‡è¦å·¥å…·ï¼Œåœ¨æ²¡æœ‰ç›‘ç£ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯ç†è§£æ•°æ®çš„ä»…æœ‰æ–¹æ³•ã€‚å³ä½¿åœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼ŒæŽ¢ç´¢æ€§å·¥å…·å¯¹äºŽæ›´å¥½åœ°ç†è§£æ•°æ®æ€§è´¨ä¹Ÿå¾ˆé‡è¦ã€‚é€šå¸¸æ¥è¯´ï¼Œå¾ˆéš¾é‡åŒ–æ— ç›‘ç£ç®—æ³•çš„æœ‰ç”¨æ€§ï¼Œä½†è¿™ä¸åº”è¯¥å¦¨ç¢ä½ ä½¿ç”¨å®ƒä»¬æ¥æ·±å…¥ç†è§£æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> unsupervised </tag>
            
            <tag> preprocessing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¥žç»ç½‘ç»œï¼ˆæ·±åº¦å­¦ä¹ ï¼‰</title>
      <link href="/notes/introduction-to-ml-with-python/neural-networks-deep-learning/"/>
      <url>/notes/introduction-to-ml-with-python/neural-networks-deep-learning/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç±»è¢«ç§°ä¸ºç¥žç»ç½‘ç»œçš„ç®—æ³•æœ€è¿‘ä»¥â€œæ·±åº¦å­¦ä¹ â€œçš„åå­—å†åº¦æµè¡Œã€‚è™½ç„¶æ·±åº¦å­¦ä¹ åœ¨è®¸å¤šæœºå™¨å­¦ä¹ åº”ç”¨ä¸­éƒ½æœ‰å·¨å¤§çš„æ½œåŠ›ï¼Œä½†æ·±åº¦å­¦ä¹ ç®—æ³•å¾€å¾€ç»è¿‡ç²¾ç¡®è°ƒæ•´ï¼Œåªé€‚ç”¨äºŽç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ã€‚è¿™é‡Œåªè®¨è®ºä¸€äº›ç›¸å¯¹ç®€å•çš„æ–¹æ³•ï¼Œå³ç”¨äºŽåˆ†ç±»å’Œå›žå½’çš„<strong>å¤šå±‚æ„ŸçŸ¥æœº</strong>ï¼ˆmultilayer perceptronï¼ŒMLPï¼‰ï¼Œå®ƒå¯ä»¥ä½œä¸ºç ”ç©¶æ›´å¤æ‚çš„æ·±åº¦å­¦ä¹ æ–¹æ³•çš„èµ·ç‚¹ã€‚MLPä¹Ÿè¢«ç§°ä¸ºï¼ˆæ™®é€šï¼‰å‰é¦ˆç¥žç»ç½‘ç»œï¼Œæœ‰æ—¶ä¹Ÿç®€ç§°ä¸ºç¥žç»ç½‘ç»œã€‚</p><h1 id="ç¥žç»ç½‘ç»œæ¨¡åž‹">ç¥žç»ç½‘ç»œæ¨¡åž‹</h1><p>MLPå¯ä»¥è¢«è§†ä¸ºå¹¿ä¹‰çš„çº¿æ€§æ¨¡åž‹ï¼Œæ‰§è¡Œå¤šå±‚å¤„ç†åŽå¾—åˆ°ç»“è®ºã€‚</p><p>çº¿æ€§å›žå½’çš„é¢„æµ‹å…¬å¼ä¸ºï¼š</p><p><span class="math display">\[\hat y=w[0]*x[0]+w[1]*x[1]+\dots+w[p]*x[p]+b\]</span></p><p>ç®€å•æ¥è¯´ï¼Œ<span class="math inline">\(\hat y\)</span>æ˜¯è¾“å…¥ç‰¹å¾<span class="math inline">\(x[0]\)</span>åˆ°<span class="math inline">\(x[p]\)</span>çš„åŠ æƒæ±‚å’Œï¼Œæƒé‡ä¸ºå­¦åˆ°çš„ç³»æ•°<span class="math inline">\(w[0]\)</span>åˆ°<span class="math inline">\(w[p]\)</span>ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå…¬å¼å¯è§†åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">g = mglearn.plots.plot_logistic_regression_graph()</span><br><span class="line">g.render(filename=<span class="string">'visualization-of-logistic-regression'</span>,</span><br><span class="line">    view=<span class="literal">True</span>, format=<span class="string">'svg'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/visualization-of-logistic-regression.svg"></p><a id="more"></a><p>å›¾ä¸­ï¼Œå·¦è¾¹çš„æ¯ä¸ªç»“ç‚¹ä»£è¡¨ä¸€ä¸ªè¾“å…¥ç‰¹å¾ï¼Œè¿žçº¿ä»£è¡¨å­¦åˆ°çš„ç³»æ•°ï¼Œå³è¾¹çš„ç»“ç‚¹ä»£è¡¨è¾“å‡ºï¼Œæ˜¯è¾“å…¥çš„åŠ æƒæ±‚å’Œã€‚</p><p>åœ¨MLPä¸­ï¼Œå¤šæ¬¡é‡å¤è¿™ä¸ªè®¡ç®—åŠ æƒæ±‚å’Œçš„è¿‡ç¨‹ï¼Œé¦–å…ˆè®¡ç®—ä»£è¡¨ä¸­é—´è¿‡ç¨‹çš„<strong>éšå•å…ƒ</strong>ï¼ˆhidden unitï¼‰ï¼Œç„¶åŽå†è®¡ç®—è¿™äº›éšå•å…ƒçš„åŠ æƒæ±‚å’Œå¹¶å¾—åˆ°æœ€ç»ˆç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">g = mglearn.plots.plot_single_hidden_layer_graph()</span><br><span class="line">g.render(filename=<span class="string">'single-hidden-layer-mlp'</span>, format=<span class="string">'svg'</span>, view=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/visualization-of-single-hidden-layer-mlp.svg"></p><p>è¿™ä¸ªæ¨¡åž‹éœ€è¦å­¦ä¹ æ›´å¤šçš„ç³»æ•°ï¼ˆä¹Ÿå«ä½œæƒé‡ï¼‰ï¼šåœ¨æ¯ä¸ªè¾“å…¥ä¸Žæ¯ä¸ªéšå•å…ƒï¼ˆéšå•å…ƒç»„æˆäº†<strong>éšå±‚</strong>ï¼‰ä¹‹é—´æœ‰ä¸€ä¸ªç³»æ•°ï¼Œåœ¨æ¯ä¸ªéšå•å…ƒä¸Žè¾“å‡ºä¹‹é—´ä¹Ÿæœ‰ä¸€ä¸ªç³»æ•°ã€‚</p><p>ä»Žæ•°å­¦çš„è§’åº¦çœ‹ï¼Œè®¡ç®—ä¸€ç³»åˆ—åŠ æƒæ±‚å’Œä¸Žåªè®¡ç®—ä¸€ä¸ªåŠ æƒæ±‚å’Œæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå› æ­¤ï¼Œä¸ºäº†è®©è¿™ä¸ªæ¨¡åž‹çœŸæ­£æ¯”çº¿æ€§æ¨¡åž‹æ›´ä¸ºå¼ºå¤§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæŠ€å·§ã€‚åœ¨è®¡ç®—å®Œæ¯ä¸ªéšå•å…ƒçš„åŠ æƒæ±‚å’Œä¹‹åŽï¼Œå¯¹ç»“æžœå†åº”ç”¨ä¸€ä¸ªéžçº¿æ€§å‡½æ•°â€”â€”é€šå¸¸æ˜¯<strong>æ ¡æ­£éžçº¿æ€§</strong>ï¼ˆrectifying nonlinearityï¼Œä¹Ÿå«æ ¡æ­£çº¿æ€§å•å…ƒæˆ–reluï¼‰æˆ–<strong>æ­£åˆ‡åŒæ›²çº¿</strong>ï¼ˆtangens hyperbolicusï¼Œtanhï¼‰ã€‚ç„¶åŽå°†è¿™ä¸ªå‡½æ•°çš„ç»“æžœç”¨äºŽåŠ æƒæ±‚å’Œï¼Œè®¡ç®—å¾—åˆ°è¾“å‡º<span class="math inline">\(\hat y\)</span>ã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„å¯è§†åŒ–æ•ˆæžœå¦‚å›¾ã€‚reluæˆªæ–­å°äºŽ0çš„å€¼ï¼Œè€Œtanhåœ¨è¾“å‡ºå€¼è¾ƒå°æ—¶æŽ¥è¿‘-1ï¼Œåœ¨è¾“å‡ºå€¼è¾ƒå¤§æ—¶æŽ¥è¿‘+1ã€‚æœ‰äº†è¿™ä¸¤ç§éžçº¿æ€§å‡½æ•°ï¼Œç¥žç»ç½‘ç»œå¯ä»¥å­¦ä¹ æ¯”çº¿æ€§æ¨¡åž‹å¤æ‚å¾—å¤šçš„å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">line = np.linspace(<span class="number">-3</span>, <span class="number">3</span>, <span class="number">100</span>)</span><br><span class="line">plt.plot(line, np.tanh(line), label=<span class="string">'tanh'</span>)</span><br><span class="line">plt.plot(line, np.maximum(line, <span class="number">0</span>), label=<span class="string">'relu'</span>)</span><br><span class="line">plt.legend(loc=<span class="string">'best'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'x'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'relu(x), tanh(x)'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/visualization-of-relu-and-tanh.png"></p><p>ä¾‹å¦‚å¯¹ä¸Šè¿°çš„å•éšå±‚æ„ŸçŸ¥æœºï¼Œè®¡ç®—å›žå½’é—®é¢˜çš„<span class="math inline">\(\hat y\)</span>çš„å®Œæ•´å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[\begin{aligned}h[0] &amp;= tanh(w[0, 0]*x[0]+w[1, 0]*x[1]+w[2, 0]*x[2]+w[3, 0]*x[3]+b[0])\\h[1] &amp;= tanh(w[0, 1]*x[0]+w[1, 1]*x[1]+w[2, 1]*x[2]+w[3, 1]*x[3]+b[1])\\h[2] &amp;= tanh(w[0, 2]*x[0]+w[1, 2]*x[1]+w[2, 2]*x[2]+w[3, 2]*x[3]+b[2])\\\hat y &amp;= v[0]*h[0]+v[1]*h[1]+v[2]*h[2]+b\end{aligned}\]</span></p><p>å…¶ä¸­ï¼Œ<span class="math inline">\(w\)</span>æ˜¯è¾“å…¥<span class="math inline">\(x\)</span>ä¸Žéšå±‚<span class="math inline">\(h\)</span>ä¹‹é—´çš„æƒé‡ï¼Œ<span class="math inline">\(v\)</span>æ˜¯éšå±‚<span class="math inline">\(h\)</span>ä¸Žè¾“å‡º<span class="math inline">\(\hat y\)</span>ä¹‹é—´çš„æƒé‡ã€‚æƒé‡<span class="math inline">\(w\)</span>å’Œ<span class="math inline">\(v\)</span>è¦ä»Žæ•°æ®ä¸­å­¦ä¹ å¾—åˆ°ï¼Œ<span class="math inline">\(x\)</span>æ˜¯è¾“å…¥ç‰¹å¾ï¼Œ<span class="math inline">\(\hat y\)</span>æ˜¯è®¡ç®—å¾—åˆ°çš„è¾“å‡ºï¼Œ<span class="math inline">\(h\)</span>æ˜¯è®¡ç®—çš„ä¸­é—´ç»“æžœã€‚éœ€è¦ç”¨æˆ·è®¾ç½®çš„ä¸€ä¸ªé‡è¦å‚æ•°æ˜¯éšå±‚ä¸­çš„ç»“ç‚¹ä¸ªæ•°ã€‚å¯¹äºŽéžå¸¸å°æˆ–éžå¸¸ç®€å•çš„æ•°æ®é›†ï¼Œè¿™ä¸ªå€¼å¯ä»¥å°åˆ°10ï¼›å¯¹äºŽéžå¸¸å¤æ‚çš„æ•°æ®ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§åˆ°10000.ä¹Ÿå¯ä»¥æ·»åŠ å¤šä¸ªéšå±‚ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">g = mglearn.plots.plot_two_hidden_layer_graph()</span><br><span class="line">g.render(filename=<span class="string">'visualization-of-two-hidden-layer-mlp'</span>,</span><br><span class="line">    view=<span class="literal">True</span>, format=<span class="string">'svg'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/visualization-of-two-hidden-layer-mlp.svg"></p><p>è¿™äº›ç”±è®¸å¤šè®¡ç®—å±‚ç»„æˆçš„å¤§åž‹ç¥žç»ç½‘ç»œï¼Œæ­£æ˜¯æœ¯è¯­â€œæ·±åº¦å­¦ä¹ â€çš„çµæ„Ÿæ¥æºã€‚</p><h1 id="ç¥žç»ç½‘ç»œè°ƒå‚">ç¥žç»ç½‘ç»œè°ƒå‚</h1><p>æˆ‘ä»¬å°†MLPClassifieråº”ç”¨åˆ°two_moonsæ•°æ®é›†ä¸Šï¼Œä»¥æ­¤ç ”ç©¶MLPçš„å·¥ä½œåŽŸç†ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.neural_network.mlpclassifier" target="_blank" rel="noopener"><code>class sklearn.neural_network.MLPClassifier(hidden_layer_sizes=(100, ), activation=â€™reluâ€™, solver=â€™adamâ€™, alpha=0.0001, batch_size=â€™autoâ€™, learning_rate=â€™constantâ€™, learning_rate_init=0.001, power_t=0.5, max_iter=200, shuffle=True, random_state=None, tol=0.0001, verbose=False, warm_start=False, momentum=0.9, nesterovs_momentum=True, early_stopping=False, validation_fraction=0.1, beta_1=0.9, beta_2=0.999, epsilon=1e-08, n_iter_no_change=10)</code></a></p><p>Multi-layer Perceptron classifier.</p><p>This model optimizes the log-loss function using LBFGS or stochastic gradient descent.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = make_moons(n_samples=<span class="number">100</span>, noise=<span class="number">0.25</span>, random_state=<span class="number">3</span>)</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    X, y, stratify=y, random_state=<span class="number">42</span>)</span><br><span class="line">mlp = MLPClassifier(solver=<span class="string">'lbfgs'</span>, random_state=<span class="number">0</span>).fit(X_train, y_train)</span><br><span class="line">mglearn.plots.plot_2d_separator(mlp, X_train, fill=<span class="literal">True</span>, alpha=<span class="number">.3</span>)</span><br><span class="line">mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-100-hidden-nodes-mlp.png"></p><p>å¦‚ä½ æ‰€è§ï¼Œç¥žç»ç½‘ç»œå­¦åˆ°çš„å†³ç­–è¾¹ç•Œå®Œå…¨æ˜¯éžçº¿æ€§çš„ï¼Œä½†ç›¸å¯¹å¹³æ»‘ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMLPä½¿ç”¨100ä¸ªéšç»“ç‚¹ï¼Œè¿™å¯¹äºŽè¿™ä¸ªå°åž‹æ•°æ®é›†æ¥è¯´å·²ç»ç›¸å½“å¤šäº†ã€‚æˆ‘ä»¬å¯ä»¥å‡å°‘å…¶æ•°é‡ï¼ˆä»Žè€Œé™ä½Žäº†æ¨¡åž‹å¤æ‚åº¦ï¼‰ï¼Œä½†ä»ç„¶å¾—åˆ°å¾ˆå¥½çš„ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mlp = MLPClassifier(solver=<span class="string">'lbfgs'</span>, random_state=<span class="number">0</span>, hidden_layer_sizes=[<span class="number">10</span>])</span><br><span class="line">mlp.fit(X_train, y_train)</span><br><span class="line">mglearn.plots.plot_2d_separator(mlp, X_train, fill=<span class="literal">True</span>, alpha=<span class="number">.3</span>)</span><br><span class="line">mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-10-hidden-nodes-mlp.png"></p><p>åªæœ‰10ä¸ªéšå•å…ƒæ—¶ï¼Œå†³ç­–è¾¹ç•Œçœ‹èµ·æ¥æ›´åŠ å‚å·®ä¸é½ã€‚é»˜è®¤çš„éžçº¿æ€§æ˜¯reluã€‚å¦‚æžœä½¿ç”¨å•éšå±‚ï¼Œé‚£ä¹ˆå†³ç­–å‡½æ•°å°†ç”±10ä¸ªç›´çº¿æ®µç»„æˆã€‚å¦‚æžœæƒ³å¾—åˆ°æ›´åŠ å¹³æ»‘çš„å†³ç­–è¾¹ç•Œï¼Œå¯ä»¥æ·»åŠ æ›´å¤šçš„éšå•å…ƒã€æ·»åŠ ç¬¬äºŒä¸ªéšå±‚æˆ–è€…ä½¿ç”¨tanhéžçº¿æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨2ä¸ªéšå±‚ï¼Œæ¯ä¸ªåŒ…å«10ä¸ªå•å…ƒ</span></span><br><span class="line">mlp = MLPClassifier(solver=<span class="string">'lbfgs'</span>, random_state=<span class="number">0</span>, hidden_layer_sizes=[<span class="number">10</span>, <span class="number">10</span>])</span><br><span class="line">mlp.fit(X_train, y_train)</span><br><span class="line">mglearn.plots.plot_2d_separator(mlp, X_train, fill=<span class="literal">True</span>, alpha=<span class="number">.3</span>)</span><br><span class="line">mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-10-10-hidden-nodes-mlp.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨2ä¸ªéšå±‚ï¼Œæ¯ä¸ªåŒ…å«10ä¸ªå•å…ƒï¼Œè¿™æ¬¡ä½¿ç”¨tanhéžçº¿æ€§</span></span><br><span class="line">mlp = MLPClassifier(solver=<span class="string">'lbfgs'</span>, activation=<span class="string">'tanh'</span>,</span><br><span class="line">    random_state=<span class="number">0</span>, hidden_layer_sizes=[<span class="number">10</span>, <span class="number">10</span>])</span><br><span class="line">mlp.fit(X_train, y_train)</span><br><span class="line">mglearn.plots.plot_2d_separator(mlp, X_train, fill=<span class="literal">True</span>, alpha=<span class="number">.3</span>)</span><br><span class="line">mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-10-10-hidden-nodes-mlp-tanh.png"></p><p>æœ€åŽï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨L2æƒ©ç½šä½¿æƒé‡è¶‹å‘äºŽ0ï¼Œä»Žè€ŒæŽ§åˆ¶ç¥žç»ç½‘ç»œçš„å¤æ‚åº¦ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨å²­å›žå½’å’Œçº¿æ€§åˆ†ç±»å™¨ä¸­æ‰€åšçš„é‚£æ ·ã€‚MLPClassifierä¸­è°ƒèŠ‚L2æƒ©ç½šçš„å‚æ•°æ˜¯alphaï¼ˆä¸Žçº¿æ€§å›žå½’æ¨¡åž‹ä¸­çš„ç›¸åŒï¼‰ï¼Œå®ƒçš„é»˜è®¤å€¼å¾ˆå°ï¼ˆå¼±æ­£åˆ™åŒ–ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">8</span>))</span><br><span class="line"><span class="keyword">for</span> axx, n_hidden_nodes <span class="keyword">in</span> zip(axes, [<span class="number">10</span>, <span class="number">100</span>]):</span><br><span class="line">    <span class="keyword">for</span> ax, alpha <span class="keyword">in</span> zip(axx, [<span class="number">0.0001</span>, <span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">1</span>]):</span><br><span class="line">        mlp = MLPClassifier(solver=<span class="string">'lbfgs'</span>, random_state=<span class="number">0</span>, alpha=alpha,</span><br><span class="line">            hidden_layer_sizes=[n_hidden_nodes, n_hidden_nodes])</span><br><span class="line">        mlp.fit(X_train, y_train)</span><br><span class="line">        mglearn.plots.plot_2d_separator(mlp, X_train, fill=<span class="literal">True</span>, alpha=<span class="number">.3</span>, ax=ax)</span><br><span class="line">        mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train, ax=ax)</span><br><span class="line">        ax.set_title(<span class="string">'n_hidden=[&#123;&#125;, &#123;&#125;]\nalpha=&#123;:.4f&#125;'</span>.format(</span><br><span class="line">            n_hidden_nodes, n_hidden_nodes, alpha))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-mlp-for-different-parameters.png"></p><p>çŽ°åœ¨ä½ å¯èƒ½å·²ç»è®¤è¯†åˆ°äº†ï¼ŒæŽ§åˆ¶ç¥žç»ç½‘ç»œå¤æ‚åº¦çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼šéšå±‚çš„ä¸ªæ•°ã€æ¯ä¸ªéšå±‚ä¸­çš„å•å…ƒä¸ªæ•°å’Œæ­£åˆ™åŒ–ï¼ˆalphaï¼‰ã€‚å®žé™…ä¸Šè¿˜æœ‰æ›´å¤šï¼Œä½†è¿™é‡Œä¸å†è¿‡å¤šä»‹ç»ã€‚</p><p><strong>ç¥žç»ç½‘ç»œçš„ä¸€ä¸ªé‡è¦æ€§è´¨æ˜¯ï¼Œåœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰å…¶æƒé‡æ˜¯éšæœºè®¾ç½®çš„ï¼Œè¿™ç§éšæœºåˆå§‹åŒ–ä¼šå½±å“å­¦åˆ°çš„æ¨¡åž‹ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½¿ç”¨å®Œå…¨ç›¸åŒçš„å‚æ•°ï¼Œå¦‚æžœéšæœºç§å­ä¸åŒçš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½å¾—åˆ°éžå¸¸ä¸ä¸€æ ·çš„æ¨¡åž‹ã€‚<strong>å¦‚æžœç½‘ç»œå¾ˆå¤§ï¼Œå¹¶ä¸”å¤æ‚åº¦é€‰æ‹©åˆç†çš„è¯ï¼Œé‚£ä¹ˆè¿™åº”è¯¥ä¸ä¼šå¯¹ç²¾åº¦æœ‰å¤ªå¤§å½±å“ï¼Œä½†åº”è¯¥è®°ä½è¿™ä¸€ç‚¹ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºŽè¾ƒå°çš„ç½‘ç»œï¼‰</strong>ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å‡ ä¸ªæ¨¡åž‹çš„å›¾åƒï¼Œæ‰€æœ‰æ¨¡åž‹éƒ½ä½¿ç”¨ç›¸åŒçš„å‚æ•°è®¾ç½®ï¼ˆéšæœºç§å­ä¸åŒï¼‰è¿›è¡Œå­¦ä¹ ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">4</span>, figsize=(<span class="number">20</span>, <span class="number">8</span>))</span><br><span class="line"><span class="keyword">for</span> i, ax <span class="keyword">in</span> enumerate(axes.ravel()):</span><br><span class="line">    mlp = MLPClassifier(solver=<span class="string">'lbfgs'</span>, random_state=i,</span><br><span class="line">        hidden_layer_sizes=[<span class="number">100</span>, <span class="number">100</span>])</span><br><span class="line">    mlp.fit(X_train, y_train)</span><br><span class="line">    mglearn.plots.plot_2d_separator(mlp, X_train, fill=<span class="literal">True</span>, alpha=<span class="number">.3</span>, ax=ax)</span><br><span class="line">    mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train, ax=ax)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-mlp-for-different-random-states.png"></p><h1 id="å°†ç¥žç»ç½‘ç»œåº”ç”¨äºŽçŽ°å®žæ•°æ®">å°†ç¥žç»ç½‘ç»œåº”ç”¨äºŽçŽ°å®žæ•°æ®</h1><p>ä¸ºäº†åœ¨çŽ°å®žä¸–ç•Œçš„æ•°æ®ä¸Šè¿›ä¸€æ­¥ç†è§£ç¥žç»ç½‘ç»œï¼Œæˆ‘ä»¬å°†MLPClassifieråº”ç”¨åœ¨ä¹³è…ºç™Œæ•°æ®é›†ä¸Šï¼Œé¦–å…ˆä½¿ç”¨é»˜è®¤å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Cancer data per-feature maxima:\n&#123;&#125;'</span>.format(cancer.data.max(axis=<span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">mlp = MLPClassifier(random_state=<span class="number">42</span>)</span><br><span class="line">mlp.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.2f&#125;'</span>.format(mlp.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.2f&#125;'</span>.format(mlp.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cancer data per-feature maxima:</span><br><span class="line">[2.811e+01 3.928e+01 1.885e+02 2.501e+03 1.634e-01 3.454e-01 4.268e-01</span><br><span class="line"> 2.012e-01 3.040e-01 9.744e-02 2.873e+00 4.885e+00 2.198e+01 5.422e+02</span><br><span class="line"> 3.113e-02 1.354e-01 3.960e-01 5.279e-02 7.895e-02 2.984e-02 3.604e+01</span><br><span class="line"> 4.954e+01 2.512e+02 4.254e+03 2.226e-01 1.058e+00 1.252e+00 2.910e-01</span><br><span class="line"> 6.638e-01 2.075e-01]</span><br><span class="line">Accuracy on training set: 0.94</span><br><span class="line">Accuracy on test set: 0.92</span><br></pre></td></tr></table></figure><p>MLPçš„ç²¾åº¦ç›¸å½“å¥½ï¼Œä½†æ²¡æœ‰å…¶ä»–æ¨¡åž‹å¥½ã€‚ä¸Žè¾ƒæ—©çš„SVCä¾‹å­ç›¸åŒï¼ŒåŽŸå› å¯èƒ½åœ¨äºŽæ•°æ®çš„ç¼©æ”¾ã€‚<strong>ç¥žç»ç½‘ç»œä¹Ÿè¦æ±‚æ‰€æœ‰è¾“å…¥ç‰¹å¾çš„å˜åŒ–èŒƒå›´ç›¸ä¼¼ï¼Œæœ€ç†æƒ³çš„æƒ…å†µå‡å€¼ä¸º0ã€æ–¹å·®ä¸º1ã€‚</strong>æˆ‘ä»¬å¿…é¡»å¯¹æ•°æ®è¿›è¡Œç¼©æ”¾ä»¥æ»¡è¶³è¿™äº›è¦æ±‚ã€‚è¿™é‡Œå°†äººå·¥å®Œæˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—è®­ç»ƒé›†ä¸­æ¯ä¸ªç‰¹å¾çš„å¹³å‡å€¼</span></span><br><span class="line">mean_on_train = X_train.mean(axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># è®¡ç®—è®­ç»ƒé›†ä¸­æ¯ä¸ªç‰¹å¾çš„æ ‡å‡†å·®</span></span><br><span class="line">std_on_train = X_train.std(axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡åŽ»å¹³å‡å€¼ï¼Œç„¶åŽä¹˜ä»¥æ ‡å‡†å·®çš„å€’æ•°</span></span><br><span class="line"><span class="comment"># å¦‚æ­¤è¿ç®—ä¹‹åŽï¼Œmean=0ï¼Œstd=1</span></span><br><span class="line">X_train_scaled = (X_train - mean_on_train) / std_on_train</span><br><span class="line"><span class="comment"># å¯¹æµ‹è¯•é›†åšç›¸åŒçš„å˜æ¢</span></span><br><span class="line">X_test_scaled = (X_test - mean_on_train) / std_on_train</span><br><span class="line"></span><br><span class="line">mlp = MLPClassifier(random_state=<span class="number">42</span>)</span><br><span class="line">mlp.fit(X_train_scaled, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.2f&#125;'</span>.format(mlp.score(X_train_scaled, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.2f&#125;'</span>.format(mlp.score(X_test_scaled, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ConvergenceWarning: Stochastic Optimizer: Maximum iterations (200) reached and the optimization hasn&apos;t converged yet.</span><br><span class="line">  % self.max_iter, ConvergenceWarning)</span><br><span class="line">Accuracy on training set: 0.99</span><br><span class="line">Accuracy on test set: 0.97</span><br></pre></td></tr></table></figure><p>ç¼©æ”¾åŽçš„ç»“æžœè¦å¥½å¾—å¤šï¼Œè€Œä¸”ä¹Ÿç›¸å½“æœ‰ç«žäº‰åŠ›ã€‚ä¸è¿‡æ¨¡åž‹ç»™å‡ºäº†ä¸€ä¸ªè­¦å‘Šï¼Œå‘Šè¯‰æˆ‘ä»¬å·²ç»è¾¾åˆ°äº†æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œä½†è¿˜æ²¡æœ‰æ”¶æŸã€‚è¿™æ˜¯ç”¨äºŽå­¦ä¹ æ¨¡åž‹çš„adamç®—æ³•çš„ä¸€éƒ¨åˆ†ï¼Œå‘Šè¯‰æˆ‘ä»¬åº”è¯¥å¢žåŠ è¿­ä»£æ¬¡æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mlp = MLPClassifier(max_iter=<span class="number">1000</span>, random_state=<span class="number">42</span>)</span><br><span class="line">mlp.fit(X_train_scaled, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.2f&#125;'</span>.format(mlp.score(X_train_scaled, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.2f&#125;'</span>.format(mlp.score(X_test_scaled, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 1.00</span><br><span class="line">Accuracy on test set: 0.97</span><br></pre></td></tr></table></figure><p>å¢žåŠ è¿­ä»£æ¬¡æ•°ä»…æé«˜äº†è®­ç»ƒé›†æ€§èƒ½ï¼Œä½†æ²¡æœ‰æé«˜æ³›åŒ–æ€§èƒ½ã€‚ä¸è¿‡æ¨¡åž‹çš„è¡¨çŽ°ç›¸å½“ä¸é”™ã€‚ç”±äºŽè®­ç»ƒæ€§èƒ½å’Œæµ‹è¯•æ€§èƒ½ä¹‹é—´ä»æœ‰ä¸€äº›å·®è·ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•é™ä½Žæ¨¡åž‹å¤æ‚åº¦æ¥å¾—åˆ°æ›´å¥½çš„æ³›åŒ–æ€§èƒ½ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¢žå¤§alphaå‚æ•°ï¼ˆä»Žé»˜è®¤çš„0.0001å¢žå¤§åˆ°1ï¼‰ï¼Œä»¥æ­¤å‘æƒé‡æ·»åŠ æ›´å¼ºçš„æ­£åˆ™åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mlp = MLPClassifier(max_iter=<span class="number">1000</span>, alpha=<span class="number">1</span>, random_state=<span class="number">42</span>)</span><br><span class="line">mlp.fit(X_train_scaled, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.2f&#125;'</span>.format(mlp.score(X_train_scaled, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.2f&#125;'</span>.format(mlp.score(X_test_scaled, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 0.99</span><br><span class="line">Accuracy on test set: 0.98</span><br></pre></td></tr></table></figure><p>è™½ç„¶å¯ä»¥åˆ†æžç¥žç»ç½‘ç»œå­¦åˆ°äº†ä»€ä¹ˆï¼Œä½†è¿™é€šå¸¸æ¯”åˆ†æžçº¿æ€§æ¨¡åž‹æˆ–åŸºäºŽæ ‘çš„æ¨¡åž‹æ›´ä¸ºå¤æ‚ã€‚è¦æƒ³è§‚å¯Ÿæ¨¡åž‹å­¦åˆ°äº†ä»€ä¹ˆï¼Œä¸€ç§æ–¹æ³•æ˜¯æŸ¥çœ‹æ¨¡åž‹çš„æƒé‡ã€‚ä½ å¯ä»¥åœ¨<code>scikit-learn</code>ç¤ºä¾‹åº“ä¸­æŸ¥çœ‹è¿™æ ·çš„ä¸€ä¸ª<a href="https://scikit-learn.org/stable/auto_examples/neural_networks/plot_mnist_filters.html" target="_blank" rel="noopener">ç¤ºä¾‹</a>ã€‚å¯¹äºŽä¹³è…ºç™Œæ•°æ®é›†ï¼Œè¿™å¯èƒ½æœ‰ç‚¹éš¾ä»¥ç†è§£ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¾ç¤ºäº†è¿žæŽ¥è¾“å…¥å’Œç¬¬ä¸€ä¸ªéšå±‚ä¹‹é—´çš„æƒé‡ã€‚å›¾ä¸­çš„è¡Œå¯¹åº”30ä¸ªè¾“å…¥ç‰¹å¾ï¼Œåˆ—å¯¹åº”100ä¸ªéšå•å…ƒã€‚æµ…è‰²ä»£è¡¨è¾ƒå¤§çš„æ­£å€¼ï¼Œè€Œæ·±è‰²ä»£è¡¨è´Ÿå€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">20</span>, <span class="number">5</span>))</span><br><span class="line">plt.imshow(mlp.coefs_[<span class="number">0</span>], interpolation=<span class="string">'none'</span>, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">plt.yticks(range(<span class="number">30</span>), cancer.feature_names)</span><br><span class="line">plt.xlabel(<span class="string">'Columns in weight matrix'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Input feature'</span>)</span><br><span class="line">plt.colorbar()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/weights-of-first-hidden-layer-in-mlp.png"></p><p>æˆ‘ä»¬å¯ä»¥æŽ¨æ–­ï¼Œå¦‚æžœæŸä¸ªç‰¹å¾å¯¹æ‰€æœ‰éšå•å…ƒçš„æƒé‡éƒ½å¾ˆå°ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹å¾å¯¹æ¨¡åž‹æ¥è¯´å°±â€œä¸å¤ªé‡è¦â€ã€‚ä¸Žå…¶ä»–ç‰¹å¾ç›¸æ¯”ï¼Œâ€œmean smoothnessâ€ â€œmean compactnessâ€ä»¥åŠâ€œsmoothness errorâ€å’Œâ€œfractal dimension errorâ€ä¹‹é—´çš„ç‰¹å¾çš„æƒé‡éƒ½ç›¸å¯¹è¾ƒå°ã€‚è¿™å¯èƒ½è¯´æ˜Žè¿™äº›ç‰¹å¾ä¸å¤ªé‡è¦ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘ä»¬æ²¡æœ‰ç”¨ç¥žç»ç½‘ç»œå¯ä»¥ä½¿ç”¨çš„æ–¹å¼æ¥è¡¨ç¤ºè¿™äº›ç‰¹å¾ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥å°†è¿žæŽ¥éšå±‚å’Œè¾“å‡ºå±‚çš„æƒé‡å¯è§†åŒ–ï¼Œä½†å®ƒä»¬æ›´åŠ éš¾ä»¥ç†è§£ã€‚</p><p>è™½ç„¶MLPClassifierå’ŒMLPRegressorä¸ºæœ€å¸¸è§çš„ç¥žç»ç½‘ç»œç»“æž„æä¾›äº†æ˜“äºŽä½¿ç”¨çš„æŽ¥å£ï¼Œä½†å®ƒä»¬åªåŒ…å«ç¥žç»ç½‘ç»œæ½œåœ¨åº”ç”¨çš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºŽPythonç”¨æˆ·æ¥è¯´ï¼Œæœ€ä¸ºå®Œå–„çš„æ˜¯<code>keras</code>ã€<code>lasagna</code>å’Œ<code>tensor-flow</code>ã€‚<code>lasagna</code>æ˜¯åŸºäºŽ<code>theano</code>åº“æž„å»ºçš„ï¼Œè€Œ<code>keras</code>æ—¢å¯ä»¥ç”¨<code>tensor-flow</code>ä¹Ÿå¯ä»¥ç”¨<code>theano</code>ã€‚è¿™äº›åº“æä¾›äº†æ›´ä¸ºçµæ´»çš„æŽ¥å£ï¼Œå¯ä»¥ç”¨æ¥æž„å»ºç¥žç»ç½‘ç»œå¹¶è·Ÿè¸ªæ·±åº¦å­¦ä¹ ç ”ç©¶çš„å¿«é€Ÿå‘å±•ã€‚æ‰€æœ‰æµè¡Œçš„æ·±åº¦å­¦ä¹ åº“ä¹Ÿéƒ½å…è®¸ä½¿ç”¨é«˜æ€§èƒ½çš„å›¾å½¢å¤„ç†å•å…ƒï¼ˆGPUï¼‰ï¼Œè€Œ<code>scikit-learn</code>ä¸æ”¯æŒGPUã€‚ä½¿ç”¨GPUå¯ä»¥å°†è®¡ç®—é€Ÿåº¦åŠ å¿«10åˆ°100å€ï¼ŒGPUå¯¹äºŽå°†æ·±åº¦å­¦ä¹ æ–¹æ³•åº”ç”¨åˆ°å¤§åž‹æ•°æ®é›†ä¸Šè‡³å…³é‡è¦ã€‚</p><h1 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h1><p>åœ¨æœºå™¨å­¦ä¹ çš„è®¸å¤šåº”ç”¨ä¸­ï¼Œç¥žç»ç½‘ç»œå†æ¬¡æˆä¸ºæœ€å…ˆè¿›çš„æ¨¡åž‹ã€‚å®ƒçš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯èƒ½å¤ŸèŽ·å–å¤§é‡æ•°æ®ä¸­åŒ…å«çš„ä¿¡æ¯ï¼Œå¹¶æž„å»ºæ— æ¯”å¤æ‚çš„æ¨¡åž‹ã€‚ç»™å®šè¶³å¤Ÿçš„è®¡ç®—æ—¶é—´å’Œæ•°æ®ï¼Œå¹¶ä¸”ä»”ç»†è°ƒèŠ‚å‚æ•°ï¼Œç¥žç»ç½‘ç»œé€šå¸¸å¯ä»¥æ‰“è´¥å…¶ä»–æœºå™¨å­¦ä¹ ç®—æ³•ï¼ˆæ— è®ºæ˜¯åˆ†ç±»ä»»åŠ¡è¿˜æ˜¯å›žå½’ä»»åŠ¡ï¼‰ã€‚</p><p>ç¥žç»ç½‘ç»œâ€”â€”ç‰¹åˆ«æ˜¯åŠŸèƒ½å¼ºå¤§çš„å¤§åž‹ç¥žç»ç½‘ç»œâ€”â€”é€šå¸¸éœ€è¦å¾ˆé•¿çš„è®­ç»ƒæ—¶é—´ã€‚å®ƒè¿˜éœ€è¦ä»”ç»†åœ°é¢„å¤„ç†æ•°æ®ã€‚ä¸ŽSVMç±»ä¼¼ï¼Œç¥žç»ç½‘ç»œåœ¨â€œå‡åŒ€â€æ•°æ®ä¸Šçš„æ€§èƒ½æœ€å¥½ï¼Œå…¶ä¸­â€œå‡åŒ€â€æ˜¯æŒ‡æ‰€æœ‰ç‰¹å¾éƒ½å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚å¦‚æžœæ•°æ®åŒ…å«ä¸åŒç§ç±»çš„ç‰¹å¾ï¼Œé‚£ä¹ˆåŸºäºŽæ ‘çš„æ¨¡åž‹å¯èƒ½è¡¨çŽ°å¾—æ›´å¥½ã€‚ç¥žç»ç½‘ç»œè°ƒå‚æœ¬èº«ä¹Ÿæ˜¯ä¸€é—¨è‰ºæœ¯ã€‚è°ƒèŠ‚ç¥žç»ç½‘ç»œæ¨¡åž‹å’Œè®­ç»ƒæ¨¡åž‹çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬åªæ˜¯èœ»èœ“ç‚¹æ°´åœ°å°è¯•äº†å‡ ç§è€Œå·²ã€‚</p><h1 id="ä¼°è®¡ç¥žç»ç½‘ç»œçš„å¤æ‚åº¦">ä¼°è®¡ç¥žç»ç½‘ç»œçš„å¤æ‚åº¦</h1><p>æœ€é‡è¦çš„å‚æ•°æ˜¯å±‚æ•°å’Œæ¯å±‚çš„éšå•å…ƒä¸ªæ•°ã€‚ä½ åº”è¯¥é¦–å…ˆè®¾ç½®1ä¸ªæˆ–2ä¸ªéšå±‚ï¼Œç„¶åŽå¯ä»¥é€æ­¥å¢žåŠ ã€‚æ¯ä¸ªéšå±‚çš„ç»“ç‚¹ä¸ªæ•°é€šå¸¸ä¸Žè¾“å…¥ç‰¹å¾ä¸ªæ•°ç›¸è¿‘ï¼Œä½†åœ¨å‡ åƒä¸ªç»“ç‚¹æ—¶å¾ˆå°‘ä¼šå¤šäºŽç‰¹å¾ä¸ªæ•°ã€‚</p><p>åœ¨è€ƒè™‘ç¥žç»ç½‘ç»œçš„æ¨¡åž‹å¤æ‚åº¦æ—¶ï¼Œä¸€ä¸ªæœ‰ç”¨çš„åº¦é‡æ˜¯å­¦åˆ°çš„æƒé‡ï¼ˆæˆ–ç³»æ•°ï¼‰çš„ä¸ªæ•°ã€‚å¦‚æžœä½ æœ‰ä¸€ä¸ªåŒ…å«100ä¸ªç‰¹å¾çš„äºŒåˆ†ç±»æ•°æ®é›†ï¼Œæ¨¡åž‹æœ‰100ä¸ªéšå•å…ƒï¼Œé‚£ä¹ˆè¾“å…¥å±‚å’Œç¬¬ä¸€ä¸ªéšå±‚ä¹‹é—´å°±æœ‰<code>100*100=10000</code>ä¸ªæƒé‡ã€‚åœ¨éšå±‚å’Œè¾“å‡ºå±‚ä¹‹é—´è¿˜æœ‰<code>100*1=100</code>ä¸ªæƒé‡ï¼Œæ€»å…±çº¦10100ä¸ªæƒé‡ã€‚</p><p><strong>ç¥žç»ç½‘ç»œè°ƒå‚çš„å¸¸ç”¨æ–¹æ³•æ˜¯ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå¤§åˆ°è¶³ä»¥è¿‡æ‹Ÿåˆçš„ç½‘ç»œï¼Œç¡®ä¿è¿™ä¸ªç½‘ç»œå¯ä»¥å¯¹ä»»åŠ¡è¿›è¡Œå­¦ä¹ ã€‚çŸ¥é“è®­ç»ƒæ•°æ®å¯ä»¥è¢«å­¦ä¹ ä¹‹åŽï¼Œè¦ä¹ˆç¼©å°ç½‘ç»œï¼Œè¦ä¹ˆå¢žå¤§alphaæ¥å¢žå¼ºæ­£åˆ™åŒ–ï¼Œè¿™å¯ä»¥æé«˜æ³›åŒ–æ€§èƒ½ã€‚</strong></p><p>åœ¨æˆ‘ä»¬çš„å®žéªŒä¸­ï¼Œä¸»è¦å…³æ³¨æ¨¡åž‹çš„å®šä¹‰ï¼šå±‚æ•°ã€æ¯å±‚çš„ç»“ç‚¹ä¸ªæ•°ã€æ­£åˆ™åŒ–å’Œéžçº¿æ€§ã€‚è¿™äº›å†…å®¹å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦å­¦ä¹ çš„æ¨¡åž‹ã€‚è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œ<strong>å¦‚ä½•</strong>å­¦ä¹ æ¨¡åž‹æˆ–ç”¨æ¥å­¦ä¹ å‚æ•°çš„ç®—æ³•ï¼Œè¿™ä¸€ç‚¹ç”±solverå‚æ•°è®¾å®šã€‚solverå‚æ•°æœ‰ä¸¤ä¸ªå¥½ç”¨çš„é€‰é¡¹ã€‚é»˜è®¤é€‰é¡¹æ˜¯'adam'ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ•ˆæžœéƒ½å¾ˆå¥½ï¼Œä½†å¯¹æ•°æ®çš„ç¼©æ”¾ç›¸å½“æ•æ„Ÿï¼ˆå› æ­¤ï¼Œå§‹ç»ˆå°†æ•°æ®ç¼©æ”¾ä¸ºå‡å€¼ä¸º0ã€æ–¹å·®ä¸º1æ˜¯å¾ˆé‡è¦çš„ï¼‰ã€‚å¦ä¸€ä¸ªé€‰é¡¹æ˜¯'lbfgs'ï¼Œå…¶é²æ£’æ€§ç›¸å½“å¥½ï¼Œä½†åœ¨å¤§åž‹æ¨¡åž‹æˆ–å¤§åž‹æ•°æ®é›†ä¸Šçš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚è¿˜æœ‰æ›´é«˜çº§çš„'sgd'é€‰é¡¹ï¼Œè®¸å¤šæ·±åº¦å­¦ä¹ ç ”ç©¶äººå‘˜éƒ½ä¼šç”¨åˆ°ã€‚'sgd'é€‰é¡¹è¿˜æœ‰è®¸å¤šå…¶ä»–å‚æ•°éœ€è¦è°ƒèŠ‚ï¼Œä»¥ä¾¿èŽ·å¾—æœ€ä½³ç»“æžœã€‚å½“ä½ å¼€å§‹ä½¿ç”¨MLPæ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨'adam'å’Œ'lbfgs'ã€‚</p><p><em>fitä¼šé‡ç½®æ¨¡åž‹ã€‚<code>scikit-learn</code>æ¨¡åž‹çš„ä¸€ä¸ªé‡è¦æ€§è´¨å°±æ˜¯ï¼Œè°ƒç”¨fitæ€»ä¼šé‡ç½®æ¨¡åž‹ä¹‹å‰å­¦åˆ°çš„æ‰€æœ‰å†…å®¹ã€‚ä½ å¯ä»¥å¯¹ä¸€ä¸ªæ¨¡åž‹å¤šæ¬¡è°ƒç”¨fitï¼Œå…¶ç»“æžœä¸Žåœ¨â€œæ–°â€œæ¨¡åž‹ä¸Šè°ƒç”¨fitæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚</em></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> classification </tag>
            
            <tag> neural network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¸æ”¯æŒå‘é‡æœº</title>
      <link href="/notes/introduction-to-ml-with-python/kernelized-support-vector-machine/"/>
      <url>/notes/introduction-to-ml-with-python/kernelized-support-vector-machine/</url>
      
        <content type="html"><![CDATA[<p>æ ¸æ”¯æŒå‘é‡æœºï¼ˆé€šå¸¸ç®€ç§°ä¸ºSVMï¼‰æ˜¯å¯ä»¥æŽ¨å¹¿åˆ°æ›´å¤æ‚æ¨¡åž‹çš„æ‰©å±•ï¼Œè¿™äº›æ¨¡åž‹æ— æ³•è¢«è¾“å…¥ç©ºé—´çš„è¶…å¹³é¢å®šä¹‰ã€‚è™½ç„¶æ”¯æŒå‘é‡æœºå¯ä»¥åŒæ—¶ç”¨äºŽåˆ†ç±»å’Œå›žå½’ï¼Œä½†æˆ‘ä»¬åªä¼šä»‹ç»ç”¨äºŽåˆ†ç±»çš„æƒ…å†µï¼Œå®ƒåœ¨SVCä¸­å®žçŽ°ã€‚ç±»ä¼¼çš„æ¦‚å¿µä¹Ÿé€‚ç”¨äºŽæ”¯æŒå‘é‡å›žå½’ï¼Œåœ¨SVRä¸­å®žçŽ°ã€‚</p><h1 id="çº¿æ€§æ¨¡åž‹ä¸Žéžçº¿æ€§ç‰¹å¾">çº¿æ€§æ¨¡åž‹ä¸Žéžçº¿æ€§ç‰¹å¾</h1><p>çº¿æ€§æ¨¡åž‹åœ¨ä½Žç»´ç©ºé—´ä¸­å¯èƒ½éžå¸¸å—é™ï¼Œå› ä¸ºçº¿å’Œå¹³é¢çš„çµæ´»æ€§æœ‰é™ã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è®©çº¿æ€§æ¨¡åž‹æ›´åŠ çµæ´»ï¼Œå°±æ˜¯æ·»åŠ æ›´å¤šçš„ç‰¹å¾â€”â€”ä¸¾ä¸ªä¾‹å­ï¼Œæ·»åŠ è¾“å…¥ç‰¹å¾çš„äº¤äº’é¡¹æˆ–å¤šé¡¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = make_blobs(centers=<span class="number">4</span>, random_state=<span class="number">8</span>)</span><br><span class="line">y %= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> LinearSVC</span><br><span class="line">linear_svm = LinearSVC().fit(X, y)</span><br><span class="line"></span><br><span class="line">mglearn.plots.plot_2d_separator(linear_svm, X)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-svc-on-make-blobs.png"></p><a id="more"></a><p>ç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹åªèƒ½ç”¨ä¸€æ¡ç›´çº¿æ¥åˆ’åˆ†æ•°æ®ç‚¹ï¼Œå¯¹è¿™ä¸ªæ•°æ®é›†æ— æ³•ç»™å‡ºè¾ƒå¥½çš„ç»“æžœã€‚</p><p>çŽ°åœ¨æˆ‘ä»¬å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œæ‰©å±•ï¼Œæ¯”å¦‚è¯´æ·»åŠ ç¬¬äºŒä¸ªç‰¹å¾çš„å¹³æ–¹ï¼ˆ<code>feature1 ** 2</code>ï¼‰ä½œä¸ºä¸€ä¸ªæ–°ç‰¹å¾ã€‚çŽ°åœ¨æˆ‘ä»¬å°†æ¯ä¸ªæ•°æ®ç‚¹è¡¨ç¤ºä¸ºä¸‰ç»´ç‚¹<code>(feature0, feature1, feature1 ** 2)</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ç¬¬äºŒä¸ªç‰¹å¾çš„å¹³æ–¹ï¼Œä½œä¸ºä¸€ä¸ªæ–°ç‰¹å¾</span></span><br><span class="line">X_new = np.hstack([X, X[:, <span class="number">1</span>:] ** <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D, axes3d</span><br><span class="line">figure = plt.figure()</span><br><span class="line"><span class="comment"># 3Då¯è§†åŒ–</span></span><br><span class="line">ax = Axes3D(figure, elev=<span class="number">-152</span>, azim=<span class="number">-26</span>)</span><br><span class="line"><span class="comment"># é¦–å…ˆç”»å‡ºæ‰€æœ‰y == 0çš„ç‚¹ï¼Œç„¶åŽç”»å‡ºæ‰€æœ‰y == 1çš„ç‚¹</span></span><br><span class="line">mask = y == <span class="number">0</span></span><br><span class="line">ax.scatter(X_new[mask, <span class="number">0</span>], X_new[mask, <span class="number">1</span>], X_new[mask, <span class="number">2</span>], c=<span class="string">'b'</span>,</span><br><span class="line">           cmap=mglearn.cm2, s=<span class="number">60</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">ax.scatter(X_new[~mask, <span class="number">0</span>], X_new[~mask, <span class="number">1</span>], X_new[~mask, <span class="number">2</span>], c=<span class="string">'r'</span>, marker=<span class="string">'^'</span>,</span><br><span class="line">           cmap=mglearn.cm2, s=<span class="number">60</span>, edgecolor=<span class="string">'k'</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">"feature0"</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">"feature1"</span>)</span><br><span class="line">ax.set_zlabel(<span class="string">"feature1 ** 2"</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-blobs-3d.png"></p><p>åœ¨æ•°æ®çš„æ–°è¡¨ç¤ºä¸­ï¼ŒçŽ°åœ¨å¯ä»¥ç”¨çº¿æ€§æ¨¡åž‹ï¼ˆä¸‰ç»´ç©ºé—´ä¸­çš„å¹³é¢ï¼‰å°†è¿™ä¸¤ä¸ªç±»åˆ«åˆ†å¼€ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">linear_svm_3d = LinearSVC().fit(X_new, y)</span><br><span class="line"><span class="comment"># ravelæ–¹æ³•å°†æ•°ç»„å±•å¼€</span></span><br><span class="line">coef, intercept = linear_svm_3d.coef_.ravel(), linear_svm_3d.intercept_</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºçº¿æ€§å†³ç­–è¾¹ç•Œ</span></span><br><span class="line">figure = plt.figure()</span><br><span class="line">ax = Axes3D(figure, elev=<span class="number">-152</span>, azim=<span class="number">-26</span>)</span><br><span class="line">xx = np.linspace(X_new[:, <span class="number">0</span>].min() - <span class="number">2</span>, X_new[:, <span class="number">0</span>].max() + <span class="number">2</span>, <span class="number">50</span>)</span><br><span class="line">yy = np.linspace(X_new[:, <span class="number">1</span>].min() - <span class="number">2</span>, X_new[:, <span class="number">1</span>].max() + <span class="number">2</span>, <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">XX, YY = np.meshgrid(xx, yy)</span><br><span class="line"><span class="comment"># model: y = x[0] * coef[0] + x[1] * coef[1] + x[2] * coef[3] + intercept</span></span><br><span class="line"><span class="comment"># boundary: 0 = x[0] * coef[0] + x[1] * coef[1] + x[2] * coef[3] + intercept</span></span><br><span class="line"><span class="comment"># è¾¹ç•Œä¸Šçš„x[2] = (x[0] * coef[0] + x[1] * coef[1] + intercept) / -coef[2]</span></span><br><span class="line">ZZ = (coef[<span class="number">0</span>] * XX + coef[<span class="number">1</span>] * YY + intercept) / -coef[<span class="number">2</span>]</span><br><span class="line">ax.plot_surface(XX, YY, ZZ, rstride=<span class="number">8</span>, cstride=<span class="number">8</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">ax.scatter(X_new[mask, <span class="number">0</span>], X_new[mask, <span class="number">1</span>], X_new[mask, <span class="number">2</span>], c=<span class="string">'b'</span>,</span><br><span class="line">    cmap=mglearn.cm2, s=<span class="number">60</span>)</span><br><span class="line">ax.scatter(X_new[~mask, <span class="number">0</span>], X_new[~mask, <span class="number">1</span>], X_new[~mask, <span class="number">2</span>], c=<span class="string">'r'</span>,</span><br><span class="line">    cmap=mglearn.cm2, s=<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">ax.set_xlabel(<span class="string">'feature0'</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">'feature1'</span>)</span><br><span class="line">ax.set_zlabel(<span class="string">'feature1 ** 2'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-linear-svc-on-blobs-3d.png"></p><p>å¦‚æžœå°†çº¿æ€§SVMæ¨¡åž‹çœ‹ä½œåŽŸå§‹ç‰¹å¾çš„å‡½æ•°ï¼Œå³<code>y = coef[0] * x[0] + coef[1] * x[1] + coef[2] * x[1] ** 2</code>ï¼Œé‚£ä¹ˆå®ƒå®žé™…ä¸Šå·²ç»ä¸æ˜¯çº¿æ€§çš„äº†ã€‚å®ƒä¸æ˜¯ä¸€æ¡ç›´çº¿ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¤­åœ†ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.svm.linearsvc#sklearsn.svm.LinearSVC.decision_function" target="_blank" rel="noopener"><code>decision_function(X)</code></a></p><p>Predict confidence scores for samples. The confidence score for a sample is the signed distance of that sample to the hyperplane.</p></blockquote><blockquote><p><a href="https://devdocs.io/numpy~1.17/generated/numpy.c_" target="_blank" rel="noopener"><code>numpy.c_ = &lt;numpy.lib.index_tricks.CClass object&gt;</code></a></p><p>Translates slice objects to concatenation along the second axis.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.c_[np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]), np.array([<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])]</span><br><span class="line">array([[<span class="number">1</span>, <span class="number">4</span>],</span><br><span class="line">       [<span class="number">2</span>, <span class="number">5</span>],</span><br><span class="line">       [<span class="number">3</span>, <span class="number">6</span>]])</span><br></pre></td></tr></table></figure></blockquote><blockquote></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ZZ = YY ** <span class="number">2</span>  <span class="comment"># ç¬¬ä¸‰ç‰¹å¾</span></span><br><span class="line"><span class="comment"># é¢„æµ‹(XX, YY, ZZ)</span></span><br><span class="line">dec = linear_svm_3d.decision_function(np.c_[XX.ravel(), YY.ravel(), ZZ.ravel()])</span><br><span class="line"><span class="comment"># ç”»å‡ºé¢„æµ‹ç»“æžœä»¥è¾¹ç•Œ(0)çš„ä½ç½®</span></span><br><span class="line">plt.contour(XX, YY, dec.reshape(XX.shape), levels=[dec.min(), <span class="number">0</span>, dec.max()],</span><br><span class="line">    cmap=mglearn.cm2, alpha=<span class="number">0.5</span>)</span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-linear-svc-on-blobs-2d.png"></p><h1 id="æ ¸æŠ€å·§">æ ¸æŠ€å·§</h1><p>è¿™é‡Œéœ€è¦è®°ä½çš„æ˜¯ï¼Œå‘æ•°æ®è¡¨ç¤ºä¸­æ·»åŠ éžçº¿æ€§ç‰¹å¾ï¼Œå¯ä»¥è®©çº¿æ€§æ¨¡åž‹å˜å¾—æ›´åŠ å¼ºå¤§ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æ¥è¯´æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¦æ·»åŠ å“ªäº›ç‰¹å¾ï¼Œè€Œä¸”æ·»åŠ è®¸å¤šç‰¹å¾ï¼ˆæ¯”å¦‚100ç»´ç‰¹å¾ç©ºé—´æ‰€æœ‰å¯èƒ½çš„äº¤äº’é¡¹ï¼‰çš„è®¡ç®—å¼€é”€å¯èƒ½ä¼šå¾ˆå¤§ã€‚<strong>å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§å·§å¦™çš„æ•°å­¦æŠ€å·§ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨æ›´é«˜ç»´ç©ºé—´ä¸­å­¦ä¹ åˆ†ç±»å™¨ï¼Œè€Œä¸ç”¨å®žé™…è®¡ç®—å¯èƒ½éžå¸¸å¤§çš„æ–°æ•°æ®è¡¨ç¤ºã€‚è¿™ç§æŠ€å·§å«ä½œæ ¸æŠ€å·§ï¼ˆkernel trickï¼‰ï¼Œå®ƒçš„åŽŸç†æ˜¯ç›´æŽ¥è®¡ç®—æ‰©å±•ç‰¹å¾è¡¨ç¤ºä¸­æ•°æ®ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆæ›´å‡†ç¡®åœ°è¯´æ˜¯å†…ç§¯ï¼‰ï¼Œè€Œä¸ç”¨å®žé™…å¯¹æ‰©å±•è¿›è¡Œè®¡ç®—</strong>ã€‚</p><p>å¯¹äºŽæ”¯æŒå‘é‡æœºï¼Œå°†æ•°æ®æ˜ å°„åˆ°æ›´é«˜ç»´ç©ºé—´ä¸­æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•ï¼šä¸€ç§æ˜¯<strong>å¤šé¡¹å¼æ ¸</strong>ï¼Œåœ¨ä¸€å®šé˜¶æ•°å†…è®¡ç®—åŽŸå§‹ç‰¹å¾æ‰€æœ‰å¯èƒ½çš„å¤šé¡¹å¼ï¼ˆæ¯”å¦‚<code>feature1 ** 2 * feature2 ** 5</code>ï¼‰ï¼›å¦ä¸€ç§æ˜¯<strong>å¾„å‘åŸºå‡½æ•°ï¼ˆradial basis functionï¼ŒRBFï¼‰æ ¸</strong>ï¼Œä¹Ÿå«é«˜æ–¯æ ¸ã€‚é«˜æ–¯æ ¸æœ‰ç‚¹éš¾ä»¥è§£é‡Šï¼Œå› ä¸ºå®ƒå¯¹åº”æ— é™ç»´çš„ç‰¹å¾ç©ºé—´ã€‚ä¸€ç§å¯¹é«˜æ–¯æ ¸çš„è§£é‡Šæ˜¯å®ƒè€ƒè™‘æ‰€æœ‰é˜¶æ•°çš„æ‰€æœ‰å¯èƒ½çš„å¤šé¡¹å¼ï¼Œä½†é˜¶æ•°è¶Šé«˜ï¼Œç‰¹å¾çš„é‡è¦æ€§è¶Šå°ã€‚</p><p>ä¸è¿‡åœ¨å®žè·µä¸­ï¼Œæ ¸SVMèƒŒåŽçš„æ•°å­¦ç»†èŠ‚å¹¶ä¸æ˜¯å¾ˆé‡è¦ï¼Œå¯ä»¥ç®€å•åœ°æ€»ç»“å‡ºä½¿ç”¨RBFæ ¸SVMè¿›è¡Œé¢„æµ‹çš„æ–¹æ³•â€”â€”æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»è¿™æ–¹é¢çš„å†…å®¹ã€‚</p><h1 id="ç†è§£svm">ç†è§£SVM</h1><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒSVMå­¦ä¹ æ¯ä¸ªè®­ç»ƒæ•°æ®ç‚¹å¯¹äºŽè¡¨ç¤ºä¸¤ä¸ªç±»åˆ«ä¹‹é—´çš„å†³ç­–è¾¹ç•Œçš„é‡è¦æ€§ã€‚é€šå¸¸åªæœ‰ä¸€éƒ¨åˆ†è®­ç»ƒæ•°æ®ç‚¹å¯¹äºŽå®šä¹‰å†³ç­–è¾¹ç•Œå¾ˆé‡è¦ï¼šä½äºŽç±»åˆ«ä¹‹é—´è¾¹ç•Œä¸Šçš„é‚£äº›ç‚¹ã€‚è¿™äº›ç‚¹å«ä½œ<strong>æ”¯æŒå‘é‡</strong>ï¼ˆsupport vectorï¼‰ï¼Œæ”¯æŒå‘é‡æœºæ­£æ˜¯ç”±æ­¤å¾—åã€‚</p><p>æƒ³è¦å¯¹æ–°æ ·æœ¬ç‚¹è¿›è¡Œé¢„æµ‹ï¼Œéœ€è¦æµ‹é‡å®ƒä¸Žæ¯ä¸ªæ”¯æŒå‘é‡ä¹‹é—´çš„è·ç¦»ã€‚åˆ†ç±»å†³ç­–æ˜¯åŸºäºŽå®ƒä¸Žæ”¯æŒå‘é‡ä¹‹é—´çš„è·ç¦»ä»¥åŠåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å­¦åˆ°çš„æ”¯æŒå‘é‡é‡è¦æ€§ï¼ˆä¿å­˜åœ¨SVCçš„<code>dual_coef_</code>å±žæ€§ä¸­ï¼‰æ¥åšå‡ºçš„ã€‚</p><p>æ•°æ®ç‚¹ä¹‹é—´çš„è·ç¦»ç”±é«˜æ–¯æ ¸ç»™å‡ºï¼š</p><p><span class="math display">\[k_{rbf}(x_1,x_2)=exp(-\gamma\left\| x_1-x_2\right\|^2)\]</span></p><p>è¿™é‡Œ<span class="math inline">\(x_1\)</span>å’Œ<span class="math inline">\(x_2\)</span>æ˜¯æ•°æ®ç‚¹ï¼Œ<span class="math inline">\(\left\| x_1-x_2\right\|\)</span>è¡¨ç¤ºæ¬§å¼è·ç¦»ï¼Œ<span class="math inline">\(\gamma\)</span>ï¼ˆgammaï¼‰æ˜¯æŽ§åˆ¶é«˜æ–¯æ ¸å®½åº¦çš„å‚æ•°ã€‚</p><p>åœ¨forgeæ•°æ®é›†ä¸Šè®­ç»ƒSVMã€‚å†³ç­–è¾¹ç•Œç”¨é»‘è‰²è¡¨ç¤ºï¼Œæ”¯æŒå‘é‡æ˜¯å°ºå¯¸è¾ƒå¤§çš„ç‚¹ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.svm.svc" target="_blank" rel="noopener"><code>class sklearn.svm.SVC(C=1.0, kernel=â€™rbfâ€™, degree=3, gamma=â€™auto_deprecatedâ€™, coef0=0.0, shrinking=True, probability=False, tol=0.001, cache_size=200, class_weight=None, verbose=False, max_iter=-1, decision_function_shape=â€™ovrâ€™, random_state=None)</code></a></p><p>C-Support Vector Classification.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line">X, y = mglearn.tools.make_handcrafted_dataset()</span><br><span class="line">svm = SVC(kernel=<span class="string">'rbf'</span>, C=<span class="number">10</span>, gamma=<span class="number">0.1</span>).fit(X, y)</span><br><span class="line">mglearn.plots.plot_2d_separator(svm, X, eps=<span class="number">.5</span>)</span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line"><span class="comment"># ç”»å‡ºæ”¯æŒå‘é‡</span></span><br><span class="line">sv = svm.support_vectors_</span><br><span class="line"><span class="comment"># æ”¯æŒå‘é‡çš„ç±»åˆ«æ ‡ç­¾ç”±dual_coef_çš„æ­£è´Ÿå·ç»™å‡º</span></span><br><span class="line">sv_labels = svm.dual_coef_.ravel() &gt; <span class="number">0</span></span><br><span class="line">mglearn.discrete_scatter(sv[:, <span class="number">0</span>], sv[:, <span class="number">1</span>], sv_labels, s=<span class="number">15</span>, markeredgewidth=<span class="number">3</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-svm.png"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSVMç»™å‡ºäº†éžå¸¸å¹³æ»‘ä¸”éžçº¿æ€§ï¼ˆä¸æ˜¯ç›´çº¿ï¼‰çš„è¾¹ç•Œã€‚</p><h1 id="svmè°ƒå‚">SVMè°ƒå‚</h1><p>gammaå‚æ•°æ˜¯ä¸Šä¸€èŠ‚ç»™å‡ºçš„å…¬å¼ä¸­çš„å‚æ•°ï¼Œç”¨äºŽæŽ§åˆ¶é«˜æ–¯æ ¸çš„å®½åº¦ã€‚å®ƒå†³å®šäº†ç‚¹ä¸Žç‚¹ä¹‹é—´â€œé è¿‘â€æ˜¯æŒ‡å¤šå¤§çš„è·ç¦»ã€‚Cå‚æ•°æ˜¯æ­£åˆ™åŒ–å‚æ•°ï¼Œä¸Žçº¿æ€§æ¨¡åž‹ä¸­ç”¨åˆ°çš„ç±»ä¼¼ã€‚å®ƒé™åˆ¶æ¯ä¸ªç‚¹çš„é‡è¦æ€§ï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ¯ä¸ªç‚¹çš„<code>dual_coef_</code>ï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œæ”¹å˜è¿™äº›å‚æ•°æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">3</span>, <span class="number">3</span>, figsize=(<span class="number">15</span>, <span class="number">10</span>))</span><br><span class="line"><span class="keyword">for</span> ax, C <span class="keyword">in</span> zip(axes, [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">3</span>]):</span><br><span class="line">    <span class="keyword">for</span> a, gamma <span class="keyword">in</span> zip(ax, range(<span class="number">-1</span>, <span class="number">2</span>)):</span><br><span class="line">        mglearn.plots.plot_svm(log_C=C, log_gamma=gamma, ax=a)</span><br><span class="line">axes[<span class="number">0</span>, <span class="number">0</span>].legend([<span class="string">'class 0'</span>, <span class="string">'class 1'</span>, <span class="string">'sv class 0'</span>, <span class="string">'sv class 1'</span>],</span><br><span class="line">    ncol=<span class="number">4</span>, loc=(<span class="number">.9</span>, <span class="number">1.2</span>))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-svm-for-different-parameters.png"></p><p>ä»Žå·¦åˆ°å³ï¼Œæˆ‘ä»¬å°†gammaçš„å€¼ä»Ž0.1å¢žåŠ åˆ°10ã€‚<strong>gammaè¾ƒå°ï¼Œè¯´æ˜Žé«˜æ–¯æ ¸åŠå¾„è¾ƒå¤§ï¼Œè®¸å¤šç‚¹éƒ½è¢«çœ‹ä½œæ¯”è¾ƒé è¿‘ã€‚</strong>è¿™ä¸€ç‚¹å¯ä»¥åœ¨å›¾ä¸­çœ‹å‡ºï¼šå·¦ä¾§çš„å›¾å†³ç­–è¾¹ç•Œéžå¸¸å¹³æ»‘ï¼Œè¶Šå‘å³çš„å›¾å†³ç­–è¾¹ç•Œæ›´å…³æ³¨å•ä¸ªç‚¹ã€‚å°çš„gammaå€¼è¡¨ç¤ºå†³ç­–è¾¹ç•Œå˜åŒ–å¾ˆæ…¢ï¼Œç”Ÿæˆçš„äº‹å¤æ‚åº¦è¾ƒä½Žçš„æ¨¡åž‹ï¼Œè€Œå¤§çš„gammaå€¼åˆ™ä¼šç”Ÿæˆæ›´ä¸ºå¤æ‚çš„æ¨¡åž‹ã€‚</p><p>ä»Žä¸Šåˆ°ä¸‹ï¼Œæˆ‘ä»¬å°†å‚æ•°Cçš„å€¼ä»Ž0.1å¢žåŠ åˆ°1000ã€‚<strong>ä¸Žçº¿æ€§æ¨¡åž‹ç›¸åŒï¼ŒCå€¼å¾ˆå°ï¼Œè¯´æ˜Žæ¨¡åž‹éžå¸¸å—é™ï¼Œæ¯ä¸ªæ•°æ®ç‚¹çš„å½±å“èŒƒå›´éƒ½æœ‰é™ã€‚</strong>ä½ å¯ä»¥çœ‹åˆ°ï¼Œå·¦ä¸Šå›¾çš„å›¾ä¸­ï¼Œå†³ç­–è¾¹ç•Œçœ‹èµ·æ¥å‡ ä¹Žæ˜¯çº¿æ€§çš„ï¼Œè¯¯åˆ†ç±»çš„ç‚¹å¯¹è¾¹ç•Œå‡ ä¹Žæ²¡æœ‰ä»»ä½•å½±å“ã€‚å†çœ‹å·¦ä¸‹è§’çš„å›¾ï¼Œå¢žå¤§Cä¹‹åŽè¿™äº›ç‚¹å¯¹æ¨¡åž‹çš„å½±å“å˜å¤§ï¼Œä½¿å¾—å†³ç­–è¾¹ç•Œå‘ç”Ÿå¼¯æ›²æ¥å°†è¿™äº›ç‚¹æ­£ç¡®åˆ†ç±»ã€‚</p><p>æˆ‘ä»¬å°†RBFæ ¸SVMåº”ç”¨åˆ°ä¹³è…ºç™Œæ•°æ®é›†ä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>C=1, gamma=1/n_features</code>ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">svc = SVC()</span><br><span class="line">svc.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.2f&#125;'</span>.format(svc.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.2f&#125;'</span>.format(svc.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 1.00</span><br><span class="line">Accuracy on test set: 0.63</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¨¡åž‹åœ¨è®­ç»ƒé›†ä¸Šçš„åˆ†æ•°ååˆ†å®Œç¾Žï¼Œä½†åœ¨æµ‹è¯•é›†ä¸Šçš„ç²¾åº¦åªæœ‰63%ï¼Œå­˜åœ¨ç›¸å½“ä¸¥é‡çš„è¿‡æ‹Ÿåˆã€‚<strong>è™½ç„¶SVMçš„è¡¨çŽ°é€šå¸¸éƒ½å¾ˆå¥½ï¼Œä½†å®ƒå¯¹å‚æ•°çš„è®¾å®šå’Œæ•°æ®çš„ç¼©æ”¾éžå¸¸æ•æ„Ÿã€‚ç‰¹åˆ«åœ°ï¼Œå®ƒè¦æ±‚æ‰€æœ‰ç‰¹å¾æœ‰ç›¸ä¼¼çš„å˜åŒ–èŒƒå›´ã€‚</strong>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¯ä¸ªç‰¹å¾çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå®ƒä»¬ç»˜åˆ¶åœ¨å¯¹æ•°åæ ‡ä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.plot(X_train.min(axis=<span class="number">0</span>), <span class="string">'o'</span>, label=<span class="string">'min'</span>)</span><br><span class="line">plt.plot(X_train.max(axis=<span class="number">0</span>), <span class="string">'^'</span>, label=<span class="string">'max'</span>)</span><br><span class="line">plt.legend(loc=<span class="number">4</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature magnitude'</span>)</span><br><span class="line">plt.yscale(<span class="string">'log'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/features-magnitude-of-cancer.png"></p><p>ä»Žè¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¹³è…ºç™Œæ•°æ®é›†çš„ç‰¹å¾å…·æœ‰å®Œå…¨ä¸åŒçš„é‡çº§ã€‚è¿™å¯¹å…¶ä»–æ¨¡åž‹æ¥è¯´ï¼ˆæ¯”å¦‚çº¿æ€§æ¨¡åž‹ï¼‰å¯èƒ½æ˜¯å°é—®é¢˜ï¼Œä½†å¯¹æ ¸SVMå´æœ‰æžå¤§å½±å“ã€‚æˆ‘ä»¬æ¥ç ”ç©¶å¤„ç†è¿™ä¸ªé—®é¢˜çš„å‡ ç§æ–¹æ³•ï¼š ã€‚</p><h1 id="ä¸ºsvmé¢„å¤„ç†æ•°æ®">ä¸ºSVMé¢„å¤„ç†æ•°æ®</h1><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•å°±æ˜¯å¯¹æ¯ä¸ªç‰¹å¾è¿›è¡Œç¼©æ”¾ï¼Œä½¿å…¶å¤§è‡´éƒ½ä½äºŽåŒä¸€èŒƒå›´ã€‚æ ¸SVMå¸¸ç”¨çš„ç¼©æ”¾æ–¹æ³•å°±æ˜¯å°†æ‰€æœ‰ç‰¹å¾ç¼©æ”¾åˆ°0å’Œ1ä¹‹é—´ã€‚çŽ°åœ¨æˆ‘ä»¬æ¥â€œäººå·¥â€å¤„ç†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—è®­ç»ƒé›†ä¸­æ¯ä¸ªç‰¹å¾çš„æœ€å°å€¼</span></span><br><span class="line">min_on_training = X_train.min(axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># è®¡ç®—è®­ç»ƒé›†ä¸­æ¯ä¸ªç‰¹å¾çš„èŒƒå›´ï¼ˆæœ€å¤§å€¼-æœ€å°å€¼ï¼‰</span></span><br><span class="line">range_on_training = (X_train - min_on_training).max(axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡åŽ»æœ€å°å€¼ï¼Œç„¶åŽé™¤ä»¥èŒƒå›´</span></span><br><span class="line"><span class="comment"># è¿™æ ·æ¯ä¸ªç‰¹å¾éƒ½æ˜¯min=0å’Œmax=1</span></span><br><span class="line">X_train_scaled = (X_train - min_on_training) / range_on_training</span><br><span class="line">print(<span class="string">'Minimum for each feature\n&#123;&#125;'</span>.format(X_train_scaled.min(axis=<span class="number">0</span>)))</span><br><span class="line">print(<span class="string">'Maximum for each feature\n&#123;&#125;'</span>.format(X_train_scaled.max(axis=<span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æµ‹è¯•é›†åšç›¸åŒçš„å˜æ¢</span></span><br><span class="line">X_test_scaled = (X_test - min_on_training) / range_on_training</span><br><span class="line"></span><br><span class="line">svc = SVC()</span><br><span class="line">svc.fit(X_train_scaled, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(svc.score(X_train_scaled, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(svc.score(X_test_scaled, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Minimum for each feature</span><br><span class="line">[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.</span><br><span class="line"> 0. 0. 0. 0. 0. 0.]</span><br><span class="line">Maximum for each feature</span><br><span class="line">[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.</span><br><span class="line"> 1. 1. 1. 1. 1. 1.]</span><br><span class="line">Accuracy on training set: 0.948</span><br><span class="line">Accuracy on test set: 0.951</span><br></pre></td></tr></table></figure><p>æ•°æ®ç¼©æ”¾çš„ä½œç”¨å¾ˆå¤§ï¼<strong>å®žé™…ä¸Šæ¨¡åž‹çŽ°åœ¨å¤„äºŽæ¬ æ‹Ÿåˆçš„çŠ¶æ€ï¼Œå› ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ€§èƒ½éžå¸¸æŽ¥è¿‘ï¼Œä½†è¿˜æ²¡æœ‰æŽ¥è¿‘100%çš„ç²¾åº¦ã€‚</strong>ä»Žè¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¢žå¤§Cæˆ–gammaæ¥æ‹Ÿåˆæ›´ä¸ºå¤æ‚çš„æ¨¡åž‹ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">svc = SVC(C=<span class="number">1000</span>)</span><br><span class="line">svc.fit(X_train_scaled, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(svc.score(X_train_scaled, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(svc.score(X_test_scaled, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 0.988</span><br><span class="line">Accuracy on test set: 0.972</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¢žå¤§Cå¯ä»¥æ˜¾è‘—æ”¹å–„æ¨¡åž‹ï¼Œå¾—åˆ°97.2%çš„ç²¾åº¦ã€‚</p><h1 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h1><p>æ ¸æ”¯æŒå‘é‡æœºæ˜¯éžå¸¸å¼ºå¤§çš„æ¨¡åž‹ï¼Œåœ¨å„ç§æ•°æ®é›†ä¸Šçš„è¡¨çŽ°éƒ½å¾ˆå¥½ã€‚SVMå…è®¸å†³ç­–è¾¹ç•Œå¾ˆå¤æ‚ï¼Œå³ä½¿æ•°æ®åªæœ‰å‡ ä¸ªç‰¹å¾ã€‚å®ƒåœ¨ä½Žç»´æ•°æ®å’Œé«˜ç»´æ•°æ®ï¼ˆå³å¾ˆå°‘ç‰¹å¾å’Œå¾ˆå¤šç‰¹å¾ï¼‰ä¸Šçš„è¡¨çŽ°éƒ½å¾ˆå¥½ï¼Œä½†å¯¹æ ·æœ¬ä¸ªæ•°çš„ç¼©æ”¾è¡¨çŽ°ä¸å¥½ã€‚åœ¨æœ‰å¤šè¾¾10000ä¸ªæ ·æœ¬çš„æ•°æ®ä¸Šè¿è¡ŒSVMå¯èƒ½è¡¨çŽ°è‰¯å¥½ï¼Œä½†å¦‚æžœæ•°æ®é‡è¾¾åˆ°100000ç”šè‡³æ›´å¤§ï¼Œåœ¨è¿è¡Œæ—¶é—´å’Œå†…å­˜ä½¿ç”¨æ–¹æ³•å¯èƒ½ä¼šé¢ä¸´æŒ‘æˆ˜ã€‚</p><p>SVMçš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œé¢„å¤„ç†æ•°æ®å’Œè°ƒå‚éƒ½éœ€è¦éžå¸¸å°å¿ƒã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¦‚ä»Šå¾ˆå¤šåº”ç”¨ä¸­ç”¨çš„éƒ½æ˜¯åŸºäºŽæ ‘çš„æ¨¡åž‹ï¼Œæ¯”å¦‚éšæœºæ£®æž—æˆ–æ¢¯åº¦æå‡ï¼ˆéœ€è¦å¾ˆå°‘çš„é¢„å¤„ç†ï¼Œç”šè‡³ä¸éœ€è¦é¢„å¤„ç†ï¼‰ã€‚æ­¤å¤–SVMæ¨¡åž‹å¾ˆéš¾æ£€æŸ¥ï¼Œå¯èƒ½å¾ˆéš¾ç†è§£ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆé¢„æµ‹ï¼Œè€Œä¸”ä¹Ÿéš¾ä»¥å°†æ¨¡åž‹å‘éžä¸“å®¶è¿›è¡Œè§£é‡Šã€‚</p><p>ä¸è¿‡SVMä»ç„¶æ˜¯å€¼å¾—å°è¯•çš„ï¼Œç‰¹åˆ«æ˜¯æ‰€æœ‰ç‰¹å¾çš„æµ‹é‡å•ä½ç›¸ä¼¼ï¼ˆæ¯”å¦‚éƒ½æ˜¯åƒç´ å¯†åº¦ï¼‰è€Œä¸”èŒƒå›´ä¹Ÿå·®ä¸å¤šæ—¶ï¼Œ</p><p>æ ¸SVMçš„é‡è¦å‚æ•°æ˜¯æ­£åˆ™åŒ–å‚æ•°Cã€æ ¸çš„é€‰æ‹©ä»¥åŠä¸Žæ ¸ç›¸å…³çš„å‚æ•°ã€‚RBFæ ¸åªæœ‰ä¸€ä¸ªå‚æ•°gammaï¼Œå®ƒæ˜¯é«˜æ–¯æ ¸å®½åº¦çš„å€’æ•°ã€‚gammaå’ŒCæŽ§åˆ¶çš„éƒ½æ˜¯æ¨¡åž‹å¤æ‚åº¦ï¼Œè¾ƒå¤§çš„å€¼éƒ½å¯¹åº”æ›´ä¸ºå¤æ‚çš„æ¨¡åž‹ã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªå‚æ•°çš„è®¾å®šé€šå¸¸æ˜¯å¼ºçƒˆç›¸å…³çš„ï¼Œåº”è¯¥åŒæ—¶è°ƒèŠ‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
            <tag> classification </tag>
            
            <tag> SVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†³ç­–æ ‘é›†æˆ</title>
      <link href="/notes/introduction-to-ml-with-python/decision-tree-ensemble/"/>
      <url>/notes/introduction-to-ml-with-python/decision-tree-ensemble/</url>
      
        <content type="html"><![CDATA[<p><strong>é›†æˆ</strong>ï¼ˆensembleï¼‰æ˜¯åˆå¹¶å¤šä¸ªæœºå™¨å­¦ä¹ æ¨¡åž‹æ¥æž„å»ºæ›´å¼ºå¤§æ¨¡åž‹çš„æ–¹æ³•ã€‚åœ¨æœºå™¨å­¦ä¹ æ–‡çŒ®ä¸­æœ‰å¾ˆå¤šæ¨¡åž‹éƒ½å±žäºŽè¿™ä¸€ç±»ï¼Œä½†å·²è¯æ˜Žæœ‰ä¸¤ç§é›†æˆæ¨¡åž‹å¯¹å¤§é‡åˆ†ç±»å’Œå›žå½’çš„æ•°æ®é›†éƒ½æ˜¯æœ‰æ•ˆçš„ï¼ŒäºŒè€…éƒ½ä»¥å†³ç­–æ ‘ä¸ºåŸºç¡€ï¼Œåˆ†åˆ«æ˜¯éšæœºæ£®æž—ï¼ˆrandom forestï¼‰å’Œæ¢¯åº¦æå‡å†³ç­–æ ‘ï¼ˆgradient boosted decision treeï¼‰ã€‚</p><h1 id="éšæœºæ£®æž—">éšæœºæ£®æž—</h1><p>å†³ç­–æ ‘çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹åœ¨äºŽç»å¸¸å¯¹è®­ç»ƒæ•°æ®è¿‡æ‹Ÿåˆã€‚éšæœºæ£®æž—æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ã€‚éšæœºæ£®æž—æœ¬è´¨ä¸Šæ˜¯è®¸å¤šå†³ç­–æ ‘çš„é›†åˆï¼Œå…¶ä¸­æ¯æ£µæ ‘éƒ½å’Œå…¶ä»–æ ‘ç•¥æœ‰ä¸åŒã€‚éšæœºæ£®æž—èƒŒåŽçš„æ€æƒ³æ˜¯ï¼Œæ¯æ£µæ ‘çš„é¢„æµ‹å¯èƒ½éƒ½ç›¸å¯¹è¾ƒå¥½ï¼Œä½†å¯èƒ½å¯¹éƒ¨åˆ†æ•°æ®è¿‡æ‹Ÿåˆã€‚å¦‚æžœæž„é€ å¾ˆå¤šæ ‘ï¼Œå¹¶ä¸”æ¯æ£µæ ‘çš„é¢„æµ‹éƒ½å¾ˆå¥½ï¼Œä½†éƒ½ä»¥ä¸åŒçš„æ–¹å¼è¿‡æ‹Ÿåˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›æ ‘çš„ç»“æžœå–å¹³å‡å€¼æ¥é™ä½Žè¿‡æ‹Ÿåˆã€‚æ—¢èƒ½å‡å°‘è¿‡æ‹Ÿåˆåˆèƒ½ä¿æŒæ ‘çš„é¢„æµ‹èƒ½åŠ›ï¼Œè¿™å¯ä»¥åœ¨æ•°å­¦ä¸Šä¸¥æ ¼è¯æ˜Žã€‚</p><p>ä¸ºäº†å®žçŽ°è¿™ä¸€ç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦æž„é€ è®¸å¤šå†³ç­–æ ‘ã€‚æ¯æ£µæ ‘éƒ½åº”è¯¥å¯¹ç›®æ ‡å€¼åšå‡ºå¯ä»¥æŽ¥å—çš„é¢„æµ‹ï¼Œè¿˜åº”è¯¥ä¸Žå…¶ä»–æ ‘ä¸åŒã€‚éšæœºæ£®æž—çš„åå­—æ¥è‡ªäºŽå°†éšæœºæ€§æ·»åŠ åˆ°æ ‘çš„æž„é€ è¿‡ç¨‹ä¸­ï¼Œä»¥ç¡®ä¿æ¯æ£µæ ‘éƒ½å„ä¸ç›¸åŒã€‚<strong>éšæœºæ£®æž—ä¸­æ ‘çš„éšæœºåŒ–æ–¹æ³•æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯é€šè¿‡é€‰æ‹©ç”¨äºŽæž„é€ æ ‘çš„æ•°æ®ç‚¹ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡é€‰æ‹©æ¯æ¬¡åˆ’åˆ†æµ‹è¯•çš„ç‰¹å¾ã€‚</strong></p><a id="more"></a><h2 id="æž„é€ éšæœºæ£®æž—">æž„é€ éšæœºæ£®æž—</h2><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.ensemble.randomforestclassifier" target="_blank" rel="noopener"><code>class sklearn.ensemble.RandomForestClassifier(n_estimators=â€™warnâ€™, criterion=â€™giniâ€™, max_depth=None, min_samples_split=2, min_samples_leaf=1, min_weight_fraction_leaf=0.0, max_features=â€™autoâ€™, max_leaf_nodes=None, min_impurity_decrease=0.0, min_impurity_split=None, bootstrap=True, oob_score=False, n_jobs=None, random_state=None, verbose=0, warm_start=False, class_weight=None)</code></a></p></blockquote><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.ensemble.randomforestregressor" target="_blank" rel="noopener"><code>class sklearn.ensemble.RandomForestRegressor(n_estimators=â€™warnâ€™, criterion=â€™mseâ€™, max_depth=None, min_samples_split=2, min_samples_leaf=1, min_weight_fraction_leaf=0.0, max_features=â€™autoâ€™, max_leaf_nodes=None, min_impurity_decrease=0.0, min_impurity_split=None, bootstrap=True, oob_score=False, n_jobs=None, random_state=None, verbose=0, warm_start=False)</code></a></p></blockquote><p>æƒ³è¦æž„é€ ä¸€ä¸ªéšæœºæ£®æž—æ¨¡åž‹ï¼Œä½ éœ€è¦ç¡®å®šç”¨äºŽæž„é€ çš„æ ‘çš„ä¸ªæ•°ï¼ˆ<code>n_estimators</code>å‚æ•°ï¼‰ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦æž„é€ 10æ£µæ ‘ã€‚è¿™äº›æ ‘åœ¨æž„é€ æ—¶å½¼æ­¤å®Œå…¨ç‹¬ç«‹ï¼Œç®—æ³•å¯¹æ¯æ£µæ ‘è¿›è¡Œä¸åŒçš„éšæœºé€‰æ‹©ï¼Œä»¥ç¡®ä¿æ ‘å’Œæ ‘ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ã€‚æƒ³è¦æž„é€ ä¸€æ£µæ ‘ï¼Œé¦–å…ˆè¦å¯¹æ•°æ®è¿›è¡Œ<strong>è‡ªåŠ©é‡‡æ ·</strong>ï¼ˆbootstrap sampleï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»Ž<code>n_samples</code>ä¸ªæ•°æ®ç‚¹ä¸­æœ‰æ”¾å›žåœ°é‡å¤éšæœºæŠ½å–ä¸€ä¸ªæ ·æœ¬ï¼Œå…±æŠ½å–<code>n_samples</code>æ¬¡ã€‚è¿™æ ·ä¼šåˆ›å»ºä¸€ä¸ªä¸ŽåŽŸå§‹æ•°æ®é›†å¤§å°ç›¸åŒçš„æ•°æ®é›†ï¼Œä½†æœ‰äº›æ•°æ®ç‚¹ä¼šç¼ºå¤±ï¼ˆå¤§çº¦ä¸‰åˆ†ä¹‹ä¸€ï¼‰ï¼Œæœ‰äº›ä¼šé‡å¤ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜Žï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦åˆ›å»ºåˆ—è¡¨['a', 'b', 'c', 'd']çš„è‡ªåŠ©é‡‡æ ·ã€‚ä¸€ç§å¯èƒ½çš„è‡ªåŠ©é‡‡æ ·æ˜¯['b', 'd', 'd', 'c']ï¼Œå¦ä¸€ç§å¯èƒ½çš„é‡‡æ ·ä¸º['d', 'a', 'd', 'a']ã€‚</p><p>æŽ¥ä¸‹æ¥ï¼ŒåŸºäºŽè¿™ä¸ªæ–°åˆ›å»ºçš„æ•°æ®é›†æ¥æž„é€ å†³ç­–æ ‘ã€‚ä½†æ˜¯ï¼Œè¦å¯¹æˆ‘ä»¬åœ¨ä»‹ç»å†³ç­–æ ‘æ—¶æè¿°çš„ç®—æ³•ç¨ä½œä¿®æ”¹ã€‚åœ¨æ¯ä¸ªç»“ç‚¹å¤„ï¼Œç®—æ³•éšæœºé€‰æ‹©ç‰¹å¾çš„ä¸€ä¸ªå­é›†ï¼Œå¹¶å¯¹å…¶ä¸­ä¸€ä¸ªç‰¹å¾å¯»æ‰¾æœ€ä½³æµ‹è¯•ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªç»“ç‚¹éƒ½å¯»æ‰¾æœ€ä½³æµ‹è¯•ã€‚é€‰æ‹©çš„ç‰¹å¾ä¸ªæ•°ç”±<code>max_features</code>å‚æ•°æ¥æŽ§åˆ¶ã€‚æ¯ä¸ªç»“ç‚¹ä¸­ç‰¹å¾å­é›†çš„é€‰æ‹©æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿™æ ·æ ‘çš„æ¯ä¸ªç»“ç‚¹å¯ä»¥ä½¿ç”¨ç‰¹å¾çš„ä¸åŒå­é›†æ¥åšå‡ºå†³ç­–ã€‚</p><p>ç”±äºŽä½¿ç”¨äº†è‡ªåŠ©é‡‡æ ·ï¼Œéšæœºæ£®æž—ä¸­æž„é€ æ¯æ£µå†³ç­–æ ‘çš„æ•°æ®é›†éƒ½æ˜¯ç•¥æœ‰ä¸åŒçš„ã€‚ç”±äºŽæ¯ä¸ªç»“ç‚¹çš„ç‰¹å¾é€‰æ‹©ï¼Œæ¯æ£µæ ‘ä¸­çš„æ¯æ¬¡åˆ’åˆ†éƒ½æ˜¯åŸºäºŽç‰¹å¾çš„ä¸åŒå­é›†ã€‚è¿™ä¸¤ç§æ–¹æ³•å…±åŒä¿è¯éšæœºæ£®æž—ä¸­æ‰€æœ‰æ ‘éƒ½ä¸ç›¸åŒã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå…³é”®å‚æ•°æ˜¯<code>max_features</code>ã€‚å¦‚æžœæˆ‘ä»¬è®¾ç½®<code>max_features</code>ç­‰äºŽ<code>n_features</code>ï¼Œé‚£ä¹ˆæ¯æ¬¡åˆ’åˆ†éƒ½è¦è€ƒè™‘æ•°æ®é›†çš„æ‰€æœ‰ç‰¹å¾ï¼Œåœ¨ç‰¹å¾é€‰æ‹©çš„è¿‡ç¨‹ä¸­æ²¡æœ‰æ·»åŠ éšæœºæ€§ï¼ˆä¸è¿‡è‡ªåŠ©é‡‡æ ·ä¾ç„¶å­˜åœ¨éšæœºæ€§ï¼‰ï¼‰ã€‚å¦‚æžœè®¾ç½®<code>max_features</code>ç­‰äºŽ1ï¼Œé‚£ä¹ˆåœ¨åˆ’åˆ†æ—¶å°†æ— æ³•é€‰æ‹©å¯¹å“ªä¸ªç‰¹å¾è¿›è¡Œæµ‹è¯•ï¼Œåªèƒ½å¯¹éšæœºé€‰æ‹©çš„æŸä¸ªç‰¹å¾æœç´¢ä¸åŒçš„é˜ˆå€¼ã€‚å› æ­¤ï¼Œå¦‚æžœ<code>max_features</code>è¾ƒå¤§ï¼Œé‚£ä¹ˆéšæœºæ£®æž—ä¸­çš„æ ‘å°†ä¼šååˆ†ç›¸ä¼¼ï¼Œåˆ©ç”¨æœ€ç‹¬ç‰¹çš„ç‰¹å¾å¯ä»¥è½»æ¾æ‹Ÿåˆæ•°æ®ã€‚å¦‚æžœ<code>max_features</code>è¾ƒå°ï¼Œé‚£ä¹ˆéšæœºæ£®æž—ä¸­çš„æ ‘å°†ä¼šå·®å¼‚å¾ˆå¤§ï¼Œä¸ºäº†å¾ˆå¥½åœ°æ‹Ÿåˆæ•°æ®ï¼Œæ¯æ£µæ ‘çš„æ·±åº¦éƒ½è¦å¾ˆå¤§ã€‚</p><p>æƒ³è¦åˆ©ç”¨éšæœºæ£®æž—è¿›è¡Œé¢„æµ‹ï¼Œç®—æ³•é¦–å…ˆå¯¹æ£®æž—ä¸­çš„æ¯æ£µæ ‘è¿›è¡Œé¢„æµ‹ã€‚å¯¹äºŽå›žå½’é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›ç»“æžœå–å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆé¢„æµ‹ã€‚å¯¹äºŽåˆ†ç±»é—®é¢˜ï¼Œåˆ™ç”¨åˆ°äº†â€œè½¯æŠ•ç¥¨â€ï¼ˆsoft votingï¼‰ç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ£µæ ‘åšå‡ºâ€œè½¯â€œé¢„æµ‹ï¼Œç»™å‡ºæ¯ä¸ªå¯èƒ½çš„è¾“å‡ºæ ‡ç­¾çš„æ¦‚çŽ‡ã€‚å¯¹æ‰€æœ‰æ ‘çš„é¢„æµ‹æ¦‚çŽ‡å–å¹³å‡å€¼ï¼Œç„¶åŽå°†æ¦‚çŽ‡æœ€å¤§çš„ç±»åˆ«ä½œä¸ºé¢„æµ‹ç»“æžœã€‚</p><h2 id="åˆ†æžéšæœºæ£®æž—">åˆ†æžéšæœºæ£®æž—</h2><p>ä¸‹é¢å°†ç”±5æ£µæ ‘ç»„æˆçš„éšæœºæ£®æž—åº”ç”¨åˆ°å‰é¢ç ”ç©¶è¿‡çš„<code>two_moons</code>æ•°æ®é›†ä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_moons</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line"></span><br><span class="line">X, y = make_moons(n_samples=<span class="number">100</span>, noise=<span class="number">0.25</span>, random_state=<span class="number">3</span>)</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, stratify=y, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">forest = RandomForestClassifier(n_estimators=<span class="number">5</span>, random_state=<span class="number">2</span>)</span><br><span class="line">forest.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">3</span>, figsize=(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line"><span class="keyword">for</span> i, (ax, tree) <span class="keyword">in</span> enumerate(zip(axes.ravel(), forest.estimators_)):  <span class="comment"># æ ‘è¢«ä¿å­˜åœ¨estimator_å±žæ€§ä¸­</span></span><br><span class="line">    ax.set_title(<span class="string">'Tree &#123;&#125;'</span>.format(i))</span><br><span class="line">    mglearn.plots.plot_tree_partition(X_train, y_train, tree, ax=ax)</span><br><span class="line"></span><br><span class="line">mglearn.plots.plot_2d_separator(forest, X_train, fill=<span class="literal">True</span>, ax=axes[<span class="number">-1</span>, <span class="number">-1</span>])</span><br><span class="line">axes[<span class="number">-1</span>, <span class="number">-1</span>].set_title(<span class="string">'Random Forest'</span>)</span><br><span class="line">mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-random-forest.png"></p><p>ä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™5æ£µæ ‘å­¦åˆ°çš„å†³ç­–è¾¹ç•Œå¤§ä¸ç›¸åŒã€‚æ¯æ£µæ ‘éƒ½çŠ¯äº†ä¸€äº›é”™è¯¯ï¼Œå› ä¸ºè¿™é‡Œç”»å‡ºçš„ä¸€äº›è®­ç»ƒç‚¹å®žé™…ä¸Šå¹¶æ²¡æœ‰åŒ…å«åœ¨æ ‘çš„è®­ç»ƒé›†ä¸­ï¼ŒåŽŸå› åœ¨äºŽè‡ªåŠ©é‡‡æ ·ã€‚</p><p>éšæœºæ£®æž—æ¯”å•ç‹¬æ¯ä¸€æ£µæ ‘çš„è¿‡æ‹Ÿåˆéƒ½è¦å°ï¼Œç»™å‡ºçš„å†³ç­–è¾¹ç•Œä¹Ÿæ›´ç¬¦åˆç›´è§‰ã€‚åœ¨ä»»ä½•å®žé™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°æ›´å¤šæ£µæ ‘ï¼ˆé€šå¸¸æ˜¯å‡ ç™¾æˆ–ä¸Šåƒï¼‰ï¼Œä»Žè€Œå¾—åˆ°æ›´å¹³æ»‘çš„è¾¹ç•Œã€‚</p><p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†åŒ…å«100æ£µæ ‘çš„éšæœºæ£®æž—åº”ç”¨åœ¨ä¹³è…ºç™Œæ•°æ®é›†ä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">forest = RandomForestClassifier(n_estimators=<span class="number">100</span>, random_state=<span class="number">0</span>)</span><br><span class="line">forest.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(forest.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(forest.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 1.000</span><br><span class="line">Accuracy on test set: 0.972</span><br></pre></td></tr></table></figure><p>åœ¨æ²¡æœ‰è°ƒèŠ‚ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼Œéšæœºæ£®æž—çš„ç²¾åº¦ä¸º97%ï¼Œæ¯”çº¿æ€§æ¨¡åž‹æˆ–å•æ£µå†³ç­–æ ‘éƒ½è¦å¥½ã€‚æˆ‘ä»¬å¯ä»¥è°ƒèŠ‚<code>max_featues</code>å‚æ•°ï¼Œæˆ–è€…åƒå•æ£µå†³ç­–æ ‘é‚£æ ·è¿›è¡Œé¢„å‰ªæžã€‚ä½†æ˜¯ï¼Œéšæœºæ£®æž—çš„é»˜è®¤å‚æ•°é€šå¸¸å°±å·²ç»å¯ä»¥ç»™å‡ºå¾ˆå¥½çš„ç»“æžœã€‚</p><p>ä¸Žå†³ç­–æ ‘ç±»ä¼¼ï¼Œéšæœºæ£®æž—ä¹Ÿå¯ä»¥ç»™å‡ºç‰¹å¾é‡è¦æ€§ï¼Œè®¡ç®—æ–¹æ³•æ˜¯å°†æ£®æž—ä¸­æ‰€æœ‰æ ‘çš„ç‰¹å¾é‡è¦æ€§æ±‚å’Œå¹¶å–å¹³å‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéšæœºæ£®æž—ç»™å‡ºçš„ç‰¹å¾é‡è¦æ€§è¦æ¯”å•æ£µæ ‘ç»™å‡ºçš„æ›´ä¸ºå¯é ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plot_feature_importances_cancer(forest)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/feature-importances-of-random-forest.png"></p><p>å¦‚ä½ æ‰€è§ï¼Œä¸Žå•æ£µæ ‘ç›¸æ¯”ï¼Œéšæœºæ£®æž—ä¸­æœ‰æ›´å¤šç‰¹å¾çš„é‡è¦æ€§ä¸ä¸ºé›¶ã€‚ä¸Žå•æ£µå†³ç­–æ ‘ç±»ä¼¼ï¼Œéšæœºæ£®æž—ä¹Ÿç»™å‡ºäº†&quot;worst radius&quot;ï¼ˆæœ€å¤§åŠå¾„ï¼‰ç‰¹å¾å¾ˆå¤§çš„é‡è¦æ€§ï¼Œä½†ä»Žæ€»ä½“æ¥çœ‹ï¼Œå®ƒå®žé™…ä¸Šå´é€‰æ‹©&quot;worst perimeter&quot;ï¼ˆæœ€å¤§å‘¨é•¿ï¼‰ä½œä¸ºä¿¡æ¯é‡æœ€å¤§çš„ç‰¹å¾ã€‚ç”±äºŽæž„é€ éšæœºæ£®æž—è¿‡ç¨‹ä¸­çš„éšæœºæ€§ï¼Œç®—æ³•éœ€è¦è€ƒè™‘å¤šç§å¯èƒ½çš„è§£é‡Šï¼Œç»“æžœå°±æ˜¯éšæœºæ£®æž—æ¯”å•æ£µæ ‘æ›´èƒ½ä»Žæ€»ä½“æŠŠæ¡æ•°æ®çš„ç‰¹å¾ã€‚</p><h2 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h2><p>ç”¨äºŽå›žå½’å’Œåˆ†ç±»çš„éšæœºæ£®æž—æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„æœºå™¨å­¦ä¹ æ–¹æ³•ä¹‹ä¸€ã€‚è¿™ç§æ–¹æ³•éžå¸¸å¼ºå¤§ï¼Œé€šå¸¸ä¸éœ€è¦åå¤è°ƒèŠ‚å‚æ•°å°±å¯ä»¥ç»™å‡ºå¾ˆå¥½çš„ç»“æžœï¼Œä¹Ÿä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œç¼©æ”¾ã€‚</p><p>ä»Žæœ¬è´¨ä¸Šçœ‹ï¼Œéšæœºæ£®æž—æ‹¥æœ‰å†³ç­–æ ‘çš„æ‰€æœ‰ä¼˜ç‚¹ï¼ŒåŒæ—¶å¼¥è¡¥äº†å†³ç­–æ ‘çš„ä¸€äº›ç¼ºé™·ã€‚ä»ç„¶ä½¿ç”¨å†³ç­–æ ‘çš„ä¸€ä¸ªåŽŸå› æ˜¯éœ€è¦å†³ç­–è¿‡ç¨‹çš„ç´§å‡‘è¡¨ç¤ºã€‚åŸºæœ¬ä¸Šä¸å¯èƒ½å¯¹å‡ åæ£µç”šè‡³ä¸Šç™¾æ£µæ ‘åšå‡ºè¯¦ç»†è§£é‡Šï¼Œéšæœºæ£®æž—ä¸­æ ‘çš„æ·±åº¦å¾€å¾€æ¯”å†³ç­–æ ‘è¿˜è¦å¤§ï¼ˆå› ä¸ºç”¨åˆ°äº†ç‰¹å¾å­é›†ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æžœä½ éœ€è¦ä»¥å¯è§†åŒ–çš„æ–¹å¼å‘éžä¸“å®¶æ€»ç»“é¢„æµ‹è¿‡ç¨‹ï¼Œé‚£ä¹ˆé€‰æ‹©å•æ£µå†³ç­–æ ‘å¯èƒ½æ›´å¥½ã€‚è™½ç„¶åœ¨å¤§åž‹æ•°æ®é›†ä¸Šæž„å»ºéšæœºæ£®æž—å¯èƒ½æ¯”è¾ƒè´¹æ—¶é—´ï¼Œä½†åœ¨ä¸€å°è®¡ç®—æœºçš„å¤šä¸ªCPUå†…æ ¸ä¸Šå¹¶è¡Œè®¡ç®—ä¹Ÿå¾ˆå®¹æ˜“ã€‚å¦‚æžœä½ ç”¨çš„æ˜¯å¤šæ ¸å¤„ç†å™¨ï¼Œä½ å¯ä»¥ç”¨<code>n_jobs</code>å‚æ•°æ¥è°ƒèŠ‚ä½¿ç”¨çš„å†…æ ¸ä¸ªæ•°ã€‚ä½¿ç”¨æ›´å¤šçš„CPUå†…æ ¸ï¼Œå¯ä»¥è®©é€Ÿåº¦çº¿æ€§å¢žåŠ ï¼Œä½†è®¾ç½®<code>n_jobs</code>å¤§äºŽå†…æ ¸ä¸ªæ•°æ˜¯æ²¡æœ‰ç”¨çš„ã€‚ä½ å¯ä»¥è®¾ç½®<code>n_jobs=-1</code>æ¥ä½¿ç”¨è®¡ç®—æœºçš„æ‰€æœ‰å†…æ ¸ã€‚</p><p>ä½ åº”è¯¥è®°ä½ï¼Œéšæœºæ£®æž—æœ¬è´¨ä¸Šæ˜¯éšæœºçš„ï¼Œè®¾ç½®ä¸åŒçš„éšæœºçŠ¶æ€ï¼ˆæˆ–è€…ä¸è®¾ç½®<code>random_state</code>å‚æ•°ï¼‰å¯ä»¥å½»åº•æ”¹å˜æž„å»ºçš„æ¨¡åž‹ã€‚æ£®æž—ä¸­çš„æ ‘è¶Šå¤šï¼Œå®ƒå¯¹éšæœºçŠ¶æ€é€‰æ‹©çš„é²æ£’æ€§å°±è¶Šå¥½ã€‚å¦‚æžœä½ å¸Œæœ›ç»“æžœå¯ä»¥é‡çŽ°ï¼Œå›ºå®š<code>random_state</code>æ˜¯å¾ˆé‡è¦çš„ã€‚</p><p>å¯¹äºŽç»´åº¦éžå¸¸é«˜çš„ç¨€ç–æ•°æ®ï¼ˆæ¯”å¦‚æ–‡æœ¬æ•°æ®ï¼‰ï¼Œéšæœºæ£®æž—çš„è¡¨çŽ°å¾€å¾€ä¸æ˜¯å¾ˆå¥½ã€‚å¯¹äºŽè¿™ç§æ•°æ®ï¼Œä½¿ç”¨çº¿æ€§æ¨¡åž‹å¯èƒ½æ›´ä¸ºåˆé€‚ã€‚å³ä½¿æ˜¯éžå¸¸å¤§çš„æ•°æ®é›†ï¼Œéšæœºæ£®æž—çš„è¡¨çŽ°ä¹Ÿé€šå¸¸ä¹Ÿå¾ˆå¥½ï¼Œè®­ç»ƒè¿‡ç¨‹å¾ˆå®¹æ˜“å¹¶è¡Œåœ¨åŠŸèƒ½å¼ºå¤§çš„è®¡ç®—æœºçš„å¤šä¸ªCPUå†…æ ¸ä¸Šã€‚ä¸è¿‡ï¼Œéšæœºæ£®æž—éœ€è¦æ›´å¤§çš„å†…å­˜ï¼Œè®­ç»ƒå’Œé¢„æµ‹çš„é€Ÿåº¦ä¹Ÿæ¯”çº¿æ€§æ¨¡åž‹è¦æ…¢ã€‚å¯¹ä¸€ä¸ªåº”ç”¨æ¥è¯´ï¼Œå¦‚æžœæ—¶é—´å’Œå†…å­˜å¾ˆé‡è¦çš„è¯ï¼Œé‚£ä¹ˆæ¢ç”¨çº¿æ€§æ¨¡åž‹å¯èƒ½æ›´ä¸ºæ˜Žæ™ºã€‚</p><p>éœ€è¦è°ƒèŠ‚çš„é‡è¦å‚æ•°æœ‰<code>n_estimators</code>å’Œ<code>max_features</code>ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬é¢„å‰ªæžé€‰é¡¹ï¼ˆå¦‚<code>max_depth</code>ï¼‰ã€‚<strong><code>n_estimators</code>æ€»æ˜¯è¶Šå¤§è¶Šå¥½ã€‚</strong>å¯¹æ›´å¤šçš„æ ‘å–å¹³å‡å¯ä»¥é™ä½Žè¿‡æ‹Ÿåˆï¼Œä»Žè€Œå¾—åˆ°é²æ£’æ€§æ›´å¥½çš„é›†æˆã€‚ä¸è¿‡æ”¶ç›Šæ˜¯é€’å‡çš„ï¼Œè€Œä¸”æ ‘è¶Šå¤šéœ€è¦çš„å†…å­˜ä¹Ÿè¶Šå¤šï¼Œè®­ç»ƒæ—¶é—´ä¹Ÿè¶Šé•¿ã€‚<strong>å¸¸ç”¨çš„ç»éªŒæ³•åˆ™å°±æ˜¯â€œåœ¨ä½ çš„æ—¶é—´/å†…å­˜å…è®¸çš„æƒ…å†µä¸‹å°½é‡å¤šâ€ã€‚</strong></p><p>å‰é¢è¯´è¿‡ï¼Œ<code>max_features</code>å†³å®šæ¯æ£µæ ‘çš„éšæœºæ€§å¤§å°ï¼Œè¾ƒå°çš„<code>max_features</code>å¯ä»¥é™ä½Žè¿‡æ‹Ÿåˆã€‚<strong>ä¸€èˆ¬æ¥è¯´ï¼Œå¥½çš„ç»éªŒå°±æ˜¯ä½¿ç”¨é»˜è®¤å€¼ï¼šå¯¹äºŽåˆ†ç±»ï¼Œé»˜è®¤å€¼æ˜¯<code>max_features=sqrt(n_features)</code>ï¼›å¯¹äºŽå›žå½’ï¼Œé»˜è®¤å€¼æ˜¯<code>max_features=n_features</code>ã€‚</strong>å¢žå¤§<code>max_features</code>æˆ–<code>max_leaf_nodes</code>æœ‰æ—¶ä¹Ÿå¯ä»¥æé«˜æ€§èƒ½ã€‚å®ƒè¿˜å¯ä»¥å¤§å¤§é™ä½Žç”¨äºŽè®­ç»ƒå’Œé¢„æµ‹çš„æ—¶é—´å’Œç©ºé—´è¦æ±‚ã€‚</p><h1 id="æ¢¯åº¦æå‡å›žå½’æ ‘">æ¢¯åº¦æå‡å›žå½’æ ‘</h1><p>æ¢¯åº¦æå‡å›žå½’æ ‘æ˜¯å¦ä¸€ç§é›†æˆæ–¹æ³•ï¼Œé€šè¿‡åˆå¹¶å¤šä¸ªå†³ç­–æ ‘æ¥æž„å»ºä¸€ä¸ªæ›´ä¸ºå¼ºå¤§çš„æ¨¡åž‹ã€‚è™½ç„¶åå­—ä¸­å«æœ‰â€œå›žå½’â€ï¼Œä½†è¿™ä¸ªæ¨¡åž‹æ—¢å¯ä»¥ç”¨äºŽå›žå½’ä¹Ÿå¯ä»¥ç”¨äºŽåˆ†ç±»ã€‚ä¸Žéšæœºæ£®æž—æ–¹æ³•ä¸åŒï¼Œæ¢¯åº¦æå‡é‡‡ç”¨è¿žç»­çš„æ–¹å¼æž„é€ æ ‘ï¼Œæ¯æ£µæ ‘éƒ½è¯•å›¾çº æ­£å‰ä¸€æ£µæ ‘çš„é”™è¯¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¢¯åº¦æå‡å›žå½’æ ‘ä¸­æ²¡æœ‰éšæœºåŒ–ï¼Œè€Œæ˜¯ç”¨åˆ°äº†å¼ºé¢„å‰ªæžã€‚æ¢¯åº¦æå‡æ ‘é€šå¸¸ä½¿ç”¨æ·±åº¦å¾ˆå°ï¼ˆ1åˆ°5ä¹‹é—´ï¼‰çš„æ ‘ï¼Œè¿™æ ·æ¨¡åž‹å ç”¨çš„å†…å­˜æ›´å°‘ï¼Œé¢„æµ‹é€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚</p><p>æ¢¯åº¦æå‡èƒŒåŽçš„ä¸»è¦æ€æƒ³æ˜¯åˆå¹¶è®¸å¤šç®€å•çš„æ¨¡åž‹ï¼ˆåœ¨è¿™ä¸ªè¯­å¢ƒä¸­å«ä½œ<strong>å¼±å­¦ä¹ å™¨</strong>ï¼‰ï¼Œæ¯”å¦‚æ·±åº¦è¾ƒå°çš„æ ‘ã€‚æ¯æ£µæ ‘åªèƒ½å¯¹éƒ¨åˆ†æ•°æ®åšå‡ºå¥½çš„é¢„æµ‹ï¼Œå› æ­¤ï¼Œæ·»åŠ çš„æ ‘è¶Šæ¥è¶Šå¤šï¼Œå¯ä»¥ä¸æ–­è¿­ä»£æé«˜æ€§èƒ½ã€‚</p><p>æ¢¯åº¦æå‡æ ‘ç»å¸¸æ˜¯æœºå™¨å­¦ä¹ ç«žèµ›çš„ä¼˜èƒœè€…ï¼Œå¹¶ä¸”å¹¿æ³›åº”ç”¨äºŽä¸šç•Œã€‚ä¸Žéšæœºæ£®æž—ç›¸æ¯”ï¼Œå®ƒé€šå¸¸å¯¹å‚æ•°è®¾ç½®æ›´ä¸ºæ•æ„Ÿï¼Œä½†å¦‚æžœå‚æ•°è®¾ç½®æ­£ç¡®çš„è¯ï¼Œæ¨¡åž‹ç²¾åº¦æ›´é«˜ã€‚</p><p>é™¤äº†é¢„å‰ªæžä¸Žé›†æˆä¸­æ ‘çš„æ•°é‡ä¹‹å¤–ï¼Œæ¢¯åº¦æå‡çš„å¦ä¸€ä¸ªé‡è¦å‚æ•°æ˜¯<code>learning_rate</code>ï¼ˆå­¦ä¹ çŽ‡ï¼‰ï¼Œç”¨äºŽæŽ§åˆ¶æ¯æ£µæ ‘çº æ­£å‰ä¸€æ£µæ ‘çš„é”™è¯¯çš„å¼ºåº¦ã€‚è¾ƒé«˜çš„å­¦ä¹ çŽ‡æ„å‘³ç€æ¯æ£µæ ‘éƒ½å¯ä»¥åšå‡ºè¾ƒå¼ºçš„ä¿®æ­£ï¼Œè¿™æ ·æ¨¡åž‹æ›´ä¸ºå¤æ‚ã€‚é€šè¿‡å¢žå¤§<code>n_estimators</code>æ¥å‘é›†æˆä¸­æ·»åŠ æ›´å¤šæ ‘ï¼Œä¹Ÿå¯ä»¥å¢žåŠ æ¨¡åž‹å¤æ‚åº¦ï¼Œå› ä¸ºæ¨¡åž‹æœ‰æ›´å¤šæœºä¼šçº æ­£è®­ç»ƒé›†ä¸Šçš„é”™è¯¯ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨ä¹³è…ºç™Œæ•°æ®é›†ä¸Šåº”ç”¨GradientBoostingClassifierçš„ç¤ºä¾‹ã€‚é»˜è®¤ä½¿ç”¨100æ£µæ ‘ï¼Œæœ€å¤§æ·±åº¦æ˜¯3ï¼Œå­¦ä¹ çŽ‡æ˜¯0.1ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.ensemble.gradientboostingclassifier" target="_blank" rel="noopener"><code>class sklearn.ensemble.GradientBoostingClassifier(loss=â€™devianceâ€™, learning_rate=0.1, n_estimators=100, subsample=1.0, criterion=â€™friedman_mseâ€™, min_samples_split=2, min_samples_leaf=1, min_weight_fraction_leaf=0.0, max_depth=3, min_impurity_decrease=0.0, min_impurity_split=None, init=None, random_state=None, max_features=None, verbose=0, max_leaf_nodes=None, warm_start=False, presort=â€™autoâ€™, validation_fraction=0.1, n_iter_no_change=None, tol=0.0001)</code></a></p></blockquote><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.ensemble.gradientboostingregressor" target="_blank" rel="noopener"><code>class sklearn.ensemble.GradientBoostingRegressor(loss=â€™lsâ€™, learning_rate=0.1, n_estimators=100, subsample=1.0, criterion=â€™friedman_mseâ€™, min_samples_split=2, min_samples_leaf=1, min_weight_fraction_leaf=0.0, max_depth=3, min_impurity_decrease=0.0, min_impurity_split=None, init=None, random_state=None, max_features=None, alpha=0.9, verbose=0, max_leaf_nodes=None, warm_start=False, presort=â€™autoâ€™, validation_fraction=0.1, n_iter_no_change=None, tol=0.0001)</code></a></p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> GradientBoostingClassifier</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">gbrt = GradientBoostingClassifier(random_state=<span class="number">0</span>)</span><br><span class="line">gbrt.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(gbrt.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(gbrt.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 1.000</span><br><span class="line">Accuracy on test set: 0.965</span><br></pre></td></tr></table></figure><p>ç”±äºŽè®­ç»ƒé›†è¿›åº¦è¾¾åˆ°100%ï¼Œæ‰€ä»¥å¾ˆå¯èƒ½å­˜åœ¨è¿‡æ‹Ÿåˆã€‚ä¸ºäº†é™ä½Žè¿‡æ‹Ÿåˆï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶æœ€å¤§æ·±åº¦æ¥åŠ å¼ºé¢„å‰ªæžï¼Œä¹Ÿå¯ä»¥é™ä½Žå­¦ä¹ çŽ‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gbrt = GradientBoostingClassifier(random_state=<span class="number">0</span>, max_depth=<span class="number">1</span>)  <span class="comment"># é™åˆ¶æœ€å¤§æ·±åº¦</span></span><br><span class="line">gbrt.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(gbrt.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(gbrt.score(X_test, y_test)))</span><br><span class="line"></span><br><span class="line">gbrt = GradientBoostingClassifier(random_state=<span class="number">0</span>, learning_rate=<span class="number">0.01</span>)  <span class="comment"># é™ä½Žå­¦ä¹ çŽ‡</span></span><br><span class="line">gbrt.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(gbrt.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(gbrt.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 0.991</span><br><span class="line">Accuracy on test set: 0.972</span><br><span class="line">Accuracy on training set: 0.988</span><br><span class="line">Accuracy on test set: 0.965</span><br></pre></td></tr></table></figure><p>é™ä½Žæ¨¡åž‹å¤æ‚åº¦çš„ä¸¤ç§æ–¹æ³•éƒ½é™ä½Žäº†è®­ç»ƒé›†ç²¾åº¦ï¼Œè¿™å’Œé¢„æœŸç›¸åŒã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡å°æ ‘çš„æœ€å¤§æ·±åº¦æ˜¾è‘—æå‡äº†æ¨¡åž‹æ€§èƒ½ã€‚</p><p>å¯¹äºŽå…¶ä»–åŸºäºŽå†³ç­–æ ‘çš„æ¨¡åž‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç‰¹å¾é‡è¦æ€§å¯è§†åŒ–ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£æ¨¡åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gbrt = GradientBoostingClassifier(random_state=<span class="number">0</span>, max_depth=<span class="number">1</span>)</span><br><span class="line">gbrt.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">plot_feature_importances_cancer(gbrt)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/feature-importances-of-gbrt.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¢¯åº¦ä½“å¾æ ‘çš„ç‰¹å¾é‡è¦æ€§ä¸Žéšæœºæ£®æž—çš„ç‰¹å¾é‡è¦æ€§æœ‰äº›ç±»ä¼¼ï¼Œä¸è¿‡æ¢¯åº¦æå‡å®Œå…¨å¿½ç•¥äº†æŸäº›ç‰¹å¾ã€‚</p><p><strong>ç”±äºŽæ¢¯åº¦æå‡å’Œéšæœºæ£®æž—ä¸¤ç§æ–¹æ³•åœ¨ç±»ä¼¼çš„æ•°æ®ä¸Šè¡¨çŽ°å¾—éƒ½å¾ˆå¥½ï¼Œå› æ­¤ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯å…ˆå°è¯•éšæœºæ£®æž—ï¼Œå®ƒçš„é²æ£’æ€§å¾ˆå¥½ã€‚å¦‚æžœéšæœºæ£®æž—æ•ˆæžœå¾ˆå¥½ï¼Œä½†é¢„æµ‹æ—¶é—´å¤ªé•¿ï¼Œæˆ–è€…æœºå™¨å­¦ä¹ æ¨¡åž‹ç²¾åº¦å°æ•°ç‚¹åŽç¬¬äºŒä½çš„æé«˜ä¹Ÿå¾ˆé‡è¦ï¼Œé‚£ä¹ˆåˆ‡æ¢æˆæ¢¯åº¦æå‡é€šå¸¸ä¼šæœ‰ç”¨ã€‚</strong></p><h2 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°-1">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h2><p>æ¢¯åº¦æå‡å†³ç­–æ ‘æ˜¯ç›‘ç£å­¦ä¹ ä¸­æœ€å¼ºå¤§ä¹Ÿæœ€å¸¸ç”¨çš„æ¨¡åž‹ä¹‹ä¸€ã€‚å…¶ä¸»è¦ç¼ºç‚¹æ˜¯éœ€è¦ä»”ç»†è°ƒå‚ï¼Œè€Œä¸”è®­ç»ƒæ—¶é—´å¯èƒ½ä¼šæ¯”è¾ƒé•¿ã€‚ä¸Žå…¶ä»–åŸºäºŽæ ‘çš„æ¨¡åž‹ç±»ä¼¼ï¼Œè¿™ä¸€ç®—æ³•ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œç¼©æ”¾å°±å¯ä»¥è¡¨çŽ°å¾—å¾ˆå¥½ï¼Œè€Œä¸”ä¹Ÿé€‚ç”¨äºŽäºŒå…ƒç‰¹å¾ä¸Žè¿žç»­ç‰¹å¾åŒæ—¶å­˜åœ¨çš„æ•°æ®é›†ã€‚<strong>ä¸Žå…¶ä»–åŸºäºŽæ ‘çš„æ¨¡åž‹ç›¸åŒï¼Œå®ƒä¹Ÿé€šå¸¸ä¸é€‚ç”¨äºŽé«˜ç»´ç¨€ç–æ•°æ®ã€‚</strong></p><p>æ¢¯åº¦æå‡æ ‘æ¨¡åž‹çš„ä¸»è¦å‚æ•°åŒ…æ‹¬æ ‘çš„æ•°é‡<code>n_estimators</code>å’Œå­¦ä¹ çŽ‡<code>learning_rate</code>ï¼ŒåŽè€…ç”¨äºŽæŽ§åˆ¶æ¯æ£µæ ‘å¯¹å‰ä¸€æ£µæ ‘çš„é”™è¯¯çš„çº æ­£å¼ºåº¦ã€‚è¿™ä¸¤ä¸ªå‚æ•°é«˜åº¦ç›¸å…³ï¼Œå› ä¸º<code>learning_rate</code>è¶Šä½Žï¼Œå°±éœ€è¦æ›´å¤šçš„æ ‘æ¥æž„å»ºå…·æœ‰ç›¸ä¼¼å¤æ‚åº¦çš„æ¨¡åž‹ã€‚éšæœºæ£®æž—çš„<code>n_estimators</code>å€¼æ€»æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œä½†æ¢¯åº¦æå‡ä¸åŒï¼Œå¢žå¤§<code>n_estimators</code>ä¼šå¯¼è‡´æ¨¡åž‹æ›´åŠ å¤æ‚ï¼Œè¿›è€Œå¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚é€šå¸¸çš„åšæ³•æ˜¯æ ¹æ®æ—¶é—´å’Œå†…å­˜çš„é¢„ç®—é€‰æ‹©åˆé€‚çš„<code>n_estimators</code>ï¼Œç„¶åŽå¯¹ä¸åŒçš„<code>learning_rate</code>è¿›è¡ŒéåŽ†ã€‚</p><p>å¦ä¸€ä¸ªé‡è¦å‚æ•°æ˜¯<code>max_depth</code>ï¼ˆæˆ–<code>max_leaf_nodes</code>ï¼‰ï¼Œç”¨äºŽé™ä½Žæ¯æ£µæ ‘çš„å¤æ‚åº¦ã€‚æ¢¯åº¦æå‡æ¨¡åž‹çš„<code>max_depth</code>é€šå¸¸éƒ½è®¾ç½®çš„å¾ˆå°ï¼Œä¸€èˆ¬ä¸è¶…è¿‡5ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
            <tag> regression </tag>
            
            <tag> classification </tag>
            
            <tag> decision tree </tag>
            
            <tag> ensemble </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†³ç­–æ ‘</title>
      <link href="/notes/introduction-to-ml-with-python/decision-trees/"/>
      <url>/notes/introduction-to-ml-with-python/decision-trees/</url>
      
        <content type="html"><![CDATA[<p>å†³ç­–æ ‘æ˜¯å¹¿æ³›ç”¨äºŽåˆ†ç±»å’Œå›žå½’ä»»åŠ¡çš„æ¨¡åž‹ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒæ˜¯ä»Žä¸€å±‚å±‚çš„if/elseé—®é¢˜ä¸­è¿›è¡Œå­¦ä¹ ï¼Œå¹¶å¾—å‡ºç»“è®ºã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æƒ³è¦åŒºåˆ†ä¸‹é¢å››ç§åŠ¨ç‰©ï¼šç†Šã€é¹°ã€ä¼é¹…å’Œæµ·è±šã€‚ä½ çš„ç›®æ ‡æ˜¯é€šè¿‡å°½å¯èƒ½å°‘çš„if/elseé—®é¢˜æ¥å¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> graphviz</span><br><span class="line"></span><br><span class="line">mygraph = graphviz.Digraph(node_attr=&#123;<span class="string">'shape'</span>: <span class="string">'box'</span>&#125;,</span><br><span class="line">                           edge_attr=&#123;<span class="string">'labeldistance'</span>: <span class="string">"10.5"</span>&#125;,</span><br><span class="line">                           format=<span class="string">"svg"</span>)</span><br><span class="line">mygraph.node(<span class="string">"0"</span>, <span class="string">"æœ‰æ²¡æœ‰ç¾½æ¯›ï¼Ÿ"</span>)</span><br><span class="line">mygraph.node(<span class="string">"1"</span>, <span class="string">"ä¼šä¸ä¼šé£žï¼Ÿ"</span>)</span><br><span class="line">mygraph.node(<span class="string">"2"</span>, <span class="string">"æœ‰æ²¡æœ‰é³ï¼Ÿ"</span>)</span><br><span class="line">mygraph.node(<span class="string">"3"</span>, <span class="string">"é¹°"</span>)</span><br><span class="line">mygraph.node(<span class="string">"4"</span>, <span class="string">"ä¼é¹…"</span>)</span><br><span class="line">mygraph.node(<span class="string">"5"</span>, <span class="string">"æµ·è±š"</span>)</span><br><span class="line">mygraph.node(<span class="string">"6"</span>, <span class="string">"ç†Š"</span>)</span><br><span class="line">mygraph.edge(<span class="string">"0"</span>, <span class="string">"1"</span>, label=<span class="string">"æœ‰"</span>)</span><br><span class="line">mygraph.edge(<span class="string">"0"</span>, <span class="string">"2"</span>, label=<span class="string">"æ²¡æœ‰"</span>)</span><br><span class="line">mygraph.edge(<span class="string">"1"</span>, <span class="string">"3"</span>, label=<span class="string">"ä¼š"</span>)</span><br><span class="line">mygraph.edge(<span class="string">"1"</span>, <span class="string">"4"</span>, label=<span class="string">"ä¸ä¼š"</span>)</span><br><span class="line">mygraph.edge(<span class="string">"2"</span>, <span class="string">"5"</span>, label=<span class="string">"æœ‰"</span>)</span><br><span class="line">mygraph.edge(<span class="string">"2"</span>, <span class="string">"6"</span>, label=<span class="string">"æ²¡æœ‰"</span>)</span><br><span class="line">mygraph.render(view=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-tree-on-animal.svg"></p><p>ç”¨æœºå™¨å­¦ä¹ çš„è¯­è¨€æ¥è¯´å°±æ˜¯ï¼Œä¸ºäº†åŒºåˆ†å››ç±»åŠ¨ç‰©ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸‰ä¸ªç‰¹å¾ï¼ˆâ€œæœ‰æ²¡æœ‰ç¾½æ¯›â€ â€œä¼šä¸ä¼šé£žâ€å’Œâ€œæœ‰æ²¡æœ‰é³â€ï¼‰æ¥æž„å»ºä¸€ä¸ªæ¨¡åž‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç›‘ç£å­¦ä¹ ä»Žæ•°æ®ä¸­å­¦ä¹ æ¨¡åž‹ï¼Œè€Œæ— éœ€äººä¸ºæž„å»ºæ¨¡åž‹ã€‚</p><a id="more"></a><h1 id="æž„é€ å†³ç­–æ ‘">æž„é€ å†³ç­–æ ‘</h1><p>æˆ‘ä»¬åœ¨ä¸€ä¸ªäºŒç»´åˆ†ç±»æ•°æ®é›†<code>two_moons</code>ä¸Šæž„é€ å†³ç­–æ ‘ã€‚è¿™ä¸ªæ•°æ®é›†ç”±2ä¸ªåŠæœˆå½¢ç»„æˆï¼Œæ¯ä¸ªç±»åˆ«éƒ½åŒ…å«50ä¸ªæ•°æ®ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_tree_progressive()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-two-moons.png"></p><p>å­¦ä¹ å†³ç­–æ ‘ï¼Œå°±æ˜¯å­¦ä¹ ä¸€ç³»åˆ—if/elseé—®é¢˜ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä»¥æœ€å¿«çš„é€Ÿåº¦å¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œè¿™äº›é—®é¢˜å«ä½œæµ‹è¯•ã€‚æ•°æ®é€šå¸¸å¹¶ä¸æ˜¯åƒåŠ¨ç‰©çš„ä¾‹å­é‚£æ ·å…·æœ‰äºŒå…ƒç‰¹å¾ï¼ˆæ˜¯/å¦ï¼‰çš„å½¢å¼ï¼Œè€Œæ˜¯è¡¨ç¤ºä¸ºè¿žç»­ç‰¹å¾ã€‚ç”¨äºŽè¿žç»­æ•°æ®çš„æµ‹è¯•å½¢å¼æ˜¯ï¼šâ€ç‰¹å¾içš„å€¼æ˜¯å¦å¤§äºŽaï¼Ÿâ€œ</p><p>ä¸ºäº†æž„é€ å†³ç­–æ ‘ï¼Œç®—æ³•æœéæ‰€æœ‰å¯èƒ½çš„æµ‹è¯•ï¼Œæ‰¾å‡ºå¯¹ç›®æ ‡å˜é‡æ¥è¯´ä¿¡æ¯é‡æœ€å¤§çš„é‚£ä¸€ä¸ªã€‚ä¸‹å›¾å±•ç¤ºäº†é€‰å‡ºçš„ç¬¬ä¸€ä¸ªæµ‹è¯•ã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/depth-1-decision-tree-on-two-moons.png"></p><p>å°†æ•°æ®é›†åœ¨x[1]=0.0596å¤„åž‚ç›´åˆ’åˆ†å¯ä»¥å¾—åˆ°æœ€å¤šçš„ä¿¡æ¯ï¼Œå®ƒåœ¨æœ€å¤§ç¨‹åº¦ä¸Šå°†ç±»åˆ«0ä¸­çš„ç‚¹ä¸Žç±»åˆ«1ä¸­çš„ç‚¹è¿›è¡ŒåŒºåˆ†ã€‚é¡¶ç»“ç‚¹ï¼ˆä¹Ÿå«æ ¹ç»“ç‚¹ï¼‰è¡¨ç¤ºæ•´ä¸ªæ•°æ®é›†ã€‚é€šè¿‡æµ‹è¯•x[1]&lt;=0.0596çš„çœŸå‡æ¥å¯¹æ•°æ®é›†è¿›è¡Œåˆ’åˆ†ï¼Œåœ¨å›¾ä¸­è¡¨ç¤ºä¸ºä¸€æ¡é»‘çº¿ã€‚å¦‚æžœæµ‹è¯•ç»“æžœä¸ºçœŸï¼Œé‚£ä¹ˆå°†è¿™ä¸ªç‚¹åˆ†é…ç»™å·¦ç»“ç‚¹ï¼Œå·¦ç»“ç‚¹é‡ŒåŒ…å«å±žäºŽç±»åˆ«0çš„2ä¸ªç‚¹å’Œå±žäºŽç±»åˆ«1çš„32ä¸ªç‚¹ã€‚å¦åˆ™å°†è¿™ä¸ªç‚¹åˆ†é…ç»™å³ç»“ç‚¹ã€‚è¿™ä¸¤ä¸ªç»“ç‚¹å¯¹åº”å›¾ä¸­çš„é¡¶éƒ¨åŒºåŸŸå’Œåº•éƒ¨åŒºåŸŸã€‚å°½ç®¡ç¬¬ä¸€æ¬¡åˆ’åˆ†å·²ç»å¯¹ä¸¤ä¸ªç±»åˆ«åšäº†å¾ˆå¥½çš„åŒºåˆ†ï¼Œä½†åº•éƒ¨åŒºåŸŸä»åŒ…å«å±žäºŽç±»åˆ«0çš„ç‚¹ï¼Œé¡¶éƒ¨åŒºåŸŸä¹Ÿä»åŒ…å«å±žäºŽç±»åˆ«1çš„ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªåŒºåŸŸä¸­é‡å¤å¯»æ‰¾æœ€ä½³æµ‹è¯•çš„è¿‡ç¨‹ï¼Œä»Žè€Œæž„å»ºå‡ºæ›´å‡†ç¡®çš„æ¨¡åž‹ã€‚ä¸‹å›¾å±•ç¤ºäº†ä¿¡æ¯é‡æœ€å¤§çš„ä¸‹ä¸€æ¬¡åˆ’åˆ†ï¼Œè¿™æ¬¡åˆ’åˆ†æ˜¯åŸºäºŽx[0]åšå‡ºçš„ï¼Œåˆ†ä¸ºå·¦å³ä¸¤ä¸ªåŒºåŸŸã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/depth-2-decision-tree-on-two-moons.png"></p><p>è¿™ä¸€é€’å½’è¿‡ç¨‹ç”Ÿæˆä¸€æ£µäºŒå…ƒå†³ç­–æ ‘ï¼Œå…¶ä¸­æ¯ä¸ªç»“ç‚¹éƒ½åŒ…å«ä¸€ä¸ªæµ‹è¯•ã€‚ç”±äºŽæ¯ä¸ªæµ‹è¯•ä»…å…³æ³¨ä¸€ä¸ªç‰¹å¾ï¼Œæ‰€ä»¥åˆ’åˆ†åŽçš„åŒºåŸŸè¾¹ç•Œå§‹ç»ˆä¸Žåæ ‡è½´å¹³è¡Œã€‚</p><p>å¯¹æ•°æ®åå¤è¿›è¡Œé€’å½’åˆ’åˆ†ï¼Œç›´åˆ°åˆ’åˆ†åŽçš„æ¯ä¸ªåŒºåŸŸï¼ˆå†³ç­–æ ‘çš„æ¯ä¸ªå¶ç»“ç‚¹ï¼‰åªåŒ…å«å•ä¸€ç›®æ ‡å€¼ï¼ˆå•ä¸€ç±»åˆ«æˆ–å•ä¸€å›žå½’å€¼ï¼‰ã€‚å¦‚æžœæ ‘ä¸­æŸä¸ªå¶ç»“ç‚¹æ‰€åŒ…å«æ•°æ®ç‚¹çš„ç›®æ ‡å€¼éƒ½ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå¶ç»“ç‚¹å°±æ˜¯çº¯çš„ï¼ˆpureï¼‰ã€‚è¿™ä¸ªæ•°æ®é›†çš„æœ€ç»ˆåˆ’åˆ†å¦‚ä¸‹å›¾ã€‚æƒ³è¦å¯¹æ–°æ•°æ®ç‚¹è¿›è¡Œé¢„æµ‹ï¼Œé¦–å…ˆè¦æŸ¥çœ‹è¿™ä¸ªç‚¹ä½äºŽç‰¹å¾ç©ºé—´åˆ’åˆ†çš„å“ªä¸ªåŒºåŸŸï¼Œç„¶åŽå°†è¯¥åŒºåŸŸçš„å¤šæ•°ç›®æ ‡å€¼ä½œä¸ºé¢„æµ‹ç»“æžœã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/depth-9-decision-tree-on-two-moons.png"></p><p>å†³ç­–æ ‘ä¹Ÿå¯ä»¥ç”¨äºŽå›žå½’ä»»åŠ¡ï¼Œä½¿ç”¨çš„æ–¹æ³•å®Œå…¨ç›¸åŒã€‚é¢„æµ‹çš„æ–¹æ³•æ˜¯ï¼ŒåŸºäºŽæ¯ä¸ªç»“ç‚¹çš„æµ‹è¯•å¯¹æ ‘è¿›è¡ŒéåŽ†ï¼Œæœ€ç»ˆæ‰¾åˆ°æ–°æ•°æ®ç‚¹æ‰€å±žçš„å¶ç»“ç‚¹ã€‚è¿™ä¸€æ•°æ®ç‚¹çš„è¾“å‡ºå³ä¸ºæ­¤å¶ç»“ç‚¹ä¸­æ‰€æœ‰è®­ç»ƒç‚¹çš„å¹³å‡ç›®æ ‡å€¼ã€‚</p><h1 id="æŽ§åˆ¶å†³ç­–æ ‘çš„å¤æ‚åº¦">æŽ§åˆ¶å†³ç­–æ ‘çš„å¤æ‚åº¦</h1><p>é€šå¸¸æ¥è¯´ï¼Œæž„é€ å†³ç­–æ ‘ç›´åˆ°æ‰€æœ‰å¶ç»“ç‚¹éƒ½æ˜¯çº¯çš„å¶ç»“ç‚¹ï¼Œè¿™ä¼šå¯¼è‡´æ¨¡åž‹éžå¸¸å¤æ‚ï¼Œå¹¶ä¸”å¯¹è®­ç»ƒæ•°æ®é«˜åº¦è¿‡æ‹Ÿåˆã€‚çº¯å¶ç»“ç‚¹çš„å­˜åœ¨è¯´æ˜Žè¿™æ£µæ ‘åœ¨è®­ç»ƒé›†ä¸Šçš„ç²¾åº¦æ˜¯100%ã€‚è®­ç»ƒé›†ä¸­çš„æ¯ä¸ªæ•°æ®ç‚¹éƒ½ä½äºŽåˆ†ç±»æ­£ç¡®çš„å¶ç»“ç‚¹ä¸­ã€‚åœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºè¿‡æ‹Ÿåˆï¼Œåœ¨æ‰€æœ‰å±žäºŽç±»åˆ«0çš„ç‚¹ä¸­æœ‰ä¸€å—å±žäºŽç±»åˆ«1çš„åŒºåŸŸã€‚å¦ä¸€æ–¹é¢ï¼Œæœ‰ä¸€å°æ¡å±žäºŽç±»åˆ«0çš„åŒºåŸŸï¼ŒåŒ…å›´ç€æœ€å³ä¾§å±žäºŽç±»åˆ«0çš„é‚£ä¸ªç‚¹ã€‚è¿™å¹¶ä¸æ˜¯äººä»¬æƒ³è±¡ä¸­å†³ç­–è¾¹ç•Œçš„æ ·å­ï¼Œè¿™ä¸ªå†³ç­–è¾¹ç•Œè¿‡äºŽå…³æ³¨è¿œç¦»åŒç±»åˆ«å…¶ä»–ç‚¹çš„å•ä¸ªå¼‚å¸¸ç‚¹ã€‚</p><p>é˜²æ­¢è¿‡æ‹Ÿåˆæœ‰ä¸¤ç§å¸¸è§ç­–ç•¥ï¼šä¸€ç§æ˜¯åŠæ—©åœæ­¢æ ‘çš„ç”Ÿé•¿ï¼Œä¹Ÿå«<strong>é¢„å‰ªæž</strong>ï¼ˆpre-pruningï¼‰ï¼›å¦ä¸€ç§æ˜¯å…ˆæž„é€ æ ‘ï¼Œä½†éšåŽåˆ é™¤æˆ–æŠ˜å ä¿¡æ¯é‡å¾ˆå°‘çš„ç»“ç‚¹ï¼Œä¹Ÿå«<strong>åŽå‰ªæž</strong>ï¼ˆpost-pruningï¼‰æˆ–<strong>å‰ªæž</strong>ï¼ˆpruningï¼‰ã€‚é¢„å‰ªæžçš„é™åˆ¶æ¡ä»¶å¯èƒ½åŒ…å«é™åˆ¶æ ‘çš„æœ€å¤§æ·±åº¦ã€é™åˆ¶å¶ç»“ç‚¹çš„æœ€å¤§æ•°ç›®ï¼Œæˆ–è€…è§„å®šä¸€ä¸ªç»“ç‚¹ä¸­æ•°æ®ç‚¹çš„æœ€å°æ•°ç›®æ¥é˜²æ­¢ç»§ç»­åˆ’åˆ†ã€‚</p><p>æˆ‘ä»¬åœ¨ä¹³è…ºç™Œæ•°æ®é›†ä¸Šæ›´è¯¦ç»†åœ°çœ‹ä¸€ä¸‹é¢„å‰ªæžçš„æ•ˆæžœã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.tree.decisiontreeclassifier" target="_blank" rel="noopener"><code>class sklearn.tree.DecisionTreeClassifier(criterion=â€™giniâ€™, splitter=â€™bestâ€™, max_depth=None, min_samples_split=2, min_samples_leaf=1, min_weight_fraction_leaf=0.0, max_features=None, random_state=None, max_leaf_nodes=None, min_impurity_decrease=0.0, min_impurity_split=None, class_weight=None, presort=False)</code></a></p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(cancer.data,</span><br><span class="line">    cancer.target, stratify=cancer.target, random_state=<span class="number">42</span>)</span><br><span class="line">tree = DecisionTreeClassifier(random_state=<span class="number">0</span>)  <span class="comment"># é»˜è®¤å°†æ ‘å®Œå…¨å±•å¼€ï¼ˆæ‰€æœ‰å¶ç»“ç‚¹éƒ½æ˜¯çº¯çš„ï¼‰</span></span><br><span class="line">tree.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(tree.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(tree.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 1.000</span><br><span class="line">Accuracy on test set: 0.937</span><br></pre></td></tr></table></figure><p>ä¸å‡ºæ‰€æ–™ï¼Œè®­ç»ƒé›†ä¸Šçš„ç²¾åº¦æ˜¯100%ï¼Œè¿™æ˜¯å› ä¸ºå¶ç»“ç‚¹éƒ½æ˜¯çº¯çš„ï¼Œæ ‘çš„æ·±åº¦å¾ˆå¤§ï¼Œè¶³ä»¥å®Œç¾Žåœ°è®°ä½è®­ç»ƒæ•°æ®çš„æ‰€æœ‰æ ‡ç­¾ã€‚æµ‹è¯•é›†ç²¾åº¦æ¯”çº¿æ€§æ¨¡åž‹ç•¥ä½Žï¼Œçº¿æ€§æ¨¡åž‹çš„ç²¾åº¦çº¦ä¸º95%ã€‚</p><p>å¦‚æžœæˆ‘ä»¬ä¸é™åˆ¶å†³ç­–æ ‘çš„æ·±åº¦ï¼Œå®ƒçš„æ·±åº¦å’Œå¤æ‚åº¦éƒ½å¯ä»¥å˜å¾—ç‰¹åˆ«å¤§ã€‚å› æ­¤ï¼Œæœªå‰ªæžçš„æ ‘å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œå¯¹æ–°æ•°æ®çš„æ³›åŒ–èƒ½åŠ›ä¸ä½³ã€‚çŽ°åœ¨æˆ‘ä»¬å°†é¢„å‰ªæžåº”ç”¨åœ¨å†³ç­–æ ‘ä¸Šï¼Œè¿™å¯ä»¥åœ¨å®Œç¾Žæ‹Ÿåˆè®­ç»ƒæ•°æ®ä¹‹å‰é˜»æ­¢æ ‘çš„å±•å¼€ã€‚ä¸€ç§é€‰æ‹©æ˜¯åœ¨åˆ°è¾¾ä¸€å®šæ·±åº¦åŽåœæ­¢æ ‘çš„å±•å¼€ã€‚è¿™é‡Œæˆ‘ä»¬è®¾ç½®<code>max_depth=4</code>ï¼Œè¿™æ„å‘³ç€åªå¯ä»¥è¿žç»­é—®4ä¸ªé—®é¢˜ã€‚é™åˆ¶æ ‘çš„æ·±åº¦å¯ä»¥å‡å°‘è¿‡æ‹Ÿåˆã€‚è¿™ä¼šé™ä½Žè®­ç»ƒé›†çš„ç²¾åº¦ï¼Œä½†å¯ä»¥æé«˜æµ‹è¯•é›†çš„ç²¾åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tree = DecisionTreeClassifier(max_depth=<span class="number">4</span>, random_state=<span class="number">0</span>)</span><br><span class="line">tree.fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Accuracy on training set: &#123;:.3f&#125;'</span>.format(tree.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Accuracy on test set: &#123;:.3f&#125;'</span>.format(tree.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Accuracy on training set: 0.988</span><br><span class="line">Accuracy on test set: 0.951</span><br></pre></td></tr></table></figure><h1 id="åˆ†æžå†³ç­–æ ‘">åˆ†æžå†³ç­–æ ‘</h1><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨treeæ¨¡å—çš„export_graphvizå‡½æ•°æ¥å°†æ ‘å¯è§†åŒ–ã€‚è¿™ä¸ªå‡½æ•°ä¼šç”Ÿæˆä¸€ä¸ª.dotæ ¼å¼çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºŽä¿å­˜å›¾å½¢çš„æ–‡æœ¬æ–‡ä»¶æ ¼å¼ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.tree.export_graphviz#sklearn.tree.export_graphviz" target="_blank" rel="noopener"><code>sklearn.tree.export_graphviz(decision_tree, out_file=None, max_depth=None, feature_names=None, class_names=None, label=â€™allâ€™, filled=False, leaves_parallel=False, impurity=True, node_ids=False, proportion=False, rotate=False, rounded=False, special_characters=False, precision=3)</code></a></p><p>Export a decision tree in DOT format.</p><p>This function generates a GraphViz representation of the decision tree, which is then written into <code>out_file</code>. Once exported, graphical renderings can be generated using, for example:</p><p><code>$ dot -Tps tree.dot -o tree.ps      (PostScript format)</code></p><p><code>$ dot -Tpng tree.dot -o tree.png    (PNG format)</code></p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> export_graphviz</span><br><span class="line">export_graphviz(tree, out_file=<span class="string">'tree.dot'</span>, class_names=[<span class="string">'malignant'</span>, <span class="string">'benign'</span>],</span><br><span class="line">    feature_names=cancer.feature_names, impurity=<span class="literal">False</span>, filled=<span class="literal">True</span>)</span><br><span class="line">t = graphviz.render(engine=<span class="string">'dot'</span>, format=<span class="string">'svg'</span>, filepath=<span class="string">'tree.dot'</span>)</span><br><span class="line">graphviz.view(t)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-tree-on-breast-cancer.svg"></p><p>æ ‘çš„å¯è§†åŒ–æœ‰åŠ©äºŽæ·±å…¥ç†è§£ç®—æ³•æ˜¯å¦‚ä½•è¿›è¡Œé¢„æµ‹çš„ï¼Œä¹Ÿæ˜¯æ˜“äºŽå‘éžä¸“å®¶è§£é‡Šçš„æœºå™¨å­¦ä¹ ç®—æ³•çš„ä¼˜ç§€ç¤ºä¾‹ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿™é‡Œæ ‘çš„æ·±åº¦åªæœ‰4å±‚ï¼Œä¹Ÿæœ‰ç‚¹å¤ªå¤§äº†ã€‚æ·±åº¦æ›´å¤§çš„æ ‘ï¼ˆæ·±åº¦ä¸º10å¹¶ä¸ç½•è§ï¼‰æ›´åŠ éš¾ä»¥ç†è§£ã€‚ä¸€ç§è§‚å¯Ÿæ ‘çš„æ–¹æ³•å¯èƒ½æœ‰ç”¨ï¼Œå°±æ˜¯æ‰¾å‡ºå¤§éƒ¨åˆ†æ•°æ®çš„å®žé™…è·¯å¾„ã€‚ä¸Šå›¾ä¸­æ¯ä¸ªç»“ç‚¹çš„samplesç»™å‡ºäº†è¯¥ç»“ç‚¹ä¸­çš„æ ·æœ¬ä¸ªæ•°ï¼Œvaluesç»™å‡ºçš„æ˜¯æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬ä¸ªæ•°ã€‚è§‚å¯Ÿæ ¹ç»“ç‚¹å³ä¾§çš„å­ç»“ç‚¹ï¼Œæˆ‘ä»¬å‘çŽ°å®ƒåªåŒ…å«8ä¸ªè‰¯æ€§æ ·æœ¬ï¼Œä½†æœ‰134ä¸ªæ¶æ€§æ ·æœ¬ã€‚æ ‘çš„è¿™ä¸€ä¾§çš„å…¶ä½™åˆ†æ”¯åªæ˜¯åˆ©ç”¨ä¸€äº›æ›´ç²¾ç»†çš„åŒºåˆ«å°†è¿™8ä¸ªè‰¯æ€§æ ·æœ¬åˆ†ç¦»å‡ºæ¥ã€‚</p><p>å†æ¥çœ‹ä¸€ä¸‹æ ¹ç»“ç‚¹å·¦ä¾§å­ç»“ç‚¹ï¼Œæˆ‘ä»¬å¾—åˆ°25ä¸ªæ¶æ€§æ ·æœ¬å’Œ259ä¸ªè‰¯æ€§æ ·æœ¬ã€‚å‡ ä¹Žæ‰€æœ‰çš„è‰¯æ€§æ ·æœ¬ï¼ˆ259ä¸ªä¸­çš„245ä¸ªï¼‰æœ€ç»ˆéƒ½è¿›å…¥å·¦ä¾§ç¬¬äºŒä¸ªå¶ç»“ç‚¹ä¸­ï¼Œå¤§éƒ¨åˆ†å…¶ä»–å¶ç»“ç‚¹éƒ½åªåŒ…å«å¾ˆå°‘çš„æ ·æœ¬ã€‚</p><h1 id="æ ‘çš„ç‰¹å¾é‡è¦æ€§">æ ‘çš„ç‰¹å¾é‡è¦æ€§</h1><p>æŸ¥çœ‹æ•´ä¸ªæ ‘å¯èƒ½éžå¸¸è´¹åŠ²ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ä¸€äº›æœ‰ç”¨çš„å±žæ€§æ¥æ€»ç»“æ ‘çš„å·¥ä½œåŽŸç†ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯<strong>ç‰¹å¾é‡è¦æ€§</strong>ï¼ˆfeature importanceï¼‰ï¼Œå®ƒä¸ºæ¯ä¸ªç‰¹å¾å¯¹æ ‘çš„å†³ç­–çš„é‡è¦æ€§è¿›è¡ŒæŽ’åºã€‚å¯¹äºŽæ¯ä¸ªç‰¹å¾æ¥è¯´ï¼Œå®ƒéƒ½æ˜¯ä¸€ä¸ªä»‹äºŽ0å’Œ1ä¹‹é—´çš„æ•°å­—ï¼Œå…¶ä¸­0è¡¨ç¤ºâ€æ ¹æœ¬æ²¡ç”¨åˆ°â€œï¼Œ1è¡¨ç¤ºâ€å®Œç¾Žé¢„æµ‹ç›®æ ‡å€¼â€œã€‚ç‰¹å¾é‡è¦æ€§çš„æ±‚å’Œå§‹ç»ˆä¸º1:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Feature importrances:\n&#123;&#125;'</span>.format(tree.feature_importances_))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_feature_importances_cancer</span><span class="params">(model)</span>:</span></span><br><span class="line">    n_features = cancer.data.shape[<span class="number">1</span>]</span><br><span class="line">    plt.barh(range(n_features), model.feature_importances_, align=<span class="string">'center'</span>)</span><br><span class="line">    plt.yticks(np.arange(n_features), cancer.feature_names)</span><br><span class="line">    plt.xlabel(<span class="string">'Feature importance'</span>)</span><br><span class="line">    plt.ylabel(<span class="string">'Feature'</span>)</span><br><span class="line"></span><br><span class="line">plot_feature_importances_cancer(tree)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Feature importrances:</span><br><span class="line">[0.         0.         0.         0.         0.         0.</span><br><span class="line"> 0.         0.         0.         0.         0.01019737 0.04839825</span><br><span class="line"> 0.         0.         0.0024156  0.         0.         0.</span><br><span class="line"> 0.         0.         0.72682851 0.0458159  0.         0.</span><br><span class="line"> 0.0141577  0.         0.018188   0.1221132  0.01188548 0.        ]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/feature-importances-of-tree.png"></p><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ï¼Œé¡¶éƒ¨åˆ’åˆ†ç”¨åˆ°çš„ç‰¹å¾ï¼ˆ&quot;worst radius&quot;ï¼‰æ˜¯æœ€é‡è¦çš„ç‰¹å¾ã€‚è¿™ä¹Ÿè¯å®žäº†æˆ‘ä»¬åœ¨åˆ†æžæ ‘æ—¶çš„è§‚å¯Ÿç»“è®ºï¼Œå³ç¬¬ä¸€å±‚åˆ’åˆ†å·²ç»å°†ä¸¤ä¸ªç±»åˆ«åŒºåˆ†å¾—å¾ˆå¥½ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æžœæŸä¸ªç‰¹å¾çš„feature_importances_å¾ˆå°ï¼Œå¹¶ä¸èƒ½è¯´æ˜Žè¿™ä¸ªç‰¹å¾æ²¡æœ‰æä¾›ä»»ä½•ä¿¡æ¯ã€‚è¿™åªèƒ½è¯´æ˜Žè¯¥ç‰¹å¾æ²¡æœ‰è¢«æ ‘é€‰ä¸­ï¼Œå¯èƒ½æ˜¯å› ä¸ºå¦ä¸€ä¸ªç‰¹å¾ä¹ŸåŒ…å«äº†åŒæ ·çš„ä¿¡æ¯ã€‚</p><p>ä¸Žçº¿æ€§æ¨¡åž‹çš„ç³»æ•°ä¸åŒï¼Œç‰¹å¾çš„é‡è¦æ€§å§‹ç»ˆä¸ºæ­£æ•°ï¼Œä¹Ÿä¸èƒ½è¯´æ˜Žè¯¥ç‰¹å¾å¯¹åº”å“ªä¸ªç±»åˆ«ã€‚ç‰¹å¾é‡è¦æ€§å‘Šè¯‰æˆ‘ä»¬&quot;worst radius&quot;ï¼ˆæœ€å¤§åŠå¾„ï¼‰ç‰¹å¾å¾ˆé‡è¦ï¼Œä½†å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬åŠå¾„å¤§è¡¨ç¤ºæ ·æœ¬æ˜¯è‰¯æ€§è¿˜æ˜¯æ¶æ€§ã€‚äº‹å®žä¸Šï¼Œåœ¨ç‰¹ä¾‹å’Œç±»åˆ«ä¹‹é—´å¯èƒ½æ²¡æœ‰è¿™æ ·çš„ç®€å•å…³ç³»ï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tree = mglearn.plots.plot_tree_not_monotone()  <span class="comment"># ä¼šç”Ÿæˆmytree.dotæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p><code>$ dot -Tpng mytree.dot -o tree-not-monotone.png</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Feature importances: [0. 1.]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-not-monotone.png"></p><p><img src="/uploads/image/introduction-to-ml-with-python/tree-not-monotone.png"></p><p>è¯¥å›¾æ˜¾ç¤ºçš„æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾å’Œä¸¤ä¸ªç±»åˆ«çš„æ•°æ®é›†ã€‚è¿™é‡Œæ‰€æœ‰ä¿¡æ¯éƒ½åŒ…å«åœ¨x[1]ä¸­ï¼Œæ²¡æœ‰ç”¨åˆ°x[0]ã€‚ä½†x[1]å’Œè¾“å‡ºç±»åˆ«ä¹‹é—´å¹¶ä¸æ˜¯å•è°ƒå…³ç³»ï¼Œå³æˆ‘ä»¬ä¸èƒ½è¿™ä¹ˆè¯´ï¼šâ€œè¾ƒå¤§çš„x[1]å¯¹åº”ç±»åˆ«0ï¼Œè¾ƒå°çš„x[1]å¯¹åº”ç±»åˆ«1â€œï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚</p><h1 id="ç”¨äºŽå›žå½’çš„å†³ç­–æ ‘">ç”¨äºŽå›žå½’çš„å†³ç­–æ ‘</h1><p>è™½ç„¶æˆ‘ä»¬ä¸»è¦è®¨è®ºçš„æ˜¯ç”¨äºŽåˆ†ç±»çš„å†³ç­–æ ‘ï¼Œä½†å¯¹ç”¨äºŽå›žå½’çš„å†³ç­–æ ‘æ¥è¯´ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåœ¨DecisionTreeRegressorä¸­å®žçŽ°ã€‚å›žå½’æ ‘çš„ç”¨æ³•å’Œåˆ†æžä¸Žåˆ†ç±»æ ‘éžå¸¸ç±»ä¼¼ã€‚ä½†åœ¨å°†åŸºäºŽæ ‘çš„æ¨¡åž‹ç”¨äºŽå›žå½’æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦æŒ‡å‡ºå®ƒçš„ä¸€ä¸ªç‰¹æ®Šæ€§è´¨ã€‚DecisionTreeRegressorï¼ˆä»¥åŠå…¶ä»–æ‰€æœ‰åŸºäºŽæ ‘çš„å›žå½’æ¨¡åž‹ï¼‰ä¸èƒ½<strong>å¤–æŽ¨</strong>ï¼ˆextrapolateï¼‰ï¼Œä¹Ÿä¸èƒ½åœ¨è®­ç»ƒæ•°æ®èŒƒå›´ä¹‹å¤–è¿›è¡Œé¢„æµ‹ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.tree.decisiontreeregressor" target="_blank" rel="noopener"><code>class sklearn.tree.DecisionTreeRegressor(criterion=â€™mseâ€™, splitter=â€™bestâ€™, max_depth=None, min_samples_split=2, min_samples_leaf=1, min_weight_fraction_leaf=0.0, max_features=None, random_state=None, max_leaf_nodes=None, min_impurity_decrease=0.0, min_impurity_split=None, presort=False)</code></a></p></blockquote><p>æˆ‘ä»¬åˆ©ç”¨è®¡ç®—æœºå†…å­˜ï¼ˆRAMï¼‰åŽ†å²ä»·æ ¼çš„æ•°æ®é›†æ¥æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™ä¸€ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">ram_prices = pd.read_csv(os.path.join(mglearn.datasets.DATA_PATH, <span class="string">"ram_price.csv"</span>))</span><br><span class="line"></span><br><span class="line">plt.semilogy(ram_prices.date, ram_prices.price)</span><br><span class="line">plt.xlabel(<span class="string">"Year"</span>)</span><br><span class="line">plt.ylabel(<span class="string">"Price in $/Mbyte"</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/ram-price.png"></p><p>æ³¨æ„yè½´çš„å¯¹æ•°åˆ»åº¦ã€‚åœ¨ç”¨å¯¹æ•°åæ ‡è½´ç»˜å›¾æ—¶ï¼ŒäºŒè€…çš„çº¿æ€§å…³ç³»çœ‹èµ·æ¥éžå¸¸å¥½ï¼Œæ‰€ä»¥é¢„æµ‹åº”è¯¥ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“ï¼Œé™¤äº†ä¸€äº›ä¸å¹³æ»‘ä¹‹å¤„ä¹‹å¤–ã€‚</p><p>æˆ‘ä»¬å°†åˆ©ç”¨2000å¹´å‰çš„åŽ†å²æ•°æ®æ¥é¢„æµ‹2000å¹´åŽçš„ä»·æ ¼ï¼Œåªç”¨æ—¥æœŸä½œä¸ºç‰¹å¾ã€‚æˆ‘ä»¬å°†å¯¹æ¯”ä¸¤ä¸ªç®€å•çš„æ¨¡åž‹ï¼šDecisionTreeRegressorå’ŒLinearRegressionã€‚æˆ‘ä»¬å¯¹ä»·æ ¼å–å¯¹æ•°ï¼Œä½¿å¾—äºŒè€…å…³ç³»çš„çº¿æ€§ç›¸å¯¹æ›´å¥½ã€‚è¿™å¯¹DecisionTreeRegressorä¸ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Œä½†å¯¹LinearRegressionçš„å½±å“å´å¾ˆå¤§ã€‚è®­ç»ƒæ¨¡åž‹å¹¶ä½œå‡ºé¢„æµ‹ä¹‹åŽï¼Œæˆ‘ä»¬åº”ç”¨æŒ‡æ•°æ˜ å°„æ¥åšå¯¹æ•°å˜æ¢çš„ä½ è¿ç®—ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeRegressor</span><br><span class="line"><span class="comment"># åˆ©ç”¨åŽ†å²æ•°æ®é¢„æµ‹2000å¹´åŽçš„ä»·æ ¼</span></span><br><span class="line">data_train = ram_prices[ram_prices.date &lt; <span class="number">2000</span>]</span><br><span class="line">data_test = ram_prices[ram_prices.date &gt;= <span class="number">2000</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºäºŽæ—¥æœŸæ¥é¢„æµ‹ä»·æ ¼</span></span><br><span class="line">X_train = data_train.date[:, np.newaxis]</span><br><span class="line"><span class="comment"># we use a log-transform to get a simpler relationship of data to target</span></span><br><span class="line">y_train = np.log(data_train.price)</span><br><span class="line"></span><br><span class="line">tree = DecisionTreeRegressor(max_depth=<span class="number">3</span>).fit(X_train, y_train)</span><br><span class="line">linear_reg = LinearRegression().fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œé¢„æµ‹</span></span><br><span class="line">X_all = ram_prices.date[:, np.newaxis]</span><br><span class="line"></span><br><span class="line">pred_tree = tree.predict(X_all)</span><br><span class="line">pred_lr = linear_reg.predict(X_all)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ•°å˜æ¢é€†è¿ç®—</span></span><br><span class="line">price_tree = np.exp(pred_tree)</span><br><span class="line">price_lr = np.exp(pred_lr)</span><br><span class="line"></span><br><span class="line">plt.semilogy(data_train.date, data_train.price, label=<span class="string">"Training data"</span>)</span><br><span class="line">plt.semilogy(data_test.date, data_test.price, label=<span class="string">"Test data"</span>)</span><br><span class="line">plt.semilogy(ram_prices.date, price_tree, label=<span class="string">"Tree prediction"</span>)</span><br><span class="line">plt.semilogy(ram_prices.date, price_lr, label=<span class="string">"Linear prediction"</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-regression-and-decision-tree-on-ram-price.png"></p><p>ä¸¤ä¸ªæ¨¡åž‹ä¹‹é—´çš„å·®å¼‚éžå¸¸æ˜Žæ˜¾ã€‚çº¿æ€§æ¨¡åž‹ç”¨ä¸€æ¡ç›´çº¿å¯¹æ•°æ®åšè¿‘ä¼¼ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€çŸ¥é“çš„ã€‚è¿™æ¡çº¿å¯¹æµ‹è¯•æ•°æ®ç»™å‡ºäº†ç›¸å½“å¥½çš„é¢„æµ‹ï¼Œä¸è¿‡å¿½ç•¥äº†è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ä¸­ä¸€äº›æ›´ç»†å¾®çš„å˜åŒ–ã€‚ä¸Žä¹‹ç›¸åï¼Œæ ‘æ¨¡åž‹å®Œç¾Žé¢„æµ‹äº†è®­ç»ƒæ•°æ®ã€‚ç”±äºŽæˆ‘ä»¬æ²¡æœ‰é™åˆ¶æ ‘çš„å¤æ‚åº¦ï¼Œå› æ­¤å®ƒè®°ä½äº†æ•´ä¸ªæ•°æ®é›†ã€‚ä½†æ˜¯ä¸€æ—¦è¾“å…¥è¶…å‡ºäº†æ¨¡åž‹è®­ç»ƒæ•°æ®çš„èŒƒå›´ï¼ˆæ–°çš„é¢„æœŸä»·æ ¼æ¯”åŽ†å²æœ€ä½Žä»·æ ¼æ›´ä½Žï¼‰ï¼Œæ¨¡åž‹å°±åªèƒ½æŒç»­é¢„æµ‹æœ€åŽä¸€ä¸ªå·²çŸ¥æ•°æ®ç‚¹ã€‚æ ‘ä¸èƒ½åœ¨è®­ç»ƒæ•°æ®çš„èŒƒå›´ä¹‹å¤–ç”Ÿæˆâ€œæ–°çš„â€å“åº”ï¼Œæ‰€æœ‰åŸºäºŽæ ‘çš„æ¨¡åž‹éƒ½æœ‰è¿™ä¸ªç¼ºç‚¹ã€‚ï¼ˆå®žé™…ä¸Šï¼Œåˆ©ç”¨åŸºäºŽæ ‘çš„æ¨¡åž‹å¯ä»¥åšå‡ºéžå¸¸å¥½çš„é¢„æµ‹ï¼Œæ¯”å¦‚è¯•å›¾é¢„æµ‹ä»·æ ¼ä¼šä¸Šæ¶¨è¿˜æ˜¯ä¸‹è·Œï¼‰ã€‚è¿™ä¸ªä¾‹å­çš„ç›®çš„å¹¶ä¸æ˜¯è¦è¯´æ˜Žå¯¹æ—¶é—´åºåˆ—æ¥è¯´æ ‘æ˜¯ä¸€ä¸ªä¸å¥½çš„æ¨¡åž‹ï¼Œè€Œæ˜¯ä¸ºäº†è¯´æ˜Žæ ‘åœ¨é¢„æµ‹æ–¹å¼ä¸Šçš„ç‰¹æ®Šæ€§è´¨ã€‚ï¼‰</p><h1 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h1><p>æŽ§åˆ¶å†³ç­–æ ‘æ¨¡åž‹å¤æ‚åº¦çš„å‚æ•°æ˜¯é¢„å‰ªæžå‚æ•°ï¼Œå®ƒåœ¨æ ‘å®Œå…¨å±•å¼€ä¹‹å‰åœæ­¢æ ‘çš„æž„é€ ã€‚é€šå¸¸æ¥è¯´ï¼Œé€‰æ‹©ä¸€ç§é¢„å‰ªæžç­–ç•¥ï¼ˆè®¾ç½®<code>max_depth</code>ã€<code>max_leaf_nodes</code>æˆ–<code>min_samples_leaf</code>ï¼‰è¶³ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p><p>å†³ç­–æ ‘æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼šä¸€æ˜¯å¾—åˆ°çš„æ¨¡åž‹å¾ˆå®¹æ˜“å¯è§†åŒ–ï¼Œéžä¸“å®¶ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼ˆè‡³å°‘å¯¹äºŽè¾ƒå°çš„æ ‘è€Œè¨€ï¼‰ï¼›äºŒæ˜¯ç®—æ³•å®Œå…¨ä¸å—æ•°æ®ç¼©æ”¾çš„å½±å“ã€‚ç”±äºŽæ¯ä¸ªç‰¹å¾è¢«å•ç‹¬å¤„ç†ï¼Œè€Œä¸”æ•°æ®çš„åˆ’åˆ†ä¹Ÿä¸ä¾èµ–äºŽç¼©æ”¾ï¼Œå› æ­¤å†³ç­–æ ‘ç®—æ³•ä¸éœ€è¦ç‰¹å¾é¢„å¤„ç†ï¼Œæ¯”å¦‚å½’ä¸€åŒ–æˆ–æ ‡å‡†åŒ–ã€‚ç‰¹åˆ«æ˜¯ç‰¹å¾çš„å°ºåº¦å®Œå…¨ä¸ä¸€æ ·æ—¶æˆ–äºŒå…ƒç‰¹å¾å’Œè¿žç»­ç‰¹å¾åŒæ—¶å­˜åœ¨æ—¶ï¼Œå†³ç­–æ ‘çš„æ•ˆæžœå¾ˆå¥½ã€‚</p><p>å†³ç­–æ ‘çš„ä¸»è¦ç¼ºç‚¹åœ¨äºŽï¼šå³ä½¿åšäº†é¢„å‰ªæžï¼Œå®ƒä¹Ÿç»å¸¸ä¼šè¿‡æ‹Ÿåˆï¼Œæ³›åŒ–æ€§èƒ½å¾ˆå·®ã€‚å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°åº”ç”¨ä¸­ï¼Œå¾€å¾€ä½¿ç”¨é›†æˆæ–¹æ³•æ¥ä»£æ›¿å•æ£µå†³ç­–æ ‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
            <tag> regression </tag>
            
            <tag> classification </tag>
            
            <tag> decision tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨</title>
      <link href="/notes/introduction-to-ml-with-python/naive-bayes-classifiers/"/>
      <url>/notes/introduction-to-ml-with-python/naive-bayes-classifiers/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨">æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨</h1><p>æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨æ˜¯ä¸Žçº¿æ€§æ¨¡åž‹éžå¸¸ç›¸ä¼¼çš„ä¸€ç§åˆ†ç±»å™¨ï¼Œä½†å®ƒçš„è®­ç»ƒé€Ÿåº¦å¾€å¾€æ›´å¿«ã€‚è¿™ç§é«˜æ•ˆçŽ‡æ‰€ä»˜å‡ºçš„ä»£ä»·æ˜¯ï¼Œæœ´ç´ è´å¶æ–¯æ¨¡åž‹çš„æ³›åŒ–èƒ½åŠ›è¦æ¯”çº¿æ€§åˆ†ç±»å™¨ç¨å·®ã€‚</p><p>æœ´ç´ è´å¶æ–¯æ¨¡åž‹å¦‚æ­¤æžç¬‘çš„åŽŸå› åœ¨äºŽï¼Œå®ƒé€šè¿‡å•ç‹¬æŸ¥çœ‹æ¯ä¸ªç‰¹å¾æ¥å­¦ä¹ å‚æ•°ï¼Œå¹¶ä»Žæ¯ä¸ªç‰¹å¾ä¸­æ”¶é›†ç®€å•çš„ç±»åˆ«ç»Ÿè®¡æ•°æ®ã€‚scikit-learnä¸­å®žçŽ°äº†ä¸‰ç§æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨ï¼šGaussianNBã€BernoulliNBå’ŒMultinomialNBã€‚GaussianNBå¯åº”ç”¨äºŽä»»æ„è¿žç»­æ•°æ®ï¼Œè€ŒBernoulliNBå‡å®šè¾“å…¥æ•°æ®ä¸ºäºŒåˆ†ç±»æ•°æ®ï¼ŒMultinomialNBå‡å®šè¾“å…¥æ•°æ®ä¸ºè®¡æ•°æ•°æ®ï¼ˆå³æ¯ä¸ªç‰¹å¾ä»£è¡¨æŸä¸ªå¯¹è±¡çš„æ•´æ•°è®¡æ•°ï¼Œæ¯”å¦‚ä¸€ä¸ªå•è¯åœ¨å¥å­é‡Œå‡ºçŽ°çš„æ¬¡æ•°ï¼‰ã€‚BernoulliNBå’ŒMultinomialNBä¸»è¦ç”¨äºŽæ–‡æœ¬æ•°æ®åˆ†ç±»ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.naive_bayes.gaussiannb" target="_blank" rel="noopener"><code>class sklearn.naive_bayes.GaussianNB(priors=None, var_smoothing=1e-09)</code></a></p></blockquote><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.naive_bayes.bernoullinb" target="_blank" rel="noopener"><code>class sklearn.naive_bayes.BernoulliNB(alpha=1.0, binarize=0.0, fit_prior=True, class_prior=None)</code></a></p></blockquote><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.naive_bayes.multinomialnb" target="_blank" rel="noopener"><code>class sklearn.naive_bayes.MultinomialNB(alpha=1.0, fit_prior=True, class_prior=None)</code></a></p></blockquote><a id="more"></a><p>BernoulliNBåˆ†ç±»å™¨è®¡ç®—æ¯ä¸ªç±»åˆ«ä¸­æ¯ä¸ªç‰¹å¾ä¸ä¸º0çš„å…ƒç´ ä¸ªæ•°ã€‚ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜Žä¼šå¾ˆå®¹æ˜“ç†è§£ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],  <span class="comment"># ç¬¬1ã€3è¡Œæ•°æ®çš„ç±»åˆ«ä¸º0</span></span><br><span class="line">              [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>],    <span class="comment"># ç±»åˆ«ä¸º0çš„æ•°æ®ï¼Œç¬¬1ä¸ªç‰¹å¾çš„å€¼ä¸º1çš„ä¸ªæ•°ä¸º0ï¼Œç¬¬2ä¸ª...</span></span><br><span class="line">              [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],  <span class="comment"># ç¬¬2ã€4è¡Œæ•°æ®çš„ç±»åˆ«ä¸º1</span></span><br><span class="line">              [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]])</span><br><span class="line">y = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">counts = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> label <span class="keyword">in</span> np.unique(y):  <span class="comment"># å¯¹æ¯ä¸ªç±»è¿›è¡ŒéåŽ†</span></span><br><span class="line">    <span class="comment"># è®¡ç®—æ¯ä¸ªç‰¹å¾ä¸­1çš„ä¸ªæ•°</span></span><br><span class="line">    counts[label] = X[y == label].sum(axis=<span class="number">0</span>)</span><br><span class="line">print(<span class="string">'Feature counts:\n&#123;&#125;'</span>.format(counts))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Feature counts:</span><br><span class="line">&#123;0: array([0, 1, 0, 2]), 1: array([2, 0, 2, 1])&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸¤ç§æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨è®¡ç®—çš„ç»Ÿè®¡æ•°æ®ç±»åž‹ç•¥æœ‰ä¸åŒã€‚MultinomialNBè®¡ç®—æ¯ä¸ªç±»åˆ«ä¸­æ¯ä¸ªç‰¹å¾çš„å¹³å‡å€¼ï¼Œè€ŒGaussianNBä¼šä¿å­˜æ¯ä¸ªç±»åˆ«ä¸­æ¯ä¸ªç‰¹å¾çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®ã€‚</p><p><strong>è¦æƒ³åšå‡ºé¢„æµ‹ï¼Œéœ€è¦å°†æ•°æ®ç‚¹ä¸Žæ¯ä¸ªç±»åˆ«çš„ç»Ÿè®¡æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å°†æœ€åŒ¹é…çš„ç±»åˆ«ä½œä¸ºé¢„æµ‹ç»“æžœã€‚æœ‰è¶£çš„æ˜¯ï¼ŒMultinomialNBå’ŒBernoulliNBé¢„æµ‹å…¬å¼çš„å½¢å¼éƒ½ä¸Žçº¿æ€§æ¨¡åž‹å®Œå…¨ç›¸åŒã€‚</strong>ä¸å¹¸çš„æ˜¯ï¼Œæœ´ç´ è´å¶æ–¯æ¨¡åž‹<code>coef_</code>çš„å«ä¹‰ä¸Žçº¿æ€§æ¨¡åž‹ç¨æœ‰ä¸åŒï¼Œå› ä¸º<code>coef_</code>ä¸åŒäºŽ<span class="math inline">\(w\)</span>ã€‚</p><h1 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h1><p>MultinomialNBå’ŒBernoulliNBéƒ½åªæœ‰ä¸€ä¸ªå‚æ•°alphaï¼Œç”¨äºŽæŽ§åˆ¶æ¨¡åž‹å¤æ‚åº¦ã€‚alphaçš„å·¥ä½œåŽŸç†æ˜¯ï¼Œç®—æ³•å‘æ•°æ®ä¸­æ·»åŠ alphaè¿™ä¹ˆå¤šçš„è™šæ‹Ÿæ•°æ®ç‚¹ï¼Œè¿™äº›ç‚¹å¯¹æ‰€æœ‰ç‰¹å¾éƒ½å–æ­£å€¼ã€‚è¿™å¯ä»¥å°†ç»Ÿè®¡æ•°æ®â€œå¹³æ»‘åŒ–â€ï¼ˆsmoothingï¼‰ã€‚<strong>alphaè¶Šå¤§ï¼Œå¹³æ»‘åŒ–è¶Šå¼ºï¼Œæ¨¡åž‹å¤æ‚åº¦å°±è¶Šä½Žã€‚ç®—æ³•æ€§èƒ½å¯¹alphaå€¼çš„é²æ£’æ€§ç›¸å¯¹è¾ƒå¥½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œalphaå€¼å¯¹æ¨¡åž‹æ€§èƒ½å¹¶ä¸é‡è¦ã€‚ä½†è°ƒæ•´è¿™ä¸ªå‚æ•°é€šå¸¸éƒ½ä¼šä½¿ç²¾åº¦ç•¥æœ‰æé«˜ã€‚</strong></p><p>GaussianNBä¸»è¦ç”¨äºŽé«˜ç»´æ•°æ®ï¼Œè€Œå¦å¤–ä¸¤ç§æœ´ç´ è´å¶æ–¯æ¨¡åž‹åˆ™å¹¿æ³›ç”¨äºŽç¨€ç–è®¡æ•°æ•°æ®ï¼Œæ¯”å¦‚æ–‡æœ¬ã€‚MultinomialNBçš„æ€§èƒ½é€šå¸¸è¦ä¼˜äºŽBernoulliNBï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ…å«å¾ˆå¤šéžé›¶ç‰¹å¾çš„æ•°æ®é›†ï¼ˆå³å¤§åž‹æ–‡æ¡£ï¼‰ä¸Šã€‚</p><p>æœ´ç´ è´å¶æ–¯æ¨¡åž‹çš„è®¸å¤šä¼˜ç‚¹å’Œç¼ºç‚¹éƒ½ä¸Žçº¿æ€§æ¨¡åž‹ç›¸åŒã€‚å®ƒçš„è®­ç»ƒå’Œé¢„æµ‹é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œè®­ç»ƒè¿‡ç¨‹ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚è¯¥æ¨¡åž‹å¯¹é«˜ç»´ç¨€ç–æ•°æ®çš„æ•ˆæžœå¾ˆå¥½ï¼Œå¯¹å‚æ•°çš„é²æ£’æ€§ä¹Ÿç›¸å¯¹è¾ƒå¥½ã€‚æœ´ç´ è´å¶æ–¯æ¨¡åž‹æ˜¯å¾ˆå¥½çš„åŸºå‡†æ¨¡åž‹ï¼Œå¸¸ç”¨äºŽéžå¸¸å¤§çš„æ•°æ®é›†ï¼Œåœ¨è¿™äº›æ•°æ®é›†ä¸Šå³ä½¿è®­ç»ƒçº¿æ€§æ¨¡åž‹å¯èƒ½ä¹Ÿè¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
            <tag> classification </tag>
            
            <tag> naive bayes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ€§æ¨¡åž‹</title>
      <link href="/notes/introduction-to-ml-with-python/linear-models/"/>
      <url>/notes/introduction-to-ml-with-python/linear-models/</url>
      
        <content type="html"><![CDATA[<p>çº¿æ€§æ¨¡åž‹åˆ©ç”¨è¾“å…¥ç‰¹å¾çš„<strong>çº¿æ€§å‡½æ•°</strong>ï¼ˆlinear functionï¼‰è¿›è¡Œé¢„æµ‹ã€‚</p><h1 id="ç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹">ç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹</h1><p>å¯¹äºŽå›žå½’é—®é¢˜ï¼Œçº¿æ€§æ¨¡åž‹é¢„æµ‹çš„ä¸€èˆ¬å…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[\hat y=w[0]*x[0]+w[1]*x[1]+\dots+w[p]*x[p]+b\]</span></p><p><span class="math inline">\(x[0]\)</span> åˆ° <span class="math inline">\(x[p]\)</span> è¡¨ç¤ºå•ä¸ªæ•°æ®ç‚¹çš„ç‰¹å¾ï¼Œ<span class="math inline">\(w\)</span> å’Œ <span class="math inline">\(b\)</span> æ˜¯å­¦ä¹ æ¨¡åž‹çš„å‚æ•°ï¼Œ<span class="math inline">\(\hat y\)</span> æ˜¯æ¨¡åž‹çš„é¢„æµ‹ç»“æžœã€‚å¯¹äºŽå•ä¸€ç‰¹å¾çš„æ•°æ®é›†ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p><span class="math display">\[\hat y=w[0]*x[0]+b\]</span></p><p>è¿™å°±æ˜¯é«˜ä¸­æ•°å­¦é‡Œçš„ç›´çº¿æ–¹ç¨‹ã€‚è¿™é‡Œ <span class="math inline">\(w[0]\)</span> æ˜¯æ–œçŽ‡ï¼Œ<span class="math inline">\(b\)</span> æ˜¯yè½´åç§»ã€‚å¯¹äºŽæœ‰æ›´å¤šç‰¹å¾çš„æ•°æ®é›†ï¼Œ<span class="math inline">\(w\)</span> åŒ…å«æ²¿æ¯ä¸ªç‰¹å¾åæ ‡è½´çš„æ–œçŽ‡ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥å°†é¢„æµ‹çš„å“åº”å€¼çœ‹ä½œè¾“å…¥ç‰¹å¾çš„åŠ æƒæ±‚å’Œï¼Œæƒé‡ï¼ˆå¯ä»¥å–è´Ÿå€¼ï¼‰ç”± <span class="math inline">\(w\)</span> çš„å…ƒç´ ç»™å‡ºã€‚</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_linear_regression_wave()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">w[0]: 0.393906  b: -0.031804</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/linear-regression-on-wave.png"></p><p>ç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹å¯ä»¥è¡¨ç¤ºä¸ºè¿™æ ·çš„å›žå½’æ¨¡åž‹ï¼šå¯¹å•ä¸€ç‰¹å¾çš„é¢„æµ‹ç»“æžœæ˜¯ä¸€æ¡ç›´çº¿ï¼Œä¸¤ä¸ªç‰¹å¾æ—¶æ˜¯ä¸€ä¸ªå¹³é¢ï¼Œåœ¨æ›´é«˜ç»´åº¦æ—¶æ˜¯ä¸€ä¸ªè¶…å¹³é¢ã€‚</p><p>å¦‚æžœå°†ç›´çº¿çš„é¢„æµ‹ç»“æžœä¸ŽKNeighborsRegressorçš„é¢„æµ‹ç»“æžœè¿›è¡Œæ¯”è¾ƒï¼Œä½ ä¼šå‘çŽ°ç›´çº¿çš„é¢„æµ‹èƒ½åŠ›éžå¸¸å—é™ã€‚ä¼¼ä¹Žæ•°æ®çš„æ‰€æœ‰ç»†èŠ‚éƒ½ä¸¢å¤±äº†ã€‚ä»ŽæŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™ç§è¯´æ³•æ˜¯æ­£ç¡®çš„å‡è®¾ç›®æ ‡ <span class="math inline">\(y\)</span> æ˜¯ç‰¹å¾çš„çº¿æ€§ç»„åˆï¼Œè¿™æ˜¯ä¸€ä¸ªéžå¸¸å¼ºçš„ï¼ˆä¹Ÿæœ‰ç‚¹ä¸çŽ°å®žçš„ï¼‰å‡è®¾ã€‚<strong>è§‚å¯Ÿä¸€ç»´æ•°æ®å¾—å‡ºçš„è§‚ç‚¹æœ‰äº›ç‰‡é¢ã€‚å¯¹äºŽæœ‰å¤šä¸ªç‰¹å¾çš„æ•°æ®é›†è€Œè¨€ï¼Œçº¿æ€§æ¨¡åž‹å¯ä»¥éžå¸¸å¼ºå¤§ã€‚ç‰¹åˆ«åœ°ï¼Œå¦‚æžœç‰¹å¾æ•°é‡å¤§äºŽè®­ç»ƒæ•°æ®ç‚¹çš„æ•°é‡ï¼Œä»»ä½•ç›®æ ‡ <span class="math inline">\(y\)</span> éƒ½å¯ä»¥ï¼ˆåœ¨è®­ç»ƒé›†ä¸Šï¼‰ç”¨çº¿æ€§å‡½æ•°å®Œç¾Žæ‹Ÿåˆï¼ˆçº¿æ€§ä»£æ•°çŸ¥è¯†ï¼‰ã€‚</strong></p><p>æœ‰è®¸å¤šä¸åŒçš„çº¿æ€§å›žå½’æ¨¡åž‹ã€‚è¿™äº›æ¨¡åž‹ä¹‹é—´çš„åŒºåˆ«åœ¨äºŽå¦‚ä½•ä»Žè®­ç»ƒæ•°æ®ä¸­å­¦ä¹ å‚æ•° <span class="math inline">\(w\)</span> å’Œ <span class="math inline">\(b\)</span>ï¼Œä»¥åŠå¦‚ä½•æŽ§åˆ¶æ¨¡åž‹å¤æ‚åº¦ã€‚</p><h1 id="çº¿æ€§å›žå½’åˆåæ™®é€šæœ€å°äºŒä¹˜æ³•">çº¿æ€§å›žå½’ï¼ˆåˆåæ™®é€šæœ€å°äºŒä¹˜æ³•ï¼‰</h1><p>çº¿æ€§å›žå½’ï¼Œæˆ–è€…æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆordinary least qsquarees, OLSï¼‰ï¼Œæ˜¯å›žå½’é—®é¢˜æœ€ç®€å•ä¹Ÿæœ€ç»å…¸çš„çº¿æ€§æ–¹æ³•ã€‚çº¿æ€§å›žå½’å¯»æ‰¾å‚æ•° <span class="math inline">\(w\)</span> å’Œ <span class="math inline">\(b\)</span>ï¼Œä½¿å¾—å¯¹è®­ç»ƒé›†çš„é¢„æµ‹å€¼ä¸ŽçœŸå®žçš„å›žå½’ç›®æ ‡å€¼ <span class="math inline">\(y\)</span> ä¹‹é—´çš„<strong>å‡æ–¹è¯¯å·®</strong>æœ€å°ã€‚å‡æ–¹è¯¯å·®ï¼ˆmean squared errorï¼‰æ˜¯é¢„æµ‹å€¼ä¸ŽçœŸå®žå€¼ä¹‹å·®çš„å¹³æ–¹å’Œé™¤ä»¥æ ·æœ¬æ•°ã€‚<strong>çº¿æ€§å›žå½’æ²¡æœ‰å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜ç‚¹ï¼Œä½†ä¹Ÿå› æ­¤æ— æ³•æŽ§åˆ¶æ¨¡åž‹çš„å¤æ‚åº¦ã€‚</strong></p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.linear_model.linearregression" target="_blank" rel="noopener"><code>class sklearn.linear_model.LinearRegression(fit_intercept=True, normalize=False, copy_X=True, n_jobs=None)</code></a></p><p>Ordinary least squares Linear Regression.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line">X, y = mglearn.datasets.make_wave(n_samples=<span class="number">60</span>)</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">lr = LinearRegression().fit(X_train, y_train)</span><br><span class="line"><span class="comment"># scikit-learnæ€»æ˜¯å°†ä»Žè®­ç»ƒæ•°æ®ä¸­å¾—å‡ºçš„å€¼ä¿å­˜åœ¨ä»¥ä¸‹åˆ’çº¿ç»“å°¾çš„å±žæ€§ä¸­ï¼Œå°†å…¶ä¸Žç”¨æˆ·è®¾ç½®çš„å‚æ•°åŒºåˆ†å¼€</span></span><br><span class="line">print(<span class="string">'lr.coef_: &#123;&#125;'</span>.format(lr.coef_))  <span class="comment"># â€œæ–œçŽ‡â€wè¢«ä¿å­˜åœ¨coef_å±žæ€§ä¸­</span></span><br><span class="line">print(<span class="string">'lr.intercept_: &#123;&#125;'</span>.format(lr.intercept_))  <span class="comment"># â€œæˆªè·â€bè¢«ä¿å­˜åœ¨intercept_å±žæ€§ä¸­</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'Training set score: &#123;:.2f&#125;'</span>.format(lr.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(lr.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lr.coef_: [0.39390555]</span><br><span class="line">lr.intercept_: -0.031804343026759746</span><br><span class="line">Training set score: 0.67</span><br><span class="line">Test set score: 0.66</span><br></pre></td></tr></table></figure><p><span class="math inline">\(R^2\)</span> çº¦ä¸º 0.66ï¼Œè¿™ä¸ªç»“æžœä¸æ˜¯å¾ˆå¥½ï¼Œä½†æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šçš„åˆ†æ•°éžå¸¸æŽ¥è¿‘ã€‚è¿™è¯´æ˜Žå¯èƒ½å­˜åœ¨æ¬ æ‹Ÿåˆï¼Œè€Œä¸æ˜¯è¿‡æ‹Ÿåˆï¼ˆè¿‡æ‹Ÿåˆçš„ç‰¹å¾æ˜¯åœ¨è®­ç»ƒé›†ä¸Šçš„åˆ†æ•°éžå¸¸é«˜ï¼Œè€Œåœ¨æµ‹è¯•é›†ä¸Šçš„åˆ†æ•°éžå¸¸ä½Žï¼‰ã€‚å¯¹äºŽè¿™ä¸ªä¸€ç»´æ•°æ®é›†æ¥è¯´ï¼Œè¿‡æ‹Ÿåˆçš„é£Žé™©å¾ˆå°ï¼Œå› ä¸ºæ¨¡åž‹éžå¸¸ç®€å•ï¼ˆæˆ–å—é™ï¼‰ã€‚ç„¶è€Œï¼Œå¯¹äºŽæ›´é«˜ç»´çš„æ•°æ®é›†ï¼ˆå³æœ‰å¤§é‡ç‰¹å¾çš„æ•°æ®é›†ï¼‰ï¼Œçº¿æ€§æ¨¡åž‹å°†å˜å¾—æ›´åŠ å¼ºå¤§ï¼Œè¿‡æ‹Ÿåˆçš„å¯èƒ½æ€§ä¹Ÿä¼šå˜å¤§ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ LinearRegression åœ¨æ›´å¤æ‚çš„æ•°æ®é›†ä¸Šçš„è¡¨çŽ°ï¼Œæ¯”å¦‚æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†ã€‚è¿™ä¸ªæ•°æ®é›†æœ‰ 506 ä¸ªæ ·æœ¬å’Œ 105 ä¸ªå¯¼å‡ºç‰¹å¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = mglearn.datasets.load_extended_boston()</span><br><span class="line"></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=<span class="number">0</span>)</span><br><span class="line">lr = LinearRegression().fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Train set score: &#123;:.2f&#125;'</span>.format(lr.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(lr.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Train set score: 0.95</span><br><span class="line">Test set score: 0.61</span><br></pre></td></tr></table></figure><p>è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¹‹é—´çš„æ€§èƒ½å·®å¼‚æ˜¯è¿‡æ‹Ÿåˆçš„æ˜Žæ˜¾æ ‡å¿—ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥è¯•å›¾æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æŽ§åˆ¶å¤æ‚åº¦çš„æ¨¡åž‹ã€‚æ ‡å‡†çº¿æ€§å›žå½’æœ€å¸¸ç”¨çš„æ›¿ä»£æ–¹æ³•ä¹‹ä¸€å°±æ˜¯<strong>å²­å›žå½’</strong>ï¼ˆridge regressionï¼‰ã€‚</p><h1 id="å²­å›žå½’">å²­å›žå½’</h1><p>å²­å›žå½’ä¹Ÿæ˜¯ä¸€ç§ç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹ï¼Œå› æ­¤å®ƒçš„é¢„æµ‹å…¬å¼ä¸Žæ™®é€šæœ€å°äºŒä¹˜æ³•ç›¸åŒã€‚<strong>ä½†åœ¨å²­å›žå½’ä¸­ï¼Œå¯¹ç³»æ•° <span class="math inline">\(w\)</span> çš„é€‰æ‹©ä¸ä»…è¦åœ¨è®­ç»ƒæ•°æ®ä¸Šå¾—åˆ°å¥½çš„é¢„æµ‹ç»“æžœï¼Œè€Œä¸”è¿˜è¦æ‹Ÿåˆé™„åŠ çº¦æŸã€‚æˆ‘ä»¬è¿˜å¸Œæœ›ç³»æ•°å°½é‡å°ã€‚</strong>æ¢å¥è¯è¯´ï¼Œ<span class="math inline">\(w\)</span> çš„æ‰€æœ‰å…ƒç´ éƒ½åº”æŽ¥è¿‘äºŽ 0ã€‚ç›´è§‚ä¸Šæ¥çœ‹ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªç‰¹å¾å¯¹è¾“å‡ºçš„å½±å“åº”å°½å¯èƒ½å°ï¼ˆå³æ–œçŽ‡å¾ˆå°ï¼‰ï¼ŒåŒæ—¶ä»ç»™å‡ºå¾ˆå¥½çš„é¢„æµ‹ç»“æžœã€‚è¿™ç§çº¦æŸæ˜¯æ‰€è°“<strong>æ­£åˆ™åŒ–</strong>ï¼ˆregularizationï¼‰çš„ä¸€ä¸ªä¾‹å­ã€‚æ­£åˆ™åŒ–æ˜¯æŒ‡å¯¹æ¨¡åž‹åšæ˜¾å¼çº¦æŸï¼Œä»¥é¿å…è¿‡æ‹Ÿåˆã€‚å²­å›žå½’ç”¨åˆ°çš„è¿™ç§è¢«ç§°ä¸º<strong>L2æ­£åˆ™åŒ–</strong>ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.linear_model.ridge#sklearn.linear_model.Ridge" target="_blank" rel="noopener"><code>sklearn.linear_model.Ridge class sklearn.linear_model.Ridge(alpha=1.0, fit_intercept=True, normalize=False, copy_X=True, max_iter=None, tol=0.001, solver=â€™autoâ€™, random_state=None)</code></a></p><p>Linear least squares with l2 regularization.</p><p>Minimizes the objective function:</p><p><span class="math inline">\(||y - Xw||^2_2 + alpha * ||w||^2_2\)</span>ï¼ˆä»Žæ•°å­¦çš„è§‚ç‚¹æ¥çœ‹ï¼ŒRidge æƒ©ç½šäº†ç³»æ•°çš„ L2 èŒƒæ•°æˆ– <span class="math inline">\(w\)</span> çš„æ¬§å¼é•¿åº¦ <span class="math inline">\(||w||^2_2\)</span>ï¼‰</p><p>This model solves a regression model where the loss function is the linear least squares function and regularization is given by the l2-norm.</p></blockquote><p>å²­å›žå½’åœ¨ linear_model.Ridge ä¸­å®žçŽ°ã€‚æ¥çœ‹ä¸€ä¸‹å®ƒå¯¹æ‰©å±•çš„æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†çš„æ•ˆæžœå¦‚ä½•ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Ridge</span><br><span class="line"></span><br><span class="line">ridge = Ridge().fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Train set score: &#123;:.2f&#125;'</span>.format(ridge.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(ridge.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Train set score: 0.89</span><br><span class="line">Test set score: 0.75</span><br></pre></td></tr></table></figure><p>Ridge åœ¨è®­ç»ƒé›†ä¸Šçš„åˆ†æ•°è¦ä½ŽäºŽ LinearRegressionï¼Œä½†åœ¨æµ‹è¯•é›†ä¸Šçš„åˆ†æ•°æ›´é«˜ã€‚è¿™å’Œæˆ‘ä»¬çš„é¢„æœŸä¸€è‡´ã€‚çº¿æ€§å›žå½’å¯¹æ•°æ®å­˜åœ¨è¿‡æ‹Ÿåˆã€‚Ridge æ˜¯ä¸€ç§çº¦æŸæ›´å¼ºçš„æ¨¡åž‹ï¼Œæ‰€ä»¥æ›´ä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚å¤æ‚åº¦æ›´å°çš„æ¨¡åž‹æ„å‘³ç€åœ¨è®­ç»ƒé›†ä¸Šçš„æ€§èƒ½æ›´å·®ï¼Œä½†æ³›åŒ–æ€§èƒ½æ›´å¥½ã€‚ç”±äºŽæˆ‘ä»¬åªå¯¹æ³›åŒ–æ€§èƒ½æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥åº”è¯¥é€‰æ‹© Ridge æ¨¡åž‹è€Œä¸æ˜¯ LinearRegression æ¨¡åž‹ã€‚</p><p>Ridge æ¨¡åž‹åœ¨æ¨¡åž‹çš„ç®€å•æ€§ï¼ˆç³»æ•°éƒ½æŽ¥è¿‘äºŽ 0ï¼‰ä¸Žè®­ç»ƒé›†æ€§èƒ½ä¹‹é—´åšå‡ºæƒè¡¡ã€‚ç®€å•æ€§å’Œè®­ç»ƒé›†æ€§èƒ½äºŒè€…å¯¹äºŽæ¨¡åž‹çš„é‡è¦ç¨‹åº¦å¯ä»¥ç”±ç”¨æˆ·é€šè¿‡è®¾ç½® alpha å‚æ•°æ¥æŒ‡å®šã€‚alpha çš„æœ€ä½³è®¾å®šå€¼å–å†³äºŽç”¨åˆ°çš„å…·ä½“æ•°æ®é›†ã€‚å¢žå¤§ alpha ä¼šä½¿å¾—ç³»æ•°æ›´åŠ è¶‹å‘äºŽ 0ï¼Œä»Žè€Œé™ä½Žè®­ç»ƒé›†æ€§èƒ½ï¼Œä½†å¯èƒ½ä¼šæé«˜æ³›åŒ–æ€§èƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ridge10 = Ridge(alpha=<span class="number">10</span>).fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Train set score: &#123;:.2f&#125;'</span>.format(ridge10.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(ridge10.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Train set score: 0.79</span><br><span class="line">Test set score: 0.64</span><br></pre></td></tr></table></figure><p>å‡å° alpha å¯ä»¥è®©ç³»æ•°å—åˆ°çš„é™åˆ¶æ›´å°ã€‚å¯¹äºŽéžå¸¸å°çš„ alpha å€¼ï¼Œç³»æ•°å‡ ä¹Žæ²¡æœ‰å—åˆ°é™åˆ¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªä¸Ž LinearRegression ç±»ä¼¼çš„æ¨¡åž‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ridge01 = Ridge(alpha=<span class="number">0.1</span>).fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Train set score: &#123;:.2f&#125;'</span>.format(ridge01.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(ridge01.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Train set score: 0.93</span><br><span class="line">Test set score: 0.77</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ alpha=0.1 ä¼¼ä¹Žæ•ˆæžœä¸é”™ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•è¿›ä¸€æ­¥å‡å° alpha ä»¥æé«˜æ³›åŒ–æ€§èƒ½ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥çœ‹ alpha å–ä¸åŒå€¼æ—¶æ¨¡åž‹çš„ <code>coef_</code> å±žæ€§ï¼Œä»Žè€Œæ›´åŠ å®šæ€§åœ°ç†è§£ alpha å‚æ•°æ˜¯å¦‚ä½•æ”¹å˜æ¨¡åž‹çš„ã€‚æ›´å¤§çš„ alpha è¡¨ç¤ºçº¦æŸæ›´å¼ºçš„æ¨¡åž‹ï¼Œæ‰€ä»¥å¤§çš„ alpha å¯¹åº”çš„ <code>coef_</code> å…ƒç´ æ¯”å°çš„ alpha å¯¹åº”çš„ <code>coef_</code> å…ƒç´ è¦å°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.plot(ridge.coef_, <span class="string">'s'</span>, label=<span class="string">'Ridge alpha=1'</span>)</span><br><span class="line">plt.plot(ridge10.coef_, <span class="string">'^'</span>, label=<span class="string">'Ridge alpha=10'</span>)</span><br><span class="line">plt.plot(ridge01.coef_, <span class="string">'v'</span>, label=<span class="string">'Ridge alpha=0.1'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(lr.coef_, <span class="string">'o'</span>, label=<span class="string">'LinearRegression'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Coefficient index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Coefficient magnitude'</span>)</span><br><span class="line">plt.hlines(<span class="number">0</span>, <span class="number">0</span>, len(lr.coef_))</span><br><span class="line">plt.ylim(<span class="number">-25</span>, <span class="number">25</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/coef_-of-ridge-and-linear-regression.png"></p><p>x è½´å¯¹åº” <code>coef_</code> çš„å…ƒç´ ï¼Œy è½´å¯¹åº”å…ƒç´ çš„å…·ä½“æ•°å€¼ã€‚å¯¹äºŽ alpha=10ï¼Œç³»æ•°å¤§å¤šåœ¨ -3 å’Œ 3 ä¹‹é—´ã€‚å¯¹äºŽ alpha=1 çš„ Ridge æ¨¡åž‹ï¼Œç³»æ•°è¦ç¨å¤§ä¸€ç‚¹ã€‚å¯¹äºŽ alpha=0.1ï¼Œç‚¹çš„èŒƒå›´æ›´å¤§ã€‚å¯¹äºŽæ²¡æœ‰åšæ­£åˆ™åŒ–çš„çº¿æ€§å›žå½’ï¼ˆå³ alpha=0ï¼‰ï¼Œç‚¹çš„èŒƒå›´å¾ˆå¤§ï¼Œè®¸å¤šç‚¹éƒ½è¶…å‡ºäº†å›¾åƒçš„èŒƒå›´ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç”¨æ¥ç†è§£æ­£åˆ™åŒ–çš„å½±å“ï¼Œå°±æ˜¯å›ºå®š alpha å€¼ï¼Œä½†æ”¹å˜è®­ç»ƒæ•°æ®çš„é‡ã€‚æˆ‘ä»¬å¯¹æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†åšäºŒæ¬¡æŠ½æ ·ï¼Œå¹¶åœ¨æ•°æ®é‡é€æ¸å¢žåŠ çš„å­æ•°æ®é›†ä¸Šåˆ†åˆ«å¯¹ LinearRegression å’Œ Ridge(alpha=1) ä¸¤ä¸ªæ¨¡åž‹è¿›è¡Œè¯„ä¼°ï¼ˆå°†æ¨¡åž‹æ€§èƒ½ä½œä¸ºæ•°æ®å¤§å°çš„å‡½æ•°è¿›è¡Œç»˜å›¾ï¼Œè¿™æ ·çš„å›¾åƒå«åš<strong>å­¦ä¹ æ›²çº¿</strong>ï¼‰ã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/learning-curve-of-ridge-and-linear-regression.png"></p><p>æ— è®ºæ˜¯å²­å›žå½’è¿˜æ˜¯çº¿æ€§å›žå½’ï¼Œæ‰€æœ‰æ•°æ®é›†å¤§å°å¯¹åº”çš„è®­ç»ƒåˆ†æ•°éƒ½è¦é«˜äºŽæµ‹è¯•åˆ†æ•°ã€‚ç”±äºŽå²­å›žå½’æ˜¯æ­£åˆ™åŒ–çš„ï¼Œå› æ­¤å®ƒçš„è®­ç»ƒåˆ†æ•°è¦æ•´ä½“ä½ŽäºŽçº¿æ€§å›žå½’çš„è®­ç»ƒåˆ†æ•°ã€‚ä½†å²­å›žå½’çš„æµ‹è¯•åˆ†æ•°è¦æ›´é«˜ï¼Œç‰¹åˆ«æ˜¯å¯¹è¾ƒå°çš„å­æ•°æ®é›†ã€‚å¦‚æžœå°‘äºŽ 400 ä¸ªæ•°æ®ç‚¹ï¼Œçº¿æ€§å›žå½’å­¦ä¸åˆ°ä»»ä½•å†…å®¹ã€‚éšç€æ¨¡åž‹å¯ç”¨æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œä¸¤ä¸ªæ¨¡åž‹çš„æ€§èƒ½éƒ½åœ¨æå‡ï¼Œæœ€ç»ˆçº¿æ€§å›žå½’çš„æ€§èƒ½è¿½ä¸Šäº†å²­å›žå½’ã€‚è¿™é‡Œè¦è®°ä½çš„æ˜¯ï¼Œ<strong>å¦‚æžœæœ‰è¶³å¤Ÿå¤šçš„è®­ç»ƒæ•°æ®ï¼Œæ­£åˆ™åŒ–å˜å¾—ä¸é‚£ä¹ˆé‡è¦ï¼Œå¹¶ä¸”å²­å›žå½’å’Œçº¿æ€§å›žå½’å°†å…·æœ‰ç›¸åŒçš„æ€§èƒ½</strong>ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒäºŒè€…ç›¸åŒæ°å¥½å‘ç”Ÿåœ¨æ•´ä¸ªæ•°æ®é›†çš„æƒ…å†µä¸‹ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå·§åˆï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£ä¹‹å¤„ï¼Œå°±æ˜¯çº¿æ€§å›žå½’çš„è®­ç»ƒæ€§èƒ½åœ¨ä¸‹é™ã€‚å¦‚æžœæ·»åŠ æ›´å¤šæ•°æ®ï¼Œæ¨¡åž‹å°†æ›´åŠ éš¾ä»¥è¿‡æ‹Ÿåˆæˆ–è®°ä½æ‰€æœ‰çš„æ•°æ®ã€‚</p><h1 id="lasso">lasso</h1><p>é™¤äº† Ridgeï¼Œè¿˜æœ‰ä¸€ç§æ­£åˆ™åŒ–çš„çº¿æ€§å›žå½’æ˜¯ Lassoã€‚ä¸Žå²­å›žå½’ç›¸åŒï¼Œä½¿ç”¨ lasso ä¹Ÿæ˜¯çº¦æŸç³»æ•°ä½¿å…¶æŽ¥è¿‘äºŽ 0ï¼Œä½†ç”¨åˆ°çš„æ–¹æ³•ä¸åŒï¼Œå«åš L1 æ­£åˆ™åŒ–ã€‚L1 æ­£åˆ™åŒ–çš„ç»“æžœæ˜¯ï¼Œä½¿ç”¨ lasso æ—¶æŸäº›ç³»æ•°<strong>åˆšå¥½ä¸º 0</strong>ã€‚è¿™è¯´æ˜ŽæŸäº›ç‰¹å¾è¢«æ¨¡åž‹å®Œå…¨å¿½ç•¥ã€‚è¿™å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§è‡ªåŠ¨åŒ–çš„ç‰¹å¾é€‰æ‹©ã€‚æŸäº›ç³»æ•°åˆšå¥½ä¸º 0ï¼Œè¿™æ ·çš„æ¨¡åž‹æ›´å®¹æ˜“è§£é‡Šï¼Œä¹Ÿå¯ä»¥å‘ˆçŽ°æ¨¡åž‹æœ€é‡è¦çš„ç‰¹å¾ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.linear_model.lasso" target="_blank" rel="noopener"><code>class sklearn.linear_model.Lasso(alpha=1.0, fit_intercept=True, normalize=False, precompute=False, copy_X=True, max_iter=1000, tol=0.0001, warm_start=False, positive=False, random_state=None, selection=â€™cyclicâ€™)</code></a></p><p>Linear Model trained with L1 prior as regularizer (aka the Lasso)</p><p>The optimization objective for Lasso is:</p><p><span class="math inline">\((1 / (2 * n\_samples)) * ||y - Xw||^2_2 + alpha * ||w||_1\)</span>ï¼ˆlasso æƒ©ç½šç³»æ•°å‘é‡çš„ L1 èŒƒæ•°æˆ–ç³»æ•°çš„ç»å¯¹å€¼ä¹‹å’Œ <span class="math inline">\(||w||_1\)</span>ï¼‰</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> Lasso</span><br><span class="line"></span><br><span class="line">lasso = Lasso().fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Training set score: &#123;:.2f&#125;'</span>.format(lasso.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(lasso.score(X_test, y_test)))</span><br><span class="line">print(<span class="string">'Number of features used: &#123;&#125;'</span>.format(np.sum(lasso.coef_ != <span class="number">0</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training set score: 0.29</span><br><span class="line">Test set score: 0.21</span><br><span class="line">Number of features used: 4</span><br></pre></td></tr></table></figure><p>Lasso åœ¨è®­ç»ƒé›†ä¸Žæµ‹è¯•é›†ä¸Šçš„è¡¨çŽ°éƒ½å¾ˆå·®ã€‚è¿™è¡¨ç¤ºå­˜åœ¨æ¬ æ‹Ÿåˆï¼Œæˆ‘ä»¬å‘çŽ°æ¨¡åž‹åªç”¨åˆ°äº† 105 ä¸ªç‰¹å¾ä¸­çš„ 4 ä¸ªã€‚ä¸Ž Ridge ç±»ä¼¼ï¼ŒLasso ä¹Ÿæœ‰ä¸€ä¸ªæ­£åˆ™åŒ–å‚æ•° alphaï¼Œå¯ä»¥æŽ§åˆ¶ç³»æ•°è¶‹å‘äºŽ0çš„å¼ºåº¦ã€‚<strong>ä¸ºäº†é™ä½Žæ¬ æ‹Ÿåˆï¼Œæˆ‘ä»¬å°è¯•å‡å° alphaã€‚è¿™ä¹ˆåšçš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¢žåŠ  <code>max_iter</code> çš„å€¼ï¼ˆè¿è¡Œè¿­ä»£çš„æœ€å¤§æ¬¡æ•°ï¼‰</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lasso001 = Lasso(alpha=<span class="number">0.01</span>, max_iter=<span class="number">100000</span>).fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Training set score: &#123;:.2f&#125;'</span>.format(lasso001.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(lasso001.score(X_test, y_test)))</span><br><span class="line">print(<span class="string">'Number of features used: &#123;&#125;'</span>.format(np.sum(lasso001.coef_ != <span class="number">0</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training set score: 0.90</span><br><span class="line">Test set score: 0.77</span><br><span class="line">Number of features used: 33</span><br></pre></td></tr></table></figure><p>alpha çš„å€¼å˜å°ï¼Œæˆ‘ä»¬å¯ä»¥æ‹Ÿåˆä¸€ä¸ªæ›´å¤æ‚çš„æ¨¡åž‹ï¼Œåœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šçš„è¡¨çŽ°ä¹Ÿæ›´å¥½ã€‚æ¨¡åž‹æ€§èƒ½æ¯”ä½¿ç”¨ Ridge æ—¶ç•¥å¥½ä¸€ç‚¹ï¼Œè€Œä¸”æˆ‘ä»¬åªç”¨åˆ°äº† 105 ä¸ªç‰¹å¾ä¸­çš„ 33 ä¸ªã€‚è¿™æ ·æ¨¡åž‹å¯èƒ½æ›´å®¹æ˜“ç†è§£ã€‚</p><p>ä½†å¦‚æžœæŠŠ alpha è®¾å¾—å¤ªå°ï¼Œé‚£ä¹ˆå°±ä¼šæ¶ˆé™¤æ­£åˆ™åŒ–çš„æ•ˆæžœï¼Œå¹¶å‡ºçŽ°è¿‡æ‹Ÿåˆï¼Œå¾—åˆ°ä¸Ž LinearRegression ç±»ä¼¼çš„ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lasso00001 = Lasso(alpha=<span class="number">0.0001</span>, max_iter=<span class="number">100000</span>).fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Training set score: &#123;:.2f&#125;'</span>.format(lasso00001.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.2f&#125;'</span>.format(lasso00001.score(X_test, y_test)))</span><br><span class="line">print(<span class="string">'Number of features used: &#123;&#125;'</span>.format(np.sum(lasso00001.coef_ != <span class="number">0</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training set score: 0.95</span><br><span class="line">Test set score: 0.64</span><br><span class="line">Number of features used: 96</span><br></pre></td></tr></table></figure><p>å†æ¬¡å¯¹ä¸åŒæ¨¡åž‹çš„ç³»æ•°è¿›è¡Œä½œå›¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.plot(lasso.coef_, <span class="string">'s'</span>, label=<span class="string">'Lasso alpha=1'</span>)</span><br><span class="line">plt.plot(lasso001.coef_, <span class="string">'^'</span>, label=<span class="string">'Lasso alpha=0.01'</span>)</span><br><span class="line">plt.plot(lasso00001.coef_, <span class="string">'v'</span>, label=<span class="string">'Lasso alpha=0.0001'</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(ridge01.coef_, <span class="string">'o'</span>, label=<span class="string">'Ridge alpha=0.1'</span>)</span><br><span class="line">plt.legend(ncol=<span class="number">2</span>, loc=(<span class="number">0</span>, <span class="number">1.05</span>))</span><br><span class="line">plt.ylim(<span class="number">-25</span>, <span class="number">25</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Coefficient index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Coefficient magnitude'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/learning-curve-of-lasso-and-ridge.png"></p><p>åœ¨ alpha=1 æ—¶ï¼Œæˆ‘ä»¬å‘çŽ°ä¸ä»…å¤§éƒ¨åˆ†ç³»æ•°éƒ½æ˜¯ 0ï¼Œè€Œä¸”å…¶ä»–ç³»æ•°ä¹Ÿå¾ˆå°ã€‚å°† alpha å‡å°è‡³ 0.01ï¼Œå¤§éƒ¨åˆ†ç‰¹å¾ç­‰äºŽ 0ã€‚alpha=0.0001 æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°æ­£åˆ™åŒ–å¾ˆå¼±çš„æ¨¡åž‹ï¼Œå¤§éƒ¨åˆ†ç³»æ•°éƒ½ä¸ä¸º 0ï¼Œå¹¶ä¸”è¿˜å¾ˆå¤§ã€‚å›¾ä¸­ç”¨åœ†å½¢è¡¨ç¤º Ridge çš„æœ€ä½³ç»“æžœã€‚alpha=0.1 çš„ Ridge æ¨¡åž‹çš„é¢„æµ‹æ€§èƒ½ä¸Ž alpha=0.01 çš„ Lasso æ¨¡åž‹ç±»ä¼¼ï¼Œä½† Ridge æ¨¡åž‹çš„æ‰€æœ‰ç³»æ•°éƒ½ä¸ä¸º 0ã€‚</p><p>åœ¨å®žè·µä¸­ï¼Œåœ¨ä¸¤ä¸ªæ¨¡åž‹ä¸­ä¸€èˆ¬é¦–é€‰å²­å›žå½’ã€‚ä½†å¦‚æžœç‰¹å¾å¾ˆå¤šï¼Œä½ è®¤ä¸ºåªæœ‰å…¶ä¸­å‡ ä¸ªæ˜¯é‡è¦çš„ï¼Œé‚£ä¹ˆé€‰æ‹© Lasso å¯èƒ½æ›´å¥½ã€‚åŒæ ·ï¼Œå¦‚æžœä½ æƒ³è¦ä¸€ä¸ªå®¹æ˜“è§£é‡Šçš„æ¨¡åž‹ï¼ŒLasso å¯ä»¥ç»™å‡ºæ›´å®¹æ˜“ç†è§£çš„æ¨¡åž‹ï¼Œå› ä¸ºä»–åªé€‰æ‹©äº†ä¸€éƒ¨åˆ†è¾“å…¥ç‰¹å¾ã€‚scikit-learn è¿˜æä¾›äº† ElasticNet ç±»ï¼Œç»“åˆäº† Lasso å’Œ Ridge çš„æƒ©ç½šé¡¹ã€‚åœ¨å®žè·µä¸­ï¼Œè¿™ç§ç»“åˆçš„æ•ˆæžœæœ€å¥½ï¼Œä¸è¿‡ä»£ä»·æ˜¯è¦è°ƒèŠ‚ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªç”¨äºŽ L1 æ­£åˆ™åŒ–ï¼Œä¸€ä¸ªç”¨äºŽ L2 æ­£åˆ™åŒ–ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.linear_model.elasticnet" target="_blank" rel="noopener"><code>class sklearn.linear_model.ElasticNet(alpha=1.0, l1_ratio=0.5, fit_intercept=True, normalize=False, precompute=False, max_iter=1000, copy_X=True, tol=0.0001, warm_start=False, positive=False, random_state=None, selection=â€™cyclicâ€™)</code></a></p><p>Linear regression with combined L1 and L2 priors as regularizer.</p><p>Minimizes the objective function:</p><p><span class="math display">\[1 / (2 * n\_samples) * ||y - Xw||^2_2+ alpha * l1\_ratio * ||w||_1+ 0.5 * alpha * (1 - l1\_ratio) * ||w||^2_2\]</span></p><p>If you are interested in controlling the L1 and L2 penalty separately, keep in mind that this is equivalent to:</p><p><code>a * L1 + b * L2</code></p><p>where:</p><p><code>alpha = a + b and l1_ratio = a / (a + b)</code></p></blockquote><h1 id="ç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹">ç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹</h1><p>çº¿æ€§æ¨¡åž‹ä¹Ÿå¹¿æ³›åº”ç”¨äºŽåˆ†ç±»é—®é¢˜ã€‚æˆ‘ä»¬é¦–å…ˆæ¥çœ‹äºŒåˆ†ç±»ã€‚è¿™æ—¶å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å…¬å¼è¿›è¡Œé¢„æµ‹ï¼š</p><p><span class="math display">\[\hat y=w[0]*x[0]+w[1]*x[1]+\dots+w[p]*x[p]+b&gt;0\]</span></p><p>è¿™ä¸ªå…¬å¼çœ‹èµ·æ¥ä¸Žçº¿æ€§å›žå½’çš„å…¬å¼éžå¸¸ç±»ä¼¼ï¼Œä½†æˆ‘ä»¬æ²¡æœ‰è¿”å›žç‰¹å¾çš„åŠ æƒæ±‚å’Œï¼Œè€Œæ˜¯ä¸ºé¢„æµ‹è®¾ç½®äº†é˜ˆå€¼ 0ã€‚å¦‚æžœå‡½æ•°å€¼å°äºŽ 0ï¼Œæˆ‘ä»¬å°±é¢„æµ‹ç±»åˆ« -1ï¼›å¦‚æžœå‡½æ•°å€¼å¤§äºŽ 0ï¼Œæˆ‘ä»¬å°±é¢„æµ‹ç±»åˆ« +1.å¯¹äºŽæ‰€æœ‰ç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹ï¼Œè¿™ä¸ªé¢„æµ‹è§„åˆ™éƒ½æ˜¯é€šç”¨çš„ã€‚åŒæ ·ï¼Œæœ‰å¾ˆå¤šç§ä¸åŒçš„æ–¹æ³•æ¥æ‰¾å‡ºç³»æ•° <span class="math inline">\(w\)</span> å’Œæˆªè· <span class="math inline">\(b\)</span>ã€‚</p><p>å¯¹äºŽç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹ï¼Œè¾“å‡º <span class="math inline">\(\hat y\)</span> æ˜¯ç‰¹å¾çš„çº¿æ€§å‡½æ•°ï¼Œæ˜¯ç›´çº¿ã€å¹³é¢æˆ–è¶…å¹³é¢ã€‚å¯¹äºŽç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹ï¼Œ<strong>å†³ç­–è¾¹ç•Œ</strong>æ˜¯è¾“å…¥çš„çº¿æ€§å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼Œï¼ˆäºŒå…ƒï¼‰çº¿æ€§åˆ†ç±»å™¨æ˜¯åˆ©ç”¨ç›´çº¿ã€å¹³é¢æˆ–è¶…å¹³é¢æ¥åˆ†å¼€ä¸¤ä¸ªç±»åˆ«çš„åˆ†ç±»å™¨ã€‚</p><p>å­¦ä¹ çº¿æ€§æ¨¡åž‹æœ‰å¾ˆå¤šç§ç®—æ³•ã€‚è¿™äº›ç®—æ³•çš„åŒºåˆ«åœ¨äºŽä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>ç³»æ•°å’Œæˆªè·çš„ç‰¹å®šç»„åˆå¯¹è®­ç»ƒæ•°æ®æ‹Ÿåˆå¥½åçš„åº¦é‡æ–¹æ³•ï¼›</li><li>æ˜¯å¦ä½¿ç”¨æ­£åˆ™åŒ–ï¼Œä»¥åŠä½¿ç”¨å“ªç§æ­£åˆ™åŒ–æ–¹æ³•ã€‚</li></ul><p>ä¸åŒçš„ç®—æ³•ä½¿ç”¨ä¸åŒçš„æ–¹æ³•æ¥åº¦é‡â€œå¯¹è®­ç»ƒé›†æ‹Ÿåˆå¥½åâ€ã€‚ç”±äºŽæ•°å­¦ä¸Šçš„æŠ€æœ¯åŽŸå› ï¼Œä¸å¯èƒ½è°ƒèŠ‚ <span class="math inline">\(w\)</span> å’Œ <span class="math inline">\(b\)</span> æ˜¯çš„ç®—æ³•äº§ç”Ÿçš„è¯¯åˆ†ç±»æ•°é‡æœ€å°‘ã€‚å¯¹äºŽæˆ‘ä»¬çš„ç›®çš„ï¼Œä»¥åŠå¯¹äºŽè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œä¸Šé¢ç¬¬ä¸€ç‚¹ï¼ˆæˆä¸º<strong>æŸå¤±å‡½æ•°</strong>ï¼‰çš„é€‰æ‹©å¹¶ä¸é‡è¦ã€‚</p><p>æœ€å¸¸è§çš„ä¸¤ç§çº¿æ€§åˆ†ç±»ç®—æ³•æ˜¯ Logistic å›žå½’ï¼ˆlogistic regressionï¼Œè™½ç„¶åå­—ä¸­å«æœ‰å›žå½’ï¼Œä½†å®ƒæ˜¯ä¸€ç§åˆ†ç±»ç®—æ³•ï¼‰å’Œçº¿æ€§æ”¯æŒå‘é‡æœºï¼ˆlinear support vector machineï¼Œçº¿æ€§ SVMï¼‰ï¼Œå‰è€…åœ¨ <code>linear_model.LogisticRegression</code> ä¸­å®žçŽ°ï¼ŒåŽè€…åœ¨ <code>svm.LinearSVC</code>ï¼ˆSVCä»£è¡¨æ”¯æŒå‘é‡åˆ†ç±»å™¨ï¼‰ä¸­å®žçŽ°ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.linear_model.logisticregression" target="_blank" rel="noopener"><code>class sklearn.linear_model.LogisticRegression(penalty=â€™l2â€™, dual=False, tol=0.0001, C=1.0, fit_intercept=True, intercept_scaling=1, class_weight=None, random_state=None, solver=â€™warnâ€™, max_iter=100, multi_class=â€™warnâ€™, verbose=0, warm_start=False, n_jobs=None)</code></a></p></blockquote><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.svm.linearsvc" target="_blank" rel="noopener"><code>class sklearn.svm.LinearSVC(penalty=â€™l2â€™, loss=â€™squared_hingeâ€™, dual=True, tol=0.0001, C=1.0, multi_class=â€™ovrâ€™, fit_intercept=True, intercept_scaling=1, class_weight=None, verbose=0, random_state=None, max_iter=1000)</code></a></p></blockquote><p>æˆ‘ä»¬å¯ä»¥å°† LogisticRegression å’Œ LinearSVC æ¨¡åž‹åº”ç”¨åˆ° forge æ•°æ®é›†ä¸Šï¼Œå¹¶å°†çº¿æ€§æ¨¡åž‹æ‰¾åˆ°çš„å†³ç­–è¾¹ç•Œå¯è§†åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> LinearSVC</span><br><span class="line"></span><br><span class="line">X, y = mglearn.datasets.make_forge()</span><br><span class="line"></span><br><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">10</span>, <span class="number">3</span>))</span><br><span class="line"><span class="keyword">for</span> model, ax <span class="keyword">in</span> zip([LinearSVC(), LogisticRegression()], axes):</span><br><span class="line">    clf = model.fit(X, y)</span><br><span class="line">    mglearn.plots.plot_2d_separator(clf, X, fill=<span class="literal">False</span>, eps=<span class="number">0.5</span>, ax=ax, alpha=<span class="number">.7</span>)</span><br><span class="line">    mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y, ax=ax)</span><br><span class="line">    ax.set_title(<span class="string">'&#123;&#125;'</span>.format(clf.__class__.__name__))</span><br><span class="line">    ax.set_xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">axes[<span class="number">0</span>].legend()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-logistic-regression-and-linear-svc.png"></p><p>ä¸¤ä¸ªæ¨¡åž‹å¾—åˆ°äº†ç›¸ä¼¼çš„å†³ç­–è¾¹ç•Œã€‚æ³¨æ„ï¼Œä¸¤ä¸ªæ¨¡åž‹ä¸­éƒ½æœ‰ä¸¤ä¸ªç‚¹çš„åˆ†ç±»æ˜¯é”™è¯¯çš„ã€‚ä¸¤ä¸ªæ¨¡åž‹éƒ½é»˜è®¤ä½¿ç”¨ L2 æ­£åˆ™åŒ–ï¼Œå°±åƒ Ridge å¯¹å›žå½’æ‰€åšçš„é‚£æ ·ã€‚</p><p>å¯¹äºŽ LogisticRegression å’Œ LinearSVCï¼Œå†³å®šæ­£åˆ™åŒ–å¼ºåº¦çš„æƒè¡¡å‚æ•°å«ä½œ Cã€‚C å€¼è¶Šå¤§ï¼Œå¯¹åº”çš„æ­£åˆ™åŒ–è¶Šå¼±ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æžœ C å€¼è¾ƒå¤§ï¼Œé‚£ä¹ˆ LogisticRegression å’Œ LinearSVC å°†å°½å¯èƒ½å°†è®­ç»ƒé›†æ‹Ÿåˆåˆ°æœ€å¥½ï¼Œè€Œå¦‚æžœ C å€¼è¾ƒå°ï¼Œé‚£ä¹ˆæ¨¡åž‹æ›´å¼ºè°ƒä½¿ç³»æ•°å‘é‡ <span class="math inline">\(w\)</span> æŽ¥è¿‘äºŽ0ã€‚</p><p>å‚æ•° C çš„ä½œç”¨è¿˜æœ‰å¦ä¸€ä¸ªæœ‰è¶£ä¹‹å¤„ã€‚è¾ƒå°çš„Cå€¼å¯ä»¥è®©ç®—æ³•å°½é‡é€‚åº”â€œå¤§å¤šæ•°â€æ•°æ®ç‚¹ï¼Œè€Œè¾ƒå¤§çš„ C å€¼æ›´å¼ºè°ƒæ¯ä¸ªæ•°æ®ç‚¹éƒ½åˆ†ç±»æ­£ç¡®çš„é‡è¦æ€§ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ LinearSVC çš„å›¾ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_linear_svc_regularization()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-linear-svc.png"></p><p>åœ¨å·¦ä¾§çš„å›¾ä¸­ï¼ŒC å€¼å¾ˆå°ï¼Œå¯¹åº”å¼ºæ­£åˆ™åŒ–ã€‚å¤§éƒ¨åˆ†å±žäºŽ 0 çš„ç‚¹éƒ½ä½äºŽåº•éƒ¨ï¼Œå¤§éƒ¨åˆ†å±žäºŽç±»åˆ« 1 çš„ç‚¹éƒ½ä½äºŽé¡¶éƒ¨ã€‚å¼ºæ­£åˆ™åŒ–çš„æ¨¡åž‹ä¼šé€‰æ‹©ä¸€æ¡ç›¸å¯¹æ°´å¹³çš„çº¿ï¼Œæœ‰ä¸¤ä¸ªç‚¹åˆ†ç±»é”™è¯¯ã€‚åœ¨ä¸­é—´çš„å›¾ä¸­ï¼ŒC å€¼ç¨å¤§ï¼Œæ¨¡åž‹æ›´å…³æ³¨ä¸¤ä¸ªåˆ†ç±»é”™è¯¯çš„æ ·æœ¬ï¼Œæ˜¯å†³ç­–è¾¹ç•Œçš„æ–œçŽ‡å˜å¤§ã€‚æœ€åŽï¼Œåœ¨å³ä¾§çš„å›¾ä¸­ï¼Œæ¨¡åž‹çš„ C å€¼éžå¸¸å¤§ï¼Œä½¿å¾—å†³ç­–è¾¹ç•Œçš„æ–œçŽ‡ä¹Ÿå¾ˆå¤§ï¼ŒçŽ°åœ¨è¿™ä¸ªæ¨¡åž‹å¯¹ç±»åˆ« 0 ä¸­çš„æ‰€æœ‰ç‚¹çš„åˆ†ç±»éƒ½æ˜¯æ­£ç¡®çš„ã€‚ç±»åˆ« 1 ä¸­ä»æœ‰ 1 ä¸ªç‚¹åˆ†ç±»é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºå¯¹è¿™ä¸ªæ•°æ®é›†æ¥è¯´ï¼Œä¸å¯èƒ½ç”¨ä¸€æ¡ç›´çº¿å°†æ‰€æœ‰ç‚¹éƒ½åˆ†ç±»æ­£ç¡®ã€‚å³ä¾§å›¾ä¸­çš„æ¨¡åž‹å°½é‡ä½¿æ‰€æœ‰ç‚¹çš„åˆ†ç±»éƒ½æ­£ç¡®ï¼Œä½†å¯èƒ½æ— æ³•æŽŒæ¡ç±»åˆ«çš„æ•´ä½“åˆ†å¸ƒã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ¨¡åž‹å¾ˆå¯èƒ½è¿‡æ‹Ÿåˆã€‚</p><p>ä¸Žå›žå½’çš„æƒ…å†µç±»ä¼¼ï¼Œç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹åœ¨ä½Žç»´ç©ºé—´ä¸­çœ‹èµ·æ¥éžå¸¸å—é™ï¼Œå†³ç­–è¾¹ç•Œåªèƒ½æ˜¯ç›´çº¿æˆ–å¹³é¢ã€‚åŒæ ·ï¼Œåœ¨é«˜ç»´ç©ºé—´ä¸­ï¼Œç”¨äºŽåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹å˜å¾—éžå¸¸å¼ºå¤§ï¼Œå½“è€ƒè™‘æ›´å¤šçš„ç‰¹å¾æ—¶ï¼Œé¿å…è¿‡æ‹Ÿåˆå˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚</p><p>æˆ‘ä»¬åœ¨ä¹³è…ºç™Œæ•°æ®é›†ä¸Šè¯¦ç»†åˆ†æž LogisticRegressionï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_breast_cancer</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(cancer.data,</span><br><span class="line">    cancer.target, stratify=cancer.target, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">logreg = LogisticRegression().fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Training set score: &#123;:.3f&#125;'</span>.format(logreg.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.3f&#125;'</span>.format(logreg.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training set score: 0.955</span><br><span class="line">Test set score: 0.958</span><br></pre></td></tr></table></figure><p>C=1 çš„é»˜è®¤å€¼ç»™å‡ºäº†ç›¸å½“å¥½çš„æ€§èƒ½ï¼Œåœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šéƒ½è¾¾åˆ° 95% çš„ç²¾åº¦ã€‚<strong>ä½†ç”±äºŽè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ€§èƒ½éžå¸¸æŽ¥è¿‘ï¼Œæ‰€ä»¥æ¨¡åž‹å¾ˆå¯èƒ½æ˜¯æ¬ æ‹Ÿåˆçš„ã€‚</strong>æˆ‘ä»¬å°è¯•å¢žå¤§ C æ¥æ‹Ÿåˆä¸€ä¸ªæ›´çµæ´»çš„æ¨¡åž‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logreg100 = LogisticRegression(C=<span class="number">100</span>).fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Training set score: &#123;:.3f&#125;'</span>.format(logreg100.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.3f&#125;'</span>.format(logreg100.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training set score: 0.967</span><br><span class="line">Test set score: 0.965</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ C=100 å¯ä»¥å¾—åˆ°æ›´é«˜çš„è®­ç»ƒé›†ç²¾åº¦ï¼Œä¹Ÿå¾—åˆ°äº†ç¨é«˜çš„æµ‹è¯•é›†ç²¾åº¦ï¼Œè¿™ä¹Ÿè¯å®žäº†æˆ‘ä»¬çš„ç›´è§‰ï¼Œå³æ›´å¤æ‚çš„æ¨¡åž‹åº”è¯¥æ€§èƒ½æ›´å¥½ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ç ”ç©¶ä½¿ç”¨æ­£åˆ™åŒ–å¼ºåº¦æ›´å¼ºçš„æ¨¡åž‹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è®¾ç½® C=0.01ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logreg001 = LogisticRegression(C=<span class="number">0.01</span>).fit(X_train, y_train)</span><br><span class="line">print(<span class="string">'Training set score: &#123;:.3f&#125;'</span>.format(logreg001.score(X_train, y_train)))</span><br><span class="line">print(<span class="string">'Test set score: &#123;:.3f&#125;'</span>.format(logreg001.score(X_test, y_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training set score: 0.934</span><br><span class="line">Test set score: 0.930</span><br></pre></td></tr></table></figure><p>æ­£å¦‚æˆ‘ä»¬æ‰€æ–™ï¼Œåœ¨å°†å·²ç»æ¬ æ‹Ÿåˆçš„æ¨¡åž‹ï¼ˆC=1ï¼‰ç»§ç»­å‘å·¦ç§»åŠ¨ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„ç²¾åº¦éƒ½æ¯”é‡‡ç”¨é»˜è®¤å‚æ•°æ—¶æ›´å°ã€‚</p><p>æœ€åŽï¼Œæ¥çœ‹ä¸€ä¸‹æ­£åˆ™åŒ–å‚æ•° C å–ä¸‰ä¸ªä¸åŒçš„å€¼æ—¶æ¨¡åž‹å­¦åˆ°çš„ç³»æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.plot(logreg.coef_.T, <span class="string">'o'</span>, label=<span class="string">'C=1'</span>)</span><br><span class="line">plt.plot(logreg100.coef_.T, <span class="string">'^'</span>, label=<span class="string">'C=100'</span>)</span><br><span class="line">plt.plot(logreg001.coef_.T, <span class="string">'v'</span>, label=<span class="string">'C=0.01'</span>)</span><br><span class="line">plt.xticks(range(cancer.data.shape[<span class="number">1</span>]), cancer.feature_names, rotation=<span class="number">90</span>)</span><br><span class="line">plt.hlines(<span class="number">0</span>, <span class="number">0</span>, cancer.data.shape[<span class="number">1</span>])</span><br><span class="line">plt.ylim(<span class="number">-5</span>, <span class="number">5</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Coefficient index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Coefficient magnitude'</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/learning-curve-of-logistic-regression-l2.png"></p><p>ç”±äºŽ LogisticRegression é»˜è®¤åº”ç”¨ L2 æ­£åˆ™åŒ–ï¼Œæ‰€ä»¥å…¶ç»“æžœä¸Ž Ridge çš„ç»“æžœç±»ä¼¼ã€‚æ›´å¼ºçš„æ­£åˆ™åŒ–ä½¿å¾—ç³»æ•°æ›´è¶‹å‘äºŽ 0ï¼Œä½†ç³»æ•°æ°¸è¿œä¸ä¼šæ­£å¥½ç­‰äºŽ 0ã€‚</p><p>å¦‚æžœæƒ³è¦ä¸€ä¸ªå¯è§£é‡Šæ€§æ›´å¼ºçš„æ¨¡åž‹ï¼Œä½¿ç”¨ L1 æ­£åˆ™åŒ–å¯èƒ½æ›´å¥½ï¼Œå› ä¸ºå®ƒçº¦æŸæ¨¡åž‹åªæ˜¯ç”¨å°‘æ•°å‡ ä¸ªç‰¹å¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> C, marker <span class="keyword">in</span> zip([<span class="number">0.001</span>, <span class="number">1</span>, <span class="number">100</span>], [<span class="string">'o'</span>, <span class="string">'^'</span>, <span class="string">'v'</span>]):</span><br><span class="line">    lr_l1 = LogisticRegression(C=C, penalty=<span class="string">'l1'</span>).fit(X_train, y_train)</span><br><span class="line">    print(<span class="string">'Training accuracy of l1 logreg with C=&#123;:.3f&#125;: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">        C, lr_l1.score(X_train, y_train)))</span><br><span class="line">    print(<span class="string">'Test accuracy of l1 logreg with C=&#123;:.3f&#125;: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">        C, lr_l1.score(X_test, y_test)))</span><br><span class="line"></span><br><span class="line">    plt.plot(lr_l1.coef_.T, marker, label=<span class="string">'C=&#123;:.3f&#125;'</span>.format(C))</span><br><span class="line"></span><br><span class="line">plt.xticks(range(cancer.data.shape[<span class="number">1</span>]), cancer.feature_names, rotation=<span class="number">90</span>)</span><br><span class="line">plt.hlines(<span class="number">0</span>, <span class="number">0</span>, cancer.data.shape[<span class="number">1</span>])</span><br><span class="line">plt.xlabel(<span class="string">'Coefficient index'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Coefficient magnitude'</span>)</span><br><span class="line">plt.ylim(<span class="number">-5</span>, <span class="number">5</span>)</span><br><span class="line">plt.legend(loc=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Training accuracy of l1 logreg with C=0.001: 0.91</span><br><span class="line">Test accuracy of l1 logreg with C=0.001: 0.92</span><br><span class="line">Training accuracy of l1 logreg with C=1.000: 0.96</span><br><span class="line">Test accuracy of l1 logreg with C=1.000: 0.96</span><br><span class="line">Training accuracy of l1 logreg with C=100.000: 0.99</span><br><span class="line">Test accuracy of l1 logreg with C=100.000: 0.98</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/learning-curve-of-logistic-regression-l1.png"></p><p>å¦‚ä½ æ‰€è§ï¼Œä½¿ç”¨äºŒåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹ä¸Žç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚ä¸Žç”¨äºŽå›žå½’çš„çº¿æ€§æ¨¡åž‹ä¸€æ ·ï¼Œæ¨¡åž‹çš„ä¸»è¦å·®åˆ«åœ¨äºŽ penalty å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¼šå½±å“æ­£åˆ™åŒ–ï¼Œä¹Ÿä¼šå½±å“æ¨¡åž‹æ˜¯ä½¿ç”¨æ‰€æœ‰å¯ç”¨ç‰¹å¾è¿˜æ˜¯åªé€‰æ‹©ç‰¹å¾çš„ä¸€ä¸ªå­é›†ã€‚</p><h1 id="ç”¨äºŽå¤šåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹">ç”¨äºŽå¤šåˆ†ç±»çš„çº¿æ€§æ¨¡åž‹</h1><p>è®¸å¤šçº¿æ€§åˆ†ç±»æ¨¡åž‹åªé€‚ç”¨äºŽäºŒåˆ†ç±»é—®é¢˜ï¼Œä¸èƒ½è½»æ˜“æŽ¨å¹¿åˆ°å¤šç±»åˆ«é—®é¢˜ï¼ˆé™¤äº† Logistic å›žå½’ï¼‰ã€‚å°†äºŒåˆ†ç±»ç®—æ³•æŽ¨å¹¿åˆ°å¤šåˆ†ç±»ç®—æ³•çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯â€<strong>ä¸€å¯¹å…¶ä½™</strong>â€œï¼ˆone-vs.-restï¼‰æ–¹æ³•ã€‚åœ¨â€œä¸€å¯¹å…¶ä½™â€æ–¹æ³•ä¸­ï¼Œå¯¹æ¯ä¸ªç±»åˆ«éƒ½å­¦ä¹ ä¸€ä¸ªäºŒåˆ†ç±»æ¨¡åž‹ï¼Œå°†è¿™ä¸ªç±»åˆ«ä¸Žæ‰€æœ‰å…¶ä»–ç±»åˆ«å°½é‡åˆ†å¼€ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†ä¸Žç±»åˆ«ä¸ªæ•°ä¸€æ ·å¤šçš„äºŒåˆ†ç±»æ¨¡åž‹ã€‚åœ¨æµ‹è¯•ç‚¹ä¸Šè¿è¡Œæ‰€æœ‰äºŒåˆ†ç±»å™¨æ¥è¿›è¡Œé¢„æµ‹ã€‚åœ¨å¯¹åº”ç±»åˆ«ä¸Šåˆ†æ•°æœ€é«˜çš„åˆ†ç±»å™¨â€œèƒœå‡ºâ€ï¼Œå°†å¢žé¢ç±»åˆ«æ ‡ç­¾è¿”å›žä½œä¸ºé¢„æµ‹ç»“æžœã€‚</p><p>æ¯ä¸ªç±»åˆ«éƒ½å¯¹åº”ä¸€ä¸ªäºŒç±»åˆ†ç±»å™¨ï¼Œè¿™æ ·æ¯ä¸ªç±»è¢«ä¹Ÿéƒ½æœ‰ä¸€ä¸ªç³»æ•° <span class="math inline">\(w\)</span> å‘é‡å’Œä¸€ä¸ªæˆªè· <span class="math inline">\(b\)</span>ã€‚ä¸‹é¢ç»™å‡ºçš„æ˜¯åˆ†ç±»ç½®ä¿¡æ–¹ç¨‹ï¼Œå…¶ç»“æžœä¸­æœ€å¤§å€¼å¯¹åº”çš„ç±»åˆ«å³ä¸ºé¢„æµ‹çš„ç±»åˆ«æ ‡ç­¾ï¼š</p><p><span class="math display">\[w[0]*x[0]+w[1]*x[1]+\dots+w[p]*x[p]+b\]</span></p><p>å¤šåˆ†ç±» Logistic å›žå½’èƒŒåŽçš„æ•°å­¦ä¸Žâ€œä¸€å¯¹å…¶ä½™â€æ–¹æ³•ç¨æœ‰ä¸åŒï¼Œä½†å®ƒä¹Ÿæ˜¯å¯¹æ¯ä¸ªç±»åˆ«éƒ½æœ‰ä¸€ä¸ªç³»æ•°å‘é‡å’Œä¸€ä¸ªæˆªè·ï¼Œä¹Ÿä½¿ç”¨äº†ç›¸åŒçš„é¢„æµ‹æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬å°†â€œä¸€å¯¹å…¶ä½™â€æ–¹æ³•åº”ç”¨åœ¨ä¸€ä¸ªç®€å•çš„ä¸‰åˆ†ç±»æ•°æ®é›†ä¸Šã€‚æˆ‘ä»¬ç”¨åˆ°äº†ä¸€ä¸ªäºŒç»´æ•°æ®é›†ï¼Œæ¯ä¸ªåˆ—åˆ«å¾·æ•°æ®éƒ½æ˜¯ä»Žä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·å¾—å‡ºçš„ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.datasets.make_blobs#sklearn.datasets.make_blobs" target="_blank" rel="noopener"><code>sklearn.datasets.make_blobs(n_samples=100, n_features=2, centers=None, cluster_std=1.0, center_box=(-10.0, 10.0), shuffle=True, random_state=None)</code></a></p><p>Generate isotropic Gaussian blobs for clustering.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_blobs</span><br><span class="line"></span><br><span class="line">X, y = make_blobs(random_state=<span class="number">42</span>)</span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">plt.legend([<span class="string">'Class 0'</span>, <span class="string">'Class 1'</span>, <span class="string">'Class 2'</span>])</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-blobs.png"></p><p>åœ¨è¿™ä¸ªæ•°æ®é›†ä¸Šè®­ç»ƒä¸€ä¸ª LinearSVC åˆ†ç±»å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">linear_svm = LinearSVC().fit(X, y)</span><br><span class="line">print(<span class="string">'Coefficient shape: '</span>, linear_svm.coef_.shape)</span><br><span class="line">print(<span class="string">'Intercept shape: '</span>, linear_svm.intercept_.shape)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Coefficient shape:  (3, 2)  # æ¯è¡ŒåŒ…æ‹¬ä¸‰ä¸ªç±»åˆ«ä¹‹ä¸€çš„ç³»æ•°å‘é‡ï¼Œæ•°æ®æœ‰ä¸¤ä¸ªç‰¹å¾ï¼Œå› æ­¤ç³»æ•°æœ‰ä¸¤ä¸ªå…ƒç´ </span><br><span class="line">Intercept shape:  (3,)  # æ¯ä¸ªç±»åˆ«çš„æˆªè·</span><br></pre></td></tr></table></figure><p>å°†è¿™ 3 ä¸ªäºŒç±»åˆ†ç±»å™¨ç»™å‡ºçš„ç›´çº¿å¯è§†åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line">line = np.linspace(<span class="number">-15</span>, <span class="number">15</span>)</span><br><span class="line"><span class="keyword">for</span> coef, intercept, color <span class="keyword">in</span> zip(linear_svm.coef_, linear_svm.intercept_,</span><br><span class="line">                                  [<span class="string">'b'</span>, <span class="string">'r'</span>, <span class="string">'g'</span>]):</span><br><span class="line">    <span class="comment"># model: y = coef[0] * x[0] + coef[1] * x[1] + intercept</span></span><br><span class="line">    <span class="comment"># boundary: 0 = coef[0] * x[0] + coef[1] * x[1] + intercept</span></span><br><span class="line">    <span class="comment"># è¾¹ç•Œä¸Šçš„x[1] = -(coef[0] * x[0] + intercept) / coef[1]</span></span><br><span class="line">    plt.plot(line, -(line * coef[<span class="number">0</span>] + intercept) / coef[<span class="number">1</span>], c=color)</span><br><span class="line">plt.ylim(<span class="number">-10</span>, <span class="number">15</span>)</span><br><span class="line">plt.xlim(<span class="number">-10</span>, <span class="number">8</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">plt.legend([<span class="string">'Class 0'</span>, <span class="string">'Class 1'</span>, <span class="string">'Class 2'</span>, <span class="string">'Line class 0'</span>, <span class="string">'Line class 1'</span>,</span><br><span class="line">            <span class="string">'Line class 2'</span>], loc=(<span class="number">1.01</span>, <span class="number">0.3</span>))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-one-vs-rest.png"></p><p>å›¾åƒä¸­é—´çš„ä¸‰è§’å½¢åŒºåŸŸå±žäºŽå“ªä¸€ä¸ªç±»åˆ«å‘¢ï¼Œ3 ä¸ªäºŒç±»åˆ†ç±»å™¨éƒ½å°†è¿™ä¸€åŒºåŸŸå†…çš„ç‚¹åˆ’ä¸ºâ€œå…¶ä½™â€ã€‚è¿™é‡Œçš„ç‚¹åº”è¯¥åˆ’å½’åˆ°å“ªä¸€ä¸ªç±»åˆ«å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ†ç±»æ–¹ç¨‹ç»“æžœæœ€å¤§çš„é‚£ä¸ªç±»åˆ«ï¼Œå³æœ€æŽ¥è¿‘çš„é‚£æ¡çº¿å¯¹åº”çš„ç±»åˆ«ã€‚ä¸‹é¢çš„ä¾‹å­ç»™å‡ºäº†äºŒç»´ç©ºé—´ä¸­æ‰€æœ‰åŒºåŸŸçš„é¢„æµ‹ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_2d_classification(linear_svm, X, fill=<span class="literal">True</span>, alpha=<span class="number">.7</span>)</span><br><span class="line"></span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line">line = np.linspace(<span class="number">-15</span>, <span class="number">15</span>)</span><br><span class="line"><span class="keyword">for</span> coef, intercept, color <span class="keyword">in</span> zip(linear_svm.coef_, linear_svm.intercept_,</span><br><span class="line">                                  [<span class="string">'b'</span>, <span class="string">'r'</span>, <span class="string">'g'</span>]):</span><br><span class="line">    plt.plot(line, -(line * coef[<span class="number">0</span>] + intercept) / coef[<span class="number">1</span>], c=color)</span><br><span class="line">plt.ylim(<span class="number">-10</span>, <span class="number">15</span>)</span><br><span class="line">plt.xlim(<span class="number">-10</span>, <span class="number">8</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">plt.legend([<span class="string">'Class 0'</span>, <span class="string">'Class 1'</span>, <span class="string">'Class 2'</span>, <span class="string">'Line class 0'</span>, <span class="string">'Line class 1'</span>,</span><br><span class="line">            <span class="string">'Line class 2'</span>], loc=(<span class="number">1.01</span>, <span class="number">0.3</span>))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-one-vs-rest-fill.png"></p><h1 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h1><p>çº¿æ€§æ¨¡åž‹çš„ä¸»è¦å‚æ•°æ˜¯æ­£åˆ™åŒ–å‚æ•°ï¼Œåœ¨å›žå½’æ¨¡åž‹ä¸­å«ä½œ alphaï¼Œåœ¨ LinearSVC å’Œ LogisticRegression ä¸­å«ä½œ Cã€‚<strong>alpha å€¼è¾ƒå¤§æˆ– C å€¼è¾ƒå°ï¼Œè¯´æ˜Žæ¨¡åž‹æ¯”è¾ƒç®€å•ã€‚ç‰¹åˆ«æ˜¯å¯¹äºŽå›žå½’æ¨¡åž‹è€Œè¨€ï¼Œè°ƒèŠ‚è¿™äº›å‚æ•°éžå¸¸é‡è¦ã€‚é€šå¸¸åœ¨å¯¹æ•°å°ºåº¦ä¸Šå¯¹ C å’Œ alpha è¿›è¡Œæœç´¢ã€‚ä½ è¿˜éœ€è¦ç¡®å®šçš„æ˜¯ç”¨ L1 æ­£åˆ™åŒ–è¿˜æ˜¯ L2 æ­£åˆ™åŒ–ã€‚</strong>å¦‚æžœä½ å‡å®šåªæœ‰å‡ ä¸ªç‰¹å¾æ˜¯çœŸæ­£é‡è¦çš„ï¼Œé‚£ä¹ˆä½ åº”è¯¥ç”¨ L1 æ­£åˆ™åŒ–ï¼Œå¦åˆ™åº”é»˜è®¤ä½¿ç”¨ L2 æ­£åˆ™åŒ–ã€‚å¦‚æžœæ¨¡åž‹çš„å¯è§£é‡Šæ€§å¾ˆé‡è¦çš„è¯ï¼Œä½¿ç”¨ L1 ä¹Ÿä¼šæœ‰å¸®åŠ©ã€‚ç”±äºŽ L1 åªç”¨åˆ°å‡ ä¸ªç‰¹å¾ï¼Œæ‰€ä»¥æ›´å®¹æ˜“è§£é‡Šå“ªäº›ç‰¹å¾å¯¹æ¨¡åž‹æ˜¯é‡è¦çš„ï¼Œä»¥åŠè¿™äº›ç‰¹å¾çš„ä½œç”¨ã€‚</p><p>çº¿æ€§æ¨¡åž‹çš„è®­ç»ƒé€Ÿåº¦éžå¸¸å¿«ï¼Œé¢„æµ‹é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚è¿™ç§æ¨¡åž‹å¯ä»¥æŽ¨å¹¿åˆ°éžå¸¸å¤§çš„æ•°æ®é›†ï¼Œå¯¹ç¨€ç–æ•°æ®ä¹Ÿå¾ˆæœ‰æ•ˆã€‚å¦‚æžœä½ çš„æ•°æ®åŒ…å«æ•°åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡ä¸ªæ ·æœ¬ï¼Œä½ å¯èƒ½éœ€è¦ç ”ç©¶å¦‚ä½•ä½¿ç”¨ LogisticRegression å’Œ Ridge æ¨¡åž‹çš„ solver='sag' é€‰é¡¹ï¼Œåœ¨å¤„ç†å¤§åž‹æ•°æ®æ—¶ï¼Œè¿™ä¸€é€‰é¡¹æ¯”é»˜è®¤å€¼è¦æ›´å¿«ã€‚å…¶ä»–é€‰é¡¹è¿˜æœ‰ SGDClassifier ç±»å’Œ SGDRegression ç±»ï¼Œå®ƒä»¬å¯¹æœ¬èŠ‚ä»‹ç»çš„çº¿æ€§æ¨¡åž‹å®žçŽ°äº†å¯æ‰©å±•æ€§æ›´å¼ºçš„ç‰ˆæœ¬ã€‚</p><p>çº¿æ€§æ¨¡åž‹çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºŽï¼Œåˆ©ç”¨æˆ‘ä»¬ä¹‹å‰è§è¿‡çš„ç”¨äºŽå›žå½’å’Œåˆ†ç±»çš„å…¬å¼ï¼Œç†è§£å¦‚ä½•è¿›è¡Œé¢„æµ‹æ˜¯ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¾€å¾€å¹¶ä¸å®Œå…¨æ¸…æ¥šç³»æ•°ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ã€‚å¦‚æžœä½ çš„æ•°æ®é›†ä¸­åŒ…å«é«˜åº¦ç›¸å…³çš„ç‰¹å¾ï¼Œè¿™ä¸€é—®é¢˜å°¤ä¸ºçªå‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½å¾ˆéš¾å¯¹ç³»æ•°åšå‡ºè§£é‡Šã€‚</p><p><strong>å¦‚æžœç‰¹å¾æ•°é‡å¤§äºŽæ ·æœ¬æ•°é‡ï¼Œçº¿æ€§æ¨¡åž‹çš„è¡¨çŽ°é€šå¸¸éƒ½å¾ˆå¥½ã€‚</strong>ä»–ä¹Ÿå¸¸ç”¨äºŽéžå¸¸å¤§çš„æ•°æ®é›†ï¼Œåªæ˜¯å› ä¸ºè®­ç»ƒå…¶ä»–æ¨¡åž‹å¹¶ä¸å¯è¡Œã€‚ä½†åœ¨æ›´ä½Žç»´çš„ç©ºé—´ä¸­ï¼Œå…¶ä»–æ¨¡åž‹çš„æ³›åŒ–æ€§èƒ½å¯èƒ½æ›´å¥½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
            <tag> regression </tag>
            
            <tag> classification </tag>
            
            <tag> ridge </tag>
            
            <tag> lasso </tag>
            
            <tag> linear model </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kè¿‘é‚»</title>
      <link href="/notes/introduction-to-ml-with-python/k-nearest-neighbors/"/>
      <url>/notes/introduction-to-ml-with-python/k-nearest-neighbors/</url>
      
        <content type="html"><![CDATA[<p>k-NNç®—æ³•å¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚æž„å»ºçš„æ¨¡åž‹åªéœ€è¦ä¿å­˜è®­ç»ƒæ•°æ®é›†å³å¯ã€‚æƒ³è¦å¯¹æ–°æ•°æ®ç‚¹åšå‡ºé¢„æµ‹ï¼Œç®—æ³•ä¼šåœ¨è®­ç»ƒæ•°æ®é›†ä¸­æ‰¾åˆ°æœ€è¿‘çš„æ•°æ®ç‚¹ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„â€œæœ€è¿‘é‚»â€ã€‚</p><h1 id="kè¿‘é‚»åˆ†ç±»">kè¿‘é‚»åˆ†ç±»</h1><p>k-NNç®—æ³•æœ€ç®€å•çš„ç‰ˆæœ¬åªè€ƒè™‘ä¸€ä¸ªæœ€è¿‘é‚»ï¼Œä¹Ÿå°±æ˜¯ä¸Žæˆ‘ä»¬æƒ³è¦é¢„æµ‹çš„æ•°æ®ç‚¹æœ€è¿‘çš„è®­ç»ƒæ•°æ®ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_knn_classification(n_neighbors=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>å•ä¸€æœ€è¿‘é‚»æ¨¡åž‹å¯¹forgeæ•°æ®é›†çš„é¢„æµ‹ï¼š</p><p><img src="/uploads/image/introduction-to-ml-with-python/1-nn-classfication-on-forge.png"></p><a id="more"></a><p>é™¤äº†è€ƒè™‘æœ€è¿‘é‚»ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä»»æ„ä¸ªï¼ˆkä¸ªï¼‰é‚»å±…ã€‚è¿™ä¹Ÿæ˜¯kè¿‘é‚»ç®—æ³•åå­—çš„æ¥åŽ†ã€‚åœ¨è€ƒè™‘å¤šä½™ä¸€ä¸ªé‚»å±…çš„æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬ç”¨â€œæŠ•ç¥¨æ³•â€ï¼ˆvotingï¼‰æ¥æŒ‡å®šæ ‡ç­¾ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_knn_classification(n_neighbors=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/3-nn-classfication-on-forge.png"></p><p>çŽ°åœ¨çœ‹ä¸€ä¸‹å¦‚ä½•é€šè¿‡scikit-learnæ¥åº”ç”¨kè¿‘é‚»ç®—æ³•ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.neighbors.kneighborsclassifier" target="_blank" rel="noopener"><code>class sklearn.neighbors.KNeighborsClassifier(n_neighbors=5, weights=â€™uniformâ€™, algorithm=â€™autoâ€™, leaf_size=30, p=2, metric=â€™minkowskiâ€™, metric_params=None, n_jobs=None, **kwargs)</code></a></p><p>Classifier implementing the k-nearest neighbors vote.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line">X, y = mglearn.datasets.make_forge()  <span class="comment"># åŽŸå§‹æ•°æ®é›†</span></span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=<span class="number">0</span>)  <span class="comment"># åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line">clf = KNeighborsClassifier(n_neighbors=<span class="number">3</span>)  <span class="comment"># åˆå§‹åŒ–åˆ†ç±»å™¨</span></span><br><span class="line">clf.fit(X_train, y_train)  <span class="comment"># ç”¨è®­ç»ƒé›†å¯¹å…¶æ‹Ÿåˆ</span></span><br><span class="line">clf.score(X_test, y_test)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0.8571428571428571  # æ¨¡åž‹çš„ç²¾åº¦çº¦ä¸º86%</span><br></pre></td></tr></table></figure><h1 id="åˆ†æžkneighborsclassifier">åˆ†æžKNeighborsClassifier</h1><p>å¯¹äºŽäºŒç»´æ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¹³é¢ä¸Šç”»å‡ºæ‰€æœ‰å¯èƒ½çš„æµ‹è¯•ç‚¹çš„é¢„æµ‹ç»“æžœã€‚æ ¹æ®å¹³é¢ä¸­æ¯ä¸ªç‚¹æ‰€å±žçš„ç±»åˆ«å¯¹å¹³é¢è¿›è¡Œç€è‰²ã€‚è¿™æ ·å°±å¯ä»¥æŸ¥çœ‹<strong>å†³ç­–è¾¹ç•Œ</strong>ï¼ˆdecision boundaryï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">3</span>, figsize=(<span class="number">10</span>, <span class="number">3</span>))</span><br><span class="line"><span class="keyword">for</span> n_neighbors, ax <span class="keyword">in</span> zip([<span class="number">1</span>, <span class="number">3</span>, <span class="number">9</span>], axes):</span><br><span class="line">    clf = KNeighborsClassifier(n_neighbors=n_neighbors).fit(X, y)</span><br><span class="line">    mglearn.plots.plot_2d_separator(clf, X, fill=<span class="literal">True</span>, eps=<span class="number">0.5</span>, ax=ax, alpha=<span class="number">.4</span>)</span><br><span class="line">    mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y, ax=ax)</span><br><span class="line">    ax.set_title(<span class="string">'&#123;&#125; neighbor(s)'</span>.format(n_neighbors))</span><br><span class="line">    ax.set_xlabel(<span class="string">'feature 0'</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'feature 1'</span>)</span><br><span class="line">axes[<span class="number">0</span>].legend(loc=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-of-knn.png"></p><p>ä»Žå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨å•ä¸€é‚»å±…ç»˜åˆ¶çš„å†³ç­–è¾¹ç•Œç´§è·Ÿç€è®­ç»ƒæ•°æ®ã€‚éšç€é‚»å±…ä¸ªæ•°è¶Šæ¥è¶Šå¤šï¼Œå†³ç­–è¾¹ç•Œä¹Ÿè¶Šæ¥è¶Šå¹³æ»‘ã€‚æ›´å¹³æ»‘çš„è¾¹ç•Œå¯¹åº”æ›´ç®€å•çš„æ¨¡åž‹ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨æ›´å°‘çš„é‚»å±…å¯¹åº”æ›´é«˜çš„æ¨¡åž‹å¤æ‚åº¦ï¼Œè€Œä½¿ç”¨æ›´å¤šçš„é‚»å±…å¯¹åº”æ›´ä½Žçš„æ¨¡åž‹å¤æ‚åº¦ã€‚å‡å¦‚è€ƒè™‘æžç«¯æƒ…å†µï¼Œå³é‚»å±…ä¸ªæ•°ç­‰äºŽè®­ç»ƒé›†ä¸­æ‰€æœ‰æ•°æ®ç‚¹çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªæµ‹è¯•ç‚¹çš„é‚»å±…éƒ½å®Œå…¨ç›¸åŒï¼ˆå³æ‰€æœ‰è®­ç»ƒç‚¹ï¼‰ï¼Œæ‰€æœ‰é¢„æµ‹ç»“æžœä¹Ÿå®Œå…¨ç›¸åŒï¼ˆå³è®­ç»ƒé›†ä¸­å‡ºçŽ°æ¬¡æ•°æœ€å¤šçš„ç±»åˆ«ï¼‰ã€‚</p><p>åœ¨çŽ°å®žä¸–ç•Œçš„ä¹³è…ºç™Œæ•°æ®é›†ä¸Šç ”ç©¶æ¨¡åž‹å¤æ‚åº¦å’Œæ³›åŒ–èƒ½åŠ›ä¹‹é—´çš„å…³ç³»ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_breast_cancer</span><br><span class="line"></span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    cancer.data, cancer.target, stratify=cancer.target, random_state=<span class="number">66</span>)</span><br><span class="line"></span><br><span class="line">training_accuracy, test_accuracy = [], []</span><br><span class="line">neighbors_settings = range(<span class="number">1</span>, <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n_neighbors <span class="keyword">in</span> neighbors_settings:</span><br><span class="line">    clf = KNeighborsClassifier(n_neighbors=n_neighbors)</span><br><span class="line">    clf.fit(X_train, y_train)</span><br><span class="line">    training_accuracy.append(clf.score(X_train, y_train))</span><br><span class="line">    test_accuracy.append(clf.score(X_test, y_test))</span><br><span class="line"></span><br><span class="line">plt.plot(neighbors_settings, training_accuracy, label=<span class="string">'training accuracy'</span>)</span><br><span class="line">plt.plot(neighbors_settings, test_accuracy, label=<span class="string">'test accuracy'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Accuracy'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'n_neighbors'</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/k-neighbors-classification-on-breast-cancer.png"></p><p>å•ä¸€é‚»å±…çš„æ¨¡åž‹è¿‡äºŽå¤æ‚ã€‚ä¸Žä¹‹ç›¸åï¼Œå½“è€ƒè™‘10ä¸ªé‚»å±…æ—¶ï¼Œæ¨¡åž‹åˆè¿‡äºŽç®€å•ï¼Œæ€§èƒ½ç”šè‡³å˜å·®ã€‚æœ€ä½³æ€§èƒ½åœ¨ä¸­é—´çš„æŸå¤„ï¼Œé‚»å±…ä¸ªæ•°å¤§çº¦ä¸º6ã€‚</p><h1 id="kè¿‘é‚»å›žå½’">kè¿‘é‚»å›žå½’</h1><p>kè¿‘é‚»ç®—æ³•è¿˜å¯ä»¥ç”¨äºŽå›žå½’ã€‚è¿˜æ˜¯ä»Žå•ä¸€è¿‘é‚»å¼€å§‹ï¼Œè¿™æ¬¡ä½¿ç”¨waveæ•°æ®é›†ã€‚åˆ©ç”¨å•ä¸€é‚»å±…çš„é¢„æµ‹ç»“æžœå°±æ˜¯æœ€è¿‘é‚»çš„ç›®æ ‡å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_knn_regression(n_neighbors=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/1-nn-regression-on-wave.png"></p><p>åŒæ ·ï¼Œä¹Ÿå¯ä»¥ç”¨å¤šä¸ªè¿‘é‚»è¿›è¡Œå›žå½’ï¼Œé¢„æµ‹ç»“æžœä¸ºè¿™äº›è¿‘é‚»çš„å¹³å‡å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mglearn.plots.plot_knn_regression(n_neighbors=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/3-nn-regression-on-wave.png"></p><p>ç”¨äºŽå›žå½’çš„kè¿‘é‚»ç®—æ³•åœ¨scikit-learnçš„KNeighborsRegressorç±»ä¸­å®žçŽ°ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.neighbors.kneighborsregressor" target="_blank" rel="noopener"><code>class sklearn.neighbors.KNeighborsRegressor(n_neighbors=5, weights=â€™uniformâ€™, algorithm=â€™autoâ€™, leaf_size=30, p=2, metric=â€™minkowskiâ€™, metric_params=None, n_jobs=None, **kwargs)</code></a></p><p>Regression based on k-nearest neighbors.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsRegressor</span><br><span class="line"></span><br><span class="line">X, y = mglearn.datasets.make_wave(n_samples=<span class="number">40</span>)</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">reg = KNeighborsRegressor(n_neighbors=<span class="number">3</span>)</span><br><span class="line">reg.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Test set predictions:\n&#123;&#125;'</span>.format(reg.predict(X_test)))</span><br><span class="line">print(<span class="string">'Test set R^2: &#123;:.2f&#125;'</span>.format(reg.score(X_test, y_test)))  <span class="comment"># å†³å®šç³»æ•°</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Test set predictions:</span><br><span class="line">[-0.05396539  0.35686046  1.13671923 -1.89415682 -1.13881398 -1.63113382</span><br><span class="line">  0.35686046  0.91241374 -0.44680446 -1.13881398]</span><br><span class="line">Test set R^2: 0.83</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨scoreæ–¹æ³•æ¥è¯„ä¼°æ¨¡åž‹ï¼Œå¯¹äºŽå›žå½’é—®é¢˜ï¼Œè¿™ä¸€æ–¹æ³•è¿”å›žçš„æ˜¯<span class="math inline">\(R^2\)</span>åˆ†æ•°ã€‚<span class="math inline">\(R^2\)</span>åˆ†æ•°ä¹Ÿå«ä½œå†³å®šç³»æ•°ï¼Œæ˜¯å›žå½’æ¨¡åž‹é¢„æµ‹çš„ä¼˜åº¦åº¦é‡ï¼Œä½äºŽ0åˆ°1ä¹‹é—´ã€‚<span class="math inline">\(R^2\)</span>ç­‰äºŽ1å¯¹åº”å®Œç¾Žé¢„æµ‹ï¼Œ<span class="math inline">\(R^2\)</span>ç­‰äºŽ0å¯¹åº”å¸¸æ•°æ¨¡åž‹ï¼Œå³æ€»æ˜¯é¢„æµ‹è®­ç»ƒé›†å“åº”ï¼ˆy_train)çš„å¹³å‡å€¼ã€‚</p><h1 id="åˆ†æžkneighborsregression">åˆ†æžKNeighborsRegression</h1><p>å¯¹äºŽwaveä¸€ç»´æ•°æ®é›†ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç‰¹å¾å–å€¼å¯¹åº”çš„é¢„æµ‹ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig, axes = plt.subplots(<span class="number">1</span>, <span class="number">3</span>, figsize=(<span class="number">15</span>, <span class="number">4</span>))</span><br><span class="line"><span class="comment"># åˆ›å»º1000ä¸ªæ•°æ®ç‚¹ï¼Œåœ¨-3å’Œ3ä¹‹é—´å‡åŒ€åˆ†å¸ƒ</span></span><br><span class="line">line = np.linspace(<span class="number">-3</span>, <span class="number">3</span>, <span class="number">1000</span>).reshape(<span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> n_neighbors, ax <span class="keyword">in</span> zip([<span class="number">1</span>, <span class="number">3</span>, <span class="number">9</span>], axes):</span><br><span class="line">    reg = KNeighborsRegressor(n_neighbors=n_neighbors)</span><br><span class="line">    reg.fit(X_train, y_train)</span><br><span class="line">    ax.plot(line, reg.predict(line))</span><br><span class="line">    ax.plot(X_train, y_train, <span class="string">'^'</span>, c=mglearn.cm2(<span class="number">0</span>), markersize=<span class="number">8</span>)</span><br><span class="line">    ax.plot(X_test, y_test, <span class="string">'v'</span>, c=mglearn.cm2(<span class="number">1</span>), markersize=<span class="number">8</span>)</span><br><span class="line">    ax.set_title(<span class="string">'&#123;&#125; neighbor(s)\n train score: &#123;:.2f&#125; test score: &#123;:.2f&#125;'</span>.format(</span><br><span class="line">        n_neighbors, reg.score(X_train, y_train), reg.score(X_test, y_test)))</span><br><span class="line">    ax.set_xlabel(<span class="string">'Feature'</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'Target'</span>)</span><br><span class="line">axes[<span class="number">0</span>].legend([<span class="string">'Model predictions'</span>, <span class="string">'Training data/target'</span>, <span class="string">'Test data/target'</span>],</span><br><span class="line">    loc=<span class="string">'best'</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/k-neighbors-regression-on-wave.png"></p><p>ä»Žå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä»…ä½¿ç”¨å•ä¸€é‚»å±…ï¼Œè®­ç»ƒé›†ä¸­çš„æ¯ä¸ªç‚¹éƒ½å¯¹é¢„æµ‹ç»“æžœæœ‰æ˜¾è‘—å½±å“ï¼Œé¢„æµ‹ç»“æžœçš„å›¾åƒç»è¿‡æ‰€æœ‰æ•°æ®ç‚¹ã€‚è¿™å¯¼è‡´é¢„æµ‹ç»“æžœéžå¸¸ä¸ç¨³å®šã€‚è€ƒè™‘æ›´å¤šçš„é‚»å±…ä¹‹åŽï¼Œé¢„æµ‹ç»“æžœå˜å¾—æ›´åŠ å¹³æ»‘ï¼Œä½†å¯¹è®­ç»ƒæ•°æ®çš„æ‹Ÿåˆä¹Ÿä¸å¥½ã€‚</p><h1 id="ä¼˜ç‚¹ç¼ºç‚¹å’Œå‚æ•°">ä¼˜ç‚¹ã€ç¼ºç‚¹å’Œå‚æ•°</h1><p>ä¸€èˆ¬æ¥è¯´ï¼ŒKNeighborsåˆ†ç±»å™¨æœ‰2ä¸ªé‡è¦å‚æ•°ï¼šé‚»å±…ä¸ªæ•°ä¸Žæ•°æ®ç‚¹ä¹‹é—´è·ç¦»çš„åº¦é‡æ–¹æ³•ã€‚åœ¨å®žè·µä¸­ï¼Œä½¿ç”¨è¾ƒå°çš„é‚»å±…ä¸ªæ•°ï¼ˆæ¯”å¦‚3ä¸ªæˆ–5ä¸ªï¼‰å¾€å¾€å¯ä»¥å¾—åˆ°æ¯”è¾ƒå¥½çš„ç»“æžœï¼Œä½†ä½ åº”è¯¥è°ƒèŠ‚è¿™ä¸ªå‚æ•°ã€‚è·ç¦»ä½¿ç”¨æ¬§å¼è·ç¦»ï¼Œå®ƒåœ¨è®¸å¤šæƒ…å†µä¸‹çš„æ•ˆæžœéƒ½å¾ˆå¥½ã€‚</p><p>k-NNçš„ä¼˜ç‚¹ä¹‹ä¸€å°±æ˜¯æ¨¡åž‹å¾ˆå®¹æ˜“ç†è§£ï¼Œé€šå¸¸ä¸éœ€è¦è¿‡å¤šè°ƒèŠ‚å°±å¯ä»¥å¾—åˆ°ä¸é”™çš„æ€§èƒ½ã€‚åœ¨è€ƒè™‘ä½¿ç”¨æ›´é«˜çº§çš„æŠ€æœ¯ä¹‹å‰ï¼Œå°è¯•æ­¤ç®—æ³•æ˜¯ä¸€ç§å¾ˆå¥½çš„åŸºå‡†æ–¹æ³•ã€‚æž„å»ºæœ€è¿‘é‚»æ¨¡åž‹çš„é€Ÿåº¦é€šå¸¸å¾ˆå¿«ï¼Œä½†å¦‚æžœè®­ç»ƒé›†å¾ˆå¤§ï¼ˆç‰¹å¾æ•°å¾ˆå¤šæˆ–è€…æ ·æœ¬æ•°å¾ˆå¤§ï¼‰ï¼Œé¢„æµ‹é€Ÿåº¦å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚<strong>ä½¿ç”¨k-NNç®—æ³•æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†æ˜¯å¾ˆé‡è¦çš„ã€‚</strong>è¿™ä¸€ç®—æ³•å¯¹äºŽæœ‰å¾ˆå¤šç‰¹å¾çš„æ•°æ®é›†å¾€å¾€æ•ˆæžœä¸å¥½ï¼Œå¯¹äºŽå¤§å¤šæ•°ç‰¹å¾çš„å¤§å¤šæ•°å–å€¼éƒ½ä¸º0çš„æ•°æ®é›†ï¼ˆæ‰€è°“çš„<strong>ç¨€ç–æ•°æ®é›†</strong>ï¼‰æ¥è¯´ï¼Œè¿™ä¸€ç®—æ³•çš„æ•ˆæžœå°¤ä¸ºä¸å¥½ã€‚</p><p>è™½ç„¶kè¿‘é‚»ç®—æ³•å¾ˆå®¹æ˜“ç†è§£ï¼Œä½†ç”±äºŽé¢„æµ‹é€Ÿåº¦æ…¢ä¸”ä¸èƒ½å¤„ç†å…·æœ‰å¾ˆå¤šç‰¹å¾çš„æ•°æ®é›†ï¼Œæ‰€ä»¥åœ¨å®žè·µä¸­å¾€å¾€ä¸ä¼šç”¨åˆ°ã€‚çº¿æ€§æ¨¡åž‹å°±æ²¡æœ‰è¿™ä¸¤ä¸ªç¼ºç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
            <tag> regression </tag>
            
            <tag> classification </tag>
            
            <tag> KNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç›‘ç£å­¦ä¹ </title>
      <link href="/notes/introduction-to-ml-with-python/supervised-learning/"/>
      <url>/notes/introduction-to-ml-with-python/supervised-learning/</url>
      
        <content type="html"><![CDATA[<p>æ¯å½“æƒ³è¦æ ¹æ®ç»™å®šè¾“å…¥é¢„æµ‹æŸä¸ªç»“æžœï¼Œå¹¶ä¸”è¿˜æœ‰è¾“å…¥/è¾“å‡ºå¯¹çš„ç¤ºä¾‹æ—¶ï¼Œéƒ½åº”è¯¥ä½¿ç”¨ç›‘ç£å­¦ä¹ ã€‚è¿™äº›è¾“å…¥/è¾“å‡ºå¯¹æž„æˆäº†è®­ç»ƒé›†ï¼Œæˆ‘ä»¬åˆ©ç”¨å®ƒæ¥æž„å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯¹ä»Žæœªè§è¿‡çš„æ–°æ•°æ®åšå‡ºå‡†ç¡®é¢„æµ‹ã€‚ç›‘ç£å­¦ä¹ é€šå¸¸éœ€è¦äººåŠ›æ¥æž„å»ºè®­ç»ƒé›†ï¼Œä½†ä¹‹åŽçš„ä»»åŠ¡æœ¬æ¥éžå¸¸è´¹åŠ›ç”šè‡³æ— æ³•å®Œæˆï¼ŒçŽ°åœ¨å´å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œé€šå¸¸é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚</p><h1 id="åˆ†ç±»å’Œå›žå½’">åˆ†ç±»å’Œå›žå½’</h1><p>ç›‘ç£æœºå™¨å­¦ä¹ é—®é¢˜ä¸»è¦æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«å«åšåˆ†ç±»ï¼ˆclassificationï¼‰ä¸Žå›žå½’ï¼ˆregressionï¼‰ã€‚</p><p>åˆ†ç±»é—®é¢˜çš„ç›®æ ‡æ˜¯é¢„æµ‹ç±»åˆ«æ ‡ç­¾ï¼ˆclass labelï¼‰ï¼Œè¿™äº›æ ‡ç­¾æ¥è‡ªé¢„å®šä¹‰çš„å¯é€‰åˆ—è¡¨ã€‚åˆ†ç±»é—®é¢˜æœ‰æ—¶å¯åˆ†ä¸ºè€Œåˆ†ç±»ï¼ˆbinary classificationï¼‰å’Œå¤šåˆ†ç±»ï¼ˆmulticlass classificationï¼‰ã€‚</p><p>åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†å…¶ä¸­ä¸€ä¸ªç±»åˆ«ç§°ä¸ºæ­£ç±»ï¼ˆpositive classï¼‰ï¼Œå¦ä¸€ä¸ªç±»åˆ«ç§°ä¸ºåç±»ï¼ˆnegative classï¼‰ã€‚è€Œé¸¢å°¾èŠ±çš„ä¾‹å­åˆ™å±žäºŽå¤šåˆ†ç±»é—®é¢˜ã€‚å¦ä¸€ä¸ªå¤šåˆ†ç±»çš„ä¾‹å­æ˜¯æ ¹æ®ç½‘ç«™ä¸Šçš„æ–‡æœ¬é¢„æµ‹ç½‘ç«™æ‰€ç”¨çš„è¯­è¨€ã€‚è¿™é‡Œçš„ç±»åˆ«å°±æ˜¯é¢„å®šä¹‰çš„è¯­è¨€åˆ—è¡¨ã€‚</p><p>å›žå½’ä»»åŠ¡çš„ç›®æ ‡æ˜¯é¢„æµ‹ä¸€ä¸ªè¿žç»­å€¼ï¼Œç¼–ç¨‹æœ¯è¯­å«åšæµ®ç‚¹æ•°ï¼ˆfloating-point numberï¼‰ï¼Œæ•°å­¦æœ¯è¯­å«åšå®žæ•°ï¼ˆreal numberï¼‰ã€‚æ ¹æ®æ•™è‚²æ°´å¹³ã€å¹´é¾„å’Œå±…ä½åœ°æ¥é¢„æµ‹ä¸€ä¸ªäººçš„å¹´æ”¶å…¥ï¼Œè¿™å°±æ˜¯å›žå½’çš„ä¸€ä¸ªä¾‹å­ã€‚åœ¨é¢„æµ‹æ”¶å…¥æ—¶ï¼Œé¢„æµ‹å€¼æ˜¯ä¸€ä¸ªé‡‘é¢ï¼Œå¯ä»¥åœ¨ç»™å®šèŒƒå›´å†…ä»»æ„å–å€¼ã€‚å›žå½’ä»»åŠ¡çš„å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œæ ¹æ®ä¸Šä¸€å¹´çš„äº§é‡ã€å¤©æ°”å’Œå†œåœºå‘˜å·¥æ•°ç­‰å±žæ€§æ¥é¢„æµ‹å†œåœºçš„äº§é‡ã€‚åŒæ ·ï¼Œäº§é‡ä¹Ÿå¯ä»¥å–ä»»æ„æ•°å€¼ã€‚</p><a id="more"></a><p>åŒºåˆ†åˆ†ç±»ä»»åŠ¡å’Œå›žå½’ä»»åŠ¡æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯é—®ä¸€ä¸ªé—®é¢˜ï¼šè¾“å‡ºæ˜¯å¦å…·æœ‰æŸç§è¿žç»­æ€§ã€‚å¦‚æžœåœ¨å¯èƒ½çš„ç»“æžœä¹‹é—´å…·æœ‰è¿žç»­æ€§ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå›žå½’é—®é¢˜ã€‚æƒ³æƒ³é¢„æµ‹å¹´æ”¶å…¥çš„ä¾‹å­ï¼Œè¾“å‡ºå…·æœ‰éžå¸¸æ˜Žæ˜¾çš„è¿žç»­æ€§ã€‚ä¸€å¹´èµš40000ç¾Žå…ƒè¿˜æ˜¯40001ç¾Žå…ƒå¹¶æ²¡æœ‰å®žè´¨å·®åˆ«ï¼Œå³æ—¶ä¸¤è€…é‡‘é¢ä¸åŒã€‚å¦‚æžœæˆ‘ä»¬çš„ç®—æ³•åœ¨æœ¬åº”é¢„æµ‹40000ç¾Žå…ƒæ—¶çš„é¢„æµ‹ç»“æžœæ˜¯39990ç¾Žå…ƒæˆ–40001ç¾Žå…ƒï¼Œä¸å¿…è¿‡åˆ†åœ¨æ„ã€‚</p><p>ä¸Žæ­¤ç›¸åï¼Œå¯¹äºŽè¯†åˆ«ç½‘ç«™è¯­è¨€çš„ä»»åŠ¡æ¥è¯´ï¼Œå¹¶ä¸å­˜åœ¨ç¨‹åº¦é—®é¢˜ã€‚ç½‘ç«™ä½¿ç”¨çš„è¦ä¹ˆæ˜¯è¿™ç§è¯­è¨€ï¼Œè¦ä¹ˆæ˜¯é‚£ç§è¯­è¨€ã€‚åœ¨è¯­è¨€ä¹‹é—´ä¸å­˜åœ¨è¿žç»­æ€§ï¼Œåœ¨è‹±è¯­å’Œæ³•è¯­ä¹‹é—´ä¸å­˜åœ¨å…¶ä»–è¯­è¨€ã€‚</p><h1 id="æ³›åŒ–è¿‡æ‹Ÿåˆä¸Žæ¬ æ‹Ÿåˆ">æ³›åŒ–ã€è¿‡æ‹Ÿåˆä¸Žæ¬ æ‹Ÿåˆ</h1><p>åœ¨ç›‘ç£å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨è®­ç»ƒæ•°æ®ä¸Šæž„å»ºæ¨¡åž‹ï¼Œç„¶åŽèƒ½å¤Ÿå¯¹æ²¡è§è¿‡çš„æ–°æ•°æ®ï¼ˆè¿™äº›æ–°æ•°æ®ä¸Žè®­ç»ƒé›†å…·æœ‰ç›¸åŒçš„ç‰¹æ€§ï¼‰åšå‡ºå‡†ç¡®é¢„æµ‹ã€‚å¦‚æžœä¸€ä¸ªæ¨¡åž‹èƒ½å¤Ÿå¯¹æ²¡è§è¿‡çš„æ•°æ®åšå‡ºå‡†ç¡®é¢„æµ‹ï¼Œæˆ‘ä»¬å°±è¯´å®ƒèƒ½å¤Ÿä»Žè®­ç»ƒé›†æ³›åŒ–ï¼ˆgeneralizeï¼‰åˆ°æµ‹è¯•é›†ã€‚æˆ‘ä»¬æƒ³è¦æž„å»ºä¸€ä¸ªæ³›åŒ–ç²¾åº¦å°½å¯èƒ½é«˜çš„æ¨¡åž‹ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬æž„å»ºæ¨¡åž‹ï¼Œä½¿å…¶åœ¨è®­ç»ƒé›†ä¸Šèƒ½å¤Ÿåšå‡ºå‡†ç¡®é¢„æµ‹ã€‚å¦‚æžœè®­ç»ƒé›†å’Œæµ‹è¯•é›†è¶³å¤Ÿç›¸ä¼¼ï¼Œæˆ‘ä»¬é¢„è®¡æ¨¡åž‹åœ¨æµ‹è¯•é›†ä¸Šä¹Ÿèƒ½åšå‡ºå‡†ç¡®é¢„æµ‹ã€‚ä¸è¿‡åœ¨æŸäº›æƒ…å†µä¸‹è¿™ä¸€ç‚¹å¹¶ä¸æˆç«‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæˆ‘ä»¬å¯ä»¥æž„å»ºéžå¸¸å¤æ‚çš„æ¨¡åž‹ï¼Œé‚£ä¹ˆåœ¨è®­ç»ƒé›†ä¸Šçš„ç²¾åº¦å¯ä»¥æƒ³å¤šé«˜å°±å¤šé«˜ã€‚</p><p>ä¸ºäº†è¯´æ˜Žè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè™šæž„çš„ä¾‹å­ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªæ–°æ‰‹æ•°æ®ç§‘å­¦å®¶ï¼Œå·²çŸ¥ä¹‹å‰èˆ¹çš„ä¹°å®¶è®°å½•å’Œå¯¹ä¹°èˆ¹ä¸æ„Ÿå…´è¶£çš„é¡¾å®¢è®°å½•ï¼Œæƒ³è¦é¢„æµ‹æŸä¸ªé¡¾å®¢æ˜¯å¦ä¼šä¹°èˆ¹ï¼ˆåœ¨çŽ°å®žä¸–ç•Œä¸­ï¼Œè¿™å®žé™…ä¸Šæ˜¯ä¸€ä¸ªéžå¸¸å¤æ‚çš„é—®é¢˜ã€‚è™½ç„¶æˆ‘ä»¬çŸ¥é“å…¶ä»–é¡¾å®¢è¿˜æ²¡æœ‰ä»Žæˆ‘ä»¬è¿™é‡Œä¹°è¿‡èˆ¹ï¼Œä½†ä»–ä»¬å¯èƒ½å·²ç»åœ¨å…¶ä»–äººé‚£é‡Œä¹°è¿‡äº†ï¼Œæˆ–è€…ä»åœ¨å­˜é’±å¹¶æ‰“ç®—å°†æ¥å†ä¹°ï¼‰ã€‚ç›®æ ‡æ˜¯å‘å¯èƒ½è´­ä¹°çš„äººå‘é€ä¿ƒé”€ç”µå­é‚®ä»¶ï¼Œè€Œä¸åŽ»æ‰“æ‰°é‚£äº›ä¸æ„Ÿå…´è¶£çš„é¡¾å®¢ã€‚</p><p>åˆ¤æ–­ä¸€ä¸ªç®—æ³•åœ¨æ–°æ•°æ®ä¸Šè¡¨çŽ°å¥½åçš„å”¯ä¸€åº¦é‡ï¼Œå°±æ˜¯åœ¨æµ‹è¯•é›†ä¸Šçš„è¯„ä¼°ã€‚ç„¶è€Œä»Žç›´è§‰ä¸Šçœ‹ï¼ˆåœ¨æ•°å­¦ä¸Šä¹Ÿå¯ä»¥è¯æ˜Žè¿™ä¸€ç‚¹ï¼Œå¥¥å¡å§†å‰ƒåˆ€ç†è®ºï¼‰ï¼Œæˆ‘ä»¬è®¤ä¸ºç®€å•çš„æ¨¡åž‹å¯¹æ–°æ•°æ®çš„æ³›åŒ–èƒ½åŠ›æ›´å¥½ã€‚å¦‚æžœè§„å¾‹æ˜¯â€œå¹´é¾„å¤§äºŽ50å²çš„äººæƒ³è¦ä¹°èˆ¹â€ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è§£é‡Šæ‰€æœ‰é¡¾å®¢çš„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ›´ç›¸ä¿¡è¿™æ¡è§„å¾‹ï¼Œè€Œä¸æ˜¯ä¸Žå¹´é¾„ã€å­å¥³å’Œå©šå§»çŠ¶å†µéƒ½æœ‰å…³ç³»çš„é‚£æ¡è§„å¾‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ€»æƒ³æ‰¾åˆ°æœ€ç®€å•çš„æ¨¡åž‹ã€‚æž„å»ºä¸€ä¸ªå¯¹çŽ°æœ‰ä¿¡æ¯é‡æ¥è¯´è¿‡äºŽå¤æ‚çš„æ¨¡åž‹ï¼Œè¿™è¢«ç§°ä¹‹ä¸ºè¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰ã€‚å¦‚æžœä½ åœ¨æ‹Ÿåˆæ¨¡åž‹æ—¶è¿‡åˆ†å…³æ³¨è®­ç»ƒé›†çš„ç»†èŠ‚ï¼Œå¾—åˆ°äº†ä¸€ä¸ªåœ¨è®­ç»ƒé›†ä¸Šè¡¨çŽ°å¾ˆå¥½ã€ä½†ä¸èƒ½æ³›åŒ–åˆ°æ–°æ•°æ®ä¸Šçš„æ¨¡åž‹ï¼Œé‚£ä¹ˆå°±å­˜åœ¨è¿‡æ‹Ÿåˆã€‚ä¸Žä¹‹ç›¸åï¼Œå¦‚æžœä½ çš„æ¨¡åž‹è¿‡äºŽç®€å•â€”â€”æ¯”å¦‚è¯´ï¼Œâ€œæœ‰æˆ¿å­çš„äººéƒ½ä¹°èˆ¹â€â€”â€”é‚£ä¹ˆä½ å¯èƒ½æ— æ³•æŠ“ä½æ•°æ®çš„å…¨éƒ¨å†…å®¹ä»¥åŠæ•°æ®ä¸­çš„å˜åŒ–ï¼Œä½ çš„æ¨¡åž‹ç”šè‡³åœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨çŽ°å°±å¾ˆå·®ã€‚é€‰æ‹©è¿‡äºŽç®€å•çš„æ¨¡åž‹è¢«ç§°ä¸ºæ¬ æ‹Ÿåˆï¼ˆunderfittingï¼‰ã€‚</p><p>æˆ‘ä»¬çš„æ¨¡åž‹è¶Šå¤æ‚ï¼Œåœ¨è®­ç»ƒæ•°æ®ä¸Šçš„é¢„æµ‹ç»“æžœå°±è¶Šå¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæˆ‘ä»¬çš„æ¨¡åž‹è¿‡äºŽå¤æ‚ï¼Œæˆ‘ä»¬å¼€å§‹è¿‡å¤šå…³æ³¨è®­ç»ƒé›†ä¸­æ¯ä¸ªå•ç‹¬çš„æ•°æ®ç‚¹ï¼Œæ¨¡åž‹å°±ä¸èƒ½å¾ˆå¥½åœ°æ³›åŒ–åˆ°æ–°æ•°æ®ä¸Šã€‚äºŒè€…ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€ä½³ä½ç½®ï¼Œå¯ä»¥å¾—åˆ°æœ€å¥½çš„æ³›åŒ–æ€§èƒ½ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ¨¡åž‹ã€‚</p><p><img src="/uploads/image/introduction-to-ml-with-python/trade-off-of-model-complexity-against-training-and-test-accuracy.png"></p><h2 id="æ¨¡åž‹å¤æ‚åº¦ä¸Žæ•°æ®é›†å¤§å°çš„å…³ç³»">æ¨¡åž‹å¤æ‚åº¦ä¸Žæ•°æ®é›†å¤§å°çš„å…³ç³»</h2><p>éœ€è¦æ³¨æ„ï¼Œæ¨¡åž‹å¤æ‚åº¦ä¸Žè®­ç»ƒæ•°æ®é›†ä¸­çš„è¾“å…¥çš„å˜åŒ–å¯†åˆ‡ç›¸å…³ï¼šæ•°æ®é›†ä¸­åŒ…å«çš„æ•°æ®ç‚¹çš„å˜åŒ–èŒƒå›´è¶Šå¤§ï¼Œåœ¨ä¸å‘ç”Ÿè¿‡æ‹Ÿåˆçš„å‰æä¸‹ä½ å¯ä»¥ä½¿ç”¨çš„æ¨¡åž‹å°±è¶Šå¤æ‚ã€‚é€šå¸¸æ¥è¯´ï¼Œæ”¶é›†æ›´å¤šçš„æ•°æ®ç‚¹å¯ä»¥æœ‰æ›´å¤§çš„å˜åŒ–èŒƒå›´ï¼Œæ‰€ä»¥æ›´å¤§çš„æ•°æ®é›†å¯ä»¥ç”¨æ¥æž„å»ºæ›´å¤æ‚çš„æ¨¡åž‹ã€‚ä½†æ˜¯ï¼Œä»…å¤åˆ¶ç›¸åŒçš„æ•°æ®ç‚¹æˆ–æ”¶é›†éžå¸¸ç›¸ä¼¼çš„æ•°æ®æ˜¯æ— æµŽäºŽäº‹çš„ã€‚</p><p>æ”¶é›†æ›´å¤šæ•°æ®ï¼Œé€‚å½“æž„å»ºæ›´å¤æ‚çš„æ¨¡åž‹ï¼Œå¯¹ç›‘ç£å­¦ä¹ ä»»åŠ¡å¾€å¾€ç‰¹åˆ«æœ‰ç”¨ã€‚åœ¨çŽ°å®žä¸–ç•Œä¸­ï¼Œä½ å¾€å¾€èƒ½å¤Ÿå†³å®šæ”¶é›†å¤šå°‘æ•°æ®ï¼Œè¿™å¯èƒ½æ¯”æ¨¡åž‹è°ƒå‚æ›´ä¸ºæœ‰æ•ˆã€‚æ°¸è¿œä¸è¦ä½Žè°·æ›´å¤šæ•°æ®çš„åŠ›é‡ï¼</p><h1 id="ç›‘ç£å­¦ä¹ ç®—æ³•">ç›‘ç£å­¦ä¹ ç®—æ³•</h1><h2 id="ä¸€äº›æ ·æœ¬æ•°æ®é›†">ä¸€äº›æ ·æœ¬æ•°æ®é›†</h2><p>ç”¨æ¨¡æ‹Ÿçš„forgeæ•°æ®é›†æ¥è¯´æ˜Žåˆ†ç±»ç®—æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> mglearn</span><br><span class="line"></span><br><span class="line">X, y = mglearn.datasets.make_forge()</span><br><span class="line">mglearn.discrete_scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], y)</span><br><span class="line">plt.legend([<span class="string">'Class 0'</span>, <span class="string">'Class 1'</span>], loc=<span class="number">4</span>)</span><br><span class="line">plt.xlabel(<span class="string">'First feature'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Second feature'</span>)</span><br><span class="line">print(X.shape)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(26, 2)  # 26è¡Œæ•°æ®ï¼Œæ¯ä¸ªæ•°æ®æœ‰2ä¸ªç‰¹å¾</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-forge.png"></p><p>ç”¨æ¨¡æ‹Ÿçš„waveæ•°æ®é›†æ¥è¯´æ˜Žå›žå½’ç®—æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = mglearn.datasets.make_wave(n_samples=<span class="number">40</span>)</span><br><span class="line">plt.plot(X, y, <span class="string">'o'</span>)</span><br><span class="line">plt.ylim(<span class="number">-3</span>, <span class="number">3</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Feature'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Target'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/datasets-wave.png"></p><p><strong>ä»Žç‰¹å¾è¾ƒå°‘çš„æ•°æ®é›†ï¼ˆä¹Ÿå«ä½Žç»´æ•°æ®é›†ï¼‰ä¸­å¾—å‡ºçš„ç»“è®ºå¯èƒ½å¹¶ä¸é€‚ç”¨äºŽç‰¹å¾è¾ƒå¤šçš„æ•°æ®é›†ï¼ˆä¹Ÿå«é«˜ç»´æ•°æ®é›†ï¼‰ã€‚</strong></p><p>åˆ†ç±»æ•°æ®é›†ï¼Œä¹³è…ºç™Œæ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_breast_cancer</span><br><span class="line">cancer = load_breast_cancer()</span><br><span class="line">print(<span class="string">'Keys:'</span>, cancer.keys())</span><br><span class="line">print(<span class="string">'Shape:'</span>, cancer.data.shape)</span><br><span class="line">print(<span class="string">'Feature names:\n&#123;&#125;'</span>.format(cancer.feature_names))  <span class="comment"># 30ä¸ªç‰¹å¾çš„åå­—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">print(<span class="string">'Counter:'</span>, &#123;n: v <span class="keyword">for</span> n, v <span class="keyword">in</span>  <span class="comment"># æŒ‰æ¶æ€§å’Œè‰¯æ€§è®¡æ•°</span></span><br><span class="line">                   zip(cancer.target_names, np.bincount(cancer.target))&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Keys: dict_keys([&apos;data&apos;, &apos;target&apos;, &apos;target_names&apos;, &apos;DESCR&apos;, &apos;feature_names&apos;, &apos;filename&apos;])</span><br><span class="line">Shape: (569, 30)</span><br><span class="line">Feature names:</span><br><span class="line">[&apos;mean radius&apos; &apos;mean texture&apos; &apos;mean perimeter&apos; &apos;mean area&apos;</span><br><span class="line"> &apos;mean smoothness&apos; &apos;mean compactness&apos; &apos;mean concavity&apos;</span><br><span class="line"> &apos;mean concave points&apos; &apos;mean symmetry&apos; &apos;mean fractal dimension&apos;</span><br><span class="line"> &apos;radius error&apos; &apos;texture error&apos; &apos;perimeter error&apos; &apos;area error&apos;</span><br><span class="line"> &apos;smoothness error&apos; &apos;compactness error&apos; &apos;concavity error&apos;</span><br><span class="line"> &apos;concave points error&apos; &apos;symmetry error&apos; &apos;fractal dimension error&apos;</span><br><span class="line"> &apos;worst radius&apos; &apos;worst texture&apos; &apos;worst perimeter&apos; &apos;worst area&apos;</span><br><span class="line"> &apos;worst smoothness&apos; &apos;worst compactness&apos; &apos;worst concavity&apos;</span><br><span class="line"> &apos;worst concave points&apos; &apos;worst symmetry&apos; &apos;worst fractal dimension&apos;]</span><br><span class="line">Counter: &#123;&apos;malignant&apos;: 212, &apos;benign&apos;: 357&#125;</span><br></pre></td></tr></table></figure><p>å›žå½’æ•°æ®é›†ï¼Œæ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_boston</span><br><span class="line">boston = load_boston()</span><br><span class="line">print(boston.data.shape)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(506, 13)</span><br></pre></td></tr></table></figure><p>å¯¹äºŽæˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•è¿™ä¸ªæ•°æ®é›†ï¼Œè¾“å…¥ç‰¹å¾ä¸ä»…åŒ…æ‹¬è¿™13ä¸ªæµ‹é‡ç»“æžœï¼Œè¿˜åŒ…æ‹¬è¿™äº›ç‰¹å¾ä¹‹é—´çš„ä¹˜ç§¯ï¼ˆä¹Ÿå«äº¤äº’é¡¹ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸ä»…å°†çŠ¯ç½ªçŽ‡å’Œå…¬è·¯å¯è¾¾æ€§ä½œä¸ºç‰¹å¾ï¼Œè¿˜å°†çŠ¯ç½ªçŽ‡å’Œå…¬è·¯å¯è¾¾æ€§çš„ä¹˜ç§¯ä½œä¸ºç‰¹å¾ã€‚è¿™ä¸ªå¯¼å‡ºçš„æ•°æ®é›†å¯ä»¥ç”¨mglearn.load_extended_bostonå‡½æ•°åŠ è½½ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">X, y = mglearn.datasets.load_extended_boston()</span><br><span class="line">print(X.shape)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(506, 104)</span><br></pre></td></tr></table></figure><h2 id="kè¿‘é‚»">kè¿‘é‚»</h2><a href="/notes/introduction-to-ml-with-python/k-nearest-neighbors/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h2 id="çº¿æ€§æ¨¡åž‹">çº¿æ€§æ¨¡åž‹</h2><a href="/notes/introduction-to-ml-with-python/linear-models/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h2 id="æœ´ç´ è´å¶è‹åˆ†ç±»å™¨">æœ´ç´ è´å¶è‹åˆ†ç±»å™¨</h2><a href="/notes/introduction-to-ml-with-python/naive-bayes-classifiers/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h2 id="å†³ç­–æ ‘">å†³ç­–æ ‘</h2><a href="/notes/introduction-to-ml-with-python/decision-trees/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h2 id="å†³ç­–æ ‘é›†æˆ">å†³ç­–æ ‘é›†æˆ</h2><a href="/notes/introduction-to-ml-with-python/decision-tree-ensemble/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h2 id="æ ¸æ”¯æŒå‘é‡æœº">æ ¸æ”¯æŒå‘é‡æœº</h2><a href="/notes/introduction-to-ml-with-python/kernelized-support-vector-machine/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h2 id="ç¥žç»ç½‘ç»œæ·±åº¦å­¦ä¹ ">ç¥žç»ç½‘ç»œï¼ˆæ·±åº¦å­¦ä¹ ï¼‰</h2><a href="/notes/introduction-to-ml-with-python/neural-networks-deep-learning/" title="å‰å¾€æ–‡ç« ">å‰å¾€æ–‡ç« </a><h1 id="åˆ†ç±»å™¨çš„ä¸ç¡®å®šåº¦ä¼°è®¡">åˆ†ç±»å™¨çš„ä¸ç¡®å®šåº¦ä¼°è®¡</h1><p>æˆ‘ä»¬è¿˜æ²¡æœ‰è°ˆåˆ°<code>scikit-learn</code>æŽ¥å£çš„å¦ä¸€ä¸ªæœ‰ç”¨ä¹‹å¤„ï¼Œå°±æ˜¯åˆ†ç±»å™¨èƒ½å¤Ÿç»™å‡ºé¢„æµ‹çš„ä¸æ­£ç¡®åº¦ä¼°è®¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½ æ„Ÿå…´è¶£çš„ä¸ä»…æ˜¯åˆ†ç±»å™¨ä¼šé¢„æµ‹ä¸€ä¸ªæµ‹è¯•ç‚¹å±žäºŽå“ªä¸ªç±»åˆ«ï¼Œè¿˜åŒ…æ‹¬å®ƒå¯¹è¿™ä¸ªé¢„æµ‹çš„ç½®ä¿¡åº¦ã€‚åœ¨å®žè·µä¸­ï¼Œä¸åŒç±»åž‹çš„é”™è¯¯ä¼šåœ¨çŽ°å®žåº”ç”¨ä¸­å¯¼è‡´éžå¸¸ä¸åŒçš„ç»“æžœã€‚æƒ³è±¡ä¸€ä¸ªç”¨äºŽæµ‹è¯•ç™Œç—‡çš„åŒ»ç–—åº”ç”¨ã€‚å‡é˜³æ€§é¢„æµ‹å¯èƒ½åªä¼šè®©â€œæ‚£è€…â€æŽ¥å—é¢å¤–çš„æµ‹è¯•ï¼Œä½†å‡é˜´æ€§å´å¯èƒ½å¯¼è‡´é‡ç—…æ²¡æœ‰å¾—åˆ°æ²»ç–—ã€‚</p><p><code>scikit-learn</code>ä¸­æœ‰ä¸¤ä¸ªå‡½æ•°å¯ç”¨äºŽèŽ·å–åˆ†ç±»å™¨çš„ä¸ç¡®å®šåº¦ä¼°è®¡ï¼š<code>decision_function</code>å’Œ<code>predict_proba</code>ã€‚å¤§å¤šæ•°åˆ†ç±»å™¨ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰éƒ½è‡³å°‘æœ‰å…¶ä¸­ä¸€ä¸ªå‡½æ•°ï¼Œå¾ˆå¤šåˆ†ç±»å™¨ä¸¤ä¸ªéƒ½æœ‰ã€‚æˆ‘ä»¬æ¥æž„å»ºä¸€ä¸ªGradientBoostingClassifieråˆ†ç±»å™¨ï¼ˆåŒæ—¶æ‹¥æœ‰<code>decision_function</code>å’Œ<code>predict_proba</code>ä¸¤ä¸ªæ–¹æ³•ï¼‰ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªå‡½æ•°å¯¹ä¸€ä¸ªæ¨¡æ‹Ÿçš„äºŒç»´æ•°æ®é›†çš„ä½œç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> make_circles</span><br><span class="line">X, y = make_circles(noise=<span class="number">0.25</span>, factor=<span class="number">0.5</span>, random_state=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºäº†ä¾¿äºŽè¯´æ˜Žï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªç±»åˆ«é‡å‘½åä¸º"blue"å’Œ"red"</span></span><br><span class="line">y_named = np.array([<span class="string">'blue'</span>, <span class="string">'red'</span>])[y]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥å¯¹ä»»æ„ä¸ªæ•°ç»„è°ƒç”¨train_test_split</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰æ•°ç»„çš„åˆ’åˆ†éƒ½æ˜¯ä¸€è‡´çš„</span></span><br><span class="line">X_train, X_test, y_train_named, y_test_named, y_train, y_test = \</span><br><span class="line">    train_test_split(X, y_named, y, random_state=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æž„å»ºæ¢¯åº¦æå‡æ¨¡åž‹</span></span><br><span class="line">gbrt = GradientBoostingClassifier(random_state=<span class="number">0</span>)</span><br><span class="line">gbrt.fit(X_train, y_train_named)</span><br></pre></td></tr></table></figure><h2 id="å†³ç­–å‡½æ•°">å†³ç­–å‡½æ•°</h2><p>å¯¹äºŽäºŒåˆ†ç±»çš„æƒ…å†µï¼Œ<code>decision_function</code>è¿”å›žå€¼çš„å½¢çŠ¶æ˜¯<code>(n_samples,)</code>ï¼Œä¸ºæ¯ä¸ªæ ·æœ¬éƒ½è¿”å›žä¸€ä¸ªæµ®ç‚¹æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'X_test.shape: &#123;&#125;'</span>.format(X_test.shape))</span><br><span class="line">print(<span class="string">'Decision function shape: &#123;&#125;'</span>.format(</span><br><span class="line">    gbrt.decision_function(X_test).shape))</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºdecision_functionçš„å‰å‡ ä¸ªå…ƒç´ </span></span><br><span class="line">print(<span class="string">'Decision function:\n&#123;&#125;'</span>.format(gbrt.decision_function(X_test)[:<span class="number">6</span>]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X_test.shape: (25, 2)</span><br><span class="line">Decision function shape: (25,)</span><br><span class="line">Decision function:</span><br><span class="line">[ 4.13592629 -1.7016989  -3.95106099 -3.62599351  4.28986668  3.66166106]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå€¼è¡¨ç¤ºæ¨¡åž‹å¯¹è¯¥æ•°æ®ç‚¹å±žäºŽâ€œæ­£â€ç±»çš„ç½®ä¿¡ç¨‹åº¦ã€‚æ­£å€¼è¡¨ç¤ºå¯¹æ­£ç±»çš„åå¥½ï¼Œè´Ÿå€¼è¡¨ç¤ºå¯¹â€œåç±»â€ï¼ˆå…¶ä»–ç±»ï¼‰çš„åå¥½ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…æŸ¥çœ‹å†³ç­–å‡½æ•°çš„æ­£è´Ÿå·æ¥å†çŽ°é¢„æµ‹å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Thresholded decision function:\n&#123;&#125;'</span>.format(</span><br><span class="line">    gbrt.decision_function(X_test) &gt; <span class="number">0</span>))</span><br><span class="line">print(<span class="string">"Predictions:\n&#123;&#125;"</span>.format(gbrt.predict(X_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Thresholded decision function:</span><br><span class="line">[ True False False False  True  True False  True  True  True False  True</span><br><span class="line">  True False  True False False False  True  True  True  True  True False</span><br><span class="line"> False]</span><br><span class="line">Predictions:</span><br><span class="line">[&apos;red&apos; &apos;blue&apos; &apos;blue&apos; &apos;blue&apos; &apos;red&apos; &apos;red&apos; &apos;blue&apos; &apos;red&apos; &apos;red&apos; &apos;red&apos; &apos;blue&apos;</span><br><span class="line"> &apos;red&apos; &apos;red&apos; &apos;blue&apos; &apos;red&apos; &apos;blue&apos; &apos;blue&apos; &apos;blue&apos; &apos;red&apos; &apos;red&apos; &apos;red&apos; &apos;red&apos;</span><br><span class="line"> &apos;red&apos; &apos;blue&apos; &apos;blue&apos;]</span><br></pre></td></tr></table></figure><p>å¯¹äºŽäºŒåˆ†ç±»é—®é¢˜ï¼Œâ€œåç±»â€å§‹ç»ˆæ˜¯<code>classes_</code>å±žæ€§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œâ€œæ­£â€ç±»æ˜¯<code>classes_</code>çš„ç¬¬äºŒä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œå¦‚æžœä½ æƒ³è¦å®Œå…¨å†çŽ°predictçš„è¾“å‡ºï¼Œéœ€è¦åˆ©ç”¨<code>classes_</code>å±žæ€§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†å¸ƒå°”å€¼True/Falseè½¬æ¢æˆ0å’Œ1</span></span><br><span class="line">greater_zero = (gbrt.decision_function(X_test) &gt; <span class="number">0</span>).astype(int)</span><br><span class="line"><span class="comment"># åˆ©ç”¨0å’Œ1ä½œä¸ºclasses_çš„ç´¢å¼•</span></span><br><span class="line">pred = gbrt.classes_[greater_zero]</span><br><span class="line"><span class="comment"># predä¸Žgbrt.predictçš„è¾“å‡ºå®Œå…¨ç›¸åŒ</span></span><br><span class="line">print(<span class="string">'pred is equal to predictions: &#123;&#125;'</span>.format(</span><br><span class="line">    np.all(pred == gbrt.predict(X_test))))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pred is equal to predictions: True</span><br></pre></td></tr></table></figure><p><code>decision_function</code>å¯ä»¥åœ¨ä»»æ„èŒƒå›´å–å€¼ï¼Œè¿™å–å†³äºŽæ•°æ®å’Œæ¨¡åž‹å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">decision_function = gbrt.decision_function(X_test)</span><br><span class="line">print(<span class="string">"Decision function minimum: &#123;:.2f&#125; maximum: &#123;:.2f&#125;"</span>.format(</span><br><span class="line">    np.min(decision_function), np.max(decision_function)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Decision function minimum: -7.69 maximum: 4.29</span><br></pre></td></tr></table></figure><p>ç”±äºŽå¯ä»¥ä»»æ„ç¼©æ”¾ï¼Œå› æ­¤<code>decision_function</code>çš„è¾“å‡ºå¾€å¾€å¾ˆéš¾è§£é‡Šã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨é¢œè‰²ç¼–ç åœ¨äºŒç»´å¹³é¢ä¸­ç”»å‡ºæ‰€æœ‰ç‚¹çš„<code>decision_function</code>ï¼Œè¿˜æœ‰å†³ç­–è¾¹ç•Œã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fit, axes = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">13</span>, <span class="number">5</span>))</span><br><span class="line">mglearn.tools.plot_2d_separator(gbrt, X, ax=axes[<span class="number">0</span>], alpha=<span class="number">.4</span>,</span><br><span class="line">    fill=<span class="literal">True</span>, cm=mglearn.cm2)</span><br><span class="line">scores_image = mglearn.tools.plot_2d_scores(gbrt, X, ax=axes[<span class="number">1</span>],</span><br><span class="line">    alpha=<span class="number">.4</span>, cm=mglearn.ReBl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ax <span class="keyword">in</span> axes:</span><br><span class="line">    <span class="comment"># ç”»å‡ºè®­ç»ƒç‚¹å’Œæµ‹è¯•ç‚¹</span></span><br><span class="line">    mglearn.discrete_scatter(X_test[:, <span class="number">0</span>], X_test[:, <span class="number">1</span>], y_test,</span><br><span class="line">        markers=<span class="string">'^'</span>, ax=ax)</span><br><span class="line">    mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train,</span><br><span class="line">        markers=<span class="string">'o'</span>, ax=ax)</span><br><span class="line">    ax.set_xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">cbar = plt.colorbar(scores_image, ax=axes.tolist())</span><br><span class="line">axes[<span class="number">0</span>].legend([<span class="string">'Test class 0'</span>, <span class="string">'Test class 1'</span>, <span class="string">'Train class 0'</span>,</span><br><span class="line">    <span class="string">'Train class 1'</span>], ncol=<span class="number">4</span>, loc=(<span class="number">.1</span>, <span class="number">1.05</span>))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-and-decision-function-of-gbrt.png"></p><p>æ—¢ç»™å‡ºé¢„æµ‹ç»“æžœï¼Œåˆç»™å‡ºåˆ†ç±»å™¨çš„ç½®ä¿¡ç¨‹åº¦ï¼Œè¿™æ ·ç»™å‡ºçš„ä¿¡æ¯é‡æ›´å¤§ã€‚ä½†åœ¨ä¸Šé¢çš„å†³ç­–å‡½æ•°å›¾åƒï¼ˆå³ï¼‰ä¸­ï¼Œå¾ˆéš¾åˆ†è¾¨å‡ºä¸¤ä¸ªç±»åˆ«ä¹‹é—´çš„è¾¹ç•Œã€‚</p><h2 id="é¢„æµ‹æ¦‚çŽ‡">é¢„æµ‹æ¦‚çŽ‡</h2><p><code>predict_proba</code>çš„è¾“å‡ºæ˜¯æ¯ä¸ªç±»åˆ«çš„æ¦‚çŽ‡ï¼Œé€šå¸¸æ¯”<code>decision_function</code>çš„è¾“å‡ºæ›´å®¹æ˜“ç†è§£ã€‚å¯¹äºŽäºŒåˆ†ç±»é—®é¢˜ï¼Œå®ƒçš„å½¢çŠ¶å§‹ç»ˆæ˜¯<code>(n_samples, 2)</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Shape of probabilities: &#123;&#125;'</span>.format(gbrt.predict_proba(X_test).shape))</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºpredict_probaçš„å‰å‡ ä¸ªå…ƒç´ </span></span><br><span class="line">print(<span class="string">'Predicted probabilities:\n&#123;&#125;'</span>.format(</span><br><span class="line">    gbrt.predict_proba(X_test[:<span class="number">6</span>])))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Shape of probabilities: (25, 2)</span><br><span class="line">Predicted probabilities:</span><br><span class="line">[[0.01573626 0.98426374]</span><br><span class="line"> [0.84575649 0.15424351]</span><br><span class="line"> [0.98112869 0.01887131]</span><br><span class="line"> [0.97406775 0.02593225]</span><br><span class="line"> [0.01352142 0.98647858]</span><br><span class="line"> [0.02504637 0.97495363]]</span><br></pre></td></tr></table></figure><p>æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç¬¬ä¸€ä¸ªç±»åˆ«çš„ä¼°è®¡æ¦‚çŽ‡ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç¬¬äºŒä¸ªç±»åˆ«çš„ä¼°è®¡æ¦‚çŽ‡ã€‚ç”±äºŽ<code>predict_proba</code>çš„è¾“å‡ºæ˜¯ä¸€ä¸ªæ¦‚çŽ‡ï¼Œå› æ­¤æ€»æ˜¯åœ¨0å’Œ1ä¹‹é—´ï¼Œä¸¤ä¸ªç±»åˆ«çš„å…ƒç´ ä¹‹å’Œå§‹ç»ˆä¸º1ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªç±»åˆ«çš„æ¦‚çŽ‡è¶…è¿‡50%ã€‚è¿™ä¸ªç±»åˆ«å°±æ˜¯æ¨¡åž‹çš„é¢„æµ‹ç»“æžœï¼ˆç”±äºŽæ¦‚çŽ‡æ˜¯æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥ä¸å¤ªå¯èƒ½ä¸¤ä¸ªéƒ½ç­‰äºŽ0.500ã€‚ä½†å¦‚æžœå‡ºçŽ°äº†è¿™ç§æƒ…å†µï¼Œé¢„æµ‹ç»“æžœæ˜¯éšæœºé€‰æ‹©çš„ï¼‰ã€‚</p><p>åœ¨ä¸Šä¸€ä¸ªè¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆ†ç±»å™¨å¯¹å¤§éƒ¨åˆ†ç‚¹çš„ç½®ä¿¡ç¨‹åº¦éƒ½æ˜¯ç›¸å¯¹è¾ƒé«˜çš„ã€‚<strong>ä¸ç¡®å®šåº¦å¤§å°å®žé™…ä¸Šåæ˜ äº†æ•°æ®ä¾èµ–äºŽæ¨¡åž‹å’Œå‚æ•°çš„ä¸ç¡®å®šåº¦ã€‚è¿‡æ‹Ÿåˆæ›´å¼ºçš„æ¨¡åž‹å¯èƒ½ä¼šåšå‡ºç½®ä¿¡ç¨‹åº¦æ›´é«˜çš„é¢„æµ‹ï¼Œå³ä½¿å¯èƒ½æ˜¯é”™çš„ã€‚å¤æ‚åº¦è¶Šä½Žçš„æ¨¡åž‹é€šå¸¸å¯¹é¢„æµ‹çš„ä¸ç¡®å®šåº¦è¶Šå¤§ã€‚</strong>å¦‚æžœæ¨¡åž‹ç»™å‡ºçš„ä¸ç¡®å®šåº¦ç¬¦åˆå®žé™…æƒ…å†µï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡åž‹è¢«ç§°ä¸º<strong>æ ¡æ­£</strong>ï¼ˆcalibratedï¼‰æ¨¡åž‹ã€‚åœ¨æ ¡æ­£æ¨¡åž‹ä¸­ï¼Œå¦‚æžœé¢„æµ‹æœ‰70%çš„ç¡®å®šåº¦ï¼Œé‚£ä¹ˆå®ƒåœ¨70%çš„æƒ…å†µä¸‹æ­£ç¡®ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡ç»™å‡ºè¯¥æ•°æ®é›†çš„å†³ç­–è¾¹ç•Œï¼Œä»¥åŠç±»åˆ«1çš„é¢„æµ‹æ¦‚çŽ‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fit, axes = plt.subplots(<span class="number">1</span>, <span class="number">2</span>, figsize=(<span class="number">13</span>, <span class="number">5</span>))</span><br><span class="line">mglearn.tools.plot_2d_separator(gbrt, X, ax=axes[<span class="number">0</span>], alpha=<span class="number">.4</span>,</span><br><span class="line">    fill=<span class="literal">True</span>, cm=mglearn.cm2)</span><br><span class="line">scores_image = mglearn.tools.plot_2d_scores(gbrt, X, ax=axes[<span class="number">1</span>],</span><br><span class="line">    alpha=<span class="number">.4</span>, cm=mglearn.ReBl, function=<span class="string">'predict_proba'</span>)  <span class="comment"># proba</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ax <span class="keyword">in</span> axes:</span><br><span class="line">    <span class="comment"># ç”»å‡ºè®­ç»ƒç‚¹å’Œæµ‹è¯•ç‚¹</span></span><br><span class="line">    mglearn.discrete_scatter(X_test[:, <span class="number">0</span>], X_test[:, <span class="number">1</span>], y_test,</span><br><span class="line">        markers=<span class="string">'^'</span>, ax=ax)</span><br><span class="line">    mglearn.discrete_scatter(X_train[:, <span class="number">0</span>], X_train[:, <span class="number">1</span>], y_train,</span><br><span class="line">        markers=<span class="string">'o'</span>, ax=ax)</span><br><span class="line">    ax.set_xlabel(<span class="string">'Feature 0'</span>)</span><br><span class="line">    ax.set_ylabel(<span class="string">'Feature 1'</span>)</span><br><span class="line">cbar = plt.colorbar(scores_image, ax=axes.tolist())</span><br><span class="line">axes[<span class="number">0</span>].legend([<span class="string">'Test class 0'</span>, <span class="string">'Test class 1'</span>, <span class="string">'Train class 0'</span>,</span><br><span class="line">    <span class="string">'Train class 1'</span>], ncol=<span class="number">4</span>, loc=(<span class="number">.1</span>, <span class="number">1.05</span>))</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/decision-boundary-and-predict-proba-of-gbrt.png"></p><p>è¿™å¼ å›¾ä¸­çš„è¾¹ç•Œæ›´åŠ æ˜Žç¡®ï¼Œä¸ç¡®å®šçš„å°å—åŒºåŸŸæ¸…æ™°å¯è§ã€‚</p><h2 id="å¤šåˆ†ç±»é—®é¢˜çš„ä¸ç¡®å®šåº¦">å¤šåˆ†ç±»é—®é¢˜çš„ä¸ç¡®å®šåº¦</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè®¨è®ºäº†äºŒåˆ†ç±»é—®é¢˜ä¸­çš„ä¸ç¡®å®šåº¦ä¼°è®¡ã€‚ä½†<code>decision_function</code>å’Œ<code>predict_proba</code>ä¹Ÿé€‚ç”¨äºŽå¤šåˆ†ç±»é—®é¢˜ã€‚æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªå‡½æ•°åº”ç”¨äºŽé¸¢å°¾èŠ±ï¼ˆIrisï¼‰æ•°æ®é›†ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸‰åˆ†ç±»æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"></span><br><span class="line">iris = load_iris()</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">    iris.data, iris.target, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">gbrt = GradientBoostingClassifier(learning_rate=<span class="number">0.01</span>, random_state=<span class="number">0</span>)</span><br><span class="line">gbrt.fit(X_train, y_train)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Decision function shape: &#123;&#125;'</span>.format(gbrt.decision_function(X_test).shape))</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå†³ç­–å‡½æ•°çš„å‰å‡ ä¸ªå…ƒç´ </span></span><br><span class="line">print(<span class="string">'Decision function:\n&#123;&#125;'</span>.format(gbrt.decision_function(X_test)[:<span class="number">6</span>, :]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Decision function shape: (38, 3)</span><br><span class="line">Decision function:</span><br><span class="line">[[-1.9957153   0.04758118 -1.92721297]</span><br><span class="line"> [ 0.0614655  -1.90755689 -1.92793177]</span><br><span class="line"> [-1.99058105 -1.87637856  0.09686741]</span><br><span class="line"> [-1.9957153   0.04758118 -1.92721297]</span><br><span class="line"> [-1.99730166 -0.13469231 -1.20341532]</span><br><span class="line"> [ 0.0614655  -1.90755689 -1.92793177]]</span><br></pre></td></tr></table></figure><p>å¯¹äºŽå¤šåˆ†ç±»çš„æƒ…å†µï¼Œ<code>decision_function</code>çš„å½¢çŠ¶ä¸º<code>(n_samples, n_classes)</code>ï¼Œæ¯ä¸€åˆ—å¯¹åº”æ¯ä¸ªç±»åˆ«çš„â€œç¡®å®šåº¦åˆ†æ•°â€ï¼Œåˆ†æ•°è¾ƒé«˜çš„ç±»åˆ«å¯èƒ½æ€§æ›´å¤§ï¼Œå¾—åˆ†è¾ƒä½Žçš„ç±»åˆ«å¯èƒ½æ€§è¾ƒå°ã€‚ä½ å¯ä»¥æ‰¾å‡ºæ¯ä¸ªæ•°æ®ç‚¹çš„æœ€å¤§å…ƒç´ ï¼Œä»Žè€Œåˆ©ç”¨è¿™äº›åˆ†æ•°å†çŽ°é¢„æµ‹ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Argmax of decision function:\n&#123;&#125;'</span>.format(</span><br><span class="line">    np.argmax(gbrt.decision_function(X_test), axis=<span class="number">1</span>)))</span><br><span class="line">print(<span class="string">'Predictions:\n&#123;&#125;'</span>.format(gbrt.predict(X_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Argmax of decision function:</span><br><span class="line">[1 0 2 1 1 0 1 2 1 1 2 0 0 0 0 1 2 1 1 2 0 2 0 2 2 2 2 2 0 0 0 0 1 0 0 2 1</span><br><span class="line"> 0]</span><br><span class="line">Predictions:</span><br><span class="line">[1 0 2 1 1 0 1 2 1 1 2 0 0 0 0 1 2 1 1 2 0 2 0 2 2 2 2 2 0 0 0 0 1 0 0 2 1</span><br><span class="line"> 0]</span><br></pre></td></tr></table></figure><p><code>predict_proba</code>è¾“å‡ºçš„å½¢çŠ¶ç›¸åŒï¼Œä¹Ÿæ˜¯<code>(n_samples, n_classes)</code>ã€‚åŒæ ·ï¼Œæ¯ä¸ªæ•°æ®ç‚¹æ‰€æœ‰å¯èƒ½ç±»åˆ«çš„æ¦‚çŽ‡ä¹‹å’Œä¸º1ã€‚åŒæ ·å¯ä»¥é€šè¿‡è®¡ç®—<code>predict_proba</code>çš„argmaxæ¥å†çŽ°é¢„æµ‹ç»“æžœã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºpredict_probaçš„å‰å‡ ä¸ªå…ƒç´ </span></span><br><span class="line">print(<span class="string">'Predicted probabilities:\n&#123;&#125;'</span>.format(gbrt.predict_proba(X_test)[:<span class="number">6</span>]))</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ¯è¡Œçš„å’Œéƒ½æ˜¯1</span></span><br><span class="line">print(<span class="string">'Sums: &#123;&#125;'</span>.format(gbrt.predict_proba(X_test)[:<span class="number">6</span>].sum(axis=<span class="number">1</span>)))</span><br><span class="line"><span class="comment"># é€šè¿‡è®¡ç®—predict_probaçš„argmaxæ¥å†çŽ°é¢„æµ‹ç»“æžœ</span></span><br><span class="line">print(<span class="string">'Argmax of predicted probabilities:\n&#123;&#125;'</span>.format(</span><br><span class="line">    np.argmax(gbrt.predict_proba(X_test), axis=<span class="number">1</span>)))</span><br><span class="line">print(<span class="string">'Predictions:\n&#123;&#125;'</span>.format(gbrt.predict(X_test)))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Predicted probabilities:</span><br><span class="line">[[0.10217734 0.78840063 0.10942203]</span><br><span class="line"> [0.7834712  0.1093673  0.1071615 ]</span><br><span class="line"> [0.09818079 0.11005862 0.79176059]</span><br><span class="line"> [0.10217734 0.78840063 0.10942203]</span><br><span class="line"> [0.10360014 0.66723882 0.22916105]</span><br><span class="line"> [0.7834712  0.1093673  0.1071615 ]]</span><br><span class="line">Sums: [1. 1. 1. 1. 1. 1.]</span><br><span class="line">Argmax of predicted probabilities:</span><br><span class="line">[1 0 2 1 1 0 1 2 1 1 2 0 0 0 0 1 2 1 1 2 0 2 0 2 2 2 2 2 0 0 0 0 1 0 0 2 1</span><br><span class="line"> 0]</span><br><span class="line">Predictions:</span><br><span class="line">[1 0 2 1 1 0 1 2 1 1 2 0 0 0 0 1 2 1 1 2 0 2 0 2 2 2 2 2 0 0 0 0 1 0 0 2 1</span><br><span class="line"> 0]</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼Œ<code>predict_proba</code>å’Œ<code>decision_function</code>çš„å½¢çŠ¶å§‹ç»ˆç›¸åŒï¼Œéƒ½æ˜¯<code>(n_samples, n_classes)</code>â€”â€”é™¤äº†äºŒåˆ†ç±»ç‰¹æ®Šæƒ…å†µä¸‹çš„<code>decision_function</code>ã€‚å¯¹äºŽäºŒåˆ†ç±»çš„æƒ…å†µï¼Œ<code>decision_function</code>åªæœ‰ä¸€åˆ—ï¼Œå¯¹åº”â€œæ­£â€ç±»<code>classes_[1]</code>ã€‚è¿™ä¸»è¦æ˜¯ç”±äºŽåŽ†å²åŽŸå› ã€‚</p><p>å¦‚æžœæœ‰<code>n_classes</code>åˆ—ï¼Œä½ å¯ä»¥é€šè¿‡è®¡ç®—æ¯ä¸€åˆ—çš„argmaxæ¥å†çŽ°é¢„æµ‹ç»“æžœã€‚ä½†å¦‚æžœç±»åˆ«æ˜¯å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ•´æ•°ï¼Œä½†ä¸æ˜¯ä»Ž0å¼€å§‹çš„è¿žç»­æ•´æ•°çš„è¯ï¼Œä¸€å®šè¦å°å¿ƒã€‚å¦‚æžœä½ æƒ³è¦å¯¹æ¯”predictçš„ç»“æžœä¸Ž<code>decision_function</code>æˆ–<code>predict_proba</code>çš„ç»“æžœï¼Œä¸€å®šè¦ç”¨åˆ†ç±»å™¨çš„<code>classes_</code>å±žæ€§æ¥èŽ·å–çœŸå®žçš„å±žæ€§åç§°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">logreg = LogisticRegression()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨irisæ•°æ®é›†çš„ç±»åˆ«åç§°æ¥è¡¨ç¤ºæ¯ä¸€ä¸ªç›®æ ‡å€¼</span></span><br><span class="line">named_target = iris.target_names[y_train]</span><br><span class="line">logreg.fit(X_train, named_target)</span><br><span class="line">print(<span class="string">'unique classes in training data: &#123;&#125;'</span>.format(logreg.classes_))</span><br><span class="line">print(<span class="string">'predictions: &#123;&#125;'</span>.format(logreg.predict(X_test)[:<span class="number">10</span>]))</span><br><span class="line"></span><br><span class="line">argmax_dec_func = np.argmax(logreg.decision_function(X_test), axis=<span class="number">1</span>)</span><br><span class="line">print(<span class="string">'argmax of decision function: &#123;&#125;'</span>.format(argmax_dec_func[:<span class="number">10</span>]))</span><br><span class="line">print(<span class="string">'argmax combined with classes_: &#123;&#125;'</span>.format(</span><br><span class="line">    logreg.classes_[argmax_dec_func][:<span class="number">10</span>]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unique classes in training data: [&apos;setosa&apos; &apos;versicolor&apos; &apos;virginica&apos;]</span><br><span class="line">predictions: [&apos;versicolor&apos; &apos;setosa&apos; &apos;virginica&apos; &apos;versicolor&apos; &apos;versicolor&apos; &apos;setosa&apos;</span><br><span class="line"> &apos;versicolor&apos; &apos;virginica&apos; &apos;versicolor&apos; &apos;versicolor&apos;]</span><br><span class="line">argmax of decision function: [1 0 2 1 1 0 1 2 1 1]</span><br><span class="line">argmax combined with classes_: [&apos;versicolor&apos; &apos;setosa&apos; &apos;virginica&apos; &apos;versicolor&apos; &apos;versicolor&apos; &apos;setosa&apos;</span><br><span class="line"> &apos;versicolor&apos; &apos;virginica&apos; &apos;versicolor&apos; &apos;versicolor&apos;]</span><br></pre></td></tr></table></figure><h1 id="å°ç»“">å°ç»“</h1><p>æ¬ æ‹Ÿåˆæ˜¯æŒ‡ä¸€ä¸ªæ¨¡åž‹æ— æ³•èŽ·å–è®­ç»ƒæ•°æ®ä¸­çš„æ‰€æœ‰å˜åŒ–ï¼›è¿‡æ‹Ÿåˆæ˜¯æŒ‡æ¨¡åž‹è¿‡åˆ†å…³æ³¨è®­ç»ƒæ•°æ®ï¼Œä½†å¯¹æ–°æ•°æ®çš„æ³›åŒ–æ€§èƒ½ä¸å¥½ã€‚</p><p>å…³äºŽä½•æ—¶ä½¿ç”¨å“ªç§æ¨¡åž‹ï¼Œä¸‹é¢æ˜¯ä¸€ä»½å¿«é€Ÿæ€»ç»“ã€‚</p><ul><li><p>æœ€è¿‘é‚»</p><p>é€‚ç”¨äºŽå°åž‹æ•°æ®é›†ï¼Œæ˜¯å¾ˆå¥½çš„åŸºå‡†æ¨¡åž‹ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚</p></li><li><p>çº¿æ€§æ¨¡åž‹</p><p>éžå¸¸å¯é çš„é¦–é€‰ç®—æ³•ï¼Œé€‚ç”¨äºŽéžå¸¸å¤§çš„æ•°æ®é›†ï¼Œä¹Ÿé€‚ç”¨äºŽé«˜ç»´æ•°æ®ã€‚</p></li><li><p>æœ´ç´ è´å¶æ–¯</p><p>åªé€‚ç”¨äºŽåˆ†ç±»é—®é¢˜ã€‚æ¯”çº¿æ€§æ¨¡åž‹é€Ÿåº¦è¿˜å¿«ï¼Œé€‚ç”¨äºŽéžå¸¸å¤§çš„æ•°æ®é›†å’Œé«˜ç»´æ•°æ®ã€‚ç²¾åº¦é€šå¸¸è¦ä½ŽäºŽçº¿æ€§æ¨¡åž‹ã€‚</p></li><li><p>å†³ç­–æ ‘</p><p>è¿›åº¦å¾ˆå¿«ï¼Œä¸éœ€è¦æ•°æ®ç¼©æ”¾ï¼Œå¯ä»¥å¯è§†åŒ–ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚</p></li><li><p>éšæœºæ£®æž—</p><p>å‡ ä¹Žæ€»æ˜¯æ¯”å•æ£µå†³ç­–æ ‘çš„è¡¨çŽ°è¦å¥½ï¼Œé²æ£’æ€§å¾ˆå¥½ï¼Œéžå¸¸å¼ºå¤§ã€‚ä¸éœ€è¦æ•°æ®ç¼©æ”¾ã€‚ä¸é€‚ç”¨äºŽé«˜ç»´ç¨€ç–æ•°æ®ã€‚</p></li><li><p>æ¢¯åº¦æå‡å†³ç­–æ ‘</p><p>ç²¾åº¦é€šå¸¸æ¯”éšæœºæ£®æž—ç•¥é«˜ã€‚ä¸Žéšæœºæ£®æž—ç›¸æ¯”ï¼Œè®­ç»ƒé€Ÿåº¦æ»¡ï¼Œä½†é¢„æµ‹é€Ÿåº¦æ›´å¿«ï¼Œéœ€è¦çš„å†…å­˜ä¹Ÿæ›´å°‘ã€‚æ¯”éšæœºæ£®æž—éœ€è¦æ›´å¤šçš„å‚æ•°è°ƒèŠ‚ã€‚</p></li><li><p>æ”¯æŒå‘é‡æœº</p><p>å¯¹äºŽç‰¹å¾å«ä¹‰ç›¸ä¼¼çš„ä¸­ç­‰å¤§å°çš„æ•°æ®é›†å¾ˆå¼ºå¤§ã€‚éœ€è¦æ•°æ®ç¼©æ”¾ï¼Œå¯¹å‚æ•°æ•æ„Ÿã€‚</p></li><li><p>ç¥žç»ç½‘ç»œ</p><p>å¯ä»¥æž„å»ºéžå¸¸å¤æ‚çš„æ¨¡åž‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºŽå¤§åž‹æ•°æ®é›†è€Œè¨€ã€‚å¯¹æ•°æ®ç¼©æ”¾æ•æ„Ÿï¼Œå¯¹å‚æ•°é€‰å–æ•æ„Ÿã€‚å¤§åž‹ç½‘ç»œéœ€è¦å¾ˆé•¿çš„è®­ç»ƒæ—¶é—´ã€‚</p></li></ul><p>é¢å¯¹æ–°æ•°æ®é›†ï¼Œé€šå¸¸æœ€å¥½å…ˆä»Žç®€å•æ¨¡åž‹å¼€å§‹ï¼Œæ¯”å¦‚çº¿æ€§æ¨¡åž‹ã€æœ´ç´ è´å¶æ–¯æˆ–æœ€è¿‘é‚»åˆ†ç±»å™¨ï¼Œçœ‹èƒ½å¾—åˆ°ä»€ä¹ˆæ ·çš„ç»“æžœã€‚å¯¹æ•°æ®æœ‰äº†è¿›ä¸€æ­¥äº†è§£ä¹‹åŽï¼Œä½ å¯ä»¥è€ƒè™‘ç”¨äºŽæž„å»ºæ›´å¤æ‚æ¨¡åž‹çš„ç®—æ³•ï¼Œæ¯”å¦‚éšæœºæ£®æž—ã€æ¢¯åº¦æå‡å†³ç­–æ ‘ã€SVMæˆ–ç¥žç»ç½‘ç»œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> supervised </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»å…ƒç¼–ç¨‹</title>
      <link href="/notes/fluent-python/class-metaprogramming/"/>
      <url>/notes/fluent-python/class-metaprogramming/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ï¼ˆå…ƒç±»ï¼‰æ˜¯æ·±å¥¥çš„çŸ¥è¯†ï¼Œ99%çš„ç”¨æˆ·éƒ½æ— éœ€å…³æ³¨ã€‚å¦‚æžœä½ æƒ³çŸ¥é“æ˜¯å¦éœ€è¦ä½¿ç”¨å…ƒç±»ï¼Œæˆ‘å‘Šè¯‰ä½ ï¼Œä¸éœ€è¦ï¼ˆçœŸæ­£éœ€è¦ä½¿ç”¨å…ƒç±»çš„äººç¡®ä¿¡ä»–ä»¬éœ€è¦ï¼Œæ— éœ€è§£é‡ŠåŽŸå› ï¼‰ã€‚</p><p>â€”â€”Tim Petersï¼ˆTimsortç®—æ³•çš„å‘æ˜Žè€…ï¼Œæ´»è·ƒçš„Pythonè´¡çŒ®è€…ï¼‰</p></blockquote><p>ç±»å…ƒç¼–ç¨‹æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶åˆ›å»ºæˆ–å®šåˆ¶ç±»çš„æŠ€è‰ºã€‚åœ¨Pythonä¸­ï¼Œç±»æ˜¯ä¸€ç­‰å¯¹è±¡ï¼Œå› æ­¤ä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨å‡½æ•°æ–°å»ºç±»ï¼Œè€Œæ— éœ€ä½¿ç”¨classå…³é”®å­—ã€‚ç±»è£…é¥°å™¨ä¹Ÿæ˜¯å‡½æ•°ï¼Œä¸è¿‡èƒ½å¤Ÿå®¡æŸ¥ã€ä¿®æ”¹ï¼Œç”šè‡³æŠŠè¢«è£…é¥°çš„ç±»æ›¿æ¢æˆå…¶ä»–ç±»ã€‚</p><p>å…ƒç±»æ˜¯ç±»å…ƒç¼–ç¨‹æœ€é«˜çº§çš„å·¥å…·ï¼šä½¿ç”¨å…ƒç±»å¯ä»¥åˆ›å»ºå…·æœ‰æŸç§ç‰¹è´¨çš„å…¨æ–°ç±»ç§ï¼Œä¾‹å¦‚æŠ½è±¡åŸºç±»ã€‚å…ƒç±»åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯éš¾ä»¥æŽŒæ¡ã€‚ç±»è£…é¥°å™¨èƒ½ä½¿ç”¨æ›´ç®€å•çš„æ–¹å¼è§£å†³æ›´å¤šé—®é¢˜ã€‚</p><p><strong>é™¤éžå¼€å‘æ¡†æž¶ï¼Œå¦åˆ™ä¸è¦ç¼–å†™å…ƒç±»</strong>ã€‚</p><a id="more"></a><h1 id="ç±»å·¥åŽ‚å‡½æ•°">ç±»å·¥åŽ‚å‡½æ•°</h1><p>æœ¬ä¹¦å¤šæ¬¡æé«˜æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªç±»å·¥åŽ‚å‡½æ•°â€”â€”collections.namedtupleã€‚æˆ‘ä»¬æŠŠä¸€ä¸ªç±»åå’Œå‡ ä¸ªå±žæ€§åä¼ ç»™è¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªtupleçš„å­ç±»ï¼Œå…¶ä¸­çš„å…ƒç´ é€šè¿‡åç§°èŽ·å–ï¼Œè¿˜ä¸ºè°ƒè¯•æä¾›äº†å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼ˆ<code>__repr__</code>ï¼‰ã€‚</p><p>æœ‰æ—¶ï¼Œæˆ‘è§‰å¾—åº”è¯¥æœ‰ç±»ä¼¼çš„å·¥åŽ‚å‡½æ•°ï¼Œç”¨äºŽåˆ›å»ºå¯å˜å¯¹è±¡ã€‚å‡è®¾æˆ‘åœ¨ç¼–å†™ä¸€ä¸ªå® ç‰©ç‚¹åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘æƒ³æŠŠç‹—çš„æ•°æ®å½“ä½œç®€å•çš„è®°å½•å¤„ç†ã€‚ç¼–å†™ä¸‹é¢çš„æ ·æ¿ä»£ç è®©äººåŽŒçƒ¦ï¼š</p><figure class="highlight python"><figcaption><span>dog.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, weight, owner)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.owner = owner</span><br></pre></td></tr></table></figure><p>å„ä¸ªå­—æ®µåç§°å‡ºçŽ°äº†3æ¬¡ã€‚å†™äº†è¿™ä¹ˆå¤šæ ·æ¿ä»£ç ï¼Œç”šè‡³å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼éƒ½ä¸å‹å¥½ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dog <span class="keyword">import</span> Dog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rex = Dog(<span class="string">'Rex'</span>, <span class="number">30</span>, <span class="string">'Bob'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rex</span><br><span class="line">&lt;dog.Dog object at <span class="number">0x10dbd3ef0</span>&gt;</span><br></pre></td></tr></table></figure><p>å‚è€ƒcollections.namedtupleï¼Œä¸‹é¢æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªrecord_factoryå‡½æ•°ï¼Œå³æ—¶åˆ›å»ºç®€å•çš„ç±»ï¼ˆå¦‚Dogï¼‰ã€‚</p><figure class="highlight python"><figcaption><span>record_factory.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">record_factory</span><span class="params">(cls_name, field_names)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:  <span class="comment"># ä½“çŽ°äº†é¸­å­ç±»åž‹ï¼šå°è¯•åœ¨é€—å·æˆ–ç©ºæ ¼å¤„æ‹†åˆ†field_names</span></span><br><span class="line">        field_names = field_names.replace(<span class="string">','</span>, <span class="string">' '</span>).split()</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="keyword">pass</span>  <span class="comment"># å¦‚æžœå¤±è´¥ï¼Œé‚£ä¹ˆå‡å®šfield_namesæœ¬å°±æ˜¯å¯è¿­ä»£çš„å¯¹è±¡</span></span><br><span class="line">    field_names = tuple(field_names)  <span class="comment"># ä¸€ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªå±žæ€§å</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        attrs = dict(zip(self.__slots__, args))  <span class="comment"># ä½ç½®å‚æ•°</span></span><br><span class="line">        attrs.update(kwargs)  <span class="comment"># å…³é”®å­—å‚æ•°</span></span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> attrs.items():</span><br><span class="line">            setattr(self, name, value)  <span class="comment"># è®¾å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> self.__slots__:</span><br><span class="line">            <span class="keyword">yield</span> getattr(self, name)  <span class="comment"># æŒ‰é¡ºåºäº§å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>  <span class="comment"># ç”Ÿæˆå‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼</span></span><br><span class="line">        values = <span class="string">', '</span>.join(<span class="string">'&#123;&#125;=&#123;!r&#125;'</span>.format(*i) <span class="keyword">for</span> i</span><br><span class="line">                            <span class="keyword">in</span> zip(self.__slots__, self))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125;(&#123;&#125;)'</span>.format(self.__class__.__name__, values)</span><br><span class="line"></span><br><span class="line">    cls_attrs = dict(__slots__ = field_names,</span><br><span class="line">                     __init__ = __init__,</span><br><span class="line">                     __iter__ = __iter__,</span><br><span class="line">                     __repr__ = __repr__)</span><br><span class="line">    <span class="comment"># è°ƒç”¨typeæž„é€ æ–¹æ³•ï¼Œæž„å»ºæ–°ç±»</span></span><br><span class="line">    <span class="keyword">return</span> type(cls_name, (object,), cls_attrs)</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> record_factory <span class="keyword">import</span> record_factory</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog = record_factory(<span class="string">'Dog'</span>, <span class="string">'name weight owner'</span>)  <span class="comment"># ç­¾åä¸Žnamedtupleç±»ä¼¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rex = Dog(<span class="string">'Rex'</span>, <span class="number">30</span>, <span class="string">'Bob'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rex  <span class="comment"># å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼</span></span><br><span class="line">Dog(name=<span class="string">'Rex'</span>, weight=<span class="number">30</span>, owner=<span class="string">'Bob'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name, weight, owner = rex  <span class="comment"># ä¾¿åˆ©åœ°æ‹†åŒ…</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name, weight</span><br><span class="line">(<span class="string">'Rex'</span>, <span class="number">30</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"&#123;2&#125;'s dog weights &#123;1&#125;kg"</span>.format(*rex)  <span class="comment"># ä¼ ç»™formatç­‰å‡½æ•°æ—¶ä¹Ÿå¯ä»¥æ‹†åŒ…</span></span><br><span class="line"><span class="string">"Bob's dog weights 32kg"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rex.weight = <span class="number">32</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rex</span><br><span class="line">Dog(name=<span class="string">'Rex'</span>, weight=<span class="number">32</span>, owner=<span class="string">'Bob'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Dog.__mro__  <span class="comment"># ç»§æ‰¿è‡ªobjectï¼Œä¸Žåˆ›å»ºå®ƒçš„å·¥åŽ‚å‡½æ•°æ²¡æœ‰å…³ç³»</span></span><br><span class="line">(&lt;class 'record_factory.Dog'&gt;, &lt;class 'object'&gt;)</span><br></pre></td></tr></table></figure><p><strong>é€šå¸¸ï¼Œæˆ‘ä»¬æŠŠtypeè§†ä½œå‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬åƒå‡½æ•°é‚£æ ·ä½¿ç”¨å®ƒ</strong>ï¼Œä¾‹å¦‚ï¼Œè°ƒç”¨type(my_object)èŽ·å–å¯¹è±¡æ‰€å±žçš„ç±»â€”â€”ä½œç”¨ä¸Ž<code>my_object.__class__</code>ç›¸åŒã€‚ç„¶è€Œï¼Œtypeæ˜¯ä¸€ä¸ªç±»ã€‚ä¼ å…¥ä¸‰ä¸ªå‚æ•°å¯ä»¥æ–°å»ºä¸€ä¸ªç±»ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/functions#type" target="_blank" rel="noopener"><code>class type(object)</code></a></p><p><code>class type(name, bases, dict)</code></p><p>With one argument, return the type of an object. The return value is a type object and generally the same object as returned by <code>object.__class__</code>.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MyClass = type(<span class="string">'MyClass'</span>, (MySuperClass, MyMixin), &#123;<span class="string">'x'</span>: <span class="number">42</span>, <span class="string">'x2'</span>: <span class="keyword">lambda</span> self: self.x * <span class="number">2</span>&#125;)</span><br><span class="line"><span class="comment"># ç­‰ä»·äºŽ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(MySuperClass, MyMixin)</span>:</span></span><br><span class="line">    x = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x2</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.x * <span class="number">2</span></span><br></pre></td></tr></table></figure><p>è®©äººè§‰å¾—æ–°å¥‡çš„æ˜¯ï¼Œ<strong>typeçš„å®žä¾‹æ˜¯ç±»</strong>ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>record_factory</code>å‡½æ•°çš„æœ€åŽä¸€è¡Œä¼šæž„å»ºä¸€ä¸ªç±»ï¼Œç±»çš„åç§°æ˜¯<code>cls_name</code>å‚æ•°çš„å€¼ï¼Œå”¯ä¸€çš„ç›´æŽ¥è¶…ç±»æ˜¯objectï¼Œæœ‰<code>__slots__</code>ã€<code>__init__</code>ã€<code>__iter__</code>å’Œ<code>__repr__</code>å››ä¸ªç±»å±žæ€§ï¼Œå…¶ä¸­åŽä¸‰ä¸ªæ˜¯å®žä¾‹æ–¹æ³•ã€‚</p><p>æŠŠä¸‰ä¸ªå‚æ•°ä¼ ç»™typeæ˜¯åŠ¨æ€åˆ›å»ºç±»çš„å¸¸ç”¨æ–¹å¼ã€‚å¦‚æžœæŸ¥çœ‹namedtupleå‡½æ•°çš„è¿œå—ï¼Œä½ ä¼šå‘çŽ°å¦ä¸€ä¸ªç§æ–¹å¼ï¼šå…ˆå£°æ˜Žä¸€ä¸ª<code>_class_template</code>å˜é‡ï¼Œå…¶å€¼æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„æºç æ¨¡æ¿ï¼›ç„¶åŽåœ¨namedtupleå‡½æ•°ä¸­è°ƒç”¨<code>_class_template.format(...)</code>æ–¹æ³•ï¼Œå¡«å……æ¨¡æ¿é‡Œçš„ç©ºç™½ï¼›æœ€åŽï¼Œä½¿ç”¨å†…ç½®çš„execå‡½æ•°è®¡ç®—å¾—åˆ°çš„æºç å­—ç¬¦ä¸²ã€‚</p><p>åœ¨Pythonä¸­åšå…ƒç¼–ç¨‹æ—¶ï¼Œæœ€å¥½ä¸ç”¨execå’Œevalå‡½æ•°ã€‚å¦‚æžœæŽ¥æ”¶çš„å­—ç¬¦ä¸²ï¼ˆæˆ–ç‰‡æ®µï¼‰æ¥è‡ªä¸å¯ä¿¡çš„æºï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°ä¼šå¸¦æ¥ä¸¥é‡çš„å®‰å…¨é£Žé™©ã€‚Pythonæä¾›äº†å……è¶³çš„å†…çœå·¥å…·ï¼Œå¤§å¤šæ•°æ—¶å€™éƒ½ä¸éœ€è¦ä½¿ç”¨execå’Œevalå‡½æ•°ã€‚ç„¶è€Œï¼ŒPythonæ ¸å¿ƒå¼€å‘è€…å®žçŽ°namedtupleå‡½æ•°æ—¶é€‰æ‹©äº†ä½¿ç”¨execå‡½æ•°ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†è®©ç”Ÿæˆçš„ç±»ä»£ç èƒ½é€šè¿‡<code>._source</code>å±žæ€§èŽ·å–ã€‚</p><p>record_factoryå‡½æ•°åˆ›å»ºçš„ç±»ï¼Œå…¶å®žä¾‹æœ‰ä¸ªå±€é™â€”â€”ä¸èƒ½åºåˆ—åŒ–ï¼Œå³ä¸èƒ½ä½¿ç”¨pickleæ¨¡å—é‡Œçš„dump/loadå‡½æ•°å¤„ç†ã€‚å¦‚æžœæƒ³äº†è§£å®Œæ•´çš„æ–¹æ¡ˆï¼Œè¯·åˆ†æžcollections.namedtupleå‡½æ•°çš„æºç ï¼Œæœç´¢â€œpicklingâ€è¿™ä¸ªè¯ã€‚</p><h1 id="å®šåˆ¶æè¿°ç¬¦çš„ç±»è£…é¥°å™¨">å®šåˆ¶æè¿°ç¬¦çš„ç±»è£…é¥°å™¨</h1><p>LineItemç¤ºä¾‹è¿˜æœ‰ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼šå‚¨å­˜å±žæ€§çš„åç§°ä¸å…·æœ‰æè¿°æ€§ï¼Œå³å±žæ€§ï¼ˆå¦‚weightï¼‰çš„å€¼å­˜å‚¨åœ¨åä¸º<code>_Quantity#0</code>çš„å®žä¾‹å±žæ€§ä¸­ï¼Œè¿™æ ·çš„åç§°æœ‰ç‚¹ä¸ä¾¿äºŽè°ƒè¯•ã€‚å¦‚æžœå‚¨å­˜å±žæ€§çš„åç§°ä¸­åŒ…å«æ‰˜ç®¡å±žæ€§çš„åç§°æ›´å¥½ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>LineItem.weight.storage_name</span><br><span class="line"><span class="string">'_Quantity#weight'</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æè¿°æ€§çš„å‚¨å­˜å±žæ€§åç§°ï¼Œå› ä¸ºå®žä¾‹åŒ–æè¿°ç¬¦æ—¶æ— æ³•å¾—çŸ¥æ‰˜ç®¡å±žæ€§çš„åç§°ã€‚å¯æ˜¯ï¼Œä¸€æ—¦ç»„å»ºå¥½æ•´ä¸ªç±»ï¼Œè€Œä¸”æŠŠæè¿°ç¬¦ç»‘å®šåˆ°ç±»å±žæ€§ä¸Šä¹‹åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å®¡æŸ¥ç±»ï¼Œå¹¶ä¸ºæè¿°ç¬¦è®¾å€¼åˆç†çš„å‚¨å­˜å±žæ€§åç§°ã€‚</p><p>LineItemç±»çš„<code>__new__</code>æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› æ­¤ï¼Œåœ¨<code>__init__</code>æ–¹æ³•ä¸­ä½¿ç”¨æè¿°ç¬¦æ—¶ï¼Œå‚¨å­˜å±žæ€§å·²ç»è®¾ç½®äº†æ­£ç¡®çš„åç§°ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œä½¿ç”¨<code>__new__</code>æ–¹æ³•çº¯å±žç™½è´¹åŠ›æ°”ï¼šæ¯æ¬¡æ–°å»ºLineItemå®žä¾‹æ—¶éƒ½ä¼šè¿è¡Œ<code>__new__</code>æ–¹æ³•ä¸­çš„é€»è¾‘ï¼Œå¯æ˜¯ï¼Œä¸€æ—¦LineItemç±»æž„å»ºå¥½äº†ï¼Œæè¿°ç¬¦ä¸Žæ‰˜ç®¡å±žæ€§ä¹‹é—´çš„ç»‘å®šå°±ä¸ä¼šå˜äº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦åœ¨åˆ›å»ºç±»æ—¶è®¾ç½®å‚¨å­˜å±žæ€§çš„åç§°ã€‚ä½¿ç”¨ç±»è£…é¥°å™¨æˆ–å…ƒç±»å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ç±»è£…é¥°å™¨ä¸Žå‡½æ•°è£…é¥°å™¨éžå¸¸ç±»ä¼¼ï¼Œæ˜¯å‚æ•°ä¸ºç±»å¯¹è±¡çš„å‡½æ•°ï¼Œè¿”å›žåŽŸæ¥çš„ç±»æˆ–ä¿®æ”¹åŽçš„ç±»ã€‚</p><figure class="highlight python"><figcaption><span>model_v5.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoStorage</span>:</span></span><br><span class="line">    __counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        cls = self.__class__</span><br><span class="line">        prefix = cls.__name__</span><br><span class="line">        index = cls.__counter</span><br><span class="line">        self.storage_name = <span class="string">'_&#123;&#125;#&#123;&#125;'</span>.format(prefix, index)</span><br><span class="line">        cls.__counter += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> getattr(instance, self.storage_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        setattr(instance, self.storage_name, value)  <span class="comment"># æ— éªŒè¯</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Validate</span><span class="params">(abc.ABC, AutoStorage)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        value = self.validate(instance, value)  <span class="comment"># å§”æ‰˜validateæ–¹æ³•</span></span><br><span class="line">        super().__set__(instance, value)  <span class="comment"># ç„¶åŽæŠŠè¿”å›žçš„valueä¼ ç»™è¶…ç±»çš„__set__æ–¹æ³•ï¼Œå­˜å‚¨å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, instance, value)</span>:</span>  <span class="comment"># æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">        <span class="string">"""return validated value or raise ValueError"""</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quantity</span><span class="params">(Validate)</span>:</span></span><br><span class="line">    <span class="string">"""a number greater than zero"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonBlank</span><span class="params">(Validate)</span>:</span></span><br><span class="line">    <span class="string">"""a string with at least one non-space character"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        value = value.strip()</span><br><span class="line">        <span class="keyword">if</span> len(value) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value cannot be empty or blank'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>model_v6.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> model_v5 <span class="keyword">import</span> Validate, Quantity, NonBlank</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entity</span><span class="params">(cls)</span>:</span>  <span class="comment"># å‚æ•°æ˜¯ä¸€ä¸ªç±»</span></span><br><span class="line">    <span class="keyword">for</span> key, attr <span class="keyword">in</span> cls.__dict__.items():</span><br><span class="line">        <span class="keyword">if</span> isinstance(attr, Validate):</span><br><span class="line">            type_name = type(attr).__name__</span><br><span class="line">            <span class="comment"># ä½¿ç”¨æè¿°ç¬¦ç±»çš„åç§°å’Œæ‰˜ç®¡å±žæ€§çš„åç§°å‘½åstorage_name</span></span><br><span class="line">            attr.storage_name = <span class="string">'_&#123;&#125;#&#123;&#125;'</span>.format(type_name, key)</span><br><span class="line">    <span class="keyword">return</span> cls  <span class="comment"># è¿”å›žä¿®æ”¹åŽçš„ç±»</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>bulkfood_v6.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> model_v6 <span class="keyword">as</span> model</span><br><span class="line"></span><br><span class="line"><span class="meta">@model.entity  # LineItemç±»å”¯ä¸€çš„å˜åŒ–</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    description = model.NonBlank()</span><br><span class="line">    weight = model.Quantity()</span><br><span class="line">    price = model.Quantity()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v6 <span class="keyword">import</span> LineItem</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>raisins = LineItem(<span class="string">'Golden raisins'</span>, <span class="number">10</span>, <span class="number">6.95</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(raisins)[:<span class="number">3</span>]</span><br><span class="line">[<span class="string">'_NonBlank#description'</span>, <span class="string">'_Quantity#price'</span>, <span class="string">'_Quantity#weight'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>LineItem.description.storage_name</span><br><span class="line"><span class="string">'_NonBlank#description'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>raisins.description</span><br><span class="line"><span class="string">'Golden raisins'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(raisins, <span class="string">'_NonBlank#description'</span>)</span><br><span class="line"><span class="string">'Golden raisins'</span></span><br></pre></td></tr></table></figure><p>ç±»è£…é¥°å™¨èƒ½ä»¥æ¯”è¾ƒç®€å•çš„æ–¹å¼åšåˆ°ä»¥å‰éœ€è¦ä½¿ç”¨å…ƒç±»åŽ»åšçš„äº‹æƒ…â€”â€”åˆ›å»ºç±»æ—¶å®šåˆ¶ç±»ã€‚<strong>ç±»è£…é¥°å™¨æœ‰ä¸ªé‡å¤§ç¼ºç‚¹ï¼šåªå¯¹ç›´æŽ¥ä¾é™„çš„ç±»æœ‰æ•ˆã€‚è¿™æ„å‘³ç€ï¼Œè¢«è£…é¥°çš„ç±»çš„å­ç±»å¯èƒ½ç»§æ‰¿ä¹Ÿå¯èƒ½ä¸ç»§æ‰¿è£…é¥°å™¨æ‰€åšçš„æ”¹åŠ¨ï¼Œå…·ä½“æƒ…å†µè§†æ”¹åŠ¨çš„æ–¹å¼è€Œå®šã€‚</strong>æŽ¥ä¸‹æ¥ä¼šæŽ¢è®¨è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚</p><h1 id="å¯¼å…¥æ—¶å’Œè¿è¡Œæ—¶æ¯”è¾ƒ">å¯¼å…¥æ—¶å’Œè¿è¡Œæ—¶æ¯”è¾ƒ</h1><p>ä¸ºäº†æ­£ç¡®åœ°åšå…ƒç¼–ç¨‹ï¼Œä½ å¿…é¡»çŸ¥é“Pythonè§£é‡Šå™¨ä»€ä¹ˆæ—¶å€™è®¡ç®—å„ä¸ªä»£ç å—ã€‚Pythonç¨‹åºå‘˜ä¼šåŒºåˆ†â€œå¯¼å…¥æ—¶â€å’Œâ€œè¿è¡Œæ—¶â€ï¼Œä¸è¿‡è¿™ä¸¤ä¸ªæœ¯è¯­æ²¡æœ‰ä¸¥æ ¼çš„å®šä¹‰ï¼Œè€Œä¸”äºŒè€…ä¹‹é—´å­˜åœ¨ç€ç°è‰²åœ°å¸¦ã€‚åœ¨å¯¼å…¥æ—¶ï¼Œè§£é‡Šå™¨ä¼šä»Žä¸Šåˆ°ä¸‹ä¸€æ¬¡æ€§è§£æžå®Œæ¨¡å—çš„æºç ï¼Œç„¶åŽç”Ÿæˆç”¨äºŽæ‰§è¡Œçš„å­—èŠ‚ç ã€‚å¦‚æžœå¥æ³•æœ‰é”™è¯¯ï¼Œå°±åœ¨æ­¤æ—¶æŠ¥å‘Šã€‚å¦‚æžœæœ¬åœ°çš„æ–‡ä»¶å¤¹ä¸­æœ‰<code>__pycache__</code>æ–‡ä»¶å¤¹ä¸­æœ‰æœ€æ–°çš„.pycæ–‡ä»¶ï¼Œè§£é‡Šå™¨ä¼šè·³è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œå› ä¸ºå·²ç»æœ‰è¿è¡Œæ‰€éœ€çš„å­—èŠ‚ç äº†ã€‚</p><p>ç¼–è¯‘è‚¯å®šæ˜¯å¯¼å…¥æ—¶çš„æ´»åŠ¨ï¼Œä¸è¿‡é‚£ä¸ªæ—¶æœŸè¿˜ä¼šåšå…¶ä»–äº‹ï¼Œå› ä¸ºPythonä¸­çš„è¯­å¥å‡ ä¹Žéƒ½æ˜¯å¯æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¯­å¥å¯èƒ½ä¼šè¿è¡Œç”¨æˆ·ä»£ç ï¼Œä¿®æ”¹ç”¨æˆ·ç¨‹åºçš„çŠ¶æ€ã€‚å°¤å…¶æ˜¯importè¯­å¥ï¼Œå®ƒä¸åªæ˜¯å£°æ˜Žï¼ˆJavaä¸­çš„importè¯­å¥åˆ™åªæ˜¯å£°æ˜Žï¼Œç”¨äºŽå‘ŠçŸ¥ç¼–è¾‘å™¨éœ€è¦ç‰¹å®šçš„åŒ…ï¼‰ï¼Œåœ¨è¿›ç¨‹ä¸­é¦–æ¬¡å¯¼å…¥æ¨¡å—æ—¶ï¼Œè¿˜ä¼šè¿è¡Œæ‰€å¯¼å…¥æ¨¡å—ä¸­çš„å…¨éƒ¨é¡¶å±‚ä»£ç â€”â€”ä»¥åŽå¯¼å…¥ç›¸åŒçš„æ¨¡å—åˆ™ä½¿ç”¨ç¼“å­˜ï¼Œåªåšåç§°ç»‘å®šã€‚å“ªäº›é¡¶å±‚ä»£ç å¯ä»¥åšä»»ä½•äº‹ï¼ŒåŒ…æ‹¬é€šå¸¸åœ¨â€œè¿è¡Œæ—¶â€åšçš„äº‹ï¼Œä¾‹å¦‚è¿žæŽ¥æ•°æ®åº“ï¼ˆè™½ç„¶ä¸åº”è¯¥è¿™ä¹ˆåšï¼Œä½†æ˜¯å¯ä»¥åšåˆ°ï¼‰ã€‚å› æ­¤ï¼Œâ€œå¯¼å…¥æ—¶â€å’Œâ€œè¿è¡Œæ—¶â€ä¹‹é—´çš„ç•Œé™æ˜¯æ¨¡ç³Šçš„ï¼šimportè¯­å¥å¯ä»¥è§¦å‘ä»»ä½•â€œè¿è¡Œæ—¶â€è¡Œä¸ºã€‚</p><p>å¯¼å…¥æ—¶ä¼šâ€è¿è¡Œå…¨éƒ¨é¡¶å±‚ä»£ç â€œï¼Œä½†æ˜¯â€é¡¶å±‚ä»£ç â€ä¼šç»è¿‡ä¸€äº›åŠ å·¥ã€‚å¯¼å…¥æ¨¡å—æ—¶ï¼Œè§£é‡Šå™¨ä¼šæ‰§è¡Œé¡¶å±‚çš„defè¯­å¥ï¼Œè§£é‡Šå™¨ä¼šç¼–è¯‘å‡½æ•°çš„å®šä¹‰ä½“ï¼ˆé¦–æ¬¡å¯¼å…¥æ¨¡å—æ—¶ï¼‰ï¼ŒæŠŠå‡½æ•°å¯¹è±¡ç»‘å®šåˆ°å¯¹åº”çš„å…¨å±€åç§°ä¸Šï¼Œä½†æ˜¯æ˜¾ç„¶è§£é‡Šå™¨ä¸ä¼šæ‰§è¡Œå‡½æ•°çš„å®šä¹‰ä½“ã€‚é€šå¸¸è¿™æ„å‘³ç€è§£é‡Šå™¨åœ¨å¯¼å…¥æ—¶å®šä¹‰é¡¶å±‚å‡½æ•°ï¼Œä½†æ˜¯ä»…å½“åœ¨è¿è¡Œæ—¶è°ƒç”¨å‡½æ•°æ—¶æ‰ä¼šæ‰§è¡Œå‡½æ•°çš„å®šä¹‰ä½“ã€‚</p><p>å¯¹ç±»æ¥è¯´ï¼Œæƒ…å†µå°±ä¸åŒäº†ï¼šåœ¨å¯¼å…¥æ—¶ï¼Œè§£é‡Šå™¨ä¼šæ‰§è¡Œæ¯ä¸ªç±»çš„å®šä¹‰ä½“ï¼Œç”šè‡³ä¼šæ‰§è¡ŒåµŒå¥—ç±»çš„å®šä¹‰ä½“ã€‚æ‰§è¡Œç±»å®šä¹‰ä½“çš„ç»“æžœæ˜¯ï¼Œå®šä¹‰äº†ç±»çš„å±žæ€§å’Œæ–¹æ³•ï¼Œå¹¶æž„å»ºäº†ç±»çš„å¯¹è±¡ã€‚ä»Žè¿™ä¸ªæ„ä¹‰ä¸Šç†è§£ï¼Œç±»çš„å®šä¹‰ä½“å±žäºŽâ€é¡¶å±‚ä»£ç â€œï¼Œå› ä¸ºå®ƒåœ¨å¯¼å…¥æ—¶è¿è¡Œã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å¸®åŠ©æˆ‘ä»¬ç†è§£â€œå¯¼å…¥æ—¶â€å’Œâ€œè¿è¡Œæ—¶â€çš„åŒºåˆ«ã€‚</p><figure class="highlight python"><figcaption><span>evaltime.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> evalsupport <span class="keyword">import</span> deco_alpha</span><br><span class="line"></span><br><span class="line">print(<span class="string">'&lt;[1]&gt; evaltime module start'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassOne</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[2]&gt; ClassOne body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[3]&gt; ClassOne.__init__'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[4]&gt; ClassOne.__del__'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_x</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[5]&gt; ClassOne.method_x'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ClassTwo</span><span class="params">(object)</span>:</span></span><br><span class="line">            print(<span class="string">'&lt;[6]&gt; ClassTwo body'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@deco_alpha</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[7]&gt; ClassThree body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[8]&gt; ClassThree.method_y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFour</span><span class="params">(ClassThree)</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[9]&gt; ClassFour body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[10]&gt; ClassFour.method_y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'&lt;[11]&gt; ClassOne tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    one = ClassOne()</span><br><span class="line">    one.method_x()</span><br><span class="line">    print(<span class="string">'&lt;[12]&gt; ClassThree tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    three = ClassThree()</span><br><span class="line">    three.method_y()</span><br><span class="line">    print(<span class="string">'&lt;[13]&gt; ClassFour tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    four = ClassFour()</span><br><span class="line">    four.method_y()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'&lt;[14]&gt; evaltime module end'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>evalsupport.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># evaltime.pyå¯¼å…¥çš„æ¨¡å—</span></span><br><span class="line">print(<span class="string">'&lt;[100]&gt; evalsupport module start'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deco_alpha</span><span class="params">(cls)</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[200]&gt; deco_alpha'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner_1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[300]&gt; deco_alpha:inner_1'</span>)</span><br><span class="line"></span><br><span class="line">    cls.method_y = inner_1</span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line"><span class="comment"># BEGIN META_ALEPH</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaAleph</span><span class="params">(type)</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[400]&gt; MetaAleph body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, name, bases, dic)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[500]&gt; MetaAleph.__init__'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner_2</span><span class="params">(self)</span>:</span></span><br><span class="line">            print(<span class="string">'&lt;[600]&gt; MetaAleph.__init__:inner_2'</span>)</span><br><span class="line"></span><br><span class="line">        cls.method_z = inner_2</span><br><span class="line"><span class="comment"># END META_ALEPH</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'&lt;[700]&gt; evalsupport module end'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> evaltime  <span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line">&lt;[<span class="number">100</span>]&gt; evalsupport module start  <span class="comment"># evalsupportæ¨¡å—çš„æ‰€æœ‰é¡¶å±‚ä»£ç åœ¨å¯¼å…¥æ—¶è¿è¡Œ</span></span><br><span class="line">&lt;[<span class="number">400</span>]&gt; MetaAleph body</span><br><span class="line">&lt;[<span class="number">700</span>]&gt; evalsupport module end</span><br><span class="line">&lt;[<span class="number">1</span>]&gt; evaltime module start</span><br><span class="line">&lt;[<span class="number">2</span>]&gt; ClassOne body</span><br><span class="line">&lt;[<span class="number">6</span>]&gt; ClassTwo body  <span class="comment"># åµŒå¥—çš„å‡½æ•°å®šä¹‰ä½“ä¹Ÿä¼šæ‰§è¡Œ</span></span><br><span class="line">&lt;[<span class="number">7</span>]&gt; ClassThree body</span><br><span class="line">&lt;[<span class="number">200</span>]&gt; deco_alpha</span><br><span class="line">&lt;[<span class="number">9</span>]&gt; ClassFour body</span><br><span class="line">&lt;[<span class="number">14</span>]&gt; evaltime module end</span><br></pre></td></tr></table></figure><p>å¯¹äºŽç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼Œè¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol type="1"><li>è¿™ä¸ªåœºæ™¯ç”±ç®€å•çš„import evaltimeè¯­å¥è§¦å‘ã€‚</li><li>è§£é‡Šå™¨ä¼šæ‰§è¡Œæ‰€å¯¼å…¥æ¨¡å—åŠå…¶ä¾èµ–ä¸­çš„æ¯ä¸ªç±»å®šä¹‰ä½“ã€‚</li><li>è§£é‡Šå™¨å…ˆè®¡ç®—ç±»çš„å®šä¹‰ä½“ï¼Œç„¶åŽè°ƒç”¨ä¾é™„åœ¨ç±»ä¸Šçš„è£…é¥°å™¨å‡½æ•°ï¼Œè¿™æ˜¯åˆç†çš„è¡Œä¸ºï¼Œå› ä¸ºå¿…é¡»å…ˆæž„å»ºå¯¹è±¡ï¼Œè£…é¥°å™¨æ‰æœ‰ç±»å¯¹è±¡å¯å¤„ç†ã€‚</li><li>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œåªè¿è¡Œäº†ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‡½æ•°æˆ–æ–¹æ³•â€”â€”deco_alphaè£…é¥°å™¨ã€‚</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python evaltime.py</span><br><span class="line">&lt;[<span class="number">100</span>]&gt; evalsupport module start</span><br><span class="line">&lt;[<span class="number">400</span>]&gt; MetaAleph body</span><br><span class="line">&lt;[<span class="number">700</span>]&gt; evalsupport module end</span><br><span class="line">&lt;[<span class="number">1</span>]&gt; evaltime module start</span><br><span class="line">&lt;[<span class="number">2</span>]&gt; ClassOne body</span><br><span class="line">&lt;[<span class="number">6</span>]&gt; ClassTwo body</span><br><span class="line">&lt;[<span class="number">7</span>]&gt; ClassThree body</span><br><span class="line">&lt;[<span class="number">200</span>]&gt; deco_alpha</span><br><span class="line">&lt;[<span class="number">9</span>]&gt; ClassFour body</span><br><span class="line">&lt;[<span class="number">11</span>]&gt; ClassOne tests ..............................</span><br><span class="line">&lt;[<span class="number">3</span>]&gt; ClassOne.__init__</span><br><span class="line">&lt;[<span class="number">5</span>]&gt; ClassOne.method_x</span><br><span class="line">&lt;[<span class="number">12</span>]&gt; ClassThree tests ..............................</span><br><span class="line">&lt;[<span class="number">300</span>]&gt; deco_alpha:inner_1</span><br><span class="line">&lt;[<span class="number">13</span>]&gt; ClassFour tests ..............................</span><br><span class="line">&lt;[<span class="number">10</span>]&gt; ClassFour.method_y</span><br><span class="line">&lt;[<span class="number">14</span>]&gt; evaltime module end</span><br><span class="line">&lt;[<span class="number">4</span>]&gt; ClassOne.__del__  <span class="comment"># ç¨‹åºç»“æŸæ—¶ï¼Œç»‘å®šåœ¨å…¨å±€å˜é‡oneä¸Šçš„ClassOneå®žä¾‹æ‰ä¼šè¢«åžƒåœ¾å›žæ”¶ç¨‹åºå›žæ”¶</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªç¤ºä¾‹ä¸»è¦æƒ³è¯´æ˜Žçš„æ˜¯ï¼Œç±»è£…é¥°å™¨å¯èƒ½å¯¹å­ç±»æ²¡æœ‰å½±å“ã€‚æˆ‘ä»¬æŠŠClassFourå®šä¹‰ä¸ºClassThreeçš„å­ç±»ã€‚ClassThreeç±»ä¸Šä¾é™„çš„<code>@deco_alpha</code>è£…é¥°å™¨æŠŠ<code>method_y</code>æ–¹æ³•æ›¿æ¢æŽ‰äº†ï¼Œä½†æ˜¯è¿™å¯¹ClassFourç±»æ ¹æœ¬æ²¡æœ‰å½±å“ã€‚å½“ç„¶ï¼Œå¦‚æžœ<code>ClassFour.method_y</code>æ–¹æ³•ä½¿ç”¨superè°ƒç”¨<code>ClassThree.method_y</code>æ–¹æ³•ï¼Œæˆ‘ä»¬ä¾¿ä¼šçœ‹åˆ°è£…é¥°å™¨èµ·ä½œç”¨ï¼Œæ‰§è¡Œ<code>inner_1</code>å‡½æ•°ã€‚</p><p>ä¸Žæ­¤ä¸åŒçš„æ˜¯ï¼Œå¦‚æžœæƒ³å®šåˆ¶æ•´ä¸ªç±»å±‚æ¬¡ç»“æž„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡åªåˆ¶å®šä¸€ä¸ªç±»ï¼Œä½¿ç”¨å…ƒç±»æ›´é«˜æ•ˆã€‚</p><h1 id="å…ƒç±»åŸºç¡€çŸ¥è¯†">å…ƒç±»åŸºç¡€çŸ¥è¯†</h1><p>å…ƒç±»æ˜¯åˆ¶é€ ç±»çš„å·¥åŽ‚ï¼Œä¸è¿‡ä¸æ˜¯å‡½æ•°ï¼Œè€Œæ˜¯ç±»ã€‚æ ¹æ®Pythonå¯¹è±¡æ¨¡åž‹ï¼Œç±»æ˜¯å¯¹è±¡ï¼Œå› æ­¤ç±»è‚¯å®šæ˜¯å¦å¤–æŸä¸ªç±»çš„å®žä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPythonä¸­ç±»æ˜¯typeç±»çš„å®žä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œtypeæ˜¯å¤§å¤šæ•°å†…ç½®çš„ç±»å’Œç”¨æˆ·å®šä¹‰çš„ç±»çš„å…ƒç±»ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'spam'</span>.__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">str</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">from</span> <span class="title">bulkfood_v6</span> <span class="title">import</span> <span class="title">LineItem</span></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">LineItem</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘æ²¡æœ‰è¯´strå’ŒLineItemç»§æ‰¿è‡ªtypeã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œstrå’ŒLineItemæ˜¯typeçš„å®žä¾‹ã€‚è¿™ä¸¤ä¸ªç±»æ˜¯objectçš„å­ç±»ã€‚ä¸‹å›¾å¯èƒ½æœ‰åŠ©äºŽä½ ç†æ¸…è¿™ä¸ªå¥‡æ€ªçš„çŽ°è±¡ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/NOn12eCm50Ntdk9TuES09MGlz18nVM9AVnJpDuA7hqGArUKCp4pvHL0Nsw3KWMkNFh5MsBOGtYijDX52rvJ87Z0FRoOxXNVkpWxLrZzwviBUg7WSnrognPA8UJoUPmc_YqYhBk8NVW40"><p>objectç±»å’Œtypeç±»ä¹‹é—´çš„å…³ç³»å¾ˆç‹¬ç‰¹ï¼šobjectæ˜¯typeçš„å®žä¾‹ï¼Œè€Œtypeæ˜¯objectçš„å­ç±»ã€‚è¿™ç§å…³ç³»å¾ˆâ€œç¥žå¥‡â€ï¼Œæ— æ³•ä½¿ç”¨Pythonä»£ç è¡¨è¿°ï¼Œå› ä¸ºå®šä¹‰å…¶ä¸­ä¸€ä¸ªä¹‹å‰å¦ä¸€ä¸ªå¿…é¡»å­˜åœ¨ã€‚typeæ˜¯è‡ªèº«çš„å®žä¾‹è¿™ä¸€ç‚¹ä¹Ÿå¾ˆç¥žå¥‡ã€‚</p><p>é™¤äº†typeï¼Œæ ‡å‡†åº“ä¸­è¿˜æœ‰ä¸€äº›åˆ«çš„å…ƒç±»ï¼Œä¾‹å¦‚ABCMetaå’ŒEnumã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ŒIterableæ‰€å±žçš„ç±»æ˜¯ABCMetaã€‚Iterableæ˜¯æŠ½è±¡ç±»ï¼Œè€ŒABCMetaä¸æ˜¯â€”â€”ä¸ç®¡æ€Žæ ·ï¼ŒIterableæ˜¯ABCMetaçš„å®žä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> collections</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>collections.Iterable.__class__</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">abc</span>.<span class="title">ABCMeta</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">import</span> <span class="title">abc</span></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">abc</span>.<span class="title">ABCMeta</span>.<span class="title">__class__</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">abc</span>.<span class="title">ABCMeta</span>.<span class="title">__mro__</span></span></span><br><span class="line"><span class="class"><span class="params">(&lt;class <span class="string">'abc.ABCMeta'</span>&gt;, &lt;class <span class="string">'type'</span>&gt;, &lt;class <span class="string">'object'</span>&gt;)</span></span></span><br></pre></td></tr></table></figure><p>å‘ä¸Šè¿½æº¯ï¼ŒABCMetaæœ€ç»ˆæ‰€å±žçš„ç±»ä¹Ÿæ˜¯typeã€‚æ‰€æœ‰ç±»éƒ½ç›´æŽ¥æˆ–é—´æŽ¥åœ°æ˜¯typeçš„å®žä¾‹ï¼Œä¸è¿‡åªæœ‰å…ƒç±»åŒæ—¶ä¹Ÿæ˜¯typeçš„å­ç±»ã€‚<strong>è‹¥æƒ³ç†è§£å…ƒç±»ï¼Œä¸€å®šè¦çŸ¥é“è¿™ç§å…³ç³»ï¼šå…ƒç±»ï¼ˆå¦‚ABCMetaï¼‰ï¼‰ä»Žtypeç»§æ‰¿äº†æž„å»ºç±»çš„èƒ½åŠ›ã€‚</strong></p><img src="http://www.plantuml.com/plantuml/svg/FOmn3eCm40Hxl-8-00-84598bIAFk3CRGOG1-Iu5KXuVOmFbhcPc67iGmceR1GH1T7vYLR9j1JLDW74-sjQng4NsHaz3P9dW2bJNjCW7texzgogwTuzNKkcM6lgLqbpUgLBGGbsX4zzRvvdTSLRZsIExVm00"><p>æˆ‘ä»¬è¦æŠ“ä½çš„é‡ç‚¹æ˜¯ï¼Œ<strong>æ‰€æœ‰ç±»éƒ½æ˜¯typeçš„å®žä¾‹ï¼Œä½†æ˜¯å…ƒç±»è¿˜æ˜¯typeçš„å­ç±»</strong>ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºåˆ¶é€ ç±»çš„å·¥åŽ‚ã€‚å…·ä½“æ¥è¯´ï¼Œå…ƒç±»å¯ä»¥é€šè¿‡å®žçŽ°<code>__init__</code>æ–¹æ³•å®šåˆ¶å®žä¾‹ã€‚å…ƒç±»çš„<code>__init__</code>æ–¹æ³•å¯ä»¥åšåˆ°ç±»è£…é¥°å™¨èƒ½åšçš„ä»»ä½•äº‹æƒ…ï¼Œä½†æ˜¯ä½œç”¨æ›´å¤§ï¼Œå¦‚æŽ¥ä¸‹æ¥çš„ç¤ºä¾‹ã€‚</p><figure class="highlight python"><figcaption><span>evaltime_meta.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> evalsupport <span class="keyword">import</span> deco_alpha</span><br><span class="line"><span class="keyword">from</span> evalsupport <span class="keyword">import</span> MetaAleph</span><br><span class="line"></span><br><span class="line">print(<span class="string">'&lt;[1]&gt; evaltime_meta module start'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@deco_alpha</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[2]&gt; ClassThree body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[3]&gt; ClassThree.method_y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFour</span><span class="params">(ClassThree)</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[4]&gt; ClassFour body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[5]&gt; ClassFour.method_y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFive</span><span class="params">(metaclass=MetaAleph)</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[6]&gt; ClassFive body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[7]&gt; ClassFive.__init__'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_z</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[8]&gt; ClassFive.method_y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassSix</span><span class="params">(ClassFive)</span>:</span></span><br><span class="line">    print(<span class="string">'&lt;[9]&gt; ClassSix body'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_z</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;[10]&gt; ClassSix.method_y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'&lt;[11]&gt; ClassThree tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    three = ClassThree()</span><br><span class="line">    three.method_y()</span><br><span class="line">    print(<span class="string">'&lt;[12]&gt; ClassFour tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    four = ClassFour()</span><br><span class="line">    four.method_y()</span><br><span class="line">    print(<span class="string">'&lt;[13]&gt; ClassFive tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    five = ClassFive()</span><br><span class="line">    five.method_z()</span><br><span class="line">    print(<span class="string">'&lt;[14]&gt; ClassSix tests'</span>, <span class="number">30</span> * <span class="string">'.'</span>)</span><br><span class="line">    six = ClassSix()</span><br><span class="line">    six.method_z()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'&lt;[15]&gt; evaltime_meta module end'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> evaltime_meta</span><br><span class="line">&lt;[<span class="number">100</span>]&gt; evalsupport module start</span><br><span class="line">&lt;[<span class="number">400</span>]&gt; MetaAleph body</span><br><span class="line">&lt;[<span class="number">700</span>]&gt; evalsupport module end</span><br><span class="line">&lt;[<span class="number">1</span>]&gt; evaltime_meta module start</span><br><span class="line">&lt;[<span class="number">2</span>]&gt; ClassThree body</span><br><span class="line">&lt;[<span class="number">200</span>]&gt; deco_alpha</span><br><span class="line">&lt;[<span class="number">4</span>]&gt; ClassFour body</span><br><span class="line">&lt;[<span class="number">6</span>]&gt; ClassFive body</span><br><span class="line">&lt;[<span class="number">500</span>]&gt; MetaAleph.__init__  <span class="comment"># åˆ›å»ºClassFiveæ—¶è°ƒç”¨äº†MetaAleph.__init__æ–¹æ³•</span></span><br><span class="line">&lt;[<span class="number">9</span>]&gt; ClassSix body</span><br><span class="line">&lt;[<span class="number">500</span>]&gt; MetaAleph.__init__  <span class="comment"># åˆ›å»ºClassSixæ—¶ä¹Ÿè°ƒç”¨äº†</span></span><br><span class="line">&lt;[<span class="number">15</span>]&gt; evaltime_meta module end</span><br></pre></td></tr></table></figure><p>Pythonè§£é‡Šå™¨è®¡ç®—ClassFiveç±»çš„å®šä¹‰ä½“æ—¶æ²¡æœ‰è°ƒç”¨typeæž„å»ºå…·ä½“çš„ç±»å®šä¹‰ä½“ï¼Œè€Œæ˜¯è°ƒç”¨MetaAlephç±»ã€‚<code>MetaAleph.__init__</code>æ–¹æ³•æœ‰å››ä¸ªå‚æ•°ã€‚</p><p>selfï¼šè¿™æ˜¯è¦åˆå§‹åŒ–çš„ç±»å¯¹è±¡ã€‚ç¼–å†™å…ƒç±»æ—¶ï¼Œé€šå¸¸ä¼šæŠŠselfå‚æ•°æ”¹ä¸ºclsï¼Œè¡¨æ˜Žè¦æž„å»ºçš„å®žä¾‹æ˜¯ç±»ã€‚</p><p>nameã€basesã€dictï¼šä¸Žæž„å»ºç±»æ—¶ä¼ ç»™typeçš„å‚æ•°ä¸€æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python evaltime_meta.py</span><br><span class="line">&lt;[<span class="number">100</span>]&gt; evalsupport module start</span><br><span class="line">&lt;[<span class="number">400</span>]&gt; MetaAleph body</span><br><span class="line">&lt;[<span class="number">700</span>]&gt; evalsupport module end</span><br><span class="line">&lt;[<span class="number">1</span>]&gt; evaltime_meta module start</span><br><span class="line">&lt;[<span class="number">2</span>]&gt; ClassThree body</span><br><span class="line">&lt;[<span class="number">200</span>]&gt; deco_alpha</span><br><span class="line">&lt;[<span class="number">4</span>]&gt; ClassFour body</span><br><span class="line">&lt;[<span class="number">6</span>]&gt; ClassFive body</span><br><span class="line">&lt;[<span class="number">500</span>]&gt; MetaAleph.__init__</span><br><span class="line">&lt;[<span class="number">9</span>]&gt; ClassSix body</span><br><span class="line">&lt;[<span class="number">500</span>]&gt; MetaAleph.__init__</span><br><span class="line">&lt;[<span class="number">11</span>]&gt; ClassThree tests ..............................</span><br><span class="line">&lt;[<span class="number">300</span>]&gt; deco_alpha:inner_1  <span class="comment"># è£…é¥°å™¨ä¾é™„åˆ°ClassThreeç±»ä¸Šä¹‹åŽï¼Œmethod_yæ–¹æ³•è¢«æ›¿æ¢äº†</span></span><br><span class="line">&lt;[<span class="number">12</span>]&gt; ClassFour tests ..............................</span><br><span class="line">&lt;[<span class="number">5</span>]&gt; ClassFour.method_y  <span class="comment"># è™½ç„¶ClassFouræ˜¯ClassThreeçš„å­ç±»ï¼Œä½†æ˜¯æ²¡æœ‰ä¾é™„è£…é¥°å™¨ï¼Œä¸å—å½±å“</span></span><br><span class="line">&lt;[<span class="number">13</span>]&gt; ClassFive tests ..............................</span><br><span class="line">&lt;[<span class="number">7</span>]&gt; ClassFive.__init__</span><br><span class="line">&lt;[<span class="number">600</span>]&gt; MetaAleph.__init__:inner_2  <span class="comment"># MetaAleph.__init__æ–¹æ³•æ›¿æ¢äº†ClassFive.method_zæ–¹æ³•</span></span><br><span class="line">&lt;[<span class="number">14</span>]&gt; ClassSix tests ..............................</span><br><span class="line">&lt;[<span class="number">7</span>]&gt; ClassFive.__init__</span><br><span class="line">&lt;[<span class="number">600</span>]&gt; MetaAleph.__init__:inner_2  <span class="comment"># ClassSix.method_zæ–¹æ³•ä¹Ÿè¢«æ›¿æ¢äº†</span></span><br><span class="line">&lt;[<span class="number">15</span>]&gt; evaltime_meta module end</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼ŒClassSixç±»æ²¡æœ‰ç›´æŽ¥å¼•ç”¨MetaAlephç±»ï¼Œä½†æ˜¯å´å—åˆ°äº†å½±å“ï¼Œå› ä¸ºå®ƒæ˜¯ClassFiveçš„å­ç±»ï¼Œè¿›è€Œä¹Ÿæ˜¯MetaAlephç±»çš„å®žä¾‹ï¼Œæ‰€æœ‰ç”±<code>MetaAleph.__init__</code>æ–¹æ³•åˆå§‹åŒ–ã€‚</p><p>å¦‚æžœæƒ³è¿›ä¸€æ­¥å®šåˆ¶ç±»ï¼Œå¯ä»¥åœ¨å…ƒç±»ä¸­å®žçŽ°<code>__new__</code>æ–¹æ³•ã€‚ä¸è¿‡ï¼Œé€šå¸¸æƒ…å†µä¸‹å®žçŽ°<code>__init__</code>æ–¹æ³•å°±å¤Ÿäº†ã€‚</p><h1 id="å®šåˆ¶æè¿°ç¬¦çš„å…ƒç±»">å®šåˆ¶æè¿°ç¬¦çš„å…ƒç±»</h1><p>çŽ°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®žè·µè¿™äº›ç†è®ºäº†ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå…ƒç±»ï¼Œè®©æè¿°ç¬¦ä»¥æœ€ä½³çš„æ–¹å¼è‡ªåŠ¨åˆ›å»ºå‚¨å­˜å±žæ€§çš„åç§°ã€‚</p><figure class="highlight python"><figcaption><span>model_v7.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> model_v5 <span class="keyword">import</span> Validate, Quantity, NonBlank</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntityMeta</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="string">"""å…ƒç±»ï¼Œç”¨äºŽåˆ›å»ºå¸¦æœ‰éªŒè¯å­—æ®µçš„ä¸šåŠ¡å®žä½“"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, name, bases, attr_dict)</span>:</span></span><br><span class="line">        super().__init__(name, bases, attr_dict)  <span class="comment"># è°ƒç”¨type.__init__æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">for</span> key, attr <span class="keyword">in</span> attr_dict.items():  <span class="comment"># ä¿®æ”¹storage_nameï¼Œä¸Ž@entityè£…é¥°å™¨çš„é€»è¾‘ä¸€æ ·</span></span><br><span class="line">            <span class="keyword">if</span> isinstance(attr, Validate):</span><br><span class="line">                type_name = type(attr).__name__</span><br><span class="line">                attr.storage_name = <span class="string">'_&#123;&#125;#&#123;&#125;'</span>.format(type_name, key)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span><span class="params">(metaclass=EntityMeta)</span>:</span>  <span class="comment"># è¿™ä¸ªç±»åªæ˜¯ä¸ºäº†ç”¨èµ·æ¥ä¾¿åˆ©ï¼šç”¨æˆ·ç›´æŽ¥ç»§æ‰¿Entityç±»å³å¯</span></span><br><span class="line">    <span class="string">"""å¸¦æœ‰éªŒè¯å­—æ®µçš„ä¸šåŠ¡å®žä½“"""</span>         <span class="comment"># æ— éœ€å…³å¿ƒEntityMetaå…ƒç±»ï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“å®ƒçš„å­˜åœ¨</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>bulkfood_v7.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> model_v7 <span class="keyword">as</span> model</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span><span class="params">(model.Entity)</span>:</span>  <span class="comment"># ç»§æ‰¿Entityç±»</span></span><br><span class="line">    description = model.NonBlank()</span><br><span class="line">    weight = model.Quantity()</span><br><span class="line">    price = model.Quantity()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/bL71QeGm5BpdAm9xAyr-G16XXHuAtK8fz1go-ggX9X7pR2dgl_TLZRfg2_La9ZFptanodG87K-8NDs3EKB6aKDxpsnhT2xfAPS2ZA0MVLBgaSnppXd7wf4nSRP44FoS_KALL1dgWCO2vIplYQQjHoZMQmGxeUx1ZwkonKWdoLrNeL26a-qjif1TW4smw_Z7waFUGxxbM5ZMb_jjtetjozgvGzft_L_YeBJmWc51VC3e45-tiS1DMEto2pd9SWMMbazyg3hFkU-e9KD6Mn58zlDVQ9BnuxrRCnRF54xH2JCMjyP27pSqASJN7lg5fGo0fh-c_pq6ZfqAtz4KpH9okH5sADXv3icNMut54IHv5sdfKDW7ktkBu6m00"><h1 id="å…ƒç±»çš„ç‰¹æ®Šæ–¹æ³•__prepare__">å…ƒç±»çš„ç‰¹æ®Šæ–¹æ³•<code>__prepare__</code></h1><p>åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦çŸ¥é“ç±»çš„å±žæ€§å®šä¹‰çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œå¯¹è¯»å†™CSVæ–‡ä»¶çš„åº“æ¥è¯´ï¼Œç”¨æˆ·å®šä¹‰çš„ç±»å¯èƒ½æƒ³æŠŠç±»ä¸­æŒ‰é¡ºåºå£°æ˜Žçš„å­—æ®µä¸ŽCSVæ–‡ä»¶ä¸­å„åˆ—çš„é¡ºåºå¯¹åº”èµ·æ¥ã€‚</p><p>typeæž„é€ æ–¹æ³•åŠå…ƒç±»çš„<code>__new__</code>å’Œ<code>__init__</code>æ–¹æ³•éƒ½ä¼šæ”¶åˆ°è¦è®¡ç®—çš„ç±»çš„å®šä¹‰ä½“ï¼Œå½¢å¼æ˜¯åç§°åˆ°å±žæ€§çš„æ˜ åƒã€‚ç„¶è€Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé‚£ä¸ªæ˜ å°„æ˜¯å­—å…¸ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç±»æˆ–è£…é¥°å™¨èŽ·å¾—æ˜ åƒæ—¶ï¼Œå±žæ€§åœ¨ç±»å®šä¹‰ä½“ä¸­çš„é¡ºåºå·²ç»ä¸¢å¤±äº†ã€‚</p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨Python3å¼•å…¥çš„ç‰¹æ®Šæ–¹æ³•<code>__prepare__</code>ã€‚è¿™ä¸ªç‰¹æ®Šæ–¹æ³•åªåœ¨å…ƒç±»ä¸­æœ‰ç”¨ï¼Œè€Œä¸”å¿…é¡»å£°æ˜Žä¸ºç±»æ–¹æ³•ï¼ˆå³ï¼Œè¦ä½¿ç”¨@classmethodè£…é¥°å™¨å®šä¹‰ï¼‰ã€‚è§£é‡Šå™¨è°ƒç”¨å…ƒç±»çš„<code>__new__</code>æ–¹æ³•ä¹‹å‰ä¼šå…ˆè°ƒç”¨<code>__prepare__</code>æ–¹æ³•ï¼Œä½¿ç”¨ç±»å®šä¹‰ä½“ä¸­çš„å±žæ€§åˆ›å»ºæ˜ å°„ã€‚<code>__prepare__</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…ƒç±»ï¼ŒéšåŽä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¦æž„å»ºçš„ç±»çš„æ˜ å°„å’ŒåŸºç±»ç»„æˆçš„å…ƒç»„ï¼Œè¿”å›žå€¼å¿…é¡»æ˜¯æ˜ å°„ã€‚å…ƒç±»æž„å»ºæ–°ç±»æ—¶ï¼Œ<code>__prepare__</code>æ–¹æ³•è¿”å›žçš„æ˜ å°„ä¼šä¼ ç»™<code>__new__</code>æ–¹æ³•çš„æœ€åŽä¸€ä¸ªå‚æ•°ï¼Œç„¶åŽå†ä¼ ç»™<code>__init__</code>æ–¹æ³•ã€‚</p><p>ç†è®ºå¬èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æ˜¯æˆ‘è§è¿‡çš„<code>__prepare__</code>æ–¹æ³•éƒ½ååˆ†ç®€å•ã€‚</p><figure class="highlight python"><figcaption><span>model_v8.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> model_v5 <span class="keyword">import</span> Validate, Quantity, NonBlank</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntityMeta</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="string">"""å…ƒç±»ï¼Œç”¨äºŽåˆ›å»ºå¸¦æœ‰éªŒè¯å­—æ®µçš„ä¸šåŠ¡å®žä½“"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__prepare__</span><span class="params">(cls, name, bases)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> collections.OrderedDict()  <span class="comment"># è¿”å›žç©ºçš„OrderDictå®žä¾‹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(cls, name, bases, attr_dict)</span>:</span>  <span class="comment"># OrderedDictå®žä¾‹ä¼šç»‘å®šåˆ°attr_dictä¸Š</span></span><br><span class="line">        super().__init__(name, bases, attr_dict)</span><br><span class="line">        cls._field_names = []  <span class="comment"># åœ¨è¦æž„å»ºçš„ç±»ä¸­åˆ›å»ºä¸€ä¸ª_field_nameså±žæ€§</span></span><br><span class="line">        <span class="keyword">for</span> key, attr <span class="keyword">in</span> attr_dict.items():  <span class="comment"># å› æ­¤forå¾ªçŽ¯è¿­ä»£attr_dictæ—¶ä¼šæŒ‰æ·»åŠ çš„é¡ºåºè¿­ä»£</span></span><br><span class="line">            <span class="keyword">if</span> isinstance(attr, Validate):</span><br><span class="line">                type_name = type(attr).__name__</span><br><span class="line">                attr.storage_name = <span class="string">'_&#123;&#125;#&#123;&#125;'</span>.format(type_name, key)</span><br><span class="line">                cls._field_names.append(key)  <span class="comment"># æŠŠå„ä¸ªValidateå­—æ®µæ·»åŠ åˆ°_field_names</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entity</span><span class="params">(metaclass=EntityMeta)</span>:</span></span><br><span class="line">    <span class="string">"""å¸¦æœ‰éªŒè¯å­—æ®µçš„ä¸šåŠ¡å®žä½“"""</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">field_names</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> cls._field_names:</span><br><span class="line">            <span class="keyword">yield</span> name</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>bulkfood_v8.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> model_v8 <span class="keyword">as</span> model  <span class="comment"># ä»Žv8ä¸­å¯¼å…¥ï¼Œå…¶ä»–ä¸å˜</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span><span class="params">(model.Entity)</span>:</span></span><br><span class="line">    description = model.NonBlank()</span><br><span class="line">    weight = model.Quantity()</span><br><span class="line">    price = model.Quantity()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v8 <span class="keyword">import</span> LineItem</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> name <span class="keyword">in</span> LineItem.field_names():</span><br><span class="line"><span class="meta">... </span>    print(name)</span><br><span class="line">...</span><br><span class="line">description</span><br><span class="line">weight</span><br><span class="line">price</span><br></pre></td></tr></table></figure><p>åœ¨çŽ°å®žä¸–ç•Œä¸­ï¼Œæ¡†æž¶å’Œåº“ä¼šä½¿ç”¨å…ƒç±»ååŠ©ç¨‹åºå‘˜æ‰§è¡Œå¾ˆå¤šä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š</p><ul><li>éªŒè¯å±žæ€§</li><li>ä¸€æ¬¡æŠŠè£…é¥°å™¨ä¾é™„åˆ°å¤šä¸ªç±»ä¸Š</li><li>åºåˆ—åŒ–å¯¹è±¡æˆ–è½¬æ¢æ•°æ®</li><li>å¯¹è±¡å…³ç³»æ˜ å°„</li><li>åŸºäºŽå¯¹è±¡çš„æŒä¹…å­˜å‚¨</li><li>åŠ¨æ€è½¬æ¢ä½¿ç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„ç±»ç»“æž„</li></ul><h1 id="ç±»ä½œä¸ºå¯¹è±¡">ç±»ä½œä¸ºå¯¹è±¡</h1><p>Pythonæ•°æ®æ¨¡åž‹ä¸ºæ¯ä¸ªç±»å®šä¹‰äº†å¾ˆå¤šå±žæ€§ï¼Œå…¶ä¸­ä¸‰ä¸ªå±žæ€§åœ¨æœ¬ä¹¦ä¸­å·²ç»è§è¿‡å¤šæ¬¡ï¼š<code>__mro__</code>ã€<code>__class__</code>å’Œ<code>__name__</code>ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹å±žæ€§ã€‚</p><ul><li><p><code>cls.__bases__</code></p><p>ç”±ç±»çš„åŸºç±»ç»„æˆçš„å…ƒç»„ã€‚</p></li><li><p><code>cls.__qualname__</code></p><p>Python3.3æ–°å¼•å…¥çš„å±žæ€§ï¼Œå…¶å€¼æ˜¯ç±»æˆ–å‡½æ•°çš„é™å®šåç§°ï¼Œå³ä»Žæ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸåˆ°ç±»çš„ç‚¹åˆ†è·¯å¾„ã€‚</p></li><li><p><code>cls.__subclasses__()</code></p><p>è¿™ä¸ªæ–¹æ³•è¿”å›žä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«ç±»çš„ç›´æŽ¥å­ç±»ã€‚è¿™ä¸ªæ–¹æ³•çš„å®žçŽ°ä½¿ç”¨å¼±å¼•ç”¨ï¼Œé˜²æ­¢åœ¨è¶…ç±»å’Œå­ç±»ä¹‹é—´å‡ºçŽ°å¾ªçŽ¯å¼•ç”¨ï¼ˆå­ç±»åœ¨<code>__bases__</code>å±žæ€§ä¸­å­˜å‚¨æŒ‡å‘è¶…ç±»çš„å¼ºå¼•ç”¨ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›žçš„åˆ—è¡¨ä¸­æ˜¯å†…å­˜é‡ŒçŽ°å­˜çš„å­ç±»ã€‚</p></li><li><p><code>cls.mro()</code></p><p>æž„å»ºç±»æ—¶ï¼Œå¦‚æžœéœ€è¦èŽ·å–å­˜å‚¨åœ¨ç±»å±žæ€§<code>__mro__</code>ä¸­çš„è¶…ç±»å…ƒç»„ï¼Œè§£é‡Šå™¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å…ƒç±»å¯ä»¥è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå®šåˆ¶è¦æž„å»ºçš„ç±»è§£æžæ–¹æ³•çš„é¡ºåºã€‚</p></li></ul><p>dirå‡½æ•°ä¸ä¼šåˆ—å‡ºæœ¬èŠ‚æåˆ°çš„ä»»ä½•ä¸€ä¸ªå±žæ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> metaprogramming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å±žæ€§æè¿°ç¬¦</title>
      <link href="/notes/fluent-python/attribute-descriptors/"/>
      <url>/notes/fluent-python/attribute-descriptors/</url>
      
        <content type="html"><![CDATA[<p>æè¿°ç¬¦æ˜¯å¯¹å¤šä¸ªå±žæ€§è¿ç”¨ç›¸åŒå­˜å–é€»è¾‘çš„ä¸€ç§æ–¹å¼ã€‚æè¿°ç¬¦æ˜¯å®žçŽ°äº†ç‰¹å®šåè®®çš„ç±»ï¼Œè¿™ä¸ªåè®®åŒ…æ‹¬<code>__get__</code>ã€<code>__set__</code>å’Œ<code>__delete__</code>æ–¹æ³•ã€‚propertyç±»å®žçŽ°äº†å®Œæ•´çš„æè¿°ç¬¦åè®®ã€‚é€šå¸¸ï¼Œå¯ä»¥åªå®žçŽ°éƒ¨åˆ†åè®®ã€‚é™¤äº†ç‰¹æ€§ä¹‹å¤–ï¼Œä½¿ç”¨æè¿°ç¬¦çš„è¿˜æœ‰æ–¹æ³•åŠclassmethodå’Œstaticmethodè£…é¥°å™¨ã€‚</p><h1 id="æè¿°ç¬¦ç¤ºä¾‹éªŒè¯å±žæ€§">æè¿°ç¬¦ç¤ºä¾‹ï¼šéªŒè¯å±žæ€§</h1><h2 id="lineitemç±»ç¬¬3ç‰ˆä¸€ä¸ªç®€å•çš„æè¿°ç¬¦">LineItemç±»ç¬¬3ç‰ˆï¼šä¸€ä¸ªç®€å•çš„æè¿°ç¬¦</h2><p>å®žçŽ°äº†<code>__get__</code>ã€<code>__set__</code>æˆ–<code>__delete__</code>æ–¹æ³•çš„ç±»æ˜¯æè¿°ç¬¦ã€‚æè¿°ç¬¦çš„ç”¨æ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªå®žä¾‹ï¼Œä½œä¸ºå¦ä¸€ä¸ªç±»çš„ç±»å±žæ€§ã€‚</p><p>æŠŠquantityç‰¹æ€§å·¥åŽ‚å‡½æ•°é‡æž„æˆQuantityæè¿°ç¬¦ç±»ã€‚LineItemç±»çš„UMLç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/XP0zIyD06CVt-nGF7GK3xIWXk-3YNZZEz6mFaal9NH490GSNApPhwH0GGHSvqaryQRzCaylcL_1CsgGKnDkU__rVuETwH0Wudn0kcRm6snvGuOPiB8FGSI12O9um1nbIp8bFAo7ogHm5WnWmPfn9Z0zLGN_56BbL-ndZz5HIVrktMs01h-uhoeOZ2T5s9gx4SSXSUg3zCoic5pAGn3ExF90KEaMIbEjClpxhvSVtvo9NgPvbVTx8-KDIAgKNj-Q_0qG0x-wITtEj7kjOCPss2PLkLlTzdZzbnNosUNitbdoP5ZSl-oqznBjWDL0Hxu7bqKjfDIHG0znoMZmdKAgL_bBrUjtREktZetqhnXKY0-5lHqqMuny0"><p>weightå’Œpriceæ˜¯ä¾é™„åœ¨LineItemç±»ä¸Šçš„Quantityç±»çš„å®žä¾‹ï¼Œä¸è¿‡LineItemå®žä¾‹ä¹Ÿæœ‰è‡ªå·±çš„weightå’Œpriceå±žæ€§ï¼Œå­˜å‚¨ç€ç›¸åº”çš„å€¼ã€‚å³LineItemä¼šæœ‰ä¸¤ä¸ªweightå±žæ€§ï¼šä¸€ä¸ªæ˜¯LineItemçš„ç±»å±žæ€§ï¼ˆUMLå›¾ä¸­çš„<u>weight</u>å’Œ<u>price</u>ï¼Œä»–ä»¬æ˜¯æè¿°ç¬¦Quantityçš„å®žä¾‹ï¼‰ï¼Œä¸€ä¸ªæ˜¯LineItemå¯¹è±¡çš„å®žä¾‹å±žæ€§ï¼ˆUMLå›¾ä¸­çš„weight {storage}å’Œprice {storage}ï¼Œä»–ä»¬æ˜¯floatå€¼ï¼‰ã€‚</p><a id="more"></a><p>Quantityå®žä¾‹æ˜¯LineItemç±»çš„ç±»å±žæ€§ï¼Œè¿™ä¸€ç‚¹ä¸€å®šè¦ç†è§£ã€‚ä¸‹å›¾çš„æ¶‚é¸¦å±•ç¤ºäº†æè¿°ç¬¦ç±»ã€LineItemç±»ä»¥åŠå®ƒä»¬çš„å®žä¾‹ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="/uploads/image/fluent-python/MGN-sketch.png"></p><p>åœ¨å›¾ä¸­ï¼Œç±»è¢«ç”»æˆäº†â€œæœºå™¨â€ï¼ˆæœ‰æ“çºµæ†å’Œåˆ»åº¦ç›˜çš„è®¾å¤‡ï¼‰ï¼Œç”¨äºŽç”Ÿäº§å°æ€ªå…½ï¼ˆå®žä¾‹ï¼‰ã€‚å°æ€ªå…½ä¸Žç”Ÿäº§å®ƒçš„æœºå™¨å…·æœ‰ç›¸åŒçš„é¢œè‰²ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒLineItemç”Ÿäº§äº†ä¸‰ä¸ªå°æ€ªå…½ï¼Œæ¯ä¸ªå°æ€ªå…½æœ‰3ä¸ªå•å…ƒæ ¼ï¼Œè¡¨ç¤ºä¸‰ä¸ªå±žæ€§ï¼ˆdescriptionã€weightå’Œpriceï¼‰ã€‚Quantityå®žä¾‹æ˜¯æè¿°ç¬¦ï¼Œå› æ­¤æœ‰ä¸ªæ”¾å¤§é•œï¼Œç”¨äºŽèŽ·å–å€¼ï¼ˆ<code>__get__</code>ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ‰‹æŠ“ï¼Œç”¨äºŽè®¾ç½®å€¼ï¼ˆ<code>__set__</code>ï¼‰ã€‚</p><figure class="highlight python"><figcaption><span>bulkfood_v3.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quantity</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, storage_name)</span>:</span></span><br><span class="line">        self.storage_name = storage_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span>  <span class="comment"># åŸºäºŽåè®®å®žçŽ°</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span>:  <span class="comment"># å¿…é¡»ç›´æŽ¥æ‰˜ç®¡__dict__å±žæ€§ï¼Œè‹¥ä½¿ç”¨å†…ç½®çš„setattrå‡½æ•°ï¼Œä¼šå†æ¬¡è§¦å‘</span></span><br><span class="line">            instance.__dict__[self.storage_name] = value  <span class="comment"># __set__æ–¹æ³•ï¼Œå¯¼è‡´æ— é™é€’å½’</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    weight = Quantity(<span class="string">'weight'</span>)  <span class="comment"># ç»‘å®šç»™weightå±žæ€§ï¼Œstorage_name='weight'</span></span><br><span class="line">    price = Quantity(<span class="string">'price'</span>)  <span class="comment"># å°ç¼ºç‚¹ï¼Œé‡å¤è¾“å…¥äº†å±žæ€§åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v3 <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>truffle = LineItem(<span class="string">'White truffle'</span>, <span class="number">100</span>, <span class="number">0</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/bulkfood_v3.py"</span>, line <span class="number">19</span>, <span class="keyword">in</span> __init__</span><br><span class="line">    self.price = price</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/bulkfood_v3.py"</span>, line <span class="number">10</span>, <span class="keyword">in</span> __set__</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line">ValueError: value must be &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½æƒ³æŠŠå„ä¸ªæ‰˜ç®¡å±žæ€§çš„å€¼ç›´æŽ¥å­˜åœ¨æè¿°ç¬¦å®žä¾‹ä¸­ï¼Œä½†æ˜¯è¿™ç§åšæ³•æ˜¯é”™è¯¯çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<code>__set__</code>æ–¹æ³•ä¸­ï¼Œåº”è¯¥åƒä¸‹é¢è¿™æ ·å†™ï¼š<code>instance.__dict__[self.storage_name] = value</code>ï¼›è€Œä¸èƒ½è¯•å›¾ä½¿ç”¨ä¸‹é¢è¿™ç§é”™è¯¯çš„å†™æ³•ï¼š<code>self.__dict__[self.storage_name] = value</code>ã€‚è¿™é‡Œï¼Œselfæ˜¯æè¿°ç¬¦å®žä¾‹ï¼Œå®ƒå…¶å®žæ˜¯æ‰˜ç®¡ç±»çš„ç±»å±žæ€§ã€‚åŒä¸€æ—¶åˆ»ï¼Œå†…å­˜ä¸­å¯èƒ½æœ‰å‡ åƒä¸ªLineItemå®žä¾‹ï¼Œä¸è¿‡åªä¼šæœ‰ä¸¤ä¸ªæè¿°ç¬¦å®žä¾‹ï¼šLineItem.weightå’ŒLineItem.priceã€‚å› æ­¤ï¼Œå­˜å‚¨åœ¨æè¿°ç¬¦å®žä¾‹ä¸­çš„æ•°æ®ï¼Œå…¶å®žä¼šå˜æˆLineItemç±»çš„ç±»å±žæ€§ï¼Œä»Žè€Œç”±å…¨éƒ¨LineItemå®žä¾‹å…±äº«ã€‚</p><p>ç¤ºä¾‹æœ‰ä¸ªç¼ºç‚¹ï¼Œåœ¨æ‰˜ç®¡ç±»çš„å®šä¹‰ä½“ä¸­å®žä¾‹åŒ–æè¿°ç¬¦æ—¶è¦é‡å¤è¾“å…¥å±žæ€§çš„åç§°ã€‚å¦‚æžœèƒ½åƒ<code>weight = Quantity()</code>è¿™æ ·å£°æ˜Žå°±å¥½äº†ã€‚å¯é—®é¢˜æ˜¯ï¼Œèµ‹å€¼è¯­å¥å³æ‰‹è¾¹çš„è¡¨è¾¾å¼å…ˆæ‰§è¡Œï¼Œè€Œæ­¤æ—¶å˜é‡è¿˜ä¸å­˜åœ¨ã€‚Quantity()è¡¨è¾¾å¼è®¡ç®—çš„ç»“æžœæ˜¯åˆ›å»ºæè¿°ç¬¦å®žä¾‹ï¼Œè€Œæ­¤æ—¶Quantityç±»ä¸­çš„ä»£ç æ— æ³•çŒœå‡ºè¦æŠŠæè¿°ç¬¦ç»‘å®šç»™å“ªä¸ªå˜é‡ã€‚</p><h2 id="lineitemç±»ç¬¬4ç‰ˆè‡ªåŠ¨èŽ·å–å‚¨å­˜å±žæ€§çš„åç§°">LineItemç±»ç¬¬4ç‰ˆï¼šè‡ªåŠ¨èŽ·å–å‚¨å­˜å±žæ€§çš„åç§°</h2><p>æœ¬èŠ‚ä»‹ç»ä¸€ä¸ªä¸å¤ªä¼˜é›…ä½†æ˜¯å¯è¡Œçš„æ–¹æ¡ˆï¼Œè§£å†³é‡å¤è¾“å…¥åç§°çš„é—®é¢˜ã€‚æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ç±»è£…é¥°å™¨æˆ–å…ƒç±»ã€‚</p><p>ä¸ºäº†é¿å…åœ¨æè¿°ç¬¦å£°æ˜Žè¯­å¥ä¸­é‡å¤è¾“å…¥å±žæ€§åï¼Œæˆ‘ä»¬å°†ä¸ºæ¯ä¸ªQuantityå®žä¾‹çš„storage_nameå±žæ€§ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å­—ç¬¦ä¸²ã€‚å³å®žä¾‹å±žæ€§weightåœ¨<code>__dict__</code>ä¸­çš„é”®ä¸æ˜¯'weight'ï¼Œè€Œæ˜¯ç”±æè¿°ç¬¦ç”Ÿæˆçš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡æè¿°ç¬¦çš„<code>__set__</code>æˆ–<code>__get__</code>æ–¹æ³•è®¿é—®è¯¥å±žæ€§ã€‚</p><figure class="highlight python"><figcaption><span>bulkfood_v4.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quantity</span>:</span></span><br><span class="line">    __counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        cls = self.__class__</span><br><span class="line">        prefix = cls.__name__</span><br><span class="line">        index = cls.__counter</span><br><span class="line">        self.storage_name = <span class="string">'_&#123;&#125;#&#123;&#125;'</span>.format(prefix, index)  <span class="comment"># indexç‹¬ä¸€æ— äºŒ</span></span><br><span class="line">        cls.__counter += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> getattr(instance, self.storage_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span>:</span><br><span class="line">            setattr(instance, self.storage_name, value)  <span class="comment"># è¿™é‡Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„setattrå‡½æ•°</span></span><br><span class="line">        <span class="keyword">else</span>:                                            <span class="comment"># å› ä¸ºå­˜å‚¨å±žæ€§çš„åç§°ä¸åŒï¼Œä¸ä¼šæ— é™é€’å½’</span></span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    weight = Quantity()</span><br><span class="line">    price = Quantity()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v4 <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coconuts = LineItem(<span class="string">'Brazilian coconut'</span>, <span class="number">20</span>, <span class="number">17.95</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coconuts.weight, coconuts.price  <span class="comment"># ä½¿ç”¨æè¿°ç¬¦</span></span><br><span class="line">(<span class="number">20</span>, <span class="number">17.95</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(coconuts, <span class="string">'_Quantity#0'</span>)  <span class="comment"># è¯»å–å‚¨å­˜å±žæ€§</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>__get__</code>æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼šselfã€instanceå’Œownerã€‚ownerå‚æ•°æ˜¯æ‰˜ç®¡ç±»ï¼ˆå¦‚LineItemï¼‰çš„å¼•ç”¨ï¼Œé€šè¿‡æè¿°ç¬¦ä»Žæ‰˜ç®¡ç±»ä¸­èŽ·å–å±žæ€§æ—¶ç”¨å¾—åˆ°ã€‚å¦‚æžœä½¿ç”¨LineItem.weightä»Žç±»ä¸­èŽ·å–æ‰˜ç®¡å±žæ€§ï¼Œæè¿°ç¬¦çš„<code>__get__</code>æ–¹æ³•æŽ¥æ”¶åˆ°çš„instanceå‚æ•°å€¼æ˜¯Noneã€‚å› æ­¤ï¼Œä¸‹è¿°æŽ§åˆ¶å°ä¼šè¯æ‰ä¼šæŠ›å‡ºAttributeErrorå¼‚å¸¸ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v4 <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>LineItem.weight</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/bulkfood_v4.py"</span>, line <span class="number">12</span>, <span class="keyword">in</span> __get__</span><br><span class="line">    <span class="keyword">return</span> getattr(instance, self.storage_name)</span><br><span class="line">AttributeError: <span class="string">'NoneType'</span> object has no attribute <span class="string">'_Quantity#0'</span></span><br></pre></td></tr></table></figure><p>æŠ›å‡ºAttributeErrorå¼‚å¸¸æ˜¯å®žçŽ°<code>__get__</code>æ–¹æ³•çš„æ–¹å¼ä¹‹ä¸€ï¼Œå¦‚æžœé€‰æ‹©è¿™ä¹ˆåšï¼Œåº”è¯¥ä¿®æ”¹é”™è¯¯æ¶ˆæ¯ï¼ŒåŽ»æŽ‰ä»¤äººå›°æƒ‘çš„NoneTypeå’Œ_Quantity#0ï¼Œè¿™æ˜¯å®žçŽ°ç»†èŠ‚ã€‚æŠŠé”™è¯¯æ¶ˆæ¯æ”¹æˆ&quot;'LineItem' class has no such attribute&quot;æ›´å¥½ã€‚æœ€å¥½èƒ½ç»™å‡ºç¼ºå°‘çš„å±žæ€§åï¼Œä½†æ˜¯åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæè¿°ç¬¦ä¸çŸ¥é“æ‰˜ç®¡å±žæ€§çš„åç§°ï¼Œå› æ­¤ç›®å‰åªèƒ½åšåˆ°è¿™æ ·ã€‚</p><p>æ­¤å¤–ï¼Œä¸ºäº†ç»™ç”¨æˆ·æä¾›å†…çœå’Œå…¶ä»–å…ƒç¼–ç¨‹æŠ€æœ¯æ”¯æŒï¼Œé€šè¿‡ç±»è®¿é—®æ‰˜ç®¡å±žæ€§æ—¶ï¼Œæœ€å¥½è®©<code>__get__</code>æ–¹æ³•è¿”å›žæè¿°ç¬¦å®žä¾‹ã€‚</p><figure class="highlight python"><figcaption><span>bulkfood_v4.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹åŽçš„__get__æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> self  <span class="comment"># å¦‚æžœä¸æ˜¯é€šè¿‡å®žä¾‹è°ƒç”¨ï¼Œè¿”å›žæè¿°ç¬¦è‡ªèº«</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> getattr(instance, self.storage_name)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v4 <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>LineItem.price</span><br><span class="line">&lt;bulkfood_v4.Quantity object at <span class="number">0x10cc31550</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>br_nuts = LineItem(<span class="string">'Brazil nuts'</span>, <span class="number">10</span>, <span class="number">34.95</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>br_nuts.price</span><br><span class="line"><span class="number">34.95</span></span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½è§‰å¾—å°±ä¸ºäº†ç®¡ç†å‡ ä¸ªå±žæ€§è€Œç¼–å†™è¿™ä¹ˆå¤šä»£ç ä¸å€¼å¾—ï¼Œä½†æ˜¯è¦çŸ¥é“ï¼Œæè¿°ç¬¦é€»è¾‘çŽ°åœ¨è¢«æŠ½è±¡åˆ°å•ç‹¬çš„ä»£ç å•å…ƒä¸­äº†ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨ä½¿ç”¨æè¿°ç¬¦çš„æ¨¡å—ä¸­å®šä¹‰æè¿°ç¬¦ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„å®žç”¨å·¥å…·æ¨¡å—ä¸­å®šä¹‰ï¼Œä»¥ä¾¿åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨â€”â€”å¦‚æžœå¼€å‘çš„æ˜¯æ¡†æž¶ï¼Œç”šè‡³ä¼šåœ¨å¤šä¸ªåº”ç”¨ä¸­ä½¿ç”¨ã€‚</p><h2 id="ç‰¹æ€§å·¥åŽ‚å‡½æ•°å’Œæè¿°ç¬¦ç±»çš„æ¯”è¾ƒ">ç‰¹æ€§å·¥åŽ‚å‡½æ•°å’Œæè¿°ç¬¦ç±»çš„æ¯”è¾ƒ</h2><p>ç‰¹æ€§å·¥åŽ‚å‡½æ•°è‹¥æƒ³å®žçŽ°å¢žå¼ºçš„æè¿°ç¬¦ç±»å¹¶ä¸éš¾ã€‚<code>__counter</code>å˜é‡çš„å®žçŽ°æ–¹å¼æ˜¯ä¸ªéš¾ç‚¹ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå®šä¹‰æˆå·¥åŽ‚å‡½æ•°å¯¹è±¡çš„å±žæ€§ï¼Œä»¥ä¾¿åœ¨å¤šæ¬¡è°ƒç”¨ä¹‹é—´æŒç»­å­˜åœ¨ã€‚</p><figure class="highlight python"><figcaption><span>bulkfood_v4prop.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quantity</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        quantity.counter += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        quantity.counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    storage_name = <span class="string">'_&#123;&#125;:&#123;&#125;'</span>.format(<span class="string">'quantity'</span>, quantity.counter)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">qty_getter</span><span class="params">(instance)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> getattr(instance, storage_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">qty_setter</span><span class="params">(instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span>:</span><br><span class="line">            setattr(instance, storage_name, value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> property(qty_getter, qty_setter)</span><br></pre></td></tr></table></figure><p>ä½ æ›´å–œæ¬¢å“ªç§æ–¹å¼ï¼Ÿæˆ‘å–œæ¬¢æè¿°ç¬¦ç±»é‚£ç§æ–¹å¼ï¼Œä¸»è¦æœ‰ä¸‹åˆ—ä¸¤ä¸ªåŽŸå› ã€‚</p><ul><li>æè¿°ç¬¦ç±»å¯ä»¥ç”¨å­ç±»æ‰©å±•ï¼›è‹¥æƒ³é‡ç”¨å·¥åŽ‚å‡½æ•°ä¸­çš„ä»£ç ï¼Œé™¤äº†å¤åˆ¶ç²˜è´´ï¼Œå¾ˆéš¾æœ‰å…¶ä»–æ–¹æ³•ã€‚</li><li>ä¸Žç‰¹æ€§å·¥åŽ‚å‡½æ•°ä½¿ç”¨å‡½æ•°å±žæ€§å’Œé—­åŒ…ä¿æŒçŠ¶æ€ç›¸æ¯”ï¼Œåœ¨ç±»å±žæ€§å’Œå®žä¾‹å±žæ€§ä¸­ä¿æŒçŠ¶æ€æ›´æ˜“äºŽç†è§£ã€‚</li></ul><p>æ€»ä¹‹ï¼Œä»ŽæŸç§ç¨‹åº¦ä¸Šæ¥è®²ï¼Œç‰¹æ€§å·¥åŽ‚å‡½æ•°æ¨¡å¼è¾ƒç®€å•ï¼Œå¯æ˜¯æè¿°ç¬¦ç±»æ–¹å¼æ›´æ˜“æ‰©å±•ï¼Œè€Œä¸”åº”ç”¨ä¹Ÿæ›´å¹¿æ³›ã€‚</p><h2 id="lineitemç±»ç¬¬5ç‰ˆä¸€ç§æ–°åž‹æè¿°ç¬¦">LineItemç±»ç¬¬5ç‰ˆï¼šä¸€ç§æ–°åž‹æè¿°ç¬¦</h2><p>æˆ‘ä»¬è™šæž„çš„æœ‰æœºé£Ÿç‰©ç½‘åº—é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šä¸çŸ¥æ€Žä¹ˆå›žäº‹å„¿ï¼Œæœ‰ä¸ªå•†å“çš„æè¿°ä¿¡æ¯ä¸ºç©ºï¼Œå¯¼è‡´æ— æ³•ä¸‹è®¢å•ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦å†åˆ›å»ºä¸€ä¸ªæè¿°ç¬¦ï¼ŒNonBlankã€‚åœ¨è®¾è®¡NonBlankçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘çŽ°ï¼Œå®ƒä¸ŽQuantityæè¿°ç¬¦å¾ˆåƒï¼Œåªæ˜¯éªŒè¯é€»è¾‘ä¸åŒã€‚</p><p>å›žæƒ³Quantityçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å®ƒåšäº†ä¸¤ä»¶ä¸åŒçš„äº‹ï¼šç®¡ç†æ‰˜ç®¡å®žä¾‹ä¸­çš„å‚¨å­˜å±žæ€§ï¼Œä»¥åŠéªŒè¯ç”¨äºŽè®¾ç½®é‚£ä¸¤ä¸ªå±žæ€§çš„å€¼ã€‚ç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥é‡æž„ï¼Œå¹¶åˆ›å»ºä¸¤ä¸ªåŸºç±»ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/ZPBVIW915CRlzodc1No14A4U88YWgs2PTYTTMcTZTmn2ZUoFuIBfXOeL61AeIPfBteI5JpCpwrMlqBZZcffGStS-VkUSxvmpcWaT1socYBLBB1l64OX6TUHejd4iubWCf1KWdgfgLWeJP0UH8r4LmoGAX7GIaOIbPmLdO8EewgeQHsj49n2p2hO80YOw91l0l-bIjyFxJLxEquiExTMfrs3dRNv_nKebVppWBotkZVQnFtpqXqyIdrA23K057ZZ4XXe1Uz0qT4YGldwYNpwMn7HO9WjEPdL2exOHJmYdhF1ClUh2ueIjgKltq_UQj5UMBbjv_b0xcxLWjNVsLXNgu99NEdHyFMcEUCMJCEqt-Er0L0ZxpUbWqactwB_clZwAp7NzN54ej5rXXJeVtScM4f-RrOAxxgGW9WOv_MC52oFAl6qBRvaG7u7_9ovzeKpaP_tAmY4oaSZSqweUzlm6"><p>Validateã€Quantityå’ŒNonBlankä¸‰ä¸ªç±»ä¹‹é—´çš„å…³ç³»ä½“çŽ°äº†æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€‚å…·ä½“è€Œè¨€ï¼Œ<code>validate.__set__</code>æ–¹æ³•æ­£æ˜¯æ¨¡æ¿æ–¹æ³•çš„ä¾‹è¯ï¼š</p><blockquote><p>ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ç”¨ä¸€äº›æŠ½è±¡çš„æ“ä½œå®šä¹‰ä¸€ä¸ªç®—æ³•ï¼Œè€Œå­ç±»å°†é‡å®šä¹‰è¿™äº›æ“ä½œä»¥æä¾›å…·ä½“çš„è¡Œä¸ºã€‚</p></blockquote><figure class="highlight python"><figcaption><span>model_v5.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoStorage</span>:</span></span><br><span class="line">    __counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        cls = self.__class__</span><br><span class="line">        prefix = cls.__name__</span><br><span class="line">        index = cls.__counter</span><br><span class="line">        self.storage_name = <span class="string">'_&#123;&#125;#&#123;&#125;'</span>.format(prefix, index)</span><br><span class="line">        cls.__counter += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> getattr(instance, self.storage_name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        setattr(instance, self.storage_name, value)  <span class="comment"># æ— éªŒè¯</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Validate</span><span class="params">(abc.ABC, AutoStorage)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        value = self.validate(instance, value)  <span class="comment"># å§”æ‰˜validateæ–¹æ³•</span></span><br><span class="line">        super().__set__(instance, value)  <span class="comment"># ç„¶åŽæŠŠè¿”å›žçš„valueä¼ ç»™è¶…ç±»çš„__set__æ–¹æ³•ï¼Œå­˜å‚¨å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, instance, value)</span>:</span>  <span class="comment"># æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">        <span class="string">"""return validated value or raise ValueError"""</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quantity</span><span class="params">(Validate)</span>:</span></span><br><span class="line">    <span class="string">"""a number greater than zero"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonBlank</span><span class="params">(Validate)</span>:</span></span><br><span class="line">    <span class="string">"""a string with at least one non-space character"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        value = value.strip()</span><br><span class="line">        <span class="keyword">if</span> len(value) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value cannot be empty or blank'</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>bulkfood_v5.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> model_v5 <span class="keyword">as</span> model</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    description = model.NonBlank()  <span class="comment"># é™¤æ­¤ä¹‹å¤–çš„å…¶ä½™ä»£ç ä¸å˜</span></span><br><span class="line">    weight = model.Quantity()</span><br><span class="line">    price = model.Quantity()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><p>æœ¬ç« æ¼”ç¤ºäº†<strong>æè¿°ç¬¦çš„å…¸åž‹ç”¨é€”â€”â€”ç®¡ç†æ•°æ®å±žæ€§ã€‚</strong>è¿™ç§æè¿°ç¬¦ä¹Ÿå«è¦†ç›–åž‹æè¿°ç¬¦ï¼Œå› ä¸ºæè¿°ç¬¦çš„<code>__set__</code>æ–¹æ³•ä½¿ç”¨æ‰˜ç®¡å®žä¾‹ä¸­çš„åŒåå±žæ€§è¦†ç›–ï¼ˆå³æ’æ‰‹æŽ¥ç®¡ï¼‰äº†è¦è®¾ç½®çš„å±žæ€§ã€‚ä¸è¿‡ä¹Ÿæœ‰éžè¦†ç›–åž‹æè¿°ç¬¦ã€‚</p><h1 id="è¦†ç›–åž‹ä¸Žéžè¦†ç›–åž‹æè¿°ç¬¦å¯¹æ¯”">è¦†ç›–åž‹ä¸Žéžè¦†ç›–åž‹æè¿°ç¬¦å¯¹æ¯”</h1><p><strong>Pythonå­˜å–å±žæ€§çš„æ–¹å¼ç‰¹åˆ«ä¸å¯¹ç­‰ã€‚é€šè¿‡å®žä¾‹è¯»å–å±žæ€§æ—¶ï¼Œé€šå¸¸è¿”å›žçš„æ˜¯å®žä¾‹ä¸­å®šä¹‰çš„å±žæ€§ï¼›ä½†æ˜¯ï¼Œå¦‚æžœå®žä¾‹ä¸­æ²¡æœ‰æŒ‡å®šçš„å±žæ€§ï¼Œé‚£ä¹ˆä¼šèŽ·å–ç±»å±žæ€§ã€‚è€Œä¸ºå®žä¾‹ä¸­çš„å±žæ€§èµ‹å€¼æ—¶ï¼Œé€šå¸¸ä¼šåœ¨å®žä¾‹ä¸­åˆ›å»ºå±žæ€§ï¼Œæ ¹æœ¬ä¸å½±å“ç±»ã€‚</strong></p><p>è¿™ç§ä¸å¯¹ç­‰çš„å¤„ç†æ–¹å¼å¯¹æè¿°ç¬¦ä¹Ÿæœ‰å½±å“ã€‚å…¶å®žï¼Œæ ¹æ®æ˜¯å¦å®šä¹‰<code>__set__</code>æ–¹æ³•ï¼Œæè¿°ç¬¦å¯åˆ†ä¸ºä¸¤å¤§ç±»ã€‚</p><figure class="highlight python"><figcaption><span>descriptorkinds.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">### è¾…åŠ©å‡½æ•°ï¼Œä»…ç”¨äºŽæ˜¾ç¤º ###</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cls_name</span><span class="params">(obj_or_cls)</span>:</span></span><br><span class="line">    cls = type(obj_or_cls)</span><br><span class="line">    <span class="keyword">if</span> cls <span class="keyword">is</span> type:</span><br><span class="line">        cls = obj_or_cls</span><br><span class="line">    <span class="keyword">return</span> cls.__name__.split(<span class="string">'.'</span>)[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">(obj)</span>:</span></span><br><span class="line">    cls = type(obj)</span><br><span class="line">    <span class="keyword">if</span> cls <span class="keyword">is</span> type:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;class &#123;&#125;&gt;'</span>.format(obj.__name__)</span><br><span class="line">    <span class="keyword">elif</span> cls <span class="keyword">in</span> [type(<span class="literal">None</span>), int]:</span><br><span class="line">        <span class="keyword">return</span> repr(obj)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;&#123;&#125; object&gt;'</span>.format(cls_name(obj))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_args</span><span class="params">(name, *args)</span>:</span></span><br><span class="line">    pseudo_args = <span class="string">', '</span>.join(display(x) <span class="keyword">for</span> x <span class="keyword">in</span> args)</span><br><span class="line">    print(<span class="string">'-&gt; &#123;&#125;.__&#123;&#125;__(&#123;&#125;)'</span>.format(cls_name(args[<span class="number">0</span>]), name, pseudo_args))</span><br><span class="line"></span><br><span class="line"><span class="comment">### å¯¹è¿™ä¸ªç¤ºä¾‹é‡è¦çš„ç±» ###</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Overriding</span>:</span></span><br><span class="line">    <span class="string">"""è¦†ç›–åž‹æè¿°ç¬¦ï¼Œä¹Ÿç§°æ•°æ®æè¿°ç¬¦æˆ–å¼ºåˆ¶æè¿°ç¬¦"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print_args(<span class="string">'get'</span>, self, instance, owner)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print_args(<span class="string">'set'</span>, self, instance, value)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OverridingNoGet</span>:</span></span><br><span class="line">    <span class="string">"""æ²¡æœ‰``__get__``æ–¹æ³•çš„è¦†ç›–åž‹æè¿°ç¬¦"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print_args(<span class="string">'set'</span>, self, instance, value)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonOverriding</span>:</span>  <span class="comment"># æ²¡æœ‰__set__æ–¹æ³•</span></span><br><span class="line">    <span class="string">"""éžè¦†ç›–åž‹æè¿°ç¬¦ï¼Œä¹Ÿç§°éžæ•°æ®æè¿°ç¬¦æˆ–é®ç›–åž‹æè¿°ç¬¦"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print_args(<span class="string">'get'</span>, self, instance, owner)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Managed</span>:</span>  <span class="comment"># æ‰˜ç®¡ç±»ï¼Œä½¿ç”¨å„ä¸ªæè¿°ç¬¦ç±»çš„ä¸€ä¸ªå®žä¾‹</span></span><br><span class="line">    over = Overriding()</span><br><span class="line">    over_no_get = OverridingNoGet()</span><br><span class="line">    non_over = NonOverriding()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">spam</span><span class="params">(self)</span>:</span>  <span class="comment"># æ–¹æ³•ä¹Ÿæ˜¯æè¿°ç¬¦</span></span><br><span class="line">        print(<span class="string">'-&gt; Managed.spam(&#123;&#125;)'</span>.format(display(self)))</span><br></pre></td></tr></table></figure><h2 id="è¦†ç›–åž‹æè¿°ç¬¦">è¦†ç›–åž‹æè¿°ç¬¦</h2><p>å®žçŽ°<code>__set__</code>æ–¹æ³•çš„æè¿°ç¬¦å±žäºŽè¦†ç›–åž‹æè¿°ç¬¦ï¼Œä¼šè¦†ç›–å¯¹å®žä¾‹å±žæ€§çš„èµ‹å€¼æ“ä½œã€‚ç‰¹æ€§ä¹Ÿæ˜¯è¦†ç›–åž‹æè¿°ç¬¦ï¼šå¦‚æžœæ²¡æœ‰æä¾›è®¾å€¼å‡½æ•°ï¼Œpropertyç±»ä¸­çš„<code>__set__</code>æ–¹æ³•ä¼šæŠ›å‡ºAttributeErrorå¼‚å¸¸ï¼ŒæŒ‡æ˜Žé‚£ä¸ªå±žæ€§æ˜¯åªè¯»çš„ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> descriptorkinds <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = Managed()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over  <span class="comment"># è§¦å‘__get__æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„å€¼æ˜¯æ‰˜ç®¡å®žä¾‹</span></span><br><span class="line">-&gt; Overriding.__get__(&lt;Overriding object&gt;, &lt;Managed object&gt;, &lt;class Managed&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.over  <span class="comment"># Managed.overè§¦å‘çš„__get__æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„å€¼æ˜¯None</span></span><br><span class="line">-&gt; Overriding.__get__(&lt;Overriding object&gt;, None, &lt;class Managed&gt;)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over = <span class="number">7</span>  <span class="comment"># èµ‹å€¼</span></span><br><span class="line">-&gt; Overriding.__set__(&lt;Overriding object&gt;, &lt;Managed object&gt;, 7)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over  <span class="comment"># è¯»å–</span></span><br><span class="line">-&gt; Overriding.__get__(&lt;Overriding object&gt;, &lt;Managed object&gt;, &lt;class Managed&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.__dict__[<span class="string">'over'</span>] = <span class="number">7</span>  <span class="comment"># è·³è¿‡æè¿°ç¬¦èµ‹å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vars(obj)</span><br><span class="line">&#123;<span class="string">'over'</span>: <span class="number">7</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over  <span class="comment"># å³ä½¿æœ‰åä¸ºoverçš„å®žä¾‹å±žæ€§ï¼ŒManaged.overæè¿°ç¬¦ä»ä¼šè¦†ç›–è¯»å–obj.over</span></span><br><span class="line">-&gt; Overriding.__get__(&lt;Overriding object&gt;, &lt;Managed object&gt;, &lt;class Managed&gt;)</span><br></pre></td></tr></table></figure><h2 id="æ²¡æœ‰__get__æ–¹æ³•çš„è¦†ç›–åž‹æè¿°ç¬¦">æ²¡æœ‰<code>__get__</code>æ–¹æ³•çš„è¦†ç›–åž‹æè¿°ç¬¦</h2><p>æè¿°ç¬¦å¯ä»¥åªå®žçŽ°<code>__set__</code>æ–¹æ³•ï¼Œæ­¤æ—¶ï¼Œåªæœ‰å†™æ“ä½œç”±æè¿°ç¬¦å¤„ç†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over_no_get  <span class="comment"># å› ä¸ºOverridingNoGetæè¿°ç¬¦æ²¡æœ‰__get__æ–¹æ³•ï¼Œè¯»æ“ä½œè¿”å›žçš„æ˜¯æè¿°ç¬¦å®žä¾‹</span></span><br><span class="line">&lt;descriptorkinds.OverridingNoGet object at <span class="number">0x10fd71860</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.over_no_get</span><br><span class="line">&lt;descriptorkinds.OverridingNoGet object at <span class="number">0x10fd71860</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over_no_get = <span class="number">7</span>  <span class="comment"># æœ‰__set__æ–¹æ³•ï¼Œèµ‹å€¼æ—¶ä¼šè§¦å‘</span></span><br><span class="line">-&gt; OverridingNoGet.__set__(&lt;OverridingNoGet object&gt;, &lt;Managed object&gt;, 7)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over_no_get  <span class="comment"># ç”±äºŽ__set__æ–¹æ³•æ²¡æœ‰å­˜å‚¨å€¼ï¼Œåªæ˜¯æ‰“å°äº†æ¶ˆæ¯ï¼Œæ­¤å¤„ä¾ç„¶è¿”å›žå®žä¾‹å¯¹è±¡</span></span><br><span class="line">&lt;descriptorkinds.OverridingNoGet object at <span class="number">0x10fd71860</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.__dict__[<span class="string">'over_no_get'</span>] = <span class="number">9</span>  <span class="comment"># è·³è¿‡æè¿°ç¬¦èµ‹å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over_no_get  <span class="comment"># è¯»å€¼æ“ä½œï¼Œç”±äºŽæ²¡æœ‰__get__æ–¹æ³•ï¼Œå®žä¾‹å±žæ€§é®ç›–äº†æè¿°ç¬¦</span></span><br><span class="line"><span class="number">9</span>                    <span class="comment"># ä½†æ˜¯åªæœ‰è¯»æ“ä½œæ˜¯å¦‚æ­¤</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over_no_get = <span class="number">7</span></span><br><span class="line">-&gt; OverridingNoGet.__set__(&lt;OverridingNoGet object&gt;, &lt;Managed object&gt;, 7)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over_no_get</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure><h2 id="éžè¦†ç›–åž‹æè¿°ç¬¦">éžè¦†ç›–åž‹æè¿°ç¬¦</h2><p>æ²¡æœ‰å®žçŽ°<code>__set__</code>æ–¹æ³•çš„æè¿°ç¬¦æ˜¯éžè¦†ç›–åž‹æè¿°ç¬¦ã€‚å¦‚æžœè®¾ç½®äº†åŒåçš„å®žä¾‹å±žæ€§ï¼Œæè¿°ç¬¦ä¼šè¢«é®ç›–ï¼Œè‡´ä½¿æè¿°ç¬¦æ— æ³•å¤„ç†é‚£ä¸ªå®žä¾‹çš„é‚£ä¸ªå±žæ€§ã€‚æ–¹æ³•æ˜¯ä»¥éžè¦†ç›–åž‹æè¿°ç¬¦å®žçŽ°çš„ã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.non_over  <span class="comment"># è§¦å‘__get__æ–¹æ³•</span></span><br><span class="line">-&gt; NonOverriding.__get__(&lt;NonOverriding object&gt;, &lt;Managed object&gt;, &lt;class Managed&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.non_over = <span class="number">7</span>  <span class="comment"># èµ‹å€¼ï¼ŒçŽ°åœ¨objæœ‰ä¸ªåä¸ºnon_overçš„å®žä¾‹å±žæ€§</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.non_over  <span class="comment"># è¯»å€¼ï¼Œå®žä¾‹å±žæ€§é®ç›–äº†objçš„åŒåæè¿°ç¬¦</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.non_over  <span class="comment"># æè¿°ç¬¦ä¾ç„¶å­˜åœ¨</span></span><br><span class="line">-&gt; NonOverriding.__get__(&lt;NonOverriding object&gt;, None, &lt;class Managed&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> obj.non_over  <span class="comment"># åˆ é™¤å®žä¾‹å±žæ€§</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.non_over  <span class="comment"># èƒ½è§¦å‘__get__æ–¹æ³•äº†</span></span><br><span class="line">-&gt; NonOverriding.__get__(&lt;NonOverriding object&gt;, &lt;Managed object&gt;, &lt;class Managed&gt;)</span><br></pre></td></tr></table></figure><h2 id="åœ¨ç±»ä¸­è¦†ç›–æè¿°ç¬¦">åœ¨ç±»ä¸­è¦†ç›–æè¿°ç¬¦</h2><p>ä¾é™„åœ¨<strong>ç±»</strong>ä¸Šçš„æè¿°ç¬¦æ— æ³•æŽ§åˆ¶ä¸ºç±»å±žæ€§èµ‹å€¼çš„æ“ä½œã€‚è¿™æ„å‘³ç€ä¸ºç±»å±žæ€§èµ‹å€¼èƒ½è¦†ç›–æè¿°ç¬¦å±žæ€§ã€‚</p><p>ä¸ç®¡æè¿°ç¬¦æ˜¯ä¸æ˜¯è¦†ç›–åž‹ï¼Œä¸ºç±»å±žæ€§èµ‹å€¼éƒ½èƒ½è¦†ç›–æè¿°ç¬¦ã€‚è¿™æ˜¯ä¸€ç§çŒ´å­å¸ƒä¸æŠ€æœ¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = Managed()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.over = <span class="number">1</span>  <span class="comment"># è¦†ç›–ç±»å±žæ€§ï¼Œä¸ä¼šè§¦å‘__set__æ–¹æ³•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.over_no_get = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.non_over = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.over, obj.over_no_get, obj.non_over</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹æ­ç¤ºäº†è¯»å†™å±žæ€§çš„å¦ä¸€ç§ä¸å¯¹ç­‰ï¼šè¯»ç±»å±žæ€§çš„æ“ä½œå¯ä»¥ç”±ä¾é™„åœ¨æ‰˜ç®¡ç±»ä¸Šå®šä¹‰æœ‰<code>__get__</code>æ–¹æ³•çš„æè¿°ç¬¦å¤„ç†ï¼Œä½†æ˜¯å†™ç±»å±žæ€§çš„æ“ä½œä¸ä¼šç”±ä¾é™„åœ¨æ‰˜ç®¡ç±»ä¸Šå®šä¹‰æœ‰<code>__set__</code>æ–¹æ³•çš„æè¿°ç¬¦å¤„ç†ã€‚</strong></p><p>è‹¥æƒ³æŽ§åˆ¶è®¾ç½®ç±»å±žæ€§çš„æ“ä½œï¼Œè¦æŠŠæè¿°ç¬¦ä¾é™„åœ¨ç±»çš„ç±»ä¸Šï¼Œå³ä¾é™„åœ¨å…ƒç±»ä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹ç”¨æˆ·å®šä¹‰çš„ç±»æ¥è¯´ï¼Œå…¶å…ƒç±»æ˜¯typeï¼Œè€Œæˆ‘ä»¬ä¸èƒ½ä¸ºtypeæ·»åŠ å±žæ€§ã€‚</p><h1 id="æ–¹æ³•æ˜¯æè¿°ç¬¦">æ–¹æ³•æ˜¯æè¿°ç¬¦</h1><p>åœ¨ç±»ä¸­å®šä¹‰çš„å‡½æ•°å±žäºŽç»‘å®šæ–¹æ³•ï¼ˆbound methodï¼‰ï¼Œå› ä¸ºç”¨æˆ·å®šä¹‰çš„å‡½æ•°éƒ½æœ‰<code>__get__</code>æ–¹æ³•ï¼Œæ‰€ä»¥ä¾é™„åˆ°ç±»ä¸Šæ—¶ï¼Œå°±ç›¸å½“äºŽæè¿°ç¬¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> descriptorkinds <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = Managed()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.spam  <span class="comment"># èŽ·å–çš„æ˜¯ç»‘å®šæ–¹æ³•å¯¹è±¡</span></span><br><span class="line">&lt;bound method Managed.spam of &lt;descriptorkinds.Managed object at <span class="number">0x10251dcf8</span>&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Managed.spam  <span class="comment"># èŽ·å–çš„æ˜¯å‡½æ•°</span></span><br><span class="line">&lt;function Managed.spam at <span class="number">0x102528158</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.spam = <span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.spam</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°æ²¡æœ‰å®žçŽ°<code>__set__</code>æ–¹æ³•ï¼Œå› æ­¤æ˜¯éžè¦†ç›–åž‹æè¿°ç¬¦ã€‚ä»Žç¤ºä¾‹ä¸­è¿˜å¯ä»¥çœ‹å‡ºä¸€ä¸ªé‡è¦ä¿¡æ¯ï¼šobj.spamå’ŒManaged.spamèŽ·å–çš„æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚ä¸Žæè¿°ç¬¦ä¸€æ ·ï¼Œé€šè¿‡æ‰˜ç®¡ç±»è®¿é—®æ—¶ï¼Œå‡½æ•°çš„<code>__get__</code>æ–¹æ³•ä¼šè¿”å›žè‡ªèº«çš„å¼•ç”¨ã€‚ä½†æ˜¯ï¼Œé€šè¿‡å®žä¾‹è®¿é—®æ—¶ï¼Œå‡½æ•°çš„<code>__get__</code>æ–¹æ³•è¿”å›žçš„æ˜¯ç»‘å®šæ–¹æ³•å¯¹è±¡ï¼šä¸€ç§å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œé‡Œé¢åŒ…è£…ç€å‡½æ•°ï¼Œå¹¶æŠŠæ‰˜ç®¡å®žä¾‹ï¼ˆä¾‹å¦‚objï¼‰ç»‘å®šç»™å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³selfï¼‰ï¼Œè¿™ä¸Žfunctools.partialå‡½æ•°çš„è¡Œä¸ºä¸€è‡´ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> collections</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Text</span><span class="params">(collections.UserString)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">'Text(&#123;!r&#125;)'</span>.format(self.data)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> self[::<span class="number">-1</span>]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word = Text(<span class="string">'forward'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word  <span class="comment"># å®žä¾‹</span></span><br><span class="line">Text(<span class="string">'forward'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word.reverse()  <span class="comment"># è°ƒç”¨å®žä¾‹æ–¹æ³•</span></span><br><span class="line">Text(<span class="string">'drawrof'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Text.reverse(Text(<span class="string">'backward'</span>))  <span class="comment"># åœ¨ç±»ä¸Šè°ƒç”¨æ–¹æ³•ç›¸å½“äºŽè°ƒç”¨å‡½æ•°ï¼Œä¼ å…¥selfå‚æ•°</span></span><br><span class="line">Text(<span class="string">'drawkcab'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(Text.reverse), type(word.reverse)  <span class="comment"># ç±»åž‹ä¸åŒï¼Œå‰è€…æ˜¯å‡½æ•°ï¼ŒåŽè€…æ˜¯æ–¹æ³•</span></span><br><span class="line">(&lt;class 'function'&gt;, &lt;class 'method'&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(Text.reverse, [<span class="string">'repaid'</span>, (<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>), Text(<span class="string">'stressed'</span>)]))  <span class="comment"># è¯¥å‡½æ•°å¯ä»¥å¤„ç†å…¶ä»–å¯¹è±¡</span></span><br><span class="line">[<span class="string">'diaper'</span>, (<span class="number">30</span>, <span class="number">20</span>, <span class="number">10</span>), Text(<span class="string">'desserts'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Text.reverse.__get__(word)  <span class="comment"># è°ƒç”¨å‡½æ•°çš„__get__æ–¹æ³•ä¼ å…¥å®žä¾‹æ—¶ï¼Œå¾—åˆ°çš„æ˜¯ç»‘å®šåˆ°é‚£ä¸ªå®žä¾‹ä¸Šçš„æ–¹æ³•</span></span><br><span class="line">&lt;bound method Text.reverse of Text(<span class="string">'forward'</span>)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Text.reverse.__get__(<span class="literal">None</span>, Text)  <span class="comment"># å¦‚æžœinstanceçš„å€¼æ˜¯Noneï¼Œå¾—åˆ°çš„æ˜¯å‡½æ•°æœ¬èº«</span></span><br><span class="line">&lt;function Text.reverse at <span class="number">0x1025281e0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word.reverse  <span class="comment"># word.reverseè¡¨è¾¾å¼å…¶å®žä¼šè°ƒç”¨Text.reverse.__get__(word)ï¼Œè¿”å›žå¯¹åº”çš„ç»‘å®šæ–¹æ³•</span></span><br><span class="line">&lt;bound method Text.reverse of Text(<span class="string">'forward'</span>)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word.reverse.__self__  <span class="comment"># ç»‘å®šæ–¹æ³•å¯¹è±¡æœ‰ä¸ª__self__å±žæ€§ï¼Œå€¼æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å®žä¾‹å¼•ç”¨</span></span><br><span class="line">Text(<span class="string">'forward'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word.reverse.__func__ <span class="keyword">is</span> Text.reverse  <span class="comment"># __func__å±žæ€§æ˜¯ä¾é™„åœ¨æ‰˜ç®¡ç±»ä¸Šé‚£ä¸ªåŽŸå§‹å‡½æ•°çš„å¼•ç”¨</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word.reverse.__call__()  <span class="comment"># __call__æ–¹æ³•ç”¨äºŽå¤„ç†çœŸæ­£çš„è°ƒç”¨è¿‡ç¨‹ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨__func__å±žæ€§</span></span><br><span class="line">Text(<span class="string">'drawrof'</span>)              <span class="comment"># å¼•ç”¨çš„åŽŸå§‹å‡½æ•°ï¼ŒæŠŠå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ä¸ºç»‘å®šæ–¹æ³•çš„__self__å±žæ€§</span></span><br><span class="line">                             <span class="comment"># è¿™å°±æ˜¯å½¢å‚selfçš„éšå¼ç»‘å®šæ–¹å¼</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°ä¼šå˜æˆç»‘å®šæ–¹æ³•ï¼Œè¿™æ˜¯Pythonè¯­è¨€åº•å±‚ä½¿ç”¨æè¿°ç¬¦çš„æœ€å¥½ä¾‹è¯ã€‚</p><h1 id="æè¿°ç¬¦ç”¨æ³•å»ºè®®">æè¿°ç¬¦ç”¨æ³•å»ºè®®</h1><ul><li><p>ä½¿ç”¨ç‰¹æ€§ä»¥ä¿æŒç®€å•</p><p>å†…ç½®çš„propetyç±»åˆ›å»ºçš„å…¶å®žæ˜¯è¦†ç›–åž‹æè¿°ç¬¦ï¼Œ<code>__set__</code>æ–¹æ³•å’Œ<code>__get__</code>æ–¹æ³•éƒ½å®žçŽ°äº†ï¼Œå³ä¾¿ä¸å®šä¹‰è®¾å€¼æ–¹æ³•ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç‰¹æ€§çš„<code>__set__</code>æ–¹æ³•é»˜è®¤æŠ›å‡ºAttributeError: can't set attributeï¼Œå› æ­¤åˆ›å»ºåªè¯»å±žæ€§æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ç‰¹æ€§ï¼Œè¿™èƒ½é¿å…ä¸‹ä¸€æ¡æ‰€è¿°çš„é—®é¢˜ã€‚</p></li><li><p>åªè¯»æè¿°ç¬¦å¿…é¡»æœ‰<code>__set__</code>æ–¹æ³•</p><p>å¦‚æžœä½¿ç”¨æè¿°ç¬¦ç±»å®žçŽ°åªè¯»å±žæ€§ï¼Œè¦è®°ä½ï¼Œ<code>__get__</code>å’Œ<code>__set__</code>ä¸¤ä¸ªæ–¹æ³•å¿…é¡»éƒ½å®šä¹‰ï¼Œå¦åˆ™ï¼Œå®žä¾‹çš„åŒåå±žæ€§ä¼šé®ç›–æè¿°ç¬¦ã€‚åªè¯»å±žæ€§çš„<code>__set__</code>æ–¹æ³•åªéœ€æŠ›å‡ºAttributeErrorå¼‚å¸¸ï¼Œå¹¶æä¾›åˆé€‚çš„é”™è¯¯ä¿¡æ¯ã€‚</p></li><li><p>ç”¨äºŽéªŒè¯çš„æè¿°ç¬¦å¯ä»¥åªæœ‰<code>__set__</code>æ–¹æ³•</p><p>å¯¹ä»…ç”¨äºŽéªŒè¯çš„æè¿°ç¬¦æ¥è¯´ï¼Œ<code>__set__</code>æ–¹æ³•åº”è¯¥æ£€æŸ¥valueå‚æ•°èŽ·å¾—çš„å€¼ï¼Œå¦‚æžœæœ‰æ•ˆï¼Œä½¿ç”¨æè¿°ç¬¦å®žä¾‹çš„åç§°ä¸ºé”®ï¼Œç›´æŽ¥åœ¨å®žä¾‹çš„<code>__dict__</code>å±žæ€§ä¸­è®¾ç½®ã€‚è¿™æ ·ï¼Œä»Žå®žä¾‹ä¸­è¯»å–åŒåå±žæ€§çš„é€Ÿåº¦å¾ˆå¿«ï¼Œå› ä¸ºä¸ç”¨ç»è¿‡<code>__get__</code>æ–¹æ³•å¤„ç†ã€‚</p></li><li><p>ä»…æœ‰<code>__get__</code>æ–¹æ³•çš„æè¿°ç¬¦å¯ä»¥å®žçŽ°é«˜é€Ÿç¼“å­˜</p><p>å¦‚æžœåªç¼–å†™äº†<code>__get__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆåˆ›å»ºçš„æ˜¯éžè¦†ç›–åž‹æè¿°ç¬¦ã€‚è¿™ç§æè¿°ç¬¦å¯ç”¨äºŽæ‰§è¡ŒæŸäº›è€—è´¹èµ„æºçš„è®¡ç®—ï¼Œç„¶åŽä¸ºå®žä¾‹è®¾ç½®åŒåå±žæ€§ï¼Œç¼“å­˜ç»“æžœã€‚åŒåå®žä¾‹å±žæ€§ä¼šé®ç›–æè¿°ç¬¦ï¼Œå› æ­¤åŽç»­è®¿é—®ä¼šç›´æŽ¥ä»Žå®žä¾‹çš„<code>__dict__</code>å±žæ€§ä¸­èŽ·å–å€¼ï¼Œè€Œä¸ä¼šå†è§¦å‘æè¿°ç¬¦çš„<code>__get__</code>æ–¹æ³•ã€‚</p></li><li><p>éžç‰¹æ®Šçš„æ–¹æ³•å¯ä»¥è¢«å®žä¾‹å±žæ€§é®ç›–</p><p>ç”±äºŽå‡½æ•°å’Œæ–¹æ³•åªå®žçŽ°äº†<code>__get__</code>æ–¹æ³•ï¼Œå®ƒä»¬ä¸ä¼šå¤„ç†åŒåå®žä¾‹å±žæ€§çš„èµ‹å€¼æ“ä½œã€‚å› æ­¤ï¼Œåƒ<code>my_obj.the_method = 7</code>è¿™æ ·ç®€å•èµ‹å€¼ä¹‹åŽï¼ŒåŽç»­é€šè¿‡è¯¥å®žä¾‹è®¿é—®the_methodå¾—åˆ°çš„æ˜¯æ•°å­—7â€”â€”ä½†æ˜¯ä¸å½±å“ç±»æˆ–å…¶ä»–å®žä¾‹ã€‚ç„¶è€Œï¼Œç‰¹æ®Šæ–¹æ³•ä¸å—è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚è§£é‡Šå™¨åªä¼šåœ¨ç±»ä¸­å¯»æ‰¾ç‰¹æ®Šæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œrepr(x)æ‰§è¡Œçš„å…¶å®žæ˜¯<code>x.__class__.__repr__(x)</code>ï¼Œå› æ­¤xçš„<code>__repr__</code>å±žæ€§å¯¹repr(x)æ–¹æ³•è°ƒç”¨æ²¡æœ‰å½±å“ã€‚å‡ºäºŽåŒæ ·çš„åŽŸå› ï¼Œå®žä¾‹çš„<code>__getattr__</code>å±žæ€§ä¸ä¼šç ´åå¸¸è§„çš„å±žæ€§è®¿é—®è§„åˆ™ã€‚</p></li></ul><h1 id="æè¿°ç¬¦çš„æ–‡æ¡£å­—ç¬¦ä¸²å’Œè¦†ç›–åˆ é™¤æ“ä½œ">æè¿°ç¬¦çš„æ–‡æ¡£å­—ç¬¦ä¸²å’Œè¦†ç›–åˆ é™¤æ“ä½œ</h1><p>æè¿°ç¬¦ç±»çš„æ–‡æ¡£å­—ç¬¦ä¸²ç”¨äºŽæ³¨è§£æ‰˜ç®¡ç±»ä¸­çš„å„ä¸ªæè¿°ç¬¦å®žä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bulkfood_v5 <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>help(LineItem)</span><br><span class="line">Help on <span class="class"><span class="keyword">class</span> <span class="title">LineItem</span> <span class="title">in</span> <span class="title">module</span> <span class="title">bulkfood_v5</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span><span class="params">(builtins.object)</span></span></span><br><span class="line"><span class="class"> |  <span class="title">Methods</span> <span class="title">defined</span> <span class="title">here</span>:</span></span><br><span class="line"> |  </span><br><span class="line"> |  __init__(self, description, weight, price)</span><br><span class="line"> |      Initialize self.  See help(type(self)) <span class="keyword">for</span> accurate signature.</span><br><span class="line"> |  </span><br><span class="line"> |  subtotal(self)</span><br><span class="line"> |  </span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data descriptors defined here:</span><br><span class="line"> |  </span><br><span class="line"> |  __dict__</span><br><span class="line"> |      dictionary <span class="keyword">for</span> instance variables (<span class="keyword">if</span> defined)</span><br><span class="line"> |  </span><br><span class="line"> |  __weakref__</span><br><span class="line"> |      list of weak references to the object (<span class="keyword">if</span> defined)</span><br><span class="line"> |  </span><br><span class="line"> |  description</span><br><span class="line"> |      a string <span class="keyword">with</span> at least one non-space character</span><br><span class="line"> |  </span><br><span class="line"> |  price</span><br><span class="line"> |      a number greater than zero</span><br><span class="line"> |  </span><br><span class="line"> |  weight</span><br><span class="line"> |      a number greater than zero</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>help(LineItem.weight)  <span class="comment"># æç¤ºçš„ä¿¡æ¯æœ‰ç‚¹ä¸è¶³</span></span><br><span class="line">Help on Quantity <span class="keyword">in</span> module model_v5 object:</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Quantity</span><span class="params">(Validate)</span></span></span><br><span class="line"><span class="class"> |  <span class="title">a</span> <span class="title">number</span> <span class="title">greater</span> <span class="title">than</span> <span class="title">zero</span></span></span><br><span class="line"><span class="class"> |  </span></span><br><span class="line"><span class="class"> |  <span class="title">Method</span> <span class="title">resolution</span> <span class="title">order</span>:</span></span><br><span class="line"> |      Quantity</span><br><span class="line"> |      Validate</span><br><span class="line"> |      abc.ABC</span><br><span class="line"> |      AutoStorage</span><br><span class="line"> |      builtins.object</span><br><span class="line"> |  </span><br><span class="line"> |  Methods defined here:</span><br><span class="line"> |  </span><br><span class="line"> |  validate(self, instance, value)</span><br><span class="line"> |      <span class="keyword">return</span> validated value <span class="keyword">or</span> <span class="keyword">raise</span> ValueError</span><br><span class="line"> |  </span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data <span class="keyword">and</span> other attributes defined here:</span><br><span class="line"> |  </span><br><span class="line"> |  __abstractmethods__ = frozenset()</span><br><span class="line"> |  </span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Methods inherited <span class="keyword">from</span> Validate:</span><br><span class="line"> |  </span><br><span class="line"> |  __set__(self, instance, value)</span><br><span class="line"> |  </span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Data descriptors inherited <span class="keyword">from</span> abc.ABC:</span><br><span class="line"> |  </span><br><span class="line"> |  __dict__</span><br><span class="line"> |      dictionary <span class="keyword">for</span> instance variables (<span class="keyword">if</span> defined)</span><br><span class="line"> |  </span><br><span class="line"> |  __weakref__</span><br><span class="line"> |      list of weak references to the object (<span class="keyword">if</span> defined)</span><br><span class="line"> |  </span><br><span class="line"> |  ----------------------------------------------------------------------</span><br><span class="line"> |  Methods inherited <span class="keyword">from</span> AutoStorage:</span><br><span class="line"> |  </span><br><span class="line"> |  __get__(self, instance, owner)</span><br><span class="line"> |  </span><br><span class="line"> |  __init__(self)</span><br><span class="line"> |      Initialize self.  See help(type(self)) <span class="keyword">for</span> accurate signature.</span><br></pre></td></tr></table></figure><p>å¯¹LineItemç±»æ¥è¯´ï¼Œå¦‚æžœèƒ½è¯´æ˜Žweightå¿…é¡»ä»¥åƒå…‹ä¸ºå•ä½å°±å¥½äº†ã€‚è¿™å¯¹ç‰¹æ€§æ¥è¯´å°èœä¸€ç¢Ÿï¼Œå› ä¸ºå„ä¸ªç‰¹æ€§åªå¤„ç†ç‰¹å®šçš„æ‰˜ç®¡å±žæ€§ã€‚å¯æ˜¯å¯¹æè¿°ç¬¦æ¥è¯´ï¼Œweightå’Œpriceä½¿ç”¨çš„éƒ½æ˜¯Quantityæè¿°ç¬¦ç±»ã€‚å®šåˆ¶å„ä¸ªæè¿°ç¬¦å®žä¾‹çš„å¸®åŠ©æ–‡æœ¬ç‰¹åˆ«éš¾ã€‚æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä¸ºå„ä¸ªæè¿°ç¬¦å®žä¾‹åŠ¨æ€æž„å»ºåŒ…è£…ç±»ã€‚</p><p>å¯¹åˆ é™¤æ‰˜ç®¡å±žæ€§å¤„ç†æ—¶ï¼Œåœ¨æè¿°ç¬¦ç±»ä¸­ï¼Œå®žçŽ°å¸¸è§„çš„<code>__get__</code>å’Œï¼ˆæˆ–ï¼‰<code>__set__</code>æ–¹æ³•ä¹‹å¤–ï¼Œå¯ä»¥å®žçŽ°<code>__delete__</code>æ–¹æ³•ï¼Œæˆ–è€…åªå®žçŽ°<code>__delete__</code>æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> attribute descriptors </tag>
            
            <tag> property </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯è´¨æ•°</title>
      <link href="/programming/check-whether-a-number-is-prime-or-not/"/>
      <url>/programming/check-whether-a-number-is-prime-or-not/</url>
      
        <content type="html"><![CDATA[<ul><li><code>concurrent.futures.ProcessPoolExecutor</code> æ–‡æ¡£ã€‚</li><li>å¦‚ä½•å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯è´¨æ•°ã€‚</li><li>å›žé¡¾å‚æ•°åŒ–è£…é¥°å™¨å’Œåç¨‹çš„ç”¨æ³•ã€‚</li></ul><h1 id="processpoolexecutor-ç¤ºä¾‹">ProcessPoolExecutor ç¤ºä¾‹</h1><p>ä½¿ç”¨<a href="https://devdocs.io/python~3.6/library/concurrent.futures#concurrent.futures.ProcessPoolExecutor" target="_blank" rel="noopener"><code>concurrent.futures.ProcessPoolExecutor</code></a>å®žçŽ°å¹¶è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">PRIMES = [</span><br><span class="line">    <span class="number">112272535095293</span>,</span><br><span class="line">    <span class="number">112582705942171</span>,</span><br><span class="line">    <span class="number">112272535095293</span>,</span><br><span class="line">    <span class="number">115280095190773</span>,</span><br><span class="line">    <span class="number">115797848077099</span>,</span><br><span class="line">    <span class="number">1099726899285419</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_prime</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:  <span class="comment"># æ˜¯å¦èƒ½è¢«2æ•´é™¤</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># ä¸èƒ½çš„è¯ç»§ç»­æ£€æµ‹</span></span><br><span class="line">    sqrt_n = int(math.floor(math.sqrt(n)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>, sqrt_n + <span class="number">1</span>, <span class="number">2</span>):  <span class="comment"># æ£€æµ‹èƒ½å¦è¢« 3 5 7 ... floor(sqrt(n))</span></span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:                 <span class="comment"># å› ä¸ºä¸èƒ½è¢«2æ•´é™¤ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è¢«2çš„å€æ•°æ•´é™¤</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ProcessPoolExecutor() <span class="keyword">as</span> executor:</span><br><span class="line">        <span class="keyword">for</span> number, prime <span class="keyword">in</span> zip(PRIMES, executor.map(is_prime, PRIMES)):</span><br><span class="line">            print(<span class="string">'%d is prime: %s'</span> % (number, prime))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="ä¼˜åŒ–-is_prime-å‡½æ•°">ä¼˜åŒ– is_prime å‡½æ•°</h1><p>ç¤ºä¾‹ä¸­ç”¨åˆ° <code>is_prime</code> å‡½æ•°æ¥æ£€æµ‹ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºè´¨æ•°ã€‚è¶æ­¤æœºä¼šå­¦ä¹ äº†ä¸€ä¸‹ <code>is_prime</code> çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚<a href="https://www.geeksforgeeks.org/python-program-to-check-whether-a-number-is-prime-or-not/" target="_blank" rel="noopener">åŽŸæ–‡</a></p><p>ä¸Šè¿° <code>is_prime</code> å¹¶ä¸é€šç”¨ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼ˆ2 æ˜¯è´¨æ•°ï¼‰ã€‚è€ƒè™‘åˆ°å‡½æ•°çš„è¾“å…¥ n è¿œè¿œå¤§äºŽ 2ï¼Œç¤ºä¾‹ä¸­è¿™æ ·åšæ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ä¸‹é¢å•ç‹¬è®¨è®ºå¦‚ä½•æ›´é«˜æ•ˆåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯è´¨æ•°ã€‚æ ¹æ®è´¨æ•°çš„å®šä¹‰ï¼Œè´¨æ•°åªèƒ½è¢« 1 å’Œè‡ªèº«æ•´é™¤ï¼Œæ‰€ä»¥æœ€ç›´ç™½çš„ç®—æ³•æ˜¯ä¾æ¬¡æ£€æµ‹èƒ½å¦è¢« <code>2 3 ... n-1</code> æ•´é™¤ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_prime</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="comment"># Corner cases</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check from 2 to n-1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–çš„åšæ³•æ˜¯æŽ’é™¤æ£€æµ‹æŸäº›ä¸å¯èƒ½æ•´é™¤çš„å€¼ï¼Œä¾‹å¦‚å‰æ–‡è§è¿‡çš„è·³è¿‡æ‰€æœ‰å¶æ•°ä»¥åŠå¤§äºŽ <span class="math inline">\(\lfloor \sqrt{n}\rfloor\)</span> çš„æ•´æ•°ã€‚</p><p>æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‹è¿°ç»“è®ºï¼š<strong>æ‰€æœ‰çš„è´¨æ•°ï¼Œéƒ½æ˜¯ <span class="math inline">\(6k\pm 1\)</span> çš„å½¢å¼ï¼Œé™¤äº†2å’Œ3</strong>ã€‚å› æ­¤ï¼Œå¦‚æžœä¸€ä¸ªæ•°ä¸èƒ½è¢« 2 æˆ– 3 æ•´é™¤çš„è¯ï¼Œé‚£ä¹ˆåœ¨æŽ¥ä¸‹æ¥çš„æ£€æµ‹ä¸­ï¼Œæˆ‘ä»¬åªéœ€æ£€æµ‹èƒ½å¦è¢« <span class="math inline">\(6k\pm 1\)</span> æ•´é™¤å³å¯ã€‚å› ä¸ºæ‰€æœ‰çš„æ•´æ•°éƒ½èƒ½è¡¨ç¤ºä¸º <span class="math inline">\(6k\pm i,\quad i=-1,0,1,2,3,4\)</span>ï¼Œå…¶ä¸­ <span class="math inline">\(6k+0\)</span>ã€<span class="math inline">\(6k+2\)</span> å’Œ <span class="math inline">\(6k+4\)</span> èƒ½è¢«2æ•´é™¤ï¼Œ<span class="math inline">\(6k+3\)</span> èƒ½è¢« 3 æ•´æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="comment"># Corner cases</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># This is checked so that we can skip</span></span><br><span class="line">    <span class="comment"># middle five numbers in below loop</span></span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">3</span> == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  </span><br><span class="line">    i = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span>(i * i &lt;= n):</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span> <span class="keyword">or</span> n % (i + <span class="number">2</span>) == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        i = i + <span class="number">6</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="å¤šçº¿ç¨‹ä¸Žå¤šè¿›ç¨‹">å¤šçº¿ç¨‹ä¸Žå¤šè¿›ç¨‹</h1><figure class="highlight python"><figcaption><span>prime.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">PRIMES = [</span><br><span class="line">    <span class="number">112272535095293</span>,</span><br><span class="line">    <span class="number">112582705942171</span>,</span><br><span class="line">    <span class="number">112272535095293</span>,</span><br><span class="line">    <span class="number">115280095190773</span>,</span><br><span class="line">    <span class="number">115797848077099</span>,</span><br><span class="line">    <span class="number">1099726899285419</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_prime</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="comment"># Corner cases</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># This is checked so that we can skip</span></span><br><span class="line">    <span class="comment"># middle five numbers in below loop</span></span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">3</span> == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">  </span><br><span class="line">    i = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span>(i * i &lt;= n):</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span> <span class="keyword">or</span> n % (i + <span class="number">2</span>) == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        i = i + <span class="number">6</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">()</span>:</span>  <span class="comment"># åˆ©ç”¨åç¨‹è®¡ç®—å¹³å‡å€¼</span></span><br><span class="line">    total = <span class="number">0.0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    average = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        term = <span class="keyword">yield</span> average</span><br><span class="line">        total += term</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        average = total/count</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(n_time=<span class="number">10</span>)</span>:</span>  <span class="comment"># ä¸€ä¸ªå‚æ•°åŒ–çš„è£…é¥°å™¨ï¼Œé‡å¤è¿è¡Œå‡½æ•°å¹¶è®¡ç®—å¹³å‡è€—æ—¶</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">clocked</span><span class="params">(*args)</span>:</span></span><br><span class="line">            avg = averager()</span><br><span class="line">            next(avg)  <span class="comment"># é¢„æ¿€</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(n_time):</span><br><span class="line">                t = time.time()</span><br><span class="line">                func(*args)</span><br><span class="line">                elapsed = time.time() - t</span><br><span class="line">                means = avg.send(elapsed)</span><br><span class="line">            print(<span class="string">'run &#123;&#125; &#123;&#125; times, average &#123;:.4f&#125; s'</span>.format(func, n_time, means))</span><br><span class="line">        <span class="keyword">return</span> clocked</span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"><span class="meta">@test(5)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_sequence</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> PRIMES:</span><br><span class="line">        is_prime(number)</span><br><span class="line"></span><br><span class="line"><span class="meta">@test(5)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_multithread</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="keyword">as</span> executor:</span><br><span class="line">        executor.map(is_prime, PRIMES)</span><br><span class="line"></span><br><span class="line"><span class="meta">@test(5)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_multiprocess</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ProcessPoolExecutor() <span class="keyword">as</span> executor:</span><br><span class="line">        executor.map(is_prime, PRIMES)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main_sequence()</span><br><span class="line">    main_multithread()</span><br><span class="line">    main_multiprocess()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python prime.py</span><br><span class="line">run &lt;function main_sequence at <span class="number">0x10ca98268</span>&gt; <span class="number">5</span> times, average <span class="number">2.1310</span> s</span><br><span class="line">run &lt;function main_multithread at <span class="number">0x10ca98378</span>&gt; <span class="number">5</span> times, average <span class="number">2.1739</span> s</span><br><span class="line">run &lt;function main_multiprocess at <span class="number">0x10ca98488</span>&gt; <span class="number">5</span> times, average <span class="number">0.6985</span> s</span><br></pre></td></tr></table></figure><p>å¯¹äºŽè®¡ç®—æ˜¯å¦æ˜¯è´¨æ•°è¿™ç§ CPU å¯†é›†åž‹ä½œä¸šï¼Œå¤šçº¿ç¨‹æ²¡æœ‰ä¼˜åŠ¿ï¼Œç”šè‡³æ¯”æŒ‰åºè®¡ç®—è¿˜æ…¢ä¸€ç‚¹ç‚¹ã€‚è€Œå¤šè¿›ç¨‹åˆ™æ˜Žæ˜¾è¦å¿«å¾ˆå¤šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> parallelism </tag>
            
            <tag> prime number </tag>
            
            <tag> concurrent </tag>
            
            <tag> decorators </tag>
            
            <tag> coroutines </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç‰¹æ€§</title>
      <link href="/notes/fluent-python/property/"/>
      <url>/notes/fluent-python/property/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨ç‰¹æ€§éªŒè¯å±žæ€§">ä½¿ç”¨ç‰¹æ€§éªŒè¯å±žæ€§</h1><h2 id="lineitemç±»ç¬¬1ç‰ˆè¡¨ç¤ºè®¢å•ä¸­å•†å“çš„ç±»">LineItemç±»ç¬¬1ç‰ˆï¼šè¡¨ç¤ºè®¢å•ä¸­å•†å“çš„ç±»</h2><figure class="highlight python"><figcaption><span>bulkfood_v1.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, pricre)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight  <span class="comment"># å¯èƒ½ä¸ºè´Ÿå€¼ï¼ˆæ— æ•ˆè¾“å…¥ï¼‰</span></span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹LineItemç±»çš„æŽ¥å£ï¼Œä½¿ç”¨è¯»å€¼æ–¹æ³•å’Œè®¾å€¼æ–¹æ³•ç®¡ç†weightå±žæ€§ã€‚è¿™æ˜¯Javaé‡‡ç”¨çš„æ–¹å¼ï¼Œè¿™é‡Œä¹Ÿå®Œå…¨å¯è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æžœèƒ½ç›´æŽ¥è®¾å®šå•†å“çš„weightå±žæ€§ï¼Œåˆ™æ˜¾å¾—æ›´è‡ªç„¶ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿå¯èƒ½åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œè€Œå…¶ä»–éƒ¨åˆ†å·²ç»ç›´æŽ¥è®¿é—®item.weightäº†ã€‚æ­¤æ—¶ï¼Œç¬¦åˆPythoné£Žæ ¼çš„åšæ³•æ˜¯ï¼ŒæŠŠæ•°æ®å±žæ€§æ¢æˆç‰¹æ€§ã€‚</p><h2 id="lineitemç±»ç¬¬2ç‰ˆèƒ½éªŒè¯å€¼çš„ç‰¹æ€§">LineItemç±»ç¬¬2ç‰ˆï¼šèƒ½éªŒè¯å€¼çš„ç‰¹æ€§</h2><figure class="highlight python"><figcaption><span>bulkfood_v2.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight  <span class="comment"># è¿™é‡Œå·²ç»ä½¿ç”¨ç‰¹æ€§çš„è®¾å€¼æ–¹æ³•äº†</span></span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">weight</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__weight  <span class="comment"># çœŸæ­£çš„å€¼å­˜å‚¨åœ¨ç§æœ‰å±žæ€§__weightä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @weight.setter  # è¢«è£…é¥°çš„è¯»å€¼æ–¹æ³•æœ‰ä¸ªsetterå±žæ€§ï¼Œè¿™ä¸ªå±žæ€§ä¹Ÿæ˜¯è£…é¥°å™¨</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">weight</span><span class="params">(self, value)</span>:</span>  <span class="comment"># è¿™ä¸ªè£…é¥°å™¨æŠŠè¯»å€¼æ–¹æ³•å’Œè®¾å€¼æ–¹æ³•ç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span>:</span><br><span class="line">            self.__weight = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python -i bulkfood_v2.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>walnuts = LineItem(<span class="string">'walnuts'</span>, <span class="number">0</span>, <span class="number">100.0</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"bulkfood_v2.py"</span>, line <span class="number">5</span>, <span class="keyword">in</span> __init__</span><br><span class="line">    self.weight = weight  <span class="comment"># è¿™é‡Œå·²ç»ä½¿ç”¨ç‰¹æ€§çš„è®¾å€¼æ–¹æ³•äº†</span></span><br><span class="line">  File <span class="string">"bulkfood_v2.py"</span>, line <span class="number">20</span>, <span class="keyword">in</span> weight</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line">ValueError: value must be &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure><p>çŽ°åœ¨ï¼Œæˆ‘ä»¬ç¦æ­¢ç”¨æˆ·ä¸ºweightå±žæ€§æä¾›è´Ÿå€¼æˆ–é›¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠpriceå±žæ€§å˜æˆç‰¹æ€§ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬çš„ä»£ç å°±å­˜åœ¨ä¸€äº›é‡å¤ã€‚åŽ»é™¤é‡å¤çš„æ–¹å¼æ˜¯æŠ½è±¡ã€‚æŠ½è±¡ç‰¹æ€§çš„å®šä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼šä½¿ç”¨ç‰¹æ€§å·¥åŽ‚å‡½æ•°ï¼Œæˆ–è€…ä½¿ç”¨æè¿°ç¬¦ç±»ã€‚åŽè€…æ›´çµæ´»ã€‚å…¶å®žï¼Œç‰¹æ€§æœ¬èº«å°±æ˜¯ä½¿ç”¨æè¿°ç¬¦ç±»å®žçŽ°çš„ã€‚</p><h1 id="ç‰¹æ€§å…¨è§£æž">ç‰¹æ€§å…¨è§£æž</h1><p>è™½ç„¶å†…ç½®çš„propertyç»å¸¸ç”¨ä½œè£…é¥°å™¨ï¼Œä½†å®ƒå…¶å®žæ˜¯ä¸€ä¸ªç±»ã€‚åœ¨Pythonä¸­å‡½æ•°å’Œç±»é€šå¸¸å¯ä»¥äº’æ¢ï¼Œå› ä¸ºäºŒè€…éƒ½æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œè€Œä¸”æ²¡æœ‰å®žä¾‹åŒ–å¯¹è±¡çš„newè¿ç®—ç¬¦ï¼Œæ‰€ä»¥è°ƒç”¨æž„é€ æ–¹æ³•ä¸Žè°ƒç”¨å·¥åŽ‚å‡½æ•°æ²¡æœ‰åŒºåˆ«ã€‚æ­¤å¤–ï¼Œåªè¦èƒ½è¿”å›žæ–°çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œä»£æ›¿è¢«è£…é¥°çš„å‡½æ•°ï¼ŒäºŒè€…éƒ½å¯ä»¥ç”¨ä½œè£…é¥°å™¨ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/functions#property" target="_blank" rel="noopener"><code>class property(fget=None, fset=None, fdel=None, doc=None)</code></a></p><p>Return a property attribute.</p><p>A typical use is to define a managed attribute <code>x</code>:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._x = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getx</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setx</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._x = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delx</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self._x</span><br><span class="line"></span><br><span class="line">    x = property(getx, setx, delx, <span class="string">"I'm the 'x' property."</span>)</span><br></pre></td></tr></table></figure></blockquote><blockquote></blockquote><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§ç»å…¸å½¢å¼æ¯”è£…é¥°å™¨å¥æ³•å¥½ï¼Œç¨åŽè®¨è®ºçš„ç‰¹æ€§å·¥åŽ‚å‡½æ•°å°±æ˜¯ä¸€ä¾‹ã€‚ä½†æ˜¯ï¼Œåœ¨æ–¹æ³•ä¼—å¤šçš„ç±»å®šä¹‰ä½“ä¸­ä½¿ç”¨è£…é¥°å™¨çš„è¯ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå“ªäº›æ˜¯è¯»å€¼æ–¹æ³•ï¼Œå“ªäº›æ˜¯è®¾å€¼æ–¹æ³•ï¼Œè€Œä¸ç”¨æŒ‰ç…§æƒ¯ä¾‹ï¼Œåœ¨æ–¹æ³•åçš„å‰é¢åŠ ä¸Šsetå’Œgetã€‚</p><h2 id="ç‰¹æ€§ä¼šè¦†ç›–å®žä¾‹å±žæ€§">ç‰¹æ€§ä¼šè¦†ç›–å®žä¾‹å±žæ€§</h2><p>ç‰¹æ€§éƒ½æ˜¯ç±»å±žæ€§ï¼Œä½†æ˜¯ç‰¹æ€§ç®¡ç†çš„å…¶å®žæ˜¯å®žä¾‹å±žæ€§çš„å­˜å–ã€‚å¦‚æžœå®žä¾‹å’Œæ‰€å±žçš„ç±»æœ‰åŒåæ•°æ®å±žæ€§ï¼Œé‚£ä¹ˆå®žä¾‹å±žæ€§ä¼šè¦†ç›–ï¼ˆæˆ–ç§°é®ç›–ï¼‰ç±»å±žæ€§â€”â€”è‡³å°‘é€šè¿‡é‚£ä¸ªå®žä¾‹è¯»å–å±žæ€§æ—¶æ˜¯è¿™æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Class</span>:</span></span><br><span class="line"><span class="meta">... </span>    data = <span class="string">'the class data attr'</span>  <span class="comment"># ç±»å±žæ€§</span></span><br><span class="line"><span class="meta">... </span>    @property</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">prop</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">return</span> <span class="string">'the prop value'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = Class()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vars(obj)  <span class="comment"># å®žä¾‹å±žæ€§æ˜¯ç©ºçš„</span></span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.data  <span class="comment"># é€šè¿‡å®žä¾‹èŽ·å–åˆ°äº†ç±»å±žæ€§</span></span><br><span class="line"><span class="string">'the class data attr'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.data = <span class="string">'bar'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vars(obj)</span><br><span class="line">&#123;<span class="string">'data'</span>: <span class="string">'bar'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.data  <span class="comment"># æ™®é€šå±žæ€§ï¼šå®žä¾‹å±žæ€§è¦†ç›–ç±»å±žæ€§</span></span><br><span class="line"><span class="string">'bar'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Class.data  <span class="comment"># Class.dataå±žæ€§çš„å€¼å®Œå¥½æ— æŸ</span></span><br><span class="line"><span class="string">'the class data attr'</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Class.prop  <span class="comment"># ç‰¹æ€§æ˜¯ç±»å±žæ€§</span></span><br><span class="line">&lt;property object at <span class="number">0x10c59b7c8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.prop</span><br><span class="line"><span class="string">'the prop value'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.prop = <span class="string">'foo'</span>  <span class="comment"># æ— æ³•è®¾å€¼propå®žä¾‹å±žæ€§</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: canâ€˜t set attribute</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.__dict__[<span class="string">'prop'</span>] = <span class="string">'foo'</span>  <span class="comment"># å¯ä»¥ç›´æŽ¥å­˜åˆ°å­—å…¸ä¸­</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vars(obj)</span><br><span class="line">&#123;<span class="string">'data'</span>: <span class="string">'bar'</span>, <span class="string">'prop'</span>: <span class="string">'foo'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.prop  <span class="comment"># ä»ä¼šè¿è¡Œç‰¹æ€§çš„è¯»å€¼æ–¹æ³•ï¼Œå³ç‰¹æ€§ä¼šè¦†ç›–å®žä¾‹å±žæ€§</span></span><br><span class="line"><span class="string">'the prop value'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Class.prop = <span class="string">'baz'</span>  <span class="comment"># è¦†ç›–ç‰¹æ€§ï¼Œé”€æ¯ç‰¹æ€§å¯¹è±¡</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.prop</span><br><span class="line"><span class="string">'foo'</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.data  <span class="comment"># å®žä¾‹å±žæ€§</span></span><br><span class="line"><span class="string">'bar'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Class.data  <span class="comment"># ç±»å±žæ€§</span></span><br><span class="line"><span class="string">'the class data attr'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Class.data = property(<span class="keyword">lambda</span> self: <span class="string">'the "data" prop value'</span>)  <span class="comment"># è¦†ç›–ç±»å±žæ€§</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.data  <span class="comment"># å®žä¾‹å±žæ€§è¢«ç‰¹æ€§é®ç›–äº†</span></span><br><span class="line"><span class="string">'the "data" prop value'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> Class.data  <span class="comment"># åˆ é™¤ç‰¹æ€§</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.data</span><br><span class="line"><span class="string">'bar'</span></span><br></pre></td></tr></table></figure><p><strong>å¯¹äºŽè¦†ç›–æ€§æè¿°ç¬¦ï¼ˆoverriding descriptorï¼Œç‰¹æ€§å…¶å®žæ˜¯è¦†ç›–æ€§æè¿°ç¬¦ï¼‰ï¼Œobj.attrè¿™æ ·çš„è¡¨è¾¾å¼ä¸ä¼šä»Žobjå¼€å§‹å¯»æ‰¾attrï¼Œè€Œæ˜¯ä»Ž<code>obj.__class__</code>å¼€å§‹ï¼Œè€Œä¸”ï¼Œä»…å½“ç±»ä¸­æ²¡æœ‰åä¸ºattrçš„ç‰¹æ€§æ—¶ï¼ŒPythonæ‰ä¼šåœ¨objå®žä¾‹ä¸­å¯»æ‰¾ã€‚</strong></p><h2 id="ç‰¹æ€§çš„æ–‡æ¡£">ç‰¹æ€§çš„æ–‡æ¡£</h2><p>å¦‚æžœä½¿ç”¨ç»å…¸è°ƒç”¨å¥æ³•ï¼Œä¸ºpropertyå¯¹è±¡è®¾å€¼æ–‡æ¡£å­—ç¬¦ä¸²çš„æ–¹æ³•æ˜¯ä¼ å…¥docå‚æ•°ã€‚ä½¿ç”¨è£…é¥°å™¨åˆ›å»ºpropertyå¯¹è±¡æ—¶ï¼Œè¯»å€¼æ–¹æ³•ï¼ˆæœ‰@propertyè£…é¥°å™¨çš„æ–¹æ³•ï¼‰çš„æ–‡æ¡£å­—ç¬¦ä¸²ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œå˜æˆç‰¹æ€§çš„æ–‡æ¡£ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"><span class="meta">... </span>    @property</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>            <span class="string">"""The bar attribute"""</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">return</span> self.__dict__[<span class="string">'bar'</span>]</span><br><span class="line"><span class="meta">... </span>    @bar.setter</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>            self.__dict__[<span class="string">'bar'</span>] = value</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>help(Foo)</span><br><span class="line"></span><br><span class="line">Help on <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="title">in</span> <span class="title">module</span> <span class="title">__main__</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(builtins.object)</span></span></span><br><span class="line"><span class="class"> |  <span class="title">Data</span> <span class="title">descriptors</span> <span class="title">defined</span> <span class="title">here</span>:</span></span><br><span class="line"> |  </span><br><span class="line"> |  __dict__</span><br><span class="line"> |      dictionary <span class="keyword">for</span> instance variables (<span class="keyword">if</span> defined)</span><br><span class="line"> |  </span><br><span class="line"> |  __weakref__</span><br><span class="line"> |      list of weak references to the object (<span class="keyword">if</span> defined)</span><br><span class="line"> |  </span><br><span class="line"> |  bar</span><br><span class="line"> |      The bar attribute</span><br><span class="line">(END)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>help(Foo.bar)</span><br><span class="line"></span><br><span class="line">Help on property:</span><br><span class="line"></span><br><span class="line">    The bar attribute</span><br><span class="line">(END)</span><br></pre></td></tr></table></figure><h1 id="å®šä¹‰ä¸€ä¸ªç‰¹æ€§å·¥åŽ‚å‡½æ•°">å®šä¹‰ä¸€ä¸ªç‰¹æ€§å·¥åŽ‚å‡½æ•°</h1><figure class="highlight python"><figcaption><span>bulkfood_v2prop.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quantity</span><span class="params">(storage_name)</span>:</span>  <span class="comment"># ç‰¹æ€§å·¥åŽ‚å‡½æ•°</span></span><br><span class="line">    <span class="comment"># storage_nameç¡®å®šç‰¹æ€§çš„æ•°æ®å­˜å‚¨åœ¨å“ªå„¿ï¼Œå¯¹weightç‰¹æ€§æ¥è¯´ï¼Œå­˜å‚¨çš„åç§°æ˜¯'weight'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">qty_getter</span><span class="params">(instance)</span>:</span>  <span class="comment"># å‚æ•°å¯ä»¥å‘½åä¸ºselfï¼Œä½†æ˜¯ä¼šæœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºå®ƒä¸æ˜¯ç±»æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[storage_name]  <span class="comment"># è·³è¿‡ç‰¹æ€§ï¼Œç›´æŽ¥è¯»å–ï¼Œé¿å…æ— é™é€’å½’</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">qty_setter</span><span class="params">(instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">0</span>:  <span class="comment"># éªŒè¯</span></span><br><span class="line">            instance.__dict__[storage_name] = value  <span class="comment"># è·³è¿‡ç‰¹æ€§</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> property(qty_getter, qty_setter)  <span class="comment"># è¿”å›žç‰¹æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    weight = quantity(<span class="string">'weight'</span>)  <span class="comment"># ä½¿ç”¨ç‰¹æ€§å·¥åŽ‚åˆ›å»ºç‰¹æ€§</span></span><br><span class="line">    price = quantity(<span class="string">'price'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, description, weight, price)</span>:</span></span><br><span class="line">        self.description = description</span><br><span class="line">        self.weight = weight</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subtotal</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight * self.price</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python -i bulkfood_v2prop.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nutmeg = LineItem(<span class="string">'Moluccan nutmeg'</span>, <span class="number">8</span>, <span class="number">13.95</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(vars(nutmeg).items())</span><br><span class="line">[(<span class="string">'description'</span>, <span class="string">'Moluccan nutmeg'</span>), (<span class="string">'price'</span>, <span class="number">13.95</span>), (<span class="string">'weight'</span>, <span class="number">8</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nutmeg.price = <span class="number">0</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"bulkfood_v2prop.py"</span>, line <span class="number">10</span>, <span class="keyword">in</span> qty_setter</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">'value must be &gt; 0'</span>)</span><br><span class="line">ValueError: value must be &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="å¤„ç†å±žæ€§åˆ é™¤æ“ä½œ">å¤„ç†å±žæ€§åˆ é™¤æ“ä½œ</h1><p>å¯¹è±¡çš„å±žæ€§å¯ä»¥ä½¿ç”¨delè¯­å¥åˆ é™¤ã€‚ä½¿ç”¨Pythonç¼–ç¨‹æ—¶ä¸å¸¸åˆ é™¤å±žæ€§ï¼Œé€šè¿‡ç‰¹æ€§åˆ é™¤å±žæ€§æ›´å°‘è§ã€‚ä½†æ˜¯ï¼ŒPythonæ”¯æŒè¿™ä¹ˆåšã€‚</p><figure class="highlight python"><figcaption><span>blackknight.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlackKnight</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.members = [<span class="string">'an arm'</span>, <span class="string">'another arm'</span>,</span><br><span class="line">                        <span class="string">'a leg'</span>, <span class="string">'another leg'</span>]</span><br><span class="line">        self.phrases = [<span class="string">"â€˜Tis but a scratch."</span>,</span><br><span class="line">                        <span class="string">"Itâ€˜s just a flesh wound."</span>,</span><br><span class="line">                        <span class="string">"Iâ€˜m invincible!"</span>,</span><br><span class="line">                        <span class="string">"All right, weâ€™ll call it a draw."</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">member</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'next member is:'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.members[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @member.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">member</span><span class="params">(self)</span>:</span>  <span class="comment"># ç‰¹æ€§ä¸€æ¬¡åˆ é™¤ä¸¤ä¸ªå±žæ€§ä¸­çš„é›¶å·å…ƒç´ </span></span><br><span class="line">        text = <span class="string">'BLACK KNIGHT (losed &#123;&#125;)\n-- &#123;&#125;'</span></span><br><span class="line">        print(text.format(self.members.pop(<span class="number">0</span>), self.phrases.pop(<span class="number">0</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python -i blackknight.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>knight = BlackKnight()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>knight.member</span><br><span class="line">next member <span class="keyword">is</span>:</span><br><span class="line"><span class="string">'an arm'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> knight.member</span><br><span class="line">BLACK KNIGHT (losed an arm)</span><br><span class="line">-- â€˜Tis but a scratch.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> knight.member</span><br><span class="line">BLACK KNIGHT (losed another arm)</span><br><span class="line">-- Itâ€™s just a flesh wound.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> knight.member</span><br><span class="line">BLACK KNIGHT (losed a leg)</span><br><span class="line">-- Iâ€˜m invincible!</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> knight.member</span><br><span class="line">BLACK KNIGHT (losed another leg)</span><br><span class="line">-- All right, weâ€™ll call it a draw.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> knight.member</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"blackknight.py"</span>, line <span class="number">19</span>, <span class="keyword">in</span> member</span><br><span class="line">    print(text.format(self.members.pop(<span class="number">0</span>), self.phrases.pop(<span class="number">0</span>)))</span><br><span class="line">IndexError: pop <span class="keyword">from</span> empty list</span><br></pre></td></tr></table></figure><p>å¦‚æžœä¸ä½¿ç”¨è£…é¥°å™¨çš„ç»å…¸è°ƒç”¨è¯­æ³•ï¼Œå¯ä»¥åœ¨propertyä¸­è®¾å€¼fdelå‡½æ•°ã€‚å¦‚æžœä¸ä½¿ç”¨ç‰¹æ€§ï¼Œè¿˜å¯ä»¥å®žçŽ°ä½Žå±‚ç‰¹æ®Šçš„<code>__delattr__</code>æ–¹æ³•å¤„ç†åˆ é™¤å±žæ€§æ“ä½œã€‚</p><h1 id="å¤„ç†å±žæ€§çš„é‡è¦å±žæ€§å’Œå‡½æ•°">å¤„ç†å±žæ€§çš„é‡è¦å±žæ€§å’Œå‡½æ•°</h1><h2 id="å½±å“å±žæ€§å¤„ç†æ–¹å¼çš„ç‰¹æ®Šå±žæ€§">å½±å“å±žæ€§å¤„ç†æ–¹å¼çš„ç‰¹æ®Šå±žæ€§</h2><p><code>__class__</code>ï¼šå¯¹è±¡æ‰€å±žç±»çš„å¼•ç”¨ï¼ˆå³<code>obj.__class__</code>ä¸Ž<code>type(obj)</code>çš„ä½œç”¨ç›¸åŒï¼‰ã€‚</p><p><code>__dict__</code>ï¼šä¸€ä¸ªæ˜ å°„ï¼Œå­˜å‚¨å¯¹è±¡æˆ–ç±»çš„å¯å†™å±žæ€§ã€‚æœ‰<code>__dict__</code>å±žæ€§çš„å¯¹è±¡ï¼Œä»»ä½•æ—¶å€™éƒ½èƒ½éšæ„è®¾ç½®æ–°å±žæ€§ã€‚å¦‚æžœç±»æœ‰<code>__slots__</code>å±žæ€§ï¼Œå®ƒçš„å®žä¾‹å¯èƒ½æ²¡æœ‰<code>__dict__</code>å±žæ€§ã€‚</p><p><code>__slots__</code>ï¼šç±»å¯ä»¥å®šä¹‰è¿™ä¸ªå±žæ€§ï¼Œé™åˆ¶å®žä¾‹èƒ½æœ‰å“ªäº›å±žæ€§ã€‚<code>__slots__</code>å±žæ€§çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æž„æˆçš„å…ƒç»„ï¼ŒæŒ‡æ˜Žå…è®¸æœ‰çš„å±žæ€§ã€‚å¦‚æžœ<code>__slots__</code>ä¸­æ²¡æœ‰<code>__dict__</code>ï¼Œé‚£ä¹ˆè¯¥ç±»çš„å®žä¾‹æ²¡æœ‰<code>__dict__</code>å±žæ€§ï¼Œå®žä¾‹åªå…è®¸æœ‰æŒ‡å®šåç§°çš„å±žæ€§ã€‚ï¼ˆ<code>__slots__</code>å±žæ€§çš„å€¼è™½ç„¶å¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œä½†æ˜¯æœ€å¥½å§‹ç»ˆä½¿ç”¨å…ƒç»„ï¼Œå› ä¸ºå¤„ç†å®Œç±»çš„å®šä¹‰ä½“ä¹‹åŽå†ä¿®æ”¹<code>__slots__</code>åˆ—è¡¨æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨å¯å˜çš„åºåˆ—å®¹æ˜“è®©äººè¯¯è§£ï¼‰</p><h2 id="å¤„ç†å±žæ€§çš„å†…ç½®å‡½æ•°">å¤„ç†å±žæ€§çš„å†…ç½®å‡½æ•°</h2><p>ä¸‹è¿°5ä¸ªå†…ç½®å‡½æ•°å¯¹å¯¹è±¡çš„å±žæ€§åšè¯»ã€å†™å’Œå†…çœæ“ä½œã€‚</p><ul><li><code>dir([object])</code>ï¼šåˆ—å‡ºå¯¹è±¡çš„å¤§å¤šæ•°å±žæ€§ã€‚dirå‡½æ•°çš„ç›®çš„æ˜¯äº¤äº’å¼ä½¿ç”¨ï¼Œå› æ­¤æ²¡æœ‰æä¾›å®Œæ•´çš„å±žæ€§åˆ—è¡¨ï¼Œåªåˆ—å‡ºä¸€ç»„â€œé‡è¦çš„â€å±žæ€§åã€‚dirå‡½æ•°èƒ½å®¡æŸ¥æœ‰æˆ–æ²¡æœ‰<code>__dict__</code>å±žæ€§çš„å¯¹è±¡ã€‚dirå‡½æ•°ä¸ä¼šåˆ—å‡º<code>__dict__</code>å±žæ€§æœ¬èº«ï¼Œä½†ä¼šåˆ—å‡ºå…¶ä¸­çš„é”®ã€‚dirå‡½æ•°ä¹Ÿä¸ä¼šåˆ—å‡ºç±»çš„å‡ ä¸ªç‰¹æ®Šå±žæ€§ï¼Œä¾‹å¦‚<code>__mro__</code>ã€<code>__bases__</code>å’Œ<code>__name__</code>ã€‚å¦‚æžœæ²¡æœ‰æŒ‡å®šå¯é€‰çš„objectå‚æ•°ï¼Œdirå‡½æ•°ä¼šåˆ—å‡ºå½“å‰ä½œç”¨åŸŸä¸­çš„åç§°ã€‚</li><li><code>getattr(object, name[, default])</code>ï¼šä»Žobjectå¯¹è±¡ä¸­èŽ·å–nameå­—ç¬¦ä¸²å¯¹åº”çš„å±žæ€§ã€‚èŽ·å–çš„å±žæ€§å¯èƒ½æ¥è‡ªå¯¹è±¡æ‰€å±žçš„ç±»æˆ–è¶…ç±»ã€‚å¦‚æžœæ²¡æœ‰æŒ‡å®šçš„å±žæ€§ï¼Œgetattrå‡½æ•°æŠ›å‡ºAttributeErrorå¼‚å¸¸ï¼Œæˆ–è€…è¿”å›ždefaultå‚æ•°çš„å€¼ã€‚</li><li><code>hasattr(object, name)</code>ï¼šå¦‚æžœobjectå¯¹è±¡ä¸­å­˜åœ¨æŒ‡å®šçš„å±žæ€§ï¼Œæˆ–è€…èƒ½ä»¥æŸç§æ–¹å¼ï¼ˆä¾‹å¦‚ç»§æ‰¿ï¼‰é€šè¿‡objectå¯¹è±¡èŽ·å–æŒ‡å®šçš„å±žæ€§ï¼Œè¿”å›žTrueã€‚è¿™ä¸ªå‡½æ•°çš„å®žçŽ°æ–¹å¼æ˜¯è°ƒç”¨getattr(object, name)å‡½æ•°ï¼Œçœ‹çœ‹æ˜¯å¦æŠ›å‡ºAttributeErrorå¼‚å¸¸ã€‚</li><li><code>setattr(object, name, value)</code>ï¼šæŠŠobjectå¯¹è±¡æŒ‡å®šå±žæ€§çš„å€¼è®¾ä¸ºvalueï¼Œå‰ææ˜¯objectå¯¹è±¡èƒ½æŽ¥å—é‚£ä¸ªå€¼ã€‚è¿™ä¸ªå‡½æ•°å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å±žæ€§ï¼Œæˆ–è¦†ç›–çŽ°æœ‰å±žæ€§ã€‚</li><li><code>vars([object])</code>ï¼šè¿”å›žobjectå¯¹è±¡çš„<code>__dict__</code>å±žæ€§ï¼›å¦‚æžœå®žä¾‹æ‰€å±žçš„ç±»å®šä¹‰äº†<code>__slots__</code>å±žæ€§ï¼Œå®žä¾‹æ²¡æœ‰<code>__dict__</code>å±žæ€§ï¼Œé‚£ä¹ˆvarså‡½æ•°ä¸èƒ½å¤„ç†é‚£ä¸ªå®žä¾‹ï¼ˆç›¸åï¼Œdirå‡½æ•°èƒ½å¤„ç†è¿™æ ·çš„å®žä¾‹ï¼‰ã€‚å¦‚æžœæ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œé‚£ä¹ˆvarså‡½æ•°çš„ä½œç”¨ä¸Žlocalså‡½æ•°ä¸€æ ·ï¼šè¿”å›žè¡¨ç¤ºæœ¬åœ°ä½œç”¨åŸŸçš„å­—å…¸ã€‚</li></ul><h2 id="å¤„ç†å±žæ€§çš„ç‰¹æ®Šæ–¹æ³•">å¤„ç†å±žæ€§çš„ç‰¹æ®Šæ–¹æ³•</h2><p>åœ¨ç”¨æˆ·è‡ªå·²å®šä¹‰çš„ç±»ä¸­ï¼Œä¸‹è¿°ç‰¹æ®Šæ–¹æ³•ç”¨äºŽèŽ·å–ã€è®¾ç½®ã€åˆ é™¤å’Œåˆ—å‡ºå±žæ€§ã€‚</p><p>ä½¿ç”¨ç‚¹å·æˆ–å†…ç½®çš„getattrã€hasattrå’Œsetattrå‡½æ•°å­˜å–å±žæ€§éƒ½ä¼šè§¦å‘ä¸‹è¿°åˆ—è¡¨ä¸­ç›¸åº”çš„ç‰¹æ®Šæ–¹æ³•ã€‚ä½†æ˜¯ï¼Œç›´æŽ¥é€šè¿‡å®žä¾‹çš„<code>__dict__</code>å±žæ€§è¯»å†™å±žæ€§ä¸ä¼šè§¦å‘è¿™äº›ç‰¹æ®Šæ–¹æ³•â€”â€”å¦‚æžœéœ€è¦ï¼Œé€šå¸¸ä¼šä½¿ç”¨è¿™ç§æ–¹å¼è·³è¿‡ç‰¹æ®Šæ–¹æ³•ã€‚</p><p><strong>å¯¹ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»æ¥è¯´ï¼Œå¦‚æžœéšå¼è°ƒç”¨ç‰¹æ®Šæ–¹æ³•ï¼Œä»…å½“ç‰¹æ®Šæ–¹æ³•åœ¨å¯¹è±¡æ‰€å±žçš„ç±»åž‹ä¸Šå®šä¹‰ï¼Œè€Œä¸æ˜¯åœ¨å¯¹è±¡çš„å®žä¾‹å­—å…¸ä¸­å®šä¹‰æ—¶ï¼Œæ‰èƒ½ç¡®ä¿è°ƒç”¨æˆåŠŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦å‡å®šç‰¹æ®Šæ–¹æ³•ä»Žç±»ä¸ŠèŽ·å–ï¼Œå³ä¾¿æ“ä½œç›®æ ‡æ˜¯å®žä¾‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œç‰¹æ®Šæ–¹æ³•ä¸ä¼šè¢«åŒåå®žä¾‹å±žæ€§é®ç›–ã€‚</strong></p><ul><li><code>__delattr__(self, name)</code>ï¼šåªè¦ä½¿ç”¨delè¯­å¥åˆ é™¤å±žæ€§ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ä¾‹å¦‚,del obj.attrè¯­å¥è§¦å‘<code>Class.__delattr__(obj, 'attr')</code>æ–¹æ³•ã€‚</li><li><code>__dir__(self)</code>ï¼šæŠŠå¯¹è±¡ä¼ ç»™dirå‡½æ•°æ—¶è°ƒç”¨ï¼Œåˆ—å‡ºå±žæ€§ã€‚ä¾‹å¦‚ï¼Œdir(obj)è§¦å‘<code>Class.__dir__(obj)</code>æ–¹æ³•ã€‚</li><li><code>__getattr__(self, name)</code>ï¼šä»…å½“èŽ·å–æŒ‡å®šçš„å±žæ€§å¤±è´¥ï¼Œæœç´¢è¿‡objã€Classå’Œè¶…ç±»ä¹‹åŽè°ƒç”¨ã€‚</li><li><code>__getattribute__(self, name)</code>ï¼šå°è¯•èŽ·å–æŒ‡å®šçš„å±žæ€§æ—¶æ€»ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ä¸è¿‡ï¼Œå¯»æ‰¾çš„å±žæ€§æ˜¯ç‰¹æ®Šå±žæ€§æˆ–ç‰¹æ®Šæ–¹æ³•æ—¶é™¤å¤–ã€‚ç‚¹å·ä¸Žgetattrå’Œhasattrå†…ç½®å‡½æ•°ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•ã€‚è°ƒç”¨<code>__getattribute__</code>æ–¹æ³•ä¸”æŠ›å‡ºAttributeErrorå¼‚å¸¸æ—¶ï¼Œæ‰ä¼šè°ƒç”¨<code>__getattr__</code>æ–¹æ³•ã€‚ä¸ºäº†åœ¨èŽ·å–objå®žä¾‹çš„å±žæ€§æ—¶ä¸å¯¼è‡´æ— é™é€’å½’ï¼Œ<code>__getattribute__</code>æ–¹æ³•çš„å®žçŽ°è¦ä½¿ç”¨<code>super().__getattribute__(obj, name)</code>ã€‚</li><li><code>__setattr__(self, name, value)</code>ï¼šå°è¯•è®¾ç½®æŒ‡å®šçš„å±žæ€§æ—¶æ€»ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ç‚¹å·å’Œsetattrå†…ç½®å‡½æ•°ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œobj.attrå’Œgetattr(obj, 'attr', 42)éƒ½ä¼šè§¦å‘<code>Class.__setattr__(obj, 'attr', 42)</code>æ–¹æ³•ã€‚</li></ul><p><strong>ç‰¹æ®Šæ–¹æ³•<code>__getattribute__</code>å’Œ<code>__setattr__</code>ä¸ç®¡æ€Žæ ·éƒ½ä¼šè°ƒç”¨ï¼Œå‡ ä¹Žä¼šå½±å“æ¯ä¸€æ¬¡å±žæ€§å­˜å–ï¼Œå› æ­¤æ¯”<code>__getattr__</code>æ–¹æ³•ï¼ˆåªå¤„ç†ä¸å­˜åœ¨çš„å±žæ€§åï¼‰æ›´éš¾æ­£ç¡®ä½¿ç”¨ã€‚ä¸Žå®šä¹‰è¿™äº›ç‰¹æ®Šæ–¹æ³•ç›¸æ¯”ï¼Œä½¿ç”¨ç‰¹æ€§æˆ–æè¿°ç¬¦ç›¸å¯¹ä¸æ˜“å‡ºé”™ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> decorators </tag>
            
            <tag> Fluent Python </tag>
            
            <tag> property </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨åŠ¨æ€å±žæ€§è½¬æ¢æ•°æ®</title>
      <link href="/notes/fluent-python/data-wrangling-with-dynamic-attributes/"/>
      <url>/notes/fluent-python/data-wrangling-with-dynamic-attributes/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Pythonä¸­ï¼Œæ•°æ®çš„å±žæ€§å’Œå¤„ç†æ•°æ®çš„æ–¹æ³•ç»Ÿç§°å±žæ€§ï¼ˆattributeï¼‰ã€‚å…¶å®žï¼Œæ–¹å¼åªæ˜¯å¯è°ƒç”¨çš„å±žæ€§ã€‚é™¤äº†è¿™äºŒè€…ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºç‰¹æ€§ï¼ˆpropertyï¼‰ï¼Œåœ¨ä¸æ”¹å˜æŽ¥å£çš„å‰æä¸‹ï¼Œä½¿ç”¨å­˜å–æ–¹æ³•ï¼ˆå³è¯»å€¼æ–¹æ³•å’Œè®¾å€¼æ–¹æ³•ï¼‰ä¿®æ”¹æ•°æ®å±žæ€§ã€‚è¿™ä¸Žç»Ÿä¸€è®¿é—®åŽŸåˆ™ç›¸ç¬¦ï¼šä¸ç®¡æœåŠ¡æ˜¯ç”±å­˜å‚¨è¿˜æ˜¯è®¡ç®—å®žçŽ°çš„ï¼Œä¸€ä¸ªæ¨¡å—æä¾›çš„æ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥é€šè¿‡ç»Ÿä¸€çš„æ–¹å¼ä½¿ç”¨ã€‚</p><p>é™¤äº†ç‰¹æ€§ï¼ŒPythonè¿˜æä¾›äº†ä¸°å¯Œçš„APIï¼Œç”¨äºŽæŽ§åˆ¶å±žæ€§çš„è®¿é—®æƒé™ï¼Œä»¥åŠå®žçŽ°åŠ¨æ€å±žæ€§ã€‚ä½¿ç”¨ç‚¹å·è®¿é—®å±žæ€§æ—¶ï¼ˆå¦‚obj.attrï¼‰ï¼ŒPythonè§£é‡Šå™¨ä¼šè°ƒç”¨ç‰¹æ®Šçš„æ–¹æ³•ï¼ˆå¦‚<code>__getattr__</code>å’Œ<code>__setattr__</code>ï¼‰è®¡ç®—å±žæ€§ã€‚ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»å¯ä»¥é€šè¿‡<code>__getattr__</code>æ–¹æ³•å®žçŽ°â€œè™šæ‹Ÿå±žæ€§â€ï¼Œå½“è®¿é—®ä¸å­˜åœ¨çš„å±žæ€§æ—¶ï¼Œå³æ—¶è®¡ç®—å±žæ€§çš„å€¼ã€‚</p><p>åŠ¨æ€åˆ›å»ºå±žæ€§æ˜¯ä¸€ç§å…ƒç¼–ç¨‹ï¼Œæ¡†æž¶çš„ä½œè€…ç»å¸¸è¿™ä¹ˆåšã€‚ç„¶è€Œï¼Œåœ¨Pythonä¸­ï¼Œç›¸å…³çš„åŸºç¡€æŠ€æœ¯ååˆ†ç®€å•ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ï¼Œç”šè‡³åœ¨æ—¥å¸¸çš„æ•°æ®è½¬æ¢ä»»åŠ¡ä¸­ä¹Ÿèƒ½ç”¨åˆ°ã€‚ä¸‹é¢ä»¥è¿™ç§ä»»åŠ¡å¼€å¯æœ¬ç« çš„è¯é¢˜ã€‚</p><a id="more"></a><h1 id="ä½¿ç”¨åŠ¨æ€å±žæ€§è½¬æ¢æ•°æ®">ä½¿ç”¨åŠ¨æ€å±žæ€§è½¬æ¢æ•°æ®</h1><figure class="highlight json"><figcaption><span>osconfeed.json</span></figcaption><table><tr><td class="code"><pre><span class="line">&#123; <span class="attr">"Schedule"</span>:</span><br><span class="line">  &#123; <span class="attr">"conferences"</span>: [&#123;<span class="attr">"serial"</span>: <span class="number">115</span> &#125;],</span><br><span class="line">    <span class="attr">"events"</span>: [</span><br><span class="line">      &#123; <span class="attr">"serial"</span>: <span class="number">34505</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Why Schools Don Ìt Use Open Source to Teach Programming"</span>,</span><br><span class="line">        <span class="attr">"event_type"</span>: <span class="string">"40-minute conference session"</span>,</span><br><span class="line">        <span class="attr">"time_start"</span>: <span class="string">"2014-07-23 11:30:00"</span>,</span><br><span class="line">        <span class="attr">"time_stop"</span>: <span class="string">"2014-07-23 12:10:00"</span>,</span><br><span class="line">        <span class="attr">"venue_serial"</span>: <span class="number">1462</span>,</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"Aside from the fact that high school programming..."</span>,</span><br><span class="line">        <span class="attr">"website_url"</span>: <span class="string">"http://oscon.com/oscon2014/public/schedule/detail/34505"</span>,</span><br><span class="line">        <span class="attr">"speakers"</span>: [<span class="number">157509</span>],</span><br><span class="line">        <span class="attr">"categories"</span>: [<span class="string">"Education"</span>] &#125;,</span><br><span class="line">      &#123; <span class="attr">"æ›´å¤šæ¡è®°å½•"</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"speakers"</span>: [</span><br><span class="line">      &#123; <span class="attr">"serial"</span>: <span class="number">157509</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"Robert Lefkowitz"</span>,</span><br><span class="line">        <span class="attr">"photo"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"http://sharewave.com/"</span>,</span><br><span class="line">        <span class="attr">"position"</span>: <span class="string">"CTO"</span>,</span><br><span class="line">        <span class="attr">"affiliation"</span>: <span class="string">"Sharewave"</span>,</span><br><span class="line">        <span class="attr">"twitter"</span>: <span class="string">"sharewaveteam"</span>,</span><br><span class="line">        <span class="attr">"bio"</span>: <span class="string">"Robert  Ìr0ml Ì Lefkowitz is the CTO at Sharewave, a startup..."</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">"æ›´å¤šæ¡è®°å½•"</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"venues"</span>: [</span><br><span class="line">      &#123; <span class="attr">"serial"</span>: <span class="number">1462</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"F151"</span>,</span><br><span class="line">        <span class="attr">"category"</span>: <span class="string">"Conference Venues"</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">"æ›´å¤šæ¡è®°å½•"</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>osconfeed.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">URL = <span class="string">'http://www.oreilly.com/pub/sc/osconfeed'</span></span><br><span class="line">JSON = <span class="string">'data/osconfeed.json'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(JSON):  <span class="comment"># å¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨å°±åŽ»ä¸‹è½½</span></span><br><span class="line">        msg = <span class="string">'downloading &#123;&#125; to &#123;&#125;'</span>.format(URL, JSON)</span><br><span class="line">        warnings.warn(msg)  <span class="comment"># å‘å‡ºè­¦å‘Š</span></span><br><span class="line">        <span class="comment"># åœ¨withè¯­å¥ä¸­ä½¿ç”¨ä¸¤ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨</span></span><br><span class="line">        <span class="keyword">with</span> urlopen(URL) <span class="keyword">as</span> remote, open(JSON, <span class="string">'wb'</span>) <span class="keyword">as</span> local:</span><br><span class="line">            local.write(remote.read())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(JSON) <span class="keyword">as</span> fp:</span><br><span class="line">        <span class="keyword">return</span> json.load(fp)  <span class="comment"># è¿”å›žPythonåŽŸç”Ÿå¯¹è±¡</span></span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨åŠ¨æ€å±žæ€§è®¿é—®jsonç±»æ•°æ®">ä½¿ç”¨åŠ¨æ€å±žæ€§è®¿é—®JSONç±»æ•°æ®</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> osconfeed <span class="keyword">import</span> load</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>feed = load()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(feed[<span class="string">'Schedule'</span>].keys())  <span class="comment"># feedæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢åµŒå¥—è¿™å­—å…¸å’Œåˆ—è¡¨</span></span><br><span class="line">[<span class="string">'conferences'</span>, <span class="string">'events'</span>, <span class="string">'speakers'</span>, <span class="string">'venues'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key, value <span class="keyword">in</span> sorted(feed[<span class="string">'Schedule'</span>].items()):</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'&#123;:3&#125; &#123;&#125;'</span>.format(len(value), key))</span><br><span class="line">...</span><br><span class="line">  <span class="number">1</span> conferences</span><br><span class="line"><span class="number">494</span> events</span><br><span class="line"><span class="number">357</span> speakers</span><br><span class="line"> <span class="number">53</span> venues</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>feed[<span class="string">'Schedule'</span>][<span class="string">'speakers'</span>][<span class="number">-1</span>][<span class="string">'name'</span>]  <span class="comment"># æœ€åŽä¸€ä½æ¼”è®²è€…çš„åå­—</span></span><br><span class="line"><span class="string">'Carina C. Zona'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>feed[<span class="string">'Schedule'</span>][<span class="string">'speakers'</span>][<span class="number">-1</span>][<span class="string">'serial'</span>]  <span class="comment"># æœ€åŽä¸€ä½æ¼”è®²è€…çš„ç¼–å·</span></span><br><span class="line"><span class="number">141590</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>feed[<span class="string">'Schedule'</span>][<span class="string">'events'</span>][<span class="number">40</span>][<span class="string">'name'</span>]  <span class="comment"># äº‹ä»¶åç§°</span></span><br><span class="line"><span class="string">'There *Will* Be Bugs'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>feed[<span class="string">'Schedule'</span>][<span class="string">'events'</span>][<span class="number">40</span>][<span class="string">'speakers'</span>]  <span class="comment"># äº‹ä»¶çš„æ¼”è®²è€…åˆ—è¡¨</span></span><br><span class="line">[<span class="number">3471</span>, <span class="number">5199</span>]</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åŠ¨æ€å±žæ€§è®¿é—®jsonç±»æ•°æ®-1">ä½¿ç”¨åŠ¨æ€å±žæ€§è®¿é—®JSONç±»æ•°æ®</h2><p>feed['Schedule']['events'][40]['name']è¿™ç§å¥æ³•å¾ˆå†—é•¿ã€‚åœ¨JavaScriptä¸­ï¼Œå¯ä»¥ä½¿ç”¨feed.Schedule.events[40].nameèŽ·å–é‚£ä¸ªå€¼ã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥å®žçŽ°ä¸€ä¸ªè¿‘ä¼¼å­—å…¸çš„ç±»ï¼ˆç½‘ä¸Šæœ‰å¤§é‡å®žçŽ°ï¼Œæœ€å¸¸æåˆ°çš„ä¸€ä¸ªå®žçŽ°æ˜¯<a href="https://pypi.python.org/pypi/attrdict" target="_blank" rel="noopener">AttrDict</a>ï¼Œè¿˜æœ‰ä¸€ä¸ªå®žçŽ°èƒ½å¿«é€Ÿåˆ›å»ºåµŒå¥—çš„æ˜ å°„â€”â€”<a href="https://pypi.python.org/pypi/addict" target="_blank" rel="noopener">addict</a>ï¼‰ï¼Œè¾¾åˆ°åŒæ ·çš„æ•ˆæžœã€‚</p><figure class="highlight python"><figcaption><span>explore0.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrozenJSON</span>:</span></span><br><span class="line">    <span class="string">"""ä¸€ä¸ªåªè¯»æŽ¥å£ï¼Œä½¿ç”¨å±žæ€§è¡¨ç¤ºæ³•è®¿é—®JSONç±»å¯¹è±¡</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mapping)</span>:</span></span><br><span class="line">        self.__data = dict(mapping)  <span class="comment"># ä½¿ç”¨mappingåˆ›å»ºä¸€ä¸ªå­—å…¸å‰¯æœ¬</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self.__data, name):  <span class="comment"># nameæ˜¯__dataçš„å±žæ€§</span></span><br><span class="line">            <span class="keyword">return</span> getattr(self.__data, name)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># ä»Ž__dataä¸­èŽ·å–nameé”®å¯¹åº”çš„å…ƒç´ </span></span><br><span class="line">            <span class="keyword">try</span>:  <span class="comment"># æ•èŽ·å¼‚å¸¸çš„å§¿åŠ¿å¯èƒ½ä¸æ­£ç¡®</span></span><br><span class="line">                <span class="keyword">return</span> FrozenJSON.build(self.__data[name])</span><br><span class="line">            <span class="keyword">except</span> KeyError:  <span class="comment"># å¯èƒ½å‡ºçŽ°KeyErrorå¼‚å¸¸</span></span><br><span class="line">                msg = <span class="string">'&#123;!r&#125; object has no attribute &#123;!r&#125;'</span></span><br><span class="line">                <span class="comment"># å±žæ€§è®¿é—®åº”è¯¥æŠ›å‡ºAttributeError</span></span><br><span class="line">                <span class="keyword">raise</span> AttributeError(msg.format(type(self).__name__, name))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build</span><span class="params">(cls, obj)</span>:</span>  <span class="comment"># å¤‡é€‰æž„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(obj, abc.Mapping):  <span class="comment"># æ˜¯æ˜ å°„</span></span><br><span class="line">            <span class="keyword">return</span> cls(obj)</span><br><span class="line">        <span class="keyword">elif</span> isinstance(obj, abc.MutableSequence):  <span class="comment"># æ˜¯åˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">return</span> [cls.build(item) <span class="keyword">for</span> item <span class="keyword">in</span> obj]</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å…¶ä»–</span></span><br><span class="line">            <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è®°ä½é‡è¦çš„ä¸€ç‚¹ï¼Œ<strong>ä»…å½“æ— æ³•ä½¿ç”¨å¸¸è§„çš„æ–¹å¼èŽ·å–å±žæ€§ï¼ˆå³åœ¨å®žä¾‹ã€ç±»æˆ–è¶…ç±»ä¸­æ‰¾ä¸åˆ°æŒ‡å®šçš„å±žæ€§ï¼‰ï¼Œè§£é‡Šå™¨æ‰ä¼šè°ƒç”¨ç‰¹æ®Šçš„<code>__getattr__</code>æ–¹æ³•ã€‚</strong>è¿™ä¸ªæ–¹æ³•é¦–å…ˆæŸ¥çœ‹<code>self.__data</code>å­—å…¸æœ‰æ²¡æœ‰æŒ‡å®šåç§°çš„å±žæ€§ï¼ˆä¸æ˜¯é”®ï¼‰ï¼Œè¿™æ ·FrozenJSONå®žä¾‹ä¾¿å¯ä»¥å¤„ç†å­—å…¸çš„æ‰€æœ‰æ–¹æ³•ï¼Œä¾‹å¦‚æŠŠitemsæ–¹æ³•å§”æ‰˜ç»™<code>self.__data.items</code>æ–¹æ³•ã€‚å¦‚æžœ<code>self.__data</code>æ²¡æœ‰æŒ‡å®šåç§°çš„å±žæ€§ï¼Œé‚£ä¹ˆ<code>__getattr__</code>æ–¹æ³•ä»¥é‚£ä¸ªåç§°ä¸ºé”®ï¼Œä»Ž<code>self.__data</code>ä¸­èŽ·å–ä¸€ä¸ªå…ƒç´ ï¼Œä¼ ç»™FrozenJSON.buildæ–¹æ³•ã€‚è¿™æ ·å°±èƒ½æ·±å…¥JSONæ•°æ®çš„åµŒå¥—ç»“æž„ï¼Œä½¿ç”¨ç±»æ–¹æ³•buildæŠŠæ¯ä¸€å±‚åµŒå¥—è½¬æ¢æˆä¸€ä¸ªFrozenJSONå®žä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> osconfeed <span class="keyword">import</span> load</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> explore0 <span class="keyword">import</span> FrozenJSON</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>raw_feed = load()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>feed = FrozenJSON(raw_feed)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(feed.Schedule.speakers)</span><br><span class="line"><span class="number">357</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(feed.Schedule.keys())</span><br><span class="line">[<span class="string">'conferences'</span>, <span class="string">'events'</span>, <span class="string">'speakers'</span>, <span class="string">'venues'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>talk = feed.Schedule.events[<span class="number">40</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(talk)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">explore0</span>.<span class="title">FrozenJSON</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">talk</span>.<span class="title">name</span></span></span><br><span class="line"><span class="class">'<span class="title">There</span> *<span class="title">Will</span>* <span class="title">Be</span> <span class="title">Bugs</span>'</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">talk</span>.<span class="title">flavor</span></span></span><br><span class="line"><span class="class"><span class="title">Traceback</span> <span class="params">(most recent call last)</span>:</span></span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/explore0.py"</span>, line <span class="number">15</span>, <span class="keyword">in</span> __getattr__</span><br><span class="line">    <span class="keyword">return</span> FrozenJSON.build(self.__data[name])</span><br><span class="line">KeyError: <span class="string">'flavor'</span>  <span class="comment"># è¿™ä¸ªä¹Ÿå‡ºæ¥äº†ï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">During handling of the above exception, another exception occurred:</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/explore0.py"</span>, line <span class="number">19</span>, <span class="keyword">in</span> __getattr__</span><br><span class="line">    <span class="keyword">raise</span> AttributeError(msg.format(type(self).__name__, name))</span><br><span class="line">AttributeError: <span class="string">'FrozenJSON'</span> object has no attribute <span class="string">'flavor'</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰ç¼“å­˜æˆ–è½¬æ¢åŽŸå§‹æ•°æ®æºã€‚åœ¨è¿­ä»£æ•°æ®æºçš„è¿‡ç¨‹ä¸­ï¼ŒåµŒå¥—çš„æ•°æ®ç»“æž„ä¸æ–­è¢«è½¬æ¢æˆFrozenJSONå¯¹è±¡ã€‚è¿™ä¹ˆåšæ²¡é—®é¢˜ï¼Œå› ä¸ºæ•°æ®é›†ä¸å¤§ï¼Œè€Œä¸”è¿™ä¸ªè„šæœ¬åªç”¨äºŽè®¿é—®æˆ–è½¬æ¢æ•°æ®ã€‚</p><p>ä»Žéšæœºæºä¸­ç”Ÿæˆæˆ–ä»¿æ•ˆåŠ¨æ€å±žæ€§åçš„è„šæœ¬éƒ½å¿…é¡»å¤„ç†ä¸€ä¸ªé—®é¢˜ï¼šåŽŸå§‹æ•°æ®ä¸­çš„é”®å¯èƒ½ä¸é€‚åˆä½œä¸ºå±žæ€§åã€‚</p><h2 id="å¤„ç†æ— æ•ˆå±žæ€§å">å¤„ç†æ— æ•ˆå±žæ€§å</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>grad = FrozenJSON(&#123;<span class="string">'name'</span>: <span class="string">'Jim Bo'</span>, <span class="string">'class'</span>: <span class="number">1982</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>grad.<span class="keyword">class</span>  <span class="comment"># æ— æ³•è¯»å–ï¼Œå› ä¸ºåœ¨Pythonä¸­classæ˜¯ä¿ç•™å­—</span></span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    grad.<span class="keyword">class</span></span><br><span class="line">             ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getattr(grad, <span class="string">'class'</span>)  <span class="comment"># å¯ä»¥è¿™ä¹ˆåšï¼Œä½†æ˜¯ä¸å¤Ÿä¾¿åˆ©</span></span><br><span class="line"><span class="number">1982</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>explore1.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> keyword  <span class="comment"># æ£€æŸ¥å…³é”®å­—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># FrozenJSONç±»ä¸­ä¿®æ”¹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mapping)</span>:</span></span><br><span class="line">        self.__data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> mapping.items():  <span class="comment"># æ£€æŸ¥æ¯ä¸ªé”®å</span></span><br><span class="line">            <span class="keyword">if</span> keyword.iskeyword(key):  <span class="comment"># åœ¨å…³é”®å­—çš„å±žæ€§åŽé¢åŠ _</span></span><br><span class="line">                key += <span class="string">'_'</span></span><br><span class="line">            self.__data[key] = value</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> osconfeed <span class="keyword">import</span> load</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>grad = FrozenJSON(&#123;<span class="string">'name'</span>: <span class="string">'Jim Bo'</span>, <span class="string">'class'</span>: <span class="number">1982</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>grad.class_  <span class="comment"># è¿™æ ·è®¿é—®</span></span><br></pre></td></tr></table></figure><p>å¦‚æžœJSONå¯¹è±¡ä¸­çš„é”®ä¸æ˜¯æœ‰æ•ˆçš„Pythonæ ‡è¯†ç¬¦ï¼Œä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = FrozenJSON(&#123;<span class="string">'2be'</span>:<span class="string">'or not'</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x<span class="number">.2</span>be</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    x<span class="number">.2</span>be</span><br><span class="line">      ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure><p>è¿™ç§æœ‰é—®é¢˜çš„é”®åœ¨Python3ä¸­æ˜“äºŽæ£€æµ‹ï¼Œå› ä¸ºstrç±»æä¾›çš„isidentifieræ–¹æ³•èƒ½æ ¹æ®è¯­è¨€çš„è¯­æ³•åˆ¤æ–­sæ˜¯å¦ä¸ºæœ‰æ•ˆçš„Pythonæ ‡è¯†ç¬¦ã€‚ä½†æ˜¯ï¼ŒæŠŠæ— æ•ˆçš„æ ‡è¯†ç¬¦å˜æˆæœ‰æ•ˆçš„å±žæ€§åå´ä¸å®¹æ˜“ã€‚å¯¹æ­¤ï¼Œæœ‰ä¸¤ä¸ªç®€å•çš„è§£å†³æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œå¦ä¸€ä¸ªæ˜¯æŠŠæ— æ•ˆçš„é”®æ¢æˆé€šç”¨åç§°ï¼Œä¾‹å¦‚attr_0ã€attr_1ï¼Œç­‰ç­‰ã€‚</p><p>ç±»æ–¹æ³•buildæŠŠåµŒå¥—ç»“æž„è½¬æ¢æˆFrozenJSONå®žä¾‹æˆ–FrozenJSONå®žä¾‹åˆ—è¡¨ï¼Œå› ä¸º<code>__getattr__</code>æ–¹æ³•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¿é—®å±žæ€§æ—¶ï¼Œèƒ½ä¸ºä¸åŒçš„å€¼è¿”å›žä¸åŒç±»åž‹çš„å¯¹è±¡ã€‚é™¤äº†åœ¨ç±»æ–¹æ³•ä¸­å®žçŽ°è¿™æ ·çš„é€»è¾‘ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨ç‰¹æ®Šçš„<code>__new__</code>æ–¹æ³•ä¸­å®žçŽ°ã€‚</p><h2 id="ä½¿ç”¨__new__æ–¹æ³•ä»¥çµæ´»çš„æ–¹å¼åˆ›å»ºå¯¹è±¡">ä½¿ç”¨<code>__new__</code>æ–¹æ³•ä»¥çµæ´»çš„æ–¹å¼åˆ›å»ºå¯¹è±¡</h2><p>æˆ‘ä»¬é€šå¸¸æŠŠ<code>__init__</code>ç§°ä¸ºæž„é€ æ–¹æ³•ï¼Œè¿™æ˜¯ä»Žå…¶ä»–è¯­è¨€å€Ÿé‰´è¿‡æ¥çš„æœ¯è¯­ã€‚å…¶å®žï¼Œç”¨äºŽæž„å»ºå®žä¾‹çš„æ˜¯ç‰¹æ®Šæ–¹æ³•<code>__new__</code>ï¼šè¿™æ˜¯ä¸ªç±»æ–¹æ³•ï¼ˆä½¿ç”¨ç‰¹æ®Šæ–¹å¼å¤„ç†ï¼Œå› æ­¤ä¸å¿…ä½¿ç”¨@classmethodè£…é¥°å™¨ï¼‰ï¼Œå¿…é¡»è¿”å›žä¸€ä¸ªå®žä¾‹ã€‚è¿”å›žçš„å®žä¾‹ä¼šä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³selfï¼‰ä¼ ç»™<code>__init__</code>æ–¹æ³•ã€‚å› ä¸ºè°ƒç”¨<code>__init__</code>æ–¹æ³•æ—¶è¦ä¼ å…¥å®žä¾‹ï¼Œè€Œä¸”ç¦æ­¢è¿”å›žä»»ä½•å€¼ï¼Œæ‰€ä»¥<code>__init__</code>æ–¹æ³•å…¶å®žæ˜¯â€œåˆå§‹åŒ–æ–¹æ³•â€ã€‚çœŸæ­£çš„æž„é€ æ–¹æ³•æ˜¯<code>__new__</code>ã€‚æˆ‘ä»¬å‡ ä¹Žä¸éœ€è¦è‡ªå·±ç¼–å†™<code>__new__</code>æ–¹æ³•ï¼Œå› ä¸ºä»Žobjectç±»ç»§æ‰¿çš„å®žçŽ°å·²ç»è¶³å¤Ÿäº†ã€‚</p><p>ä»Ž<code>__new__</code>æ–¹æ³•åˆ°<code>__init__</code>æ–¹æ³•ï¼Œæ˜¯æœ€å¸¸è§çš„ï¼Œä½†ä¸æ˜¯å”¯ä¸€çš„ã€‚<code>__new__</code>æ–¹æ³•ä¹Ÿå¯ä»¥è¿”å›žå…¶ä»–ç±»çš„å®žä¾‹ï¼Œæ­¤æ—¶ï¼Œè§£é‡Šå™¨ä¸ä¼šè°ƒç”¨<code>__init__</code>æ–¹æ³•ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒPythonæž„å»ºå¯¹è±¡çš„è¿‡ç¨‹å¯ä»¥ä½¿ç”¨ä¸‹è¿°ä¼ªä»£ç æ¦‚æ‹¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æž„å»ºå¯¹è±¡çš„ä¼ªä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">object_maker</span><span class="params">(the_class, some_arg)</span>:</span></span><br><span class="line">    new_object = the_class.__new__(some_arg)</span><br><span class="line">    <span class="keyword">if</span> isinstance(new_object, the_class):</span><br><span class="line">        the_class.__init__(new_object, some_arg)</span><br><span class="line">    <span class="keyword">return</span> new_object</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è¿°ä¸¤ä¸ªè¯­å¥çš„ä½œç”¨åŸºæœ¬ç­‰æ•ˆ</span></span><br><span class="line">x = Foo(<span class="string">'bar'</span>)</span><br><span class="line">x = object_maker(Foo, <span class="string">'bar'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>explore2.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrozenJSON</span>:</span></span><br><span class="line">    <span class="string">"""ä¸€ä¸ªåªè¯»æŽ¥å£ï¼Œä½¿ç”¨å±žæ€§è¡¨ç¤ºæ³•è®¿é—®JSONç±»å¯¹è±¡</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, arg)</span>:</span>  <span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»æœ¬èº«</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(arg, abc.Mapping):</span><br><span class="line">            <span class="keyword">return</span> super().__new__(cls)  <span class="comment"># é»˜è®¤çš„è¡Œä¸º</span></span><br><span class="line">        <span class="keyword">elif</span> isinstance(arg, abc.MutableSequence):</span><br><span class="line">            <span class="keyword">return</span> [cls(item) <span class="keyword">for</span> item <span class="keyword">in</span> arg]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> arg</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mapping)</span>:</span></span><br><span class="line">        self.__data = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> mapping.items():</span><br><span class="line">            <span class="keyword">if</span> iskeyword(key):</span><br><span class="line">                key += <span class="string">'_'</span></span><br><span class="line">            self.__data[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self.__data, name):</span><br><span class="line">            <span class="keyword">return</span> getattr(self.__data, name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> FrozenJSON(self.__data[name])  <span class="comment"># ç›´æŽ¥è°ƒç”¨æž„é€ æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p><code>__new__</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»ï¼Œå› ä¸ºåˆ›å»ºçš„å¯¹è±¡é€šå¸¸æ˜¯é‚£ä¸ªç±»çš„å®žä¾‹ã€‚æ‰€ä»¥ï¼Œåœ¨<code>FrozenJSON.__new__</code>æ–¹æ³•ä¸­ï¼Œ<code>super().__new__(cls)</code>è¡¨è¾¾å¼ä¼šè°ƒç”¨<code>object.__new__(FrozenJSON)</code>ï¼Œè€Œobjectç±»æž„å»ºçš„å®žä¾‹å…¶å®žæ˜¯FrozenJSONå®žä¾‹ï¼Œå³é‚£ä¸ªå®žä¾‹çš„<code>__class__</code>å±žæ€§å­˜å‚¨çš„æ˜¯FrozenJSONç±»çš„å¼•ç”¨ã€‚ä¸è¿‡ï¼ŒçœŸæ­£çš„æž„å»ºæ“ä½œç”±è§£é‡Šå™¨è°ƒç”¨Cè¯­è¨€å®žçŽ°çš„<code>object.__new__</code>æ–¹æ³•æ‰§è¡Œã€‚</p><p>OSCONçš„JSONæ•°æ®æºæœ‰ä¸€ä¸ªæ˜Žæ˜¾çš„ç¼ºç‚¹ï¼šç´¢å¼•ä¸º40çš„äº‹ä»¶ï¼Œå³åä¸º'There *Will* Be Bugs'çš„é‚£ä¸ªï¼Œæœ‰ä¸¤ä½æ¼”è®²è€…ï¼Œ3471å’Œ5199ï¼Œä½†å´ä¸å®¹æ˜“æ‰¾åˆ°ä»–ä»¬ï¼Œå› ä¸ºæä¾›çš„æ˜¯ç¼–å·ï¼Œè€Œ Schedule.speakersåˆ—è¡¨æ²¡æœ‰ä½¿ç”¨ç¼–å·å»ºç«‹ç´¢å¼•ã€‚æ­¤å¤–ï¼Œæ¯æ¡äº‹ä»¶è®°å½•ä¸­éƒ½æœ‰venue_serialå­—æ®µï¼Œå­˜å‚¨çš„å€¼ä¹Ÿæ˜¯ç¼–å·ï¼Œä½†æ˜¯å¦‚æžœæƒ³æ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œé‚£å°±è¦çº¿æ€§æœç´¢Schedule.venuesåˆ—è¡¨ã€‚æŽ¥ä¸‹æ¥çš„ä»»åŠ¡æ˜¯ï¼Œè°ƒæ•´æ•°æ®ç»“æž„ï¼Œä»¥ä¾¿è‡ªåŠ¨èŽ·å–æ‰€é“¾æŽ¥çš„è®°å½•ã€‚</p><h2 id="ä½¿ç”¨shelveæ¨¡å—è°ƒæ•´osconæ•°æ®æºçš„ç»“æž„">ä½¿ç”¨shelveæ¨¡å—è°ƒæ•´OSCONæ•°æ®æºçš„ç»“æž„</h2><p>æ ‡å‡†åº“ä¸­æœ‰ä¸ª<a href="https://devdocs.io/python~3.6/library/shelve" target="_blank" rel="noopener">shelve</a>ï¼ˆæž¶å­ï¼‰æ¨¡å—ï¼Œshelveæ¨¡å—æä¾›äº†pickleï¼ˆæ³¡èœï¼ŒPythonå¯¹è±¡åºåˆ—åŒ–æ ¼å¼çš„åå­—ï¼‰å­˜å‚¨æ–¹å¼ã€‚</p><p><a href="https://devdocs.io/python~3.6/library/shelve#shelve.open" target="_blank" rel="noopener">shelve.open</a>é«˜é˜¶å‡½æ•°è¿”å›žä¸€ä¸ªshelve.Shelfå®žä¾‹ï¼Œè¿™æ˜¯ç®€å•çš„é”®å€¼å¯¹è±¡æ•°æ®åº“ï¼ŒèƒŒåŽç”±<a href="https://devdocs.io/python~3.6/library/dbm" target="_blank" rel="noopener">dbm</a>æ¨¡å—æ”¯æŒï¼Œå…·æœ‰ä¸‹è¿°ç‰¹ç‚¹ï¼š</p><ul><li>shelve.Shelfæ˜¯abc.MutableMappingçš„å­ç±»ï¼Œå› æ­¤æä¾›äº†å¤„ç†æ˜ å°„ç±»åž‹çš„é‡è¦æ–¹æ³•ã€‚</li><li>æ­¤å¤–ï¼Œshelve.Shelfç±»è¿˜æä¾›äº†å‡ ä¸ªç®¡ç†I/Oçš„æ–¹æ³•ï¼Œå¦‚syncå’Œcloseï¼›å®ƒä¹Ÿæ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚</li><li>åªè¦æŠŠæ–°å€¼èµ‹äºˆé”®ï¼Œå°±ä¼šä¿å­˜é”®å’Œå€¼ã€‚</li><li>é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚</li><li>å€¼å¿…é¡»æ˜¯pickleæ¨¡å—èƒ½å¤„ç†çš„å¯¹è±¡ã€‚</li></ul><p>shelveæ¨¡å—ä¸ºè¯†åˆ«OSCONçš„æ—¥ç¨‹æ•°æ®æä¾›äº†ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹å¼ã€‚æˆ‘ä»¬å°†ä»ŽJSONæ–‡ä»¶ä¸­è¯»å–æ‰€æœ‰è®°å½•ï¼Œå°†å…¶å­˜åœ¨ä¸€ä¸ªshelve.Shelfå¯¹è±¡ä¸­ï¼Œé”®ç”±è®°å½•ç±»åž‹å’Œç¼–å·ç»„æˆï¼ˆä¾‹å¦‚ï¼Œ'event.33950'æˆ–'speaker.3471'ï¼‰ï¼Œè€Œå€¼æ˜¯æˆ‘ä»¬å³å°†å®šä¹‰çš„Recordç±»çš„å®žä¾‹ã€‚</p><figure class="highlight python"><figcaption><span>schedule1.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> osconfeed</span><br><span class="line"></span><br><span class="line">DB_NAME = <span class="string">'data/schedule1_db'</span></span><br><span class="line">CONFERENCE = <span class="string">'conference.115'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Record</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        self.__dict__.update(kwargs)  <span class="comment"># æ›´æ–°å®žä¾‹çš„__dict__å±žæ€§</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_db</span><span class="params">(db)</span>:</span></span><br><span class="line">    raw_data = osconfeed.load()  <span class="comment"># åŠ è½½æ•°æ®</span></span><br><span class="line">    warnings.warn(<span class="string">'loading '</span> + DB_NAME)</span><br><span class="line">    <span class="keyword">for</span> collection, rec_list <span class="keyword">in</span> raw_data[<span class="string">'Schedule'</span>].items():</span><br><span class="line">        record_type = collection[:<span class="number">-1</span>]  <span class="comment"># åŽ»æŽ‰å°¾éƒ¨'s'åŽçš„é›†åˆåï¼Œä¾‹å¦‚event</span></span><br><span class="line">        <span class="keyword">for</span> record <span class="keyword">in</span> rec_list:</span><br><span class="line">            key = <span class="string">'&#123;&#125;.&#123;&#125;'</span>.format(record_type, record[<span class="string">'serial'</span>])</span><br><span class="line">            record[<span class="string">'serial'</span>] = key  <span class="comment"># æŠŠserialçš„å€¼è®¾ç½®ä¸ºå®Œæ•´çš„é”®ï¼štype.serial</span></span><br><span class="line">            db[key] = Record(**record)  <span class="comment"># åœ¨æ•°æ®åº“ä¸­å­˜å‚¨Recordå®žä¾‹</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python -i schedule1.py  <span class="comment"># å¯åŠ¨åŠ è½½äº†schedule1æ¨¡å—çš„æŽ§åˆ¶å°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> shelve</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db = shelve.open(DB_NAME)  <span class="comment"># æ‰“å¼€æ•°æ®åº“ï¼Œæˆ–è€…æ–°å»ºä¸€ä¸ª</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> CONFERENCE <span class="keyword">not</span> <span class="keyword">in</span> db:  <span class="comment"># åˆ¤æ–­æ•°æ®åº“æ˜¯å¦å¡«å……</span></span><br><span class="line"><span class="meta">... </span>    load_db(db)  <span class="comment"># åŠ è½½æ•°æ®åº“</span></span><br><span class="line">...</span><br><span class="line">schedule1.py:<span class="number">14</span>: UserWarning: loading data/schedule1_db</span><br><span class="line">  warnings.warn(<span class="string">'loading '</span> + DB_NAME)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>speaker = db[<span class="string">'speaker.3471'</span>]  <span class="comment"># ä¸€æ¡speakerè®°å½•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(speaker)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">Record</span>'&gt;</span></span><br><span class="line">&gt;&gt;&gt; speaker.name, speaker.twitter  # åœ¨æŸäº›åº”ç”¨ä¸­ï¼ŒRecordç±»å¯èƒ½è¦å¤„ç†ä¸èƒ½ä½œä¸ºå±žæ€§åä½¿ç”¨çš„é”®</span><br><span class="line">(<span class="string">'Anna Ravenscroft'</span>, <span class="string">'annaraven'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db.close()  <span class="comment"># å…³é—­Shelfå¯¹è±¡ã€‚å¦‚æžœå¯ä»¥ï¼Œä½¿ç”¨withå—ç¡®ä¿Shelfå¯¹è±¡ä¼šå…³é—­</span></span><br></pre></td></tr></table></figure><p>FrozenJSONç±»è¦é€’å½’è½¬æ¢åµŒå¥—çš„æ˜ å°„å’Œåˆ—è¡¨ï¼›è€ŒRecordç±»ä¸éœ€è¦è¿™ä¹ˆåšï¼Œå› ä¸ºè½¬æ¢å¥½çš„æ•°æ®é›†ä¸­æ²¡æœ‰åµŒå¥—çš„æ˜ å°„å’Œåˆ—è¡¨ï¼Œè®°å½•ä¸­åªæœ‰å­—ç¬¦ä¸²ã€æ•´æ•°ã€å­—ç¬¦ä¸²åˆ—è¡¨å’Œæ•´æ•°åˆ—è¡¨ã€‚FrozenJSONç±»è¦è®¿é—®å†…åµŒçš„<code>__data</code>ï¼ˆå€¼æ˜¯å­—å…¸ï¼‰å±žæ€§ï¼Œè€ŒçŽ°åœ¨æˆ‘ä»¬ä¸éœ€è¦è¿™ä¹ˆåšäº†ï¼ˆå› ä¸º<code>self.__dict__.update(kwargs)</code>å·²ç»å°†ä¼ å…¥çš„é”®å€¼å¯¹ä¿å­˜åˆ°å®žä¾‹å±žæ€§ä¸­äº†ï¼‰ã€‚</p><p>Pythonæ ‡å‡†åº“ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªä¸ŽRecordç±»ä¼¼çš„ç±»ï¼Œå…¶å®žä¾‹å¯ä»¥æœ‰ä»»æ„ä¸ªå±žæ€§ï¼Œç”±ä¼ ç»™æž„é€ æ–¹æ³•çš„å…³é”®å­—å‚æ•°æž„å»ºâ€”â€”<a href="https://devdocs.io/python~3.6/library/multiprocessing#multiprocessing.managers.Namespace" target="_blank" rel="noopener">multiprocessing.managers.Namespace</a>ç±»å’Œ<a href="https://devdocs.io/python~3.6/library/argparse#argparse.Namespace" target="_blank" rel="noopener">argparse.Namespace</a>ç±»ã€‚ä¹‹æ‰€ä»¥è‡ªå·±å®žçŽ°Recordï¼Œæ˜¯ä¸ºäº†è¯´æ˜Žä¸€ä¸ªé‡è¦çš„åšæ³•ï¼šåœ¨<code>__init__</code>æ–¹æ³•ä¸­æ›´æ–°å®žä¾‹çš„<code>__dict__</code>å±žæ€§ã€‚</p><h2 id="ä½¿ç”¨ç‰¹æ€§èŽ·å–é“¾æŽ¥çš„è®°å½•">ä½¿ç”¨ç‰¹æ€§èŽ·å–é“¾æŽ¥çš„è®°å½•</h2><p>æˆ‘ä»¬å¯ä»¥æ‰©å±•Recordç±»ï¼Œè®©å®ƒæä¾›ä¸€ä¸ªæœ‰ç”¨çš„æœåŠ¡ï¼šè‡ªåŠ¨èŽ·å–eventè®°å½•å¼•ç”¨çš„venueå’Œspeakerè®°å½•ï¼Œè€Œä¸æ˜¯ç¼–å·ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/TOzH3i8W44J_UugzW3VmKo_W1KWBeoLAmMKrQR1t5ojfBAdxHTumkpEzDI2u82Cvk0xSw5iR8vsWFHjA3UL93j9xCv5ITh2YL4rnpsmgraEtDaTfnUhypNHhtw94o7_niY6U8RgdDDyhh8x42FmJwlZ482LHVZv0AR0FO1c_rXZGNi6nvbihIx_zQxUKRPRM7pfVUmC0"><p>Recordï¼š<code>__init__</code>æ–¹æ³•ä¸å˜ï¼›ä¸ºäº†è¾…åŠ©æµ‹è¯•ï¼Œå¢žåŠ äº†<code>__eq__</code>æ–¹æ³•ã€‚</p><p>DbRecordï¼šRecordç±»çš„å­ç±»ï¼Œæ·»åŠ äº†<code>__db</code>ç±»å±žæ€§ï¼Œç”¨äºŽè®¾ç½®å’ŒèŽ·å–<code>__db</code>å±žæ€§çš„set_dbå’Œget_dbé™æ€æ–¹æ³•ï¼Œç”¨äºŽä»Žæ•°æ®åº“ä¸­èŽ·å–è®°å½•çš„fetchç±»æ–¹æ³•ï¼Œä»¥åŠè¾…åŠ©è°ƒè¯•å’Œæµ‹è¯•çš„<code>__repr__</code>å®žä¾‹æ–¹æ³•ã€‚</p><p>Eventï¼šDbRecordç±»çš„å­ç±»ï¼Œæ·»åŠ äº†ç”¨äºŽèŽ·å–æ‰€é“¾æŽ¥è®°å½•çš„venueå’Œspeakerså±žæ€§ï¼Œä»¥åŠç‰¹æ®Šçš„<code>__repr__</code>æ–¹æ³•ã€‚</p><figure class="highlight python"><figcaption><span>schedule2.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> osconfeed</span><br><span class="line"></span><br><span class="line">DB_NAME = <span class="string">'data/schedule2_db'</span></span><br><span class="line">CONFERENCE = <span class="string">'conference.115'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Record</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        self.__dict__.update(kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(other, Record):</span><br><span class="line">            <span class="keyword">return</span> self.__dict__ == other.__dict__</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MissingDatabaseError</span><span class="params">(RuntimeError)</span>:</span>  <span class="comment"># è‡ªå®šä¹‰çš„å¼‚å¸¸é€šå¸¸æ˜¯æ ‡å¿—ç±»</span></span><br><span class="line">    <span class="string">"""éœ€è¦æ•°æ®åº“ä½†æ²¡æœ‰æŒ‡å®šæ•°æ®åº“æ—¶æŠ›å‡º"""</span>   <span class="comment"># æ²¡æœ‰å®šä¹‰ä½“ï¼Œå†™ä¸€ä¸ªæ–‡æ¡£å­—ç¬¦ä¸²</span></span><br><span class="line">                                        <span class="comment"># è¯´æ˜Žå¼‚å¸¸çš„ç”¨é€”ï¼Œæ¯”passè¯­å¥è¦å¥½</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DbRecord</span><span class="params">(Record)</span>:</span>  <span class="comment"># æ‰©å±•Recordç±»</span></span><br><span class="line"></span><br><span class="line">    __db = <span class="literal">None</span>  <span class="comment"># å­˜å‚¨ä¸€ä¸ªæ‰“å¼€çš„Shelfæ•°æ®åº“å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod  # é™æ€æ–¹æ³•ï¼Œä»¥æ­¤å¼ºè°ƒä¸ç®¡è°ƒç”¨å¤šå°‘æ¬¡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_db</span><span class="params">(db)</span>:</span>  <span class="comment"># æ•ˆæžœå§‹ç»ˆä¸€æ ·</span></span><br><span class="line">        DbRecord.__db = db</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_db</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> DbRecord.__db</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod  # ç±»æ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­æ˜“äºŽå®šåˆ¶å®ƒçš„è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fetch</span><span class="params">(cls, ident)</span>:</span></span><br><span class="line">        db = cls.get_db()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> db[ident]  <span class="comment"># ä»Žæ•°æ®åº“ä¸­èŽ·å–</span></span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">if</span> db <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># æ•°æ®åº“ä¸ºç©ºæ—¶ï¼ŒæŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line">                msg = <span class="string">"database not set; call '&#123;&#125;.set_db(my_db)'"</span></span><br><span class="line">                <span class="keyword">raise</span> MissingDatabseError(msg.format(cls.__name__))</span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># å¦åˆ™é‡æ–°æŠ›å‡ºTypeErrorï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“æ€Žä¹ˆå¤„ç†</span></span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'serial'</span>):</span><br><span class="line">            cls_name = self.__class__.__name__</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&lt;&#123;&#125; serial=&#123;!r&#125;&gt;'</span>.format(cls_name, self.serial)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># è°ƒç”¨ç»§æ‰¿çš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> super().__repr__()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span><span class="params">(DbRecord)</span>:</span>  <span class="comment"># æ‰©å±•DbRecordç±»</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">venue</span><span class="params">(self)</span>:</span>  <span class="comment"># venueç‰¹æ€§</span></span><br><span class="line">        key = <span class="string">'venue.&#123;&#125;'</span>.format(self.venue_serial)</span><br><span class="line">        <span class="keyword">return</span> self.__class__.fetch(key)  <span class="comment"># ä¸ç›´æŽ¥ä½¿ç”¨self.fetch(key)</span></span><br><span class="line">        <span class="comment"># å¯¹è¿™ä¸ªOSCONæ•°æ®æºæ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨åŽè€…ï¼Œå› ä¸ºäº‹ä»¶è®°å½•éƒ½æ²¡æœ‰'fetch'é”®</span></span><br><span class="line">        <span class="comment"># å“ªæ€•åªæœ‰ä¸€ä¸ªäº‹ä»¶è®°å½•æœ‰åä¸º'fetch'çš„é”®ï¼Œé‚£ä¹ˆåœ¨é‚£ä¸ªEventå®žä¾‹ä¸­</span></span><br><span class="line">        <span class="comment"># self.fetchèŽ·å–çš„æ˜¯fetchå­—æ®µçš„å€¼ï¼Œè€Œä¸æ˜¯ç»§æ‰¿è‡ªDbRecordçš„fetchç±»æ–¹æ³•</span></span><br><span class="line">        <span class="comment"># è¿™ä¸ªç¼ºé™·ä¸æ˜Žæ˜¾ï¼Œå¾ˆå®¹æ˜“è¢«æµ‹è¯•å¿½ç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speakers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_speaker_objs'</span>):</span><br><span class="line">            <span class="comment"># ä»Ž__dict__å®žä¾‹å±žæ€§ä¸­èŽ·å–</span></span><br><span class="line">            <span class="comment"># self.speakersä¼šå‡ºçŽ°æ— é™é€’å½’ï¼Œå› ä¸ºç‰¹æ€§çš„å…¬å¼€åç§°ä¹Ÿæ˜¯speakers</span></span><br><span class="line">            spkr_serials = self.__dict__[<span class="string">'speakers'</span>]</span><br><span class="line">            fetch = self.__class__.fetch  <span class="comment"># èŽ·å–ç±»æ–¹æ³•çš„å¼•ç”¨</span></span><br><span class="line">            self._speaker_objs = [fetch(<span class="string">'speaker.&#123;&#125;'</span>.format(key))</span><br><span class="line">                                  <span class="keyword">for</span> key <span class="keyword">in</span> spkr_serials]</span><br><span class="line">        <span class="keyword">return</span> self._speaker_objs</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'name'</span>):</span><br><span class="line">            cls_name = self.__class__.__name__</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&lt;&#123;&#125; &#123;!r&#125;&gt;'</span>.format(cls_name, self.name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> super().__repr__()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_db</span><span class="params">(db)</span>:</span></span><br><span class="line">    raw_data = osconfeed.load()</span><br><span class="line">    warnings.warn(<span class="string">'loading '</span> + DB_NAME)</span><br><span class="line">    <span class="keyword">for</span> collection, rec_list <span class="keyword">in</span> raw_data[<span class="string">'Schedule'</span>].items():</span><br><span class="line">        record_type = collection[:<span class="number">-1</span>]</span><br><span class="line">        cls_name = record_type.capitalize()  <span class="comment"># é¦–å­—æ¯å¤§å†™ï¼Œä¾‹å¦‚Event</span></span><br><span class="line">        <span class="comment"># ä»Žæ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸä¸­èŽ·å–å¯¹åº”çš„å¯¹è±¡ï¼Œé»˜è®¤ä½¿ç”¨DbRecord</span></span><br><span class="line">        <span class="comment"># åªæœ‰äº‹ä»¶ç±»åž‹çš„è®°å½•æœ‰è‡ªå®šä¹‰çš„ç±»â€”â€”Eventã€‚ä¸è¿‡ï¼Œå¦‚æžœå®šä¹‰äº†</span></span><br><span class="line">        <span class="comment"># Speakeræˆ–Venueç±»ï¼Œload_dbå‡½æ•°æž„å»ºå’Œä¿å­˜è®°å½•æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨è¿™ä¸¤ä¸ªç±»</span></span><br><span class="line">        cls = globals().get(cls_name, DbRecord)</span><br><span class="line">        <span class="keyword">if</span> inspect.isclass(cls) <span class="keyword">and</span> issubclass(cls, DbRecord):</span><br><span class="line">            factory = cls</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            factory = DbRecord</span><br><span class="line">        <span class="keyword">for</span> record <span class="keyword">in</span> rec_list:</span><br><span class="line">            key = <span class="string">'&#123;&#125;.&#123;&#125;'</span>.format(record_type, record[<span class="string">'serial'</span>])</span><br><span class="line">            record[<span class="string">'serial'</span>] = key</span><br><span class="line">            db[key] = factory(**record)</span><br></pre></td></tr></table></figure><p><strong>ä»Žæ•°æ®ä¸­åˆ›å»ºå®žä¾‹å±žæ€§çš„åç§°æ—¶æœ‰å¯èƒ½ä¼šå¼•å…¥ç¼ºé™·ï¼Œå› ä¸ºç±»å±žæ€§ï¼ˆä¾‹å¦‚æ–¹æ³•ï¼‰å¯èƒ½è¢«é®ç›–ï¼Œæˆ–è€…ç”±äºŽæ„å¤–è¦†ç›–çŽ°æœ‰çš„å®žä¾‹å±žæ€§è€Œä¸¢å¤±æ•°æ®ã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½æ˜¯Pythonå­—å…¸ä¸èƒ½åƒJavaScriptå¯¹è±¡é‚£æ ·ï¼ˆobj.keyï¼‰è®¿é—®çš„åŽŸå› ã€‚</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python -i schedule2.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> shelve</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db = shelve.open(DB_NAME)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>load_db(db)</span><br><span class="line">schedule2.py:<span class="number">85</span>: UserWarning: loading data/schedule2_db</span><br><span class="line">  warnings.warn(<span class="string">'loading '</span> + DB_NAME)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>db[<span class="string">'event.33950'</span>]  <span class="comment"># çŽ°åœ¨èŽ·å–çš„æ˜¯è®°å½•å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç¼–å·</span></span><br><span class="line">&lt;Event <span class="string">'There *Will* Be Bugs'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>DbRecord.set_db(db)  <span class="comment"># å°†æ•°æ®åº“æ”¾å…¥ç±»ä¸­ï¼Œæ–¹ä¾¿æ“ä½œ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>event = DbRecord.fetch(<span class="string">'event.33950'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>event.venue  <span class="comment"># è¿”å›žè®°å½•</span></span><br><span class="line">&lt;DbRecord serial=<span class="string">'venue.1449'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>event.venue.name  <span class="comment"># æ‰¾å‡ºvenue.nameæ›´å®¹æ˜“äº†</span></span><br><span class="line"><span class="string">'Portland 251'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> spkr <span class="keyword">in</span> event.speakers:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'&#123;0.serial&#125;: &#123;0.name&#125;'</span>.format(spkr))</span><br><span class="line">...</span><br><span class="line">speaker<span class="number">.3471</span>: Anna Ravenscroft</span><br><span class="line">speaker<span class="number">.5199</span>: Alex Martelli</span><br></pre></td></tr></table></figure><p>ç‰¹æ€§ç»å¸¸ç”¨äºŽæŠŠå…¬å¼€çš„å±žæ€§å˜æˆä½¿ç”¨è¯»å€¼æ–¹æ³•å’Œè®¾å€¼æ–¹æ³•ç®¡ç†çš„å±žæ€§ï¼Œä¸”åœ¨ä¸å½±å“ä»£ç çš„å‰æä¸‹å®žæ–½ä¸šåŠ¡è§„åˆ™ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> attribute </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©pyplotæ”¯æŒæ±‰å­—</title>
      <link href="/programming/support-chinese-character-in-pyplot/"/>
      <url>/programming/support-chinese-character-in-pyplot/</url>
      
        <content type="html"><![CDATA[<p><a href="https://devdocs.io/matplotlib~3.1/font_manager_api#matplotlib.font_manager.FontProperties" target="_blank" rel="noopener"><code>class matplotlib.font_manager.FontProperties(family=None, style=None, variant=None, weight=None, stretch=None, size=None, fname=None)</code></a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib.font_manager <span class="keyword">import</span> FontProperties</span><br><span class="line"></span><br><span class="line">font = FontProperties(fname=<span class="string">'/System/Library/Fonts/PingFang.ttc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># in most functions, key is fontproperties (see valid kwargs in pyplot)</span></span><br><span class="line">plt.text(<span class="number">0</span>, <span class="number">0</span>, <span class="string">'ä½ å¥½ï¼'</span>, fontproperties=font, ha=<span class="string">'center'</span>)</span><br><span class="line">x = np.linspace(-np.pi, np.pi, <span class="number">201</span>)</span><br><span class="line">plt.plot(x, np.sin(x), label=<span class="string">'sinå‡½æ•°'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'xè½´'</span>, fontproperties=font)</span><br><span class="line">plt.ylabel(<span class="string">'yè½´'</span>, fontproperties=font)</span><br><span class="line"></span><br><span class="line"><span class="comment"># in legend, key is prop</span></span><br><span class="line">plt.legend(prop=font, fontsize=<span class="number">14</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="/uploads/image/support-chinese-character.png"></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> matplotlib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pyplotä¸­åˆæ³•çš„kwargså…³é”®å­—</title>
      <link href="/documentation/valid-kwargs-in-pyplot/"/>
      <url>/documentation/valid-kwargs-in-pyplot/</url>
      
        <content type="html"><![CDATA[<p><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text" target="_blank" rel="noopener"><code>class matplotlib.text.Text(x=0, y=0, text='', color=None, verticalalignment='baseline', horizontalalignment='left', multialignment=None, fontproperties=None, rotation=None, linespacing=None, rotation_mode=None, usetex=None, wrap=False, **kwargs)</code></a></p><table><colgroup><col style="width: 28%"><col style="width: 71%"></colgroup><thead><tr class="header"><th style="text-align: left;">Property</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_agg_filter#matplotlib.artist.Artist.set_agg_filter" target="_blank" rel="noopener"><code>agg_filter</code></a></td><td style="text-align: left;">a filter function, which takes a (m, n, 3) float array and a dpi value, and returns a (m, n, 3) array</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_alpha#matplotlib.artist.Artist.set_alpha" target="_blank" rel="noopener"><code>alpha</code></a></td><td style="text-align: left;">float</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_animated#matplotlib.artist.Artist.set_animated" target="_blank" rel="noopener"><code>animated</code></a></td><td style="text-align: left;">bool</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_backgroundcolor" target="_blank" rel="noopener"><code>backgroundcolor</code></a></td><td style="text-align: left;">color</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_bbox" target="_blank" rel="noopener"><code>bbox</code></a></td><td style="text-align: left;">dict with properties for <a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.patches.fancybboxpatch#matplotlib.patches.FancyBboxPatch" target="_blank" rel="noopener"><code>patches.FancyBboxPatch</code></a></td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_clip_box" target="_blank" rel="noopener"><code>clip_box</code></a></td><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/transformations#matplotlib.transforms.Bbox" target="_blank" rel="noopener"><code>Bbox</code></a></td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_clip_on" target="_blank" rel="noopener"><code>clip_on</code></a></td><td style="text-align: left;">bool</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_clip_path" target="_blank" rel="noopener"><code>clip_path</code></a></td><td style="text-align: left;">[(<a href="https://devdocs.io/matplotlib~3.1/path_api#matplotlib.path.Path" target="_blank" rel="noopener"><code>Path</code></a>, <a href="https://devdocs.io/matplotlib~3.1/transformations#matplotlib.transforms.Transform" target="_blank" rel="noopener"><code>Transform</code></a>)</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_color" target="_blank" rel="noopener"><code>color</code></a> or c</td><td style="text-align: left;">color</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_contains#matplotlib.artist.Artist.set_contains" target="_blank" rel="noopener"><code>contains</code></a></td><td style="text-align: left;">callable</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_figure#matplotlib.artist.Artist.set_figure" target="_blank" rel="noopener"><code>figure</code></a></td><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.figure.figure#matplotlib.figure.Figure" target="_blank" rel="noopener"><code>Figure</code></a></td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontfamily" target="_blank" rel="noopener"><code>fontfamily</code></a> or family</td><td style="text-align: left;">{FONTNAME, 'serif', 'sans-serif', 'cursive', 'fantasy', 'monospace'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontproperties" target="_blank" rel="noopener"><code>fontproperties</code></a> or font_properties</td><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/font_manager_api#matplotlib.font_manager.FontProperties" target="_blank" rel="noopener"><code>font_manager.FontProperties</code></a></td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontsize" target="_blank" rel="noopener"><code>fontsize</code></a> or size</td><td style="text-align: left;">{size in points, 'xx-small', 'x-small', 'small', 'medium', 'large', 'x-large', 'xx-large'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontstretch" target="_blank" rel="noopener"><code>fontstretch</code></a> or stretch</td><td style="text-align: left;">{a numeric value in range 0-1000, 'ultra-condensed', 'extra-condensed', 'condensed', 'semi-condensed', 'normal', 'semi-expanded', 'expanded', 'extra-expanded', 'ultra-expanded'}</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontstyle" target="_blank" rel="noopener"><code>fontstyle</code></a> or style</td><td style="text-align: left;">{'normal', 'italic', 'oblique'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontvariant" target="_blank" rel="noopener"><code>fontvariant</code></a> or variant</td><td style="text-align: left;">{'normal', 'small-caps'}</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_fontweight" target="_blank" rel="noopener"><code>fontweight</code></a> or weight</td><td style="text-align: left;">{a numeric value in range 0-1000, 'ultralight', 'light', 'normal', 'regular', 'book', 'medium', 'roman', 'semibold', 'demibold', 'demi', 'bold', 'heavy', 'extra bold', 'black'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_gid#matplotlib.artist.Artist.set_gid" target="_blank" rel="noopener"><code>gid</code></a></td><td style="text-align: left;">str</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_horizontalalignment" target="_blank" rel="noopener"><code>horizontalalignment</code></a> or ha</td><td style="text-align: left;">{'center', 'right', 'left'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_in_layout#matplotlib.artist.Artist.set_in_layout" target="_blank" rel="noopener"><code>in_layout</code></a></td><td style="text-align: left;">bool</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_label#matplotlib.artist.Artist.set_label" target="_blank" rel="noopener"><code>label</code></a></td><td style="text-align: left;">object</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_linespacing" target="_blank" rel="noopener"><code>linespacing</code></a></td><td style="text-align: left;">float (multiple of font size)</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_multialignment" target="_blank" rel="noopener"><code>multialignment</code></a> or ma</td><td style="text-align: left;">{'left', 'right', 'center'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_path_effects#matplotlib.artist.Artist.set_path_effects" target="_blank" rel="noopener"><code>path_effects</code></a></td><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/patheffects_api#matplotlib.patheffects.AbstractPathEffect" target="_blank" rel="noopener"><code>AbstractPathEffect</code></a></td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_picker#matplotlib.artist.Artist.set_picker" target="_blank" rel="noopener"><code>picker</code></a></td><td style="text-align: left;">None or bool or float or callable</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_position" target="_blank" rel="noopener"><code>position</code></a></td><td style="text-align: left;">(float, float)</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_rasterized#matplotlib.artist.Artist.set_rasterized" target="_blank" rel="noopener"><code>rasterized</code></a></td><td style="text-align: left;">bool or None</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_rotation" target="_blank" rel="noopener"><code>rotation</code></a></td><td style="text-align: left;">{angle in degrees, 'vertical', 'horizontal'}</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_rotation_mode" target="_blank" rel="noopener"><code>rotation_mode</code></a></td><td style="text-align: left;">{None, 'default', 'anchor'}</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_sketch_params#matplotlib.artist.Artist.set_sketch_params" target="_blank" rel="noopener"><code>sketch_params</code></a></td><td style="text-align: left;">(scale: float, length: float, randomness: float)</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_snap#matplotlib.artist.Artist.set_snap" target="_blank" rel="noopener"><code>snap</code></a></td><td style="text-align: left;">bool or None</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_text" target="_blank" rel="noopener"><code>text</code></a></td><td style="text-align: left;">object</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_transform#matplotlib.artist.Artist.set_transform" target="_blank" rel="noopener"><code>transform</code></a></td><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/transformations#matplotlib.transforms.Transform" target="_blank" rel="noopener"><code>Transform</code></a></td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_url#matplotlib.artist.Artist.set_url" target="_blank" rel="noopener"><code>url</code></a></td><td style="text-align: left;">str</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_usetex" target="_blank" rel="noopener"><code>usetex</code></a></td><td style="text-align: left;">bool or None</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_verticalalignment" target="_blank" rel="noopener"><code>verticalalignment</code></a> or va</td><td style="text-align: left;">{'center', 'top', 'bottom', 'baseline', 'center_baseline'}</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_visible#matplotlib.artist.Artist.set_visible" target="_blank" rel="noopener"><code>visible</code></a></td><td style="text-align: left;">bool</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_wrap" target="_blank" rel="noopener"><code>wrap</code></a></td><td style="text-align: left;">bool</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_x" target="_blank" rel="noopener"><code>x</code></a></td><td style="text-align: left;">float</td></tr><tr class="odd"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/text_api#matplotlib.text.Text.set_y" target="_blank" rel="noopener"><code>y</code></a></td><td style="text-align: left;">float</td></tr><tr class="even"><td style="text-align: left;"><a href="https://devdocs.io/matplotlib~3.1/_as_gen/matplotlib.artist.artist.set_zorder#matplotlib.artist.Artist.set_zorder" target="_blank" rel="noopener"><code>zorder</code></a></td><td style="text-align: left;">float</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> matplotlib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨asyncioåŒ…å¤„ç†å¹¶å‘</title>
      <link href="/notes/fluent-python/concurrency-with-asyncio/"/>
      <url>/notes/fluent-python/concurrency-with-asyncio/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¹¶å‘ï¼ˆconcurrencyï¼‰æ˜¯æŒ‡ä¸€æ¬¡å¤„ç†å¤šä»¶äº‹ï¼Œå…³äºŽç»“æž„ã€‚å¹¶è¡Œï¼ˆparallelismï¼‰æ˜¯æŒ‡ä¸€æ¬¡åšå¤šä»¶äº‹ï¼Œå…³äºŽæ‰§è¡Œã€‚å¹¶å‘ç”¨äºŽå®šåˆ¶æ–¹æ¡ˆï¼Œç”¨æ¥è§£å†³å¯èƒ½ï¼ˆä½†æœªå¿…ï¼‰å¹¶è¡Œçš„é—®é¢˜ã€‚</p><p>Rob Pikeï¼ˆGo è¯­è¨€çš„åˆ›é€ è€…ä¹‹ä¸€ï¼‰</p></blockquote><p>çœŸæ­£çš„å¹¶è¡Œéœ€è¦å¤šä¸ªæ ¸å¿ƒã€‚çŽ°ä»£çš„ç¬”è®°æœ¬ç”µè„‘æœ‰ 4 ä¸ªCPUæ ¸å¿ƒï¼Œä½†æ˜¯é€šå¸¸ä¸ç»æ„é—´å°±æœ‰è¶…è¿‡ 100 ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œã€‚å› æ­¤ï¼Œå®žé™…ä¸Šå¤§å¤šæ•°è¿‡ç¨‹éƒ½æ˜¯å¹¶å‘å¤„ç†çš„ï¼Œè€Œä¸æ˜¯å¹¶è¡Œå¤„ç†ã€‚è®¡ç®—æœºå§‹ç»ˆè¿è¡Œç€ 100 å¤šä¸ªè¿›ç¨‹ï¼Œç¡®ä¿æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰æœºä¼šå–å¾—è¿›å±•ï¼Œä¸è¿‡ CPU æœ¬èº«åŒæ—¶åšçš„äº‹æƒ…ä¸èƒ½è¶…è¿‡å››ä»¶ã€‚</p><p>asyncio åŒ…ä½¿ç”¨äº‹ä»¶å¾ªçŽ¯é©±åŠ¨çš„åç¨‹å®žçŽ°å¹¶å‘ã€‚<em>Guido van Rossum åœ¨ Python ä»“åº“ä¹‹å¤–å¼€å‘ asyncio åŒ…ï¼ŒæŠŠè¿™ä¸ªé¡¹ç›®çš„ä»£å·å‘½åä¸º Tulipï¼ˆéƒé‡‘é¦™ï¼‰ã€‚Python3.4 æŠŠ Tulip æ·»åŠ åˆ°æ ‡å‡†åº“ä¸­æ—¶ï¼ŒæŠŠå®ƒé‡å‘½åä¸º asyncioã€‚</em></p><h1 id="çº¿ç¨‹ä¸Žåç¨‹å¯¹æ¯”">çº¿ç¨‹ä¸Žåç¨‹å¯¹æ¯”</h1><p>åœ¨æŽ§åˆ¶å°ä¸­æ˜¾ç¤ºä¸€ä¸ªç”± ASCII å­—ç¬¦ &quot;<code>|/-\</code>&quot; æž„æˆçš„åŠ¨ç”»æ—‹è½¬æŒ‡é’ˆã€‚ä¸€ä¸ªå€Ÿç”± threading æ¨¡å—ä½¿ç”¨çº¿ç¨‹å®žçŽ°ï¼Œä¸€ä¸ªå€Ÿç”± asyncio åŒ…ä½¿ç”¨åç¨‹å®žçŽ°ã€‚å¯¹æ¯”ä¸¤ç§å®žçŽ°ï¼Œç†è§£å¦‚ä½•ä¸ä½¿ç”¨çº¿ç¨‹æ¥å®žçŽ°å¹¶å‘è¡Œä¸ºã€‚</p><a id="more"></a><h2 id="çº¿ç¨‹å®žçŽ°">çº¿ç¨‹å®žçŽ°</h2><p>ä½¿ç”¨ threading æ¨¡å—ä½¿ç”¨çº¿ç¨‹å®žçŽ°ã€‚</p><figure class="highlight python"><figcaption><span>spinner_thread.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Signal</span>:</span>  <span class="comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„å¯å˜å¯¹è±¡ï¼Œç”¨äºŽä»Žå¤–éƒ¨æŽ§åˆ¶çº¿ç¨‹</span></span><br><span class="line">    go = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spin</span><span class="params">(msg, signal)</span>:</span>  <span class="comment"># è¿™ä¸ªå‡½æ•°ä¼šåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œ</span></span><br><span class="line">    write, flush = sys.stdout.write, sys.stdout.flush</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> itertools.cycle(<span class="string">'|/-\\'</span>):  <span class="comment"># æ— é™å¾ªçŽ¯</span></span><br><span class="line">        status = char + <span class="string">' '</span> + msg</span><br><span class="line">        write(status)</span><br><span class="line">        flush()</span><br><span class="line">        write(<span class="string">'\x08'</span> * len(status))  <span class="comment"># åŠ¨ç”»çš„è¯€çªæ‰€åœ¨ï¼Œä½¿ç”¨é€€æ ¼ç¬¦ï¼ˆ\x08ï¼‰æŠŠå…‰æ ‡ç§»å›žæ¥</span></span><br><span class="line">        time.sleep(<span class="number">.1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> signal.go:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        write(<span class="string">' '</span> * len(status) + <span class="string">'\x08'</span> * len(status))  <span class="comment"># ä½¿ç”¨ç©ºæ ¼æ¸…é™¤çŠ¶æ€æ¶ˆæ¯ï¼ŒæŠŠå…‰æ ‡ç§»å›žå¼€å¤´</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slow_function</span><span class="params">()</span>:</span>  <span class="comment"># å‡è®¾è¿™æ˜¯è€—æ—¶çš„è®¡ç®—</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)  <span class="comment"># sleepå‡½æ•°ä¼šé˜»å¡žä¸»çº¿ç¨‹ï¼Œä¸è¿‡ä¸€å®šè¦è¿™ä¹ˆåšï¼Œä»¥ä¾¿é‡Šæ”¾GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">supervisor</span><span class="params">()</span>:</span>  <span class="comment"># è¿™ä¸ªå‡½æ•°è®¾ç½®ä»Žå±žçº¿ç¨‹ï¼Œæ˜¾ç¤ºçº¿ç¨‹å¯¹è±¡ï¼Œè¿è¡Œè€—æ—¶çš„è®¡ç®—ï¼Œæœ€åŽæ€æ­»çº¿ç¨‹</span></span><br><span class="line">    signal = Signal()</span><br><span class="line">    spinner = threading.Thread(target=spin, args=(<span class="string">'thinking!'</span>, signal))</span><br><span class="line">    print(<span class="string">'spinner object:'</span>, spinner)</span><br><span class="line">    spinner.start()  <span class="comment"># å¯åŠ¨ä»Žå±žçº¿ç¨‹</span></span><br><span class="line">    result = slow_function()  <span class="comment"># è¿è¡Œslow_functionå‡½æ•°ï¼Œé˜»å¡žä¸»çº¿ç¨‹ã€‚åŒæ—¶ï¼Œä»Žå±žçº¿ç¨‹ä»¥åŠ¨ç”»å½¢å¼æ˜¾ç¤ºæ—‹è½¬æŒ‡é’ˆ</span></span><br><span class="line">    signal.go = <span class="literal">False</span>  <span class="comment"># æ”¹å˜çŠ¶æ€ï¼Œspinå‡½æ•°ä¼šç»ˆæ­¢å¾ªçŽ¯</span></span><br><span class="line">    spinner.join()  <span class="comment"># ç­‰å¾…spinnerçº¿ç¨‹ç»“æŸ</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    result = supervisor()</span><br><span class="line">    print(<span class="string">'Answer:'</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python spinner_thread.py  # è¿è¡ŒæŸ¥çœ‹åŠ¨ç”»</span><br><span class="line">spinner object: &lt;Thread(Thread-1, initial)&gt;</span><br><span class="line">Answer: 42!</span><br></pre></td></tr></table></figure><p><strong>Python æ²¡æœ‰æä¾›ç»ˆæ­¢çº¿ç¨‹çš„ APIï¼Œè¿™æ˜¯æœ‰æ„ä¸ºä¹‹çš„ã€‚è‹¥æƒ³å…³é—­çº¿ç¨‹ï¼Œå¿…é¡»ç»™çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚</strong>è¿™é‡Œï¼Œä½¿ç”¨çš„æ˜¯ signal.go å±žæ€§ï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æŠŠå®ƒè®¾ä¸º False åŽï¼Œspinner çº¿ç¨‹æœ€ç»ˆä¼šæ³¨æ„åˆ°ï¼Œç„¶åŽå¹²å‡€åœ°é€€å‡ºã€‚</p><h2 id="åç¨‹å®žçŽ°">åç¨‹å®žçŽ°</h2><p>ä½¿ç”¨ <code>@asyncio.coroutine</code> è£…é¥°å™¨æ›¿ä»£çº¿ç¨‹ï¼Œå®žçŽ°ç›¸åŒçš„è¡Œä¸ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine  # æ‰“ç®—äº¤ç»™asyncioå¤„ç†çš„åç¨‹å»ºè®®ä½¿ç”¨@asyncio.coroutineè£…é¥°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spin</span><span class="params">(msg)</span>:</span>  <span class="comment"># è¿™é‡Œä¸éœ€è¦signalå‚æ•°</span></span><br><span class="line">    write, flush = sys.stdout.write, sys.stdout.flush</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> itertools.cycle(<span class="string">'|/-\\'</span>):</span><br><span class="line">        status = char + <span class="string">' '</span> + msg</span><br><span class="line">        write(status)</span><br><span class="line">        flush()</span><br><span class="line">        write(<span class="string">'\x08'</span> * len(status))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">.1</span>)  <span class="comment"># ä»£æ›¿time.sleep(.1)ï¼Œè¿™æ ·çš„ä¼‘çœ ä¸ä¼šé˜»å¡žäº‹ä»¶å¾ªçŽ¯</span></span><br><span class="line">        <span class="keyword">except</span> asyncio.CancelledError:  <span class="comment"># è‹¥å‘å‡ºäº†å–æ¶ˆè¯·æ±‚ï¼Œä¼šåœ¨yieldå¤„æŠ›å‡ºCancelledErrorå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        write(<span class="string">' '</span> * len(status) + <span class="string">'\x08'</span> * len(status))</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slow_function</span><span class="params">()</span>:</span>  <span class="comment"># åç¨‹ï¼Œåœ¨ç”¨ä¼‘çœ å‡è£…è¿›è¡ŒI/Oæ“ä½œæ—¶ï¼Œä½¿ç”¨yield fromç»§ç»­æ‰§è¡Œäº‹ä»¶å¾ªçŽ¯</span></span><br><span class="line">    <span class="comment"># å‡è£…ç­‰å¾…I/Oä¸€æ®µæ—¶é—´</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">3</span>)  <span class="comment"># æŠŠæŽ§åˆ¶æƒäº¤ç»™ä¸»å¾ªçŽ¯ï¼Œåœ¨ä¼‘çœ ç»“æŸåŽæ¢å¤è¿™ä¸ªåç¨‹</span></span><br><span class="line">                                 <span class="comment"># è‹¥ä½¿ç”¨time.sleep(3)ï¼Œåˆ™æŽ§åˆ¶æƒå›žä¸åˆ°ä¸»å¾ªçŽ¯ï¼Œ</span></span><br><span class="line">                                 <span class="comment"># spinneræ— æ³•å¾—åˆ°è¿è¡Œæ—¶é—´ï¼Œä¹Ÿå°±çœ‹ä¸åˆ°æ—‹è½¬åŠ¨ç”»å’Œæç¤ºæ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">supervisor</span><span class="params">()</span>:</span>  <span class="comment"># åç¨‹ï¼Œä½¿ç”¨yield fromé©±åŠ¨slow_functionå‡½æ•°</span></span><br><span class="line">    spinner = asyncio.<span class="keyword">async</span>(spin(<span class="string">'thinking!'</span>))  <span class="comment"># asyncå‡½æ•°æŽ’å®šåç¨‹çš„è¿è¡Œæ—¶é—´ï¼Œä½¿ç”¨ä¸€ä¸ªTaskå¯¹è±¡åŒ…è£…åç¨‹</span></span><br><span class="line">    print(<span class="string">'spinner object:'</span>, spinner)</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="keyword">from</span> slow_function()  <span class="comment"># é©±åŠ¨slow_functionå‡½æ•°ã€‚ç»“æŸåŽï¼ŒèŽ·å–è¿”å›žå€¼ã€‚åŒæ—¶ï¼Œäº‹ä»¶å¾ªçŽ¯ç»§ç»­è¿è¡Œ</span></span><br><span class="line">                                         <span class="comment"># å› ä¸ºslow_functionå‡½æ•°æœ€åŽä½¿ç”¨yield fromè¡¨è¾¾å¼æŠŠæŽ§åˆ¶æƒäº¤å›žç»™äº†ä¸»å¾ªçŽ¯</span></span><br><span class="line">                                         <span class="comment"># è‹¥ä½¿ç”¨result = slow_function()ï¼Œåˆ™åŒæ ·çœ‹ä¸åˆ°åŠ¨ç”»å’Œæç¤ºæ¶ˆæ¯</span></span><br><span class="line">    spinner.cancel()  <span class="comment"># Taskå¯¹è±¡å¯ä»¥å–æ¶ˆï¼Œå–æ¶ˆåŽä¼šåœ¨åç¨‹å½“å‰æš‚åœçš„yieldå¤„æŠ›å‡ºCancelledErrorå¼‚å¸¸</span></span><br><span class="line">                      <span class="comment"># åç¨‹å¯ä»¥æ•èŽ·è¿™ä¸ªå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥å»¶è¿Ÿå–æ¶ˆï¼Œç”šè‡³æ‹’ç»å–æ¶ˆ</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    loop = asyncio.get_event_loop()  <span class="comment"># èŽ·å–äº‹ä»¶å¾ªçŽ¯çš„å¼•ç”¨</span></span><br><span class="line">    result = loop.run_until_complete(supervisor())  <span class="comment"># é©±åŠ¨supervisoråç¨‹ï¼Œ è®©å®ƒè¿è¡Œå®Œæ¯•</span></span><br><span class="line">    loop.close()</span><br><span class="line">    print(<span class="string">'Answer:'</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python spinner_asyncio.py  # è¿è¡ŒæŸ¥çœ‹åŠ¨ç”»</span><br><span class="line">spinner object: &lt;Task pending coro=&lt;spin() running at spinner_asyncio.py:5&gt;&gt;</span><br><span class="line">Answer: 42!</span><br></pre></td></tr></table></figure><p><strong>é™¤éžæƒ³é˜»å¡žä¸»çº¿ç¨‹ï¼Œä»Žè€Œå†»ç»“äº‹ä»¶å¾ªçŽ¯æˆ–æ•´ä¸ªåº”ç”¨ï¼Œå¦åˆ™ä¸è¦åœ¨ asyncio åç¨‹ä¸­ä½¿ç”¨ time.sleep å‡½æ•°ã€‚å¦‚æžœåç¨‹éœ€è¦åœ¨ä¸€æ®µæ—¶é—´å†…ä»€ä¹ˆä¹Ÿä¸åšï¼Œåº”è¯¥ä½¿ç”¨ yield from asyncio.sleep(DELAY)ã€‚</strong></p><p>ä½¿ç”¨ <code>@asyncio.coroutine</code> è£…é¥°å™¨ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºè¿™æ ·èƒ½åœ¨ä¸€ä¼—æ™®é€šçš„å‡½æ•°ä¸­æŠŠåç¨‹å‡¸æ˜¾å‡ºæ¥ï¼Œä¹Ÿæœ‰åŠ©äºŽè°ƒè¯•ï¼šå¦‚æžœè¿˜æ²¡ä»Žä¸­äº§å‡ºå€¼ï¼Œåç¨‹å°±è¢«åžƒåœ¾å›žæ”¶äº†ï¼ˆæ„å‘³ç€æœ‰æ“ä½œæœªå®Œæˆï¼Œå› æ­¤æœ‰å¯èƒ½æ˜¯ä¸ªç¼ºé™·ï¼‰ï¼Œé‚£å°±å¯ä»¥å‘å‡ºè­¦å‘Šã€‚è¿™ä¸ªè£…é¥°å™¨ä¸ä¼šé¢„æ¿€åç¨‹ã€‚</p><p>supervisor å‡½æ•°æ˜¯è¿™ä¸¤ä¸ªç¤ºä¾‹çš„æ ¸å¿ƒã€‚ä¸‹é¢è¯¦ç»†å¯¹æ¯”äºŒè€…ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çº¿ç¨‹ç‰ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">supervisor</span><span class="params">()</span>:</span></span><br><span class="line">    signal = Signal()</span><br><span class="line">    spinner = threading.Thread(target=spin, args=(<span class="string">'thinking!'</span>, signal))</span><br><span class="line">    print(<span class="string">'spinner object:'</span>, spinner)</span><br><span class="line">    spinner.start()</span><br><span class="line">    result = slow_function()</span><br><span class="line">    signal.go = <span class="literal">False</span></span><br><span class="line">    spinner.join()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼‚æ­¥ç‰ˆ</span></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">supervisor</span><span class="params">()</span>:</span></span><br><span class="line">    spinner = asyncio.<span class="keyword">async</span>(spin(<span class="string">'thinking!'</span>))</span><br><span class="line">    print(<span class="string">'spinner object:'</span>, spinner)</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="keyword">from</span> slow_function()</span><br><span class="line">    spinner.cancel()</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§å®žçŽ°ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ¦‚è¿°å¦‚ä¸‹ï¼š</p><ul><li>asyncio.Task å¯¹è±¡å·®ä¸å¤šä¸Ž threadig.Thread å¯¹è±¡ç­‰æ•ˆã€‚Task å¯¹è±¡åƒæ˜¯å®žçŽ°åä½œå¼å¤šä»»åŠ¡çš„åº“ä¸­çš„ç»¿è‰²çº¿ç¨‹ã€‚</li><li>Task å¯¹è±¡ç”¨äºŽé©±åŠ¨åç¨‹ï¼ŒThread å¯¹è±¡ç”¨äºŽè°ƒç”¨å¯è°ƒç”¨çš„å¯¹è±¡ã€‚</li><li>Task å¯¹è±¡ä¸ç”±è‡ªå·±åŠ¨æ‰‹å®žä¾‹åŒ–ï¼Œè€Œæ˜¯é€šè¿‡æŠŠåç¨‹ä¼ ç»™ asyncio.async å‡½æ•°æˆ– loop.create_task æ–¹æ³•èŽ·å–ã€‚</li><li>èŽ·å–çš„ Task å¯¹è±¡å·²ç»æŽ’å®šäº†è¿è¡Œæ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œç”± asyncio.async å‡½æ•°æŽ’å®šï¼‰ï¼›Thread å®žä¾‹å¿…é¡»è°ƒç”¨ start æ–¹æ³•ï¼Œæ˜Žç¡®å‘ŠçŸ¥è®©å®ƒè¿è¡Œã€‚</li><li>åœ¨çº¿ç¨‹ç‰ˆ supervisor å‡½æ•°ä¸­ï¼Œslow_function å‡½æ•°æ˜¯æ™®é€šçš„å‡½æ•°ï¼Œç›´æŽ¥ç”±çº¿ç¨‹è°ƒç”¨ã€‚åœ¨å¼‚æ­¥ç‰ˆ supervisor å‡½æ•°ä¸­ï¼Œslow_function å‡½æ•°æ˜¯åç¨‹ï¼Œç”± yield fromé©±åŠ¨ã€‚</li><li>æ²¡æœ‰ API èƒ½ä»Žå¤–éƒ¨ç»ˆæ­¢çº¿ç¨‹ï¼Œå› ä¸ºçº¿ç¨‹éšæ—¶å¯èƒ½è¢«ä¸­æ–­ï¼Œå¯¼è‡´ç³»ç»Ÿå¤„äºŽæ— æ•ˆçŠ¶æ€ã€‚å¦‚æžœæƒ³ç»ˆæ­¢ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ Task.cancel å®žä¾‹æ–¹æ³•ï¼Œåœ¨åç¨‹å†…éƒ¨æŠ›å‡º CancelledError å¼‚å¸¸ã€‚åç¨‹å¯ä»¥åœ¨æš‚åœçš„ yield å¤„æ•èŽ·è¿™ä¸ªå¼‚å¸¸ï¼Œå¤„ç†ç»ˆæ­¢è¯·æ±‚ã€‚</li><li>supervisor åç¨‹å¿…é¡»åœ¨ main å‡½æ•°ä¸­ç”± loop.run_until_complete æ–¹æ³•æ‰§è¡Œã€‚</li></ul><p>å¦‚æžœä½¿ç”¨çº¿ç¨‹åšè¿‡é‡è¦çš„ç¼–ç¨‹ï¼Œä½ å°±ç›´åˆ°å†™å‡ºç¨‹åºæœ‰å¤šä¹ˆå›°éš¾ï¼Œå› ä¸ºè°ƒåº¦ç¨‹åºä»»ä½•æ—¶å€™éƒ½èƒ½ä¸­æ–­çº¿ç¨‹ã€‚å¿…é¡»è®°ä½ä¿ç•™é”ï¼ŒåŽ»ä¿æŠ¤ç¨‹åºä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œé˜²æ­¢å¤šæ­¥æ“ä½œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸­æ–­ï¼Œé˜²æ­¢æ•°æ®å¤„äºŽæ— æ•ˆçŠ¶æ€ã€‚</p><p>è€Œåç¨‹é»˜è®¤ä¼šåšå¥½å…¨æ–¹ä½ä¿æŠ¤ï¼Œä»¥é˜²æ­¢ä¸­æ–­ã€‚æˆ‘ä»¬å¿…é¡»æ˜¾ç¤ºäº§å‡ºæ‰èƒ½è®©ç¨‹åºçš„ä½™ä¸‹éƒ¨åˆ†è¿è¡Œã€‚å¯¹åç¨‹æ¥è¯´ï¼Œæ— éœ€ä¿ç•™é”ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åŒæ­¥æ“ä½œï¼Œåç¨‹è‡ªèº«å°±ä¼šåŒæ­¥ï¼Œå› ä¸ºåœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªåç¨‹è¿è¡Œã€‚æƒ³äº¤å‡ºæŽ§åˆ¶æƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ yield æˆ– yield from æŠŠæŽ§åˆ¶æƒäº¤è¿˜è°ƒåº¦ç¨‹åºã€‚è¿™å°±æ˜¯èƒ½å¤Ÿå®‰å…¨åœ°å–æ¶ˆåç¨‹çš„åŽŸå› ï¼šæŒ‰ç…§å®šä¹‰ï¼Œåç¨‹åªèƒ½åœ¨æš‚åœçš„ yield å¤„å–æ¶ˆï¼Œå› æ­¤å¯ä»¥å¤„ç† CancelledError å¼‚å¸¸ï¼Œæ‰§è¡Œæ¸…ç†æ“ä½œã€‚</p><p>ä¸‹é¢è¯´æ˜Ž asyncio.Future ç±»ä¸Ž concurrent.futures.Future ç±»ä¹‹é—´çš„åŒºåˆ«ã€‚</p><h2 id="asyncio.futureæ•…æ„ä¸é˜»å¡ž">asyncio.Futureï¼šæ•…æ„ä¸é˜»å¡ž</h2><p><strong>asyncio.Future ç±»ä¸Ž concurrent.futures.Future ç±»çš„æŽ¥å£åŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡å®žçŽ°æ–¹å¼ä¸åŒï¼Œä¸å¯ä»¥äº’æ¢ã€‚</strong></p><p>æœŸç‰©åªæ˜¯è°ƒåº¦æ‰§è¡ŒæŸç‰©çš„ç»“æžœã€‚åœ¨ asyncio åŒ…ä¸­ï¼ŒBaseEventLoop.create_task æ–¹æ³•æŽ¥æ”¶ä¸€ä¸ªåç¨‹ï¼ŒæŽ’å®šå®ƒçš„è¿è¡Œæ—¶é—´ï¼Œç„¶åŽè¿”å›žä¸€ä¸ª asyncio.Task å®žä¾‹â€”â€”ä¹Ÿæ˜¯ asyncio.Future ç±»çš„å®žä¾‹ï¼Œå› ä¸º Task æ˜¯ Future çš„å­ç±»ï¼Œç”¨äºŽåŒ…è£…åç¨‹ã€‚è¿™ä¸Žè°ƒç”¨ Executor.submit æ–¹æ³•åˆ›å»º concurrent.futures.Future å®žä¾‹æ˜¯ä¸€ä¸ªé“ç†ã€‚</p><p>ä¸Ž concurrent.futures.Future ç±»ä¼¼ï¼Œasyncio.Future ç±»ä¹Ÿæä¾›äº† doneã€add_done_callback å’Œ result ç­‰æ–¹æ³•ã€‚å‰ä¸¤ä¸ªæ–¹æ³•çš„ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡ result æ–¹æ³•å·®åˆ«å¾ˆå¤§ã€‚</p><p>asyncio.Future.result æ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œå› æ­¤ä¸èƒ½æŒ‡å®šè¶…æ—¶æ—¶é—´ã€‚æ­¤å¤–ï¼Œå¦‚æžœè°ƒç”¨ result æ–¹æ³•æ—¶æœŸç‰©è¿˜æ²¡è¿è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆ result æ–¹æ³•ä¸ä¼šé˜»å¡žåŽ»ç­‰å¾…ç»“æžœï¼Œè€Œæ˜¯æŠ›å‡º asyncio.InvalidStatueError å¼‚å¸¸ã€‚</p><p>ç„¶è€Œï¼ŒèŽ·å– asyncio.Future å¯¹è±¡çš„ç»“æžœé€šå¸¸ä½¿ç”¨ yield fromï¼Œä»Žä¸­äº§å‡ºç»“æžœã€‚</p><p>ä½¿ç”¨ yield from å¤„ç†æœŸç‰©ï¼Œç­‰å¾…æœŸç‰©è¿è¡Œå®Œæ¯•è¿™ä¸€æ­¥æ— éœ€æˆ‘ä»¬å…³å¿ƒï¼Œè€Œä¸”ä¸ä¼šé˜»å¡žäº‹ä»¶å¾ªçŽ¯ï¼Œå› ä¸ºåœ¨ asyncio åŒ…ä¸­ï¼Œyield from çš„ä½œç”¨æ˜¯æŠŠæŽ§åˆ¶æƒè¿˜ç»™äº‹ä»¶å¾ªçŽ¯ã€‚</p><p>æ³¨æ„ï¼Œä½¿ç”¨ yield from å¤„ç†æœŸç‰©ï¼Œä¸Žä½¿ç”¨ add_done_callback æ–¹æ³•å¤„ç†åç¨‹çš„ä½œç”¨ä¸€æ ·ï¼šå»¶è¿Ÿçš„æ“ä½œç»“æŸåŽï¼Œäº‹ä»¶å¾ªçŽ¯ä¸ä¼šå‡ºå‘å›žè°ƒå¯¹è±¡ï¼Œè€Œæ˜¯è®¾ç½®æœŸç‰©çš„è¿”å›žå€¼ï¼›è€Œ yield from è¡¨è¾¾å¼åˆ™åœ¨æš‚åœçš„åç¨‹ä¸­ç”Ÿæˆè¿”å›žå€¼ï¼Œæ¢å¤æ‰§è¡Œåç¨‹ã€‚</p><p><strong>æ€»ä¹‹ï¼Œå› ä¸º asyncio.Future ç±»çš„ç›®çš„æ˜¯ä¸Ž yield from ä¸€èµ·ä½¿ç”¨ï¼Œæ‰€ä»¥é€šå¸¸ä¸éœ€è¦ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚</strong></p><ul><li><p>æ— éœ€è°ƒç”¨ my_future.add_done_callbackï¼Œå› ä¸ºå¯ä»¥ç›´æŽ¥æŠŠæƒ³åœ¨æœŸç‰©è¿è¡Œç»“æŸåŽæ‰§è¡Œçš„æ“ä½œæ”¾åœ¨åç¨‹ä¸­ yield from my_future è¡¨è¾¾å¼çš„åŽé¢ã€‚è¿™æ˜¯åç¨‹çš„ä¸€å¤§ä¼˜åŠ¿ï¼šåç¨‹æ˜¯å¯ä»¥æš‚åœå’Œæ¢å¤çš„å‡½æ•°ã€‚</p></li><li><p>æ— éœ€è°ƒç”¨ my_future.resultï¼Œå› ä¸º yield from ä»ŽæœŸç‰©ä¸­äº§å‡ºçš„å€¼å°±æ˜¯ç»“æžœï¼ˆä¾‹å¦‚ï¼Œresult = yield from my_futureï¼‰ã€‚</p></li></ul><p>å½“ç„¶ï¼Œæœ‰æ—¶ä¹Ÿéœ€è¦ä½¿ç”¨ doneã€add_done_callback å’Œ result æ–¹æ³•ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œasyncio.Future å¯¹è±¡ç”± yield from é©±åŠ¨ï¼Œè€Œä¸æ˜¯é è°ƒç”¨è¿™äº›æ–¹æ³•é©±åŠ¨ã€‚</p><p>ä¸‹é¢åˆ†æž yield from å’Œ asyncio åŒ…çš„ API å¦‚ä½•æ‹‰è¿‘æœŸç‰©ã€ä»»åŠ¡å’Œåç¨‹çš„å…³ç³»ã€‚</p><h2 id="ä»ŽæœŸç‰©ä»»åŠ¡å’Œåç¨‹ä¸­äº§å‡º">ä»ŽæœŸç‰©ã€ä»»åŠ¡å’Œåç¨‹ä¸­äº§å‡º</h2><p>åœ¨ asyncio åŒ…ä¸­ï¼ŒæœŸç‰©å’Œåç¨‹çš„å…³ç³»ç´§å¯†ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ yield fromä»Žasyncio.Future å¯¹è±¡ä¸­äº§å‡ºç»“æžœã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æžœ foo æ˜¯åç¨‹å‡½æ•°ï¼ˆè°ƒç”¨åŽè¿”å›žåç¨‹å¯¹è±¡ï¼‰ï¼ŒæŠ‘æˆ–æ˜¯è¿”å›ž Future æˆ– Task å®žä¾‹çš„æ™®é€šå‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š<code>res = yield from foo()</code>ã€‚è¿™æ˜¯ asyncio åŒ…çš„ API ä¸­å¾ˆå¤šåœ°æ–¹å¯ä»¥äº’æ¢åç¨‹ä¸ŽæœŸç‰©çš„åŽŸå› ä¹‹ä¸€ã€‚</p><h1 id="ä»Žå›žè°ƒåˆ°æœŸç‰©åˆ°åç¨‹">ä»Žå›žè°ƒåˆ°æœŸç‰©åˆ°åç¨‹</h1><p>ä½¿ç”¨åç¨‹åšé¢å‘äº‹ä»¶ç¼–ç¨‹ï¼Œéœ€è¦ä¸‹ä¸€ç•ªåŠŸå¤«æ‰èƒ½æŽŒæ¡ï¼Œå› æ­¤æœ€å¥½çŸ¥é“ï¼Œä¸Žç»å…¸çš„å›žè°ƒå¼ç¼–ç¨‹ç›¸æ¯”ï¼Œåç¨‹æœ‰å“ªäº›æ”¹è¿›ã€‚</p><p>â€œå›žè°ƒåœ°ç‹±â€ï¼šå¦‚æžœä¸€ä¸ªæ“ä½œéœ€è¦ä¾èµ–ä¹‹å‰æ“ä½œçš„ç»“æžœï¼Œé‚£å°±å¾—åµŒå¥—å›žè°ƒã€‚å¦‚æžœè¦è¿žç»­åš 3 æ¬¡å¼‚æ­¥è°ƒç”¨ï¼Œé‚£å°±éœ€è¦åµŒå¥— 3 å±‚å›žè°ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// JavaScriptä¸­çš„å›žè°ƒåœ°ç‹±ï¼šåµŒå¥—åŒ¿åå‡½æ•°ï¼Œä¹Ÿç§°ä¸ºç¾éš¾é‡‘å­—å¡”</span></span><br><span class="line">api_call1(request1, <span class="function"><span class="keyword">function</span> (<span class="params">response1</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥</span></span><br><span class="line">    <span class="keyword">var</span> request2 = step1(response1);  <span class="comment">// å¤„ç†å›žè°ƒæ”¶åˆ°çš„å“åº”</span></span><br><span class="line">    aip_call2(requset2, <span class="function"><span class="keyword">function</span> (<span class="params">response2</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬äºŒæ­¥</span></span><br><span class="line">        ver request3 = step2(response2);</span><br><span class="line">        api_call3(request3, <span class="function"><span class="keyword">function</span> (<span class="params">response3</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// ç¬¬ä¸‰æ­¥</span></span><br><span class="line">            step(response3)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Pythonä¸­çš„å›žè°ƒåœ°ç‹±ï¼šé“¾å¼å›žè°ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage1</span><span class="params">(response1)</span>:</span></span><br><span class="line">    request2 = step1(response1)</span><br><span class="line">    api_call2(request2, stage2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage2</span><span class="params">(response2)</span>:</span></span><br><span class="line">    request3 = step2(response2)</span><br><span class="line">    api_call3(request3, stage3)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage3</span><span class="params">(response3)</span>:</span></span><br><span class="line">    step3(response3)</span><br><span class="line"></span><br><span class="line">api_call(request1, stage1)</span><br></pre></td></tr></table></figure><p>è™½ç„¶ä»£ç çš„æŽ’å¸ƒæ–¹å¼å·®å¼‚å¾ˆå¤§ï¼Œä½†æ˜¯ä½œç”¨å´å®Œå…¨ç›¸åŒã€‚JavaScript ç¤ºä¾‹ä¹Ÿèƒ½æ”¹å†™æˆé“¾å¼é£Žæ ¼ï¼Œä½†æ˜¯ Python ä»£ç ä¸èƒ½æ”¹å†™æˆåµŒå¥—é£Žæ ¼ï¼Œå› ä¸º lambda è¡¨è¾¾å¼å¥æ³•ä¸Šæœ‰é™åˆ¶ã€‚</p><p>ä¸Šè¿°ç»„ç»‡ä»£ç çš„æ–¹å¼å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»ï¼Œä¹Ÿæ›´éš¾ç¼–å†™ï¼šæ¯ä¸ªå‡½æ•°åšä¸€éƒ¨åˆ†å·¥ä½œï¼Œè®¾ç½®ä¸‹ä¸€ä¸ªå›žè°ƒï¼Œç„¶åŽè¿”å›žï¼Œè®©äº‹ä»¶å¾ªçŽ¯ç»§ç»­è¿è¡Œã€‚è¿™æ ·ï¼Œæ‰€æœ‰æœ¬åœ°çš„ä¸Šä¸‹æ–‡éƒ½ä¼šä¸¢å¤±ã€‚æ‰§è¡Œä¸‹ä¸€ä¸ªå›žè°ƒæ—¶ï¼ˆä¾‹å¦‚ stage2ï¼‰ï¼Œå°±æ— æ³•èŽ·å– request2 çš„å€¼ã€‚å¦‚æžœéœ€è¦é‚£ä¸ªå€¼ï¼Œé‚£å°±å¿…é¡»ä¾é é—­åŒ…ï¼Œæˆ–è€…æŠŠå®ƒå­˜å‚¨åœ¨å¤–éƒ¨æ•°æ®ç»“æž„ä¸­ï¼Œä»¥ä¾¿åœ¨å¤„ç†è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µä½¿ç”¨ã€‚</p><p>åœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œåç¨‹èƒ½å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ã€‚åœ¨åç¨‹æ±‡æ€»ï¼Œå¦‚æžœè¦è¿žç»­æ‰§è¡Œ 3 ä¸ªå¼‚æ­¥æ“ä½œï¼Œåªéœ€ä½¿ç”¨ yield 3 æ¬¡ï¼Œè®©äº‹ä»¶å¾ªçŽ¯ç»§ç»­è¿è¡Œã€‚å‡†å¤‡å¥½ç»“æžœåŽï¼Œè°ƒç”¨ send æ–¹æ³•ï¼Œæ¿€æ´»åç¨‹ã€‚å¯¹äº‹ä»¶å¾ªçŽ¯æ¥è¯´ï¼Œè¿™ç§åšæ³•ä¸Žè°ƒç”¨å›žè°ƒç±»ä¼¼ã€‚ä½†æ˜¯å¯¹ä½¿ç”¨åç¨‹å¼å¼‚æ­¥ API çš„ç”¨æˆ·æ¥è¯´ï¼Œæƒ…å†µå°±å¤§ä¸ºä¸åŒäº†ï¼š3 æ¬¡æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªå‡½æ•°å®šä¹‰ä½“ä¸­ï¼Œåƒæ˜¯é¡ºåºä»£ç ï¼Œèƒ½åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨å±€éƒ¨å˜é‡ä¿ç•™æ•´ä¸ªä»»åŠ¡çš„ä¸Šä¸‹æ–‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">three_stages</span><span class="params">(request1)</span>:</span></span><br><span class="line">    response1 = <span class="keyword">yield</span> <span class="keyword">from</span> api_call1(request1)</span><br><span class="line">    <span class="comment"># ç¬¬ä¸€æ­¥</span></span><br><span class="line">    request2 = step1(response1)</span><br><span class="line">    response2 = <span class="keyword">yield</span> <span class="keyword">from</span> api_call2(request2)</span><br><span class="line">    <span class="comment"># ç¬¬äºŒæ­¥</span></span><br><span class="line">    request3 = step2(response2)</span><br><span class="line">    response3 = <span class="keyword">yield</span> <span class="keyword">from</span> api_call3(request3)</span><br><span class="line">    <span class="comment"># ç¬¬ä¸‰æ­¥</span></span><br><span class="line">    step3(response3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># three_stages(request1)  # ä¸èƒ½ç›´æŽ¥è°ƒç”¨</span></span><br><span class="line">loop.create_task(three_stages(request1))  <span class="comment"># å¿…é¡»æ˜¾ç¤ºè°ƒåº¦æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p>ä¸Žå‰ä¸€ä¸ªç¤ºä¾‹ç›¸æ¯”ï¼Œä½¿ç”¨åç¨‹å®¹æ˜“ç†è§£å¤šäº†ï¼šæ“ä½œçš„ 3 ä¸ªæ­¥éª¤ä¾æ¬¡å†™åœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­ã€‚è¿™æ ·ï¼ŒåŽç»­å¤„ç†ä¾¿äºŽä½¿ç”¨å‰ä¸€æ­¥çš„ç»“æžœï¼›è€Œä¸”æä¾›äº†ä¸Šä¸‹æ–‡ï¼Œèƒ½é€šè¿‡å¼‚å¸¸æ¥æŠ¥å‘Šé”™è¯¯ã€‚</p><p>å‡è®¾åœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­å¤„ç† <code>api_call2(request2, stage2)</code> è°ƒç”¨ï¼ˆstage1 å‡½æ•°æœ€åŽä¸€è¡Œï¼‰æ—¶æŠ›å‡ºäº† I/O å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸æ— æ³•åœ¨ stage1 å‡½æ•°ä¸­æ•èŽ·ï¼Œå› ä¸º api_call2 æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨è¿˜æœªæ‰§è¡Œä»»ä½• I/O æ“ä½œæ—¶å°±ä¼šç«‹å³è¿”å›žã€‚åœ¨åŸºäºŽå›žè°ƒçš„ API ä¸­ï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯ä¸ºæ¯ä¸ªå¼‚æ­¥è°ƒç”¨æ³¨å†Œä¸¤ä¸ªå›žè°ƒï¼Œä¸€ä¸ªç”¨äºŽå¤„ç†æ“ä½œæˆåŠŸæ—¶çš„ç»“æžœï¼Œå¦ä¸€ä¸ªç”¨äºŽå¤„ç†é”™è¯¯ã€‚ä¸€æ—¦æ¶‰åŠé”™è¯¯å¤„ç†ï¼Œå›žè°ƒåœ°ç‹±çš„å±å®³ç¨‹åº¦å°±ä¼šè¿…é€Ÿå¢žå¤§ã€‚</p><p>ä¸Žæ­¤ç›¸æ¯”ï¼Œä½¿ç”¨åç¨‹æ—¶ä¸‰æ­¥æ“ä½œçš„æ‰€æœ‰å¼‚æ­¥è°ƒç”¨éƒ½åœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­ï¼ˆthree_stagesï¼‰ï¼Œå¦‚æžœå¼‚æ­¥è°ƒç”¨ api_call1ã€api_call2 å’Œ api_call3 ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠç›¸åº”çš„ yield from è¡¨è¾¾å¼æ”¾åœ¨ try/except å—ä¸­å¤„ç†å¼‚å¸¸ã€‚è¿™ä¹ˆåšæ¯”é™·å…¥å›žè°ƒåœ°ç‹±å¥½å¤šäº†ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šæŠŠè¿™ç§æ–¹å¼ç§°ä¸ºåç¨‹å¤©å ‚ï¼Œæ¯•ç«Ÿæˆ‘ä»¬è¿˜è¦ä»˜å‡ºä»£ä»·ã€‚æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å¸¸è§„çš„å‡½æ•°ï¼Œå¿…é¡»ä½¿ç”¨åç¨‹ï¼Œè€Œä¸”è¦ä¹ æƒ¯ yield from â€”â€”è¿™æ˜¯ç¬¬ä¸€ä¸ªéšœç¢ã€‚åªè¦å‡½æ•°ä¸­æœ‰ yield fromï¼Œå‡½æ•°å°±ä¼šå˜æˆåç¨‹ï¼Œè€Œåç¨‹ä¸èƒ½ç›´æŽ¥è°ƒç”¨ã€‚æˆ‘ä»¬å¿…é¡»ä½¿ç”¨äº‹ä»¶å¾ªçŽ¯æ˜¾ç¤ºæŽ’å®šåç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œæˆ–è€…åœ¨å…¶ä»–æŽ’å®šäº†æ‰§è¡Œæ—¶é—´çš„åç¨‹ä¸­ä½¿ç”¨ yield from è¡¨è¾¾å¼æŠŠå®ƒæ¿€æ´»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> concurrency </tag>
            
            <tag> asyncio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ å¼•è¨€</title>
      <link href="/notes/introduction-to-ml-with-python/introduction-to-machine-learning/"/>
      <url>/notes/introduction-to-ml-with-python/introduction-to-machine-learning/</url>
      
        <content type="html"><![CDATA[<p>æœºå™¨å­¦ä¹ ï¼ˆmachine learningï¼‰æ˜¯ä»Žæ•°æ®ä¸­æå–çŸ¥è¯†ã€‚å®ƒæ˜¯ç»Ÿè®¡å­¦ã€äººå·¥æ™ºèƒ½å’Œè®¡ç®—æœºç§‘å­¦äº¤å‰çš„ç ”ç©¶é¢†åŸŸï¼Œä¹Ÿè¢«ç§°ä¸ºé¢„æµ‹åˆ†æžï¼ˆpredictive analyticsï¼‰æˆ–ç»Ÿè®¡å­¦ä¹ ï¼ˆstatistical learningï¼‰ã€‚</p><h1 id="ä¸ºä½•é€‰æ‹©æœºå™¨å­¦ä¹ ">ä¸ºä½•é€‰æ‹©æœºå™¨å­¦ä¹ </h1><p>åœ¨â€œæ™ºèƒ½â€åº”ç”¨çš„æ—©æœŸï¼Œè®¸å¤šç³»ç»Ÿä½¿ç”¨äººä¸ºåˆ¶è®¢çš„â€œifâ€å’Œâ€œelseâ€å†³ç­–è§„åˆ™æ¥å¤„ç†æ•°æ®ï¼Œæˆ–æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿›è¡Œè°ƒæ•´ã€‚æƒ³è±¡æœ‰ä¸€ä¸ªåžƒåœ¾é‚®ä»¶è¿‡æ»¤å™¨ï¼Œå…¶ä»»åŠ¡æ˜¯é…Œæƒ…å°†æ”¶åˆ°çš„æŸäº›é‚®ä»¶ç§»åŠ¨åˆ°åžƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå…³é”®è¯é»‘åå•ï¼Œæ‰€æœ‰åŒ…å«è¿™äº›å…³é”®è¯çš„é‚®ä»¶éƒ½ä¼šè¢«æ ‡è®°ä¸ºåžƒåœ¾é‚®ä»¶ã€‚è¿™æ˜¯ç”¨ä¸“å®¶è®¾è®¡çš„è§„åˆ™ä½“ç³»æ¥è®¾è®¡â€œæ™ºèƒ½â€åº”ç”¨çš„ä¸€ä¸ªç¤ºä¾‹ã€‚äººä¸ºåˆ¶è®¢çš„å†³ç­–è§„åˆ™å¯¹æŸäº›åº”ç”¨æ¥è¯´æ˜¯å¯è¡Œçš„ï¼Œç‰¹åˆ«æ˜¯äººä»¬å¯¹å…¶æ¨¡åž‹å¤„ç†è¿‡ç¨‹éžå¸¸ç†Ÿæ‚‰çš„åº”ç”¨ã€‚ä½†æ˜¯ï¼Œäººä¸ºåˆ¶è®¢å†³ç­–è§„åˆ™ä¸»è¦æœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><ul><li>åšå†³ç­–æ‰€éœ€è¦çš„é€»è¾‘åªé€‚ç”¨äºŽå•ä¸€é¢†åŸŸå’Œå•é¡¹ä»»åŠ¡ã€‚ä»»åŠ¡å“ªæ€•ç¨æœ‰å˜åŒ–ï¼Œéƒ½å¯èƒ½éœ€è¦é‡å†™æ•´ä¸ªç³»ç»Ÿã€‚</li><li>æƒ³è¦åˆ¶è®¢è§„åˆ™ï¼Œéœ€è¦å¯¹äººç±»ä¸“å®¶çš„å†³ç­–è¿‡ç¨‹æœ‰å¾ˆæ·±åˆ»çš„ç†è§£ã€‚</li></ul><p>è¿™ç§äººä¸ºåˆ¶è®¢è§„åˆ™çš„æ–¹æ³•å¹¶ä¸é€‚ç”¨çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å›¾åƒä¸­çš„äººè„¸æ£€æµ‹ã€‚å¦‚ä»Šï¼Œæ¯å°æ™ºèƒ½æ‰‹æœºéƒ½èƒ½å¤Ÿæ£€æµ‹åˆ°å›¾åƒä¸­çš„äººè„¸ã€‚ä½†ç›´åˆ°2001å¹´ï¼Œäººè„¸æ£€æµ‹é—®é¢˜æ‰å¾—åˆ°è§£å†³ã€‚å…¶ä¸»è¦é—®é¢˜åœ¨äºŽï¼Œè®¡ç®—æœºâ€œæ„ŸçŸ¥â€åƒç´ ï¼ˆåƒç´ ç»„æˆäº†è®¡ç®—æœºä¸­çš„å›¾åƒï¼‰çš„æ–¹å¼ä¸Žäººç±»æ„ŸçŸ¥é¢éƒ¨çš„æ–¹å¼æœ‰éžå¸¸å¤§çš„ä¸åŒã€‚æ­£æ˜¯ç”±äºŽè¿™ç§è¡¨å¾å·®å¼‚ï¼Œäººç±»æƒ³è¦åˆ¶è®¢å‡ºä¸€å¥—å¥½çš„è§„åˆ™æ¥æè¿°æ•°å­—å›¾åƒä¸­çš„äººè„¸æž„æˆï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>ä½†æœ‰äº†æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œä»…å‘ç¨‹åºè¾“å…¥æµ·é‡äººè„¸å›¾åƒï¼Œå°±è¶³ä»¥è®©ç®—æ³•ç¡®å®šè¯†åˆ«äººè„¸éœ€è¦å“ªäº›ç‰¹å¾ã€‚</p><a id="more"></a><h1 id="æœºå™¨å­¦ä¹ èƒ½å¤Ÿè§£å†³çš„é—®é¢˜">æœºå™¨å­¦ä¹ èƒ½å¤Ÿè§£å†³çš„é—®é¢˜</h1><p>ä»Žè¾“å…¥/è¾“å‡ºå¯¹ä¸­è¿›è¡Œå­¦ä¹ çš„æœºå™¨å­¦ä¹ ç®—æ³•å«ä½œç›‘ç£å­¦ä¹ ç®—æ³•ï¼ˆsupervised learning algorithmï¼‰ï¼Œå› ä¸ºæ¯ä¸ªç”¨äºŽç®—æ³•å­¦ä¹ çš„æ ·ä¾‹éƒ½å¯¹åº”ä¸€ä¸ªé¢„æœŸè¾“å‡ºï¼Œå¥½åƒæœ‰ä¸€ä¸ªâ€œè€å¸ˆâ€åœ¨ç›‘ç£ç€ç®—æ³•ã€‚è™½ç„¶åˆ›å»ºä¸€ä¸ªåŒ…å«è¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®é›†å¾€å¾€è´¹æ—¶åˆè´¹åŠ›ï¼Œä½†ç›‘ç£å­¦ä¹ ç®—æ³•å¾ˆå¥½ç†è§£ï¼Œå…¶æ€§èƒ½ä¹Ÿæ˜“äºŽæµ‹é‡ã€‚å¦‚æžœä½ çš„åº”ç”¨å¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªç›‘ç£å­¦ä¹ é—®é¢˜ï¼Œå¹¶ä¸”ä½ èƒ½å¤Ÿåˆ›å»ºåŒ…å«é¢„æœŸè¾“å‡ºçš„æ•°æ®é›†ï¼Œé‚£ä¹ˆæœºå™¨å­¦ä¹ å¾ˆå¯èƒ½å¯ä»¥è§£å†³ä½ çš„é—®é¢˜ã€‚</p><p>ç›‘ç£æœºå™¨å­¦ä¹ ä»»åŠ¡çš„ç¤ºä¾‹å¦‚ä¸‹ã€‚</p><ul><li>è¯†åˆ«ä¿¡å°ä¸Šæ‰‹å†™çš„é‚®æ”¿ç¼–ç </li><li>åŸºäºŽåŒ»å­¦å½±åƒåˆ¤æ–­è‚¿ç˜¤æ˜¯å¦ä¸ºè‰¯æ€§</li><li>æ£€æµ‹ä¿¡ç”¨å¡äº¤æ˜“ä¸­çš„è¯ˆéª—è¡Œ</li></ul><p>å¦ä¸€ç±»ç®—æ³•æ˜¯æ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼ˆunsupervised learning algorithmï¼‰ã€‚åœ¨æ— ç›‘ç£å­¦ä¹ ä¸­ï¼Œåªæœ‰è¾“å…¥æ•°æ®æ˜¯å·²çŸ¥çš„ï¼Œæ²¡æœ‰ä¸ºç®—æ³•æä¾›è¾“å‡ºæ•°æ®ã€‚è™½ç„¶è¿™ç§ç®—æ³•æœ‰è®¸å¤šæˆåŠŸçš„åº”ç”¨ï¼Œä½†ç†è§£å’Œè¯„ä¼°è¿™äº›ç®—æ³•å¾€å¾€æ›´åŠ å›°éš¾ã€‚</p><p>æ— ç›‘ç£å­¦ä¹ çš„ç¤ºä¾‹å¦‚ä¸‹ã€‚</p><ul><li>ç¡®å®šä¸€ç³»åˆ—åšå®¢æ–‡ç« çš„ä¸»é¢˜</li><li>å°†å®¢æˆ·åˆ†æˆå…·æœ‰ç›¸ä¼¼åå¥½çš„ç¾¤ç»„</li><li>æ£€æµ‹ç½‘ç«™çš„å¼‚å¸¸è®¿é—®æ¨¡å¼</li></ul><p>æ— è®ºæ˜¯ç›‘ç£å­¦ä¹ ä»»åŠ¡è¿˜æ˜¯æ— ç›‘ç£å­¦ä¹ ä»»åŠ¡ï¼Œå°†è¾“å…¥æ•°æ®è¡¨å¾ä¸ºè®¡ç®—æœºå¯ä»¥ç†è§£çš„å½¢å¼éƒ½æ˜¯ååˆ†é‡è¦çš„ã€‚é€šå¸¸æ¥è¯´ï¼Œå°†æ•°æ®æƒ³è±¡æˆè¡¨æ ¼æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä½ æƒ³è¦å¤„ç†çš„æ¯ä¸€ä¸ªæ•°æ®ç‚¹ï¼ˆæ¯ä¸€å°ç”µå­é‚®ä»¶ã€æ¯ä¸€åå®¢æˆ·ã€æ¯ä¸€æ¬¡äº¤æ˜“ï¼‰å¯¹åº”è¡¨æ ¼ä¸­çš„ä¸€è¡Œï¼Œæè¿°è¯¥æ•°æ®ç‚¹çš„æ¯ä¸€é¡¹å±žæ€§ï¼ˆæ¯”å¦‚å®¢æˆ·å¹´é¾„ã€äº¤æ˜“é‡‘é¢æˆ–äº¤æ˜“åœ°ç‚¹ï¼‰å¯¹åº”è¡¨æ ¼ä¸­çš„ä¸€åˆ—ã€‚</p><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œè¿™é‡Œçš„æ¯ä¸ªå®žä½“æˆ–æ¯ä¸€è¡Œè¢«ç§°ä¸ºä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰æˆ–æ•°æ®ç‚¹ï¼Œè€Œæ¯ä¸€åˆ—ï¼ˆç”¨æ¥æè¿°è¿™äº›å®žä½“çš„å±žæ€§ï¼‰åˆ™è¢«ç§°ä¸ºç‰¹å¾ï¼ˆfeatureï¼‰ã€‚</p><h1 id="ç¬¬ä¸€ä¸ªåº”ç”¨é¸¢å°¾èŠ±åˆ†ç±»">ç¬¬ä¸€ä¸ªåº”ç”¨ï¼šé¸¢å°¾èŠ±åˆ†ç±»</h1><p>å‡è®¾æœ‰ä¸€åæ¤ç‰©å­¦çˆ±å¥½è€…å¯¹å¥¹å‘çŽ°çš„é¸¢å°¾èŠ±çš„å“ç§å¾ˆæ„Ÿå…´è¶£ã€‚å¥¹æ”¶é›†äº†æ¯æœµé¸¢å°¾èŠ±çš„ä¸€äº›æµ‹é‡æ•°æ®ï¼šèŠ±ç“£çš„é•¿åº¦å’Œå®½åº¦ä»¥åŠèŠ±è¼çš„é•¿åº¦å’Œå®½åº¦ï¼Œæ‰€æœ‰æµ‹é‡ç»“æžœçš„å•ä½éƒ½æ˜¯åŽ˜ç±³ã€‚</p><p>å¥¹è¿˜æœ‰ä¸€äº›é¸¢å°¾èŠ±çš„æµ‹é‡æ•°æ®ï¼Œè¿™äº›èŠ±ä¹‹å‰å·²ç»è¢«æ¤ç‰©å­¦ä¸“å®¶é‰´å®šä¸ºå±žäºŽsetosaã€versicoloræˆ–virginicaä¸‰ä¸ªå“ç§ä¹‹ä¸€ã€‚å¯¹äºŽè¿™äº›æµ‹é‡æ•°æ®ï¼Œå¥¹å¯ä»¥ç¡®å®šæ¯æœµé¸¢å°¾èŠ±æ‰€å±žçš„å“ç§ã€‚æˆ‘ä»¬å‡è®¾è¿™ä½æ¤ç‰©å­¦çˆ±å¥½è€…åœ¨é‡Žå¤–åªä¼šé‡åˆ°è¿™ä¸‰ç§é¸¢å°¾èŠ±ã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æž„å»ºä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡åž‹ï¼Œå¯ä»¥ä»Žè¿™äº›å·²çŸ¥å“ç§çš„é¸¢å°¾èŠ±æµ‹é‡æ•°æ®ä¸­è¿›è¡Œå­¦ä¹ ï¼Œä»Žè€Œèƒ½å¤Ÿé¢„æµ‹æ–°é¸¢å°¾èŠ±çš„å“ç§ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æœ‰å·²çŸ¥å“ç§çš„é¸¢å°¾èŠ±çš„æµ‹é‡æ•°æ®ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªç›‘ç£å­¦ä¹ é—®é¢˜ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬è¦åœ¨å¤šä¸ªé€‰é¡¹ä¸­é¢„æµ‹å…¶ä¸­ä¸€ä¸ªï¼ˆé¸¢å°¾èŠ±çš„å“ç§ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†ç±»ï¼ˆclassificationï¼‰é—®é¢˜çš„ç¤ºä¾‹ã€‚å¯èƒ½çš„è¾“å‡ºï¼ˆé¸¢å°¾èŠ±çš„ä¸åŒå“ç§ï¼‰å«ä½œç±»åˆ«ï¼ˆclassï¼‰ã€‚æ•°æ®é›†ä¸­çš„æ¯æœµé¸¢å°¾èŠ±éƒ½å±žäºŽä¸‰ä¸ªç±»åˆ«ä¹‹ä¸€ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªä¸‰åˆ†ç±»é—®é¢˜ã€‚</p><p>å•ä¸ªæ•°æ®ç‚¹ï¼ˆä¸€æœµé¸¢å°¾èŠ±ï¼‰çš„é¢„æœŸè¾“å‡ºæ˜¯è¿™æœµèŠ±çš„å“ç§ã€‚å¯¹äºŽä¸€ä¸ªæ•°æ®ç‚¹æ¥è¯´ï¼Œå®ƒçš„å“ç§å«ä½œæ ‡ç­¾ï¼ˆlabelï¼‰ã€‚</p><h2 id="åˆè¯†æ•°æ®">åˆè¯†æ•°æ®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset = load_iris()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset.keys()</span><br><span class="line">dict_keys([<span class="string">'data'</span>, <span class="string">'target'</span>, <span class="string">'target_names'</span>, <span class="string">'DESCR'</span>, <span class="string">'feature_names'</span>, <span class="string">'filename'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset.target_names  <span class="comment"># ä¸¤ç§è®¿é—®è®¿é—®ï¼Œå±žæ€§æˆ–é”®</span></span><br><span class="line">array([<span class="string">'setosa'</span>, <span class="string">'versicolor'</span>, <span class="string">'virginica'</span>], dtype=<span class="string">'&lt;U10'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset[<span class="string">'feature_names'</span>]</span><br><span class="line">[<span class="string">'sepal length (cm)'</span>, <span class="string">'sepal width (cm)'</span>, <span class="string">'petal length (cm)'</span>, <span class="string">'petal width (cm)'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset.data.shape</span><br><span class="line">(<span class="number">150</span>, <span class="number">4</span>)  <span class="comment"># é¸¢å°¾èŠ±æœ‰150è¡Œæ•°æ®ï¼Œæ¯è¡Œæ•°æ®æœ‰4ä¸ªç‰¹å¾</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset.target.shape</span><br><span class="line">(<span class="number">150</span>,)  <span class="comment"># 150è¡Œæ•°æ®æ‰€å±žçš„ç±»</span></span><br></pre></td></tr></table></figure><h2 id="è¡¡é‡æ¨¡åž‹æ˜¯å¦æˆåŠŸè®­ç»ƒæ•°æ®ä¸Žæµ‹è¯•æ•°æ®">è¡¡é‡æ¨¡åž‹æ˜¯å¦æˆåŠŸï¼šè®­ç»ƒæ•°æ®ä¸Žæµ‹è¯•æ•°æ®</h2><p>æˆ‘ä»¬ä¸èƒ½å°†ç”¨äºŽæž„å»ºæ¨¡åž‹çš„æ•°æ®ï¼ˆè®­ç»ƒæ•°æ®ï¼‰ç”¨äºŽè¯„ä¼°æ¨¡åž‹ã€‚å› ä¸ºæ¨¡åž‹ä¼šä¸€ç›´è®°ä½æ•´ä¸ªè®­ç»ƒé›†ï¼Œæ‰€ä»¥å¯¹äºŽè®­ç»ƒé›†ä¸­çš„ä»»ä½•æ•°æ®ç‚¹æ€»ä¼šé¢„æµ‹æ­£ç¡®çš„æ ‡ç­¾ã€‚è¿™ç§â€œè®°å¿†â€æ— æ³•å‘Šè¯‰æˆ‘ä»¬æ¨¡åž‹çš„æ³›åŒ–ï¼ˆgeneralizeï¼‰èƒ½åŠ›å¦‚ä½•ã€‚</p><p>æˆ‘ä»¬è¦ç”¨æ–°æ•°æ®æ¥è¯„ä¼°æ¨¡åž‹çš„æ€§èƒ½ã€‚é€šå¸¸çš„åšæ³•æ˜¯å°†æ”¶é›†å¥½çš„å¸¦æ ‡ç­¾æ•°æ®åˆ†æˆä¸¤éƒ¨åˆ†ã€‚ä¸€éƒ¨åˆ†æ•°æ®ç”¨äºŽæž„å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹ï¼Œå«åšè®­ç»ƒæ•°æ®ï¼ˆtraining dataï¼‰æˆ–è®­ç»ƒé›†ï¼ˆtraining setï¼‰ã€‚å…¶ä½™çš„æ•°æ®ç”¨æ¥è¯„ä¼°æ¨¡åž‹æ€§èƒ½ï¼Œå«åšæµ‹è¯•æ•°æ®ï¼ˆtest dataï¼‰ã€æµ‹è¯•é›†ï¼ˆtest setï¼‰æˆ–ç•™å‡ºé›†ï¼ˆhold-out setï¼‰ã€‚</p><p>scikit-learnä¸­çš„train_test_splitå‡½æ•°å¯ä»¥æ‰“ä¹±æ•°æ®é›†å¹¶è¿›è¡Œåˆ’åˆ†ã€‚è¿™ä¸ªå‡½æ•°é»˜è®¤å°†75%çš„è¡Œæ•°æ®åŠå¯¹åº”æ ‡ç­¾ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä¸‹25%çš„æ•°æ®åŠå…¶æ ‡ç­¾ä½œä¸ºæµ‹è¯•é›†ã€‚è®­ç»ƒé›†ä¸Žæµ‹è¯•é›†çš„åˆ†é…æ¯”ä¾‹å¯ä»¥æ˜¯éšæ„çš„ï¼Œä½†ä½¿ç”¨25%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†æ˜¯å¾ˆå¥½çš„ç»éªŒæ³•åˆ™ã€‚</p><blockquote><p><a href="https://devdocs.io/scikit_learn/modules/generated/sklearn.model_selection.train_test_split#sklearn.model_selection.train_test_split" target="_blank" rel="noopener"><code>sklearn.model_selection.train_test_split(*arrays, **options)</code></a></p><p>Split arrays or matrices into random train and test subsets.</p></blockquote><p>scikit-learnä¸­çš„æ•°æ®é€šå¸¸ç”¨å¤§å†™çš„Xè¡¨ç¤ºï¼Œè€Œæ ‡ç­¾ç”¨å°å†™çš„yè¡¨ç¤ºã€‚è¿™æ˜¯å—åˆ°äº†æ•°å­¦æ ‡å‡†å…¬å¼f(x)=yçš„å¯å‘ï¼Œå…¶ä¸­xæ˜¯å‡½æ•°çš„è¾“å…¥ï¼Œyæ˜¯è¾“å‡ºã€‚æˆ‘ä»¬ç”¨å¤§å†™çš„Xæ˜¯å› ä¸ºæ•°æ®æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼ˆçŸ©é˜µï¼‰ï¼Œç”¨å°å†™çš„yæ˜¯å› ä¸ºç›®æ ‡æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼ˆå‘é‡ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯æ•°å­¦ä¸­çš„çº¦å®šã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line"><span class="meta">... </span>    iris_dataset.data, iris_dataset.target, random_state=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>åœ¨å¯¹æ•°æ®è¿›è¡Œæ‹†åˆ†ä¹‹å‰ï¼Œtrain_test_splitå‡½æ•°åˆ©ç”¨ä¼ªéšæœºæ•°ç”Ÿæˆå™¨å°†æ•°æ®é›†æ‰“ä¹±ã€‚å¦‚æžœåªæ˜¯å°†æœ€åŽ25%çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ï¼Œé‚£ä¹ˆæ‰€æœ‰æ•°æ®ç‚¹çš„æ ‡ç­¾éƒ½æ˜¯2ï¼Œå› ä¸ºæ•°æ®ç‚¹æ˜¯æŒ‰æ ‡ç­¾æŽ’åºçš„ã€‚æµ‹è¯•é›†ä¸­åªæœ‰ä¸‰ä¸ªç±»åˆ«ä¹‹ä¸€ï¼Œè¿™æ— æ³•å‘Šè¯‰æˆ‘ä»¬æ¨¡åž‹çš„æ³›åŒ–èƒ½åŠ›å¦‚ä½•ï¼Œæ‰€ä»¥å°†æ•°æ®æ‰“ä¹±ï¼Œç¡®ä¿æµ‹è¯•é›†ä¸­åŒ…å«æ‰€æœ‰ç±»åˆ«çš„æ•°æ®ã€‚</p><p>ä¸ºäº†ç¡®ä¿å¤šæ¬¡è¿è¡ŒåŒä¸€å‡½æ•°èƒ½å¤Ÿå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œåˆ©ç”¨random_stateå‚æ•°æŒ‡å®šäº†éšæœºæ•°ç”Ÿæˆå™¨ç§å­ã€‚è¿™æ ·å‡½æ•°è¾“å‡ºå°±æ˜¯å›ºå®šä¸å˜çš„ï¼Œæ‰€ä»¥è¿™è¡Œä»£ç çš„è¾“å‡ºå§‹ç»ˆç›¸åŒã€‚</p><p>train_test_splitå‡½æ•°çš„è¾“å‡ºä¸ºX_trainã€X_testã€y_trainå’Œy_testï¼Œå®ƒä»¬éƒ½æ˜¯NumPyæ•°ç»„ã€‚X_trainåŒ…å«75%çš„è¡Œæ•°æ®ï¼ŒX_teståŒ…å«å‰©ä¸‹çš„ 25%:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>X_train.shape, y_train.shape</span><br><span class="line">((<span class="number">112</span>, <span class="number">4</span>), (<span class="number">112</span>,))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X_test.shape, y_test.shape</span><br><span class="line">((<span class="number">38</span>, <span class="number">4</span>), (<span class="number">38</span>,))</span><br></pre></td></tr></table></figure><h2 id="è¦äº‹ç¬¬ä¸€è§‚å¯Ÿæ•°æ®">è¦äº‹ç¬¬ä¸€ï¼šè§‚å¯Ÿæ•°æ®</h2><p>åœ¨æž„å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹ä¹‹å‰ï¼Œé€šå¸¸æœ€å¥½æ£€æŸ¥ä¸€ä¸‹æ•°æ®ï¼Œçœ‹çœ‹å¦‚æžœä¸ç”¨æœºå™¨å­¦ä¹ èƒ½ä¸èƒ½è½»æ¾å®Œæˆä»»åŠ¡ï¼Œæˆ–è€…éœ€è¦çš„ä¿¡æ¯æœ‰æ²¡æœ‰åŒ…å«åœ¨æ•°æ®ä¸­ã€‚</p><p>æ­¤å¤–ï¼Œæ£€æŸ¥æ•°æ®ä¹Ÿæ˜¯å‘çŽ°å¼‚å¸¸å€¼å’Œç‰¹æ®Šå€¼çš„å¥½æ–¹æ³•ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯èƒ½æœ‰äº›é¸¢å°¾èŠ±çš„æµ‹é‡å•ä½æ˜¯è‹±å¯¸è€Œä¸æ˜¯åŽ˜ç±³ã€‚åœ¨çŽ°å®žä¸–ç•Œä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸ä¸€è‡´çš„æ•°æ®å’Œæ„æ–™ä¹‹å¤–çš„æµ‹é‡æ•°æ®ã€‚</p><p>æ£€æŸ¥æ•°æ®çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€å°±æ˜¯å°†å…¶å¯è§†åŒ–ã€‚ä¸€ç§å¯è§†åŒ–æ–¹æ³•æ˜¯ç»˜åˆ¶æ•£ç‚¹å›¾ï¼ˆscatter plotï¼‰ã€‚æ•°æ®æ•£ç‚¹å›¾å°†ä¸€ä¸ªç‰¹å¾ä½œä¸ºxè½´ï¼Œå¦ä¸€ä¸ªç‰¹å¾ä½œä¸ºyè½´ï¼Œå°†æ¯ä¸€ä¸ªæ•°æ®ç‚¹ç»˜åˆ¶ä¸ºå›¾ä¸Šçš„ä¸€ä¸ªç‚¹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè®¡ç®—æœºå±å¹•åªæœ‰ä¸¤ä¸ªç»´åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€æ¬¡åªèƒ½ç»˜åˆ¶ä¸¤ä¸ªç‰¹å¾ï¼ˆä¹Ÿå¯èƒ½æ˜¯3ä¸ªï¼‰ã€‚ç”¨è¿™ç§æ–¹æ³•éš¾ä»¥å¯¹å¤šäºŽ3ä¸ªç‰¹å¾çš„æ•°æ®é›†ä½œå›¾ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ç»˜åˆ¶æ•£ç‚¹å›¾çŸ©é˜µï¼ˆpair plotï¼‰ï¼Œä»Žè€Œå¯ä»¥ä¸¤ä¸¤æŸ¥çœ‹æ‰€æœ‰çš„ç‰¹å¾ã€‚å¦‚æžœç‰¹å¾æ•°ä¸å¤šçš„è¯ï¼Œè¿™ç§æ–¹æ³•æ˜¯åˆç†çš„ã€‚ä½†æ˜¯ä½ åº”è¯¥è®°ä½ï¼Œæ•£ç‚¹å›¾çŸ©é˜µæ— æ³•åŒæ—¶æ˜¾ç¤ºæ‰€æœ‰ç‰¹å¾ä¹‹é—´çš„å…³ç³»ï¼Œæ‰€ä»¥è¿™ç§å¯è§†åŒ–æ–¹æ³•å¯èƒ½æ— æ³•å±•ç¤ºæ•°æ®çš„æŸäº›æœ‰è¶£å†…å®¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> mglearn</span><br><span class="line"><span class="comment"># åˆ©ç”¨X_trainä¸­çš„æ•°æ®åˆ›å»ºDataFrame</span></span><br><span class="line"><span class="comment"># åˆ©ç”¨iris_dataset.feature_namesä¸­çš„å­—ç¬¦ä¸²å¯¹æ•°æ®åˆ—è¿›è¡Œæ ‡è®°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataframe = pd.DataFrame(X_train, columns=iris_dataset.feature_names)</span><br><span class="line"><span class="comment"># åˆ©ç”¨DataFrameåˆ›å»ºæ•£ç‚¹å›¾çŸ©é˜µï¼ŒæŒ‰y_trainç€è‰²</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>grr = pd.scatter_matrix(iris_dataframe, c=y_train, figsize=(<span class="number">15</span>, <span class="number">15</span>), marker=<span class="string">'o'</span>,</span><br><span class="line"><span class="meta">... </span>    hist_kwds=&#123;<span class="string">'bins'</span>: <span class="number">20</span>&#125;, s=<span class="number">60</span>, alpha=<span class="number">.8</span>, cmap=mglearn.cm3)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.show()</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-ml-with-python/iris-dataframe.png"></p><p>ä»Žå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ©ç”¨èŠ±ç“£å’ŒèŠ±è¼çš„æµ‹é‡æ•°æ®åŸºæœ¬å¯ä»¥å°†ä¸‰ä¸ªç±»åˆ«åŒºåˆ†å¼€ã€‚è¿™è¯´æ˜Žæœºå™¨å­¦ä¹ æ¨¡åž‹å¾ˆå¯èƒ½å¯ä»¥å­¦ä¼šåŒºåˆ†å®ƒä»¬ã€‚</p><h2 id="æž„å»ºç¬¬ä¸€ä¸ªæ¨¡åž‹kè¿‘é‚»ç®—æ³•">æž„å»ºç¬¬ä¸€ä¸ªæ¨¡åž‹ï¼škè¿‘é‚»ç®—æ³•</h2><p>æž„å»ºæ­¤æ¨¡åž‹åªéœ€è¦ä¿å­˜è®­ç»ƒé›†å³å¯ã€‚è¦å¯¹ä¸€ä¸ªæ–°çš„æ•°æ®ç‚¹ä½œå‡ºé¢„æµ‹ï¼Œç®—æ³•ä¼šåœ¨è®­ç»ƒé›†ä¸­å¯»æ‰¾ä¸Žè¿™ä¸ªæ–°æ•°æ®ç‚¹è·ç¦»æœ€è¿‘çš„æ•°æ®ç‚¹ï¼Œç„¶åŽå°†æ‰¾åˆ°çš„æ•°æ®ç‚¹çš„æ ‡ç­¾èµ‹äºˆè¿™ä¸ªæ–°æ•°æ®ç‚¹ã€‚</p><p>kçš„å«ä¹‰æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘è®­ç»ƒé›†ä¸­ä¸Žæ–°æ•°æ®ç‚¹æœ€è¿‘çš„ä»»æ„kä¸ªé‚»å±…ï¼Œè€Œä¸æ˜¯åªè€ƒè™‘æœ€è¿‘çš„é‚£ä¸€ä¸ªã€‚ç„¶åŽï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›é‚»å±…ä¸­æ•°é‡æœ€å¤šçš„ç±»åˆ«åšå‡ºé¢„æµ‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>knn = KNeighborsClassifier(n_neighbors=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>knn.fit(X_train, y_train)  <span class="comment"># åŸºäºŽè®­ç»ƒé›†æž„å»ºæ¨¡åž‹ï¼Œfitæ–¹æ³•è¿”å›žknnå¯¹è±¡æœ¬èº«å¹¶åšåŽŸå¤„ä¿®æ”¹</span></span><br><span class="line">KNeighborsClassifier(algorithm=<span class="string">'auto'</span>, leaf_size=<span class="number">30</span>, metric=<span class="string">'minkowski'</span>,</span><br><span class="line">                     metric_params=<span class="literal">None</span>, n_jobs=<span class="literal">None</span>, n_neighbors=<span class="number">1</span>, p=<span class="number">2</span>,</span><br><span class="line">                     weights=<span class="string">'uniform'</span>)</span><br></pre></td></tr></table></figure><h2 id="åšå‡ºé¢„æµ‹">åšå‡ºé¢„æµ‹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>X_new = np.array([[<span class="number">5</span>, <span class="number">2.9</span>, <span class="number">1</span>, <span class="number">.2</span>]])  <span class="comment"># å°†æµ‹é‡çš„æ•°æ®æ”¾å…¥äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X_new.shape</span><br><span class="line">(<span class="number">1</span>, <span class="number">4</span>)  <span class="comment"># æˆ‘ä»¬æœ‰1è¡Œæ•°æ®ï¼Œæ¯è¡Œæ•°æ®æœ‰4ä¸ªç‰¹å¾</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>prediction = knn.predict(X_new)  <span class="comment"># predictçš„å‚æ•°å¿…é¡»æ˜¯äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>prediction</span><br><span class="line">array([<span class="number">0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>iris_dataset.target_names[<span class="number">0</span>]</span><br><span class="line"><span class="string">'setosa'</span>  <span class="comment"># è¿™æœµèŠ±å±žäºŽsetosaå“ç§</span></span><br></pre></td></tr></table></figure><h2 id="è¯„ä¼°æ¨¡åž‹">è¯„ä¼°æ¨¡åž‹</h2><p>è¿™é‡Œéœ€è¦ç”¨åˆ°ä¹‹å‰åˆ›å»ºçš„æµ‹è¯•é›†ã€‚è¿™äº›æ•°æ®æ²¡æœ‰ç”¨äºŽæž„å»ºæ¨¡åž‹ï¼Œä½†æˆ‘ä»¬ç›´åˆ°æµ‹è¯•é›†ä¸­æ¯æœµé¸¢å°¾èŠ±çš„å®žé™…å“ç§ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æµ‹è¯•æ•°æ®ä¸­çš„æ¯æœµé¸¢å°¾èŠ±è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å°†é¢„æµ‹ç»“æžœä¸Žæ ‡ç­¾è¿›è¡Œå¯¹æ¯”ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—ç²¾ç¡®åº¦ï¼ˆaccuracyï¼‰æ¥è¡¡é‡æ¨¡åž‹çš„ä¼˜åŠ£ï¼Œç²¾åº¦å°±æ˜¯å“ç§é¢„æµ‹æ­£ç¡®çš„èŠ±æ‰€å çš„æ¯”ä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>y_pred = knn.predict(X_test)  <span class="comment"># å…ˆé¢„æµ‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y_pred</span><br><span class="line">array([<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.mean(y_pred == y_test)  <span class="comment"># å†é€šè¿‡np.meanå‡½æ•°è®¡ç®—ç²¾åº¦</span></span><br><span class="line"><span class="number">0.9736842105263158</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>knn.score(X_test, y_test)  <span class="comment"># æˆ–è€…é€šè¿‡scoreæ–¹æ³•è®¡ç®—ç²¾åº¦</span></span><br><span class="line"><span class="number">0.9736842105263158</span></span><br></pre></td></tr></table></figure><p>å¯¹äºŽè¿™ä¸ªæ¨¡åž‹æ¥è¯´ï¼Œæµ‹è¯•é›†çš„ç²¾åº¦çº¦ä¸º0.97ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽæµ‹è¯•é›†ä¸­çš„é¸¢å°¾èŠ±ï¼Œæˆ‘ä»¬çš„é¢„æµ‹æœ‰97%æ˜¯æ­£ç¡®çš„ã€‚è¿™è®©æˆ‘ä»¬æœ‰ä¿¡å¿ƒå°†æ¨¡åž‹åº”ç”¨äºŽæ–°æ•°æ®ï¼Œå¹¶ç›¸ä¿¡æ¨¡åž‹åœ¨çº¦97%çš„æƒ…å†µä¸‹éƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Machine Learning with Python </tag>
            
            <tag> classification </tag>
            
            <tag> kmeans </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨futureså¤„ç†å¹¶å‘</title>
      <link href="/notes/fluent-python/concurrency-with-futures/"/>
      <url>/notes/fluent-python/concurrency-with-futures/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç« è®¨è®ºPython3.2å¼•å…¥çš„concurrent.futuresæ¨¡å—ã€‚â€œæœŸç‰©â€ï¼ˆfutureï¼‰æ˜¯è¯‘è€…è‡ªåˆ›çš„è¯ã€‚æœŸç‰©æŒ‡ä¸€ç§å¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥æ‰§è¡Œçš„æ“ä½œã€‚</p><h1 id="ç¤ºä¾‹ç½‘ç»œä¸‹è½½çš„ä¸‰ç§é£Žæ ¼">ç¤ºä¾‹ï¼šç½‘ç»œä¸‹è½½çš„ä¸‰ç§é£Žæ ¼</h1><p>ä¸ºäº†é«˜æ•ˆå¤„ç†ç½‘ç»œI/Oï¼Œéœ€è¦ä½¿ç”¨å¹¶å‘ï¼Œå› ä¸ºç½‘ç»œæœ‰å¾ˆé«˜çš„å»¶è¿Ÿï¼Œæ‰€ä»¥ä¸ºäº†ä¸æµªè´¹CPUå‘¨æœŸåŽ»ç­‰å¾…ï¼Œæœ€å¥½åœ¨æ”¶åˆ°ç½‘ç»œç›¸åº”ä¹‹å‰åšäº›å…¶ä»–çš„äº‹ã€‚æœ¬ç« æœ‰3ä¸ªç¤ºä¾‹ç¨‹åºï¼Œä»Žç½‘ä¸Šä¸‹è½½20ä¸ªå›½å®¶çš„å›½æ——å›¾åƒã€‚ç¬¬ä¸€ä¸ªç¤ºä¾‹ç¨‹åºæ˜¯ä¾åºä¸‹è½½çš„ï¼šä¸‹è½½å®Œä¸€ä¸ªå›¾åƒï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ç¡¬ç›˜ä¸­ä¹‹åŽï¼Œæ‰è¯·æ±‚ä¸‹ä¸€ä¸ªå›¾åƒã€‚å¦å¤–ä¸¤ä¸ªè„šæœ¬æ˜¯å¹¶å‘ä¸‹è½½ï¼ˆåˆ†åˆ«ä½¿ç”¨concurrent.futresæ¨¡å—å’ŒasyncioåŒ…ï¼‰çš„ï¼šå‡ ä¹ŽåŒæ—¶è¯·æ±‚æ‰€æœ‰å›¾åƒï¼Œæ¯ä¸‹è½½å®Œä¸€ä¸ªæ–‡ä»¶å°±ä¿å­˜ä¸€ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python flags.py</span><br><span class="line">BD BR CD CN DE EG ET FR ID IN IR JP MX NG PH PK RU TR US VN</span><br><span class="line">20 flags downloaded in 3.41s</span><br><span class="line">$ python flags_threadpool.py</span><br><span class="line">IN ID CN EG TR NG JP FR DE PK VN RU ET MX PH US IR CD BR BD</span><br><span class="line">20 flags downloaded in 0.20s</span><br><span class="line">$ python flags_asyncio.py</span><br><span class="line">JP CN PK PH EG FR TR BD IN ET RU BR DE ID US NG MX IR CD VN</span><br><span class="line">20 flags downloaded in 0.26s</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªå¹¶å‘ä¸‹è½½çš„è„šæœ¬ä¹‹é—´æ€§èƒ½å·®å¼‚ä¸å¤§ï¼Œä¸è¿‡éƒ½æ¯”ä¾åºä¸‹è½½çš„è„šæœ¬å¿«5å€å¤šï¼ˆåŽŸä¹¦æ˜¯5å€å¤šï¼Œæˆ‘çš„ç»“æžœç›¸å·®æ›´å¤§ï¼‰ã€‚è¿™åªæ˜¯ä¸€ä¸ªç‰¹åˆ«å°çš„ä»»åŠ¡ï¼Œå¦‚æžœæŠŠä¸‹è½½çš„æ–‡ä»¶æ•°é‡å¢žåŠ åˆ°å‡ ç™¾ä¸ªï¼Œå¹¶å‘ä¸‹è½½çš„è„šæœ¬èƒ½æ¯”ä¾åºä¸‹è½½çš„è„šæœ¬å¿«20å€æˆ–æ›´å¤šã€‚å°†è¿™ä¸‰ä¸ªè„šæœ¬ä¸€èµ·æ¼”ç¤ºæ˜¯ä¸ºäº†è¡¨æ˜Žä¸€ä¸ªè§‚ç‚¹ï¼š<strong>åœ¨I/Oå¯†é›†åž‹åº”ç”¨ä¸­ï¼Œå¦‚æžœä»£ç å†™çš„æ­£ç¡®ï¼Œé‚£ä¹ˆä¸ç®¡ä½¿ç”¨å“ªç§å¹¶å‘ç­–ç•¥ï¼ˆä½¿ç”¨çº¿ç¨‹æˆ–asyncioåŒ…ï¼‰ï¼Œåžåé‡éƒ½æ¯”ä¾åºæ‰§è¡Œçš„ä»£ç é«˜å¾—å¤šã€‚</strong></p><a id="more"></a><h2 id="ä¾åºä¸‹è½½çš„è„šæœ¬">ä¾åºä¸‹è½½çš„è„šæœ¬</h2><figure class="highlight python"><figcaption><span>flags.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests  <span class="comment"># å¯¼å…¥requestsåº“ï¼Œè¿™ä¸ªåº“ä¸åœ¨æ ‡å‡†åº“ä¸­</span></span><br><span class="line"></span><br><span class="line">POP20_CC = (<span class="string">'CN IN US ID BR PK NG BD RU JP '</span></span><br><span class="line">            <span class="string">'MX PH VN ET EG DE IR TR CD FR'</span>).split()</span><br><span class="line"></span><br><span class="line">BASE_URL = <span class="string">'http://flupy.org/data/flags'</span></span><br><span class="line"></span><br><span class="line">DEST_DIR = <span class="string">'downloads/'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_flag</span><span class="params">(img, filename)</span>:</span></span><br><span class="line">    path = os.path.join(DEST_DIR, filename)</span><br><span class="line">    <span class="keyword">with</span> open(path, <span class="string">'wb'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(img)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">(cc)</span>:</span></span><br><span class="line">    url = <span class="string">'&#123;&#125;/&#123;cc&#125;/&#123;cc&#125;.gif'</span>.format(BASE_URL, cc=cc.lower())</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> resp.content</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(text)</span>:</span></span><br><span class="line">    print(text, end=<span class="string">' '</span>)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> cc <span class="keyword">in</span> sorted(cc_list):  <span class="comment"># æŒ‰åºä¸‹è½½</span></span><br><span class="line">        image = get_flag(cc)</span><br><span class="line">        show(cc)</span><br><span class="line">        save_flag(image, cc.lower() + <span class="string">'.gif'</span>)</span><br><span class="line">    <span class="keyword">return</span> len(cc_list)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(download_many)</span>:</span></span><br><span class="line">    t0 = time.time()</span><br><span class="line">    count = download_many(POP20_CC)</span><br><span class="line">    elapsed = time.time() - t0</span><br><span class="line">    msg = <span class="string">'\n&#123;&#125; flags downloaded in &#123;:.2f&#125;s'</span></span><br><span class="line">    print(msg.format(count, elapsed))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main(download_many)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨concurrent.futuresæ¨¡å—ä¸‹è½½">ä½¿ç”¨concurrent.futuresæ¨¡å—ä¸‹è½½</h2><p>concurrent.futuresæ¨¡å—çš„ä¸»è¦ç‰¹è‰²æ˜¯ThreadPoolExecutorå’ŒProcessPoolExecutorç±»ï¼Œè¿™ä¸¤ä¸ªç±»å®žçŽ°çš„æŽ¥å£èƒ½åˆ†åˆ«åœ¨ä¸åŒçš„çº¿ç¨‹æˆ–è¿›ç¨‹ä¸­æ‰§è¡Œå¯è°ƒç”¨çš„å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªç±»åœ¨å†…éƒ¨ç»´æŠ¤è¿™ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æˆ–è¿›ç¨‹æ± ï¼Œä»¥åŠè¦æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæŽ¥å£æŠ½è±¡çš„å±‚çº§å¾ˆé«˜ï¼Œåƒä¸‹è½½å›½æ——è¿™ç§ç®€å•çš„æ¡ˆä¾‹ï¼Œæ— éœ€å…³å¿ƒä»»ä½•ç»†èŠ‚ã€‚</p><figure class="highlight python"><figcaption><span>flags_threadpool.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flags <span class="keyword">import</span> save_flag, get_flag, show, main  <span class="comment"># é‡ç”¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">MAX_WOKERS = <span class="number">20</span>  <span class="comment"># è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_one</span><span class="params">(cc)</span>:</span>  <span class="comment"># ä¸‹è½½ä¸€ä¸ªå›½æ——ï¼Œè¿™æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    image = get_flag(cc)</span><br><span class="line">    show(cc)</span><br><span class="line">    save_flag(image, cc.lower() + <span class="string">'.gif'</span>)</span><br><span class="line">    <span class="keyword">return</span> cc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list)</span>:</span></span><br><span class="line">    wokers = min(MAX_WOKERS, len(cc_list))  <span class="comment"># é¿å…åˆ›å»ºå¤šä½™çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="comment"># executor.__exit__æ–¹æ³•ä¼šè°ƒç”¨executor.shutdown(wait=True)æ–¹æ³•</span></span><br><span class="line">    <span class="comment"># å®ƒä¼šåœ¨æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•å‰é˜»å¡žçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">with</span> futures.ThreadPoolExecutor(wokers) <span class="keyword">as</span> executor:</span><br><span class="line">        res = executor.map(download_one, sorted(cc_list))  <span class="comment"># è¿”å›žä¸€ä¸ªç”Ÿæˆå™¨</span></span><br><span class="line">    <span class="keyword">return</span> len(list(res))  <span class="comment"># èŽ·å–å„ä¸ªå‡½æ•°è¿”å›žçš„å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main(download_many)</span><br></pre></td></tr></table></figure><h3 id="æœŸç‰©åœ¨å“ªé‡Œ">æœŸç‰©åœ¨å“ªé‡Œ</h3><p>æœŸç‰©æ˜¯concurrent.futuresæ¨¡å—å’ŒasyncioåŒ…çš„é‡è¦ç»„ä»¶ï¼Œå¯æ˜¯ï¼Œä½œä¸ºè¿™ä¸¤ä¸ªåº“çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬æœ‰æ—¶å´è§ä¸åˆ°æœŸç‰©ã€‚</p><p>ä»ŽPython3.4èµ·ï¼Œæ ‡å‡†åº“ä¸­æœ‰ä¸¤ä¸ªåä¸ºFutureçš„ç±»ï¼šconcurrent.futures.Futureå’Œasyncio.Futureã€‚è¿™ä¸¤ä¸ªç±»çš„ä½œç”¨ç›¸åŒï¼šä¸¤ä¸ªFutureç±»çš„å®žä¾‹éƒ½è¡¨ç¤ºå¯èƒ½å·²ç»å®Œæˆæˆ–è€…å°šæœªå®Œæˆçš„å»¶è¿Ÿè®¡ç®—ã€‚è¿™ä¸ŽTwistedå¼•æ“Žä¸­çš„Deferredç±»ã€Tornadoæ¡†æž¶ä¸­çš„Futureç±»ï¼Œä»¥åŠå¤šä¸ªJavaScriptåº“ä¸­çš„Promiseå¯¹è±¡ç±»ä¼¼ã€‚</p><p>æœŸç‰©å°è£…å¾…å®Œæˆçš„æ“ä½œï¼Œå¯ä»¥æ”¾å…¥é˜Ÿåˆ—ï¼Œå®Œæˆçš„çŠ¶æ€å¯ä»¥æŸ¥è¯¢ï¼Œå¾—åˆ°ç»“æžœï¼ˆæˆ–æŠ›å‡ºå¼‚å¸¸ï¼‰åŽå¯ä»¥èŽ·å–ç»“æžœï¼ˆæˆ–å¼‚å¸¸ï¼‰ã€‚</p><p>æˆ‘ä»¬è¦è®°ä½ä¸€ä»¶äº‹ï¼š<strong>é€šå¸¸æƒ…å†µä¸‹è‡ªå·±ä¸åº”è¯¥åˆ›å»ºæœŸç‰©ï¼Œè€Œåªèƒ½ç”±å¹¶å‘æ¡†æž¶ï¼ˆconcurrent.futuresæˆ–asyncioï¼‰å®žä¾‹åŒ–ã€‚</strong>åŽŸå› å¾ˆç®€å•ï¼šæœŸç‰©è¡¨ç¤ºç»ˆå°†å‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œç¡®å®šæŸä»¶äº‹ä¼šå‘ç”Ÿçš„å”¯ä¸€æ–¹å¼æ˜¯æ‰§è¡Œçš„æ—¶é—´å·²ç»æŽ’å®šã€‚å› æ­¤ï¼Œåªæœ‰æŽ’å®šæŠŠæŸä»¶äº‹äº¤ç»™concurrent.futures.Executorå­ç±»å¤„ç†æ—¶ï¼Œæ‰ä¼šåˆ›å»ºconcurrent.futures.Futureå®žä¾‹ã€‚ä¾‹å¦‚ï¼ŒExecutor.submitæ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•åŽä¼šä¸ºä¼ å…¥çš„å¯è°ƒç”¨å¯¹è±¡æŽ’æœŸï¼Œå¹¶è¿”å›žä¸€ä¸ªæœŸç‰©ã€‚</p><p>å®¢æˆ·ç«¯ä»£ç ä¸åº”è¯¥æ”¹å˜æœŸç‰©çš„çŠ¶æ€ï¼Œå¹¶å‘æ¡†æž¶åœ¨æœŸç‰©è¡¨ç¤ºçš„å»¶è¿Ÿè®¡ç®—ç»“æŸåŽä¼šæ”¹å˜æœŸç‰©çš„çŠ¶æ€ï¼Œè€Œæˆ‘ä»¬æ— æ³•æŽ§åˆ¶è®¡ç®—ä½•æ—¶ç»“æŸã€‚</p><p>è¿™ä¸¤ç§æœŸç‰©éƒ½æœ‰doneæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸é˜»å¡žï¼Œè¿”å›žå€¼æ˜¯å¸ƒå°”å€¼ï¼ŒæŒ‡æ˜ŽæœŸç‰©é“¾æŽ¥çš„å¯è°ƒç”¨å¯¹è±¡æ˜¯å¦å·²ç»æ‰§è¡Œã€‚å®¢æˆ·ç«¯ä»£ç é€šå¸¸ä¸ä¼šè¯¢é—®æœŸç‰©æ˜¯å¦è¿è¡Œç»“æŸï¼Œè€Œæ˜¯ä¼šç­‰å¾…é€šçŸ¥ã€‚å› æ­¤ï¼Œä¸¤ä¸ªFutureç±»éƒ½æœ‰add_done_callbackæ–¹æ³•ï¼šè¿™ä¸ªæ–¹æ³•åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œç±»åž‹æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼ŒæœŸç‰©è¿è¡Œç»“æŸåŽä¼šè°ƒç”¨æŒ‡å®šçš„å¯è°ƒç”¨å¯¹è±¡ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰resultæ–¹æ³•ã€‚åœ¨æœŸç‰©è¿è¡Œç»“æŸåŽè°ƒç”¨çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä¸¤ä¸ªFutureç±»ä¸­çš„ä½œç”¨ç›¸åŒï¼šè¿”å›žå¯è°ƒç”¨å¯¹è±¡çš„ç»“æžœï¼Œæˆ–è€…é‡æ–°æŠ›å‡ºæ‰§è¡Œå¯è°ƒç”¨çš„å¯¹è±¡æ—¶æŠ›å‡ºçš„å¼‚å¸¸ã€‚å¯æ˜¯ï¼Œå¦‚æžœæœŸç‰©æ²¡æœ‰è¿è¡Œç»“æŸï¼Œresultæ–¹æ³•åœ¨ä¸¤ä¸ªFutureç±»ä¸­çš„è¡Œä¸ºç›¸å·®å¾ˆå¤§ã€‚å¯¹concurrency.futures.Futureå®žä¾‹æ¥è¯´ï¼Œè°ƒç”¨f.result()æ–¹æ³•ä¼šé˜»å¡žè°ƒç”¨æ–¹æ‰€åœ¨çš„çº¿ç¨‹ï¼Œç›´åˆ°æœ‰ç»“æžœå¯ä»¥è¿”å›žã€‚æ­¤æ—¶ï¼Œresultæ–¹æ³•å¯ä»¥æŽ¥æ”¶å¯é€‰çš„timeoutå‚æ•°ï¼Œå¦‚æžœåœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰è¿è¡Œå®Œæ¯•ï¼Œä¼šæŠ›å‡ºTimeoutErrorå¼‚å¸¸ã€‚asyncio.Future.resultæ–¹æ³•ä¸æ”¯æŒè®¾å®šè¶…è¿‡æ—¶é—´ï¼Œåœ¨é‚£ä¸ªåº“ä¸­èŽ·å–æœŸç‰©çš„ç»“æžœæœ€å¥½ä½¿ç”¨yield fromç»“æž„ã€‚ä¸è¿‡ï¼Œå¯¹concurrency.futures.Futureå®žä¾‹ä¸èƒ½è¿™ä¹ˆåšã€‚</p><p>è¿™ä¸¤ä¸ªåº“ä¸­æœ‰å‡ ä¸ªå‡½æ•°ä¼šè¿”å›žæœŸç‰©ï¼Œå…¶ä»–å‡½æ•°åˆ™ä½¿ç”¨æœŸç‰©ï¼Œä»¥æ˜“äºŽç”¨æˆ·ç†è§£çš„æ–¹å¼å®žçŽ°è‡ªèº«ã€‚Executor.mapæ–¹æ³•å±žäºŽåŽè€…ï¼šè¿”å›žå€¼æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨çš„<code>__next__</code>æ–¹æ³•è°ƒç”¨å„ä¸ªæœŸç‰©çš„resultæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°çš„æ˜¯å„ä¸ªæœŸç‰©çš„ç»“æžœï¼Œè€ŒéžæœŸç‰©æœ¬èº«ã€‚</p><p>ä¸ºäº†ä»Žå®žç”¨çš„è§’åº¦ç†è§£æœŸç‰©ï¼Œæˆ‘ä»¬å¯ä»¥å®žç”¨concurrent.futures.as_completedå‡½æ•°é‡å†™ç¤ºä¾‹ã€‚è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªæœŸç‰©åˆ—è¡¨ï¼Œè¿”å›žå€¼æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œåœ¨æœŸç‰©è¿è¡Œç»“æŸåŽäº§å‡ºæœŸç‰©ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list)</span>:</span></span><br><span class="line">    cc_list = cc_list[:<span class="number">5</span>]  <span class="comment"># ä½¿ç”¨5ä¸ªåšæ¼”ç¤º</span></span><br><span class="line">    <span class="keyword">with</span> futures.ThreadPoolExecutor(max_workers=<span class="number">3</span>) <span class="keyword">as</span> executor:</span><br><span class="line">        to_do = []</span><br><span class="line">        <span class="keyword">for</span> cc <span class="keyword">in</span> sorted(cc_list):</span><br><span class="line">            future = executor.submit(download_one, cc)  <span class="comment"># æŽ’å®šå¯è°ƒç”¨å¯¹è±¡çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿”å›žä¸€ä¸ªæœŸç‰©</span></span><br><span class="line">            to_do.append(future)</span><br><span class="line">            msg = <span class="string">'Scheduled for &#123;&#125;: &#123;&#125;'</span></span><br><span class="line">            print(msg.format(cc, future))</span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">for</span> future <span class="keyword">in</span> futures.as_completed(to_do):  <span class="comment"># åœ¨æœŸç‰©è¿è¡Œç»“æŸåŽäº§å‡ºæœŸç‰©</span></span><br><span class="line">            res = future.result()  <span class="comment"># è¿™æ¬¡ä¸ä¼šé˜»å¡žï¼Œå› ä¸ºfutureç”±as_completedå‡½æ•°äº§å‡º</span></span><br><span class="line">            msg = <span class="string">'&#123;&#125; result: &#123;!r&#125;'</span></span><br><span class="line">            print(msg.format(future, res))</span><br><span class="line">            results.append(res)</span><br><span class="line">        <span class="keyword">return</span> len(results)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python flags_threadpool.py</span><br><span class="line">Scheduled for BR: &lt;Future at 0x1031a25f8 state=running&gt;</span><br><span class="line">Scheduled for CN: &lt;Future at 0x1031ae0f0 state=running&gt;</span><br><span class="line">Scheduled for ID: &lt;Future at 0x1031ae6a0 state=running&gt;  # æœ€å¤§3ä¸ª</span><br><span class="line">Scheduled for IN: &lt;Future at 0x1031bb080 state=pending&gt;</span><br><span class="line">Scheduled for US: &lt;Future at 0x1031bb160 state=pending&gt;</span><br><span class="line">CN &lt;Future at 0x1031ae0f0 state=finished returned str&gt; result: &apos;CN&apos;</span><br><span class="line">ID BR &lt;Future at 0x1031ae6a0 state=finished returned str&gt; result: &apos;ID&apos;</span><br><span class="line">&lt;Future at 0x1031a25f8 state=finished returned str&gt; result: &apos;BR&apos;</span><br><span class="line">IN &lt;Future at 0x1031bb080 state=finished returned str&gt; result: &apos;IN&apos;</span><br><span class="line">US &lt;Future at 0x1031bb160 state=finished returned str&gt; result: &apos;US&apos;</span><br><span class="line"></span><br><span class="line">5 flags downloaded in 0.32s</span><br></pre></td></tr></table></figure><p>å¤šæ¬¡è¿è¡Œè„šæœ¬çœ‹åˆ°çš„ç»“æžœæœ‰æ‰€ä¸åŒã€‚å¦‚æžœæŠŠmax_workerså‚æ•°çš„å€¼å¢žå¤§åˆ°5ï¼Œç»“æžœçš„é¡ºåºå˜åŒ–æ›´å¤šã€‚æŠŠmax_workerså‚æ•°çš„å€¼è®¾ä¸º1ï¼Œä»£ç ä¾åºè¿è¡Œï¼Œç»“æžœçš„é¡ºåºå§‹ç»ˆä¸Žè°ƒç”¨submitæ–¹æ³•çš„é¡ºåºä¸€è‡´ã€‚</p><h2 id="ä½¿ç”¨asyncioæ¨¡å—ä¸‹è½½">ä½¿ç”¨asyncioæ¨¡å—ä¸‹è½½</h2><figure class="highlight python"><figcaption><span>flags_asyncio.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™æ®µè„šæœ¬ä¸ŽåŽŸæ–‡çš„è„šæœ¬ä»£ç ä¸åŒï¼Œä½¿ç”¨äº†Python3.5å¼•å…¥çš„asyncå’Œawaitå…³é”®å­—</span></span><br><span class="line"><span class="comment"># åŽŸè„šæœ¬ä¸­çš„ä¸€äº›å†™æ³•å¯èƒ½ä¸å†æ˜¯æŽ¨èå†™æ³•äº†ï¼Œæ„¿è„šæœ¬çš„ä»£ç ä¹Ÿä¸è¿›è¡Œåˆ†æžäº†</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> aiohttp  <span class="comment"># å®ƒä¸åœ¨æ ‡å‡†åº“ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flags <span class="keyword">import</span> BASE_URL, save_flag, show, main</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">(client, cc)</span>:</span></span><br><span class="line">    url = <span class="string">'&#123;&#125;/&#123;cc&#125;/&#123;cc&#125;.gif'</span>.format(BASE_URL, cc=cc.lower())</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> client.get(url) <span class="keyword">as</span> resp:</span><br><span class="line">        <span class="keyword">assert</span> resp.status == <span class="number">200</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> resp.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">download_one</span><span class="params">(cc)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> client:</span><br><span class="line">        image = <span class="keyword">await</span> get_flag(client, cc)</span><br><span class="line">        show(cc)</span><br><span class="line">        save_flag(image, cc.lower() + <span class="string">'.gif'</span>)</span><br><span class="line">        <span class="keyword">return</span> cc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list)</span>:</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    to_do = [download_one(cc) <span class="keyword">for</span> cc <span class="keyword">in</span> sorted(cc_list)]</span><br><span class="line">    <span class="comment"># è™½ç„¶å‡½æ•°åæ˜¯waitï¼Œä½†å®ƒä¸æ˜¯é˜»å¡žæ€§å‡½æ•°ã€‚waitæ˜¯ä¸€ä¸ªåç¨‹ï¼Œç­‰ä¼ ç»™å®ƒæ‰€æœ‰åç¨‹è¿è¡Œå®Œæ¯•åŽç»“æŸ</span></span><br><span class="line">    wait_coro = asyncio.wait(to_do)</span><br><span class="line">    <span class="comment"># æ‰§è¡Œäº‹ä»¶å¾ªçŽ¯ï¼Œç›´åˆ°wait_coroè¿è¡Œç»“æŸï¼›äº‹ä»¶å¾ªçŽ¯è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªè„šæœ¬ä¼šåœ¨è¿™é‡Œé˜»å¡ž</span></span><br><span class="line">    res, _ = loop.run_until_complete(wait_coro)</span><br><span class="line">    loop.close()  <span class="comment"># å…³é—­äº‹ä»¶å¾ªçŽ¯</span></span><br><span class="line">    <span class="keyword">return</span> len(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main(download_many)</span><br></pre></td></tr></table></figure><p>ä¸¥æ ¼æ¥è¯´ï¼Œæˆ‘ä»¬ç›®å‰æµ‹è¯•çš„å¹¶å‘è„šæœ¬éƒ½ä¸èƒ½å¹¶è¡Œä¸‹è½½ã€‚ä½¿ç”¨concurrent.futuresåº“å®žçŽ°çš„é‚£ä¸¤ä¸ªç¤ºä¾‹å—GILï¼ˆGlobal Interpreter Lockï¼Œå…¨å±€è§£é‡Šå™¨é”ï¼‰çš„é™åˆ¶ï¼Œè€Œä½¿ç”¨asyncioåº“å®žçŽ°çš„è„šæœ¬åœ¨å•ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚</p><ul><li>æ—¢ç„¶Pythonçº¿ç¨‹å—GILçš„é™åˆ¶ï¼Œä»»ä½•æ—¶å€™éƒ½åªå…è®¸è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆflags_threadpool.pyè„šæœ¬çš„ä¸‹è½½é€Ÿåº¦æ€Žä¹ˆä¼šæ¯”flags.pyè„šæœ¬å¿«5å€ï¼Ÿè¿™æ˜¯å› ä¸ºGILå‡ ä¹Žå¯¹<strong>I/Oå¯†é›†åž‹</strong>å¤„ç†æ— å®³ã€‚åŽŸå› è§ä¸‹ä¸€èŠ‚é˜»å¡žåž‹I/Oå’ŒGILã€‚</li><li>flags_asyncio.pyè„šæœ¬å’Œflags.pyè„šæœ¬éƒ½åœ¨å•ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œå‰è€…æ€Žä¹ˆä¼šæ¯”åŽè€…å¿«5å€ï¼ŸåŽŸå› è§ä¸‹ä¸‹ä¸€èŠ‚é¿å…é˜»å¡žåž‹è°ƒç”¨ã€‚</li></ul><h1 id="é˜»å¡žåž‹ioå’Œgil">é˜»å¡žåž‹I/Oå’ŒGIL</h1><p>CPythonè§£é‡Šå™¨æœ¬èº«å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤æœ‰å…¨å±€è§£é‡Šå™¨é”ï¼ˆGILï¼‰ï¼Œä¸€æ¬¡åªå…è®¸ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒPythonå­—èŠ‚ç ï¼ˆè¿™æ˜¯CPythonè§£é‡Šå™¨çš„å±€é™ï¼Œä¸ŽPythonè¯­è¨€æœ¬èº«æ— å…³ï¼‰ã€‚å› æ­¤ï¼Œä¸€ä¸ªPythonè¿›ç¨‹é€šå¸¸ä¸èƒ½åŒæ—¶ä½¿ç”¨å¤šä¸ªCPUæ ¸å¿ƒã€‚</p><p>ç¼–å†™Pythonä»£ç æ—¶æ— æ³•æŽ§åˆ¶GILï¼›ä¸è¿‡ï¼Œæ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå†…ç½®çš„å‡½æ•°æˆ–ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„æ‰©å±•é‡Šæ”¾GILã€‚å…¶å®žï¼Œæœ‰ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„Pythonåº“èƒ½ç®¡ç†GILï¼Œè‡ªè¡Œå¯åŠ¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œåˆ©ç”¨å…¨éƒ¨å¯ç”¨çš„CPUæ ¸å¿ƒã€‚è¿™æ ·åšä¼šæžå¤§åœ°å¢žåŠ åº“ä»£ç çš„å¤æ‚åº¦ï¼Œå› æ­¤å¤§å¤šæ•°åº“çš„ä½œè€…éƒ½ä¸è¿™ä¹ˆåšã€‚</p><p>ç„¶è€Œï¼Œ<strong>æ ‡å‡†åº“ä¸­çš„æ‰€æœ‰æ‰§è¡Œé˜»å¡žåž‹I/Oæ“ä½œçš„å‡½æ•°ï¼Œåœ¨ç­‰å¾…æ“ä½œç³»ç»Ÿè¿”å›žç»“æžœæ—¶éƒ½ä¼šé‡Šæ”¾GILã€‚è¿™æ„å‘³ç€åœ¨Pythonè¯­è¨€è¿™ä¸ªå±‚æ¬¡ä¸Šå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œè€ŒI/Oå¯†é›†åž‹Pythonç¨‹åºèƒ½ä»Žä¸­å—ç›Šï¼šä¸€ä¸ªPythonçº¿ç¨‹ç­‰å¾…ç½‘ç»œå“åº”æ—¶ï¼Œé˜»å¡žåž‹I/Oå‡½æ•°ä¼šé‡Šæ”¾GILï¼Œå†è¿è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚</strong></p><p>ä¸‹é¢ç®€å•è¯´æ˜Žå¦‚ä½•åœ¨<strong>CPUå¯†é›†åž‹</strong>ä½œä¸šä¸­ä½¿ç”¨concurrent.futuresæ¨¡å—è½»æ¾ç»•å¼€GILã€‚</p><h1 id="é¿å…é˜»å¡žåž‹è°ƒç”¨">é¿å…é˜»å¡žåž‹è°ƒç”¨</h1><p>ç”¨asyncioåŒ…æ—¶ï¼Œæˆ‘ä»¬ç¼–å†™çš„å¼‚æ­¥ä»£ç ä¸­åŒ…å«ç”±asyncioæœ¬èº«é©±åŠ¨çš„åç¨‹ï¼ˆå³å§”æ´¾ç”Ÿæˆå™¨ï¼‰ï¼Œè€Œç”Ÿæˆå™¨æœ€ç»ˆæŠŠèŒè´£å§”æ‰˜ç»™asyncioåŒ…æˆ–ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚aiohttpï¼‰ä¸­çš„åç¨‹ã€‚è¿™ç§å¤„ç†æ–¹å¼ç›¸å½“äºŽæž¶èµ·äº†ç®¡é“ï¼Œè®©asyncioäº‹ä»¶å¾ªçŽ¯ï¼ˆé€šè¿‡æˆ‘ä»¬ç¼–å†™çš„åç¨‹ï¼‰é©±åŠ¨æ‰§è¡Œä½Žå±‚å¼‚æ­¥I/Oæ“ä½œçš„åº“å‡½æ•°ã€‚</p><p>æœ‰ä¸¤ç§æ–¹æ³•èƒ½é¿å…é˜»å¡žåž‹è°ƒç”¨ä¸­æ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºçš„è¿›ç¨‹ï¼š</p><ul><li>åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œå„ä¸ªé˜»å¡žåž‹æ“ä½œ</li><li>æŠŠæ¯ä¸ªé˜»å¡žåž‹æ“ä½œè½¬æ¢æˆéžé˜»å¡žçš„å¼‚æ­¥è°ƒç”¨ä½¿ç”¨</li></ul><p>å¤šä¸ªçº¿ç¨‹æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å„ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼ˆPythonä½¿ç”¨çš„æ˜¯è¿™ç§çº¿ç¨‹ï¼‰æ¶ˆè€—çš„å†…å­˜è¾¾å…†å­—èŠ‚ï¼ˆå…·ä½“çš„é‡å–å†³äºŽæ“ä½œç³»ç»Ÿç§ç±»ï¼‰ã€‚å¦‚æžœè¦å¤„ç†å‡ åƒä¸ªè¿žæŽ¥ï¼Œè€Œæ¯ä¸ªè¿žæŽ¥éƒ½ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹çš„è¯ï¼Œæˆ‘ä»¬è´Ÿæ‹…ä¸èµ·ã€‚</p><p>ä¸ºäº†é™ä½Žå†…å­˜çš„æ¶ˆè€—ï¼Œé€šå¸¸ä½¿ç”¨å›žè°ƒæ¥å®žçŽ°å¼‚æ­¥è°ƒç”¨ã€‚ä½¿ç”¨å›žè°ƒæ—¶ï¼Œæˆ‘ä»¬ä¸ç­‰å¾…å“åº”ï¼Œè€Œæ˜¯æ³¨å†Œä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‘ç”ŸæŸä»¶äº‹æ—¶è°ƒç”¨ã€‚è¿™æ ·ï¼Œæ‰€æœ‰è°ƒç”¨éƒ½æ˜¯éžé˜»å¡žçš„ã€‚å› ä¸ºå›žè°ƒç®€å•ï¼Œè€Œä¸”æ¶ˆè€—ä½Žï¼Œæ‰€ä»¥Ryan Dahlï¼ˆNode.jsçš„å‘æ˜Žè€…ï¼‰ç”¨æˆ·è¿™ç§æ–¹å¼ã€‚</p><p>å½“ç„¶ï¼Œåªæœ‰å¼‚æ­¥åº”ç”¨ç¨‹åºåº•å±‚çš„äº‹ä»¶å¾ªçŽ¯èƒ½ä¾é å„ç§åŸºç¡€è®¾ç½®çš„ä¸­æ–­ã€çº¿ç¨‹ã€è½®è¯¢å’ŒåŽå°è¿›ç¨‹ç­‰ï¼Œç¡®ä¿å¤šä¸ªå¹¶å‘è¯·æ±‚èƒ½å–å¾—è¿›å±•å¹¶æœ€ç»ˆå®Œæˆï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨å›žè°ƒã€‚äº‹ä»¶å¾ªçŽ¯èŽ·å¾—å“åº”åŽï¼Œä¼šå›žè¿‡å¤´æ¥è°ƒç”¨æˆ‘ä»¬æŒ‡å®šçš„å›žè°ƒã€‚ä¸è¿‡ï¼Œå¦‚æžœåšæ³•æ­£ç¡®ï¼Œäº‹ä»¶å¾ªçŽ¯å’Œåº”ç”¨ä»£ç å…±ç”¨çš„ä¸»çº¿ç¨‹ç»ä¸ä¼šé˜»å¡žã€‚</p><p>æŠŠç”Ÿæˆå™¨å½“ä½œåç¨‹ä½¿ç”¨æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„å¦ä¸€ç§æ–¹å¼ã€‚å¯¹äº‹ä»¶å¾ªçŽ¯æ¥è¯´ï¼Œè°ƒç”¨å›žè°ƒä¸Žåœ¨æš‚åœçš„åç¨‹ä¸Šè°ƒç”¨sendæ–¹æ³•æ•ˆæžœå·®ä¸å¤šã€‚å„ä¸ªæš‚åœçš„åç¨‹æ˜¯è¦æ¶ˆè€—å†…å­˜ï¼Œä½†æ˜¯æ¯”çº¿ç¨‹æ¶ˆè€—çš„å†…å­˜æ•°é‡çº§å°ã€‚è€Œä¸”ï¼Œåç¨‹èƒ½é¿å…å¯æ€•çš„â€œå›žè°ƒåœ°ç‹±â€ã€‚</p><p>flags.pyè„šæœ¬ä¾åºä¸‹è½½ï¼Œè€Œæ¯æ¬¡ä¸‹è½½éƒ½è¦ç”¨å‡ åäº¿ä¸ªCPUå‘¨æœŸç­‰å¾…å³è¿‡ã€‚å…¶å®žï¼ŒCPUåŒæ—¶åšäº†å¾ˆå¤šäº‹ï¼Œåªæ˜¯æ²¡æœ‰è¿è¡Œä½ çš„ç¨‹åºã€‚ä¸Žæ­¤ç›¸æ¯”ï¼Œåœ¨flags_asyncio.pyè„šæœ¬ä¸­ï¼Œåœ¨download_manyå‡½æ•°ä¸­è°ƒç”¨loop.run_until_completeæ–¹æ³•æ—¶ï¼Œäº‹ä»¶å¾ªçŽ¯é©±åŠ¨å„ä¸ªdownload_oneåç¨‹ï¼Œå„ä¸ªdownload_oneåç¨‹ä¸­åˆé©±åŠ¨å„ä¸ªget_flagåç¨‹ï¼Œè¿è¡Œåˆ°client.get(url)ã€‚è¿™äº›è°ƒç”¨éƒ½ä¸ä¼šé˜»å¡žï¼Œå› æ­¤åœ¨é›¶ç‚¹å‡ ç§’å†…æ‰€æœ‰è¯·æ±‚å…¨éƒ¨å¼€å§‹ã€‚</p><p>asyncioçš„åŸºç¡€è®¾æ–½èŽ·å¾—ç¬¬ä¸€ä¸ªå“åº”åŽï¼Œäº‹ä»¶å¾ªçŽ¯æŠŠå“åº”å‘ç»™ç­‰å¾…ç»“æžœçš„get_flagåç¨‹ã€‚å¾—åˆ°å“åº”åŽï¼Œget_flagå‘å‰æ‰§è¡Œï¼Œè°ƒç”¨resp.readæ–¹æ³•ï¼Œç„¶åŽæŠŠæŽ§åˆ¶æƒè¿˜ç»™ä¸»å¾ªçŽ¯ã€‚ï¼ˆæˆ‘ä¸ç¡®å®šè¿™æ®µæè¿°æ˜¯å¦ç¬¦åˆ<code>return await resp.read()</code>çš„è¿è¡Œè¿‡ç¨‹ï¼›ä½œä¸ºå‚è€ƒï¼ŒåŽŸè„šæœ¬çš„ä»£ç æ˜¯<code>return yield from resp.read()</code>ï¼‰</p><p>å› ä¸ºå¼‚æ­¥æ“ä½œæ˜¯äº¤å‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¹¶å‘ä¸‹è½½å¤šå¼ å›¾åƒæ‰€éœ€çš„æ€»æ—¶é—´æ¯”ä¾åºä¸‹è½½å°‘å¾—å¤šã€‚</p><h1 id="ä½¿ç”¨concurrent.futuresæ¨¡å—å¯åŠ¨è¿›ç¨‹">ä½¿ç”¨concurrent.futuresæ¨¡å—å¯åŠ¨è¿›ç¨‹</h1><p>concurrent.futuresæ¨¡å—çš„æ–‡æ¡£å‰¯æ ‡é¢˜æ˜¯â€œLaunching parallel tasksâ€ï¼ˆæ‰§è¡Œå¹¶è¡Œä»»åŠ¡ï¼‰ã€‚è¿™ä¸ªæ¨¡å—å®žçŽ°çš„æ˜¯çœŸæ­£çš„å¹¶è¡Œè®¡ç®—ï¼Œå› ä¸ºå®ƒä½¿ç”¨ProcessPoolExecutorç±»æŠŠå·¥ä½œåˆ†é…ç»™å¤šä¸ªPythonè¿›ç¨‹å¤„ç†ã€‚å› æ­¤ï¼Œå¦‚æžœéœ€è¦åšCPUå¯†é›†åž‹å¤„ç†ï¼Œä½¿ç”¨è¿™ä¸ªæ¨¡å—èƒ½ç»•å¼€GILï¼Œåˆ©ç”¨æ‰€æœ‰å¯ç”¨CPUæ ¸å¿ƒã€‚</p><p><a href="https://devdocs.io/python~3.6/library/concurrent.futures#concurrent.futures.ProcessPoolExecutor" target="_blank" rel="noopener">ProcessPoolExecutor</a>å’Œ<a href="https://devdocs.io/python~3.6/library/concurrent.futures#concurrent.futures.ThreadPoolExecutor" target="_blank" rel="noopener">ThreadPoolExecutor</a>ç±»éƒ½å®žçŽ°äº†é€šç”¨çš„ExecutoræŽ¥å£ï¼Œå› æ­¤ä½¿ç”¨concurrent.futuresæ¨¡å—èƒ½ç‰¹åˆ«è½»æ¾åœ°æŠŠåŸºäºŽçº¿ç¨‹çš„æ–¹æ¡ˆè½¬æˆåŸºäºŽè¿›ç¨‹çš„æ–¹æ¡ˆã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list)</span>:</span></span><br><span class="line">    workers = min(MAX_WORKERS, len(cc_list))</span><br><span class="line">    <span class="keyword">with</span> futures.ThreadPoolExecutor(workers) <span class="keyword">as</span> executor:  <span class="comment"># åŸºäºŽçº¿ç¨‹</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> futures.ProcessPoolExecutor() <span class="keyword">as</span> executor:  <span class="comment"># åŸºäºŽè¿›ç¨‹</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><p><code>ThreadPoolExecutor.__init__</code>æ–¹æ³•éœ€è¦<code>max_workers</code>å‚æ•°ï¼ŒæŒ‡å®šçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡ã€‚åœ¨ProcessPoolExecutorç±»ä¸­ï¼Œé‚£ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œè€Œä¸”å¤§å¤šæ•°æƒ…å†µä¸‹ä¸å®žç”¨â€”â€”é»˜è®¤å€¼æ˜¯<code>os.cpu_count()</code>å‡½æ•°è¿”å›žçš„CPUæ•°é‡ã€‚è¿™æ ·å¤„ç†è¯´å¾—é€šï¼Œå› ä¸ºå¯¹äºŽCPUå¯†é›†åž‹çš„å¤„ç†æ¥è¯´ï¼Œä¸å¯èƒ½è¦æ±‚ä½¿ç”¨è¶…è¿‡CPUæ•°é‡çš„workersã€‚è€Œå¯¹I/Oå¯†é›†åž‹å¤„ç†æ¥è¯´ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªThreadPoolExecutorå®žä¾‹ä¸­ä½¿ç”¨10ä¸ªã€100ä¸ªæˆ–1000ä¸ªçº¿ç¨‹ï¼›æœ€ä½³çº¿ç¨‹æ•°å–å†³äºŽåšçš„æ˜¯ä»€ä¹ˆäº‹ï¼Œä»¥åŠå¯ç”¨å†…å­˜æœ‰å¤šå°‘ï¼Œå› æ­¤è¦ä»”ç»†æµ‹è¯•æ‰èƒ½æ‰¾åˆ°æœ€ä½³çš„çº¿ç¨‹æ•°ã€‚</p><h1 id="å®žéªŒexecutor.mapæ–¹æ³•">å®žéªŒExecutor.mapæ–¹æ³•</h1><p>è‹¥æƒ³å¹¶å‘è¿è¡Œå¤šä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ç¤ºä¾‹ä¸­è§è¿‡çš„Executor.mapæ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, strftime</span><br><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span><span class="params">(*args)</span>:</span>  <span class="comment"># æ‰“å°ä¼ å…¥çš„å‚æ•°å¹¶åœ¨å‰åŠ ä¸€ä¸ªæ—¶é—´æˆ³</span></span><br><span class="line">    print(strftime(<span class="string">'[%H:%M:%S]'</span>), end=<span class="string">' '</span>)</span><br><span class="line">    print(*args)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loiter</span><span class="params">(n)</span>:</span></span><br><span class="line">    msg = <span class="string">'&#123;&#125;loiter(&#123;&#125;): doing nothing for &#123;&#125;s...'</span></span><br><span class="line">    display(msg.format(<span class="string">'\t'</span>*n, n, n))</span><br><span class="line">    sleep(n)</span><br><span class="line">    msg = <span class="string">'&#123;&#125;loiter(&#123;&#125;): done.'</span></span><br><span class="line">    display(msg.format(<span class="string">'\t'</span>*n, n))</span><br><span class="line">    <span class="keyword">return</span> n * <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    display(<span class="string">'Script starting.'</span>)</span><br><span class="line">    executor = futures.ThreadPoolExecutor(max_workers=<span class="number">3</span>)</span><br><span class="line">    results = executor.map(loiter, range(<span class="number">5</span>))</span><br><span class="line">    display(<span class="string">'results:'</span>, results)  <span class="comment"># è¿”å›žçš„æ˜¯ç”Ÿæˆå™¨ï¼Œç›®å‰ä¸ä¼šé˜»å¡ž</span></span><br><span class="line">    display(<span class="string">'Waiting for individual results:'</span>)</span><br><span class="line">    <span class="keyword">for</span> i, result <span class="keyword">in</span> enumerate(results):</span><br><span class="line">        display(<span class="string">'result &#123;&#125;: &#123;&#125;'</span>.format(i, result))</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python demo_executor_map.py</span><br><span class="line">[21:31:07] Script starting.</span><br><span class="line">[21:31:07] loiter(0): doing nothing for 0s...</span><br><span class="line">[21:31:07] loiter(0): done.</span><br><span class="line">[21:31:07]     loiter(1): doing nothing for 1s...</span><br><span class="line">[21:31:07]         loiter(2): doing nothing for 2s...</span><br><span class="line">[21:31:07] results: &lt;generator object Executor.map.&lt;locals&gt;.result_iterator at 0x10cd970f8&gt;</span><br><span class="line">[21:31:07] Waiting for individual results:</span><br><span class="line">[21:31:07] result 0: 0  # loiter(0)è¿è¡Œç»“æŸäº†ï¼Œç¬¬ä¸€ä¸ªworkerå°±å¯ä»¥å¯åŠ¨ç¬¬å››ä¸ªçº¿ç¨‹ï¼Œè¿è¡Œloiter(3)</span><br><span class="line">[21:31:07]             loiter(3): doing nothing for 3s...</span><br><span class="line">[21:31:08]     loiter(1): done.</span><br><span class="line">[21:31:08]                 loiter(4): doing nothing for 4s...</span><br><span class="line">[21:31:08] result 1: 10</span><br><span class="line">[21:31:09]         loiter(2): done.</span><br><span class="line">[21:31:09] result 2: 20</span><br><span class="line">[21:31:10]             loiter(3): done.</span><br><span class="line">[21:31:10] result 3: 30</span><br><span class="line">[21:31:12]                 loiter(4): done.</span><br><span class="line">[21:31:12] result 4: 40</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œloiter(0)ï¼Œå› æ­¤ä¼šä¼‘çœ 0ç§’ï¼Œç”šè‡³ä¼šåœ¨ç¬¬äºŒä¸ªçº¿ç¨‹å¼€å§‹ä¹‹å‰å°±ç»“æŸï¼Œä¸è¿‡å…·ä½“æƒ…å†µå› äººè€Œå¼‚ï¼šå¯¹çº¿ç¨‹æ¥è¯´ï¼Œä½ æ°¸è¿œä¸çŸ¥é“æŸä¸€æ—¶åˆ»äº‹ä»¶çš„å…·ä½“æŽ’åºï¼›æœ‰å¯èƒ½åœ¨å¦ä¸€å°è®¾å¤‡ä¸­ä¼šçœ‹åˆ°loiter(1)åœ¨loiter(0)ç»“æŸä¹‹å‰å¼€å§‹ï¼Œè¿™æ˜¯å› ä¸ºsleepå‡½æ•°æ€»ä¼šé‡Šæ”¾GILã€‚å› æ­¤ï¼Œå³ä¾¿ä¼‘çœ 0ç§’ï¼ŒPythonä¹Ÿå¯èƒ½ä¼šåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</p><p><strong>Executor.mapå‡½æ•°æ˜“äºŽä½¿ç”¨ï¼Œä¸è¿‡æœ‰ä¸ªç‰¹æ€§å¯èƒ½æœ‰ç”¨ï¼Œä¹Ÿå¯èƒ½æ²¡ç”¨ï¼Œå…·ä½“æƒ…å†µå–å†³äºŽéœ€æ±‚ï¼šè¿™ä¸ªå‡½æ•°è¿”å›žç»“æžœçš„é¡ºåºä¸Žè°ƒç”¨å¼€å§‹çš„é¡ºåºä¸€è‡´ã€‚å¦‚æžœç¬¬ä¸€ä¸ªè°ƒç”¨ç”Ÿæˆç»“æžœç”¨æ—¶10ç§’ï¼Œè€Œå…¶ä»–è°ƒç”¨åªç”¨1ç§’ï¼Œä»£ç ä¼šé˜»å¡ž10ç§’ï¼ŒèŽ·å–mapæ–¹æ³•è¿”å›žçš„ç”Ÿæˆå™¨äº§å‡ºçš„ç¬¬ä¸€ä¸ªç»“æžœã€‚åœ¨æ­¤ä¹‹åŽï¼ŒèŽ·å–åŽç»­ç»“æžœæ—¶ä¸ä¼šé˜»å¡žï¼Œå› ä¸ºåŽç»­çš„è°ƒç”¨å·²ç»ç»“æŸã€‚å¦‚æžœå¿…é¡»ç­‰åˆ°èŽ·å–æ‰€æœ‰ç»“æžœåŽå†å¤„ç†ï¼Œè¿™ç§è¡Œä¸ºæ²¡é—®é¢˜ï¼›ä¸è¿‡ï¼Œé€šå¸¸æ›´å¯å–çš„æ–¹å¼æ˜¯ï¼Œä¸ç®¡æäº¤çš„é¡ºåºï¼Œåªè¦æœ‰ç»“æžœå°±èŽ·å–ã€‚ä¸ºæ­¤ï¼Œè¦æŠŠExecutor.submitæ–¹æ³•å’Œfutures.as_completedå‡½æ•°ç»“åˆèµ·æ¥ä½¿ç”¨ï¼ˆä¹‹å‰çš„ç¤ºä¾‹ä¸­æ¼”ç¤ºè¿‡å¦‚ä½•ç»„åˆä½¿ç”¨ï¼‰ã€‚</strong></p><p>executor.submitå’Œfutures.as_completedè¿™ä¸ªç»„åˆæ¯”executor.mapæ›´çµæ´»ï¼Œå› ä¸ºsubmitæ–¹æ³•èƒ½å¤„ç†ä¸åŒçš„å¯è°ƒç”¨å¯¹è±¡å’Œå‚æ•°ï¼Œè€Œexecutor.mapåªèƒ½å¤„ç†å‚æ•°ä¸åŒçš„åŒä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ã€‚æ­¤å¤–ï¼Œä¼ ç»™futures.as_completedå‡½æ•°çš„æœŸç‰©é›†åˆå¯ä»¥æ¥è‡ªExecutorå®žä¾‹ï¼Œä¾‹å¦‚ä¸€äº›ç”±ThreadPoolExecutorå®žä¾‹åˆ›å»ºï¼Œå¦ä¸€äº›ç”±ProcessPoolExecutorå®žä¾‹åˆ›å»ºã€‚</p><h1 id="æ˜¾ç¤ºä¸‹è½½è¿›åº¦å¹¶å¤„ç†é”™è¯¯èŠ‚é€‰">æ˜¾ç¤ºä¸‹è½½è¿›åº¦å¹¶å¤„ç†é”™è¯¯ï¼ˆèŠ‚é€‰ï¼‰</h1><h2 id="ä¾åºä¸‹è½½">ä¾åºä¸‹è½½</h2><p>åœ¨download_oneå‡½æ•°ä¸­å¤„ç†HTTP 404é”™è¯¯ï¼Œå…¶ä»–å¼‚å¸¸åˆ™å‘ä¸Šå†’æ³¡ï¼Œäº¤ç»™download_manyå‡½æ•°å¤„ç†ã€‚</p><figure class="highlight python"><figcaption><span>flags2_sequential.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">(base_url, cc)</span>:</span></span><br><span class="line">    url = <span class="string">'&#123;&#125;/&#123;cc&#125;/&#123;cc&#125;.gif'</span>.format(base_url, cc=cc.lower())</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">200</span>:</span><br><span class="line">        resp.raise_for_status()  <span class="comment"># çŠ¶æ€ç ä¸æ˜¯200æ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">return</span> resp.content</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_one</span><span class="params">(cc, base_url, verbose=False)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        image = get_flag(base_url, cc)</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.HTTPError <span class="keyword">as</span> exc:  <span class="comment"># æ•èŽ·å¼‚å¸¸</span></span><br><span class="line">        res = exc.response</span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">404</span>:  <span class="comment"># å•ç‹¬å¤„ç†404å¼‚å¸¸</span></span><br><span class="line">            status = HTTPStatus.not_found  <span class="comment"># HTTPStatusæ˜¯è‡ªå®šä¹‰çš„Enumå¯¹è±¡</span></span><br><span class="line">            msg = <span class="string">'not found'</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># æŠ›å‡ºå…¶ä»–å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># æ²¡æœ‰å¼‚å¸¸æ—¶</span></span><br><span class="line">        save_flag(image, cc.lower() + <span class="string">'.gif'</span>)</span><br><span class="line">        status = HTTPStatus.ok</span><br><span class="line">        msg = <span class="string">'OK'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> verbose:  <span class="comment"># æ˜¯å¦æ˜¾ç¤ºæ¶ˆæ¯</span></span><br><span class="line">        print(cc, msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result(status, cc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list, base_url, verbose, max_req)</span>:</span></span><br><span class="line">    counter = collections.Counter()  <span class="comment"># è®¡æ•°</span></span><br><span class="line">    cc_iter = sorted(cc_list)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> verbose:  <span class="comment"># æ˜¯å¦æ˜¾ç¤ºè¿›åº¦æ¡</span></span><br><span class="line">        <span class="comment"># æŠŠcc_iterä¼ ç»™tqdmå‡½æ•°ï¼Œè¿”å›žä¸€ä¸ªè¿­ä»£å™¨ï¼Œäº§å‡ºcc_iterä¸­çš„å…ƒç´ ï¼Œè¿˜ä¼šæ˜¾ç¤ºè¿›åº¦æ¡åŠ¨ç”»</span></span><br><span class="line">        cc_iter = tqdm.tqdm(cc_iter)</span><br><span class="line">    <span class="keyword">for</span> cc <span class="keyword">in</span> cc_iter:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = download_one(cc, base_url, verbose)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.HTTPError <span class="keyword">as</span> exc:  <span class="comment"># ä¸ŽHTTPæœ‰å…³ä¸”download_oneä¸­æ²¡å¤„ç†çš„å¼‚å¸¸</span></span><br><span class="line">            error_msg = <span class="string">'HTTP error &#123;res.status_code&#125; - &#123;res.reasion&#125;'</span></span><br><span class="line">            error_msg = errormsg.format(res=exc.response)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> exc:  <span class="comment"># ä¸Žç½‘ç»œæœ‰å…³çš„å¼‚å¸¸</span></span><br><span class="line">            error_msg = <span class="string">'Connection error'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = <span class="string">''</span></span><br><span class="line">            status = res.status</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> error_msg:</span><br><span class="line">            status = HTTPStatus.error</span><br><span class="line">        counter[status] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> verbose <span class="keyword">and</span> error_msg:</span><br><span class="line">            print(<span class="string">'*** Error for &#123;&#125;: &#123;&#125;'</span>.format(cc, error_msg))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨futures.as_completedå‡½æ•°">ä½¿ç”¨futures.as_completedå‡½æ•°</h2><p>ä¸ºäº†é›†æˆTQDMè¿›åº¦æ¡ï¼Œå¹¶å¤„ç†å„æ¬¡è¯·æ±‚ä¸­çš„é”™è¯¯ï¼Œflags2_threadpool.pyè„šæœ¬ç”¨åˆ°futures.ThreadPoolExecutorç±»å’Œfutures.as_completedå‡½æ•°ã€‚</p><figure class="highlight python"><figcaption><span>flags2_threadpool.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_many</span><span class="params">(cc_list, base_url, verbose, concur_req)</span>:</span></span><br><span class="line">    counter = collections.Counter()</span><br><span class="line">    <span class="keyword">with</span> futures.ThreadPoolExecutor(max_workers=concur_req) <span class="keyword">as</span> executor:</span><br><span class="line">        to_do_map = &#123;&#125;  <span class="comment"># æŠŠå„ä¸ªFutureå®žä¾‹ï¼ˆè¡¨ç¤ºä¸€æ¬¡ä¸‹è½½ï¼‰æ˜ å°„åˆ°ç›¸åº”çš„å›½å®¶ä»£ç </span></span><br><span class="line">        <span class="keyword">for</span> cc <span class="keyword">in</span> sorted(cc_list):</span><br><span class="line">            future = executor.submit(download_one, cc, base_url, verbose)  <span class="comment"># æŽ’å®šæ‰§è¡Œæ—¶é—´</span></span><br><span class="line">            to_do_map[future] = cc</span><br><span class="line">        done_iter = futures.as_completed(to_do_map)  <span class="comment"># è¿”å›žä¸€ä¸ªè¿­ä»£å™¨ï¼Œåœ¨æœŸç‰©è¿è¡Œç»“æŸåŽäº§å‡ºæœŸç‰©</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> verbose:</span><br><span class="line">            <span class="comment"># done_iteræ²¡æœ‰__len__æ–¹æ³•ï¼Œå¿…é¡»é€šè¿‡totalå‚æ•°å‘Šè¯‰tqdmå‡½æ•°é¢„æœŸçš„å…ƒç´ æ•°é‡</span></span><br><span class="line">            done_iter = tqdm.tqdm(done_iter, total=len(cc_list))</span><br><span class="line">        <span class="keyword">for</span> future <span class="keyword">in</span> done_iter:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                res = future.result()  <span class="comment"># ä¸ä¼šé˜»å¡žï¼Œå› ä¸ºas_completedå‡½æ•°åªè¿”å›žå·²ç»è¿è¡Œç»“æŸçš„æœŸç‰©</span></span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.HTTPError <span class="keyword">as</span> exc:</span><br><span class="line">                error_msg = <span class="string">'HTTP &#123;res.status_code&#125; - &#123;res.reason&#125;'</span></span><br><span class="line">                error_msg = error_msg.format(res=exc.response)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">                error_msg = <span class="string">'Connection error'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error_msg = <span class="string">''</span></span><br><span class="line">                status = res.status</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> error_msg:</span><br><span class="line">                status = HTTPStatus.error</span><br><span class="line">            counter[status] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> verbose <span class="keyword">and</span> error_msg:</span><br><span class="line">                cc = to_do_map[future]</span><br><span class="line">                print(<span class="string">'*** Error for &#123;&#125;: &#123;&#125;'</span>.format(cc, error_msg))</span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> concurrency </tag>
            
            <tag> futures </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨åç¨‹åšç¦»æ•£äº‹ä»¶ä»¿çœŸ</title>
      <link href="/notes/fluent-python/coroutines-for-discrete-event-simulation/"/>
      <url>/notes/fluent-python/coroutines-for-discrete-event-simulation/</url>
      
        <content type="html"><![CDATA[<p>åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œä»¿çœŸæ˜¯åç¨‹çš„ç»å…¸åº”ç”¨ã€‚</p><p>åç¨‹æ˜¯asyncioåŒ…çš„åŸºç¡€æž„å»ºã€‚é€šè¿‡ä»¿çœŸç³»ç»Ÿèƒ½è¯´æ˜Žå¦‚ä½•ä½¿ç”¨åç¨‹ä»£æ›¿çº¿ç¨‹å®žçŽ°å¹¶å‘çš„æ´»åŠ¨ã€‚</p><h1 id="ç¦»æ•£äº‹ä»¶ä»¿çœŸç®€ä»‹">ç¦»æ•£äº‹ä»¶ä»¿çœŸç®€ä»‹</h1><p>ç¦»æ•£äº‹ä»¶ä»¿çœŸï¼ˆDiscrete Event Simulationï¼ŒDESï¼‰æ˜¯ä¸€ç§æŠŠç³»ç»Ÿå»ºæ¨¡æˆä¸€ç³»åˆ—äº‹ä»¶çš„ä»¿çœŸç±»åž‹ã€‚åœ¨ç¦»æ•£äº‹ä»¶ä»¿çœŸä¸­ï¼Œä»¿çœŸâ€œé’Ÿâ€å‘å‰æŽ¨è¿›çš„é‡ä¸æ˜¯å›ºå®šçš„ï¼Œè€Œæ˜¯ç›´æŽ¥æŽ¨è¿›åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶æ¨¡åž‹çš„æ¨¡æ‹Ÿæ—¶é—´ã€‚åŠ å…¥æˆ‘ä»¬æŠ½è±¡æ¨¡æ‹Ÿå‡ºç§Ÿè½¦çš„è¿è¥è¿‡ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªäº‹ä»¶æ˜¯ä¹˜å®¢ä¸Šè½¦ï¼Œä¸‹ä¸€ä¸ªäº‹ä»¶åˆ™æ˜¯ä¹˜å®¢ä¸‹è½¦ã€‚ä¸ç®¡ä¹˜å®¢åäº†5åˆ†é’Ÿè¿˜æ˜¯50åˆ†é’Ÿï¼Œä¸€æ—¦ä¹˜å®¢ä¸‹è½¦ï¼Œä»¿çœŸé’Ÿå°±ä¼šæ›´æ–°ï¼ŒæŒ‡å‘æ­¤æ¬¡è¿è¥çš„ç»“æŸæ—¶é—´ã€‚ä½¿ç”¨ç¦»æ•£äº‹ä»¶ä»¿çœŸå¯ä»¥åœ¨ä¸åˆ°ä¸€ç§’é’Ÿçš„äº‹ä»¶æ¨¡æ‹Ÿä¸€å¹´çš„å‡ºç§Ÿè½¦è¿è¥è¿‡ç¨‹ã€‚è¿™ä¸Žè¿žç»­ä»¿çœŸä¸åŒï¼Œè¿žç»­ä»¿çœŸçš„ä»¿çœŸé’Ÿä»¥å›ºå®šçš„é‡ï¼ˆé€šå¸¸å¾ˆå°ï¼‰ä¸æ–­å‘å‰æŽ¨è¿›ã€‚</p><p>æ˜¾ç„¶ï¼Œå›žåˆåˆ¶æ¸¸æˆå°±æ˜¯ç¦»æ•£äº‹ä»¶ä»¿çœŸçš„ä¾‹å­ï¼šæ¸¸æˆçš„çŠ¶æ€åªåœ¨çŽ©å®¶æ“ä½œæ—¶å˜åŒ–ï¼Œè€Œä¸”ä¸€æ—¦çŽ©å®¶å†³å®šä¸‹ä¸€æ­¥æ€Žä¹ˆèµ°äº†ï¼Œä»¿çœŸé’Ÿå°±ä¼šå†»ç»“ã€‚è€Œå®žæ—¶æ¸¸æˆåˆ™æ˜¯è¿žç»­ä»¿çœŸï¼Œä»¿çœŸé’Ÿä¸€ç›´åœ¨è¿è¡Œï¼Œæ¸¸æˆçš„çŠ¶æ€åœ¨ä¸€ç§’é’Ÿä¹‹å†…æ›´æ–°å¾ˆå¤šæ¬¡ï¼Œå› æ­¤ååº”æ…¢çš„çŽ©å®¶ç‰¹åˆ«åƒäºã€‚</p><p>è¿™ä¸¤ç§ä»¿çœŸç±»åž‹éƒ½èƒ½ä½¿ç”¨å¤šçº¿ç¨‹æˆ–åœ¨å•ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨é¢å‘äº‹ä»¶çš„ç¼–ç¨‹æŠ€æœ¯å®žçŽ°ã€‚å¯ä»¥è¯´ï¼Œä¸ºäº†å®žçŽ°è¿žç»­ä»¿çœŸï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¤„ç†å®žæ—¶å¹¶è¡Œçš„æ“ä½œæ›´è‡ªç„¶ã€‚è€Œåç¨‹æ°å¥½ä¸ºå®žçŽ°ç¦»æ•£äº‹ä»¶ä»¿çœŸæä¾›äº†åˆç†çš„æŠ½è±¡ã€‚SimPyæ˜¯ä¸€ä¸ªå®žçŽ°ç¦»æ•£æ—¶é—´ä»¿çœŸçš„PythonåŒ…ï¼Œé€šè¿‡ä¸€ä¸ªåç¨‹è¡¨ç¤ºç¦»æ•£äº‹ä»¶ä»¿çœŸç³»ç»Ÿä¸­çš„å„ä¸ªè¿›ç¨‹ã€‚</p><p>æœ¬èŠ‚è¯´æ˜Žå¦‚ä½•åªä½¿ç”¨æ ‡å‡†åº“æä¾›çš„åŠŸèƒ½å®žçŽ°ä¸€ä¸ªç‰¹åˆ«ç®€å•çš„ç¦»æ•£äº‹ä»¶ä»¿çœŸç³»ç»Ÿã€‚</p><a id="more"></a><h1 id="å‡ºç§Ÿè½¦é˜Ÿè¿è¥ä»¿çœŸ">å‡ºç§Ÿè½¦é˜Ÿè¿è¥ä»¿çœŸ</h1><figure class="highlight python"><figcaption><span>taxi_sim.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">DEFAULT_NUMBER_OF_TAXIS = <span class="number">3</span>  <span class="comment"># é»˜è®¤å‡ºç§Ÿè½¦æ•°é‡</span></span><br><span class="line">DEFAULT_END_TIME = <span class="number">180</span>       <span class="comment"># é»˜è®¤ä»¿çœŸé’Ÿç»“æŸæ—¶é—´</span></span><br><span class="line">SEARCH_DURATION = <span class="number">5</span>          <span class="comment"># é»˜è®¤ï¼ˆç©ºè½¦ï¼‰å¾˜å¾Šæ—¶é—´</span></span><br><span class="line">TRIP_DURATION = <span class="number">20</span>           <span class="comment"># é»˜è®¤è½½å®¢è¡Œé©¶æ—¶é—´</span></span><br><span class="line">DEPARTURE_INTERVAL = <span class="number">5</span>       <span class="comment"># é»˜è®¤å‡ºåº“é—´éš”æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å±žæ€§åˆ†åˆ«ä¸º å‘ç”Ÿæ—¶é—´, åç¨‹çš„key, äº‹ä»¶çš„åç§°</span></span><br><span class="line">Event = collections.namedtuple(<span class="string">'Event'</span>, <span class="string">'time proc action'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">taxi_process</span><span class="params">(ident, trips, start_time=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""æ¯æ¬¡çŠ¶æ€å˜åŒ–æ—¶å‘ä»¿çœŸç¨‹åºäº§å‡ºä¸€ä¸ªäº‹ä»¶"""</span></span><br><span class="line">    time = <span class="keyword">yield</span> Event(start_time, ident, <span class="string">'leave garage'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(trips):</span><br><span class="line">        time = <span class="keyword">yield</span> Event(time, ident, <span class="string">'pick up passenger'</span>)</span><br><span class="line">        time = <span class="keyword">yield</span> Event(time, ident, <span class="string">'drop off passenger'</span>)</span><br><span class="line">    <span class="keyword">yield</span> Event(time, ident, <span class="string">'going home'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Simulator</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, procs_map)</span>:</span>  <span class="comment"># åˆå§‹åŒ–æ—¶ä¼ å…¥æ‰€æœ‰å‡ºç§Ÿè½¦çš„åç¨‹</span></span><br><span class="line">        self.events = queue.PriorityQueue()</span><br><span class="line">        self.procs = dict(procs_map)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, end_time)</span>:</span></span><br><span class="line">        <span class="string">"""è°ƒåº¦å¹¶æ˜¾ç¤ºäº‹ä»¶ï¼Œç›´åˆ°æ—¶é—´ç»“æŸ"""</span></span><br><span class="line">        <span class="comment"># è°ƒåº¦å„è¾†å‡ºç§Ÿè½¦çš„ç¬¬ä¸€ä¸ªäº‹ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> _, proc <span class="keyword">in</span> sorted(self.procs.items()):</span><br><span class="line">            first_event = next(proc)  <span class="comment"># é¢„æ¿€</span></span><br><span class="line">            self.events.put(first_event)  <span class="comment"># å°†ç¬¬ä¸€ä¸ªäº‹ä»¶æ”¾å…¥events</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ­¤æ¬¡ä»¿çœŸçš„ä¸»å¾ªçŽ¯</span></span><br><span class="line">        sim_time = <span class="number">0</span>  <span class="comment"># ä»¿çœŸé’Ÿ</span></span><br><span class="line">        <span class="keyword">while</span> sim_time &lt; end_time:</span><br><span class="line">            <span class="keyword">if</span> self.events.empty():  <span class="comment"># æ‰€æœ‰äº‹ä»¶éƒ½å·²å®Œæˆï¼Œå³å„å‡ºç§Ÿè½¦å®Œæˆå‡ºåº“ï¼Œå®ŒæˆæŒ‡å®šæ•°ç›®çš„è¡Œç¨‹ï¼Œå…¥åº“</span></span><br><span class="line">                print(<span class="string">'*** end of events ***'</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            current_event = self.events.get()  <span class="comment"># èŽ·å¾—æœ€æ—©å‘ç”Ÿçš„äº‹ä»¶</span></span><br><span class="line">            sim_time, proc_id, previous_action = current_event  <span class="comment"># æ‹†åŒ…</span></span><br><span class="line">            print(<span class="string">'taxi:'</span>, proc_id, proc_id * <span class="string">'    '</span>, current_event)  <span class="comment"># æ‰“å°äº‹ä»¶å†…å®¹</span></span><br><span class="line">            active_proc = self.procs[proc_id]  <span class="comment"># æ ¹æ®äº‹ä»¶çš„åç¨‹çš„keyå¾—åˆ°äº§å‡ºè¯¥äº‹ä»¶çš„åç¨‹ï¼ˆå‡ºç§Ÿè½¦ï¼‰</span></span><br><span class="line">            next_time = sim_time + compute_duration(previous_action)  <span class="comment"># è®¡ç®—ä¸‹ä¸€ä¸ªäº‹ä»¶çš„äº‹ä»¶</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                next_event = active_proc.send(next_time)  <span class="comment"># å‘é€åˆ°åç¨‹ï¼Œå¹¶å¾—åˆ°åç¨‹å¯èƒ½äº§å‡ºçš„äº‹ä»¶</span></span><br><span class="line">            <span class="keyword">except</span> StopIteration:  <span class="comment"># å¦‚æžœåç¨‹ç»“æŸ</span></span><br><span class="line">                <span class="keyword">del</span> self.procs[proc_id]  <span class="comment"># åˆ é™¤è¯¥åç¨‹</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.events.put(next_event)  <span class="comment"># å¦åˆ™å°†äº§å‡ºçš„äº‹ä»¶åŠ å…¥åˆ°ä¼˜å…ˆé˜Ÿåˆ—ä¸­</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦‚æžœå› ä¸ºè¶…æ—¶è€Œåœæ­¢ï¼Œåˆ™è¾“å‡ºè¿˜æœ‰å¤šå°‘äº‹ä»¶</span></span><br><span class="line">            msg = <span class="string">'*** end of simulation time: &#123;&#125; events pending ***'</span></span><br><span class="line">            print(msg.format(self.events.qsize()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_duration</span><span class="params">(previous_action)</span>:</span></span><br><span class="line">    <span class="string">"""ä½¿ç”¨æŒ‡æ•°åˆ†å¸ƒè®¡ç®—æ“ä½œçš„è€—æ—¶"""</span></span><br><span class="line">    <span class="keyword">if</span> previous_action <span class="keyword">in</span> [<span class="string">'leave garage'</span>, <span class="string">'drop off passenger'</span>]:</span><br><span class="line">        <span class="comment"># æ–°çŠ¶æ€æ˜¯å››å¤„å¾˜å¾Š</span></span><br><span class="line">        interval = SEARCH_DURATION</span><br><span class="line">    <span class="keyword">elif</span> previous_action == <span class="string">'pick up passenger'</span>:</span><br><span class="line">        <span class="comment"># æ–°çŠ¶æ€æ˜¯è¡Œç¨‹å¼€å§‹</span></span><br><span class="line">        interval = TRIP_DURATION</span><br><span class="line">    <span class="keyword">elif</span> previous_action == <span class="string">'going home'</span>:</span><br><span class="line">        interval = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Unknown previous_action: %s'</span> % previous_action)</span><br><span class="line">    <span class="keyword">return</span> int(random.expovariate(<span class="number">1</span>/interval)) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(end_time=DEFAULT_END_TIME, num_taxis=DEFAULT_NUMBER_OF_TAXIS, seed=None)</span>:</span></span><br><span class="line">    <span class="string">"""åˆå§‹åŒ–éšæœºç”Ÿæˆå™¨ï¼Œæž„å»ºè¿‡ç¨‹ï¼Œè¿è¡Œä»¿çœŸç¨‹åº"""</span></span><br><span class="line">    <span class="keyword">if</span> seed <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        random.seed(seed)  <span class="comment"># èŽ·å¾—å¯å¤çŽ°çš„ç»“æžœ</span></span><br><span class="line">    taxis = &#123;i: taxi_process(i, (i+<span class="number">1</span>)*<span class="number">2</span>, i*DEPARTURE_INTERVAL)</span><br><span class="line">             <span class="keyword">for</span> i <span class="keyword">in</span> range(num_taxis)&#125;  <span class="comment"># åç¨‹çš„å­—å…¸ï¼Œæ¯è¾†å‡ºç§Ÿè½¦å¯¹åº”ä¸€ä¸ªåç¨‹</span></span><br><span class="line">    sim = Simulator(taxis)  <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">    sim.run(end_time)  <span class="comment"># è¿è¡Œä»¿çœŸ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Taxi fleet simulator.'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-e'</span>, <span class="string">'--end-time'</span>, type=int, default=DEFAULT_END_TIME,</span><br><span class="line">                        help=<span class="string">'simulation end time; default = %s'</span></span><br><span class="line">                        % DEFAULT_END_TIME)</span><br><span class="line">    parser.add_argument(<span class="string">'-t'</span>, <span class="string">'--taxis'</span>, type=int, default=DEFAULT_NUMBER_OF_TAXIS,</span><br><span class="line">                        help=<span class="string">'number of taxis running; default = %s'</span></span><br><span class="line">                        % DEFAULT_NUMBER_OF_TAXIS)</span><br><span class="line">    parser.add_argument(<span class="string">'-s'</span>, <span class="string">'--seed'</span>, type=int, default=<span class="literal">None</span>,</span><br><span class="line">                        help=<span class="string">'random generator seed (for testing)'</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    main(args.end_time, args.taxis, args.seed)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/fluent-python/sample-run-with-three-taxis.png"></p><p>è¿è¡Œtaxi_sim.pyåˆ›å»º3è¾†è½¦çš„è¾“å‡ºç¤ºä¾‹ã€‚-s 3å‚æ•°è®¾ç½®éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼Œè¿™æ ·åœ¨è°ƒè¯•å’Œæ¼”ç¤ºæ—¶å¯ä»¥é‡å¤è¿è¡Œç¨‹åºï¼Œè¾“å‡ºç›¸åŒçš„ç»“æžœã€‚ä¸åŒé¢œè‰²çš„ç®­å¤´æ˜¯åŽæ¥åŠ ä¸Šçš„ï¼Œè¡¨ç¤ºä¸åŒå‡ºç§Ÿè½¦çš„è¡Œç¨‹ã€‚æœ‰äº†ç®­å¤´ï¼Œèƒ½ç›´è§‚åœ°çœ‹å‡ºå¦‚ä½•ä½¿ç”¨åç¨‹ç®¡ç†å¹¶å‘çš„æ´»åŠ¨ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python taxi_sim.py -s 3 -e 60</span><br><span class="line">taxi: 0  Event(time=0, proc=0, action=&apos;leave garage&apos;)</span><br><span class="line">taxi: 0  Event(time=2, proc=0, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 1      Event(time=5, proc=1, action=&apos;leave garage&apos;)</span><br><span class="line">taxi: 1      Event(time=8, proc=1, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=10, proc=2, action=&apos;leave garage&apos;)</span><br><span class="line">taxi: 2          Event(time=15, proc=2, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=17, proc=2, action=&apos;drop off passenger&apos;)</span><br><span class="line">taxi: 0  Event(time=18, proc=0, action=&apos;drop off passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=18, proc=2, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=25, proc=2, action=&apos;drop off passenger&apos;)</span><br><span class="line">taxi: 1      Event(time=27, proc=1, action=&apos;drop off passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=27, proc=2, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 0  Event(time=28, proc=0, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=40, proc=2, action=&apos;drop off passenger&apos;)</span><br><span class="line">taxi: 2          Event(time=44, proc=2, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 1      Event(time=55, proc=1, action=&apos;pick up passenger&apos;)</span><br><span class="line">taxi: 1      Event(time=59, proc=1, action=&apos;drop off passenger&apos;)</span><br><span class="line">taxi: 0  Event(time=65, proc=0, action=&apos;drop off passenger&apos;)</span><br><span class="line">*** end of simulation time: 3 events pending ***</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> coroutines </tag>
            
            <tag> Fluent Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åç¨‹</title>
      <link href="/notes/fluent-python/coroutines/"/>
      <url>/notes/fluent-python/coroutines/</url>
      
        <content type="html"><![CDATA[<p>å­—å…¸ä¸ºåŠ¨è¯ â€œto yieldâ€ ç»™å‡ºäº†ä¸¤ä¸ªé‡Šä¹‰ï¼šäº§å‡ºå’Œè®©æ­¥ã€‚å¯¹äºŽ Python ç”Ÿæˆå™¨ä¸­çš„ yield æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªå«ä¹‰éƒ½æˆç«‹ã€‚<code>yield item</code> è¿™è¡Œä»£ç ä¼šäº§å‡ºä¸€ä¸ªå€¼ï¼Œæä¾›ç»™ <code>next(...)</code> çš„è°ƒç”¨æ–¹ï¼›æ­¤å¤–ï¼Œè¿˜ä¼šä½œå‡ºè®©æ­¥ï¼Œæš‚åœæ‰§è¡Œç”Ÿæˆå™¨ï¼Œè®©è°ƒç”¨æ–¹ç»§ç»­å·¥ä½œï¼Œç›´åˆ°éœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªå€¼æ—¶å†è°ƒç”¨ <code>next()</code>ã€‚è°ƒç”¨æ–¹ä¼šä»Žç”Ÿæˆå™¨ä¸­æ‹‰å–å€¼ã€‚</p><h1 id="ç”¨ä½œåç¨‹çš„ç”Ÿæˆå™¨çš„åŸºæœ¬è¡Œä¸º">ç”¨ä½œåç¨‹çš„ç”Ÿæˆå™¨çš„åŸºæœ¬è¡Œä¸º</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯èƒ½æ˜¯åç¨‹æœ€ç®€å•çš„ä½¿ç”¨æ¼”ç¤º</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">simple_coroutine</span><span class="params">()</span>:</span>  <span class="comment"># å®šä¹‰ä½“ä¸­æœ‰yieldå…³é”®å­—</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'-&gt; coroutine started'</span>)</span><br><span class="line"><span class="meta">... </span>    x = <span class="keyword">yield</span>  <span class="comment"># yieldåœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'-&gt; coroutine received:'</span>, x)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro = simple_coroutine()  <span class="comment"># ä¸Žåˆ›å»ºç”Ÿæˆå™¨ä¸€æ ·ï¼Œè°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro  <span class="comment"># å¾—åˆ°ç”Ÿæˆå™¨å¯¹è±¡</span></span><br><span class="line">&lt;generator object simple_coroutine at <span class="number">0x101df2888</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(my_coro)  <span class="comment"># é¦–å…ˆè¦è°ƒç”¨next()å‡½æ•°ï¼Œå› ä¸ºç”Ÿæˆå™¨è¿˜æ²¡æœ‰å¯åŠ¨</span></span><br><span class="line">-&gt; coroutine started  # ç”Ÿæˆå™¨å¯åŠ¨ï¼Œåœ¨yieldå¤„æš‚åœ</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro.send(<span class="number">42</span>)  <span class="comment"># å‘é€æ•°æ®</span></span><br><span class="line">-&gt; coroutine received: 42  # åç¨‹æ¢å¤ï¼Œç»§ç»­è¿è¡Œï¼Œæ‰“å°å‡ºå†…å®¹</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration  <span class="comment"># ç”Ÿæˆå™¨è¿è¡Œåˆ°æœ«å°¾ï¼ŒæŠ›å‡ºStopIterationå¼‚å¸¸</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>åç¨‹å¯ä»¥èº«å¤„å››ä¸ªçŠ¶æ€ä¸­çš„ä¸€ä¸ªã€‚å½“å‰çŠ¶æ€å¯ä»¥ä½¿ç”¨ <code>inspect.getgeneratorstate(...)</code> å‡½æ•°ç¡®å®šï¼Œè¯¥å‡½æ•°ä¼šè¿”å›žä¸‹è¿°å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªã€‚</p><p><code>'GEN_CREATED'</code>ï¼šç­‰å¾…å¼€å§‹æ‰§è¡Œã€‚</p><p><code>'GEN_RUNNING'</code>ï¼šè§£é‡Šå™¨æ­£åœ¨æ‰§è¡Œã€‚åªæœ‰åœ¨å¤šçº¿ç¨‹åº”ç”¨ä¸­æ‰èƒ½çœ‹åˆ°è¿™ä¸ªçŠ¶æ€ã€‚æ­¤å¤–ï¼Œç”Ÿæˆå™¨å¯¹è±¡åœ¨è‡ªå·±èº«ä¸Šè°ƒç”¨ getgeneratorstate å‡½æ•°ä¹Ÿè¡Œï¼Œä¸è¿‡è¿™æ ·åšæ²¡ä»€ä¹ˆç”¨ã€‚</p><p><code>'GEN_SUSPENDED'</code>ï¼šåœ¨ yield è¡¨è¾¾å¼å‡ºæš‚åœã€‚</p><p><code>'GEN_CLOSED'</code>ï¼šæ‰§è¡Œç»“æŸã€‚</p><p>å› ä¸º send æ–¹æ³•çš„å‚æ•°ä¼šæˆä¸ºæš‚åœçš„ yield è¡¨è¾¾å¼çš„å€¼ï¼Œæ‰€ä»¥ï¼Œä»…å½“åç¨‹å¤„äºŽæš‚åœçŠ¶æ€æ—¶æ‰èƒ½è°ƒç”¨ send æ–¹æ³•ï¼Œä¾‹å¦‚ <code>my_coro.send(42)</code>ã€‚ä¸è¿‡ï¼Œå¦‚æžœåç¨‹è¿˜æ²¡æ¿€æ´»ï¼ˆå³ï¼ŒçŠ¶æ€æ˜¯ <code>'GEN_CREATED'</code>ï¼‰ï¼Œæƒ…å†µå°±ä¸åŒäº†ã€‚å› æ­¤ï¼Œå§‹ç»ˆè¦è°ƒç”¨ <code>next(my_coro)</code> æ¿€æ´»åç¨‹ï¼›ä¹Ÿå¯ä»¥è°ƒç”¨ <code>my_coro.send(None)</code>ï¼Œæ•ˆæžœä¸€æ ·ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro = simple_coroutine()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro.send(<span class="number">42</span>)  <span class="comment"># åç¨‹æœªæ¿€æ´»</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: canâ€˜t send non-<span class="literal">None</span> value to a just-started generator  <span class="comment"># é”™è¯¯æ¶ˆæ¯æ˜Žç¡®</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(my_coro), my_coro.send(<span class="number">42</span>)  <span class="comment"># å…ˆæ¿€æ´»</span></span><br><span class="line">-&gt; coroutine started</span><br><span class="line">-&gt; coroutine received: 42</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">simple_coro2</span><span class="params">(a)</span>:</span>  <span class="comment"># ä¸¾ä¸ªäº§å‡ºå¤šä¸ªå€¼çš„ä¾‹å­</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'-&gt; Started: a ='</span>, a)</span><br><span class="line"><span class="meta">... </span>    b = <span class="keyword">yield</span> a  <span class="comment"># äº§å‡ºaåŽæš‚åœæ‰§è¡Œ</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'-&gt; Received: b ='</span>, b)</span><br><span class="line"><span class="meta">... </span>    c = <span class="keyword">yield</span> a + b</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'-&gt; Received: c ='</span>, c)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro2 = simple_coro2(<span class="number">14</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> getgeneratorstate</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(my_coro2)</span><br><span class="line"><span class="string">'GEN_CREATED'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(my_coro2)  <span class="comment"># æ¿€æ´»åç¨‹</span></span><br><span class="line">-&gt; Started: a = 14  # è¾“å‡ºçš„å†…å®¹</span><br><span class="line"><span class="number">14</span>  <span class="comment"># äº§å‡ºçš„å†…å®¹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(my_coro2)  <span class="comment"># åœ¨ç¬¬ä¸€ä¸ªyieldè¡¨è¾¾å¼å¤„æš‚åœï¼Œç­‰å¾…è°ƒç”¨è€…ä¸ºbèµ‹å€¼</span></span><br><span class="line"><span class="string">'GEN_SUSPENDED'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro2.send(<span class="number">28</span>)  <span class="comment"># ä¸ºbèµ‹å€¼</span></span><br><span class="line">-&gt; Received: b = 28</span><br><span class="line"><span class="number">42</span>  <span class="comment"># äº§å‡ºa+bï¼Œç„¶åŽåœ¨ç¬¬äºŒä¸ªyieldè¡¨è¾¾å¼å¤„æš‚åœï¼Œç­‰å¾…ä¸ºcèµ‹å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_coro2.send(<span class="number">99</span>)</span><br><span class="line">-&gt; Received: c = 99</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(my_coro2)  <span class="comment"># åç¨‹ç»“æŸ</span></span><br><span class="line"><span class="string">'GEN_CLOSED'</span></span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨åç¨‹è®¡ç®—ç§»åŠ¨å¹³å‡å€¼">ä½¿ç”¨åç¨‹è®¡ç®—ç§»åŠ¨å¹³å‡å€¼</h1><p>åœ¨è®¨è®ºé—­åŒ…æ—¶ï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨ç±»å’Œé«˜é˜¶å‡½æ•°å®žçŽ°äº†è¯¥åŠŸèƒ½ã€‚ä¸‹é¢å±•ç¤ºå¦‚ä½•ä½¿ç”¨åç¨‹å®žçŽ°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    total = <span class="number">0.0</span></span><br><span class="line"><span class="meta">... </span>    count = <span class="number">0</span></span><br><span class="line"><span class="meta">... </span>    average = <span class="literal">None</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># æ— é™å¾ªçŽ¯ï¼Œä»…å½“è°ƒç”¨æ–¹åœ¨åç¨‹ä¸Šè°ƒç”¨.close()æ–¹æ³•ï¼Œæˆ–è€…åç¨‹è¢«åžƒåœ¾å›žæ”¶ç¨‹åºå›žæ”¶æ—¶ï¼Œè¿™ä¸ªåç¨‹æ‰ä¼šç»ˆæ­¢</span></span><br><span class="line"><span class="meta">... </span>        term = <span class="keyword">yield</span> average  <span class="comment"># é¦–æ¬¡ä¼šäº§å‡ºNone</span></span><br><span class="line"><span class="meta">... </span>        total += term  <span class="comment"># ä½¿ç”¨åç¨‹çš„å¥½å¤„æ˜¯ï¼Œtotalå’Œcountå£°æ˜Žä¸ºå±€éƒ¨å˜é‡å³å¯</span></span><br><span class="line"><span class="meta">... </span>        count += <span class="number">1</span>     <span class="comment"># æ— éœ€ä½¿ç”¨å®žä¾‹å±žæ€§æˆ–é—­åŒ…åœ¨å¤šæ¬¡è°ƒç”¨ä¹‹é—´ä¿æŒä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="meta">... </span>        average = total/count</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg = averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="literal">None</span>)  <span class="comment"># ä½¿ç”¨.send(None)æ–¹å¼æ¿€æ´»åç¨‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">10</span>)</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">30</span>)</span><br><span class="line"><span class="number">20.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">5</span>)</span><br><span class="line"><span class="number">15.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.close()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(coro_avg)</span><br><span class="line"><span class="string">'GEN_CLOSED'</span></span><br></pre></td></tr></table></figure><h1 id="é¢„æ¿€åç¨‹çš„è£…é¥°å™¨">é¢„æ¿€åç¨‹çš„è£…é¥°å™¨</h1><p>å¦‚æžœä¸é¢„æ¿€ï¼Œé‚£ä¹ˆåç¨‹æ²¡ä»€ä¹ˆç”¨ã€‚ä¸ºäº†ç®€åŒ–åç¨‹çš„ç”¨æ³•ï¼Œæœ‰æ—¶ä¼šä½¿ç”¨ä¸€ä¸ªé¢„æ¿€è£…é¥°å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">coroutine</span><span class="params">(func)</span>:</span>  <span class="comment"># å®šä¹‰çš„é¢„æ¿€è£…é¥°å™¨</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">"""è£…é¥°å™¨ï¼šå‘å‰ç›´è¡Œåˆ°ç¬¬ä¸€ä¸ªyieldè¡¨è¾¾å¼ï¼Œé¢„æ¿€func"""</span></span><br><span class="line"><span class="meta">... </span>    @wraps(func)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">primer</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line"><span class="meta">... </span>        gen = func(*args, **kwargs)  <span class="comment"># è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line"><span class="meta">... </span>        next(gen)  <span class="comment"># æ¿€æ´»ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> gen  <span class="comment"># è¿”å›žç”Ÿæˆå™¨</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> primer  <span class="comment"># è¿”å›žåŒ…è£…å¥½çš„æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>averager = coroutine(averager)  <span class="comment"># è£…é¥°averagerå‡½æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg = averager()  <span class="comment"># åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(coro_avg)  <span class="comment"># å·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥æŽ¥å—å€¼äº†</span></span><br><span class="line"><span class="string">'GEN_SUSPENDED'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">10</span>)</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">30</span>)</span><br><span class="line"><span class="number">20.0</span></span><br></pre></td></tr></table></figure><p>å¾ˆå¤šæ¡†æž¶éƒ½æä¾›äº†å¤„ç†åç¨‹çš„ç‰¹æ®Šè£…é¥°å™¨ï¼Œä¸è¿‡ä¸æ˜¯æ‰€æœ‰çš„è£…é¥°å™¨éƒ½ç”¨äºŽé¢„æ¿€åç¨‹ï¼Œæœ‰äº›ä¼šæä¾›å…¶ä»–æœåŠ¡ï¼Œä¾‹å¦‚å‹¾å…¥äº‹ä»¶å¾ªçŽ¯ã€‚</p><p>ä½¿ç”¨ yield from å¥æ³•è°ƒç”¨åç¨‹æ—¶ï¼Œä¼šè‡ªåŠ¨é¢„æ¿€ï¼Œå› æ­¤ä¸Žç¤ºä¾‹ä¸­çš„ <code>@coroutine</code> è£…é¥°å™¨ä¸å…¼å®¹ã€‚Python3.4 æ ‡å‡†åº“é‡Œçš„ <code>asyncio.coroutine</code> è£…é¥°å™¨ä¸ä¼šé¢„æ¿€åç¨‹ï¼Œå› æ­¤èƒ½å…¼å®¹ yield from å¥æ³•ã€‚</p><h1 id="ç»ˆæ­¢åç¨‹å’Œå¼‚å¸¸å¤„ç†">ç»ˆæ­¢åç¨‹å’Œå¼‚å¸¸å¤„ç†</h1><p>åç¨‹ä¸­æœªå¤„ç†çš„å¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™ next å‡½æ•°æˆ– send æ–¹æ³•çš„è°ƒç”¨æ–¹ï¼ˆå³è§¦å‘åç¨‹çš„å¯¹è±¡ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg = averager()  <span class="comment"># é¢„æ¿€çš„åç¨‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">40</span>)</span><br><span class="line"><span class="number">40.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">50</span>)</span><br><span class="line"><span class="number">45.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="string">'spam'</span>)  <span class="comment"># å‘é€çš„ä¸æ˜¯æ•°å­—ï¼Œåç¨‹ä¼šå› æ­¤ç»ˆæ­¢</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">7</span>, <span class="keyword">in</span> averager</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> +=: <span class="string">'float'</span> <span class="keyword">and</span> <span class="string">'str'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">60</span>)  <span class="comment"># æ— æ³•é‡æ–°æ¿€æ´»</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹æš—ç¤ºäº†ç»ˆæ­¢åç¨‹çš„ä¸€ç§æ–¹å¼ï¼š<strong>å‘é€æŸä¸ªå“¨ç¬¦å€¼ï¼Œè®©åç¨‹é€€å‡ºã€‚</strong>å†…ç½®çš„ None å’Œ Ellipsis ç­‰å¸¸é‡ç»å¸¸ç”¨ä½œå“¨ç¬¦å€¼ã€‚Ellipsis çš„ä¼˜ç‚¹æ˜¯ï¼Œæ•°æ®æµä¸­ä¸å¤ªå¸¸ç”¨è¿™ä¸ªå€¼ã€‚æˆ‘è¿˜è§è¿‡æœ‰äººæŠŠ StopIteration ç±»ï¼ˆç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯å®žä¾‹ï¼Œä¹Ÿä¸æŠ›å‡ºï¼‰ä½œä¸ºå“¨ç¬¦å€¼ï¼š<code>my_coro.send(StopIteration)</code>ã€‚</p><p>ä»Ž Python2.5 å¼€å§‹ï¼Œå®¢æˆ·ä»£ç å¯ä»¥åœ¨ç”Ÿæˆå™¨å¯¹è±¡ä¸Šè°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼Œæ˜¾å¼åœ°æŠŠå¼‚å¸¸å‘ç»™åç¨‹ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ throw å’Œ closeã€‚</p><p><code>generator.throw(exc_type[, exc_value[, traceback]])</code></p><p>è‡´ä½¿ç”Ÿæˆå™¨åœ¨æš‚åœçš„ yield è¡¨è¾¾å¼å¤„æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ã€‚å¦‚æžœç”Ÿæˆå™¨å¤„ç†äº†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä»£ç ä¼šå‘å‰æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª yield è¡¨è¾¾å¼ï¼Œè€Œäº§å‡ºçš„å€¼ä¼šæˆä¸ºè°ƒç”¨ <code>generator.throw</code> æ–¹æ³•å¾—åˆ°çš„è¿”å›žå€¼ã€‚å¦‚æžœç”Ÿæˆå™¨æ²¡æœ‰å¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ åˆ°è°ƒç”¨æ–¹çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p><p><code>generator.close()</code></p><p>è‡´ä½¿ç”Ÿæˆå™¨åœ¨æš‚åœçš„ yield è¡¨è¾¾å¼å¤„æŠ›å‡º GeneratorExit å¼‚å¸¸ã€‚å¦‚æžœç”Ÿæˆå™¨æ²¡æœ‰å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œæˆ–è€…æŠ›å‡ºäº† StopIteration å¼‚å¸¸ï¼ˆé€šå¸¸æ˜¯æŒ‡è¿è¡Œåˆ°ç»“å°¾ï¼‰ï¼Œè°ƒç”¨æ–¹ä¸ä¼šæŠ¥é”™ã€‚å¦‚æžœæ”¶åˆ° GeneratorExit å¼‚å¸¸ï¼Œç”Ÿæˆå™¨ä¸€å®šä¸èƒ½äº§å‡ºå€¼ï¼Œå¦åˆ™è§£é‡Šå™¨ä¼šæŠ›å‡º RuntimeError å¼‚å¸¸ã€‚ç”Ÿæˆå™¨æŠ›å‡ºçš„å…¶ä»–å¼‚å¸¸ä¼šå‘ä¸Šå†’æ³¡ï¼Œä¼ ç»™è°ƒç”¨æ–¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">DemoException</span><span class="params">(Exception)</span>:</span> <span class="keyword">pass</span>  <span class="comment"># ä¸ºæ¼”ç¤ºå®šä¹‰çš„å¼‚å¸¸</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">demo_exc_handling</span><span class="params">()</span>:</span>  <span class="comment"># å­¦ä¹ åœ¨åç¨‹ä¸­å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'-&gt; coroutine started'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>            x = <span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">except</span> DemoException:  <span class="comment"># ç‰¹åˆ«å¤„ç†DemoExceptionå¼‚å¸¸</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'*** DemoException handled. Continuing...'</span>)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">else</span>:  <span class="comment"># å¦‚æžœæ²¡æœ‰å¼‚å¸¸ï¼Œé‚£ä¹ˆæ˜¾ç¤ºæŽ¥æ”¶åˆ°çš„å€¼</span></span><br><span class="line"><span class="meta">... </span>            print(<span class="string">'-&gt; coroutine received: &#123;!r&#125;'</span>.format(x))</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">raise</span> RuntimeError(<span class="string">'This line should never run.'</span>)  <span class="comment"># è¿™è¡Œä»£ç ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºåªæœ‰æœªå¤„ç†çš„å¼‚å¸¸</span></span><br><span class="line"><span class="meta">... </span>                                        <span class="comment"># æ‰ä¼šä¸­æ­¢æ— é™å¾ªçŽ¯ï¼Œè€Œä¸€æ—¦å‡ºçŽ°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œåç¨‹ä¼šç«‹å³ç»ˆæ­¢</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exc_coro = demo_exc_handling()  <span class="comment"># åˆ›å»º</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(exc_coro)  <span class="comment"># æ¿€æ´»</span></span><br><span class="line">-&gt; coroutine started</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exc_coro.send(<span class="number">11</span>)</span><br><span class="line">-&gt; coroutine received: 11</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exc_coro.throw(DemoException)</span><br><span class="line">*** DemoException handled. Continuing...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> getgeneratorstate</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(exc_coro)  <span class="comment"># DemoExceptionå¼‚å¸¸ä¸ä¼šå¯¼è‡´åç¨‹ä¸­æ­¢</span></span><br><span class="line"><span class="string">'GEN_SUSPENDED'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exc_coro.throw(ZeroDivisionError)  <span class="comment"># æœªå¤„ç†çš„å¼‚å¸¸ä¼šå¯¼è‡´åç¨‹ä¸­æ­¢</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">5</span>, <span class="keyword">in</span> demo_exc_handling</span><br><span class="line">ZeroDivisionError</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getgeneratorstate(exc_coro)</span><br><span class="line"><span class="string">'GEN_CLOSED'</span></span><br></pre></td></tr></table></figure><p>å¦‚æžœä¸ç®¡åç¨‹å¦‚ä½•ç»“æŸéƒ½æƒ³åšäº›æ¸…ç†å·¥ä½œï¼Œè¦æŠŠåç¨‹å®šä¹‰ä½“ä¸­ç›¸å…³ä»£ç æ”¾å…¥ try/finally å—ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_finally</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'-&gt; coroutine started'</span>)</span><br><span class="line">    <span class="keyword">try</span>:  <span class="comment"># å®šä¹‰ä½“æ”¾å…¥try/finallyå—ä¸­</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                x = <span class="keyword">yield</span></span><br><span class="line">            <span class="keyword">except</span> DemoException:</span><br><span class="line">                print(<span class="string">'*** DemoException handled. Continuing...'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'-&gt; coroutine received: &#123;!r&#125;'</span>.format(x))</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">'-&gt; coroutine ending'</span>)</span><br></pre></td></tr></table></figure><h1 id="è®©åç¨‹è¿”å›žå€¼">è®©åç¨‹è¿”å›žå€¼</h1><p>ä¸ºäº†è¯´æ˜Žå¦‚ä½•è¿”å›žå€¼ï¼Œæ¯æ¬¡æ¿€æ´»åç¨‹æ—¶ä¸ä¼šäº§å‡ºç§»åŠ¨å¹³å‡å€¼ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†å¼ºè°ƒæŸäº›åç¨‹ä¸ä¼šäº§å‡ºå€¼ï¼Œè€Œæ˜¯åœ¨æœ€åŽè¿”å›žä¸€ä¸ªå€¼ï¼ˆé€šå¸¸æ˜¯æŸç§ç´¯è®¡å€¼ï¼‰ã€‚</p><figure class="highlight python"><figcaption><span>coroaverager2.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Result = namedtuple(<span class="string">'Result'</span>, <span class="string">'count average'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">()</span>:</span></span><br><span class="line">    total = <span class="number">0.0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    average = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        term = <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">if</span> term <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># ä¸ºäº†è¿”å›žå€¼ï¼Œåç¨‹å¿…é¡»æ­£å¸¸ç»ˆæ­¢ï¼Œå› æ­¤åŠ äº†ä¸ªåˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        total += term</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        average = total/count</span><br><span class="line">    <span class="keyword">return</span> Result(count, average)  <span class="comment"># åœ¨Python3.3ä¹‹å‰ï¼Œå¦‚æžœç”Ÿæˆå™¨è¿”å›žå€¼ï¼Œè§£é‡Šå™¨ä¼šæŠ¥å¥æ³•é”™è¯¯</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> coroaverager2 <span class="keyword">import</span> averager</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg = averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(coro_avg)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">10</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">30</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>coro_avg.send(<span class="number">6.5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>    coro_avg.send(<span class="literal">None</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">except</span> StopIteration <span class="keyword">as</span> exc:</span><br><span class="line"><span class="meta">... </span>    result = exc.value  <span class="comment"># å¼‚å¸¸å¯¹è±¡çš„valueå±žæ€§ä¿å­˜ç€è¿”å›žçš„å€¼</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>result</span><br><span class="line">Result(count=<span class="number">3</span>, average=<span class="number">15.5</span>)</span><br></pre></td></tr></table></figure><p><strong>return è¡¨è¾¾å¼çš„å€¼ä¼šå·å·ä¼ ç»™è°ƒç”¨æ–¹ï¼Œèµ‹å€¼ç»™ StopIteration å¼‚å¸¸çš„ä¸€ä¸ªå±žæ€§ã€‚</strong>è¿™æ ·åšæœ‰ç‚¹ä¸åˆå¸¸ç†ï¼Œä½†æ˜¯èƒ½ä¿ç•™ç”Ÿæˆå™¨å¯¹è±¡çš„å¸¸è§„è¡Œä¸ºâ€”â€”è€—å°½æ—¶æŠ›å‡º StopIteration å¼‚å¸¸ã€‚</p><p>èŽ·å–åç¨‹çš„è¿”å›žå€¼è™½ç„¶è¦é¥¶ä¸ªåœˆå­ï¼Œä½†è¿™æ˜¯ PEP 380 å®šä¹‰çš„æ–¹å¼ï¼Œå½“æˆ‘ä»¬æ„è¯†åˆ°è¿™ä¸€ç‚¹åŽå°±è¯´å¾—é€šäº†ï¼šyield from ç»“æž„ä¼šåœ¨å†…éƒ¨è‡ªåŠ¨æ•èŽ· StopIteration å¼‚å¸¸ã€‚è¿™ç§å¤„ç†æ–¹å¼ä¸Ž for å¾ªçŽ¯å¤„ç† StopIteration å¼‚å¸¸çš„æ–¹å¼ä¸€æ ·ï¼šå¾ªçŽ¯æœºåˆ¶ä½¿ç”¨ç”¨äºŽæ˜“äºŽç†è§£çš„æ–¹å¼å¤„ç†å¼‚å¸¸ã€‚<strong>å¯¹ yield from ç»“æž„æ¥è¯´ï¼Œè§£é‡Šå™¨ä¸ä»…ä¼šæ•èŽ· StopIteration å¼‚å¸¸ï¼Œè¿˜ä¼šæŠŠ value å±žæ€§çš„å€¼å˜æˆ yield from è¡¨è¾¾å¼çš„å€¼</strong>ã€‚</p><h1 id="ä½¿ç”¨-yield-from">ä½¿ç”¨ yield from</h1><p>yield from æ˜¯å…¨æ–°çš„è¯­è¨€ç»“æž„ï¼Œå®ƒçš„ä½œç”¨æ¯” yield å¤šå¾ˆå¤šã€‚åœ¨ç”Ÿæˆå™¨ gen ä¸­ä½¿ç”¨ <code>yield from subgen()</code> æ—¶ï¼Œsubgen ä¼šèŽ·å¾—æŽ§åˆ¶æƒï¼ŒæŠŠäº§å‡ºçš„å€¼ä¼ ç»™ gen çš„è°ƒç”¨æ–¹ï¼Œå³è°ƒç”¨æ–¹å¯ä»¥ç›´æŽ¥æŽ§åˆ¶ subgenã€‚ä¸Žæ­¤åŒæ—¶ï¼Œgen ä¼šé˜»å¡žï¼Œç­‰å¾… subgen ç»ˆæ­¢ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">'AB'</span>:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> c</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> i</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(gen())</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span>  <span class="comment"># å¯ä»¥æ”¹å†™ä¸º</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="keyword">from</span> <span class="string">'AB'</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="keyword">from</span> range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(gen())</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">chain</span><span class="params">(*iterables)</span>:</span>  <span class="comment"># pythonç‰ˆæœ¬çš„chainå‡½æ•°ï¼ŒåŽŸå‡½æ•°ç”¨Cè¯­è¨€ç¼–å†™å¹¶ä¸”åšäº†ä¼˜åŒ–</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> it <span class="keyword">in</span> iterables:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> <span class="keyword">from</span> it</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = tuple(range(<span class="number">3</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(chain(s, t))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>yield from x è¡¨è¾¾å¼å¯¹ x å¯¹è±¡æ‰€åšçš„ç¬¬ä¸€ä¸ªä»¶äº‹æ˜¯ï¼Œè°ƒç”¨ <code>iter(x)</code>ï¼Œä»Žä¸­èŽ·å–è¿­ä»£å™¨ã€‚å› æ­¤ï¼Œx å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£çš„å¯¹è±¡ã€‚</p><p>å¯æ˜¯ï¼Œå¦‚æžœ yield from ç»“æž„å”¯ä¸€çš„ä½œç”¨æ˜¯æ›¿ä»£äº§å‡ºå€¼çš„åµŒå¥— for å¾ªçŽ¯ï¼Œè¿™ä¸ªç»“æž„å¾ˆæœ‰å¯èƒ½ä¸ä¼šæ·»åŠ åˆ° Python è¯­è¨€ä¸­ã€‚yield from ç»“æž„çš„æœ¬è´¨ä½œç”¨æ— æ³•é€šè¿‡ç®€å•çš„å¯è¿­ä»£å¯¹è±¡è¯´æ˜Žï¼Œè€Œè¦å‘æ•£æ€ç»´ï¼Œä½¿ç”¨åµŒå¥—çš„ç”Ÿæˆå™¨ã€‚å› æ­¤ï¼Œå¼•å…¥ yield from ç»“æž„çš„ PEP 380 æ‰èµ·äº† â€Syntax for Delegatinig to a Subgeneratorâ€œï¼ˆâ€æŠŠèŒè´£å§”æ‰˜ç»™å­ç”Ÿæˆå™¨çš„å¥æ³•â€œï¼‰è¿™ä¸ªæ ‡é¢˜ã€‚</p><p><strong>yield from çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰“å¼€åŒå‘é€šé“ï¼ŒæŠŠæœ€å¤–å±‚çš„è°ƒç”¨æ–¹ä¸Žæœ€å†…å±‚çš„å­ç”Ÿæˆå™¨è¿žæŽ¥èµ·æ¥ï¼Œè¿™æ ·äºŒè€…å¯ä»¥ç›´æŽ¥å‘é€å’Œäº§å‡ºå€¼ï¼Œè¿˜å¯ä»¥ç›´æŽ¥ä¼ å…¥å¼‚å¸¸ï¼Œè€Œä¸ç”¨åœ¨ä½äºŽä¸­é—´çš„åç¨‹ä¸­æ·»åŠ å¤§é‡å¤„ç†å¼‚å¸¸çš„æ ·æ¿ä»£ç ã€‚</strong>æœ‰ä¸ªè¿™ä¸ªç»“æž„ï¼Œåç¨‹å¯ä»¥é€šè¿‡ä»¥å‰ä¸å¯èƒ½çš„æ–¹å¼å§”æ‰˜èŒè´£ã€‚</p><p>è‹¥æƒ³ä½¿ç”¨ yield from ç»“æž„ï¼Œå°±è¦å¤§å¹…æ”¹åŠ¨ä»£ç ã€‚ä¸ºäº†è¯´æ˜Žéœ€è¦æ”¹åŠ¨çš„éƒ¨åˆ†ï¼ŒPEP 380 ä½¿ç”¨äº†ä¸€äº›ä¸“é—¨çš„æœ¯è¯­ã€‚</p><p>å§”æ´¾ç”Ÿæˆå™¨ï¼šåŒ…å« <code>yield from &lt;iterable&gt;</code> è¡¨è¾¾å¼çš„ç”Ÿæˆå™¨å‡½æ•°ã€‚</p><p>å­ç”Ÿæˆå™¨ï¼šä»Ž yield from è¡¨è¾¾å¼ä¸­ <code>&lt;iterable&gt;</code> éƒ¨åˆ†èŽ·å–çš„ç”Ÿæˆå™¨ã€‚è¿™å°±æ˜¯ PEP 380 çš„æ ‡é¢˜ä¸­æ‰€è¯´çš„å­ç”Ÿæˆå™¨ï¼ˆsubgeneratorï¼‰ã€‚</p><p>è°ƒç”¨æ–¹ï¼šè°ƒç”¨å§”æ´¾ç”Ÿæˆå™¨çš„å®¢æˆ·ç«¯ä»£ç ã€‚</p><p><img src="/uploads/image/fluent-python/yield_from_at_work.png"></p><p>å§”æ´¾ç”Ÿæˆå™¨åœ¨ yield from è¡¨è¾¾å¼å¤„æš‚åœæ—¶ï¼Œè°ƒç”¨æ–¹å¯ä»¥ç›´æŽ¥æŠŠæ•°æ®å‘ç»™å­ç”Ÿæˆå™¨ï¼Œå­ç”Ÿæˆå™¨å†æŠŠäº§å‡ºçš„å€¼å‘ç»™è°ƒç”¨æ–¹ã€‚å­ç”Ÿæˆå™¨è¿”å›žä¹‹åŽï¼Œè§£é‡Šå™¨ä¼šæŠ›å‡º StopIteration å¼‚å¸¸ï¼Œå¹¶æŠŠè¿”å›žå€¼é™„åŠ åˆ°å¼‚å¸¸å¯¹è±¡ä¸Šï¼Œæ­¤æ—¶å§”æ´¾ç”Ÿæˆå™¨ä¼šæ¢å¤ã€‚</p><figure class="highlight python"><figcaption><span>coroaverager3.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Result = namedtuple(<span class="string">'Result'</span>, <span class="string">'count average'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">()</span>:</span>  <span class="comment"># ä»£ç ä¸å˜ï¼Œè¿™é‡Œä½œä¸ºå­ç”Ÿæˆå™¨ä½¿ç”¨</span></span><br><span class="line">    total = <span class="number">0.0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    average = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        term = <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">if</span> term <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># è‡³å…³é‡è¦çš„ç»ˆæ­¢æ¡ä»¶ã€‚å¦‚æžœä¸è¿™ä¹ˆåšï¼Œä½¿ç”¨yield from</span></span><br><span class="line">            <span class="keyword">break</span>         <span class="comment"># è°ƒç”¨è¿™ä¸ªåç¨‹çš„ç”Ÿæˆå™¨ä¼šæ°¸è¿œé˜»å¡ž</span></span><br><span class="line">        total += term</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        average = total/count</span><br><span class="line">    <span class="keyword">return</span> Result(count, average)  <span class="comment"># è¿”å›žçš„Resultä¼šæˆä¸ºè°ƒç”¨æ–¹ä¸­yield fromè¡¨è¾¾å¼çš„å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å§”æ´¾ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grouper</span><span class="params">(results, key)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># grouperå‘é€çš„æ¯ä¸ªå€¼éƒ½ä¼šç»ç”±yield fromå¤„ç†ï¼Œé€šè¿‡ç®¡é“ä¼ ç»™averagerå®žä¾‹</span></span><br><span class="line">        <span class="comment"># grouperä¼šåœ¨yield fromè¡¨è¾¾å¼å¤„æš‚åœï¼Œç­‰å¾…averagerå®žä¾‹å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å€¼</span></span><br><span class="line">        <span class="comment"># averagerå®žä¾‹è¿è¡Œå®Œæ¯•åŽï¼Œè¿”å›žçš„å€¼ç»‘å®šåˆ°results[key]ä¸Š</span></span><br><span class="line">        results[key] = <span class="keyword">yield</span> <span class="keyword">from</span> averager()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯ä»£ç ï¼Œå³è°ƒç”¨æ–¹ã€‚è¿™æ˜¯é©±åŠ¨ä¸€åˆ‡çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(data)</span>:</span></span><br><span class="line">    results = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> key, values <span class="keyword">in</span> data.items():</span><br><span class="line">        group = grouper(results, key)  <span class="comment"># åˆ›å»ºgroupåç¨‹</span></span><br><span class="line">        next(group)  <span class="comment"># é¢„æ¿€</span></span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> values:  <span class="comment"># æŠŠå„ä¸ªvalueä¼ ç»™grouperã€‚ä¼ å…¥çš„å€¼æœ€ç»ˆåˆ°è¾¾averagerå‡½æ•°ä¸­term = yieldé‚£ä¸€è¡Œ</span></span><br><span class="line">            group.send(value)  <span class="comment"># grouperæ°¸è¿œä¸çŸ¥é“ä¼ å…¥çš„å€¼æ˜¯ä»€ä¹ˆ</span></span><br><span class="line">        <span class="comment"># æŠŠNoneä¼ å…¥grouperï¼Œå¯¼è‡´å½“å‰çš„averagerå®žä¾‹ç»ˆæ­¢ï¼Œä¹Ÿè®©grouperç»§ç»­è¿è¡Œ</span></span><br><span class="line">        <span class="comment"># å¦‚æžœæ²¡æœ‰è¿™ä¸€è¡Œï¼Œé‚£ä¹ˆaveragerå­ç”Ÿæˆå™¨æ°¸è¿œä¸ä¼šç»ˆæ­¢ï¼Œå§”æ´¾ç”Ÿæˆå™¨groupæ°¸è¿œä¸ä¼šå†æ¬¡æ¿€æ´»</span></span><br><span class="line">        <span class="comment"># å› æ­¤æ°¸è¿œä¸ä¼šä¸ºresults[key]èµ‹å€¼</span></span><br><span class="line">        group.send(<span class="literal">None</span>)  </span><br><span class="line">    report(results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæŠ¥å‘Š</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">report</span><span class="params">(results)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> key, result <span class="keyword">in</span> sorted(results.items()):</span><br><span class="line">        group, unit = key.split(<span class="string">';'</span>)</span><br><span class="line">        print(<span class="string">'&#123;:2&#125; &#123;:5&#125; averaging &#123;:.2f&#125;&#123;&#125;'</span>.format(</span><br><span class="line">            result.count, group, result.average, unit))</span><br><span class="line"></span><br><span class="line">data = &#123;  <span class="comment"># ç”·å¥³å­¦ç”Ÿçš„ä½“é‡å’Œèº«é«˜</span></span><br><span class="line">    <span class="string">'girls;kg'</span>:</span><br><span class="line">        [<span class="number">40.9</span>, <span class="number">38.5</span>, <span class="number">44.3</span>, <span class="number">42.2</span>, <span class="number">45.2</span>, <span class="number">41.7</span>, <span class="number">44.5</span>, <span class="number">39.0</span>, <span class="number">40.6</span>, <span class="number">44.5</span>],</span><br><span class="line">    <span class="string">'girls;m'</span>:</span><br><span class="line">        [<span class="number">1.6</span>, <span class="number">1.51</span>, <span class="number">1.4</span>, <span class="number">1.3</span>, <span class="number">1.41</span>, <span class="number">1.39</span>, <span class="number">1.33</span>, <span class="number">1.46</span>, <span class="number">1.45</span>, <span class="number">1.43</span>],</span><br><span class="line">    <span class="string">'boys;kg'</span>:</span><br><span class="line">        [<span class="number">39.0</span>, <span class="number">40.8</span>, <span class="number">43.2</span>, <span class="number">40.8</span>, <span class="number">43.1</span>, <span class="number">38.6</span>, <span class="number">41.4</span>, <span class="number">40.6</span>, <span class="number">36.3</span>],</span><br><span class="line">    <span class="string">'boys;m'</span>:</span><br><span class="line">        [<span class="number">1.38</span>, <span class="number">1.5</span>, <span class="number">1.32</span>, <span class="number">1.25</span>, <span class="number">1.37</span>, <span class="number">1.48</span>, <span class="number">1.25</span>, <span class="number">1.49</span>, <span class="number">1.46</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main(data)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python coroaverager3.py</span><br><span class="line"> 9 boys  averaging 40.42kg</span><br><span class="line"> 9 boys  averaging 1.39m</span><br><span class="line">10 girls averaging 42.14kg</span><br><span class="line">10 girls averaging 1.43m</span><br></pre></td></tr></table></figure><p>grouper å‡½æ•°ä¸­å¾ªçŽ¯çš„ç›®çš„ï¼šåœ¨ <code>averager()</code> è¿”å›žç»“æžœï¼Œå¹¶å°†ç»“æžœç»‘å®šåˆ° <code>results[key]</code> ä¸Šä¹‹åŽï¼Œç”Ÿæˆå™¨èƒ½å¤Ÿç»§ç»­è¿è¡Œè‡³ä¸‹ä¸€ä¸ª yield å¤„ï¼Œè€Œä¸æ˜¯æŠ›å‡º StopIteration å¼‚å¸¸ã€‚å¦‚æžœä¸ä½¿ç”¨å¾ªçŽ¯ï¼Œä¸‹é¢çš„æ–¹æ³•åŒæ ·å¯ä»¥å®Œæˆä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grouper</span><span class="params">(results, key)</span>:</span></span><br><span class="line">    results[key] = <span class="keyword">yield</span> <span class="keyword">from</span> averager()</span><br><span class="line">    _ = <span class="keyword">yield</span>  <span class="comment"># group.send(None)ä¹‹åŽï¼Œgroupä¼šæš‚åœåœ¨æ­¤å¤„ï¼Œç„¶åŽè°ƒç”¨æ–¹ä¼šé‡æ–°</span></span><br><span class="line">               <span class="comment"># åˆ›å»ºgrouperå¹¶ç»‘å®šåˆ°groupå˜é‡ä¸Šï¼Œæ—§çš„grouperä¼šè¢«åžƒåœ¾å›žæ”¶ç¨‹åºå›žæ”¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grouper</span><span class="params">(results, key)</span>:</span></span><br><span class="line">    results[key] = <span class="keyword">yield</span> <span class="keyword">from</span> averager()  <span class="comment"># ä¸åšå¤„ç†</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(data)</span>:</span></span><br><span class="line">    results = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> key, values <span class="keyword">in</span> data.items():</span><br><span class="line">        <span class="comment"># å…¶ä»–ä»£ç </span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            group.send(<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> StopIteration:  <span class="comment"># åœ¨è°ƒç”¨æ–¹æ•èŽ·å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    report(results)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹å±•ç¤ºäº† yield from ç»“æž„æœ€ç®€å•çš„ç”¨æ³•ï¼Œåªæœ‰ä¸€ä¸ªå§”æ´¾ç”Ÿæˆå™¨å’Œä¸€ä¸ªå­ç”Ÿæˆå™¨ã€‚å› ä¸ºå§”æ´¾ç”Ÿæˆå™¨ç›¸å½“äºŽç®¡é“ï¼Œæ‰€ä»¥å¯ä»¥æŠŠä»»æ„æ•°é‡ä¸ªå§”æ´¾ç”Ÿæˆå™¨è¿žæŽ¥åœ¨ä¸€èµ·ï¼šä¸€ä¸ªå§”æ´¾ç”Ÿæˆå™¨ä½¿ç”¨ yield from è°ƒç”¨ä¸€ä¸ªå­ç”Ÿæˆå™¨ï¼Œè€Œé‚£ä¸ªå­ç”Ÿæˆå™¨æœ¬èº«ä¹Ÿæ˜¯å§”æ´¾ç”Ÿæˆå™¨ï¼Œä½¿ç”¨ yield from è°ƒç”¨å¦ä¸€ä¸ªå­ç”Ÿæˆå™¨ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚æœ€ç»ˆï¼Œè¿™ä¸ªé“¾æ¡è¦ä»¥ä¸€ä¸ªåªä½¿ç”¨ yield è¡¨è¾¾å¼çš„ç®€å•ç”Ÿæˆå™¨ç»“æŸï¼›ä¸è¿‡ï¼Œä¹Ÿèƒ½ä»¥ä»»ä½•å¯è¿­ä»£çš„å¯¹è±¡ç»“æŸï¼ˆyield from iterableï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> coroutines </tag>
            
            <tag> Fluent Python </tag>
            
            <tag> yield </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œelseå—</title>
      <link href="/notes/fluent-python/context-managers-and-else-blocks/"/>
      <url>/notes/fluent-python/context-managers-and-else-blocks/</url>
      
        <content type="html"><![CDATA[<h1 id="ifè¯­å¥ä¹‹å¤–çš„elseå—">ifè¯­å¥ä¹‹å¤–çš„elseå—</h1><p>elseå­å¥ä¸ä»…èƒ½åœ¨ifè¯­å¥ä¸­ä½¿ç”¨ï¼Œè¿˜èƒ½åœ¨forã€whileå’Œtryè¯­å¥ä¸­ä½¿ç”¨ã€‚for/elseã€while/elseå’Œtry/elseçš„è¯­ä¹‰å…³ç³»ç´§å¯†ï¼Œä¸è¿‡ä¸Žif/elseå·®åˆ«å¾ˆå¤§ã€‚</p><p>forï¼šä»…å½“forå¾ªçŽ¯è¿è¡Œå®Œæ¯•æ—¶ï¼ˆå³forå¾ªçŽ¯æ²¡æœ‰è¢«breakè¯­å¥ç»ˆæ­¢ï¼‰æ‰è¿è¡Œelseå—ã€‚</p><p>whileï¼šä»…å½“whileå¾ªçŽ¯å› ä¸ºæ¡ä»¶ä¸ºå‡å€¼è€Œé€€å‡ºæ—¶ï¼ˆå³whileå¾ªçŽ¯æ²¡æœ‰è¢«breakè¯­å¥ç»ˆæ­¢ï¼‰æ‰è¿è¡Œelseå—ã€‚</p><p>tryï¼šä»…å½“tryå—ä¸­æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ—¶æ‰è¿è¡Œelseå—ã€‚elseå­å¥æŠ›å‡ºçš„å¼‚å¸¸ä¸ä¼šç”±å‰é¢çš„exceptå­å¥å¤„ç†ã€‚</p><p>åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå¦‚æžœå¼‚å¸¸æˆ–è€…returnã€breakæˆ–continueè¯­å¥å¯¼è‡´æŽ§åˆ¶æƒè·³åˆ°äº†å¤åˆè¯­å¥çš„ä¸»å—ä¹‹å¤–ï¼Œelseå­å¥ä¹Ÿä¼šè¢«è·³è¿‡ã€‚</p><p>åœ¨è¿™äº›è¯­å¥ä¸­ä½¿ç”¨elseå­å¥é€šå¸¸èƒ½è®©ä»£ç æ›´æ˜“äºŽé˜…è¯»ï¼Œè€Œä¸”èƒ½çœåŽ»ä¸€äº›éº»çƒ¦ï¼Œä¸ç”¨è®¾å€¼æŽ§åˆ¶æ ‡å¿—æˆ–è€…æ·»åŠ é¢å¤–çš„ifè¯­å¥ã€‚</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨å¾ªçŽ¯ä¸­ä½¿ç”¨elseå­å¥</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> my_list:</span><br><span class="line">    <span class="keyword">if</span> item.flavor == <span class="string">'banana'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">'No banana flavor found!'</span>)</span><br><span class="line"><span class="comment"># è¿™æ ·å‘¢ï¼Œæˆ‘å°±æ˜¯ä¸å–œæ¬¢ç”¨for/else</span></span><br><span class="line">have_banana_flavor = any(item.flavor == <span class="string">'banana'</span> <span class="keyword">for</span> item <span class="keyword">in</span> my_list)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> have_banana_flavor:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">'No banana flavor found!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨try/exceptå—ä¸­ä½¿ç”¨elseå­å¥</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dangerous_call()</span><br><span class="line">    after_call()  <span class="comment"># after_call()ä¸åº”è¯¥æ”¾åœ¨tryå—ä¸­ï¼Œä¸ºäº†æ¸…æ™°å’Œå‡†ç¡®ï¼Œtryå—ä¸­</span></span><br><span class="line"><span class="keyword">except</span> OSError:   <span class="comment"># åº”è¯¥åªåŒ…å«æŠ›å‡ºé¢„æœŸå¼‚å¸¸çš„è¯­å¥</span></span><br><span class="line">    log(<span class="string">'OSError...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å› æ­¤ï¼Œåƒä¸‹é¢è¿™æ ·å†™æ›´å¥½</span></span><br><span class="line"><span class="keyword">try</span>:  <span class="comment"># tryå—é˜²å®ˆçš„æ˜¯å¯èƒ½å‡ºçŽ°çš„é”™è¯¯</span></span><br><span class="line">    dangerous_call()</span><br><span class="line"><span class="keyword">except</span> OSError:</span><br><span class="line">    log(<span class="string">'OSError...'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    after_call()</span><br></pre></td></tr></table></figure><p>åœ¨Pythonä¸­ï¼Œtry/exceptä¸ä»…ç”¨äºŽå¤„ç†é”™è¯¯ï¼Œè¿˜å¸¸ç”¨äºŽæŽ§åˆ¶æµç¨‹ã€‚ä¸ºæ­¤ï¼ŒPythonå®˜æ–¹è¯æ±‡è¡¨è¿˜å®šä¹‰äº†ä¸€ä¸ªç¼©ç•¥è¯ï¼ˆå£å·ï¼‰ã€‚</p><p><strong>EAFP</strong>ï¼šå–å¾—åŽŸè°…æ¯”èŽ·å¾—è®¸å¯å®¹æ˜“ï¼ˆeasier to ask for forgiveness than permissionï¼‰ã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„Pythonç¼–ç¨‹é£Žæ ¼ï¼Œå…ˆå‡å®šå­˜åœ¨æœ‰æ•ˆçš„é”®æˆ–å±žæ€§ï¼Œå¦‚æžœå‡å®šä¸æˆç«‹ï¼Œé‚£ä¹ˆæ•èŽ·å¼‚å¸¸ã€‚è¿™ç§é£Žæ ¼ç®€å•æ˜Žå¿«ï¼Œç‰¹ç‚¹æ˜¯ä»£ç ä¸­æœ‰å¾ˆå¤štryå’Œexceptè¯­å¥ã€‚ä¸Žå…¶ä»–å¾ˆå¤šè¯­è¨€ä¸€æ ·ï¼Œè¿™ç§é£Žæ ¼çš„å¯¹ç«‹é¢æ˜¯LBYLé£Žæ ¼ã€‚</p><p><strong>LBYL</strong>ï¼šä¸‰æ€è€ŒåŽè¡Œï¼ˆlook before you leapï¼‰ã€‚è¿™ç§ç¼–ç¨‹é£Žæ ¼åœ¨è°ƒç”¨å‡½æ•°æˆ–æŸ¥æ‰¾å±žæ€§æˆ–é”®ä¹‹å‰æ˜¾å¼æµ‹è¯•å‰ææ¡ä»¶ã€‚ä¸ŽEAFPé£Žæ ¼ç›¸åï¼Œè¿™ç§é£Žæ ¼çš„ç‰¹ç‚¹æ˜¯ä»£ç ä¸­æœ‰å¾ˆå¤šifè¯­å¥ã€‚åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸­ï¼ŒLBYLé£Žæ ¼å¯èƒ½ä¼šåœ¨â€œæ£€æŸ¥â€å’Œâ€œè¡Œäº‹â€çš„ç©ºå½“å¼•å…¥æ¡ä»¶ç«žäº‰ã€‚ä¾‹å¦‚ï¼Œå¯¹if key in mapping: return mapping[key]è¿™æ®µä»£ç æ¥è¯´ï¼Œå¦‚æžœåœ¨æµ‹è¯•ä¹‹åŽï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä»Žæ˜ å°„ä¸­åˆ é™¤äº†é‚£ä¸ªé”®ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç å°±ä¼šå¤±è´¥ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨é”æˆ–è€…EAFPé£Žæ ¼è§£å†³ã€‚å¦‚æžœé€‰æ‹©EAFPé£Žæ ¼ï¼Œé‚£å°±è¦æ›´æ·±å…¥åœ°äº†è§£elseå­å¥ï¼Œå¹¶åœ¨try/exceptè¯­å¥ä¸­åˆç†ä½¿ç”¨ã€‚</p><h1 id="ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œwithå—">ä¸Šä¸‹æ–‡ç®¡ç†å™¨å’Œwithå—</h1><p>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡å­˜åœ¨çš„ç›®çš„æ˜¯ç®¡ç†withè¯­å¥ï¼Œå°±åƒè¿­ä»£å™¨çš„å­˜åœ¨æ˜¯ä¸ºäº†ç®¡ç†forè¯­å¥ä¸€æ ·ã€‚</p><p>withè¯­å¥çš„ç›®çš„æ˜¯ç®€åŒ–try/finallyæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ç”¨äºŽä¿è¯ä¸€æ®µä»£ç è¿è¡Œå®Œæ¯•åŽæ‰§è¡ŒæŸé¡¹æ“ä½œï¼Œå³ä¾¿é‚£æ®µä»£ç ç”±äºŽå¼‚å¸¸ã€returnè¯­å¥æˆ–sys.exit()è°ƒç”¨è€Œä¸­æ­¢ï¼Œä¹Ÿä¼šæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚finallyå­å¥ä¸­çš„ä»£ç é€šå¸¸ç”¨äºŽé‡Šæ”¾é‡è¦çš„èµ„æºï¼Œæˆ–è€…è¿˜åŽŸä¸´æ—¶å˜æ›´çš„çŠ¶æ€ã€‚</p><p>ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®åŒ…å«<code>__enter__</code>å’Œ<code>__exit__</code>ä¸¤ä¸ªæ–¹æ³•ã€‚withè¯­å¥å¼€å§‹è¿è¡Œæ—¶ï¼Œä¼šåœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨<code>__enter__</code>æ–¹æ³•ã€‚withè¯­å¥è¿è¡Œç»“æŸåŽï¼Œä¼šåœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨<code>__exit__</code>æ–¹æ³•ï¼Œä»¥æ­¤æ‰®æ¼”finallyå­å¥çš„è§’è‰²ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ€å¸¸è§çš„ä¾‹å­æ˜¯ç¡®ä¿å…³é—­æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">'class.wsd'</span>) <span class="keyword">as</span> fp:  <span class="comment"># fpç»‘å®šåˆ°æ‰“å¼€çš„æ–‡ä»¶ä¸Šï¼Œå› ä¸ºæ–‡ä»¶çš„__enter__æ–¹æ³•è¿”å›žself</span></span><br><span class="line"><span class="meta">... </span>    src = fp.read(<span class="number">60</span>)  <span class="comment"># è¯»å–ä¸€äº›æ•°æ®</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(src)</span><br><span class="line"><span class="number">60</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp  <span class="comment"># fpä»ç„¶å¯ç”¨ï¼Œä¸Žå‡½æ•°å’Œæ¨¡å—ä¸åŒï¼Œwithå—æ²¡æœ‰å®šä¹‰æ–°çš„ä½œç”¨åŸŸ</span></span><br><span class="line">&lt;_io.TextIOWrapper name=<span class="string">'class.wsd'</span> mode=<span class="string">'r'</span> encoding=<span class="string">'UTF-8'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.closed, fp.encoding  <span class="comment"># å¯ä»¥è¯»å–fpå¯¹è±¡çš„å±žæ€§</span></span><br><span class="line">(<span class="literal">True</span>, <span class="string">'UTF-8'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fp.read(<span class="number">60</span>)  <span class="comment"># ä½†ä¸èƒ½åœ¨fpä¸Šæ‰§è¡ŒI/Oæ“ä½œï¼Œå› ä¸ºåœ¨withå—çš„æœ«å°¾ï¼Œè°ƒç”¨TextIOWrapper.__exit__æ–¹æ³•æŠŠæ–‡ä»¶å…³é—­äº†</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: I/O operation on closed file.</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡ŒwithåŽé¢çš„è¡¨è¾¾å¼å¾—åˆ°çš„ç»“æžœæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ï¼Œä¸è¿‡æŠŠå€¼ç»‘å®šåˆ°ç›®æ ‡å˜é‡ä¸Šï¼ˆaså­å¥ï¼‰æ˜¯åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨<code>__enter__</code>æ–¹æ³•çš„ç»“æžœã€‚</strong>ç¢°å·§ï¼Œç¤ºä¾‹ä¸­çš„open()å‡½æ•°è¿”å›žTextIOWrapperç±»çš„å®žä¾‹ï¼Œè€Œè¯¥å®žä¾‹çš„<code>__enter__</code>æ–¹æ³•è¿”å›žselfã€‚ä¸è¿‡<code>__enter__</code>æ–¹æ³•é™¤äº†è¿”å›žä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¹‹å¤–ï¼Œè¿˜å¯èƒ½è¿”å›žå…¶ä»–å¯¹è±¡ã€‚</p><p>ä¸ç®¡æŽ§åˆ¶æµç¨‹ä»¥å“ªç§æ–¹å¼é€€å‡ºwithå—ï¼Œéƒ½ä¼šåœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯¹è±¡ä¸Šè°ƒç”¨<code>__exit__</code>æ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨<code>__enter__</code>æ–¹æ³•è¿”å›žçš„å¯¹è±¡ä¸Šè°ƒç”¨ã€‚</p><p>withè¯­å¥çš„aså­å¥æ˜¯å¯é€‰çš„ã€‚å¯¹openå‡½æ•°æ¥è¯´ï¼Œå¿…é¡»åŠ ä¸Šaså­å¥ï¼Œä»¥ä¾¿èŽ·å–æ–‡ä»¶çš„å¼•ç”¨ã€‚ä¸è¿‡ï¼Œæœ‰äº›ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¼šè¿”å›žNoneï¼Œå› ä¸ºæ²¡ä»€ä¹ˆæœ‰ç”¨çš„å¯¹è±¡èƒ½æä¾›ç»™ç”¨æˆ·ã€‚</p><figure class="highlight python"><figcaption><span>mirror.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LookingGlass</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> sys</span><br><span class="line">        self.original_write = sys.stdout.write</span><br><span class="line">        sys.stdout.write = self.reverse_write  <span class="comment"># é€šè¿‡çŒ´å­è¡¥ä¸æ›¿æ¢æˆè‡ªå·±çš„åå‘è¾“å‡ºæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'ABCDE'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse_write</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.original_write(text[::<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_value, traceback)</span>:</span>  <span class="comment"># å¦‚æžœä¸€åˆ‡æ­£å¸¸ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯None, None, None</span></span><br><span class="line">        <span class="keyword">import</span> sys</span><br><span class="line">        sys.stdout.write = self.original_write  <span class="comment"># é€€å‡ºæ—¶å†æ¢å›žæ¥</span></span><br><span class="line">        <span class="keyword">if</span> exc_type <span class="keyword">is</span> ZeroDivisionError:  <span class="comment"># å¦‚æžœæœ‰ZeroDivisionErrorç±»åž‹å¼‚å¸¸</span></span><br><span class="line">            print(<span class="string">'Please DO NOT divide by zero!'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># è¿”å›žTrueï¼Œå‘Šè¯‰è§£é‡Šå™¨ï¼Œå¼‚å¸¸å·²ç»å¤„ç†äº†</span></span><br><span class="line">        <span class="comment"># å¦‚æžœ__exit__æ–¹æ³•è¿”å›žNoneï¼Œæˆ–è€…Trueä¹‹å¤–çš„å€¼ï¼Œwithå—ä¸­çš„ä»»ä½•å¼‚å¸¸éƒ½ä¼šå‘ä¸Šå†’æ³¡</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> mirror <span class="keyword">import</span> LookingGlass</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> LookingGlass() <span class="keyword">as</span> what:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello World!'</span>)</span><br><span class="line"><span class="meta">... </span>    print(what)</span><br><span class="line">...</span><br><span class="line">!dlroW olleH  <span class="comment"># åœ¨withå—ä¸­è¾“å‡ºçš„å†…å®¹éƒ½æ˜¯åå‘çš„</span></span><br><span class="line">EDCBA</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>what  <span class="comment"># __enter__è¿”å›žçš„ç»“æžœå­˜åœ¨whatå˜é‡ä¸­</span></span><br><span class="line"><span class="string">'ABCDE'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(what)  <span class="comment"># è¾“å‡ºä¸å†åå‘äº†</span></span><br><span class="line">ABCDE</span><br></pre></td></tr></table></figure><p><strong>åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œå¦‚æžœåº”ç”¨ç¨‹åºæŽ¥ç®¡äº†æ ‡å‡†è¾“å‡ºï¼Œå¯èƒ½ä¼šæŠŠsys.stdoutæ¢æˆç±»ä¼¼æ–‡ä»¶çš„å…¶ä»–å¯¹è±¡ï¼Œç„¶åŽå†åˆ‡æ¢æˆåŽŸæ¥çš„ç‰ˆæœ¬ã€‚</strong><a href="https://devdocs.io/python~3.6/library/contextlib#contextlib.redirect_stdout" target="_blank" rel="noopener">contextlib.redirect_stdout</a>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å°±æ˜¯è¿™ä¹ˆåšçš„ï¼šåªéœ€ä¼ å…¥ç±»ä¼¼æ–‡ä»¶çš„å¯¹è±¡ï¼Œç”¨äºŽæ›¿ä»£sys.stdoutã€‚</p><p>è§£é‡Šå™¨è°ƒç”¨<code>__enter__</code>æ–¹æ³•æ—¶ï¼Œé™¤äº†éšå¼çš„selfä¹‹å¤–ï¼Œä¸ä¼šä¼ å…¥ä»»ä½•å‚æ•°ã€‚ä¼ ç»™<code>__exit__</code>æ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°å¦‚ä¸‹ï¼š</p><p>exc_typeï¼šå¼‚å¸¸ç±»ï¼ˆä¾‹å¦‚ZeroDivisionErrorï¼‰ã€‚</p><p>exc_valueï¼šå¼‚å¸¸å®žä¾‹ã€‚æœ‰æ—¶ä¼šæœ‰å‚æ•°ä¼ ç»™å¼‚å¸¸æž„é€ æ–¹æ³•ï¼Œä¾‹å¦‚é”™è¯¯æ¶ˆæ¯ï¼Œè¿™äº›å‚æ•°å¯ä»¥ä½¿ç”¨exc_value.argsèŽ·å–ã€‚</p><p>tracebackï¼štrackbackå¯¹è±¡ã€‚</p><p>åœ¨try/finallyè¯­å¥çš„finallyå—ä¸­è°ƒç”¨sys.exc_info()å¾—åˆ°çš„å°±æ˜¯<code>__exit__</code>æŽ¥æ”¶çš„è¿™ä¸‰ä¸ªå‚æ•°ã€‚é‰´äºŽwithè¯­å¥æ˜¯ä¸ºäº†å–ä»£å¤§å¤šæ•°try/finallyè¯­å¥ï¼Œè€Œä¸”é€šå¸¸éœ€è¦è°ƒç”¨sys.exc_info()æ¥åˆ¤æ–­åšä»€ä¹ˆæ¸…ç†æ“ä½œï¼Œè¿™ç§è¡Œä¸ºæ˜¯åˆç†çš„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„å…·ä½“å·¥ä½œæ–¹å¼</span></span><br><span class="line"><span class="comment"># åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨withå—ä¹‹å¤–ä½¿ç”¨LookingGlassç±»</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>manager = LookingGlass()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>manager</span><br><span class="line">&lt;mirror.LookingGlass object at <span class="number">0x104f5f390</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>monster = manager.__enter__()  <span class="comment"># ä»Žæ­¤è¿›å…¥é•œä¸­ä¸–ç•Œ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>monster</span><br><span class="line"><span class="string">'EDCBA'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>monster == <span class="string">'ABCDE'</span></span><br><span class="line">eurT</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>manager</span><br><span class="line">&gt;<span class="number">093</span>f5f401x0 ta tcejbo ssalGgnikooL.rorrim&lt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>manager.__exit__(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)  <span class="comment"># é€€å‡º</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>monster</span><br><span class="line"><span class="string">'ABCDE'</span></span><br></pre></td></tr></table></figure><h1 id="contextlibæ¨¡å—ä¸­çš„å®žç”¨å·¥å…·">contextlibæ¨¡å—ä¸­çš„å®žç”¨å·¥å…·</h1><p>é™¤äº†å‰é¢æåˆ°çš„redirect_stdoutå‡½æ•°ï¼Œcontextlibæ¨¡å—ä¸­è¿˜æœ‰ä¸€äº›ç±»å’Œå…¶ä»–å‡½æ•°ï¼Œä½¿ç”¨èŒƒå›´æ›´å¹¿ã€‚</p><p>closingï¼šå¦‚æžœå¯¹è±¡æä¾›äº†close()æ–¹æ³•ï¼Œä½†æ²¡æœ‰å®žçŽ°<code>__enter__/__exit__</code>åè®®ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æž„å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚</p><p>suppressï¼šæž„å»ºä¸´æ—¶å¿½ç•¥æŒ‡å®šå¼‚å¸¸çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚</p><p><span class="citation" data-cites="contextmanager">@contextmanager</span>ï¼šè¿™ä¸ªè£…é¥°å™¨æŠŠç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°å˜æˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè¿™æ ·å°±ä¸ç”¨åˆ›å»ºç±»åŽ»å®žçŽ°ç®¡ç†å™¨åè®®äº†ã€‚</p><p>ContextDecoratorï¼šè¿™æ˜¯ä¸ªåŸºç±»ï¼Œç”¨äºŽå®šä¹‰åŸºäºŽç±»çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚è¿™ç§ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¹Ÿèƒ½ç”¨äºŽè£…é¥°å™¨å‡½æ•°ï¼Œåœ¨å—ç®¡ç†çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ•´ä¸ªå‡½æ•°ã€‚</p><p>ExitStackï¼šè¿™ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨èƒ½è¿›å…¥å¤šä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚withå—ç»“æŸæ—¶ï¼ŒExitStackæŒ‰ç…§åŽè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨æ ˆä¸­å„ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„<code>__exit__</code>æ–¹æ³•ã€‚å¦‚æžœäº‹å…ˆä¸çŸ¥é“withå—è¦è¿›å…¥å¤šå°‘ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»ã€‚ä¾‹å¦‚ï¼ŒåŒæ—¶æ‰“å¼€ä»»æ„ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚</p><p>åœ¨è¿™äº›å®žç”¨å·¥å…·ä¸­ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯@contextmanagerè£…é¥°å™¨ã€‚è¿™ä¸ªè£…é¥°å™¨ä¹Ÿæœ‰è¿·æƒ‘äººçš„ä¸€é¢ï¼Œå› ä¸ºå®ƒä¸Žè¿­ä»£æ— å…³ï¼Œå´è¦ä½¿ç”¨yieldè¯­å¥ã€‚</p><h1 id="ä½¿ç”¨contextmanager">ä½¿ç”¨@contextmanager</h1><p><span class="citation" data-cites="contextmanagerè£…é¥°å™¨èƒ½å‡å°‘åˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„æ ·æ¿ä»£ç é‡">@contextmanagerè£…é¥°å™¨èƒ½å‡å°‘åˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„æ ·æ¿ä»£ç é‡</span>ï¼Œå› ä¸ºä¸ç”¨ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„ç±»ï¼Œå®šä¹‰<code>__enter__</code>å’Œ<code>__exit__</code>æ–¹æ³•ï¼Œè€Œåªéœ€å®žçŽ°æœ‰ä¸€ä¸ªyieldè¯­å¥çš„ç”Ÿæˆå™¨ï¼Œç”Ÿæˆæƒ³è®©<code>__enter__</code>æ–¹æ³•è¿”å›žçš„å€¼ã€‚</p><p>åœ¨ä½¿ç”¨@contextmanagerè£…é¥°çš„ç”Ÿæˆå™¨ä¸­ï¼Œyieldè¯­å¥çš„ä½œç”¨æ˜¯æŠŠå‡½æ•°çš„å®šä¹‰ä½“åˆ†æˆä¸¤éƒ¨åˆ†ï¼šyieldè¯­å¥å‰é¢çš„æ‰€æœ‰ä»£ç åœ¨withå—å¼€å§‹æ—¶ï¼ˆå³è§£é‡Šå™¨è°ƒç”¨<code>__enter__</code>æ–¹æ³•æ—¶ï¼‰æ‰§è¡Œï¼Œyieldè¯­å¥åŽé¢çš„ä»£ç åœ¨withå—ç»“æŸæ—¶ï¼ˆå³è°ƒç”¨<code>__exit__</code>æ–¹æ³•æ—¶ï¼‰æ‰§è¡Œã€‚</p><figure class="highlight python"><figcaption><span>mirror_gen.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">looking_glass</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    original_write = sys.stdout.write</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse_write</span><span class="params">(text)</span>:</span></span><br><span class="line">        original_write(text[::<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    sys.stdout.write = reverse_write</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'ABCDE'</span></span><br><span class="line">    sys.stdout.write = original_write</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> mirror_gen <span class="keyword">import</span> looking_glass</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> looking_glass() <span class="keyword">as</span> what:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Hello World!'</span>)</span><br><span class="line"><span class="meta">... </span>    print(what)</span><br><span class="line">...</span><br><span class="line">!dlroW olleH</span><br><span class="line">EDCBA</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>what</span><br><span class="line"><span class="string">'ABCDE'</span></span><br></pre></td></tr></table></figure><p>å…¶å®žï¼Œcontextlib.contextmanagerè£…é¥°å™¨ä¼šæŠŠå‡½æ•°åŒ…å«æˆå®žçŽ°<code>__enter__</code>å’Œ<code>__exit__</code>æ–¹æ³•çš„ç±»ã€‚è¿™ä¸ªç±»çš„<code>__enter__</code>æ–¹æ³•æœ‰å¦‚ä¸‹ä½œç”¨ï¼š</p><ol type="1"><li>è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°ï¼Œä¿å­˜ç”Ÿæˆå™¨å¯¹è±¡ï¼ˆè¿™é‡ŒæŠŠå®ƒç§°ä¸ºgenï¼‰ã€‚</li><li>è°ƒç”¨next(gen)ï¼Œæ‰§è¡Œåˆ°yieldå…³é”®å­—æ‰€åœ¨çš„ä½ç½®ã€‚</li><li>è¿”å›žnext(gen)äº§å‡ºçš„å€¼ï¼Œä»¥ä¾¿æŠŠäº§å‡ºçš„å€¼ç»‘å®šåˆ°with/asè¯­å¥ä¸­çš„ç›®æ ‡å˜é‡ä¸Šã€‚</li></ol><p>withå—ç»ˆæ­¢æ—¶ï¼Œ<code>__exit__</code>æ–¹æ³•ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹ï¼š</p><ol type="1"><li>æ£€æŸ¥æœ‰æ²¡æœ‰æŠŠå¼‚å¸¸ä¼ ç»™exc_typeï¼›å¦‚æžœæœ‰ï¼Œè°ƒç”¨gen.throw(exception)ï¼Œåœ¨ç”Ÿæˆå™¨å‡½æ•°å®šä¹‰ä½“ä¸­åŒ…å«yieldå…³é”®å­—çš„é‚£ä¸€è¡ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li><li>å¦åˆ™ï¼Œè°ƒç”¨next(gen)ï¼Œç»§ç»­æ‰§è¡Œç”Ÿæˆå™¨å‡½æ•°å®šä¹‰ä½“ä¸­yieldè¯­å¥ä¹‹åŽçš„ä»£ç ã€‚</li></ol><p>ä¸Šè¿°ç¤ºä¾‹ä¸­æœ‰ä¸€ä¸ªä¸¥é‡çš„é”™è¯¯ï¼šå¦‚æžœåœ¨withå—ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼ŒPythonè§£é‡Šå™¨ä¼šå°†å…¶æ•èŽ·ï¼Œç„¶åŽå†looking_glasså‡½æ•°çš„yieldè¡¨è¾¾å¼é‡Œå†æ¬¡æŠ›å‡ºã€‚ä½†æ˜¯ï¼Œé‚£é‡Œæ²¡æœ‰å¤„ç†é”™è¯¯çš„ä»£ç ï¼Œå› æ­¤looking_glasså‡½æ•°ä¼šç»ˆæ­¢ï¼Œæ°¸è¿œæ— æ³•æ¢å¤æˆåŽŸæ¥çš„sys.stdout.writeæ–¹æ³•ï¼Œå¯¼è‡´ç³»ç»Ÿå¤„äºŽæ— æ•ˆçŠ¶æ€ã€‚</p><p>ä¸‹é¢çš„å®žä¾‹ä¸­æ·»åŠ äº†ä¸€äº›ä»£ç ï¼Œç‰¹åˆ«ç”¨äºŽå¤„ç†ZeroDivisionErrorå¼‚å¸¸ï¼›è¿™æ ·ï¼Œåœ¨åŠŸèƒ½ä¸Šå®ƒå°±ä¸ŽåŸºäºŽç±»çš„å®žçŽ°ç­‰æ•ˆäº†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">looking_glass</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    original_write = sys.stdout.write</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse_write</span><span class="params">(text)</span>:</span></span><br><span class="line">        original_write(text[::<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">    sys.stdout.write = reverse_write</span><br><span class="line">    msg = <span class="string">''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">'ABCDE'</span></span><br><span class="line">    <span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">        msg = <span class="string">'Please DO NOT divide by zero!'</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sys.stdout.write = original_write  <span class="comment"># æ’¤é”€çŒ´å­è¡¥ä¸</span></span><br><span class="line">        <span class="keyword">if</span> msg:  <span class="comment"># æœ‰é”™è¯¯æ¶ˆæ¯å°±è¾“å‡º</span></span><br><span class="line">            print(msg)</span><br></pre></td></tr></table></figure><p>å‰é¢è¯´è¿‡ï¼Œä¸ºäº†å‘Šè¯‰è§£é‡Šå™¨å¼‚å¸¸å·²ç»å¤„ç†äº†ï¼Œ<code>__exit__</code>æ–¹æ³•ä¼šè¿”å›žTrueï¼Œæ­¤æ—¶è§£é‡Šå™¨ä¼šåŽ‹åˆ¶å¼‚å¸¸ã€‚å¦‚æžœ<code>__exit__</code>æ–¹æ³•æ²¡æœ‰æ˜¾å¼è¿”å›žä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè§£é‡Šå™¨å¾—åˆ°çš„æ˜¯Noneï¼Œç„¶åŽå‘ä¸Šå†’æ³¡å¼‚å¸¸ã€‚<strong>ä½¿ç”¨@contextmanagerè£…é¥°å™¨æ—¶ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯ç›¸åçš„ï¼šè£…é¥°å™¨æä¾›çš„<code>__exit__</code>æ–¹æ³•å‡å®šå‘ç»™ç”Ÿæˆå™¨çš„æ‰€æœ‰å¼‚å¸¸éƒ½å¾—åˆ°å¤„ç†äº†ï¼Œå› æ­¤åº”è¯¥åŽ‹åˆ¶å¼‚å¸¸ã€‚</strong>å¦‚æžœä¸æƒ³è®©@contextmanageråŽ‹åˆ¶å¼‚å¸¸ï¼Œå¿…é¡»åœ¨è¢«è£…é¥°çš„å‡½æ•°ä¸­æ˜¾å¼é‡æ–°æŠ›å‡ºå¼‚å¸¸ã€‚</p><p><strong>ä½¿ç”¨@contextmanagerè£…é¥°å™¨æ—¶ï¼Œè¦æŠŠyieldè¯­å¥æ”¾åœ¨try/finallyè¯­å¥ä¸­ï¼ˆæˆ–è€…æ”¾åœ¨withè¯­å¥ä¸­ï¼‰ï¼Œè¿™æ˜¯æ— æ³•é¿å…çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ°¸è¿œä¸çŸ¥é“ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç”¨æˆ·ä¼šåœ¨withå—ä¸­åšä»€ä¹ˆã€‚</strong></p><p>é™¤äº†æ ‡å‡†åº“ä¸­ä¸¾çš„ä¾‹å­ä¹‹å¤–ï¼ŒMartijn Pieterså®žçŽ°çš„åŽŸåœ°æ–‡ä»¶é‡å†™ä¸Šä¸‹æ–‡ç®¡ç†å™¨<a href="http://www.zopatista.com/python/2013/11/26/inplace-file-rewriting/" target="_blank" rel="noopener"><code>inplace</code></a>æ˜¯@contextmanagerä¸é”™çš„ä½¿ç”¨å®žä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨inplaceä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒä¸ºåŒä¸€ä¸ªæ–‡ä»¶æä¾›äº†ä¸¤ä¸ªå¥æŸ„ï¼Œä»¥ä¾¿åŒæ—¶è¯»å†™åŒä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> inplace(csvfilename, <span class="string">'r'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> (infh, outfh):</span><br><span class="line">    reader = csv.reader(infh)</span><br><span class="line">    writer = csv.writer(outfh)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        row += [<span class="string">'new'</span>, <span class="string">'columns'</span>]</span><br><span class="line">        writer.writerow(row)</span><br></pre></td></tr></table></figure><p><strong>åœ¨@contextmanagerè£…é¥°å™¨è£…é¥°çš„ç”Ÿæˆå™¨ä¸­ï¼Œyieldä¸Žè¿­ä»£æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚</strong>åœ¨æœ¬èŠ‚æ‰€ä¸¾çš„ç¤ºä¾‹ä¸­ï¼Œç”Ÿæˆå™¨å‡½æ•°çš„ä½œç”¨æ›´åƒæ˜¯åç¨‹ï¼šæ‰§è¡Œåˆ°æŸä¸€ç‚¹æ—¶æš‚åœï¼Œè®©å®¢æˆ·ä»£ç è¿è¡Œï¼Œç›´åˆ°å®¢æœè®©åç¨‹ç»§ç»­åšäº‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> contextlib </tag>
            
            <tag> with </tag>
            
            <tag> for/else </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡å‡†åº“ä¸­çš„ç”Ÿæˆå™¨å‡½æ•°</title>
      <link href="/notes/fluent-python/generator-functions-in-standard-library/"/>
      <url>/notes/fluent-python/generator-functions-in-standard-library/</url>
      
        <content type="html"><![CDATA[<p>æœ¬èŠ‚ä¸“æ³¨äºŽé€šç”¨çš„å‡½æ•°ï¼šå‚æ•°ä¸ºä»»æ„çš„å¯è¿­ä»£å¯¹è±¡ï¼Œè¿”å›žå€¼æ˜¯ç”Ÿæˆå™¨ï¼Œç”¨äºŽç”Ÿæˆé€‰ä¸­çš„ã€è®¡ç®—å‡ºçš„å’Œé‡æ–°æŽ’åˆ—çš„å…ƒç´ ã€‚</p><h1 id="ç”¨äºŽè¿‡æ»¤">ç”¨äºŽè¿‡æ»¤</h1><p>ä»Žè¾“å…¥çš„å¯è¿­ä»£å¯¹è±¡ä¸­äº§å‡ºå…ƒç´ çš„å­é›†ï¼Œè€Œä¸”ä¸ä¿®æ”¹å…ƒç´ æœ¬èº«ã€‚</p><table><colgroup><col style="width: 10%"><col style="width: 20%"><col style="width: 70%"></colgroup><thead><tr class="header"><th>æ¨¡å—</th><th>å‡½æ•°</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>itertools</code></td><td><code>compress(it, selector_it)</code></td><td>å¹¶è¡Œå¤„ç†ä¸¤ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼›å¦‚æžœ <code>selector_it</code> ä¸­çš„å…ƒç´ æ˜¯çœŸå€¼ï¼Œäº§å‡º <code>it</code> ä¸­å¯¹åº”çš„å…ƒç´ </td></tr><tr class="even"><td><code>itertools</code></td><td><a href="https://devdocs.io/python~3.6/library/itertools#itertools.dropwhile" target="_blank" rel="noopener"><code>dropwhile(predicate, it)</code></a></td><td>æ‰”æŽ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œ<code>predicate</code> é¦–æ¬¡è¿”å›ž <code>Flase</code> æ—¶ï¼Œåœæ­¢æ£€æŸ¥ï¼Œäº§å‡ºåŽç»­å…ƒç´ ï¼ˆä¸å†æ£€æŸ¥ï¼‰</td></tr><tr class="odd"><td>å†…ç½®</td><td><code>filter(predicate, it)</code></td><td>æŠŠ <code>it</code> ä¸­çš„å„ä¸ªå…ƒç´ ä¼ ç»™ <code>predicate</code>ï¼Œå¦‚æžœ <code>predicate(item)</code> è¿”å›žçœŸå€¼ï¼Œé‚£ä¹ˆäº§å‡ºå¯¹åº”çš„å…ƒç´ ï¼›å¦‚æžœ <code>predicate</code> æ˜¯ <code>None</code>ï¼Œé‚£ä¹ˆåªäº§å‡ºçœŸå€¼å…ƒç´ </td></tr><tr class="even"><td><code>itertools</code></td><td><code>filterfalse(predicate, it)</code></td><td>ä¸Ž <code>filter</code> å‡½æ•°çš„ä½œç”¨ç±»ä¼¼ï¼Œä¸è¿‡ <code>predicate</code> çš„é€»è¾‘æ˜¯ç›¸åçš„ï¼š<code>predicate</code> è¿”å›žå‡å€¼æ—¶äº§å‡ºå¯¹åº”çš„å…ƒç´ </td></tr><tr class="odd"><td><code>itertools</code></td><td><code>islice(it, stop)</code> æˆ– <code>islice(it, start, stop, step=1</code></td><td>äº§å‡º <code>it</code> çš„åˆ‡ç‰‡ï¼Œä½œç”¨ç±»ä¼¼äºŽ <code>s[:stop]</code> æˆ– <code>s[start:stop:step]</code>ï¼Œä¸è¿‡ <code>it</code> å¯ä»¥æ˜¯ä»»ä½•å¯è¿­ä»£çš„å¯¹è±¡ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°å®žçŽ°çš„æ˜¯æƒ°æ€§æ“ä½œ</td></tr><tr class="even"><td><code>itertools</code></td><td><a href="https://devdocs.io/python~3.6/library/itertools#itertools.takewhile" target="_blank" rel="noopener"><code>takewhile(predicate, it)</code></a></td><td>äº§å‡ºæ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œ<code>predicate</code> é¦–æ¬¡è¿”å›ž <code>False</code> æ—¶ç«‹å³åœæ­¢ï¼Œä¸äº§å‡ºåŽç»­å…ƒç´ </td></tr></tbody></table><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">vowel</span><span class="params">(c)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> c.lower() <span class="keyword">in</span> <span class="string">'aeiou'</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(filter(vowel, <span class="string">'Aardvark'</span>))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> itertools</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.filterfalse(vowel, <span class="string">'Aardvark'</span>))</span><br><span class="line">[<span class="string">'r'</span>, <span class="string">'d'</span>, <span class="string">'v'</span>, <span class="string">'r'</span>, <span class="string">'k'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.dropwhile(vowel, <span class="string">'Aardvark'</span>))</span><br><span class="line">[<span class="string">'r'</span>, <span class="string">'d'</span>, <span class="string">'v'</span>, <span class="string">'a'</span>, <span class="string">'r'</span>, <span class="string">'k'</span>]  <span class="comment"># 'r'æ˜¯é¦–ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.takewhile(vowel, <span class="string">'Aardvark'</span>))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'a'</span>]  <span class="comment"># 'A', 'a'éƒ½æ»¡è¶³æ¡ä»¶ï¼Œ'r'æ˜¯é¦–ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.compress(<span class="string">'Aardvark'</span>, (<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>)))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'r'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.islice(<span class="string">'Aardvark'</span>, <span class="number">4</span>))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'a'</span>, <span class="string">'r'</span>, <span class="string">'d'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.islice(<span class="string">'Aardvark'</span>, <span class="number">4</span>, <span class="number">7</span>))</span><br><span class="line">[<span class="string">'v'</span>, <span class="string">'a'</span>, <span class="string">'r'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.islice(<span class="string">'Aardvark'</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>))</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>]</span><br></pre></td></tr></table></figure><h1 id="ç”¨äºŽæ˜ å°„">ç”¨äºŽæ˜ å°„</h1><table><colgroup><col style="width: 10%"><col style="width: 20%"><col style="width: 70%"></colgroup><thead><tr class="header"><th>æ¨¡å—</th><th>å‡½æ•°</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>itertools</code></td><td><code>accumulate(it, [func]</code></td><td>äº§å‡ºç´¯è®¡çš„æ€»å’Œï¼›å¦‚æžœæä¾›äº† <code>func</code>ï¼Œé‚£ä¹ˆæŠŠå‰ä¸¤ä¸ªå…ƒç´ ä¼ ç»™å®ƒï¼Œç„¶åŽæŠŠè®¡ç®—ç»“æžœå’Œä¸‹ä¸€ä¸ªå…ƒç´ ä¼ ç»™å®ƒï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œæœ€åŽäº§å‡ºç»“æžœ</td></tr><tr class="even"><td>å†…ç½®</td><td><code>enumerate(iterable, start=0)</code></td><td>äº§å‡ºç”±ä¸¤ä¸ªå…ƒç´ æž„æˆçš„å…ƒç´ ï¼Œç»“æž„æ˜¯ <code>(index, item)</code>ï¼Œå…¶ä¸­ <code>index</code> ä»Ž <code>start</code> å¼€å§‹è®¡æ•°ï¼Œ<code>item</code> åˆ™ä»Ž <code>iterable</code> ä¸­èŽ·å–</td></tr><tr class="odd"><td>å†…ç½®</td><td><code>map(func, it1, [it2, ..., itN])</code></td><td>æŠŠ <code>it</code> ä¸­çš„å„ä¸ªå…ƒç´ ä¼ ç»™ <code>func</code>ï¼Œäº§å‡ºç»“æžœï¼›å¦‚æžœä¼ å…¥ N ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>func</code> å¿…é¡»èƒ½æŽ¥å— N ä¸ªå‚æ•°ï¼Œè€Œä¸”è¦å¹¶è¡Œå¤„ç†å„ä¸ªå¯è¿­ä»£çš„å¯¹è±¡</td></tr><tr class="even"><td><code>itertools</code></td><td><code>starmap(func, it)</code></td><td>æŠŠ <code>it</code> ä¸­çš„å„ä¸ªå…ƒç´ ä¼ ç»™ <code>func</code>ï¼Œäº§å‡ºç»“æžœï¼›è¾“å…¥çš„å¯è¿­ä»£å¯¹è±¡åº”è¯¥äº§å‡ºå¯è¿­ä»£çš„å…ƒç´  <code>iit</code>ï¼Œç„¶åŽä»¥ <code>func(*iit)</code> è¿™ç§å½¢å¼è°ƒç”¨ <code>func</code></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sample = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.accumulate(sample))  <span class="comment"># ç´¯åŠ </span></span><br><span class="line">[<span class="number">5</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">19</span>, <span class="number">26</span>, <span class="number">32</span>, <span class="number">35</span>, <span class="number">35</span>, <span class="number">44</span>, <span class="number">45</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.accumulate(sample, min))  <span class="comment"># è®¡ç®—æœ€å°å€¼</span></span><br><span class="line">[<span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.accumulate(sample, max))  <span class="comment"># è®¡ç®—æœ€å¤§å€¼</span></span><br><span class="line">[<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.accumulate(sample, operator.mul))  <span class="comment"># ç´¯ä¹˜</span></span><br><span class="line">[<span class="number">5</span>, <span class="number">20</span>, <span class="number">40</span>, <span class="number">320</span>, <span class="number">2240</span>, <span class="number">13440</span>, <span class="number">40320</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.accumulate(range(<span class="number">1</span>, <span class="number">11</span>), operator.mul))  <span class="comment"># ä»Ž1!åˆ°10!</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>, <span class="number">720</span>, <span class="number">5040</span>, <span class="number">40320</span>, <span class="number">362880</span>, <span class="number">3628800</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(enumerate(<span class="string">'albatroz'</span>, <span class="number">1</span>))</span><br><span class="line">[(<span class="number">1</span>, <span class="string">'a'</span>), (<span class="number">2</span>, <span class="string">'l'</span>), (<span class="number">3</span>, <span class="string">'b'</span>), (<span class="number">4</span>, <span class="string">'a'</span>), (<span class="number">5</span>, <span class="string">'t'</span>), (<span class="number">6</span>, <span class="string">'r'</span>), (<span class="number">7</span>, <span class="string">'o'</span>), (<span class="number">8</span>, <span class="string">'z'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(operator.mul, range(<span class="number">11</span>), range(<span class="number">11</span>)))  <span class="comment"># 0åˆ°10çš„å¹³æ–¹</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(operator.mul, range(<span class="number">11</span>), [<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>]))  <span class="comment"># çŸ­çš„iteratorç»“æŸæ—¶åœæ­¢</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">4</span>, <span class="number">16</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(<span class="keyword">lambda</span> a, b: (a, b), range(<span class="number">11</span>), [<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>]))  <span class="comment"># ç­‰åŒäºŽzip</span></span><br><span class="line">[(<span class="number">0</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">8</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.starmap(operator.mul, enumerate(<span class="string">'albatroz'</span>, <span class="number">1</span>)))  <span class="comment"># æ ¹æ®æ‰€åœ¨ä½ç½®é‡å¤ç›¸åº”æ¬¡æ•°</span></span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'ll'</span>, <span class="string">'bbb'</span>, <span class="string">'aaaa'</span>, <span class="string">'ttttt'</span>, <span class="string">'rrrrrr'</span>, <span class="string">'ooooooo'</span>, <span class="string">'zzzzzzzz'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.starmap(<span class="keyword">lambda</span> a, b: b/a,</span><br><span class="line"><span class="meta">... </span>    enumerate(itertools.accumulate(sample), <span class="number">1</span>)))  <span class="comment"># è®¡ç®—å‡å€¼</span></span><br><span class="line">[<span class="number">5.0</span>, <span class="number">4.5</span>, <span class="number">3.6666666666666665</span>, <span class="number">4.75</span>, <span class="number">5.2</span>, <span class="number">5.333333333333333</span>, <span class="number">5.0</span>, <span class="number">4.375</span>, <span class="number">4.888888888888889</span>, <span class="number">4.5</span>]</span><br></pre></td></tr></table></figure><h1 id="ç”¨äºŽåˆå¹¶">ç”¨äºŽåˆå¹¶</h1><table><colgroup><col style="width: 10%"><col style="width: 20%"><col style="width: 70%"></colgroup><thead><tr class="header"><th>æ¨¡å—</th><th>å‡½æ•°</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>itertools</code></td><td><code>chain(it1, ..., itN)</code></td><td>å…ˆäº§å‡º <code>it1</code> ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œç„¶åŽäº§å‡º <code>it2</code> ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œæ— ç¼è¿žæŽ¥åœ¨ä¸€èµ·</td></tr><tr class="even"><td><code>itertools</code></td><td><code>chain.from_iterable(it)</code></td><td>äº§å‡º <code>it</code> ç”Ÿæˆçš„å„ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œä¸€ä¸ªæŽ¥ä¸€ä¸ªï¼Œæ— ç¼è¿žæŽ¥åœ¨ä¸€èµ·ï¼›<code>it</code> åº”è¯¥äº§å‡ºå¯è¿­ä»£å…ƒç´ ï¼Œä¾‹å¦‚å¯è¿­ä»£çš„å¯¹è±¡åˆ—è¡¨</td></tr><tr class="odd"><td><code>itertools</code></td><td><code>product(it1, ..., itN, repeat=1)</code></td><td>è®¡ç®—ç¬›å¡å°”ç§¯ï¼šä»Žè¾“å…¥çš„å„ä¸ªå¯è¿­ä»£å…ƒç´ ä¸­èŽ·å–å…ƒç´ ï¼Œåˆå¹¶æˆç”± N ä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„ï¼Œä¸ŽåµŒå¥—çš„ <code>for</code> å¾ªçŽ¯æ•ˆæžœä¸€æ ·ï¼›<code>repeat</code> æŒ‡æ˜Žé‡å¤å¤„ç†å¤šå°‘æ¬¡è¾“å…¥çš„å¯è¿­ä»£å¯¹è±¡</td></tr><tr class="even"><td>å†…ç½®</td><td><code>zip(it1, ..., itN)</code></td><td>å¹¶è¡Œä»Žè¾“å…¥çš„å„ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­èŽ·å–å…ƒç´ ï¼Œäº§å‡ºç”± N ä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„ï¼Œåªè¦æœ‰ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡åˆ°å¤´äº†ï¼Œå°±é»˜é»˜åœ°åœæ­¢</td></tr><tr class="odd"><td><code>itertools</code></td><td><code>zip_longest(it1, ..., itN, fillvalue=None)</code></td><td>å¹¶è¡Œä»Žè¾“å…¥çš„å„ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­èŽ·å–å…ƒç´ ï¼Œäº§å‡ºç”± N ä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„ï¼Œç­‰åˆ°æœ€é•¿çš„å¯è¿­ä»£å¯¹è±¡åˆ°å¤´åŽæ‰åœæ­¢ï¼Œç©ºç¼ºçš„å€¼ä½¿ç”¨ <code>fillvalue</code> å¡«å……</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.chain(<span class="string">'ABC'</span>, range(<span class="number">2</span>)))</span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.chain(enumerate(<span class="string">'ABC'</span>)))  <span class="comment"># å¦‚æžœåªä¼ å…¥ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼Œé‚£ä¹ˆchainå‡½æ•°æ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line">[(<span class="number">0</span>, <span class="string">'A'</span>), (<span class="number">1</span>, <span class="string">'B'</span>), (<span class="number">2</span>, <span class="string">'C'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.chain.from_iterable(enumerate(<span class="string">'ABC'</span>)))  <span class="comment"># å„å…ƒç´ æœ¬èº«å¿…é¡»æ˜¯å¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">[<span class="number">0</span>, <span class="string">'A'</span>, <span class="number">1</span>, <span class="string">'B'</span>, <span class="number">2</span>, <span class="string">'C'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(<span class="string">'ABC'</span>, range(<span class="number">5</span>)))</span><br><span class="line">[(<span class="string">'A'</span>, <span class="number">0</span>), (<span class="string">'B'</span>, <span class="number">1</span>), (<span class="string">'C'</span>, <span class="number">2</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(<span class="string">'ABC'</span>, range(<span class="number">5</span>), [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>]))  <span class="comment"># æœ€çŸ­çš„iteratoråˆ°å¤´æ—¶åœæ­¢</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="number">0</span>, <span class="number">10</span>), (<span class="string">'B'</span>, <span class="number">1</span>, <span class="number">20</span>), (<span class="string">'C'</span>, <span class="number">2</span>, <span class="number">30</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.zip_longest(<span class="string">'ABC'</span>, range(<span class="number">5</span>)))  <span class="comment"># æœ€é•¿çš„iteratoråˆ°å¤´æ—¶åœæ­¢ï¼Œé»˜è®¤ç”¨Noneå¡«å……ç©ºç¼ºçš„å€¼</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="number">0</span>), (<span class="string">'B'</span>, <span class="number">1</span>), (<span class="string">'C'</span>, <span class="number">2</span>), (<span class="literal">None</span>, <span class="number">3</span>), (<span class="literal">None</span>, <span class="number">4</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.zip_longest(<span class="string">'ABC'</span>, range(<span class="number">5</span>), fillvalue=<span class="string">'?'</span>))  <span class="comment"># ä½¿ç”¨æŒ‡å®šå­—ç¬¦å¡«å……</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="number">0</span>), (<span class="string">'B'</span>, <span class="number">1</span>), (<span class="string">'C'</span>, <span class="number">2</span>), (<span class="string">'?'</span>, <span class="number">3</span>), (<span class="string">'?'</span>, <span class="number">4</span>)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.product(<span class="string">'ABC'</span>, range(<span class="number">2</span>)))  <span class="comment"># ç”Ÿæˆ3*2ä¸ªå…ƒç»„</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="number">0</span>), (<span class="string">'A'</span>, <span class="number">1</span>), (<span class="string">'B'</span>, <span class="number">0</span>), (<span class="string">'B'</span>, <span class="number">1</span>), (<span class="string">'C'</span>, <span class="number">0</span>), (<span class="string">'C'</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>suits = <span class="string">'spades hearts diamonds clubs'</span>.split()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.product(<span class="string">'AK'</span>, suits))</span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'spades'</span>), (<span class="string">'A'</span>, <span class="string">'hearts'</span>), (<span class="string">'A'</span>, <span class="string">'diamonds'</span>), (<span class="string">'A'</span>, <span class="string">'clubs'</span>), (<span class="string">'K'</span>, <span class="string">'spades'</span>), (<span class="string">'K'</span>, <span class="string">'hearts'</span>), (<span class="string">'K'</span>, <span class="string">'diamonds'</span>), (<span class="string">'K'</span>, <span class="string">'clubs'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.product(<span class="string">'ABC'</span>))  <span class="comment"># å¦‚æžœä¼ å…¥ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼Œäº§å‡ºçš„æ˜¯ä¸€ç³»åˆ—åªæœ‰ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨</span></span><br><span class="line">[(<span class="string">'A'</span>,), (<span class="string">'B'</span>,), (<span class="string">'C'</span>,)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.product(<span class="string">'ABC'</span>, repeat=<span class="number">2</span>))  <span class="comment"># é‡å¤2æ¬¡</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'A'</span>), (<span class="string">'A'</span>, <span class="string">'B'</span>), (<span class="string">'A'</span>, <span class="string">'C'</span>), (<span class="string">'B'</span>, <span class="string">'A'</span>), (<span class="string">'B'</span>, <span class="string">'B'</span>), (<span class="string">'B'</span>, <span class="string">'C'</span>), (<span class="string">'C'</span>, <span class="string">'A'</span>), (<span class="string">'C'</span>, <span class="string">'B'</span>), (<span class="string">'C'</span>, <span class="string">'C'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.product(range(<span class="number">2</span>), repeat=<span class="number">3</span>))</span><br><span class="line">[(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rows = itertools.product(<span class="string">'AB'</span>, range(<span class="number">2</span>), repeat=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> row <span class="keyword">in</span> rows: print(row)</span><br><span class="line">...</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">0</span>, <span class="string">'A'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">0</span>, <span class="string">'A'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">0</span>, <span class="string">'B'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">0</span>, <span class="string">'B'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">1</span>, <span class="string">'A'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">1</span>, <span class="string">'A'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">1</span>, <span class="string">'B'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'A'</span>, <span class="number">1</span>, <span class="string">'B'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">0</span>, <span class="string">'A'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">0</span>, <span class="string">'A'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">0</span>, <span class="string">'B'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">0</span>, <span class="string">'B'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">1</span>, <span class="string">'A'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">1</span>, <span class="string">'A'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">1</span>, <span class="string">'B'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'B'</span>, <span class="number">1</span>, <span class="string">'B'</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="ç”¨äºŽæ‰©å±•å…ƒç´ ">ç”¨äºŽæ‰©å±•å…ƒç´ </h1><table><colgroup><col style="width: 10%"><col style="width: 20%"><col style="width: 70%"></colgroup><thead><tr class="header"><th>æ¨¡å—</th><th>å‡½æ•°</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>itertools</code></td><td><code>combinations(it, out_len)</code></td><td>æŠŠ <code>it</code> äº§å‡ºçš„ <code>out_len</code> ä¸ªå…ƒç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œç„¶åŽäº§å‡º</td></tr><tr class="even"><td><code>itertools</code></td><td><code>combinations_with_replacement(it, out_len)</code></td><td>æŠŠ <code>it</code> äº§å‡ºçš„ <code>out_len</code> ä¸ªå…ƒç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œç„¶åŽäº§å‡ºï¼ŒåŒ…å«ç›¸åŒå…ƒç´ çš„ç»„åˆ</td></tr><tr class="odd"><td><code>itertools</code></td><td><code>count(start=0, step=1)</code></td><td>ä»Ž <code>start</code> å¼€å§‹ä¸æ–­äº§å‡ºæ•°å­—ï¼ŒæŒ‰ <code>step</code> æŒ‡å®šçš„æ­¥å¹…å¢žåŠ </td></tr><tr class="even"><td><code>itertools</code></td><td><code>cycle(it)</code></td><td>ä»Ž <code>it</code> ä¸­äº§å‡ºå„ä¸ªå…ƒç´ ï¼Œå­˜å‚¨å„ä¸ªå…ƒç´ çš„å‰¯æœ¬ï¼Œç„¶åŽæŒ‰é¡ºåºé‡å¤ä¸æ–­åœ°äº§å‡ºå„ä¸ªå…ƒç´ </td></tr><tr class="odd"><td><code>itertools</code></td><td><code>permutations(it, out_len=None)</code></td><td>æŠŠ <code>out_len</code> ä¸ª <code>it</code> äº§å‡ºçš„å…ƒç´ æŽ’åˆ—åœ¨ä¸€èµ·ï¼Œç„¶åŽäº§å‡ºè¿™äº›æŽ’åˆ—ï¼›<code>out_len</code> çš„é»˜è®¤å€¼ç­‰äºŽ <code>len(list(it))</code></td></tr><tr class="even"><td><code>itertools</code></td><td><code>repeat(item, [times])</code></td><td>é‡å¤ä¸æ–­åœ°äº§å‡ºæŒ‡å®šçš„å…ƒç´ ï¼Œé™¤éžæä¾› <code>times</code>ï¼ŒæŒ‡å®šæ¬¡æ•°</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ct = itertools.count()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(ct), next(ct), next(ct)  <span class="comment"># ä¸èƒ½ä½¿ç”¨ctæž„å»ºåˆ—è¡¨ï¼Œå› ä¸ºctæ˜¯æ— ç©·çš„</span></span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)                                              <span class="comment"># å¦‚æžœä½¿ç”¨isliceæˆ–takewhileå‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.islice(itertools.count(<span class="number">1</span>, <span class="number">.3</span>), <span class="number">3</span>))  <span class="comment"># å¯ä»¥ä»Žcountç”Ÿæˆå™¨ä¸­æž„å»ºåˆ—è¡¨</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">1.3</span>, <span class="number">1.6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cy = itertools.cycle(<span class="string">'ABC'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.islice(cy, <span class="number">7</span>))  <span class="comment"># cyåŒæ ·æ˜¯æ— ç©·çš„</span></span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rp = itertools.repeat(<span class="number">7</span>)  <span class="comment"># æ— é™äº§å‡º7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(rp), next(rp)</span><br><span class="line">(<span class="number">7</span>, <span class="number">7</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.repeat(<span class="number">8</span>, <span class="number">4</span>))  <span class="comment"># é™åˆ¶æ¬¡æ•°</span></span><br><span class="line">[<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(operator.mul, range(<span class="number">11</span>), itertools.repeat(<span class="number">5</span>)))  <span class="comment"># ä¹˜æ•°å›ºå®šä¸º5</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">35</span>, <span class="number">40</span>, <span class="number">45</span>, <span class="number">50</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.combinations(<span class="string">'ABC'</span>, <span class="number">2</span>))  <span class="comment"># ä¸åŒå…ƒç´ çš„ç»„åˆï¼Œæ¬¡åºä¸é‡è¦</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'B'</span>), (<span class="string">'A'</span>, <span class="string">'C'</span>), (<span class="string">'B'</span>, <span class="string">'C'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.combinations_with_replacement(<span class="string">'ABC'</span>, <span class="number">2</span>))  <span class="comment"># å¯åŒ…å«ç›¸åŒå…ƒç´ çš„ç»„åˆ</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'A'</span>), (<span class="string">'A'</span>, <span class="string">'B'</span>), (<span class="string">'A'</span>, <span class="string">'C'</span>), (<span class="string">'B'</span>, <span class="string">'B'</span>), (<span class="string">'B'</span>, <span class="string">'C'</span>), (<span class="string">'C'</span>, <span class="string">'C'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.permutations(<span class="string">'ABC'</span>, <span class="number">2</span>))  <span class="comment"># æŽ’åˆ—ï¼Œæ¬¡åºé‡è¦</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'B'</span>), (<span class="string">'A'</span>, <span class="string">'C'</span>), (<span class="string">'B'</span>, <span class="string">'A'</span>), (<span class="string">'B'</span>, <span class="string">'C'</span>), (<span class="string">'C'</span>, <span class="string">'A'</span>), (<span class="string">'C'</span>, <span class="string">'B'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.product(<span class="string">'ABC'</span>, repeat=<span class="number">2</span>))  <span class="comment"># 'ABC'å’Œ'ABC'ï¼ˆrepeat=2çš„æ•ˆæžœï¼‰çš„ç¬›å¡å°”ç§¯</span></span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'A'</span>), (<span class="string">'A'</span>, <span class="string">'B'</span>), (<span class="string">'A'</span>, <span class="string">'C'</span>), (<span class="string">'B'</span>, <span class="string">'A'</span>), (<span class="string">'B'</span>, <span class="string">'B'</span>), (<span class="string">'B'</span>, <span class="string">'C'</span>), (<span class="string">'C'</span>, <span class="string">'A'</span>), (<span class="string">'C'</span>, <span class="string">'B'</span>), (<span class="string">'C'</span>, <span class="string">'C'</span>)]</span><br></pre></td></tr></table></figure><h1 id="ç”¨äºŽé‡æ–°æŽ’åˆ—å…ƒç´ ">ç”¨äºŽé‡æ–°æŽ’åˆ—å…ƒç´ </h1><table><colgroup><col style="width: 10%"><col style="width: 20%"><col style="width: 70%"></colgroup><thead><tr class="header"><th>æ¨¡å—</th><th>å‡½æ•°</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>itertools</code></td><td><code>groupby(it, key=None)</code></td><td>äº§å‡ºç”±ä¸¤ä¸ªå…ƒç´ ç»„æˆçš„å…ƒç´ ï¼Œå½¢å¼ä¸º <code>(key, group)</code>ï¼Œå…¶ä¸­ <code>key</code> æ˜¯åˆ†ç»„æ ‡å‡†ï¼Œ<code>group</code> æ˜¯ç”Ÿæˆå™¨ï¼Œç”¨äºŽäº§å‡ºåˆ†ç»„é‡Œçš„å…ƒç´ </td></tr><tr class="even"><td>å†…ç½®</td><td><code>reversed(seq)</code></td><td>ä»ŽåŽå‘å‰ï¼Œå€’åºäº§å‡º <code>seq</code> ä¸­çš„å…ƒç´ ï¼›<code>seq</code> å¿…é¡»æ˜¯åºåˆ—ï¼Œæˆ–è€…æ˜¯å®žçŽ°äº† <code>__reversed__</code> ç‰¹æ®Šæ–¹æ³•çš„å¯¹è±¡</td></tr><tr class="odd"><td><code>itertools</code></td><td><code>tee(it, n=2)</code></td><td>äº§å‡ºä¸€ä¸ªç”± n ä¸ªç”Ÿæˆå™¨ç»„æˆçš„å…ƒç»„ï¼Œæ¯ä¸ªç”Ÿæˆå™¨ç”¨äºŽå•ç‹¬äº§å‡ºè¾“å…¥çš„å¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ </td></tr></tbody></table><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.groupby(<span class="string">'LLLLAAGGG'</span>))</span><br><span class="line">[(<span class="string">'L'</span>, &lt;itertools._grouper object at <span class="number">0x103db4710</span>&gt;), (<span class="string">'A'</span>, &lt;itertools._grouper object at <span class="number">0x103db4390</span>&gt;), (<span class="string">'G'</span>, &lt;itertools._grouper object at <span class="number">0x103db4748</span>&gt;)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> char, group <span class="keyword">in</span> itertools.groupby(<span class="string">'LLLLAAGGG'</span>):</span><br><span class="line"><span class="meta">... </span>    print(char, <span class="string">'-&gt;'</span>, list(group))</span><br><span class="line">...</span><br><span class="line">L -&gt; ['L', 'L', 'L', 'L']</span><br><span class="line">A -&gt; ['A', 'A']</span><br><span class="line">G -&gt; ['G', 'G', 'G']</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>animals = [<span class="string">'duck'</span>, <span class="string">'eagle'</span>, <span class="string">'rat'</span>, <span class="string">'giraffe'</span>, <span class="string">'bear'</span>,</span><br><span class="line"><span class="meta">... </span>            <span class="string">'bat'</span>, <span class="string">'dolphin'</span>, <span class="string">'shark'</span>, <span class="string">'lion'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>animals.sort(key=len)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>animals</span><br><span class="line">[<span class="string">'rat'</span>, <span class="string">'bat'</span>, <span class="string">'duck'</span>, <span class="string">'bear'</span>, <span class="string">'lion'</span>, <span class="string">'eagle'</span>, <span class="string">'shark'</span>, <span class="string">'giraffe'</span>, <span class="string">'dolphin'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> length, group <span class="keyword">in</span> itertools.groupby(animals, len):</span><br><span class="line"><span class="meta">... </span>    print(length, <span class="string">'-&gt;'</span>, list(group))</span><br><span class="line">...</span><br><span class="line">3 -&gt; ['rat', 'bat']</span><br><span class="line">4 -&gt; ['duck', 'bear', 'lion']</span><br><span class="line">5 -&gt; ['eagle', 'shark']</span><br><span class="line">7 -&gt; ['giraffe', 'dolphin']</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> length, group <span class="keyword">in</span> itertools.groupby(reversed(animals), len):</span><br><span class="line"><span class="meta">... </span>    print(length, <span class="string">'-&gt;'</span>, list(group))</span><br><span class="line">...</span><br><span class="line">7 -&gt; ['dolphin', 'giraffe']</span><br><span class="line">5 -&gt; ['shark', 'eagle']</span><br><span class="line">4 -&gt; ['lion', 'bear', 'duck']</span><br><span class="line">3 -&gt; ['bat', 'rat']</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(itertools.tee(<span class="string">'ABC'</span>))</span><br><span class="line">[&lt;itertools._tee object at <span class="number">0x103db68c8</span>&gt;, &lt;itertools._tee object at <span class="number">0x103db6788</span>&gt;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g1, g2 = itertools.tee(<span class="string">'ABC'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(g1), next(g2)</span><br><span class="line">(<span class="string">'A'</span>, <span class="string">'A'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(g2)</span><br><span class="line"><span class="string">'B'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(g1)</span><br><span class="line">[<span class="string">'B'</span>, <span class="string">'C'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(g2)</span><br><span class="line">[<span class="string">'C'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(*itertools.tee(<span class="string">'ABC'</span>)))</span><br><span class="line">[(<span class="string">'A'</span>, <span class="string">'A'</span>), (<span class="string">'B'</span>, <span class="string">'B'</span>), (<span class="string">'C'</span>, <span class="string">'C'</span>)]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> generators </tag>
            
            <tag> itertools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨</title>
      <link href="/notes/fluent-python/iterables-iterators-and-generators/"/>
      <url>/notes/fluent-python/iterables-iterators-and-generators/</url>
      
        <content type="html"><![CDATA[<h1 id="sentenceç±»ç¬¬1ç‰ˆå•è¯åºåˆ—">Sentenceç±»ç¬¬1ç‰ˆï¼šå•è¯åºåˆ—</h1><figure class="highlight python"><figcaption><span>sentence.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"></span><br><span class="line">RE_WORD = re.compile(<span class="string">'\w+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sentence</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.words = RE_WORD.findall(text)  <span class="comment"># è¿”å›žå…¨éƒ¨è²é‡å åŒ¹é…</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.words[index]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.words)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Sentence(%s)'</span> % reprlib.repr(self.text)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sentence <span class="keyword">import</span> Sentence</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Sentence(<span class="string">'"The time has come," the Walrus said,'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">Sentence(<span class="string">'"The time ha... Walrus said,'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(s)  <span class="comment"># Sentenceå®žä¾‹æ˜¯å¯è¿­ä»£çš„ï¼Œå› æ­¤å¯ä»¥ç”¨äºŽæž„å»ºåˆ—è¡¨å’Œå…¶ä»–å¯è¿­ä»£çš„ç±»åž‹</span></span><br><span class="line">[<span class="string">'The'</span>, <span class="string">'time'</span>, <span class="string">'has'</span>, <span class="string">'come'</span>, <span class="string">'the'</span>, <span class="string">'Walrus'</span>, <span class="string">'said'</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(s, abc.Iterable)  <span class="comment"># è™½ç„¶å¯ä»¥è¿­ä»£ï¼Œä½†æ— æ³•é€šè¿‡isinstanceæ£€æµ‹</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(Sentence, abc.Iterable)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>è§£é‡Šå™¨éœ€è¦è¿­ä»£å¯¹è±¡xæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨iter(x)ã€‚å†…ç½®çš„iterå‡½æ•°æœ‰ä»¥ä¸‹ä½œç”¨ã€‚</p><ol type="1"><li>æ£€æŸ¥å¯¹è±¡æ˜¯å¦å®žçŽ°äº†<code>__iter__</code>æ–¹æ³•ï¼Œå¦‚æžœå®žçŽ°äº†å°±è°ƒç”¨å®ƒï¼ŒèŽ·å–ä¸€ä¸ªè¿­ä»£å™¨ã€‚</li><li>å¦‚æžœæ²¡æœ‰å®žçŽ°<code>__iter__</code>æ–¹æ³•ï¼Œä½†æ˜¯å®žçŽ°äº†<code>__getitem__</code>æ–¹æ³•ï¼ŒPythonä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå°è¯•æŒ‰é¡ºåºèŽ·å–å…ƒç´ ã€‚</li><li>å¦‚æžœå°è¯•å¤±è´¥ï¼ŒPythonæŠ›å‡ºTypeErrorå¼‚å¸¸ï¼Œé€šå¸¸ä¼šæç¤ºâ€œC object is not iterableâ€ï¼Œå…¶ä¸­Cæ˜¯ç›®æ ‡å¯¹è±¡æ‰€å±žçš„ç±»ã€‚</li></ol><p>ä»»ä½•Pythonåºåˆ—éƒ½å¯è¿­ä»£çš„åŽŸå› æ˜¯ï¼Œå®ƒä»¬éƒ½å®žçŽ°äº†<code>__getitem__</code>æ–¹æ³•ã€‚å…¶å®žï¼Œæ ‡å‡†çš„åºåˆ—ä¹Ÿéƒ½å®žçŽ°äº†<code>__iter__</code>æ–¹æ³•ï¼Œå› æ­¤ä½ ä¹Ÿåº”è¯¥è¿™ä¹ˆåšã€‚ä¹‹æ‰€ä»¥å¯¹<code>__getitem__</code>æ–¹æ³•åšç‰¹æ®Šå¤„ç†ï¼Œæ˜¯ä¸ºäº†å‘åŽå…¼å®¹ï¼Œè€Œæœªæ¥å¯èƒ½ä¸ä¼šå†è¿™ä¹ˆåšã€‚</p><p>å› ä¸ºabc.Iterableç±»å®žçŽ°äº†<code>__subclasshook__</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†å®šä¹‰äº†<code>__iter__</code>æ–¹æ³•çš„ç±»è®¤ä½œè‡ªå·±çš„è™šæ‹Ÿå­ç±»ã€‚å› æ­¤ï¼Œè™½ç„¶Sentenceç±»å¯ä»¥è¿­ä»£ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡issubclass(Sentence, abc.Iterable)æµ‹è¯•ã€‚</p><p><strong>ä»ŽPython3.4å¼€å§‹ï¼Œæ£€æŸ¥å¯¹è±¡xèƒ½å¦è¿­ä»£ï¼Œæœ€å‡†ç¡®çš„æ–¹æ³•æ˜¯ï¼šè°ƒç”¨iter(x)å‡½æ•°ï¼Œå¦‚æžœä¸å¯è¿­ä»£ï¼Œå†å¤„ç†TypeErrorå¼‚å¸¸ã€‚</strong>è¿™æ¯”ä½¿ç”¨isinstance(x, abc.Iterable)æ›´å‡†ç¡®ï¼Œå› ä¸ºiter(x)å‡½æ•°ä¼šè€ƒè™‘åˆ°é—ç•™çš„<code>__getitem__</code>æ–¹æ³•ï¼Œè€Œabc.Iterableç±»åˆ™ä¸è€ƒè™‘ã€‚</p><h2 id="å¯è¿­ä»£çš„å¯¹è±¡ä¸Žè¿­ä»£å™¨çš„å¯¹æ¯”">å¯è¿­ä»£çš„å¯¹è±¡ä¸Žè¿­ä»£å™¨çš„å¯¹æ¯”</h2><p>å¯è¿­ä»£çš„å¯¹è±¡ï¼šä½¿ç”¨iterå†…ç½®å‡½æ•°å¯ä»¥èŽ·å–è¿­ä»£å™¨çš„å¯¹è±¡ã€‚å¦‚æžœå¯¹è±¡å®žçŽ°äº†èƒ½è¿”å›žè¿­ä»£å™¨çš„<code>__iter__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå¯¹è±¡å°±æ˜¯å¯è¿­ä»£çš„ã€‚åºåˆ—éƒ½å¯ä»¥è¿­ä»£ï¼›å®žçŽ°äº†<code>__getitem__</code>æ–¹æ³•ï¼Œè€Œä¸”å…¶å‚æ•°æ˜¯ä»Žé›¶å¼€å§‹çš„ç´¢å¼•ï¼Œè¿™ç§å¯¹è±¡ä¹Ÿå¯ä»¥è¿­ä»£ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> char <span class="keyword">in</span> s:  <span class="comment"># ä½¿ç”¨forå¾ªçŽ¯è¿­ä»£ï¼ŒèƒŒåŽæœ‰è¿­ä»£å™¨ï¼Œä½†æ˜¯çœ‹ä¸åˆ°</span></span><br><span class="line"><span class="meta">... </span>    print(char)</span><br><span class="line">...</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>it = iter(s)  <span class="comment"># ä½¿ç”¨è¿­ä»£å™¨è¿­ä»£</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>        print(next(it))</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">except</span> StopIteration:  <span class="comment"># è¿­ä»£å™¨åˆ°å¤´</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">del</span> it  <span class="comment"># é‡Šæ”¾å¼•ç”¨</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">break</span></span><br><span class="line">...</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYIamgBYbAJ2vHy2n9BKfCoabLgEPI089gc4IjGdLkQab6VagjGdny9b1HV3nNBPgsalmYlDhoKYjAWDh02h0ObfTVagfGb9cUKQAGdmPt25ZvqzRjJ_PEVZwh1IQgLmVJ-6pQpcURfq9KxPhoOltI5_kdF9qzxycEXYSxLi6SzNJTl2VxkhbIyr8KGBPWimge2cn8IcgQ0jnmZUBKd3HDAx0421IbbfGMvIc0H1KKb1KWLa4CVpPdpOjTgn5Mm0FIfaPN5s45N5XFJyyE4MnM2i_cjJpTlGi0"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Iterator</span><span class="params">(Iterable)</span>:</span>  <span class="comment"># abc.Iteratorç±»æºç </span></span><br><span class="line"></span><br><span class="line">    __slots__ = ()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'Return the next item from the iterator. When exhausted, raise StopIteration'</span></span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__subclasshook__</span><span class="params">(cls, C)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">is</span> Iterator:</span><br><span class="line">            <span class="keyword">if</span> (any(<span class="string">"__next__"</span> <span class="keyword">in</span> B.__dict__ <span class="keyword">for</span> B <span class="keyword">in</span> C.__mro__) <span class="keyword">and</span></span><br><span class="line">                any(<span class="string">"__iter__"</span> <span class="keyword">in</span> B.__dict__ <span class="keyword">for</span> B <span class="keyword">in</span> C.__mro__)):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Sentence(<span class="string">'A B'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>it = iter(s)  <span class="comment"># èŽ·å–è¿­ä»£å™¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(it)  <span class="comment"># èŽ·å–ä¸‹ä¸€ä¸ªå•è¯</span></span><br><span class="line"><span class="string">'A'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(it)</span><br><span class="line"><span class="string">'B'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(it)  <span class="comment"># è¿­ä»£åˆ°å¤´</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(it)  <span class="comment"># è¿­ä»£å™¨ç©ºäº†</span></span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(iter(s))  <span class="comment"># é‡æ–°æž„å»ºè¿­ä»£å™¨</span></span><br><span class="line">[<span class="string">'A'</span>, <span class="string">'B'</span>]</span><br></pre></td></tr></table></figure><h1 id="sentenceç±»ç¬¬2ç‰ˆå…¸åž‹çš„è¿­ä»£å™¨">Sentenceç±»ç¬¬2ç‰ˆï¼šå…¸åž‹çš„è¿­ä»£å™¨</h1><figure class="highlight python"><figcaption><span>sentence_iter.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"></span><br><span class="line">RE_WORD = re.compile(<span class="string">'\w+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sentence</span>:</span>  <span class="comment"># ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼å®žçŽ°Sentenceç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.words = RW_WORD.findall(text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Sentence(%s)'</span> % reprlib.repr(self.text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>  <span class="comment"># å®žä¾‹åŒ–å¹¶è¿”å›žä¸€ä¸ªè¿­ä»£å™¨</span></span><br><span class="line">        <span class="keyword">return</span> SentenceIterator(self.words)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SentenceIterator</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, words)</span>:</span></span><br><span class="line">        self.words = words  <span class="comment"># å¼•ç”¨å•è¯åˆ—è¡¨</span></span><br><span class="line">        self.index = <span class="number">0</span>  <span class="comment"># ä¸‹ä¸€ä¸ªè¦èŽ·å–çš„å•è¯</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            word = self.words[index]  <span class="comment"># èŽ·å–ç´¢å¼•ä½ä¸Šçš„å•è¯</span></span><br><span class="line">        <span class="keyword">except</span> IndexError:  <span class="comment"># å¦‚æžœç´¢å¼•ä½ä¸Šæ²¡æœ‰å•è¯</span></span><br><span class="line">            <span class="keyword">raise</span> StopIteration()  <span class="comment"># æŠ›å‡ºStopIterationå¼‚å¸¸</span></span><br><span class="line">        self.index += <span class="number">1</span>  <span class="comment"># é€’å¢žç´¢å¼•</span></span><br><span class="line">        <span class="keyword">return</span> word  <span class="comment"># è¿”å›žå•è¯</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>  <span class="comment"># è¿­ä»£å™¨åº”è¯¥ä¸€ç›´å¯ä»¥è¿­ä»£</span></span><br><span class="line">        <span class="keyword">return</span> self  <span class="comment"># å› æ­¤__iter__æ–¹æ³•åº”è¯¥è¿”å›žè‡ªèº«</span></span><br></pre></td></tr></table></figure><p>å¯¹è¿™ä¸ªç¤ºä¾‹æ¥è¯´ï¼Œå…¶å®žæ²¡å¿…è¦åœ¨SentenceIteratorç±»ä¸­å®žçŽ°<code>__iter__</code>æ–¹æ³•ï¼Œä¸è¿‡è¿™ä¹ˆåšæ˜¯å¯¹çš„ï¼Œå› ä¸ºè¿­ä»£å™¨åº”è¯¥å®žçŽ°<code>__next__</code>å’Œ<code>__iter__</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œä¸”è¿™ä¹ˆåšèƒ½è®©è¿­ä»£å™¨é€šè¿‡<code>issubclass(SentenceIterator, abc.Iterator)</code>æµ‹è¯•ã€‚å¦‚æžœè®©SentenceIteratorç±»ç»§æ‰¿abc.Iteratorç±»ï¼Œé‚£ä¹ˆå®ƒä¼šç»§æ‰¿<code>abc.Iterator.__iter__</code>è¿™ä¸ªå…·ä½“æ–¹æ³•ã€‚</p><h2 id="æŠŠsentenceç¼–ç¨‹è¿­ä»£å™¨åä¸»æ„">æŠŠSentenceç¼–ç¨‹è¿­ä»£å™¨ï¼šåä¸»æ„</h2><p>æž„å»ºå¯è¿­ä»£çš„å¯¹è±¡å’Œè¿­ä»£å™¨æ—¶ç»å¸¸ä¼šå‡ºçŽ°é”™è¯¯ï¼ŒåŽŸå› æ˜¯æ··æ·†äº†äºŒè€…ã€‚å¯è¿­ä»£çš„å¯¹è±¡æœ‰ä¸ª<code>__iter__</code>æ–¹æ³•ï¼Œæ¯æ¬¡éƒ½å®žä¾‹åŒ–ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼›è€Œè¿­ä»£å™¨è¦å®žçŽ°<code>__next__</code>æ–¹æ³•ï¼Œè¿”å›žå•ä¸ªå…ƒç´ ï¼Œæ­¤å¤–è¿˜è¦å®žçŽ°<code>__iter__</code>æ–¹æ³•ï¼Œè¿”å›žè¿­ä»£å™¨æœ¬èº«ã€‚</p><p>é™¤äº†<code>__iter__</code>æ–¹æ³•ä¹‹å¤–ï¼Œä½ å¯èƒ½è¿˜æƒ³åœ¨Sentenceç±»ä¸­å®žçŽ°<code>__next__</code>æ–¹æ³•ï¼Œè®©Sentenceå®žä¾‹æ—¢æ˜¯å¯è¿­ä»£çš„å¯¹è±¡ï¼Œä¹Ÿæ˜¯è‡ªèº«çš„è¿­ä»£å™¨ã€‚å¯æ˜¯ï¼Œè¿™ç§æƒ³æ³•éžå¸¸ç³Ÿç³•ã€‚</p><p>è¿­ä»£å™¨æ¨¡å¼å¯ç”¨æ¥ï¼šï¼ˆå‡ºè‡ªã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ï¼‰</p><ul><li>è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤º</li><li>æ”¯æŒå¯¹èšåˆå¯¹è±¡çš„å¤šç§éåŽ†</li><li>ä¸ºéåŽ†ä¸åŒçš„èšåˆç»“æž„æä¾›ä¸€ä¸ªåŒä¸€çš„æŽ¥å£ï¼ˆæ—¢æ”¯æŒå¤šæ€è¿­ä»£ï¼‰</li></ul><p>ä¸ºäº†â€œæ”¯æŒå¤šç§éåŽ†â€ï¼Œå¿…é¡»èƒ½ä»ŽåŒä¸€ä¸ªå¯è¿­ä»£çš„å®žä¾‹ä¸­èŽ·å–å¤šä¸ªç‹¬ç«‹çš„è¿­ä»£å™¨ï¼Œè€Œä¸”å„ä¸ªè¿­ä»£å™¨è¦èƒ½ç»´æŠ¤è‡ªèº«çš„å†…éƒ¨çŠ¶æ€ï¼Œå› æ­¤è¿™ä¸€æ¨¡å¼æ­£ç¡®çš„å®žçŽ°æ–¹å¼æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨iter(my_iterable)éƒ½æž„å»ºä¸€ä¸ªç‹¬ç«‹çš„è¿­ä»£å™¨ã€‚</p><h1 id="sentenceç±»ç¬¬3ç‰ˆç”Ÿæˆå™¨å‡½æ•°">Sentenceç±»ç¬¬3ç‰ˆï¼šç”Ÿæˆå™¨å‡½æ•°</h1><p>ç”¨ç”Ÿæˆå™¨å‡½æ•°ä»£æ›¿SentenceIteratorç±»ã€‚</p><figure class="highlight python"><figcaption><span>sentence_gen.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"></span><br><span class="line">RE_WORD = re.compile(<span class="string">'\w+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sentence</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.words = RE_WORD.findall(text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Sentence(%s)'</span> % reprlib.repr(self.text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> self.words:</span><br><span class="line">            <span class="keyword">yield</span> word  <span class="comment"># äº§å‡ºå½“å‰çš„word</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p><code>__iter__</code>æ–¹æ³•çš„returnè¯­å¥ä¸æ˜¯å¿…è¦çš„ï¼›è¿™ä¸ªå‡½æ•°å¯ä»¥ç›´æŽ¥â€œè½ç©ºâ€ï¼Œè‡ªåŠ¨è¿”å›žã€‚ä¸ç®¡æœ‰æ²¡æœ‰returnè¯­å¥ï¼Œç”Ÿæˆå™¨å‡½æ•°éƒ½ä¸ä¼šæŠ›å‡ºStopIterationå¼‚å¸¸ï¼Œè€Œæ˜¯åœ¨ç”Ÿæˆå®Œå…¨éƒ¨å€¼ä¹‹åŽç›´æŽ¥é€€å‡ºã€‚</p><h2 id="ç”Ÿæˆå™¨å‡½æ•°çš„å·¥ä½œåŽŸç†">ç”Ÿæˆå™¨å‡½æ•°çš„å·¥ä½œåŽŸç†</h2><p>åªè¦Pythonå‡½æ•°çš„å®šä¹‰ä½“ä¸­æœ‰yieldå…³é”®å­—ï¼Œè¯¥å‡½æ•°å°±æ˜¯ç”Ÿæˆå™¨å‡½æ•°ã€‚è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œä¼šè¿”å›žä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿæˆå™¨å‡½æ•°æ˜¯ç”Ÿæˆå™¨å·¥åŽ‚ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span>  <span class="comment"># åªè¦åŒ…å«å…³é”®å­—yieldï¼Œè¯¥å‡½æ•°å°±æ˜¯ç”Ÿæˆå™¨å‡½æ•°</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'start'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="number">1</span>  <span class="comment"># ç”Ÿæˆå™¨å‡½æ•°çš„å®šä¹‰ä½“ä¸­é€šå¸¸éƒ½æœ‰å¾ªçŽ¯</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'continue'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="number">2</span>  <span class="comment"># ä¸è¿‡è¿™ä¸æ˜¯å¿…è¦æ¡ä»¶</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'end'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen  <span class="comment"># å‡½æ•°å¯¹è±¡</span></span><br><span class="line">&lt;function gen at <span class="number">0x10094ec80</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen()  <span class="comment"># è°ƒç”¨æ—¶è¿”å›žä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</span></span><br><span class="line">&lt;generator object gen at <span class="number">0x10094dba0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> gen():</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line">...</span><br><span class="line">start</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">end</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = gen()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(g)  <span class="comment"># ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œä¼šæ‰“å°'start'ï¼Œç„¶åŽåœåœ¨ç¬¬ä¸€ä¸ªyieldè¯­å¥</span></span><br><span class="line">start</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(g)  <span class="comment"># ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œæ‰“å°'continue'ï¼Œåœåœ¨ç¬¬äºŒä¸ªyieldè¯­å¥</span></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(g)  <span class="comment"># ç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼Œæ‰“å°'end'ï¼Œåˆ°è¾¾å®šä¹‰ä½“æœ«å°¾ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">end</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure><h1 id="sentenceç±»ç¬¬4ç‰ˆæƒ°æ€§å®žçŽ°">Sentenceç±»ç¬¬4ç‰ˆï¼šæƒ°æ€§å®žçŽ°</h1><p>æƒ°æ€§æ±‚å€¼ï¼ˆlazy evaluationï¼‰å’ŒåŠæ—©æ±‚å€¼ï¼ˆeager evaluationï¼‰æ˜¯ç¼–ç¨‹è¯­è¨€ç†è®ºæ–¹é¢çš„æŠ€æœ¯ç”¨è¯­ã€‚</p><p>ç›®å‰å®žçŽ°çš„å‡ ç‰ˆSentenceç±»éƒ½ä¸å¤Ÿæƒ°æ€§ï¼Œå› ä¸º<code>__init__</code>æ–¹æ³•æ€¥è¿«åœ°æž„å»ºå¥½äº†æ–‡æœ¬ä¸­çš„å•è¯åˆ—è¡¨ï¼Œç„¶åŽå°†å…¶ç»‘å®šåˆ°self.wordså±žæ€§ä¸Šã€‚è¿™æ ·å°±å¾—å¤„ç†æ•´ä¸ªæ–‡æœ¬ï¼Œåˆ—è¡¨ä½¿ç”¨çš„å†…å­˜é‡å¯èƒ½ä¸Žæ–‡æœ¬æœ¬èº«ä¸€æ ·å¤šï¼ˆèŽ·å–æ›´å¤šï¼Œè¿™å–å†³äºŽæ–‡æœ¬ä¸­æœ‰å¤šå°‘éžå•è¯å­—ç¬¦ï¼‰ã€‚å¦‚æžœåªéœ€è¿­ä»£å‰å‡ ä¸ªå•è¯ï¼Œå¤§å¤šæ•°å·¥ä½œéƒ½æ˜¯ç™½è´¹åŠ›æ°”ã€‚</p><p>åªè¦ä½¿ç”¨Python3ï¼Œæ€ç´¢ç€åšæŸä»¶äº‹æœ‰æ²¡æœ‰æ‡’æƒ°çš„æ–¹å¼ï¼Œç­”æ¡ˆé€šå¸¸éƒ½æ˜¯è‚¯å®šçš„ã€‚re.finditerå‡½æ•°æ˜¯re.findallå‡½æ•°çš„æƒ°æ€§ç‰ˆæœ¬ï¼Œè¿”å›žä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒæŒ‰éœ€ç”Ÿæˆre.MatchObjectå®žä¾‹ã€‚å¦‚æžœæœ‰å¾ˆå¤šåŒ¹é…ï¼Œre.finditerå‡½æ•°èƒ½èŠ‚çœå¤§é‡å†…å­˜ã€‚</p><figure class="highlight python"><figcaption><span>sentence_gen2.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"></span><br><span class="line">RE_WORD = re.compile(<span class="string">'\w+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sentence</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.text = text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Sentence(%s)'</span> % reprlib.repr(self.text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> match <span class="keyword">in</span> RE_WORD.finditer(self.text):</span><br><span class="line">            <span class="keyword">yield</span> match.group()  <span class="comment"># æå–å…·ä½“æ–‡æœ¬</span></span><br></pre></td></tr></table></figure><h1 id="sentenceç±»ç¬¬5ç‰ˆç”Ÿæˆå™¨è¡¨è¾¾å¼">Sentenceç±»ç¬¬5ç‰ˆï¼šç”Ÿæˆå™¨è¡¨è¾¾å¼</h1><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼å¯ä»¥ç†è§£ä¸ºåˆ—è¡¨æŽ¨å¯¼çš„æƒ°æ€§ç‰ˆæœ¬ï¼šä¸ä¼šè¿«åˆ‡åœ°æž„å»ºåˆ—è¡¨ï¼Œè€Œæ˜¯è¿”å›žä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒæŒ‰éœ€æƒ°æ€§ç”Ÿæˆå…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'yield 1'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'yield 2'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res1 = [x * <span class="number">3</span> <span class="keyword">for</span> x <span class="keyword">in</span> gen()]  <span class="comment"># åˆ—è¡¨æŽ¨å¯¼</span></span><br><span class="line"><span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">yield</span> <span class="number">2</span>  <span class="comment"># genå‡½æ•°å…¨éƒ¨è¿è¡Œ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res1</span><br><span class="line">[<span class="number">3</span>, <span class="number">6</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res2 = (x * <span class="number">3</span> <span class="keyword">for</span> x <span class="keyword">in</span> gen())  <span class="comment"># ç”Ÿæˆå™¨ï¼Œgenå‡½æ•°æ²¡æœ‰è¿è¡Œï¼Œæ•…æ²¡æœ‰ä»»ä½•è¾“å‡º</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res2</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x10094daf0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> res2:  <span class="comment"># å¾ªçŽ¯è¿­ä»£res2æ—¶ï¼Œgenå‡½æ•°æ‰ä¼šçœŸæ­£æ‰§è¡Œ</span></span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line">...</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="keyword">yield</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><figcaption><span>sentence_genexp.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"></span><br><span class="line">RE_WORD = re.compile(<span class="string">'\w+'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sentence</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        self.text = text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Sentence(%s)'</span> % reprlib.repr(self.text)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (match.group() <span class="keyword">for</span> match <span class="keyword">in</span> RE_WORD.finditer(self.text))</span><br></pre></td></tr></table></figure><p><code>__iter__</code>ä¸æ˜¯ç”Ÿæˆå™¨å‡½æ•°äº†ï¼ˆæ²¡æœ‰yieldï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼æž„å»ºç”Ÿæˆå™¨ï¼Œç„¶åŽå°†å…¶è¿”å›žã€‚ä¸è¿‡ï¼Œæœ€ç»ˆçš„æ•ˆæžœä¸€æ ·ï¼šè°ƒç”¨<code>__iter__</code>æ–¹æ³•ä¼šå¾—åˆ°ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯è¯­æ³•ç³–ï¼šå®Œå…¨å¯ä»¥æ›¿æ¢æˆç”Ÿæˆå™¨å‡½æ•°ï¼Œä¸è¿‡æœ‰æ—¶ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼æ›´ä¾¿åˆ©ã€‚</p><h1 id="ä½•æ—¶ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼">ä½•æ—¶ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼</h1><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯åˆ›å»ºç”Ÿæˆå™¨çš„ç®€æ´å¥æ³•ï¼Œè¿™æ ·æ— éœ€å…ˆå®šä¹‰å‡½æ•°å†è°ƒç”¨ã€‚ä¸è¿‡ç”Ÿæˆå™¨å‡½æ•°çµæ´»å¾—å¤šï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªè¯­å¥å®žçŽ°å¤æ‚çš„é€»è¾‘ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºåç¨‹ä½¿ç”¨ã€‚</p><p>é‡åˆ°ç®€å•çš„æƒ…å†µæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œå› ä¸ºè¿™æ ·æ‰«ä¸€çœ¼å°±çŸ¥é“ä»£ç çš„ä½œç”¨ï¼›å¦‚æžœç”Ÿæˆå™¨è¡¨è¾¾å¼è¦åˆ†æˆå¤šè¡Œå†™ï¼Œå€¾å‘äºŽå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œä»¥ä¾¿æé«˜å¯è¯»æ€§ã€‚æ­¤å¤–ï¼Œç”Ÿæˆå™¨å‡½æ•°æœ‰åç§°ï¼Œå› æ­¤å¯ä»¥é‡ç”¨ã€‚</p><h1 id="å¦ä¸€ä¸ªç¤ºä¾‹ç­‰å·®æ•°åˆ—ç”Ÿæˆå™¨">å¦ä¸€ä¸ªç¤ºä¾‹ï¼šç­‰å·®æ•°åˆ—ç”Ÿæˆå™¨</h1><p>å…¸åž‹çš„è¿­ä»£å™¨æ¨¡å¼ä½œç”¨å¾ˆç®€å•â€”â€”éåŽ†æ•°æ®ç»“æž„ã€‚ä¸è¿‡ï¼Œå³ä¾¿ä¸æ˜¯ä»Žé›†åˆä¸­èŽ·å–å…ƒç´ ï¼Œè€Œæ˜¯èŽ·å–åºåˆ—ä¸­å³æ—¶ç”Ÿæˆçš„ä¸‹ä¸€ä¸ªå€¼æ—¶ï¼Œä¹Ÿç”¨å¾—åˆ°è¿™ç§åŸºäºŽæ–¹æ³•çš„æ ‡å‡†æŽ¥å£ã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„rangeå‡½æ•°ç”¨äºŽç”Ÿæˆæœ‰ç©·æ•´æ•°ç­‰å·®æ•°åˆ—ï¼ˆArithmetic Progressionï¼ŒAPï¼‰ï¼Œitertools.countå‡½æ•°ç”¨äºŽç”Ÿæˆæ— ç©·ç­‰å·®æ•°åˆ—ã€‚</p><figure class="highlight python"><figcaption><span>arithmetic_progression.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArithmeticProgression</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, begin, step, end=None)</span>:</span></span><br><span class="line">        self.begin = begin</span><br><span class="line">        self.step = step</span><br><span class="line">        self.end = end  <span class="comment"># None -&gt; æ— ç©·æ•°åˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = type(self.begin + self.step)(self.begin)  <span class="comment"># å¼ºåˆ¶è½¬æ¢ç±»åž‹</span></span><br><span class="line">        forever = self.end <span class="keyword">is</span> <span class="literal">None</span>  <span class="comment"># æé«˜å¯è¯»æ€§</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> forever <span class="keyword">or</span> result &lt; self.end:</span><br><span class="line">            <span class="keyword">yield</span> result</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            result = self.begin + self.step * index  <span class="comment"># æ²¡æœ‰ç´¯åŠ ï¼Œä¸ºäº†é™ä½Žå¤„ç†æµ®ç‚¹æ•°æ—¶ç´¯ç§¯æ•ˆåº”è‡´é”™çš„é£Žé™©</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> arithmetic_progression <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ap = ArithmeticProgression(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>)  <span class="comment"># æ•´åž‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(ap)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ap = ArithmeticProgression(<span class="number">1</span>, <span class="number">.5</span>, <span class="number">3</span>)  <span class="comment"># æµ®ç‚¹åž‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(ap)</span><br><span class="line">[<span class="number">1.0</span>, <span class="number">1.5</span>, <span class="number">2.0</span>, <span class="number">2.5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ap = ArithmeticProgression(<span class="number">0</span>, <span class="number">1</span>/<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(ap)</span><br><span class="line">[<span class="number">0.0</span>, <span class="number">0.3333333333333333</span>, <span class="number">0.6666666666666666</span>]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ap = ArithmeticProgression(<span class="number">0</span>, Fraction(<span class="number">1</span>, <span class="number">3</span>), <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(ap)</span><br><span class="line">[Fraction(<span class="number">0</span>, <span class="number">1</span>), Fraction(<span class="number">1</span>, <span class="number">3</span>), Fraction(<span class="number">2</span>, <span class="number">3</span>)]  <span class="comment"># ç¬¬ä¸€ä¸ªæ•°è¢«è½¬æ¢æˆäº†Fractionç±»åž‹</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ap = ArithmeticProgression(<span class="number">0</span>, Decimal(<span class="string">'.1'</span>), <span class="number">.3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(ap)</span><br><span class="line">[Decimal(<span class="string">'0'</span>), Decimal(<span class="string">'0.1'</span>), Decimal(<span class="string">'0.2'</span>)]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜Žäº†å¦‚ä½•ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°å®žçŽ°ç‰¹æ®Šçš„<code>__iter__</code>æ–¹æ³•ã€‚ç„¶è€Œï¼Œå¦‚æžœä¸€ä¸ªç±»åªæ˜¯ä¸ºäº†æž„å»ºç”Ÿæˆå™¨è€ŒåŽ»å®žçŽ°<code>__iter__</code>æ–¹æ³•ï¼Œé‚£è¿˜ä¸å¦‚ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aritprog_gen</span><span class="params">(begin, step, end=None)</span>:</span></span><br><span class="line">    result = type(self.begin + self.step)(self.begin)</span><br><span class="line">    forever = self.end <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> forever <span class="keyword">or</span> result &lt; self.end:</span><br><span class="line">        <span class="keyword">yield</span> result</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">        result = self.begin + self.step * index</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨itertoolsæ¨¡å—ç”Ÿæˆç­‰å·®æ•°åˆ—">ä½¿ç”¨itertoolsæ¨¡å—ç”Ÿæˆç­‰å·®æ•°åˆ—</h2><p>Python3.4ä¸­çš„<a href="https://devdocs.io/python~3.6/library/itertools" target="_blank" rel="noopener">itertools</a>æ¨¡å—æä¾›äº†19ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œç»“åˆèµ·æ¥ä½¿ç”¨èƒ½å®žçŽ°å¾ˆå¤šæœ‰è¶£çš„ç”¨æ³•ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/itertools#itertools.count" target="_blank" rel="noopener"><code>itertools.count(start=0, step=1)</code></a></p><p>Make an iterator that returns evenly spaced values starting with number start. Often used as an argument to map() to generate consecutive data points. Also, used with zip() to add sequence numbers. Roughly equivalent to:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(start=<span class="number">0</span>, step=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="comment"># count(10) --&gt; 10 11 12 13 14 ...</span></span><br><span class="line">    <span class="comment"># count(2.5, 0.5) -&gt; 2.5 3.0 3.5 ...</span></span><br><span class="line">    n = start</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> n</span><br><span class="line">        n += step</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>When counting with floating point numbers, better accuracy can sometimes be achieved by substituting multiplicative code such as: <code>(start + step * i for i in count())</code>.</p></blockquote><p>itertools.countå‡½æ•°è¿”å›žçš„ç”Ÿæˆå™¨èƒ½ç”Ÿæˆç­‰å·®æ•°åˆ—ã€‚ç„¶è€Œï¼Œitertools.countå‡½æ•°ä»Žä¸åœæ­¢ã€‚å› æ­¤ï¼Œå¦‚æžœè°ƒç”¨list(count())ï¼ŒPythonä¼šåˆ›å»ºä¸€ä¸ªç‰¹åˆ«å¤§çš„åˆ—è¡¨ï¼Œè¶…å‡ºå¯ç”¨å†…å­˜ï¼Œåœ¨è°ƒç”¨å¤±è´¥ä¹‹å‰ï¼Œç”µè„‘ä¼šç–¯ç‹‚åœ°è¿è½¬ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/itertools#itertools.takewhile" target="_blank" rel="noopener"><code>itertools.takewhile(predicate, iterable)</code></a></p><p>Make an iterator that returns elements from the iterable as long as the predicate is true. Roughly equivalent to:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">takewhile</span><span class="params">(predicate, iterable)</span>:</span></span><br><span class="line">    <span class="comment"># takewhile(lambda x: x&lt;5, [1,4,6,4,1]) --&gt; 1 4</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> predicate(x):</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></blockquote><p>itertools.takewhileå‡½æ•°åˆ™ä¸åŒï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªä½¿ç”¨å¦ä¸€ä¸ªç”Ÿæˆå™¨çš„ç”Ÿæˆå™¨ï¼Œåœ¨æŒ‡å®šçš„æ¡ä»¶è®¡ç®—ç»“æžœä¸ºfalseæ—¶åœæ­¢ã€‚å› æ­¤ï¼Œå¯ä»¥æŠŠè¿™ä¸¤ä¸ªå‡½æ•°ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> itertools</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gen = itertools.takewhile(<span class="keyword">lambda</span> n: n &lt; <span class="number">3</span>, itertools.count(<span class="number">1</span>, <span class="number">.5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(gen)</span><br><span class="line">[<span class="number">1</span>, <span class="number">1.5</span>, <span class="number">2.0</span>, <span class="number">2.5</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aritprog_gen</span><span class="params">(begin, step, end=None)</span>:</span>  <span class="comment"># åˆ©ç”¨å·²æœ‰çš„ç”Ÿæˆå™¨å®žçŽ°</span></span><br><span class="line">    first = type(begin + step)(begin)</span><br><span class="line">    ap_gen = itertools.count(first, step)</span><br><span class="line">    <span class="keyword">if</span> end <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        ap_gen = itertools.takewhile(<span class="keyword">lambda</span> n: n &lt; end, ap_gen)</span><br><span class="line">    <span class="keyword">return</span> ap_gen</span><br></pre></td></tr></table></figure><h1 id="python3.3ä¸­æ–°å‡ºçŽ°çš„å¥æ³•yield-from">Python3.3ä¸­æ–°å‡ºçŽ°çš„å¥æ³•ï¼šyield from</h1><p>å¦‚æžœç”Ÿæˆå™¨å‡½æ•°éœ€è¦äº§å‡ºå¦ä¸€ä¸ªç”Ÿæˆå™¨ç”Ÿæˆçš„å€¼ï¼Œä¼ ç»Ÿçš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨åµŒå¥—çš„forå¾ªçŽ¯ã€‚ä¾‹å¦‚ï¼Œchainç”Ÿæˆå™¨çš„ç­‰ä»·å®žçŽ°ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chain</span><span class="params">(*iterables)</span>:</span></span><br><span class="line">    <span class="comment"># chain('ABC', 'DEF') --&gt; A B C D E F</span></span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> iterables:</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> it:  <span class="comment"># ä½¿ç”¨å¾ªçŽ¯</span></span><br><span class="line">            <span class="keyword">yield</span> element</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chain</span><span class="params">(*iterables)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> iterables:</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> it  <span class="comment"># ä½¿ç”¨yield from</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨yield fromæ˜¯å¯¹çš„ï¼Œè€Œä¸”ä»£ç è¯»èµ·æ¥æ›´é¡ºç•…ï¼Œä¸è¿‡æ„Ÿè§‰æ›´åƒæ˜¯è¯­æ³•ç³–ã€‚é™¤äº†ä»£æ›¿å¾ªçŽ¯ä¹‹å¤–ï¼Œyield fromè¿˜ä¼šåˆ›å»ºé€šé“ï¼ŒæŠŠå†…å±‚ç”Ÿæˆå™¨ç›´æŽ¥ä¸Žå¤–å±‚ç”Ÿæˆå™¨çš„å®¢æˆ·ç«¯è”ç³»èµ·æ¥ã€‚æŠŠç”Ÿæˆå™¨å½“æˆåç¨‹ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ªé€šé“ç‰¹åˆ«é‡è¦ï¼Œä¸ä»…èƒ½ä¸ºå®¢æˆ·ç«¯ä»£ç ç”Ÿæˆå€¼ï¼Œè¿˜èƒ½ä½¿ç”¨å®¢æˆ·ç«¯æä¾›çš„å€¼ã€‚</p><h1 id="æ·±å…¥åˆ†æžiterå‡½æ•°">æ·±å…¥åˆ†æžiterå‡½æ•°</h1><p>åœ¨Pythonä¸­è¿­ä»£å¯¹è±¡xæ—¶ä¼šè°ƒç”¨iter(x)ã€‚å¯æ˜¯ï¼Œiterå‡½æ•°è¿˜æœ‰ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„ç”¨æ³•ï¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨å¸¸è§„çš„å‡½æ•°æˆ–ä»»ä½•å¯è°ƒç”¨çš„å¯¹è±¡åˆ›å»ºè¿­ä»£å™¨ã€‚è¿™æ ·ä½¿ç”¨æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œç”¨äºŽä¸æ–­è°ƒç”¨ï¼ˆæ²¡æœ‰å‚æ•°ï¼‰ï¼Œäº§å‡ºå„ä¸ªå€¼ã€‚ç¬¬äºŒä¸ªå€¼æ˜¯å“¨ç¬¦ï¼Œè¿™æ˜¯ä¸ªæ ‡è®°å€¼ï¼Œå½“å¯è°ƒç”¨çš„å¯¹è±¡è¿”å›žè¿™ä¸ªå€¼æ—¶ï¼Œè§¦å‘è¿­ä»£å™¨æŠ›å‡ºStopIterationå¼‚å¸¸ï¼Œè€Œä¸äº§å‡ºå“¨ç¬¦ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/functions#iter" target="_blank" rel="noopener"><code>iter(object[, sentinel])</code></a></p><p>Return an iterator object. The first argument is interpreted very differently depending on the presence of the second argument. Without a second argument, object must be a collection object which supports the iteration protocol (the <code>__iter__()</code> method), or it must support the sequence protocol (the <code>__getitem__()</code> method with integer arguments starting at 0). If it does not support either of those protocols, TypeError is raised. If the second argument, sentinel, is given, then object must be a callable object. The iterator created in this case will call object with no arguments for each call to its <code>__next__()</code> method; if the value returned is equal to sentinel, StopIteration will be raised, otherwise the value will be returned.</p><p>One useful application of the second form of iter() is to read lines of a file until a certain line is reached. The following example reads a file until the readline() method returns an empty string:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'mydata.txt'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> iter(fp.readline, <span class="string">''</span>):  <span class="comment"># é€è¡Œè¯»å–æ–‡ä»¶ï¼Œç›´åˆ°é‡åˆ°ç©ºè¡Œæˆ–è€…åˆ°è¾¾æ–‡ä»¶æœ«å°¾</span></span><br><span class="line">        process_line(line)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">d6</span><span class="params">()</span>:</span>  <span class="comment"># æŽ·éª°å­</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> randint(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d6_iter = iter(d6, <span class="number">1</span>)  <span class="comment"># æŽ·åˆ°1ä¸ºæ­¢ï¼Œä½†ä¸ä¼šäº§å‡º1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d6_iter  <span class="comment"># è¿”å›žçš„æ˜¯ä¸€ä¸ªcallable_iteratorå¯¹è±¡</span></span><br><span class="line">&lt;callable_iterator object at <span class="number">0x101472e10</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> roll <span class="keyword">in</span> d6_iter:</span><br><span class="line"><span class="meta">... </span>    print(roll)</span><br><span class="line">...</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>next(d6_iter)  <span class="comment"># ä¸Žå¸¸è§„è¿­ä»£å™¨ä¸€æ ·ï¼Œä¸€æ—¦è€—å°½å°±æ²¡ç”¨äº†ï¼Œæƒ³é‡æ–°å¼€å§‹ï¼Œå¿…é¡»å†æ¬¡åˆ›å»º</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> generators </tag>
            
            <tag> iterables </tag>
            
            <tag> iterators </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç®—ç¬¦é‡è½½</title>
      <link href="/notes/fluent-python/operator-overloading/"/>
      <url>/notes/fluent-python/operator-overloading/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿ç®—ç¬¦é‡è½½åŸºç¡€">è¿ç®—ç¬¦é‡è½½åŸºç¡€</h1><p>åœ¨æŸäº›åœˆå­ä¸­ï¼Œè¿ç®—ç¬¦é‡è½½çš„åå£°å¹¶ä¸å¥½ã€‚è¿™ä¸ªè¯­è¨€ç‰¹æ€§å¯èƒ½ï¼ˆå·²ç»ï¼‰è¢«æ»¥ç”¨ï¼Œè®©ç¨‹åºå‘˜å›°æƒ‘ï¼Œå¯¼è‡´ç¼ºé™·å’Œæ„æ–™ä¹‹å¤–çš„æ€§èƒ½ç“¶é¢ˆã€‚ä½†æ˜¯ï¼Œå¦‚æžœä½¿ç”¨å¾—åˆ°ï¼ŒAPIä¼šå˜å¾—å¥½ç”¨ï¼Œä»£ç å˜å¾—æ˜“äºŽé˜…è¯»ã€‚Pythonæ–½åŠ äº†ä¸€äº›é™åˆ¶ï¼Œåšå¥½äº†çµæ´»æ€§ã€å¯ç”¨æ€§å’Œå®‰å…¨æ€§æ–¹é¢çš„å¹³è¡¡ï¼š</p><ul><li>ä¸èƒ½é‡è½½å†…ç½®ç±»åž‹çš„è¿ç®—ç¬¦</li><li>ä¸èƒ½æ–°å»ºè¿ç®—ç¬¦ï¼Œåªèƒ½é‡è½½çŽ°æœ‰çš„</li><li>æŸäº›è¿ç®—ç¬¦ä¸èƒ½é‡è½½â€”â€”isã€andã€orå’Œnotï¼ˆä¸è¿‡ä½è¿ç®—ç¬¦&amp;ã€ï½œå’Œï½žå¯ä»¥ï¼‰</li></ul><p>åœ¨Vectorç±»ä¸­é‡è½½è¿ç®—ç¬¦ï¼Œå¹¶ä¿®å¤==è¿ç®—ç¬¦å¯èƒ½å‡ºçŽ°çš„é”™è¯¯ã€‚</p><figure class="highlight python"><figcaption><span>vector.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, components)</span>:</span></span><br><span class="line">        self._components = array(self.typecode, components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter(self._components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span>  <span class="comment"># æ”¯æŒ == ä¸­ç¼€è¿ç®—ç¬¦ï¼Œä½†æ˜¯æœ‰é”™è¯¯</span></span><br><span class="line">        <span class="keyword">return</span> tuple(self) == tuple(other)  <span class="comment"># Vector([3, 4]) == (3, 4)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.sqrt(sum(x * x <span class="keyword">for</span> x <span class="keyword">in</span> self))</span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="ä¸€å…ƒè¿ç®—ç¬¦">ä¸€å…ƒè¿ç®—ç¬¦</h1><p><code>- (__neg__)</code>ï¼šä¸€å…ƒå–è´Ÿç®—æœ¯è¿ç®—ç¬¦ã€‚å¦‚æžœxæ˜¯-2ï¼Œé‚£ä¹ˆ-x == 2ã€‚</p><p><code>+ (__pos__)</code>ï¼šä¸€å…ƒå–æ­£ç®—æœ¯è¿ç®—ç¬¦ã€‚é€šå¸¸ï¼Œx == -xï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ã€‚</p><p><code>~ (__invert__)</code>ï¼šå¯¹æ•´æ•°æŒ‰ä½å–åï¼Œå®šä¹‰ä¸º~x == -(x+1)ã€‚å¦‚æžœxæ˜¯2ï¼Œé‚£ä¹ˆ~x == -3ã€‚</p><p>Pythonè¯­è¨€å‚è€ƒæ‰‹å†Œè¿˜æŠŠå†…ç½®çš„<code>abs(...)</code>å‡½æ•°åˆ—ä¸ºä¸€å…ƒè¿ç®—ç¬¦ã€‚å®ƒå¯¹åº”çš„ç‰¹æ®Šæ–¹æ³•æ˜¯<code>__abs__</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span>  <span class="comment"># è¿”å›žæ ‡é‡</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(sum(x * x <span class="keyword">for</span> x <span class="keyword">in</span> self))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__neg__</span><span class="params">(self)</span>:</span>  <span class="comment"># è¿”å›žåŒå±žä¸€ç±»çš„å®žä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> Vector(-x <span class="keyword">for</span> x <span class="keyword">in</span> self)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__pos__</span><span class="params">(self)</span>:</span>  <span class="comment"># è¿”å›žselfçš„å‰¯æœ¬</span></span><br><span class="line">    <span class="keyword">return</span> Vector(self)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸æ‰“ç®—å®žçŽ°<code>__invert__</code>æ–¹æ³•ï¼Œå› æ­¤å¦‚æžœç”¨æˆ·åœ¨Vectorå®žä¾‹ä¸Šå°è¯•è®¡ç®—~vï¼ŒPythonä¼šæŠ›å‡ºTypeErrorï¼Œè€Œä¸”è¾“å‡ºæ˜Žç¡®çš„é”™è¯¯æ¶ˆæ¯ï¼Œ&quot;bad operand type for unary ~: 'Vector'&quot;ã€‚</p><h2 id="x-å’Œ-x-ä½•æ—¶ä¸ç›¸ç­‰">x å’Œ +x ä½•æ—¶ä¸ç›¸ç­‰</h2><p>ç¬¬ä¸€ä¾‹ä¸Ždecimal.Decimalç±»æœ‰å…³ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> decimal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ctx = decimal.getcontext()  <span class="comment"># å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ctx.prec = <span class="number">40</span>  <span class="comment"># ç²¾åº¦è®¾ä¸º40</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_third = decimal.Decimal(<span class="string">'1'</span>) / decimal.Decimal(<span class="string">'3'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_third</span><br><span class="line">Decimal(<span class="string">'0.3333333333333333333333333333333333333333'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_third == +one_third</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ctx.prec = <span class="number">28</span>  <span class="comment"># æ”¹å˜ç²¾åº¦</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>one_third == +one_third</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>+one_third  <span class="comment"># +one_thirdçš„ç²¾åº¦ä¸Žone_thirdçš„ç²¾åº¦ä¸ä¸€æ ·</span></span><br><span class="line">Decimal(<span class="string">'0.3333333333333333333333333333'</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¾‹ä¸Žcollections.Counterç±»æœ‰å…³ã€‚</p><p>Counterç±»å®žçŽ°äº†å‡ ä¸ªç®—æœ¯è¿ç®—ç¬¦ï¼Œä¾‹å¦‚ä¸­ç¼€è¿ç®—ç¬¦+ï¼Œä½œç”¨æ˜¯æŠŠä¸¤ä¸ªCounterå®žä¾‹çš„è®¡æ•°å™¨åŠ åœ¨ä¸€èµ·ã€‚ç„¶è€Œï¼Œä»Žå®žç”¨è§’åº¦å‡ºå‘ï¼ŒCounterç›¸åŠ æ—¶ï¼Œè´Ÿå€¼å’Œé›¶å€¼è®¡æ•°ä¼šä»Žç»“æžœä¸­å‰”é™¤ã€‚è€Œä¸€å…ƒè¿ç®—ç¬¦+ç­‰åŒäºŽåŠ ä¸Šä¸€ä¸ªç©ºCounterï¼Œå› æ­¤å®ƒäº§ç”Ÿä¸€ä¸ªæ–°çš„Counterä¸”ä¿ç•™å¤§äºŽé›¶çš„è®¡æ•°å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ct = Counter(<span class="string">'abracadabra'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ct[<span class="string">'r'</span>] = <span class="number">-3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ct[<span class="string">'d'</span>] = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ct</span><br><span class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">5</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">1</span>, <span class="string">'d'</span>: <span class="number">0</span>, <span class="string">'r'</span>: <span class="number">-3</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>+ct</span><br><span class="line">Counter(&#123;<span class="string">'a'</span>: <span class="number">5</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ct == +ct</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="é‡è½½å‘é‡åŠ æ³•è¿ç®—ç¬¦">é‡è½½å‘é‡åŠ æ³•è¿ç®—ç¬¦</h1><p>åºåˆ—åº”è¯¥æ”¯æŒ<code>+</code>è¿ç®—ç¬¦ï¼ˆç”¨äºŽæ‹¼æŽ¥ï¼‰ï¼Œä»¥åŠ<code>*</code>è¿ç®—ç¬¦ï¼ˆç”¨äºŽé‡å¤å¤åˆ¶ï¼‰ã€‚ç„¶è€Œï¼Œå¯¹Vectorç±»åž‹æ¥è¯´ï¼Œä½¿ç”¨å‘é‡æ•°å­¦è¿ç®—å®žçŽ°<code>+</code>å’Œ<code>*</code>è¿ç®—ç¬¦æ›´æœ‰æ„ä¹‰ã€‚</p><p>å¦‚æžœå°è¯•æŠŠä¸¤ä¸ªä¸åŒé•¿åº¦Vectorå®žä¾‹åŠ åœ¨ä¸€èµ·ä¼šæ€Žæ ·ï¼Ÿæ­¤æ—¶å¯ä»¥æŠ›å‡ºé”™è¯¯ï¼Œä½†æ˜¯æ ¹æ®å®žé™…è¿è¡Œæƒ…å†µï¼ˆä¾‹å¦‚ä¿¡æ¯æ£€ç´¢ï¼‰ï¼Œæœ€å¥½ä½¿ç”¨é›¶å¡«å……è¾ƒçŸ­çš„é‚£ä¸ªå‘é‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> vector <span class="keyword">import</span> Vector</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v2 = Vector([<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 + v2</span><br><span class="line">Vector([<span class="number">9.0</span>, <span class="number">11.0</span>, <span class="number">13.0</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v3 = Vector([<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 + v3</span><br><span class="line">Vector([<span class="number">4.0</span>, <span class="number">6.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>])</span><br></pre></td></tr></table></figure><p>ç¡®å®šåŸºæœ¬è¦æ±‚åŽï¼Œ<code>__add__</code>æ–¹æ³•çš„å®žçŽ°å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    pairs = itertools.zip_longest(self, other, fillvalue=<span class="number">0.0</span>)</span><br><span class="line">    <span class="keyword">return</span> Vector(a + b <span class="keyword">for</span> a, b <span class="keyword">in</span> pairs)</span><br></pre></td></tr></table></figure><p><strong>å®žçŽ°ä¸€å…ƒè¿ç®—ç¬¦å’Œä¸­ç¼€è¿ç®—ç¬¦çš„ç‰¹æ®Šæ–¹æ³•ä¸€å®šä¸èƒ½ä¿®æ”¹æ“ä½œæ•°ã€‚ä½¿ç”¨è¿™äº›è¿ç®—ç¬¦çš„è¡¨è¾¾å¼æœŸå¾…ç»“æžœæ˜¯æ–°å¯¹è±¡ã€‚åªæœ‰å¢žé‡èµ‹å€¼è¡¨è¾¾å¼å¯èƒ½ä¼šä¿®æ”¹ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼ˆselfï¼‰ã€‚</strong></p><p>ä¸Šè¿°çš„<code>__add__</code>æ–¹æ³•ä¹Ÿæ”¯æŒVectorä¹‹å¤–çš„å¯¹è±¡ã€‚è¿™æ˜¯å› ä¸º<code>__add__</code>ä½¿ç”¨äº†zip_longestï¼Œå®ƒèƒ½å¤„ç†ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼Œè€Œä¸”æž„é€ æ–°Vectorå®žä¾‹çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼ä»…ä»…æ˜¯æŠŠzip_longestç”Ÿæˆçš„å€¼å¯¹ç›¸åŠ ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»»ä½•ç”Ÿæˆæ•°å­—å…ƒç´ çš„å¯è¿­ä»£å¯¹è±¡ã€‚ç„¶è€Œï¼Œå¦‚æžœå¯¹è°ƒæ“ä½œæ•°ï¼Œæ··åˆç±»åž‹çš„åŠ æ³•å°±ä¼šå¤±è´¥ã€‚</p><p>ä¸ºäº†æ”¯æŒæ¶‰åŠä¸åŒç±»åž‹çš„è¿ç®—ï¼ŒPythonä¸ºä¸­ç¼€è¿ç®—ç¬¦ç‰¹æ®Šæ–¹æ³•æä¾›äº†ç‰¹æ®Šçš„åˆ†æ´¾æœºåˆ¶ã€‚å¯¹è¡¨è¾¾å¼ a + b æ¥è¯´ï¼Œè§£é‡Šå™¨ä¼šæ‰§è¡Œä»¥ä¸‹å‡ æ­¥æ“ä½œã€‚</p><ol type="1"><li><p>å¦‚æžœaæœ‰<code>__add__</code>æ–¹æ³•ï¼Œè€Œä¸”è¿”å›žå€¼ä¸æ˜¯NotImplementedï¼Œè°ƒç”¨<code>a.__add__(b)</code>ï¼Œç„¶åŽè¿”å›žç»“æžœã€‚</p></li><li><p>å¦‚æžœaæ²¡æœ‰<code>__add__</code>æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨<code>__add__</code>æ–¹æ³•è¿”å›žNotImplementedï¼Œæ£€æŸ¥bæœ‰æ²¡æœ‰<code>__radd__</code>æ–¹æ³•ï¼ˆ<code>__add__</code>çš„â€œåå‘â€reversedç‰ˆæœ¬ï¼‰ï¼Œå¦‚æžœæœ‰ï¼Œè€Œä¸”æ²¡æœ‰è¿”å›žNotImplementedï¼Œè°ƒç”¨<code>b.__radd__(a)</code>ï¼Œç„¶åŽè¿”å›žç»“æžœã€‚</p></li><li><p>å¦‚æžœbæ²¡æœ‰<code>__radd__</code>æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨<code>__radd__</code>æ–¹æ³•è¿”å›žNotImplementedï¼ŒæŠ›å‡ºTypeErrorï¼Œå¹¶åœ¨é”™è¯¯æ¶ˆæ¯ä¸­æŒ‡æ˜Žæ“ä½œç±»åž‹ä¸æ”¯æŒã€‚</p></li></ol><img src="http://www.plantuml.com/plantuml/svg/bP2zJiCm58NtFCLLfoBK3XaPkZ6mCB57Dhb09F8ZnnswC24XaA11G8jeLRPE20O6H47gqzZfnYlWsB4980Q695V7dyyzEGTHY81nnWSGOhxBeen7QUBbd7245e5re2qWEKH9rkTEbjFJeo0WOHW4SlGgdsz4CVvulpVa7h7Swk9534UaQzasNIllZiktApcRQdOVEQ6MDhgyVTfE-LQS7MAC2SUmOPsaF587pdvvBIQpXXr3tcSkF3KfsLynwVUOjElWDlcTan9Fls43nF1S59UhPL4-Zik7-R_p-_Q6F9k8ayNE8CDDnbAc6QmcJzSDdPvkKprcfDNoOcu5tPwIr4hFp4gq7TLVwBYR5URKNbsMSwIre_x32jMIqdIW6ZFdNrjyQ-X3Wsmiydzk-WG0"><p><strong>åˆ«æŠŠNotImplementedå’ŒNotImplementedErroræžæ··äº†ã€‚å‰è€…æ˜¯ç‰¹æ®Šçš„å•ä¾‹å€¼ï¼Œå¦‚æžœä¸­ç¼€è¿ç®—ç¬¦ç‰¹æ®Šæ–¹æ³•ä¸èƒ½å¤„ç†ç»™å®šçš„æ“ä½œæ•°ï¼Œé‚£ä¹ˆè¦æŠŠå®ƒè¿”å›žï¼ˆreturnï¼‰ç»™è§£é‡Šå™¨ã€‚è€ŒNotImplementedErroræ˜¯ä¸€ç§å¼‚å¸¸ï¼ŒæŠ½è±¡ç±»ä¸­å ä½æ–¹æ³•æŠŠå®ƒæŠ›å‡ºï¼ˆraiseï¼‰ï¼Œæé†’å­ç±»å¿…é¡»è¦†ç›–ã€‚</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    pairs = itertools.zip_longest(self, other, fillvalue=<span class="number">0.0</span>)</span><br><span class="line">    <span class="keyword">return</span> Vector(a + b <span class="keyword">for</span> a, b <span class="keyword">in</span> pairs)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__radd__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self + other  <span class="comment"># ç›´æŽ¥å§”æ‰˜__add__ï¼Œå¤„ç†æ•°å­—å’Œå‘é‡æ—¶ï¼Œ+å¯ä»¥äº¤æ¢ï¼Œä½†æ˜¯æ‹¼æŽ¥åºåˆ—æ—¶ä¸è¡Œã€‚</span></span><br></pre></td></tr></table></figure><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æžœä¸­ç¼€è¿ç®—ç¬¦çš„æ­£å‘æ–¹æ³•åªå¤„ç†ä¸Žselfå±žäºŽåŒä¸€ç±»åž‹çš„æ“ä½œæ•°ï¼Œé‚£å°±æ— éœ€å®žçŽ°å¯¹åº”çš„åå‘æ–¹æ³•ï¼Œå› ä¸ºæŒ‰ç…§å®šä¹‰ï¼Œåå‘æ–¹æ³•æ˜¯ä¸ºäº†å¤„ç†ç±»åž‹ä¸åŒçš„æ“ä½œæ•°ã€‚</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> vector <span class="keyword">import</span> Vector</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 + (<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">Vector([<span class="number">5.0</span>, <span class="number">5.0</span>, <span class="number">5.0</span>])  <span class="comment"># __add__æ–¹æ³•å¯ä»¥å¤„ç†ä»»ä½•å…·æœ‰æ•°å€¼å…ƒç´ çš„å¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 + <span class="number">1</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/vector.py"</span>, line <span class="number">49</span>, <span class="keyword">in</span> __add__</span><br><span class="line">    pairs = itertools.zip_longest(self, other, fillvalue=<span class="number">0.0</span>)</span><br><span class="line">TypeError: zip_longest argument <span class="comment">#2 must support iteration  # é”™è¯¯æ¶ˆæ¯æ˜Žç¡®</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 + <span class="string">'abc'</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/vector.py"</span>, line <span class="number">50</span>, <span class="keyword">in</span> __add__</span><br><span class="line">    <span class="keyword">return</span> Vector(a + b <span class="keyword">for</span> a, b <span class="keyword">in</span> pairs)</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/vector.py"</span>, line <span class="number">11</span>, <span class="keyword">in</span> __init__</span><br><span class="line">    self._components = array(self.typecode, components)</span><br><span class="line">  File <span class="string">"/Users/cws/Desktop/vector.py"</span>, line <span class="number">50</span>, <span class="keyword">in</span> &lt;genexpr&gt;</span><br><span class="line">    <span class="keyword">return</span> Vector(a + b <span class="keyword">for</span> a, b <span class="keyword">in</span> pairs)</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> +: <span class="string">'float'</span> <span class="keyword">and</span> <span class="string">'str'</span>  <span class="comment"># é—®é¢˜ä¸¥é‡</span></span><br></pre></td></tr></table></figure><p>v1 + 'abc'æ˜¯æ— æ³•è®¡ç®—çš„ï¼šå¦‚æžœç”±äºŽç±»åž‹ä¸å…¼å®¹è€Œå¯¼è‡´è¿ç®—ç¬¦ç‰¹æ®Šæ–¹æ³•æ— æ³•è¿”å›žæœ‰æ•ˆçš„ç»“æžœï¼Œé‚£ä¹ˆåº”è¯¥è¿”å›žNotImplementedã€‚å¦‚æžœæŠ›å‡ºå¼‚å¸¸ï¼Œå°±ç»ˆæ­¢äº†è¿ç®—ç¬¦åˆ†æ´¾æœºåˆ¶ã€‚å¯¹TypeErroræ¥è¯´ï¼Œé€šå¸¸æœ€å¥½å°†å…¶æ•èŽ·ï¼Œç„¶åŽè¿”å›žNotImplementedã€‚è¿™æ ·ï¼Œè§£é‡Šå™¨ä¼šå°è¯•è°ƒç”¨åå‘è¿ç®—ç¬¦æ–¹æ³•ï¼Œå¦‚æžœæ“ä½œæ•°æ˜¯ä¸åŒçš„ç±»åž‹ï¼Œå¯¹è°ƒä¹‹åŽï¼Œåå‘è¿ç®—ç¬¦æ–¹æ³•å¯èƒ½ä¼šæ­£ç¡®è®¡ç®—ã€‚</p><p>ä¸ºäº†éµå®ˆé¸­å­ç±»åž‹ç²¾ç¥žï¼Œæˆ‘ä»¬ä¸èƒ½æµ‹è¯•otheræ“ä½œæ•°çš„ç±»åž‹ï¼Œæˆ–è€…å®ƒçš„å…ƒç´ çš„ç±»åž‹ã€‚æˆ‘ä»¬è¦æ•èŽ·å¼‚å¸¸ï¼Œç„¶åŽè¿”å›žNotImplementedã€‚å¦‚æžœè§£é‡Šå™¨è¿˜æœªåè½¬æ“ä½œæ•°ï¼Œé‚£ä¹ˆå®ƒå°†å°è¯•åŽ»åšã€‚å¦‚æžœåæ–¹å‘æ–¹æ³•è¿”å›žNotImplementedï¼Œé‚£ä¹ˆPythonä¼šæŠ›å‡ºTypeErrorï¼Œå¹¶è¿”å›žä¸€ä¸ªæ ‡å‡†çš„é”™è¯¯æ¶ˆæ¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span>  <span class="comment"># æœ€ç»ˆç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pairs = itertools.zip_longest(self, other, fillvalue=<span class="number">0.0</span>)</span><br><span class="line">        <span class="keyword">return</span> Vector(a + b <span class="keyword">for</span> a, b <span class="keyword">in</span> pairs)</span><br><span class="line">    <span class="keyword">except</span> TypeError:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure><h1 id="é‡è½½æ ‡é‡ä¹˜æ³•è¿ç®—ç¬¦">é‡è½½æ ‡é‡ä¹˜æ³•è¿ç®—ç¬¦<code>*</code></h1><p>æ ‡é‡ç§¯ï¼ˆscalar productï¼‰ï¼š<code>Vector([1, 2, 3]) * x</code>ï¼Œxæ˜¯æ•°å­—ï¼Œç»“æžœæ˜¯ä¸€ä¸ªæ–°Vectorå®žä¾‹ï¼Œå„ä¸ªåˆ†é‡éƒ½ä¼šä¹˜ä»¥xã€‚è¿™ä¹Ÿå«å…ƒç´ çº§ä¹˜æ³•ï¼ˆelementwise multiplicationï¼‰ã€‚</p><p>å‘é‡ç‚¹ç§¯ï¼ˆdot productï¼‰ï¼šçŸ©é˜µä¹˜æ³•ã€‚NumPyç­‰åº“ç›®å‰çš„åšæ³•æ˜¯ï¼Œä¸é‡è½½è¿™ä¸¤ç§æ„ä¹‰çš„<code>*</code>ï¼Œåªç”¨<code>*</code>è®¡ç®—æ ‡é‡ç§¯ã€‚ä¾‹å¦‚ï¼Œåœ¨NumPyä¸­ï¼Œç‚¹ç§¯ä½¿ç”¨<code>numpy.dot()</code>å‡½æ•°è®¡ç®—ã€‚</p><p><em>ä»ŽPython3.5èµ·ï¼Œ<code>@</code>è®°å·å¯ä»¥ç”¨ä½œä¸­ç¼€ç‚¹ç§¯è¿ç®—ç¬¦ã€‚</em></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, scalar)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Vector(n * scalar <span class="keyword">for</span> n <span class="keyword">in</span> self)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__rmul__</span><span class="params">(self, scalar)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self * scalar</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–¹æ³•ç¡®å®žå¯ç”¨ï¼Œä½†æ˜¯æä¾›ä¸å…¼å®¹çš„æ“ä½œæ•°æ—¶ä¼šå‡ºé—®é¢˜ã€‚scalarå‚æ•°çš„å€¼è¦æ˜¯æ•°å­—ï¼Œä¸Žæµ®ç‚¹æ•°ç›¸ä¹˜å¾—åˆ°çš„ç§¯æ˜¯å¦ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚å› æ­¤ï¼Œä¸èƒ½ä½¿ç”¨å¤æ•°ï¼Œä½†å¯ä»¥æ˜¯intã€boolï¼ˆintçš„å­ç±»ï¼‰ï¼Œç”šè‡³fractions.Fractionå®žä¾‹ç­‰æ ‡é‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨é¸­å­ç±»åž‹æŠ€æœ¯ï¼Œåœ¨<code>__mul__</code>æ–¹æ³•ä¸­æ•èŽ·TypeErrorã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸ªæ›´æ˜“äºŽç†è§£çš„æ–¹å¼ï¼Œè€Œä¸”ä¹Ÿæ›´åˆç†ï¼šç™½é¹…ç±»åž‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨isinstance()æ£€æŸ¥scalarçš„ç±»åž‹ï¼Œä½†æ˜¯ä¸ç¡¬ç¼–ç å…·ä½“çš„ç±»åž‹ï¼Œè€Œæ˜¯æ£€æŸ¥numbers.RealæŠ½è±¡åŸºç±»ã€‚è¿™ä¸ªæŠ½è±¡åŸºç±»æ¶µç›–äº†æˆ‘ä»¬æ‰€éœ€çš„å…¨éƒ¨ç±»åž‹ï¼Œè€Œä¸”è¿˜æ”¯æŒä»¥åŽå£°æ˜Žä¸ºnumbers.RealæŠ½è±¡åŸºç±»çš„çœŸå®žå­ç±»æˆ–è™šæ‹Ÿå­ç±»çš„æ•°å€¼ç±»åž‹ã€‚ï¼ˆdecimal.Decimalæ²¡æœ‰æŠŠè‡ªå·±æ³¨å†Œä¸ºnumbers.Realçš„è™šæ‹Ÿå­ç±»ã€‚å› æ­¤ï¼ŒVectorç±»ä¸ä¼šå¤„ç†decimal.Decimalæ•°å­—ï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åœ¨ç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, scalar)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(scalar, numbers.Real):  <span class="comment"># æ˜¾ç¤ºæ£€æŸ¥æŠ½è±¡ç±»åž‹</span></span><br><span class="line">            <span class="keyword">return</span> Vector(n * scalar <span class="keyword">for</span> n <span class="keyword">in</span> self)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">NotImplemented</span>  <span class="comment"># è¿”å›žNotImplementedï¼Œè®©Pythonå°è¯•åœ¨scalaræ“ä½œæ•°ä¸Šè°ƒç”¨__rmul__æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__rmul__</span><span class="params">(self, scalar)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self * scalar</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__matmul__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> sum(a * b <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(self, other))</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__rmatmul__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self @ other  <span class="comment"># å§”æ‰˜</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> vector <span class="keyword">import</span> Vector</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 * <span class="number">11</span></span><br><span class="line">Vector([<span class="number">11.0</span>, <span class="number">22.0</span>, <span class="number">33.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">11</span> * v1</span><br><span class="line">Vector([<span class="number">11.0</span>, <span class="number">22.0</span>, <span class="number">33.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 * <span class="literal">True</span></span><br><span class="line">Vector([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 * Fraction(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">Vector([<span class="number">0.3333333333333333</span>, <span class="number">0.6666666666666666</span>, <span class="number">1.0</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>va = Vector([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vz = Vector([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>va @ vz</span><br><span class="line"><span class="number">38.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>] @ vz  <span class="comment"># åå‘è°ƒç”¨æˆåŠŸ</span></span><br><span class="line"><span class="number">380.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>va @ <span class="number">3</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> @: <span class="string">'Vector'</span> <span class="keyword">and</span> <span class="string">'int'</span></span><br></pre></td></tr></table></figure><h1 id="ä¸­ç¼€è¿ç®—ç¬¦æ–¹æ³•çš„åç§°">ä¸­ç¼€è¿ç®—ç¬¦æ–¹æ³•çš„åç§°</h1><table><thead><tr class="header"><th>è¿ç®—ç¬¦</th><th>æ­£å‘æ–¹æ³•</th><th>åå‘æ–¹æ³•</th><th>å°±åœ°ï¼ˆin-placeï¼‰æ–¹æ³•</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>+</code></td><td><code>__add__</code></td><td><code>__radd__</code></td><td><code>__iadd__</code></td><td>åŠ æ³•æˆ–æ‹¼æŽ¥</td></tr><tr class="even"><td><code>-</code></td><td><code>__sub__</code></td><td><code>__rsub__</code></td><td><code>__isub__</code></td><td>å‡æ³•</td></tr><tr class="odd"><td><code>*</code></td><td><code>__mul__</code></td><td><code>__rmul__</code></td><td><code>__imul__</code></td><td>ä¹˜æ³•æˆ–é‡å¤å¤åˆ¶</td></tr><tr class="even"><td><code>/</code></td><td><code>__truediv__</code></td><td><code>__rtruediv__</code></td><td><code>__itruediv__</code></td><td>é™¤æ³•</td></tr><tr class="odd"><td><code>//</code></td><td><code>__floordiv__</code></td><td><code>__rfloordiv__</code></td><td><code>__ifloordiv__</code></td><td>æ•´é™¤</td></tr><tr class="even"><td><code>%</code></td><td><code>__mod__</code></td><td><code>__rmod__</code></td><td><code>__imod__</code></td><td>å–æ¨¡</td></tr><tr class="odd"><td><code>divmod()</code></td><td><code>__divmod__</code></td><td><code>__rdivmod__</code></td><td><code>__idivmod__</code></td><td>è¿”å›žç”±æ•´é™¤çš„å•†å’Œæ¨¡æ•°ç»„æˆçš„å…ƒç»„</td></tr><tr class="even"><td><code>**, pow()</code></td><td><code>__pow__</code></td><td><code>__rpow__</code></td><td><code>__ipow__</code></td><td>å–å¹‚</td></tr><tr class="odd"><td><code>@</code></td><td><code>__matmul__</code></td><td><code>__rmatmul__</code></td><td><code>__imatmul__</code></td><td>çŸ©é˜µä¹˜æ³•</td></tr><tr class="even"><td><code>&amp;</code></td><td><code>__and__</code></td><td><code>__rand__</code></td><td><code>__iand__</code></td><td>ä½ä¸Ž</td></tr><tr class="odd"><td><code>|</code></td><td><code>__or__</code></td><td><code>__ror__</code></td><td><code>__ior__</code></td><td>ä½æˆ–</td></tr><tr class="even"><td><code>^</code></td><td><code>__xor__</code></td><td><code>__rxor__</code></td><td><code>__ixor__</code></td><td>ä½å¼‚æˆ–</td></tr><tr class="odd"><td><code>&lt;&lt;</code></td><td><code>__lshift__</code></td><td><code>__rlshift__</code></td><td><code>__ilshift__</code></td><td>æŒ‰ä½å·¦ç§»</td></tr><tr class="even"><td><code>&gt;&gt;</code></td><td><code>__rshift__</code></td><td><code>__rrshift__</code></td><td><code>__irshift</code></td><td>æŒ‰ä½å³ç§»</td></tr></tbody></table><h1 id="ä¼—å¤šæ¯”è¾ƒè¿ç®—ç¬¦">ä¼—å¤šæ¯”è¾ƒè¿ç®—ç¬¦</h1><p>Pythonè§£é‡Šå™¨å¯¹ä¼—å¤šæ¯”è¾ƒè¿ç®—ç¬¦çš„å¤„ç†ä¸Žå‰æ–‡ç±»ä¼¼ï¼Œä¸è¿‡åœ¨ä¸¤ä¸ªæ–¹é¢æœ‰é‡å¤§åŒºåˆ«ã€‚</p><ul><li>æ­£å‘å’Œåå‘è°ƒç”¨ä½¿ç”¨çš„æ˜¯åŒä¸€ç³»åˆ—æ–¹æ³•ã€‚</li><li>å¯¹<code>==</code>å’Œ<code>!=</code>æ¥è¯´ï¼Œå¦‚æžœåå‘è°ƒç”¨å¤±è´¥ï¼ŒPythonä¼šæ¯”è¾ƒå¯¹è±¡çš„IDï¼Œè€Œä¸æŠ›å‡ºTypeErrorã€‚</li></ul><table><thead><tr class="header"><th>åˆ†ç»„</th><th>ä¸­ç¼€è¿ç®—ç¬¦</th><th>æ­£å‘æ–¹æ³•è°ƒç”¨</th><th>åå‘æ–¹æ³•è°ƒç”¨</th><th>åŽå¤‡æœºåˆ¶</th></tr></thead><tbody><tr class="odd"><td>ç›¸ç­‰æ€§</td><td><code>a == b</code></td><td><code>a.__eq__(b)</code></td><td><code>b.__eq__(a)</code></td><td>è¿”å›ž<code>id(a) == id(b)</code></td></tr><tr class="even"><td></td><td><code>a != b</code></td><td><code>a.__ne__(b)</code></td><td><code>b.__ne__(a)</code></td><td>è¿”å›ž<code>not (a == b)</code></td></tr><tr class="odd"><td>æŽ’åº</td><td><code>a &gt; b</code></td><td><code>a.__gt__(b)</code></td><td><code>b.__lt__(a)</code></td><td>æŠ›å‡º<code>TypeError</code></td></tr><tr class="even"><td></td><td><code>a &lt; b</code></td><td><code>a.__lt__(b)</code></td><td><code>b.__gt__(a)</code></td><td>æŠ›å‡º<code>TypeError</code></td></tr><tr class="odd"><td></td><td><code>a &gt;= b</code></td><td><code>a.__ge__(b)</code></td><td><code>b.__le__(a)</code></td><td>æŠ›å‡º<code>TypeError</code></td></tr><tr class="even"><td></td><td><code>a &lt;= b</code></td><td><code>a.__le__(b)</code></td><td><code>b.__ge__(a)</code></td><td>æŠ›å‡º<code>TypeError</code></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (len(self) == len(other) <span class="keyword">and</span>    <span class="comment"># ç­‰ä»·äºŽ tuple(self) == tuple(other)</span></span><br><span class="line">            all(a == b <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(self, other)))  <span class="comment"># ä½†æ˜¯æ˜Žæ˜¾æ­¤æ³•æ›´é«˜æ•ˆ</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> vector <span class="keyword">import</span> Vector</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>va = Vector([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>vb = Vector(range(<span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>va == vb</span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>va == (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>va == (1, 2, 3)çš„ç»“æžœä¸æ˜¯å¾ˆç†æƒ³ï¼Œå¯¹æ“ä½œæ•°è¿‡åº¦å®½å®¹å¯èƒ½å¯¼è‡´ä»¤äººæƒŠè®¶çš„ç»“æžœï¼Œè€Œç¨‹åºå‘˜è®¨åŽŒæƒŠå–œã€‚ä»ŽPythonè‡ªèº«æ¥æ‰¾çº¿ç´¢ï¼Œæˆ‘ä»¬å‘çŽ°[1,2] == (1,2)çš„ç»“æžœæ˜¯Falseï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¦ä¿å®ˆä¸€ç‚¹ï¼Œåšäº›ç±»åž‹æ£€æŸ¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨Vectorç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(other, Vector):</span><br><span class="line">        <span class="keyword">return</span> (len(self) == len(other) <span class="keyword">and</span></span><br><span class="line">                all(a ==b <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(self, other)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span>  <span class="comment"># è®©Pythonç¼–è¾‘å™¨å¤„ç†</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸ç”¨å®žçŽ°<code>__ne__</code>æ–¹æ³•ï¼Œå› ä¸ºä»Žobjectç»§æ‰¿çš„<code>__ne__</code>æ–¹æ³•çš„åŽå¤‡è¡Œä¸ºæ»¡è¶³äº†æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä»Žobjectä¸­ç»§æ‰¿çš„<code>__ne__</code>æ–¹æ³•ï¼Œè¿ä½œæ–¹å¼ä¸Žä¸‹è¿°ä»£ç ç±»ä¼¼ï¼Œä¸è¿‡åŽŸç‰ˆæ˜¯ç”¨Cè¯­è¨€å®žçŽ°çš„ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__ne__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    eq_result = self == other</span><br><span class="line">    <span class="keyword">if</span> eq_result <span class="keyword">is</span> <span class="built_in">NotImplemented</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> eq_result</span><br></pre></td></tr></table></figure><h1 id="å¢žé‡èµ‹å€¼è¿ç®—ç¬¦">å¢žé‡èµ‹å€¼è¿ç®—ç¬¦</h1><p>Vectorç±»å·²ç»æ”¯æŒå¢žé‡èµ‹å€¼è¿ç®—ç¬¦<code>+=</code>å’Œ<code>*=</code>äº†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> vector <span class="keyword">import</span> Vector</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1_alias = v1</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(v1)</span><br><span class="line"><span class="number">4358324120</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 += Vector([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(v1)  <span class="comment"># v1é‡æ–°ç»‘å®šäº†å®žä¾‹</span></span><br><span class="line"><span class="number">4359075992</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1</span><br><span class="line">Vector([<span class="number">5.0</span>, <span class="number">7.0</span>, <span class="number">9.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1_alias  <span class="comment"># åŽŸæ¥çš„å®žä¾‹æ²¡æœ‰å˜</span></span><br><span class="line">Vector([<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 *= <span class="number">2</span>  <span class="comment"># å¢žé‡ä¹˜æ³•è¿ç®—</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1</span><br><span class="line">Vector([<span class="number">10.0</span>, <span class="number">14.0</span>, <span class="number">18.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(v1)</span><br><span class="line"><span class="number">4359074872</span></span><br></pre></td></tr></table></figure><p>å¦‚æžœä¸€ä¸ªç±»æ²¡æœ‰å®žçŽ°å°±åœ°è¿ç®—ç¬¦ï¼Œå¢žé‡èµ‹å€¼è¿ç®—åªæ˜¯è¯­æ³•ç³–ï¼ša += bçš„ä½œç”¨ä¸Ža = a + bå®Œå…¨ä¸€æ ·ã€‚å¯¹ä¸å¯å˜ç±»åž‹æ¥è¯´ï¼Œè¿™æ˜¯é¢„æœŸçš„è¡Œä¸ºï¼Œè€Œä¸”ï¼Œå¦‚æžœå®šä¹‰äº†<code>__add__</code>æ–¹æ³•çš„è¯ï¼Œä¸ç”¨ç¼–å†™é¢å¤–çš„ä»£ç ï¼Œ+=å°±èƒ½ä½¿ç”¨ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æžœå®žçŽ°äº†å°±åœ°è¿ç®—ç¬¦æ–¹æ³•ï¼Œä¾‹å¦‚<code>__iadd__</code>æ–¹æ³•ï¼Œè®¡ç®—a += bçš„ç»“æžœæ—¶ä¼šè°ƒç”¨å®ƒã€‚è¿™ç§è¿ç®—ç¬¦çš„åç§°è¡¨æ˜Žï¼Œå®ƒä»¬ä¼šå°±åœ°ä¿®æ”¹å·¦æ“ä½œæ•°ï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ä½œä¸ºç»“æžœã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> overloading </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»§æ‰¿çš„ä¼˜ç¼ºç‚¹</title>
      <link href="/notes/fluent-python/inheritance-for-good-or-for-worse/"/>
      <url>/notes/fluent-python/inheritance-for-good-or-for-worse/</url>
      
        <content type="html"><![CDATA[<h1 id="å­ç±»åŒ–å†…ç½®ç±»åž‹å¾ˆéº»çƒ¦">å­ç±»åŒ–å†…ç½®ç±»åž‹å¾ˆéº»çƒ¦</h1><p>åœ¨Python2.2ä¹‹å‰ï¼Œå†…ç½®ç±»åž‹ï¼ˆå¦‚listæˆ–dictï¼‰ä¸èƒ½å­ç±»åŒ–ã€‚åœ¨Python2.2ä¹‹åŽï¼Œå†…ç½®ç±»åž‹å¯ä»¥å­ç±»åŒ–äº†ï¼Œä½†æ˜¯æœ‰ä¸ªé‡è¦çš„æ³¨æ„äº‹é¡¹ï¼š<strong>å†…ç½®ç±»åž‹ï¼ˆä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼‰ä¸ä¼šè°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ç±»è¦†ç›–çš„ç‰¹æ®Šæ–¹æ³•ã€‚</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">DoppelDict</span><span class="params">(dict)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>            super().__setitem__(key, [value] * <span class="number">2</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd = DoppelDict(one=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd</span><br><span class="line">&#123;<span class="string">'one'</span>: <span class="number">1</span>&#125;  <span class="comment"># __init__æ–¹æ³•æ²¡æœ‰è°ƒç”¨è¦†ç›–çš„__setitem__æ–¹æ³•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd[<span class="string">'two'</span>] = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd</span><br><span class="line">&#123;<span class="string">'two'</span>: [<span class="number">2</span>, <span class="number">2</span>], <span class="string">'one'</span>: <span class="number">1</span>&#125;  <span class="comment"># []è¿ç®—ç¬¦è°ƒç”¨äº†</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd.update(three=<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd</span><br><span class="line">&#123;<span class="string">'three'</span>: <span class="number">3</span>, <span class="string">'two'</span>: [<span class="number">2</span>, <span class="number">2</span>], <span class="string">'one'</span>: <span class="number">1</span>&#125;  <span class="comment"># upateæ–¹æ³•æ²¡è°ƒç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dd.get(<span class="string">'three'</span>)  <span class="comment"># getæ–¹æ³•æ²¡è°ƒç”¨</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p>åŽŸç”Ÿç±»åž‹çš„è¿™ç§è¡Œä¸ºè¿èƒŒäº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªåŸºæœ¬åŽŸåˆ™ï¼š<strong>å§‹ç»ˆåº”è¯¥ä»Žç¤ºä¾‹ï¼ˆselfï¼‰æ‰€å±žçš„ç±»å¼€å§‹æœç´¢æ–¹æ³•ï¼Œå³ä½¿åœ¨è¶…ç±»ä¸­è°ƒç”¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</strong>åœ¨è¿™ç§ç³Ÿç³•çš„å±€é¢ä¸­ï¼Œ<code>__missing__</code>æ–¹æ³•å´èƒ½æŒ‰é¢„æœŸæ–¹å¼å·¥ä½œï¼Œä¸è¿‡è¿™åªæ˜¯ç‰¹ä¾‹ã€‚</p><a id="more"></a><p>ä¸åªæ˜¯å®žä¾‹å†…éƒ¨çš„è°ƒç”¨æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå†…ç½®ç±»åž‹çš„æ–¹æ³•è°ƒç”¨çš„å…¶ä»–ç±»çš„æ–¹æ³•ï¼Œå¦‚æžœè¢«è¦†ç›–äº†ï¼Œä¹Ÿä¸ä¼šè¢«è°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">AnswerDict</span><span class="params">(dict)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, key)</span>:</span> <span class="keyword">return</span> <span class="number">42</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ad = AnswerDict(a=<span class="string">'foo'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ad[<span class="string">'a'</span>]  <span class="comment"># å®žä¾‹å†…éƒ¨</span></span><br><span class="line"><span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.update(ad)  <span class="comment"># å†…ç½®dictç±»åž‹è¯»å–AnswerDictå®žä¾‹çš„å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'a'</span>]  <span class="comment"># æ²¡æœ‰è°ƒç”¨è¦†ç›–çš„__getitem__æ–¹æ³•</span></span><br><span class="line"><span class="string">'foo'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="string">'foo'</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸è¦å­ç±»åŒ–å†…ç½®ç±»åž‹ï¼Œç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»åº”è¯¥ç»§æ‰¿collectionsæ¨¡å—ä¸­çš„ç±»ï¼Œä¾‹å¦‚UserDictã€UserListå’ŒUserStringï¼Œè¿™äº›ç±»åšäº†ç‰¹æ®Šè®¾è®¡ï¼Œå› æ­¤æ˜“äºŽæ‰©å±•ã€‚</strong></p><h1 id="å¤šé‡ç»§æ‰¿å’Œæ–¹æ³•è§£æžé¡ºåº">å¤šé‡ç»§æ‰¿å’Œæ–¹æ³•è§£æžé¡ºåº</h1><p>ä»»ä½•å®žçŽ°å¤šé‡ç»§æ‰¿çš„è¯­è¨€éƒ½è¦å¤„ç†æ½œåœ¨çš„å‘½åå†²çªï¼Œè¿™ç§å†²çªç”±ä¸ç›¸å…³çš„ç¥–å…ˆç±»å®žçŽ°åŒåæ–¹æ³•å¼•èµ·ã€‚è¿™ç§å†²çªç§°ä¸ºâ€œè±å½¢é—®é¢˜â€ã€‚</p><figure class="highlight python"><figcaption><span>diamond.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ping</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'A ping:'</span>, self)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pong</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'B pong:'</span>, self)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pong</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'C pong:'</span>, self)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B, C)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ping</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().ping()</span><br><span class="line">        print(<span class="string">'D ping:'</span>, self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pingpong</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.ping()</span><br><span class="line">        super().ping()</span><br><span class="line">        self.pong()</span><br><span class="line">        super().pong()</span><br><span class="line">        C.pong(self)</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pYnApabDuSe0SL9p2qeg5N9JSvDIYxYISnABYnKS5Qgv582W83ClNKEJgnOgx0GJpaSHTiOkx89g28m9L-MeO5EZgwlW16BewIaummJ03BreeDjIKlDYzO0Ad20IBY06K2M8rhC3gdD6KUS2ueFL0G00"><p>è¯´æ˜Žâ€œè±å½¢é—®é¢˜â€çš„UMLç±»å›¾ã€‚è™šçº¿ç®­å¤´æ˜¯è¯¥ç¤ºä¾‹çš„æ–¹æ³•è§£æžé¡ºåºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> diamond <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = D()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.pong()  <span class="comment"># ç›´æŽ¥è°ƒç”¨ï¼ŒæŒ‰MROæœç´¢ï¼Œè¿è¡Œçš„æ˜¯Bç±»ä¸­çš„ç‰ˆæœ¬</span></span><br><span class="line">B pong: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.pong(d)  <span class="comment"># è°ƒç”¨æŒ‡å®šè¶…ç±»ä¸­çš„æ–¹æ³•ï¼Œæ­¤æ—¶è¦æŠŠå®žä¾‹ä½œä¸ºæ˜¾å¼å‚æ•°ä¼ å…¥</span></span><br><span class="line">C pong: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>D.__mro__  <span class="comment"># Dç±»çš„__mro__å±žæ€§</span></span><br><span class="line">(&lt;class 'diamond.D'&gt;, &lt;class 'diamond.B'&gt;, &lt;class 'diamond.C'&gt;, &lt;class 'diamond.A'&gt;, &lt;class 'object'&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.pingpong()</span><br><span class="line">A ping: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;</span><br><span class="line">D ping: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;  <span class="comment"># å‰ä¸¤è¡Œæ˜¯self.ping()çš„ç»“æžœ</span></span><br><span class="line">A ping: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;  <span class="comment"># super().ping()</span></span><br><span class="line">B pong: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;  <span class="comment"># self.pong()</span></span><br><span class="line">B pong: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;  <span class="comment"># super().pong()</span></span><br><span class="line">C pong: &lt;diamond.D object at <span class="number">0x10d5d4e80</span>&gt;  <span class="comment"># C.pong(d)</span></span><br></pre></td></tr></table></figure><p>Pythonèƒ½åŒºåˆ†d.pong()è°ƒç”¨çš„æ˜¯å“ªä¸ªæ–¹æ³•ï¼Œæ˜¯å› ä¸ºPythonä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºéåŽ†ç»§æ‰¿å›¾ã€‚è¿™ä¸ªé¡ºåºå«æ–¹æ³•è§£æžé¡ºåºï¼ˆMethod Resolution Orderï¼ŒMROï¼‰ã€‚ç±»éƒ½æœ‰ä¸€ä¸ªåä¸º<code>__mro__</code>çš„å±žæ€§ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒæŒ‰ç…§æ–¹æ³•è§£æžé¡ºåºåˆ—å‡ºå„ä¸ªè¶…ç±»ï¼Œä»Žå½“å‰ç±»ä¸€ç›´å‘ä¸Šï¼Œç›´åˆ°objectç±»ã€‚æ–¹æ³•è§£æžé¡ºåºä¸ä»…è€ƒè™‘ç»§æ‰¿å›¾ï¼Œè¿˜è€ƒè™‘å­ç±»å£°æ˜Žä¸­åˆ—å‡ºè¶…ç±»çš„é¡ºåºã€‚å¦‚æžœæŠŠDç±»å£°æ˜Žä¸º<code>class D(C, B):</code>ï¼Œé‚£ä¹ˆDç±»çš„<code>__mro__</code>å±žæ€§å°±ä¼šä¸ä¸€æ ·ï¼Œå…ˆæœç´¢Cç±»ï¼Œå†æœç´¢Bç±»ã€‚</p><p>è‹¥æƒ³æŠŠæ–¹æ³•å§”æ‰˜ç»™è¶…ç±»ï¼ŒæŽ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨å†…ç½®çš„super()å‡½æ•°ï¼Œæœ€å®‰å…¨ï¼Œä¹Ÿä¸æ˜“è¿‡æ—¶ã€‚è°ƒç”¨æ¡†æž¶æˆ–ä¸å—è‡ªå·±æŽ§åˆ¶çš„ç±»å±‚æ¬¡ç»“æž„ä¸­çš„æ–¹æ³•æ—¶ï¼Œå°¤å…¶é€‚åˆä½¿ç”¨super()ã€‚ä½¿ç”¨super()è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šéµå®ˆæ–¹æ³•è§£æžé¡ºåºã€‚ç„¶è€Œï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦ç»•è¿‡æ–¹æ³•è§£æžé¡ºåºï¼Œç›´æŽ¥è°ƒç”¨æŸä¸ªè¶…ç±»çš„æ–¹æ³•ã€‚ä¾‹å¦‚C.pong(d)ã€‚æ³¨æ„ï¼Œç›´æŽ¥åœ¨ç±»ä¸Šè°ƒç”¨å®žä¾‹æ–¹æ³•æ—¶ï¼Œå¿…é¡»æ˜¾å¼åœ°ä¼ å…¥selfå‚æ•°ï¼Œå› ä¸ºè¿™æ ·è®¿é—®çš„æ˜¯æœªç»‘å®šæ–¹æ³•ï¼ˆunbound methodï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">print_mro</span><span class="params">(cls)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">', '</span>.join(c.__name__ <span class="keyword">for</span> c <span class="keyword">in</span> cls.__mro__))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_mro(bool)</span><br><span class="line">bool, int, object</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numbers</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_mro(numbers.Integral)</span><br><span class="line">Integral, Rational, Real, Complex, Number, object</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> io</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_mro(io.BytesIO)</span><br><span class="line">BytesIO, _BufferedIOBase, _IOBase, object  <span class="comment"># ä»¥Baseç»“å°¾çš„æ˜¯æŠ½è±¡åŸºç±»</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_mro(io.TextIOWrapper)</span><br><span class="line">TextIOWrapper, _TextIOBase, _IOBase, object</span><br></pre></td></tr></table></figure><p>å¤šé‡ç»§æ‰¿èƒ½å‘æŒ¥ç§¯æžä½œç”¨ã€‚ã€Šè®¾è®¡æ¨¡å¼:å¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ä¸­çš„é€‚é…å™¨æ¨¡å¼ç”¨çš„å°±æ˜¯å¤šé‡ç»§æ‰¿ï¼Œå› æ­¤ä½¿ç”¨å¤šé‡ç»§æ‰¿è‚¯å®šæ²¡æœ‰é”™ï¼ˆé‚£æœ¬ä¹¦ä¸­çš„å…¶ä»–22ä¸ªè®¾è®¡æ¨¡å¼éƒ½ä½¿ç”¨å•ç»§æ‰¿ï¼Œå› æ­¤å¤šé‡ç»§æ‰¿æ˜¾ç„¶ä¸æ˜¯çµä¸¹å¦™è¯)ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> inheritance </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡å‡†åº“ä¸­çš„æŠ½è±¡åŸºç±»</title>
      <link href="/notes/fluent-python/abc-s-in-standard-library/"/>
      <url>/notes/fluent-python/abc-s-in-standard-library/</url>
      
        <content type="html"><![CDATA[<h1 id="abc-æ¨¡å—ä¸­çš„æŠ½è±¡åŸºç±»">abc æ¨¡å—ä¸­çš„æŠ½è±¡åŸºç±»</h1><p>Python3.4 åœ¨ <code>collections.abc</code> æ¨¡å—ä¸­å®šä¹‰äº† 16 ä¸ªæŠ½è±¡åŸºç±»ï¼ˆPython3.6 å®šä¹‰äº† 25 ä¸ªï¼‰ï¼Œç®€è¦çš„ UML ç±»å›¾å¦‚ä¸‹ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/TP513e8m44NtdA8Nu0Rkt6YCAnFs0qoaILiGXXYCXpS2RMTQtRxv_tVcjzCjAhG3BSgYhN4ie9veX8RKcN24sc0anzuHQCT5D_t2bYd06EavmTH9ikPIpqFmCQDhcEOAmw3TdKiecrOQdmpEz7tdHzOso2A3WSHkTfAv5rmIKe6PSME-8tLubsMyJEAmaiH-eLHCHUWvyIVS1sHoAjPlIToCUQUGqG_5UgHFs2T9pxjI34C-KcAYo6BN0OMksVEfE1lzDyMF-W00"><a id="more"></a><ul><li><p>Iterableã€Container å’Œ Sized</p><p>å„ä¸ªé›†åˆåº”è¯¥ç»§æ‰¿è¿™ä¸‰ä¸ªæŠ½è±¡åŸºç±»ï¼Œæˆ–è€…è‡³å°‘å®žçŽ°å…¼å®¹çš„åè®®ã€‚</p></li><li><p>Sequenceã€Mapping å’Œ Set</p><p>è¿™ä¸‰ä¸ªæ˜¯ä¸»è¦çš„ä¸å¯å˜é›†åˆç±»åž‹ï¼Œè€Œä¸”å„è‡ªéƒ½æœ‰å¯å˜çš„å­ç±»ã€‚</p></li><li><p>MappingView</p><p>åœ¨ Python3 ä¸­ï¼Œæ˜ å°„æ–¹æ³• <code>.items()</code>ã€<code>.keys()</code>ã€<code>.values()</code> è¿”å›žçš„å¯¹è±¡åˆ†åˆ«æ˜¯ ItemsViewã€KeysView å’Œ ValuesView çš„å®žä¾‹ã€‚å‰ä¸¤ä¸ªç±»è¿˜ä»Ž Set ç±»ç»§æ‰¿äº†ä¸°å¯Œçš„æŽ¥å£ã€‚</p></li><li><p>Callable å’Œ Hashable</p><p>è¿™ä¸¤ä¸ªæŠ½è±¡åŸºç±»ä¸Žé›†åˆæ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œåªä¸è¿‡å› ä¸º <code>collections.abc</code> æ˜¯æ ‡å‡†åº“ä¸­å®šä¹‰æŠ½è±¡åŸºç±»çš„ç¬¬ä¸€ä¸ªæ¨¡å—ï¼Œè€Œå®ƒä»¬åˆå¤ªé‡è¦äº†ï¼Œå› æ­¤æ‰æŠŠå®ƒä»¬æ”¾åˆ° <code>collections.abc</code> æ¨¡å—ä¸­ã€‚è¿™ä¸¤ä¸ªæŠ½è±¡åŸºç±»çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºå†…ç½®å‡½æ•° isinstance æä¾›æ”¯æŒï¼Œä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼åˆ¤æ–­å¯¹è±¡èƒ½ä¸èƒ½è°ƒç”¨æˆ–æ•£åˆ—ã€‚è‹¥æƒ³æ£€æŸ¥æ˜¯å¦èƒ½è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ <code>callable()</code> å‡½æ•°ï¼›ä½†æ˜¯æ²¡æœ‰ç±»ä¼¼çš„ <code>hashable()</code> å‡½æ•°ï¼Œå› æ­¤æµ‹è¯•å¯¹è±¡æ˜¯å¦å¯æ•£åˆ—ï¼Œæœ€å¥½ä½¿ç”¨ <code>isinstance(my_obj, Hashable)</code>ã€‚</p></li><li><p>Iterator</p><p>æ³¨æ„å®ƒæ˜¯ Iterable çš„å­ç±»ã€‚</p></li></ul><p>ç»§ <code>collections.abc</code> ä¹‹åŽï¼Œæ ‡å‡†åº“ä¸­æœ€æœ‰ç”¨çš„æŠ½è±¡åŸºç±»åŒ…æ˜¯ numbersã€‚</p><h1 id="æŠ½è±¡åŸºç±»çš„æ•°å­—å¡”">æŠ½è±¡åŸºç±»çš„æ•°å­—å¡”</h1><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYIamgBYbAJ2vHy2j5vJldvnRaf5OW189I4tEGU8abcVbvo2AUUIMfwKL04OX92ZOrkhfmKw0qH11i4eY0Sc56mHWGOPXv0000"><p>å¦‚æžœæƒ³æ£€æŸ¥ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯æ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>instance(x, numbers.Integral)</code>ï¼Œè¿™æ ·ä»£ç å°±èƒ½æŽ¥å— intã€boolï¼ˆint çš„å­ç±»ï¼‰ï¼Œæˆ–è€…å¤–éƒ¨åº“ä½¿ç”¨ numbers æŠ½è±¡åŸºç±»æ³¨å†Œçš„å…¶ä»–ç±»åž‹ã€‚</p><p>ä¸Žä¹‹ç±»ä¼¼ï¼Œå¦‚æžœä¸€ä¸ªå€¼å¯èƒ½æ˜¯æµ®ç‚¹æ•°ç±»åž‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>instance(x, numbers.Real)</code> æ£€æŸ¥ã€‚è¿™æ ·ä»£ç å°±èƒ½æŽ¥å— boolã€intã€floatã€fractions.Fractionï¼Œæˆ–è€…å¤–éƒ¨åº“æä¾›çš„éžå¤æ•°ç±»åž‹ã€‚</p><p><code>decimal.Decimal</code> æ²¡æœ‰æ³¨å†Œä¸º <code>numbers.Real</code> çš„è™šæ‹Ÿå­ç±»ã€‚åŽŸå› æ˜¯ï¼Œå¦‚æžœä½ çš„ç¨‹åºéœ€è¦ Decimal çš„ç²¾åº¦ï¼Œè¦é˜²æ­¢ä¸Žå…¶ä»–ä½Žç²¾åº¦æ•°å­—ç±»åž‹æ··æ·†ï¼Œå°¤å…¶æ˜¯æµ®ç‚¹æ•°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> ABC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŽ¥å£ï¼šæŠ½è±¡åŸºç±»</title>
      <link href="/notes/fluent-python/interfaces-abc-s/"/>
      <url>/notes/fluent-python/interfaces-abc-s/</url>
      
        <content type="html"><![CDATA[<p>æŠ½è±¡åŸºç±»ä¸Žæè¿°ç¬¦å’Œå…ƒç±»ä¸€æ ·ï¼Œé€‚ç”¨äºŽæž„å»ºæ¡†æž¶çš„å·¥å…·ã€‚å› æ­¤ï¼Œåªæœ‰å°‘æ•°Pythonå¼€å‘è€…ç¼–å†™çš„æŠ½è±¡åŸºç±»ä¸ä¼šå¯¹ç”¨æˆ·æ–½åŠ ä¸å¿…è¦çš„é™åˆ¶ï¼Œè®©ä»–ä»¬åšæ— ç”¨åŠŸã€‚ä¸å»ºè®®è‡ªå·±ç¼–å†™æŠ½è±¡åŸºç±»ï¼Œå› ä¸ºå¾ˆå®¹æ˜“è¿‡åº¦è®¾è®¡ã€‚åªè¦æ­£ç¡®ä½¿ç”¨çŽ°æœ‰çš„æŠ½è±¡åŸºç±»ï¼Œå°±èƒ½èŽ·å¾—99.9%çš„å¥½å¤„ï¼Œè€Œä¸ç”¨å†’ç€è®¾è®¡ä¸å½“å¯¼è‡´çš„å·¨å¤§é£Žé™©ã€‚</p><p>å¼•å…¥æŠ½è±¡åŸºç±»ä¹‹å‰ï¼ŒPythonå°±å·²ç»éžå¸¸æˆåŠŸäº†ï¼Œå³ä¾¿çŽ°åœ¨ä¹Ÿå¾ˆå°‘æœ‰ä»£ç ä½¿ç”¨æŠ½è±¡åŸºç±»ã€‚</p><h1 id="æŠ½è±¡åŸºç±»">æŠ½è±¡åŸºç±»</h1><p>Pythonçš„æŠ½è±¡åŸºç±»æœ‰ä¸€ä¸ªé‡è¦çš„å®žç”¨ä¼˜åŠ¿ï¼šå¯ä»¥ä½¿ç”¨registerç±»æ–¹æ³•åœ¨ç»ˆç«¯ç”¨æˆ·çš„ä»£ç ä¸­æŠŠæŸä¸ªç±»â€å£°æ˜Žâ€œä¸ºä¸€ä¸ªæŠ½è±¡åŸºç±»çš„â€œè™šæ‹Ÿâ€å­ç±»ã€‚ä¸ºæ­¤ï¼Œè¢«æ³¨å†Œçš„ç±»å¿…é¡»æ»¡è¶³æŠ½è±¡åŸºç±»å¯¹æ–¹æ³•åç§°å’Œç­¾åçš„è¦æ±‚ï¼Œæœ€é‡è¦çš„æ˜¯è¦æ»¡è¶³åº•å±‚è¯­ä¹‰å¥‘çº¦ï¼›ä½†æ˜¯ï¼Œå¼€å‘é‚£ä¸ªç±»æ—¶ä¸ç”¨äº†è§£æŠ½è±¡åŸºç±»ï¼Œæ›´ä¸ç”¨ç»§æ‰¿æŠ½è±¡ç±»ã€‚è¿™å¤§å¤§åœ°æ‰“ç ´äº†ä¸¥æ ¼çš„è€¦åˆï¼Œä¸Žé¢å‘å¯¹è±¡ç¼–ç¨‹äººå‘˜æŽŒæ¡çš„çŸ¥è¯†æœ‰å¾ˆå¤§çš„å‡ºå…¥ï¼Œå› æ­¤ä½¿ç”¨ç»§æ‰¿æ—¶è¦å°å¿ƒã€‚</p><p>æœ‰æ—¶ï¼Œä¸ºäº†è®©æŠ½è±¡åŸºç±»è¯†åˆ«å­ç±»ï¼Œç”šè‡³ä¸ç”¨æ³¨å†Œã€‚å…¶å®žï¼ŒæŠ½è±¡åŸºç±»çš„æœ¬è´¨å°±æ˜¯å‡ ä¸ªç‰¹æ®Šæ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Struggle</span>:</span>  <span class="comment"># æ— ç»§æ‰¿</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span> <span class="keyword">return</span> <span class="number">23</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(Struggle(), abc.Sized)  <span class="comment"># æ— æ³¨å†Œabc.Sized.register(Struggle)</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(Struggle, abc.Sized)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œæ— éœ€æ³¨å†Œï¼Œabc.Sizedä¹Ÿèƒ½æŠŠStruggleè¯†åˆ«ä¸ºè‡ªå·±çš„å­ç±»ï¼Œåªè¦å®žçŽ°äº†ç‰¹æ®Šæ–¹æ³•<code>__len__</code>å³å¯ã€‚è¦ä½¿ç”¨æ­£ç¡®çš„å¥æ³•å’Œè¯­ä¹‰ï¼Œå‰è€…è¦æ±‚æ²¡æœ‰å‚æ•°ï¼ŒåŽè€…è¦æ±‚è¿”å›žä¸€ä¸ªéžè´Ÿæ•´æ•°ï¼ŒæŒ‡æ˜Žå¯¹è±¡çš„é•¿åº¦ã€‚å¦‚æžœä¸ä½¿ç”¨è§„å®šçš„å¥æ³•å’Œè¯­ä¹‰å®žçŽ°ç‰¹æ®Šæ–¹æ³•ï¼Œä¼šå¯¼è‡´éžå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚</p><p>å¦‚æžœå®žçŽ°çš„ç±»ä½“çŽ°äº†numbersã€collections.abcæˆ–å…¶ä»–æ¡†æž¶ä¸­æŠ½è±¡åŸºç±»çš„æ¦‚å¿µï¼Œè¦ä¹ˆç»§æ‰¿ç›¸åº”çš„æŠ½è±¡åŸºç±»ï¼ˆå¿…è¦æ—¶ï¼‰ï¼Œè¦ä¹ˆæŠŠç±»æ³¨å†Œåˆ°ç›¸åº”çš„æŠ½è±¡åŸºç±»ä¸­ã€‚å¼€å§‹å¼€å‘ç¨‹åºæ—¶ï¼Œä¸è¦ä½¿ç”¨æä¾›æ³¨å†ŒåŠŸèƒ½çš„åº“æˆ–æ¡†æž¶ï¼Œè¦è‡ªå·±åŠ¨æ‰‹æ³¨å†Œï¼›å¦‚æžœå¿…è¦æ£€æŸ¥å‚æ•°çš„ç±»åž‹ï¼ˆè¿™æ˜¯æœ€å¸¸è§çš„ï¼‰ï¼Œä¾‹å¦‚æ£€æŸ¥æ˜¯ä¸æ˜¯åºåˆ—ï¼Œé‚£å°±è¿™æ ·åšï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">isinstance(the_arg, collections.abc.Sequece)</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿æŠ½è±¡åŸºç±»å¾ˆç®€å•ï¼Œåªéœ€è¦å®žçŽ°æ‰€éœ€çš„æ–¹æ³•ï¼Œè¿™æ ·ä¹Ÿèƒ½æ˜Žç¡®è¡¨æ˜Žå¼€å‘è€…çš„æ„å›¾ã€‚è¿™ä¸€æ„å›¾è¿˜èƒ½é€šè¿‡æ³¨å†Œè™šæ‹Ÿå­ç±»æ¥å®žçŽ°ã€‚æ­¤å¤–ï¼Œä½¿ç”¨isinstanceå’Œissubclassæµ‹è¯•æŠ½è±¡åŸºç±»æ›´ä¸ºäººæŽ¥å—ã€‚è¿‡åŽ»ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ç”¨æ¥æµ‹è¯•é¸­å­ç±»åž‹ï¼Œä½†ç”¨äºŽæŠ½è±¡åŸºç±»ä¼šæ›´çµæ´»ã€‚æ¯•ç«Ÿï¼Œå¦‚æžœæŸä¸ªç»„ä»¶æ²¡æœ‰ç»§æ‰¿æŠ½è±¡åŸºç±»ï¼Œäº‹åŽè¿˜å¯ä»¥æ³¨å†Œï¼Œè®©æ˜¾å¼ç±»åž‹æ£€æŸ¥é€šè¿‡ã€‚</p><p>ç„¶è€Œï¼Œå³ä¾¿æ˜¯æŠ½è±¡åŸºç±»ï¼Œä¹Ÿä¸èƒ½æ»¥ç”¨isinstanceæ£€æŸ¥ï¼Œç”¨çš„å¤šäº†å¯èƒ½å¯¼è‡´ä»£ç å¼‚å‘³ï¼Œå³è¡¨æ˜Žé¢å‘å¯¹è±¡è®¾è®¡å¾—ä¸å¥½ã€‚<strong>åœ¨ä¸€è¿žä¸²if/elif/elifä¸­ä½¿ç”¨isinstanceæ£€æŸ¥ï¼Œç„¶åŽæ ¹æ®å¯¹è±¡çš„ç±»åž‹æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œé€šå¸¸æ˜¯ä¸å¥½çš„åšæ³•ï¼›æ­¤æ—¶åº”è¯¥ä½¿ç”¨å¤šæ€ï¼Œå³é‡‡ç”¨ä¸€å®šçš„æ–¹å¼å®šä¹‰ç±»ï¼Œè®©è§£é‡Šå™¨æŠŠè°ƒç”¨åˆ†æ´¾ç»™æ­£ç¡®çš„æ–¹æ³•ï¼Œè€Œä¸ä½¿ç”¨if/elif/elifå—ç¡¬ç¼–ç åˆ†æ´¾é€»è¾‘ã€‚</strong></p><p><strong>å…·ä½“ä½¿ç”¨æ—¶ï¼Œä¸Šè¿°å»ºè®®æœ‰ä¸€ä¸ªå¸¸è§çš„ä¾‹å¤–ï¼šæœ‰äº›Python APIæŽ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åºåˆ—ï¼›å› ä¸ºå­—ç¬¦ä¸²æ˜¯åºåˆ—ç±»åž‹ï¼Œæ‰€ä»¥ä¸ºäº†æŠŠå®ƒå’Œå…¶ä»–ä¸å¯å˜åºåˆ—åŒºåˆ†å¼€ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨isinstance(x, str)æ£€æŸ¥ã€‚</strong></p><blockquote><p>å°½ç®¡æŠ½è±¡åŸºç±»ä½¿å¾—ç±»åž‹æ£€æŸ¥å˜å¾—æ›´å®¹æ˜“äº†ï¼Œä½†ä¸åº”è¯¥åœ¨ç¨‹åºä¸­è¿‡åº¦ä½¿ç”¨å®ƒã€‚Pythonçš„æ ¸å¿ƒåœ¨äºŽå®ƒæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå®ƒå¸¦æ¥äº†æžå¤§çš„çµæ´»æ€§ã€‚å¦‚æžœå¤„å¤„éƒ½å¼ºåˆ¶å®žè¡Œç±»åž‹çº¦æŸï¼Œé‚£ä¹ˆä¼šä½¿ä»£ç å˜å¾—æ›´åŠ å¤æ‚ï¼Œè€Œæœ¬ä¸åº”è¯¥å¦‚æ­¤ã€‚æˆ‘ä»¬åº”è¯¥æ‹¥æŠ±Pythonçš„çµæ´»æ€§ã€‚</p><p>â€”â€”David Beazleyå’ŒBrian Jones ã€ŠPython Cookbook(ç¬¬3ç‰ˆ)ä¸­æ–‡ç‰ˆã€‹</p></blockquote><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æžœå¿…é¡»å¼ºåˆ¶æ‰§è¡ŒAPIå¥‘çº¦ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨isinstanceæ£€æŸ¥æŠ½è±¡åŸºç±»ã€‚â€œè€å…„ï¼Œå¦‚æžœä½ æƒ³è°ƒç”¨æˆ‘ï¼Œå¿…é¡»å®žçŽ°è¿™ä¸ªâ€ï¼Œæ­£å¦‚æœ¬ä¹¦æŠ€æœ¯å®¡æ ¡Lennart Regebroæ‰€è¯´çš„ã€‚è¿™å¯¹é‡‡ç”¨æ’å…¥å¼æž¶æž„çš„ç³»ç»Ÿæ¥è¯´ç‰¹åˆ«æœ‰ç”¨ã€‚åœ¨æ¡†æž¶ä¹‹å¤–ï¼Œé¸­å­ç±»åž‹é€šå¸¸æ¯”ç±»åž‹æ£€æŸ¥æ›´ç®€å•ï¼Œä¹Ÿæ›´çµæ´»ã€‚</p><p>ä¾‹å¦‚ï¼Œæœ¬ä¹¦æœ‰å‡ ä¸ªç¤ºä¾‹è¦ä½¿ç”¨åºåˆ—ï¼ŒæŠŠå®ƒå½“æˆåˆ—è¡¨å¤„ç†ã€‚æˆ‘æ²¡æœ‰æ£€æŸ¥å‚æ•°çš„ç±»åž‹æ˜¯ä¸æ˜¯listï¼Œè€Œæ˜¯ç›´æŽ¥æŽ¥å—å‚æ•°ï¼Œç«‹å³ä½¿ç”¨å®ƒæž„å»ºä¸€ä¸ªåˆ—è¡¨ï¼ˆlist(x)ï¼‰ã€‚è¿™æ ·ï¼Œæˆ‘å°±å¯ä»¥æŽ¥å—ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼›å¦‚æžœå‚æ•°ä¸æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œè°ƒç”¨ç«‹å³å¤±è´¥ï¼Œå¹¶ä¸”æä¾›éžå¸¸æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯ã€‚å½“ç„¶ï¼Œå¦‚æžœåºåˆ—å¤ªé•¿ï¼ˆå¤åˆ¶å¼€é”€å¾ˆå¤§ï¼‰æˆ–è€…éœ€è¦å°±åœ°ä¿®æ”¹åºåˆ—è€Œå¯¼è‡´æ— æ³•å¤åˆ¶å‚æ•°ï¼Œå°±ä¸èƒ½é‡‡ç”¨è¿™ç§æ–¹å¼ï¼›æ­¤æ—¶ï¼Œä½¿ç”¨isinstance(x, abc.MutableSequence)æ›´å¥½ã€‚å¦‚æžœå¯ä»¥æŽ¥å—ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨iter(x)å‡½æ•°èŽ·å¾—ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p><p>æ¨¡ä»¿collections.namedtupleå¤„ç†<code>field_names</code>å‚æ•°çš„æ–¹å¼ä¹Ÿæ˜¯ä¸€ä¾‹ï¼š<code>field_names</code>çš„å€¼å¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥ç©ºæ ¼æˆ–é€—å·åˆ†éš”æ ‡è¯†ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦åºåˆ—ã€‚æ­¤æ—¶å¯èƒ½æƒ³ä½¿ç”¨isinstanceï¼Œä½†æˆ‘ä¼šä½¿ç”¨é¸­å­ç±»åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:  <span class="comment"># å‡è®¾æ˜¯å•ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">    field_names = field_names.replace(<span class="string">','</span>, <span class="string">' '</span>).split()  <span class="comment"># è¯•å›¾æ›¿æ¢å¹¶æ‹†åˆ†</span></span><br><span class="line"><span class="keyword">except</span> AttributeError:  <span class="comment"># æŠ±æ­‰ï¼Œfield_namesçœ‹èµ·æ¥ä¸åƒæ˜¯å­—ç¬¦ä¸²...</span></span><br><span class="line">    <span class="keyword">pass</span>                <span class="comment"># æ²¡æœ‰.replaceæ–¹æ³•ï¼Œæˆ–è€…è¿”å›žå€¼ä¸èƒ½ä½¿ç”¨.splitæ–¹æ³•æ‹†åˆ†</span></span><br><span class="line"><span class="comment"># å‡è®¾å·²ç»æ˜¯ç”±åç§°ç»„æˆçš„å¯è¿­ä»£å¯¹è±¡äº†</span></span><br><span class="line">field_names = tuple(field_names)  <span class="comment"># ç¡®ä¿æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œä¹Ÿä¸ºäº†ä¿å­˜ä¸€ä»½å‰¯æœ¬ï¼Œä½¿ç”¨æ‰€å¾—å€¼åˆ›å»ºä¸€ä¸ªå…ƒç»„</span></span><br></pre></td></tr></table></figure><h1 id="å®šä¹‰æŠ½è±¡åŸºç±»çš„å­ç±»">å®šä¹‰æŠ½è±¡åŸºç±»çš„å­ç±»</h1><img src="http://www.plantuml.com/plantuml/svg/ZLBB4e8m3Bpp5Vq1_i2R9m-U_02ca1tf37rOWgCY_svLK5iLpN6pEybkKYk2W7Py51gwXCzasRAN5OkbDIoLWHTz9aBr6bnR6aG_KGPH5DMTrHP5DZorAuQNPODPgGgaMBPH9z2ife599DXrCDNyf2qu3DD1UUNaeM9oP2FfZ5icgCSUlWMb7MK8XnYgR6VuTULrnzTi_jgyZJR_p24qFpZ163n_CI-TWw4O6-t580xyHdJMfKfjztWBKHBTxlPygiKvpn_NonuF4yFtXqYmARS0frbU0000"><p>Sequenceå’ŒMutableSequenceæŠ½è±¡åŸºç±»çš„æ–¹æ³•ä¸å…¨æ˜¯æŠ½è±¡çš„ã€‚ä»¥æ–œä½“æ˜¾ç¤ºçš„åç§°æ˜¯æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•ã€‚</p><figure class="highlight python"><figcaption><span>frenchdeck2.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">Card = collections.namedtuple(<span class="string">'Card'</span>, [<span class="string">'rank'</span>, <span class="string">'suit'</span>])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrenchDeck2</span><span class="params">(collections.MutableSequence)</span>:</span>  <span class="comment"># ç»§æ‰¿æŠ½è±¡åŸºç±»</span></span><br><span class="line">    ranks = [str(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">11</span>)] + list(<span class="string">'JQKA'</span>)</span><br><span class="line">    suits = <span class="string">'spades diamonds clubs hearts'</span>.split()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._cards = [Card(rank, suit) <span class="keyword">for</span> suit <span class="keyword">in</span> self.suits</span><br><span class="line">                                        <span class="keyword">for</span> rank <span class="keyword">in</span> self.ranks]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._cards)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, position)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._cards[position]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, position, value)</span>:</span>  <span class="comment"># æ”¯æŒæ´—ç‰Œå¿…é¡»å®žçŽ°__setitem__æ–¹æ³•</span></span><br><span class="line">        self._cards[position] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, position)</span>:</span>  <span class="comment"># å¿…é¡»å®žçŽ°çš„åŸºç±»æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">del</span> self._cards[position]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, position, value)</span>:</span>  <span class="comment"># å¿…é¡»å®žçŽ°çš„åŸºç±»æŠ½è±¡æ–¹æ³•</span></span><br><span class="line">        self._cards.insert(position, value)</span><br></pre></td></tr></table></figure><p>å¯¼å…¥æ—¶ï¼ˆåŠ è½½å¹¶ç¼–è¯‘frenchdeck2.pyæ¨¡å—æ—¶ï¼‰ï¼ŒPythonä¸ä¼šæ£€æŸ¥æŠ½è±¡æ–¹æ³•çš„å®žçŽ°ï¼Œåœ¨è¿è¡Œæ—¶å®žä¾‹åŒ–FrenchDeck2ç±»æ—¶æ‰ä¼šçœŸæ­£æ£€æŸ¥ã€‚å› æ­¤ï¼Œå¦‚æžœæ²¡æœ‰æ­£ç¡®å®žçŽ°æŸä¸ªæŠ½è±¡æ–¹æ³•ï¼ŒPythonä¼šæŠ›å‡ºTypeErrorå¼‚å¸¸ï¼Œå¹¶æŠŠé”™è¯¯æ¶ˆæ¯è®¾ä¸º&quot;Cant' instantiate abstract class FrenchDeck2 with abstract method <code>__delitem__</code>, insert&quot;ã€‚æ­£æ˜¯è¿™ä¸ªåŽŸå› ï¼Œå³ä¾¿FrenchDeck2ç±»ä¸éœ€è¦<code>__delitem__</code>å’Œinsertæä¾›çš„è¡Œä¸ºï¼Œä¹Ÿè¦å®žçŽ°ï¼Œå› ä¸ºMutableSequenceæŠ½è±¡åŸºç±»éœ€è¦å®ƒä»¬ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥è¦†ç›–ä»ŽæŠ½è±¡åŸºç±»ç»§æ‰¿çš„æ–¹æ³•ï¼Œä»¥æ›´é«˜æ•ˆçš„æ–¹å¼é‡æ–°å®žçŽ°ã€‚ä¾‹å¦‚ï¼Œ<code>__contains__</code>æ–¹æ³•ä¼šå…¨é¢æ‰«æåºåˆ—ï¼Œå¯æ˜¯ï¼Œå¦‚æžœä½ å®šä¹‰çš„åºåˆ—æŒ‰é¡ºåºä¿å­˜å…ƒç´ ï¼Œé‚£å°±å¯ä»¥é‡æ–°å®šä¹‰<code>__contains__</code>æ–¹æ³•ï¼Œä½¿ç”¨bisectå‡½æ•°åšäºŒåˆ†æŸ¥æ‰¾ï¼Œä»Žè€Œæå‡æœç´¢é€Ÿåº¦ã€‚</p><h1 id="å®šä¹‰å¹¶ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡åŸºç±»">å®šä¹‰å¹¶ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡åŸºç±»</h1><p>ä¸ºäº†è¯æ˜Žæœ‰å¿…è¦å®šä¹‰æŠ½è±¡åŸºç±»ï¼Œæˆ‘ä»¬è¦åœ¨æ¡†æž¶ä¸­æ‰¾åˆ°ä½¿ç”¨å®ƒçš„åœºæ™¯ã€‚æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šä½ è¦åœ¨ç½‘ç«™æˆ–ç§»åŠ¨åº”ç”¨ä¸­æ˜¾ç¤ºéšæœºå¹¿å‘Šï¼Œä½†æ˜¯åœ¨æ•´ä¸ªå¹¿å‘Šæ¸…å•è½®è½¬ä¸€éä¹‹å‰ï¼Œä¸é‡å¤æ˜¾ç¤ºå¹¿å‘Šã€‚å‡è®¾æˆ‘ä»¬æž„å»ºä¸€ä¸ªå¹¿å‘Šç®¡ç†æ¡†æž¶ï¼Œåä¸ºADAMã€‚å®ƒçš„èŒè´£ä¹‹ä¸€æ˜¯ï¼Œæ”¯æŒç”¨æˆ·æä¾›éšæœºæŒ‘é€‰çš„æ— é‡å¤ç±»ã€‚ä¸ºäº†è®©ADAMçš„ç”¨æˆ·æ˜Žç¡®ç†è§£â€œéšæœºæŒ‘é€‰çš„æ— é‡å¤â€ç»„ä»¶æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæŠ½è±¡åŸºç±»ã€‚</p><p>å—åˆ°â€œæ ˆâ€å’Œâ€œé˜Ÿåˆ—â€ï¼ˆä»¥ç‰©ä½“çš„æŽ’åˆ—æ–¹å¼è¯´æ˜ŽæŠ½è±¡æŽ¥å£ï¼‰å¯å‘ï¼Œæˆ‘å°†ä½¿ç”¨çŽ°å®žä¸–ç•Œä¸­çš„ç‰©å“å‘½åè¿™ä¸ªæŠ½è±¡åŸºç±»ï¼šå®¾æžœæœºå’Œå½©ç¥¨æœºæ˜¯éšæœºä»Žæœ‰é™çš„é›†åˆä¸­æŒ‘é€‰ç‰©å“çš„æœºå™¨ï¼Œé€‰å‡ºçš„ç‰©å“æ²¡æœ‰é‡å¤ï¼Œç›´åˆ°é€‰å®Œä¸ºæ­¢ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªæŠ½è±¡åŸºç±»å‘½åä¸ºTombolaï¼Œè¿™æ˜¯å®¾æžœæœºå’Œæ‰“ä¹±æ•°å­—çš„æ»šåŠ¨å®¹å™¨çš„æ„å¤§åˆ©åã€‚</p><p>TombolaæŠ½è±¡åŸºç±»æœ‰å››ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ä¸¤ä¸ªæ˜¯æŠ½è±¡æ–¹æ³•ã€‚</p><ul><li><code>.load(...)</code>ï¼šæŠŠå…ƒç´ æ”¾å…¥å®¹å™¨ã€‚</li><li><code>.pick()</code>ï¼šä»Žå®¹å™¨ä¸­éšæœºæ‹¿å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›žé€‰ä¸­çš„å…ƒç´ ã€‚</li></ul><p>å¦å¤–ä¸¤ä¸ªæ˜¯å…·ä½“æ–¹æ³•ï¼š</p><ul><li><code>.loaded()</code>ï¼šå¦‚æžœå®¹å™¨ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›žTrueã€‚</li><li><code>.inspect()</code>è¿”å›žä¸€ä¸ªæœ‰åºå…ƒç»„ï¼Œç”±å®¹å™¨ä¸­çš„çŽ°æœ‰å…ƒç´ æž„æˆï¼Œä¸ä¼šä¿®æ”¹å®¹å™¨çš„å†…å®¹ï¼ˆå†…éƒ¨çš„é¡ºåºä¸ä¿ç•™ï¼‰ã€‚</li></ul><img src="http://www.plantuml.com/plantuml/svg/dL2n3e8m4DtvYXjrW0ymX05NHlUcBHTiB9IqXuOW_sv56ekBqPkkxrxVlNjdLIDWszC8BRO2RSA58yibmScqmcWEKmA-fe3Fe0slT_jFj5VoigAfhwLvCZ5mLUTwbEHVSo8rTmvArJNco1jSTp2cEaMChH-YFP4uOv9hlP22JcM8q8wbDZUqlsXzyVUAe5AE8C-lojB0DRX1BDEYcFvH3gdczpHz1x25D_T4eooB71sy9ukDRz5YNHGF"><figure class="highlight python"><figcaption><span>tombola.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tombola</span><span class="params">(abc.ABC)</span>:</span>  <span class="comment"># è‡ªå®šä¹‰çš„æŠ½è±¡åŸºç±»è¦ç»§æ‰¿abc.ABC</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod        # æŠ½è±¡æ–¹æ³•ä½¿ç”¨abstractmethodè£…é¥°å™¨æ ‡è®°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self, iterable)</span>:</span>  <span class="comment"># è€Œä¸”å®šä¹‰ä½“ä¸­é€šå¸¸åªæœ‰æ–‡æ¡£å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="string">"""ä»Žå¯è¿­ä»£å¯¹è±¡ä¸­æ·»åŠ å…ƒç´ """</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""éšæœºåˆ é™¤å…ƒç´ ï¼Œç„¶åŽå°†å…¶è¿”å›žã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        å¦‚æžœå®žä¾‹ä¸ºç©ºï¼Œè¿™ä¸ªæ–¹æ³•åº”è¯¥æŠ›å‡ºLookupErrorã€‚</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loaded</span><span class="params">(self)</span>:</span>  <span class="comment"># å…·ä½“æ–¹æ³•</span></span><br><span class="line">        <span class="string">"""å¦‚æžœè‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›žTrueï¼Œå¦åˆ™è¿”å›žFalseã€‚"""</span></span><br><span class="line">        <span class="keyword">return</span> bool(self.inspect())  <span class="comment"># å…·ä½“æ–¹æ³•åªèƒ½ä¾èµ–æŠ½è±¡åŸºç±»å®šä¹‰çš„æŽ¥å£</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inspect</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žä¸€ä¸ªæœ‰åºå…ƒç»„ï¼Œç”±å½“å‰å…ƒç´ æž„æˆã€‚"""</span></span><br><span class="line">        items = []</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“å­ç±»å¦‚ä½•å­˜å‚¨å…ƒç´ ï¼Œä¸è¿‡ä¸ºäº†å¾—åˆ°inpectçš„ç»“æžœ</span></span><br><span class="line">            <span class="keyword">try</span>:     <span class="comment"># æˆ‘ä»¬å¯ä»¥ä¸æ–­è°ƒç”¨.pick()æ–¹æ³•ï¼ŒæŠŠTombolaæ¸…ç©º</span></span><br><span class="line">                items.append(self.pick())</span><br><span class="line">            <span class="keyword">except</span> LookupError:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        self.load(items)  <span class="comment"># ç„¶åŽå†ä½¿ç”¨.load(...)æŠŠæ‰€æœ‰å…ƒç´ æ”¾å›žåŽ»</span></span><br><span class="line">        <span class="keyword">return</span> tuple(sorted(items))</span><br></pre></td></tr></table></figure><p><strong>å…¶å®žï¼ŒæŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰å®žçŽ°ä»£ç ã€‚å³ä¾¿å®žçŽ°äº†ï¼Œå­ç±»ä¹Ÿå¿…é¡»è¦†ç›–æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å­ç±»ä¸­å¯ä»¥ä½¿ç”¨super()å‡½æ•°è°ƒç”¨æŠ½è±¡æ–¹æ³•ï¼Œä¸ºå®ƒæ·»åŠ åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä»Žå¤´å¼€å§‹å®žçŽ°ã€‚</strong></p><p>ç¤ºä¾‹ä¸­çš„inspect()æ–¹æ³•å®žçŽ°çš„æ–¹å¼æœ‰äº›ç¬¨æ‹™ï¼Œä¸è¿‡å´è¡¨æ˜Žï¼Œæœ‰äº†pick()å’Œload(...)æ–¹æ³•ï¼Œè‹¥æƒ³æŸ¥çœ‹Tombolaä¸­çš„å†…å®¹ï¼Œå¯ä»¥å…ˆæŠŠæ‰€æœ‰å…ƒç´ æŒ‘å‡ºï¼Œç„¶åŽå†æ”¾å›žåŽ»ã€‚è¿™ä¸ªç¤ºä¾‹çš„ç›®çš„æ˜¯å¼ºè°ƒæŠ½è±¡åŸºç±»å¯ä»¥æä¾›å…·ä½“æ–¹æ³•ï¼Œåªè¦ä¾èµ–æŽ¥å£ä¸­çš„å…¶ä»–æ–¹æ³•å°±è¡Œã€‚Tombolaçš„å…·ä½“å­ç±»çŸ¥æ™“å†…éƒ¨æ•°æ®ç»“æž„ï¼Œå¯ä»¥è¦†ç›–inspect()æ–¹æ³•ï¼Œä½¿ç”¨æ›´èªæ˜Žçš„æ–¹å¼å®žçŽ°ï¼Œä½†è¿™ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ã€‚</p><p>loaded()æ–¹æ³•æ²¡æœ‰é‚£ä¹ˆç¬¨æ‹™ï¼Œä½†æ˜¯è€—æ—¶ï¼šè°ƒç”¨inspect()æ–¹æ³•æž„å»ºæœ‰åºå…ƒç»„çš„ç›®çš„ä»…ä»…æ˜¯åœ¨å…¶ä¸Šè°ƒç”¨bool()å‡½æ•°ã€‚è¿™æ ·åšæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å…·ä½“å­ç±»å¯ä»¥åšçš„æ›´å¥½ã€‚</p><p>self.pick()æŠ›å‡ºLookupErrorè¿™ä¸€äº‹å®žä¹Ÿæ˜¯æŽ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯åœ¨Pythonä¸­æ²¡åŠžæ³•å£°æ˜Žï¼Œåªèƒ½åœ¨æ–‡æ¡£ä¸­è¯´æ˜Žã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">BaseException</span><br><span class="line"> +-- Exception</span><br><span class="line">      +-- LookupError</span><br><span class="line">      |    +-- IndexError</span><br><span class="line">      |    +-- KeyError</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> tombola <span class="keyword">import</span> Tombola</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Fake</span><span class="params">(Tombola)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="number">13</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fake  <span class="comment"># åˆ›å»ºå­ç±»ï¼Œä¸ä¼šæŠ¥é”™</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">Fake</span>'&gt;</span></span><br><span class="line">&gt;&gt;&gt; f = Fake()  # å°è¯•å®žä¾‹åŒ–Fakeæ—¶æŠ›å‡ºäº†TypeError</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: Can<span class="string">'t instantiate abstract class Fake with abstract methods load  # Pythonè®¤ä¸ºFakeæ˜¯æŠ½è±¡ç±»ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å®žçŽ°loadæ–¹æ³•</span></span><br></pre></td></tr></table></figure><h2 id="æŠ½è±¡åŸºç±»å¥æ³•è¯¦è§£">æŠ½è±¡åŸºç±»å¥æ³•è¯¦è§£</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tombola</span><span class="params">(abc.ABC)</span>:</span>  <span class="comment"># Python3.4ä¹‹åŽ</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tombola</span><span class="params">(metaclass=abc.ABCMeta)</span>:</span>  <span class="comment"># Python3.4ä¹‹å‰</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tombola</span><span class="params">(object)</span>:</span></span><br><span class="line">    __metaclass__ = abc.ABCMeta  <span class="comment"># Python2</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p>å£°æ˜ŽæŠ½è±¡ç±»æ–¹æ³•çš„æŽ¨èæ–¹å¼æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyABC</span><span class="params">(abc.ABC)</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">an_abstract_classmethod</span><span class="params">(cls, ...)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°ä¸Šå †å è£…é¥°å™¨çš„é¡ºåºé€šå¸¸å¾ˆé‡è¦ï¼Œ<a href="https://devdocs.io/python~3.6/library/abc#abc.abstractmethod" target="_blank" rel="noopener">@abstractmethodçš„æ–‡æ¡£</a>å°±ç‰¹åˆ«æŒ‡å‡ºï¼š</p><blockquote><p>When abstractmethod() is applied in combination with other method descriptors, it should be applied as the innermost decorator.</p></blockquote><h2 id="å®šä¹‰tombolaæŠ½è±¡åŸºç±»çš„å­ç±»">å®šä¹‰TombolaæŠ½è±¡åŸºç±»çš„å­ç±»</h2><figure class="highlight python"><figcaption><span>bingo.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> tombola <span class="keyword">import</span> Tombola</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BingoCage</span><span class="params">(Tombola)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, items)</span>:</span></span><br><span class="line">        self._randomizer = random.SystemRandom()</span><br><span class="line">        self._items = []</span><br><span class="line">        self.load(items)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self, items)</span>:</span></span><br><span class="line">        self._items.extend(item)</span><br><span class="line">        self._randomizer.shuffle(self._items)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self._items.pop()</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            <span class="keyword">raise</span> LookupError(<span class="string">'pick from empty BingoCage'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.pick()</span><br></pre></td></tr></table></figure><p>BingoCageä»ŽTombolaä¸­ç»§æ‰¿äº†è€—æ—¶çš„loadedæ–¹æ³•å’Œç¬¨æ‹™çš„inspectæ–¹æ³•ã€‚</p><figure class="highlight python"><figcaption><span>lotto.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> tombola <span class="keyword">import</span> Tombola</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LotteryBlower</span><span class="params">(Tombola)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, iterable)</span>:</span></span><br><span class="line">        self._balls = list(iterable)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self, iterable)</span>:</span></span><br><span class="line">        self._balls.extend(iterable)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            position = random.randrange(len(self._balls))</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">raise</span> LookupError(<span class="string">'pick from empty LotteryBlower'</span>)</span><br><span class="line">        <span class="keyword">return</span> self._balls.pop(position)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loaded</span><span class="params">(self)</span>:</span>  <span class="comment"># è¦†ç›–åŸºç±»æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> bool(self._balls)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inspect</span><span class="params">(self)</span>:</span>  <span class="comment"># è¦†ç›–åŸºç±»æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> tuple(sorted(self._balls))</span><br></pre></td></tr></table></figure><h2 id="tombolaçš„è™šæ‹Ÿå­ç±»">Tombolaçš„è™šæ‹Ÿå­ç±»</h2><p>ç™½é¹…ç±»åž‹çš„ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§ï¼šå³ä¾¿ä¸ç»§æ‰¿ï¼Œä¹Ÿæœ‰åŠžæ³•æŠŠä¸€ä¸ªç±»æ³¨å†Œä¸ºæŠ½è±¡åŸºç±»çš„è™šæ‹Ÿå­ç±»ã€‚è¿™æ ·åšæ—¶ï¼Œæˆ‘ä»¬ä¿è¯æ³¨å†Œçš„ç±»å¿ å®žåœ°å®žçŽ°äº†æŠ½è±¡åŸºç±»å®šä¹‰çš„æŽ¥å£ï¼Œè€ŒPythonä¼šç›¸ä¿¡æˆ‘ä»¬ï¼Œä»Žè€Œä¸åšæ£€æŸ¥ï¼ˆå³ä¾¿åœ¨å®žä¾‹åŒ–æ—¶ä¹Ÿä¸ä¼šæ£€æŸ¥ï¼‰ã€‚å¦‚æžœæˆ‘ä»¬è¯´è°Žäº†ï¼Œé‚£ä¹ˆå¸¸è§„çš„è¿è¡Œæ—¶å¼‚å¸¸ä¼šæŠŠæˆ‘ä»¬æ•èŽ·ã€‚</p><p>æ³¨å†Œè™šæ‹Ÿå­ç±»çš„æ–¹å¼æ˜¯åœ¨æŠ½è±¡åŸºç±»ä¸Šè°ƒç”¨registeræ–¹æ³•ã€‚è¿™ä¹ˆåšä¹‹åŽï¼Œæ³¨å†Œçš„ç±»ä¼šå˜æˆæŠ½è±¡åŸºç±»çš„è™šæ‹Ÿå­ç±»ï¼Œè€Œä¸”issubclasså’Œisinstanceç­‰å‡½æ•°éƒ½èƒ½è¯†åˆ«ï¼Œä½†æ˜¯æ³¨å†Œçš„ç±»ä¸ä¼šä»ŽæŠ½è±¡åŸºç±»ä¸­ç»§æ‰¿ä»»ä½•æ–¹æ³•æˆ–å±žæ€§ã€‚</p><p>registeræ–¹æ³•é€šå¸¸ä½œä¸ºæ™®é€šçš„å‡½æ•°è°ƒç”¨ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/ROz93i8m34NtEOKlG0w0Aau0AzXN6RxQY0mbCHAexTqfWmG4lBAVRFdztbaGmi1N2WWQMIXTE2l3j3kpqXvxdCw81i9uLGfvLvX6GKkD0TmdErFRkkYuRMlg4Mk82oFQUb6dvEjDAQMOtpQ757JowcNncBP_L0PdZj_49sL_2IhcOXbWUFbOnQPcajbrFSjdz3KrJKQtjCYmcuruq6PQhTvIuYLxlvKVhlNj3G00"><figure class="highlight python"><figcaption><span>tombolist.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> tombola <span class="keyword">import</span> Tombola</span><br><span class="line"></span><br><span class="line"><span class="meta">@Tombola.register  # æŠŠTomboListæ³¨å†Œä¸ºTombolaçš„è™šæ‹Ÿå­ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TomboList</span><span class="params">(list)</span>:</span>  <span class="comment"># TomboListæ‰©å±•list</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self:  <span class="comment"># ä»Žlistç»§æ‰¿__bool__æ–¹æ³•ï¼Œåˆ—è¡¨ä¸ä¸ºç©ºæ—¶è¿”å›žTrue</span></span><br><span class="line">            position = randrange(len(self))</span><br><span class="line">            <span class="keyword">return</span> self.pop(position)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> LookupError(<span class="string">'pop from empty TomboList'</span>)</span><br><span class="line"></span><br><span class="line">    load = list.extend  <span class="comment"># TomboList.loadä¸Žlist.extendä¸€æ ·</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># loaded = list.__bool__ æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºlistæ²¡æœ‰å®žçŽ°__bool__æ–¹æ³•</span></span><br><span class="line">    <span class="comment"># è€Œå†…ç½®çš„boolå‡½æ•°åœ¨æ²¡æœ‰å®žçŽ°__bool__æ–¹æ³•æ—¶è¿˜å¯ä»¥ä½¿ç”¨__len__æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loaded</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(self)  <span class="comment"># å§”æ‰˜boolå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inspect</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> tuple(sorted(self))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æžœæ˜¯Python3.3ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä¸èƒ½æŠŠregisterå½“ä½œç±»è£…é¥°å™¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨æ ‡å‡†çš„è°ƒç”¨å¥æ³•</span></span><br><span class="line"><span class="comment"># Tombola.register(TomboList)</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> tombola <span class="keyword">import</span> Tombola</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> tombolist <span class="keyword">import</span> TomboList</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(TomboList, Tombola)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = TomboList(range(<span class="number">100</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(t, Tombola)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œç±»çš„ç»§æ‰¿å…³ç³»åœ¨ä¸€ä¸ªç‰¹æ®Šçš„ç±»å±žæ€§ä¸­æŒ‡å®šâ€”â€”<code>__mro__</code>ï¼Œå³æ–¹æ³•è§£æžé¡ºåºï¼ˆMethod Resolution Orderï¼‰ã€‚è¿™ä¸ªå±žæ€§çš„ä½œç”¨å¾ˆç®€å•ï¼ŒæŒ‰é¡ºåºåˆ—å‡ºç±»åŠå…¶è¶…ç±»ï¼ŒPythonä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºæœç´¢æ–¹æ³•ã€‚æŸ¥çœ‹TomboListç±»çš„<code>__mro__</code>å±žæ€§ï¼Œä½ ä¼šå‘çŽ°å®ƒåªåˆ—å‡ºäº†â€œçœŸå®žçš„â€è¶…ç±»ï¼Œå³listå’Œobjectã€‚</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>TomboList.__mro__</span><br><span class="line">(&lt;class 'tombolist.TomboList'&gt;, &lt;class 'list'&gt;, &lt;class 'object'&gt;)</span><br></pre></td></tr></table></figure><p><code>TomboList.__mro__</code>ä¸­æ²¡æœ‰Tombolaï¼Œå› æ­¤TomboListæ²¡æœ‰ä»ŽTombolaä¸­ç»§æ‰¿ä»»ä½•æ–¹æ³•ã€‚</p><h1 id="é¹…çš„è¡Œä¸ºæœ‰å¯èƒ½åƒé¸­å­">é¹…çš„è¡Œä¸ºæœ‰å¯èƒ½åƒé¸­å­</h1><p>å³ä¾¿ä¸æ³¨å†Œï¼ŒæŠ½è±¡åŸºç±»ä¹Ÿèƒ½æŠŠä¸€ä¸ªç±»è¯†åˆ«ä¸ºè™šæ‹Ÿå­ç±»ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Struggle</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span> <span class="keyword">return</span> <span class="number">23</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>isinstance(Struggle(), abc.Sized)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>issubclass(Struggle, abc.Sized)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºabc.Sizedå®žçŽ°äº†ä¸€ä¸ªç‰¹æ®Šçš„ç±»æ–¹æ³•ï¼Œåä¸º<code>__subclasshook__</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sized</span><span class="params">(metaclass=ABCMeta)</span>:</span></span><br><span class="line"></span><br><span class="line">    __slots__ = ()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__subclasshook__</span><span class="params">(cls, C)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">is</span> Sized:</span><br><span class="line">            <span class="keyword">if</span> any(<span class="string">"__len__"</span> <span class="keyword">in</span> B.__dict__ <span class="keyword">for</span> B <span class="keyword">in</span> C.__mro__):  <span class="comment"># å¯¹CåŠå…¶è¶…ç±»ä¸­æ‰€åˆ—çš„ç±»æ¥è¯´ï¼Œå¦‚æžœæœ‰åä¸º__len__çš„å±žæ€§</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># è¿”å›žTrueï¼Œè¡¨æ˜ŽCæ˜¯Sizedçš„è™šæ‹Ÿå­ç±»</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">NotImplemented</span>  <span class="comment"># å¦åˆ™è¿”å›žNotImplemented</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://devdocs.io/python~3.6/library/abc#abc.ABCMeta.__subclasshook__" target="_blank" rel="noopener"><code>__subclasshook__(subclass)</code></a></p><p><strong>(Must be defined as a class method.)</strong></p><p>Check whether subclass is considered a subclass of this ABC.This means that you can customize the behavior of issubclass further without the need to call register() on every class you want to consider a subclass of the ABC. (This class method is called from the <strong>subclasscheck</strong>() method of the ABC.)</p><p>This method should return True, False or NotImplemented.If it returns True, the subclass is considered a subclass of this ABC.If it returns False, the subclass is not considered a subclass of this ABC, even if it would normally be one.If it returns NotImplemented, the subclass check is continued with the usual mechanism.</p></blockquote><p><code>__subclasshook__</code>åœ¨ç™½é¹…ç±»åž‹ä¸­æ·»åŠ äº†ä¸€äº›é¸­å­ç±»åž‹çš„è¸ªè¿¹ã€‚</p><p>åœ¨è‡ªå·±å®šä¹‰çš„æŠ½è±¡åŸºç±»ä¸­è¦ä¸è¦å®žçŽ°<code>__subclasshook__</code>æ–¹æ³•å‘¢ï¼Ÿå¯èƒ½ä¸éœ€è¦ã€‚æˆ‘åœ¨Pythonæºç ä¸­åªè§åˆ°Sizedè¿™ä¸€ä¸ªæŠ½è±¡åŸºç±»å®žçŽ°äº†<code>__subclasshook__</code>æ–¹æ³•ï¼Œè€ŒSizedåªå£°æ˜Žäº†ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œå› æ­¤åªç”¨æ£€æŸ¥è¿™ä¹ˆä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ã€‚é‰´äºŽ<code>__len__</code>æ–¹æ³•çš„â€œç‰¹æ®Šæ€§â€ï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥ç¡®å®šå®ƒèƒ½åšåˆ°è¯¥åšçš„äº‹ã€‚ä½†æ˜¯å¯¹å…¶ä»–ç‰¹æ®Šæ–¹æ³•å’ŒåŸºæœ¬çš„æŠ½è±¡åŸºç±»æ¥è¯´ï¼Œå¾ˆéš¾è¿™ä¹ˆè‚¯å®šã€‚</p><p>ä¾‹å¦‚ï¼Œè™½ç„¶æ˜ å°„å®žçŽ°äº†<code>__len__</code>ã€<code>__getitem__</code>å’Œ<code>__iter__</code>ï¼Œä½†æ˜¯ä¸åº”è¯¥æŠŠå®ƒä»¬è§†ä½œSequenceçš„å­ç±»åž‹ï¼Œå› ä¸ºä¸èƒ½ä½¿ç”¨æ•´æ•°åç§»å€¼èŽ·å–å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä¿è¯å…ƒç´ çš„é¡ºåºã€‚å½“ç„¶ï¼ŒOrderedDicté™¤å¤–ï¼Œå®ƒä¿ç•™äº†æ’å…¥å…ƒç´ çš„é¡ºåºï¼Œä½†æ˜¯ä¸æ”¯æŒé€šè¿‡åç§»èŽ·å–å…ƒç´ ã€‚</p><p>è‡ªå·±å®žçŽ°çš„<code>__subclasshook__</code>æ–¹æ³•è¿˜å¯ä»¥æ£€æŸ¥æ–¹æ³•ç­¾åå’Œå…¶ä»–ç‰¹æ€§ï¼Œä½†æˆ‘è§‰å¾—ä¸å€¼å¾—è¿™ä¹ˆåšã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> ABC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŽ¥å£ï¼šåè®®</title>
      <link href="/notes/fluent-python/interfaces-protocols/"/>
      <url>/notes/fluent-python/interfaces-protocols/</url>
      
        <content type="html"><![CDATA[<h1 id="pythonæ–‡åŒ–ä¸­çš„æŽ¥å£å’Œåè®®">Pythonæ–‡åŒ–ä¸­çš„æŽ¥å£å’Œåè®®</h1><p>æŽ¥å£åœ¨åŠ¨æ€ç±»åž‹è¯­è¨€ä¸­æ˜¯æ€Žä¹ˆè¿ä½œçš„å‘¢ï¼Ÿé¦–å…ˆï¼ŒåŸºæœ¬çš„äº‹å®žæ˜¯ï¼ŒPythonè¯­è¨€æ²¡æœ‰interfaceå…³é”®å­—ï¼Œè€Œä¸”é™¤äº†æŠ½è±¡åŸºç±»ï¼Œæ¯ä¸ªç±»éƒ½æœ‰æŽ¥å£ï¼šç±»å®žçŽ°æˆ–ç»§æ‰¿çš„å…¬å¼€å±žæ€§ï¼ˆæ–¹æ³•æˆ–æ•°æ®å±žæ€§ï¼‰ï¼ŒåŒ…æ‹¬ç‰¹æ®Šæ–¹æ³•ï¼Œå¦‚<code>__getitem__</code>æˆ–<code>__add__</code>ã€‚</p><p>æŒ‰ç…§å®šä¹‰ï¼Œå—ä¿æŠ¤çš„å±žæ€§å’Œç§æœ‰å±žæ€§ä¸åœ¨æŽ¥å£ä¸­ï¼šå³ä¾¿â€œå—ä¿æŠ¤çš„â€å±žæ€§ä¹Ÿåªæ˜¯é‡‡ç”¨å‘½åçº¦å®šå®žçŽ°çš„ï¼ˆå•ä¸ªå‰å¯¼ä¸‹åˆ’çº¿ï¼‰ï¼›ç§æœ‰å±žæ€§å¯ä»¥è½»æ¾åœ°è®¿é—®ï¼ŒåŽŸå› ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸è¦è¿èƒŒè¿™äº›çº¦å®šæœ‰æ„è®¿é—®ç§æœ‰å±žæ€§ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œä¸è¦è§‰å¾—æŠŠå…¬å¼€æ•°æ®å±žæ€§æ”¾å…¥å¯¹è±¡çš„æŽ¥å£ä¸­ä¸å¦¥ï¼Œå› ä¸ºå¦‚æžœéœ€è¦ï¼Œæ€»èƒ½å®žçŽ°è¯»å€¼æ–¹æ³•å’Œè®¾å€¼æ–¹æ³•ï¼ŒæŠŠæ•°æ®å±žæ€§å˜æˆç‰¹æ€§ï¼Œä½¿ç”¨obj.attrå¥æ³•çš„å®¢æˆ·ä»£ç ä¸ä¼šæ”¶åˆ°å½±å“ã€‚</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.x = float(x)  <span class="comment"># xå’Œyæ˜¯å…¬å¼€æ•°æ®å±žæ€§</span></span><br><span class="line">        self.y = float(y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…¶ä»–æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æž„ï¼šæŠŠxå’Œyå˜æˆåªè¯»ç‰¹æ€§ï¼Œä½†æ˜¯Vector2dçš„åŸºæœ¬æŽ¥å£æ²¡å˜ï¼š</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·ä»èƒ½è¯»å–my_vector.xå’Œmy_vector.y</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.__x = float(x)</span><br><span class="line">        self.__y = float(y)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__x</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">y</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__y</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸å—å½±å“</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…¶ä»–æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>å…³äºŽæŽ¥å£ï¼Œè¿™é‡Œæœ‰ä¸ªå®žç”¨çš„è¡¥å……å®šä¹‰ï¼šå¯¹è±¡å…¬å¼€æ–¹æ³•çš„å­é›†ï¼Œè®©å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æ‰®æ¼”ç‰¹å®šçš„è§’è‰²ã€‚Pythonæ–‡æ¡£ä¸­çš„â€œæ–‡ä»¶ç±»å¯¹è±¡â€æˆ–â€œå¯è¿­ä»£å¯¹è±¡â€å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œè¿™ç§è¯´æ³•æŒ‡çš„ä¸æ˜¯ç‰¹å®šçš„ç±»ã€‚</p><p>åè®®æ˜¯æŽ¥å£ï¼Œä½†ä¸æ˜¯æ­£å¼çš„ï¼ˆåªç”±æ–‡æ¡£å’Œçº¦å®šå®šä¹‰ï¼‰ï¼Œå› æ­¤åè®®ä¸èƒ½åƒæ­£å¼æŽ¥å£é‚£æ ·æ–½åŠ é™åˆ¶ã€‚ä¸€ä¸ªç±»å¯èƒ½åªå®žçŽ°éƒ¨åˆ†æŽ¥å£ï¼Œè¿™æ˜¯å…è®¸çš„ã€‚</p><h1 id="pythonå–œæ¬¢åºåˆ—">Pythonå–œæ¬¢åºåˆ—</h1><img src="http://www.plantuml.com/plantuml/svg/VP113i8W44Ntd68kq1kuS-NQ0n0AFvQaK8MfKIjt5rDj0mjc-UU_p9y_M0E2k_AJ75oF85GVEIZDT9myA-iHQ16KPt7WOJA9bhybaPHwTKKfHThP4oEeVaGJjTbKOcVxWcao8to5u3R3w_Qb2pWVSvdyUheyfRbuezhyKbPgm1qXmjGRwmqUfQIdsNEElFTvU7VT5bniNPNosaMXVG00"><p>ç®­å¤´ç”±å­ç±»æŒ‡å‘è¶…ç±»ï¼Œä»¥æ–œä½“æ˜¾ç¤ºçš„æ˜¯æŠ½è±¡æ–¹æ³•ã€‚</p><p>çŽ°åœ¨ï¼Œçœ‹çœ‹ç¤ºä¾‹ä¸­çš„Fooç±»ã€‚å®ƒæ²¡æœ‰ç»§æ‰¿abc.Sequenceï¼Œè€Œä¸”åªå®žçŽ°äº†åºåˆ—åè®®çš„ä¸€ä¸ªæ–¹æ³•<code>__getitem__</code>ï¼ˆæ²¡æœ‰å®žçŽ°<code>__len__</code>æ–¹æ³•ï¼‰ã€‚è¿™æ ·è¶³å¤Ÿè®¿é—®å…ƒç´ ã€è¿­ä»£å’Œä½¿ç”¨inè¿ç®—ç¬¦äº†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, pos)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> range(<span class="number">0</span>, <span class="number">30</span>, <span class="number">10</span>)[pos]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = Foo()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f[<span class="number">1</span>]</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> f: print(i)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">20</span> <span class="keyword">in</span> f</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">15</span> <span class="keyword">in</span> f</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><p>Pythonæ•°æ®æ¨¡åž‹çš„å“²å­¦æ˜¯å°½é‡æ”¯æŒåŸºæœ¬åè®®ã€‚å¯¹åºåˆ—æ¥è¯´ï¼Œå³ä¾¿æ˜¯æœ€ç®€å•çš„å®žçŽ°ï¼ŒPythonä¹Ÿä¼šåŠ›æ±‚åšåˆ°æœ€å¥½ã€‚é‰´äºŽåºåˆ—åè®®çš„é‡è¦æ€§ï¼Œå¦‚æžœæ²¡æœ‰<code>__iter__</code>å’Œ<code>__contains__</code>æ–¹æ³•ï¼ŒPythonä¼šè°ƒç”¨<code>__getitem__</code>æ–¹æ³•ï¼Œè®¾æ³•è®©è¿­ä»£å’Œinè¿ç®—ç¬¦å¯ç”¨ã€‚Pythonä¸­çš„è¿­ä»£æ˜¯é¸­å­ç±»åž‹çš„ä¸€ç§æžç«¯å½¢å¼ï¼šä¸ºäº†è¿­ä»£å¯¹è±¡ï¼Œè§£é‡Šå™¨ä¼šå°è¯•è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•ã€‚</p><h1 id="ä½¿ç”¨çŒ´å­è¡¥ä¸åœ¨è¿è¡Œæ—¶å®žçŽ°åè®®">ä½¿ç”¨çŒ´å­è¡¥ä¸åœ¨è¿è¡Œæ—¶å®žçŽ°åè®®</h1><p>ç¤ºä¾‹ä¸­çš„FrenchDeckç±»æœ‰ä¸ªé‡å¤§ç¼ºé™·ï¼šæ— æ³•æ´—ç‰Œã€‚å¦‚æžœFrenchDeckå®žä¾‹çš„è¡Œä¸ºåƒåºåˆ—ï¼Œé‚£ä¹ˆå®ƒå°±ä¸éœ€è¦shuffleæ–¹æ³•ï¼Œå› ä¸ºå·²ç»æœ‰random.shuffleå‡½æ•°å¯ç”¨ã€‚å¦‚æžœéµå®ˆæ—¢å®šåè®®ï¼Œå¾ˆæœ‰å¯èƒ½å¢žåŠ åˆ©ç”¨çŽ°æœ‰çš„æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹ä»£ç çš„å¯èƒ½æ€§ï¼Œè¿™å¾—ç›ŠäºŽé¸­å­ç±»åž‹ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/random#random.shuffle" target="_blank" rel="noopener"><code>random.shuffle(x[, random])</code></a></p><p>Shuffle the sequence x in place.</p></blockquote><figure class="highlight python"><figcaption><span>frenchdeck.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">Card = collections.namedtuple(<span class="string">'Card'</span>, [<span class="string">'rank'</span>, <span class="string">'suit'</span>])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrenchDeck</span>:</span>  <span class="comment"># å®žçŽ°åºåˆ—åè®®çš„FrenchDeckç±»</span></span><br><span class="line">    ranks = [str(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">11</span>)] + list(<span class="string">'JQKA'</span>)</span><br><span class="line">    suits = <span class="string">'spades diamonds clubs hearts'</span>.split()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._cards = [Card(rank, suit) <span class="keyword">for</span> suit <span class="keyword">in</span> self.suits</span><br><span class="line">                       <span class="keyword">for</span> rank <span class="keyword">in</span> self.ranks]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._cards)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._cards[item]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> frenchdeck <span class="keyword">import</span> FrenchDeck</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck = FrenchDeck()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>shuffle(deck)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/opt/anaconda3/envs/python36/lib/python3.6/random.py"</span>, line <span class="number">277</span>, <span class="keyword">in</span> shuffle</span><br><span class="line">    x[i], x[j] = x[j], x[i]</span><br><span class="line">TypeError: <span class="string">'FrenchDeck'</span> object does <span class="keyword">not</span> support item assignment</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œå¦‚æžœå°è¯•æ‰“ä¹±FrenchDeckå®žä¾‹ï¼Œä¼šå‡ºçŽ°å¼‚å¸¸ã€‚é”™è¯¯æ¶ˆæ¯ç›¸å½“æ˜Žç¡®ï¼Œå¯¹è±¡ä¸æ”¯æŒä¸ºå…ƒç´ èµ‹å€¼ã€‚FrenchDeckåªå®žçŽ°äº†ä¸å¯å˜åºåˆ—åè®®ï¼Œå¯å˜çš„åºåˆ—è¿˜å¿…é¡»æä¾›<code>__setitem__</code>æ–¹æ³•ã€‚Pythonæ˜¯åŠ¨æ€è¯­è¨€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œç”šè‡³è¿˜å¯ä»¥åœ¨äº¤äº’å¼æŽ§åˆ¶å°ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">set_card</span><span class="params">(deck, position, card)</span>:</span></span><br><span class="line"><span class="meta">... </span>    deck._cards[position] = card</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>FrenchDeck.__setitem__ = set_card</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>shuffle(deck)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck[:<span class="number">5</span>]</span><br><span class="line">[Card(rank=<span class="string">'5'</span>, suit=<span class="string">'spades'</span>), Card(rank=<span class="string">'5'</span>, suit=<span class="string">'clubs'</span>), Card(rank=<span class="string">'Q'</span>, suit=<span class="string">'clubs'</span>), Card(rank=<span class="string">'10'</span>, suit=<span class="string">'clubs'</span>), Card(rank=<span class="string">'5'</span>, suit=<span class="string">'hearts'</span>)]</span><br></pre></td></tr></table></figure><p>ç‰¹æ®Šæ–¹æ³•<code>__setitem__</code>çš„ç­¾ååœ¨è¯­è¨€å‚è€ƒä¸­ä½¿ç”¨çš„æ˜¯selfã€keyå’Œvalueï¼Œè€Œè¿™é‡Œä½¿ç”¨çš„æ˜¯deckã€positionå’Œcardã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†å‘Šè¯‰ä½ ï¼Œæ¯ä¸ªPythonæ–¹æ³•è¯´åˆ°åº•éƒ½æ˜¯æ™®é€šå‡½æ•°ï¼ŒæŠŠç¬¬ä¸€ä¸ªå‚æ•°å‘½åä¸ºselfåªæ˜¯ä¸€ç§çº¦å®šã€‚åœ¨æŽ§åˆ¶å°ä¼šè¯ä¸­ä½¿ç”¨é‚£å‡ ä¸ªå‚æ•°æ²¡é—®é¢˜ï¼Œä¸è¿‡åœ¨Pythonæºç æ–‡ä»¶ä¸­æœ€å¥½æŒ‰ç…§æ–‡æ¡£é‚£æ ·ä½¿ç”¨selfã€keyå’Œvalueã€‚</p><p>è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œ<code>set_card</code>å‡½æ•°è¦çŸ¥é“deckå¯¹è±¡æœ‰ä¸€ä¸ªåä¸º<code>_cards</code>çš„å±žæ€§ï¼Œè€Œä¸”<code>_cards</code>çš„åªå¿…é¡»æ˜¯å¯å˜åºåˆ—ã€‚ç„¶åŽï¼Œæˆ‘ä»¬æŠŠ<code>set_card</code>å‡½æ•°èµ‹å€¼ç»™ç‰¹æ®Šæ–¹æ³•<code>__setitem__</code>ï¼Œä»Žè€ŒæŠŠå®ƒä¾é™„åˆ°FrenchDeckç±»ä¸Šã€‚è¿™ç§æŠ€æœ¯å«çŒ´å­è¡¥ä¸ï¼šåœ¨è¿è¡Œæ—¶ä¿®æ”¹ç±»æˆ–æ¨¡å—ï¼Œè€Œä¸æ”¹åŠ¨æºç ã€‚çŒ´å­è¡¥ä¸å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æ‰“è¡¥ä¸çš„ä»£ç ä¸Žè¦æ‰“è¡¥ä¸çš„ç¨‹åºè€¦åˆååˆ†ç´§å¯†ï¼Œè€Œä¸”å¾€å¾€è¦å¤„ç†éšè—å’Œæ²¡æœ‰æ–‡æ¡£çš„éƒ¨åˆ†ã€‚</p><p>é™¤äº†ä¸¾ä¾‹è¯´æ˜ŽçŒ´å­è¡¥ä¸ä¹‹å¤–ï¼Œç¤ºä¾‹è¿˜å¼ºè°ƒäº†åè®®æ˜¯åŠ¨æ€çš„ï¼šrandom.shuffleå‡½æ•°ä¸å…³å¿ƒå‚æ•°çš„ç±»åž‹ï¼Œåªè¦é‚£ä¸ªå¯¹è±¡å®žçŽ°äº†éƒ¨åˆ†å¯å˜åºåˆ—åè®®å³å¯ã€‚å³ä¾¿å¯¹è±¡ä¸€å¼€å§‹æ²¡æœ‰æ‰€éœ€çš„æ–¹æ³•ä¹Ÿæ²¡å…³ç³»ï¼ŒåŽæ¥å†æä¾›ä¹Ÿè¡Œã€‚ç›®å‰ï¼Œæœ¬ç« è®¨è®ºçš„ä¸»é¢˜æ˜¯â€œé¸­å­ç±»åž‹â€ï¼šå¯¹è±¡çš„ç±»åž‹æ— å…³ç´§è¦ï¼Œåªè¦å®žçŽ°äº†ç‰¹å®šçš„åè®®å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> protocols </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åºåˆ—çš„ä¿®æ”¹ã€æ•£åˆ—å’Œåˆ‡ç‰‡</title>
      <link href="/notes/fluent-python/sequence-hacking-hashing-and-slicing/"/>
      <url>/notes/fluent-python/sequence-hacking-hashing-and-slicing/</url>
      
        <content type="html"><![CDATA[<h1 id="è¡¨ç¤ºå¤šç»´å‘é‡çš„vectorç±»">è¡¨ç¤ºå¤šç»´å‘é‡çš„Vectorç±»</h1><p>æœ¬ç« å®šä¹‰çš„Vectorç±»æ˜¯ä¸ºäº†æ•™å­¦è€Œä½¿ç”¨çš„ä¾‹å­ã€‚å¦‚æžœåœ¨å®žé™…ä½¿ç”¨ä¸­éœ€è¦åšå‘é‡è¿ç®—ï¼Œåº”è¯¥ä½¿ç”¨NumPyå’ŒSciPyã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, components)</span>:</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨ç»„åˆæ¨¡å¼å®žçŽ°ï¼Œå‘é‡çš„åˆ†é‡å­˜å‚¨åœ¨æµ®ç‚¹æ•°æ•°ç»„ä¸­</span></span><br><span class="line">        self._components = array(self.typecode, components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter(self._components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨reprlib.repr()å‡½æ•°èŽ·å–self._componentsçš„æœ‰é™é•¿åº¦è¡¨ç¤ºå½¢å¼</span></span><br><span class="line">        <span class="comment"># å¦‚ array('d', [0.0, 1.0, 2.0, 3.0, 4.0, ...])</span></span><br><span class="line">        components = reprlib.repr(self._components)</span><br><span class="line">        <span class="comment"># åŽ»æŽ‰ [] å¤–é¢çš„å­—ç¬¦</span></span><br><span class="line">        <span class="comment"># æˆ‘å¸Œæœ›Vectorå®žä¾‹çš„è¡¨ç¤ºå½¢å¼æ˜¯ Vector([3.0, 4.0, 5.0])è¿™æ ·</span></span><br><span class="line">        <span class="comment"># è€Œä¸æ˜¯ Vector(array('d', [3.0, 4.0, 5.0]))</span></span><br><span class="line">        <span class="comment"># å› ä¸ºVectorå®žä¾‹ä¸­çš„æ•°ç»„æ˜¯å®žçŽ°ç»†èŠ‚</span></span><br><span class="line">        <span class="comment"># è¿™ä¸¤ç§æ‰€æž„å»ºçš„Vectorå¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©ä½¿ç”¨æ›´ç®€å•çš„å¥æ³•</span></span><br><span class="line">        components = components[components.find(<span class="string">'['</span>):<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Vector(&#123;&#125;)'</span>.format(components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(tuple(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bytes__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (bytes([ord(self.typecode)]) +</span><br><span class="line">                bytes(self._components))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> tuple(self) == tuple(other)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸èƒ½ä½¿ç”¨hypotæ–¹æ³•äº†ï¼Œå…ˆè®¡ç®—æ‰€æœ‰åˆ†é‡çš„å¹³æ–¹å’Œï¼Œåœ¨ä½¿ç”¨sqrtæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> math.sqrt(sum(x * x <span class="keyword">for</span> x <span class="keyword">in</span> self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">frombytes</span><span class="params">(cls, octets)</span>:</span></span><br><span class="line">        typecode = chr(octets[<span class="number">0</span>])</span><br><span class="line">        memv = memoryview(octets[<span class="number">1</span>:]).cast(typecode)</span><br><span class="line">        <span class="keyword">return</span> cls(memv)</span><br></pre></td></tr></table></figure><p>å¦‚æžœVectorå®žä¾‹çš„åˆ†é‡è¶…è¿‡6ä¸ªï¼Œrepr()ç”Ÿæˆçš„å­—ç¬¦ä¸²å°±ä¼šä½¿ç”¨...çœç•¥ä¸€éƒ¨åˆ†ã€‚åŒ…å«å¤§é‡å…ƒç´ çš„é›†åˆç±»åž‹ä¸€å®šè¦è¿™ä¹ˆåšï¼Œå› ä¸ºå­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼æ˜¯ç”¨äºŽè°ƒè¯•çš„ï¼ˆå› æ­¤ä¸æƒ³è®©å¤§åž‹å¯¹è±¡åœ¨æŽ§åˆ¶å°æˆ–æ—¥å¿—ä¸­è¾“å‡ºå‡ åƒè¡Œå†…å®¹ï¼‰ã€‚ä½¿ç”¨reprlibæ¨¡å—å¯ä»¥ç”Ÿæˆé•¿åº¦æœ‰é™çš„è¡¨ç¤ºå½¢å¼ã€‚</p><a id="more"></a><p>ç¼–å†™<code>__repr__</code>æ–¹æ³•æ—¶ï¼Œæœ¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¡¨è¾¾å¼ç”Ÿæˆç®€åŒ–çš„componentsæ˜¾ç¤ºå½¢å¼ï¼š<code>reprlib.repr(list(self._components))</code>ã€‚ç„¶è€Œï¼Œè¿™ä¹ˆåšæœ‰ç‚¹æµªè´¹ï¼Œå› ä¸ºè¦æŠŠ<code>self._components</code>ä¸­çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œç„¶åŽä½¿ç”¨åˆ—è¡¨çš„è¡¨ç¤ºå½¢å¼ã€‚æˆ‘æ²¡æœ‰è¿™ä¹ˆåšï¼Œè€Œæ˜¯ç›´æŽ¥æŠŠ<code>self._components</code>ä¼ ç»™reprlib.reprå‡½æ•°ï¼Œç„¶åŽåŽ»æŽ‰[]å¤–é¢çš„å­—ç¬¦ã€‚</p><h1 id="åè®®å’Œé¸­å­ç±»åž‹">åè®®å’Œé¸­å­ç±»åž‹</h1><p>åœ¨Pythonä¸­åˆ›å»ºåŠŸèƒ½å®Œå–„çš„åºåˆ—ç±»åž‹æ— éœ€ä½¿ç”¨ç»§æ‰¿ï¼Œåªéœ€å®žçŽ°ç¬¦åˆåºåˆ—<strong>åè®®</strong>çš„æ–¹æ³•ã€‚</p><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œåè®®æ˜¯éžæ­£å¼çš„æŽ¥å£ï¼Œåªåœ¨æ–‡æ¡£ä¸­å®šä¹‰ï¼Œåœ¨ä»£ç ä¸­ä¸å®šä¹‰ã€‚ä¾‹å¦‚ï¼ŒPythonçš„åºåˆ—åè®®åªéœ€è¦<code>__len__</code>å’Œ<code>__getitem__</code>ä¸¤ä¸ªæ–¹æ³•ã€‚ä»»ä½•ç±»ï¼Œåªè¦ä½¿ç”¨æ ‡å‡†çš„ç­¾åå’Œè¯­ä¹‰å®žçŽ°äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°±èƒ½ç”¨åœ¨ä»»ä½•æœŸå¾…åºåˆ—çš„åœ°æ–¹ã€‚å³ä¾¿å®ƒæ˜¯objectçš„å­ç±»ä¹Ÿæ— å¦¨ï¼Œæˆ‘ä»¬è¯´å®ƒæ˜¯åºåˆ—ï¼Œå› ä¸ºå®ƒçš„è¡Œä¸ºåƒåºåˆ—ï¼Œè¿™æ‰æ˜¯é‡ç‚¹ã€‚</p><p>åè®®æ˜¯éžæ­£å¼çš„ï¼Œæ²¡æœ‰å¼ºåˆ¶åŠ›ï¼Œå› æ­¤å¦‚æžœä½ çŸ¥é“ç±»çš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼Œé€šå¸¸åªéœ€è¦å®žçŽ°ä¸€ä¸ªåè®®çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†æ”¯æŒè¿­ä»£ï¼Œåªéœ€å®žçŽ°<code>__getitem__</code>æ–¹æ³•ï¼Œæ²¡å¿…è¦æä¾›<code>__len__</code>æ–¹æ³•ã€‚</p><h1 id="å¯åˆ‡ç‰‡çš„åºåˆ—">å¯åˆ‡ç‰‡çš„åºåˆ—</h1><p>å¦‚æžœèƒ½å§”æ‰˜ç»™å¯¹è±¡ä¸­çš„åºåˆ—å±žæ€§ï¼ˆå¦‚<code>self._componetns</code>æ•°ç»„ï¼‰ï¼Œæ”¯æŒåºåˆ—åè®®ç‰¹åˆ«ç®€å•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></span><br><span class="line">    <span class="comment"># çœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._components[index]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector([<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(v1)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1[<span class="number">0</span>], v1[<span class="number">-1</span>]</span><br><span class="line">(<span class="number">3.0</span>, <span class="number">5.0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v7 = Vector(range(<span class="number">7</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v7[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">array(<span class="string">'d'</span>, [<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>])</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒçŽ°åœ¨è¿žåˆ‡ç‰‡éƒ½æ”¯æŒäº†ï¼Œä¸è¿‡å°šä¸å®Œç¾Žã€‚å¦‚æžœVectorå®žä¾‹çš„åˆ‡ç‰‡ä¹Ÿæ˜¯Vectorå®žä¾‹ï¼Œè€Œä¸æ˜¯æ•°ç»„ï¼Œé‚£å°±æ›´å¥½äº†ã€‚æƒ³æƒ³å†…ç½®çš„åºåˆ—ç±»åž‹ï¼Œåˆ‡ç‰‡å¾—åˆ°çš„éƒ½æ˜¯å„è‡ªç±»åž‹çš„æ–°å®žä¾‹ï¼Œè€Œä¸æ˜¯å…¶ä»–ç±»åž‹ã€‚ä¸ºäº†æŠŠVectorå®žä¾‹çš„åˆ‡ç‰‡ä¹Ÿå˜æˆVectorå®žä¾‹ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°å§”æ‰˜ç»™æ•°ç»„åˆ‡ç‰‡ã€‚æˆ‘ä»¬è¦åˆ†æžç»™<code>__getitem__</code>æ–¹æ³•çš„å‚æ•°ï¼Œåšé€‚å½“çš„å¤„ç†ã€‚</p><h2 id="åˆ‡ç‰‡åŽŸç†">åˆ‡ç‰‡åŽŸç†</h2><p>ä¸€ä¾‹èƒœåƒè¨€ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">MySeq</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> index  <span class="comment"># ç›´æŽ¥è¿”å›žindex</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = MySeq()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]  <span class="comment"># å•ä¸ªç´¢å¼•</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>]  <span class="comment"># 1:4è¡¨ç¤ºæ³•å˜æˆäº†ä¸€ä¸ªsliceå¯¹è±¡</span></span><br><span class="line">slice(<span class="number">1</span>, <span class="number">4</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>:<span class="number">2</span>]</span><br><span class="line">slice(<span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>:<span class="number">2</span>, <span class="number">9</span>]  <span class="comment"># å¦‚æžœ[]ä¸­æœ‰é€—å·ï¼Œé‚£ä¹ˆ__getitem__æ”¶åˆ°çš„æ˜¯å…ƒç»„</span></span><br><span class="line">(slice(<span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>), <span class="number">9</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>:<span class="number">4</span>:<span class="number">2</span>, <span class="number">7</span>:<span class="number">9</span>]  <span class="comment"># å…ƒç»„ä¸­å¯ä»¥æœ‰å¤šä¸ªåˆ‡ç‰‡å¯¹è±¡</span></span><br><span class="line">(slice(<span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>), slice(<span class="number">7</span>, <span class="number">9</span>, <span class="literal">None</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>slice  <span class="comment"># sliceæ˜¯å†…ç½®çš„ç±»åž‹</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">slice</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">dir</span><span class="params">(slice)</span></span></span><br><span class="line">['__class__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', 'indices', 'start', 'step', 'stop']</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>help(slice.indices)  <span class="comment"># slice.indicesæ–¹æ³•æœ‰å¾ˆå¤§çš„ä½œç”¨ï¼Œä½†é²œä¸ºäººçŸ¥</span></span><br><span class="line">Help on method_descriptor:</span><br><span class="line"></span><br><span class="line">indices(...)</span><br><span class="line">    S.indices(len) -&gt; (start, stop, stride)</span><br><span class="line"></span><br><span class="line">    Assuming a sequence of length len, calculate the start <span class="keyword">and</span> stop</span><br><span class="line">    indices, <span class="keyword">and</span> the stride length of the extended slice described by</span><br><span class="line">    S. Out of bounds indices are clipped <span class="keyword">in</span> a manner consistent <span class="keyword">with</span> the</span><br><span class="line">    handling of normal slices.</span><br><span class="line">    <span class="comment"># ä¸­æ–‡ç¿»è¯‘ #</span></span><br><span class="line">    ç»™å®šé•¿åº¦ä¸ºlençš„åºåˆ—ï¼Œè®¡ç®—Sè¡¨ç¤ºçš„æ‰©å±•åˆ‡ç‰‡çš„èµ·å§‹ï¼ˆstartï¼‰å’Œç»“å°¾ï¼ˆstopï¼‰ç´¢å¼•ï¼Œä»¥åŠæ­¥å¹…ï¼ˆstrideï¼‰ã€‚è¶…å‡ºè¾¹ç•Œçš„ç´¢å¼•ä¼šè¢«æˆªæŽ‰ï¼Œè¿™ä¸Žå¸¸è§„åˆ‡ç‰‡çš„å¤„ç†æ–¹å¼ä¸€æ ·ã€‚</span><br></pre></td></tr></table></figure><p>indicesæ–¹æ³•å¼€æ”¾äº†å†…ç½®åºåˆ—å®žçŽ°çš„æ£˜æ‰‹é€»è¾‘ï¼Œç”¨äºŽä¼˜é›…åœ°å¤„ç†ç¼ºå¤±ç´¢å¼•å’Œè´Ÿæ•°ç´¢å¼•ï¼Œä»¥åŠé•¿åº¦è¶…è¿‡ç›®æ ‡åºåˆ—çš„åˆ‡ç‰‡ã€‚è¿™ä¸ªæ–¹æ³•ä¼šâ€œæ•´é¡¿â€å…ƒç»„ï¼ŒæŠŠstartã€stopå’Œstrideéƒ½å˜æˆéžè´Ÿæ•°ï¼Œè€Œä¸”éƒ½è½åœ¨æŒ‡å®šé•¿åº¦åºåˆ—çš„è¾¹ç•Œå†…ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æœ‰ä¸ªé•¿åº¦ä¸º5çš„åºåˆ—ï¼Œä¾‹å¦‚'ABCDE'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>slice(<span class="literal">None</span>, <span class="number">10</span>, <span class="number">2</span>).indices(<span class="number">5</span>)</span><br><span class="line">(<span class="number">0</span>, <span class="number">5</span>, <span class="number">2</span>)  <span class="comment"># 'ABCDE'[:10:2]ç­‰åŒäºŽ'ABCDE'[0, 5, 2]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>slice(<span class="number">-3</span>, <span class="literal">None</span>, <span class="literal">None</span>).indices(<span class="number">5</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>)  <span class="comment"># 'ABCDE'[-3:]ç­‰åŒäºŽ'ABCDE'[2:5:1]</span></span><br></pre></td></tr></table></figure><p>åœ¨Vectorç±»ä¸­æ— éœ€ä½¿ç”¨slice.indices()æ–¹æ³•ï¼Œå› ä¸ºæ”¶åˆ°åˆ‡ç‰‡å‚æ•°æ—¶ï¼Œä¼šå§”æ‰˜_componentsæ•°ç»„å¤„ç†ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ²¡æœ‰åº•å±‚åºåˆ—ç±»åž‹ä½œä¸ºä¾é ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸ªæ–¹æ³•èƒ½èŠ‚çœå¤§é‡æ—¶é—´ã€‚</p><h2 id="èƒ½å¤„ç†åˆ‡ç‰‡çš„__getitem__æ–¹æ³•">èƒ½å¤„ç†åˆ‡ç‰‡çš„<code>__getitem__</code>æ–¹æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numbers  <span class="comment"># å¼€å¤´å¯¼å…¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç±»ä¸­å®šä¹‰</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        cls = type(self)</span><br><span class="line">        <span class="keyword">if</span> isinstance(index, slice):  <span class="comment"># åˆ‡ç‰‡</span></span><br><span class="line">            <span class="keyword">return</span> cls(self._components[index])</span><br><span class="line">        <span class="keyword">elif</span> isinstance(index, numbers.Integral):  <span class="comment"># å•ä¸ªç´¢å¼•</span></span><br><span class="line">            <span class="keyword">return</span> self._components[index]</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            msg = <span class="string">'&#123;cls.__name__&#125; indices must be integers'</span></span><br><span class="line">            <span class="keyword">raise</span> TypeError(msg.format(cls=cls))  <span class="comment"># ä¸ºäº†åˆ›å»ºç¬¦åˆPythoné£Žæ ¼çš„å¯¹è±¡ï¼Œæˆ‘ä»¬è¦æ¨¡ä»¿Pythonå†…ç½®çš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p>å¤§é‡ä½¿ç”¨isinstanceå¯èƒ½è¡¨æ˜Žé¢å‘å¯¹è±¡è®¾è®¡å¾—ä¸å¥½ï¼Œä¸è¿‡åœ¨<code>__getitem__</code>æ–¹æ³•ä¸­ä½¿ç”¨å®ƒå¤„ç†åˆ‡ç‰‡æ˜¯åˆç†çš„ã€‚numbers.Integralæ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼ˆAbstract Base Classï¼ŒABCï¼‰ï¼Œåœ¨isinstanceä¸­ä½¿ç”¨æŠ½è±¡åŸºç±»åšæµ‹è¯•èƒ½è®©APIæ›´çµæ´»ä¸”æ›´å®¹æ˜“æ›´æ–°ã€‚</p><h1 id="åŠ¨æ€å­˜å–å±žæ€§">åŠ¨æ€å­˜å–å±žæ€§</h1><p>Vectorç±»æ²¡åŠžæ³•é€šè¿‡åç§°è®¿é—®å‘é‡çš„åˆ†é‡ï¼ˆå¦‚v.xï¼‰ã€‚çŽ°åœ¨æˆ‘ä»¬å¤„ç†çš„å‘é‡å¯èƒ½æœ‰å¤§é‡åˆ†é‡ã€‚ä¸è¿‡ï¼Œè‹¥èƒ½é€šè¿‡å•ä¸ªå­—æ¯è®¿é—®å‰å‡ ä¸ªåˆ†é‡çš„è¯ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><p>æ¯”å¦‚ï¼Œç”¨xã€yã€zå’Œtä»£æ›¿v[0], v[1], v[2]å’Œv[3]ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Vectorä¸­ç¼–å†™å››ä¸ªç‰¹æ€§ï¼Œä½†è¿™æ ·å¤ªéº»çƒ¦ã€‚ç‰¹æ®Šæ–¹æ³•<code>__getattr__</code>æä¾›äº†æ›´å¥½çš„æ–¹å¼ã€‚å±žæ€§æŸ¥æ‰¾å¤±è´¥åŽï¼Œè§£é‡Šå™¨ä¼šè°ƒç”¨<code>__getattr__</code>æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå¯¹my_obj.xè¡¨è¾¾å¼ï¼ŒPythonä¼šæ£€æŸ¥my_objå®žä¾‹æœ‰æ²¡æœ‰åä¸ºxçš„å±žæ€§ï¼›å¦‚æžœæ²¡æœ‰ï¼Œåˆ°ç±»ï¼ˆ<code>my_obj.__class__</code>ï¼‰ä¸­æŸ¥æ‰¾ï¼›å¦‚æžœè¿˜æ²¡æœ‰ï¼Œé¡ºç€ç»§æ‰¿æ ‘ç»§ç»­æŸ¥æ‰¾ï¼ˆå±žæ€§æŸ¥æ‰¾æœºåˆ¶æ¯”è¿™å¤æ‚çš„å¤šï¼‰ã€‚å¦‚æžœä¾æ—§æ‰¾ä¸åˆ°ï¼Œè°ƒç”¨my_objæ‰€å±žç±»ä¸­å®šä¹‰çš„<code>__getattr__</code>æ–¹æ³•ï¼Œä¼ å…¥selfå’Œå±žæ€§åç§°çš„å­—ç¬¦å½¢å¼ï¼ˆå¦‚'x'ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç±»ä¸­å®šä¹‰</span></span><br><span class="line">shortcut_names = <span class="string">'xyzt'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        cls = type(self)</span><br><span class="line">        <span class="keyword">if</span> len(name) == <span class="number">1</span>:</span><br><span class="line">            pos = cls.shortcut_names.find(name)</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= pos &lt; len(self._components):</span><br><span class="line">                <span class="keyword">return</span> self._components[pos]</span><br><span class="line">        msg = <span class="string">'&#123;.__name__!r&#125; object has no attribute &#123;!r&#125;'</span></span><br><span class="line">        <span class="keyword">raise</span> AttributeError(msg.format(cls, name))</span><br></pre></td></tr></table></figure><p><code>__getattr__</code>æ–¹æ³•çš„å®žçŽ°ä¸éš¾ï¼Œä½†æ˜¯è¿™æ ·å®žçŽ°è¿˜ä¸å¤Ÿã€‚çœ‹çœ‹ç¤ºä¾‹ä¸­å¤æ€ªçš„äº¤äº’è¡Œä¸ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v = Vector(range(<span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v</span><br><span class="line">Vector([<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v.x</span><br><span class="line"><span class="number">0.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v.x = <span class="number">10</span>  <span class="comment"># å®žä¾‹vä¸­ä¼šæ–°å¢žä¸€ä¸ªå±žæ€§x</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v.x  <span class="comment"># å±žæ€§xå­˜åœ¨äºŽå®žä¾‹ä¸­ï¼Œå› æ­¤ç›´æŽ¥è¿”å›žå®ƒï¼Œä¸ä¼šè°ƒç”¨__getattr__æ–¹æ³•</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v  <span class="comment"># å‘é‡çš„åˆ†é‡ä¸ä¼šå˜</span></span><br><span class="line">Vector([<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>])</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…è¿™ç§çŽ°è±¡ï¼Œè¦æ”¹å†™Vectorç±»ä¸­è®¾ç½®å±žæ€§çš„é€»è¾‘ã€‚åœ¨Vectorç±»ä¸­ï¼Œå¦‚æžœä¸ºåç§°æ˜¯å•ä¸ªå°å†™å­—æ¯çš„å±žæ€§èµ‹å€¼ï¼ŒæŠ›å‡ºAttributeErrorã€‚ä¸ºæ­¤ï¼Œè¦å®žçŽ°<code>__setattr__</code>æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        cls = type(slef)</span><br><span class="line">        <span class="keyword">if</span> len(name) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">in</span> cls.shortcut_names:</span><br><span class="line">                error = <span class="string">'readonly attribute &#123;attr_name!r&#125;'</span></span><br><span class="line">            <span class="keyword">elif</span> name.islower():  <span class="comment"># ç¦æ­¢ä¸ºå•ä¸ªå°å†™å­—æ¯å±žæ€§èµ‹å€¼</span></span><br><span class="line">                error = <span class="string">"can't set attributes 'a' to 'z' in &#123;cls_name!r&#125;"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                error = <span class="string">''</span></span><br><span class="line">            <span class="keyword">if</span> error:</span><br><span class="line">                msg = error.format(cls_name=cls.__name__, attr_name=name)</span><br><span class="line">                <span class="keyword">raise</span> AttributeError(msg)</span><br><span class="line">        super().__setattr__(name, value)  <span class="comment"># é»˜è®¤æƒ…å†µï¼Œåœ¨è¶…ç±»ä¸Šè°ƒç”¨__setattr__æ–¹æ³•ï¼Œæä¾›æ ‡å‡†è¡Œä¸º</span></span><br></pre></td></tr></table></figure><p>ä¸å»ºè®®åªä¸ºäº†é¿å…åˆ›å»ºå®žä¾‹å±žæ€§è€Œä½¿ç”¨<code>__slots__</code>å±žæ€§ã€‚<code>__slots__</code>å±žæ€§åªåº”è¯¥ç”¨äºŽèŠ‚çœå†…å­˜ï¼Œè€Œä¸”ä»…å½“å†…å­˜ä¸¥é‡ä¸è¶³æ—¶æ‰åº”è¯¥è¿™ä¹ˆåšã€‚</p><p>è™½ç„¶è¿™ä¸ªç¤ºä¾‹ä¸æ”¯æŒä¸ºVectoråˆ†é‡èµ‹å€¼ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå¤šæ•°æ—¶å€™ï¼Œå¦‚æžœå®žçŽ°äº†<code>__getattr__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆä¹Ÿè¦å®šä¹‰<code>__setattr__</code>æ–¹æ³•ï¼Œä»¥é˜²å¯¹è±¡çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚</p><h1 id="æ•£åˆ—å’Œå¿«é€Ÿç­‰å€¼æµ‹è¯•">æ•£åˆ—å’Œå¿«é€Ÿç­‰å€¼æµ‹è¯•</h1><p>æˆ‘ä»¬è¦å†æ¬¡å®žçŽ°<code>__hash__</code>æ–¹æ³•ã€‚åŠ ä¸ŠçŽ°æœ‰çš„<code>__eq__</code>æ–¹æ³•ï¼Œè¿™ä¼šæŠŠVectorå®žä¾‹å˜æˆå¯æ•£åˆ—çš„å¯¹è±¡ã€‚Vector2dä¸­çš„<code>__hash__</code>æ–¹æ³•ç®€å•åœ°è®¡ç®—hash(self.x) ^ hash(self.y)ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨å¼‚æˆ–è¿ç®—ç¬¦ä¾æ¬¡è®¡ç®—å„ä¸ªåˆ†é‡çš„æ•£åˆ—å€¼ï¼Œåƒè¿™æ ·ï¼šv[0] ^ v[1] ^ v[2]...ã€‚è¿™æ­£æ˜¯functools.reduceå‡½æ•°çš„ä½œç”¨ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/functools#functools.reduce" target="_blank" rel="noopener"><code>functools.reduce(function, iterable[, initializer])</code></a></p><p>Apply function of two arguments cumulatively to the items of sequence, from left to right, so as to reduce the sequence to a single value. For example, <code>reduce(lambda x, y: x+y, [1, 2, 3, 4, 5])</code> calculates <code>((((1+2)+3)+4)+5)</code>.</p></blockquote><p>functools.reduce()çš„åŽŸç†ã€‚å®ƒçš„å…³é”®æ€æƒ³æ˜¯ï¼ŒæŠŠä¸€ç³»åˆ—å€¼å½’çº¦æˆå•ä¸ªå€¼ã€‚reduce()å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŽ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ã€‚å‡å¦‚æœ‰ä¸ªæŽ¥å—ä¸¤ä¸ªå‚æ•°çš„fnå‡½æ•°å’Œä¸€ä¸ªlståˆ—è¡¨ã€‚è°ƒç”¨reduce(fn, lst)æ—¶ï¼Œfnä¼šåº”ç”¨åˆ°ç¬¬ä¸€å¯¹å…ƒç´ ä¸Šï¼Œå³fn(lst[0], lst[1])ï¼Œç”Ÿæˆç¬¬ä¸€ä¸ªç»“æžœr1ã€‚ç„¶åŽï¼Œfnä¼šåº”ç”¨åˆ°r1å’Œä¸‹ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œå³fn(r1, lst[2])ï¼Œç”Ÿæˆç¬¬äºŒä¸ªç»“æžœr2...ç›´åˆ°æœ€åŽä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›žæœ€åŽå¾—åˆ°çš„ç»“æžœrNã€‚</p><p>ä½¿ç”¨reduceå‡½æ•°æ—¶æœ€å¥½æä¾›ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè¿™æ ·èƒ½é¿å…è¿™ä¸ªå¼‚å¸¸ï¼šTypeError: reduce() of empty sequence with no initial valueã€‚å¦‚æžœåºåˆ—ä¸ºç©ºï¼Œinitializeræ˜¯è¿”å›žçš„ç»“æžœï¼›å¦åˆ™ï¼Œåœ¨å½’çº¦ä¸­ä½¿ç”¨å®ƒä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå› æ­¤åº”è¯¥ä½¿ç”¨æ’ç­‰å€¼ã€‚æ¯”å¦‚ï¼Œå¯¹<code>+</code>ã€<code>|</code>å’Œ<code>^</code>æ¥è¯´ï¼Œinitializeråº”è¯¥æ˜¯0ï¼›è€Œå¯¹<code>*</code>å’Œ<code>&amp;</code>æ¥è¯´ï¼Œåº”è¯¥æ˜¯1ã€‚</p><p>å›žåˆ°æ•£åˆ—é—®é¢˜ä¸Šï¼Œè®¡ç®—èšåˆå¼‚æˆ–æœ‰3ç§æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—æ•´æ•°0ï½ž5çš„ç´¯è®¡å¼‚æˆ–</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>):  <span class="comment"># ä½¿ç”¨å¾ªçŽ¯</span></span><br><span class="line"><span class="meta">... </span>    n ^= i</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> functools</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>functools.reduce(<span class="keyword">lambda</span> a, b: a^b, range(<span class="number">6</span>))  <span class="comment"># ä½¿ç”¨åŒ¿åå‡½æ•°å’Œreduceå‡½æ•°</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>functools.reduce(operator.xor, range(<span class="number">6</span>))  <span class="comment"># ä½¿ç”¨è¿ç®—ç¬¦å‡½æ•°å’Œreduceå‡½æ•°</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>ç¼–å†™<code>Vector.__hash__</code>æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç±»ä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span>  <span class="comment"># ä¸ºäº†æé«˜æ¯”è¾ƒæ•ˆçŽ‡</span></span><br><span class="line">        <span class="comment"># tuple(self) == tuple(other) è¦å®Œæ•´å¤åˆ¶ä¸¤ä¸ªæ“ä½œæ•°</span></span><br><span class="line">        <span class="comment"># æž„å»ºä¸¤ä¸ªå…ƒç»„ï¼Œæ•ˆçŽ‡ååˆ†ä½Žä¸‹</span></span><br><span class="line">        <span class="keyword">if</span> len(self) != len(other):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment"># é•¿åº¦æ¯”è¾ƒéžå¸¸æœ‰å¿…è¦ï¼Œå› ä¸ºä¸€æ—¦æœ‰ä¸€ä¸ªè¾“å…¥è€—å°½</span></span><br><span class="line">        <span class="comment"># zipå‡½æ•°ä¼šç«‹å³åœæ­¢ç”Ÿæˆå€¼ï¼Œè€Œä¸å‘å‡ºè­¦å‘Š</span></span><br><span class="line">        <span class="comment"># è‹¥æ— é•¿åº¦æ¯”è¾ƒï¼Œå¯èƒ½ä¼šå‘ç”Ÿ Vector([1]) == Vector([1, 2]) is True</span></span><br><span class="line">        <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(self, other):</span><br><span class="line">            <span class="keyword">if</span> a != b:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        hashes = (hash(x) <span class="keyword">for</span> x <span class="keyword">in</span> self._components)  <span class="comment"># åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œæƒ°æ€§è®¡ç®—å„ä¸ªåˆ†é‡çš„æ•£åˆ—å€¼</span></span><br><span class="line">        <span class="keyword">return</span> functools.reduce(operator.xor, hashes, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/fluent-python/map-reduce.png"></p><p>ç¤ºä¾‹ä¸­å®žçŽ°çš„<code>__hash__</code>æ–¹æ³•æ˜¯ä¸€ç§æ˜ å°„å½’çº¦è®¡ç®—ã€‚æŠŠå‡½æ•°åº”ç”¨åˆ°å„ä¸ªå…ƒç´ ä¸Šï¼Œç”Ÿæˆä¸€ä¸ªæ–°åºåˆ—ï¼ˆæ˜ å°„ï¼Œmapï¼‰ï¼Œç„¶åŽè®¡ç®—èšåˆå€¼ï¼ˆè§„çº¦ï¼Œreduceï¼‰ã€‚æ˜ å°„è¿‡ç¨‹è®¡ç®—å„ä¸ªåˆ†é‡çš„æ•£åˆ—å€¼ï¼Œå½’çº¦è¿‡ç¨‹åˆ™ä½¿ç”¨xorè¿ç®—ç¬¦èšåˆæ‰€æœ‰æ•£åˆ—å€¼ã€‚æŠŠç”Ÿæˆå™¨è¡¨è¾¾å¼æ›¿æ¢æˆmapæ–¹æ³•ï¼Œæ˜ å°„è¿‡ç¨‹æ›´æ˜Žæ˜¾ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">    hashes = map(hash, self._components)  <span class="comment"># ä¸ŽPython3ç”Ÿæˆå™¨è¡¨è¾¾å¼åŽŸç†ä¸€æ ·</span></span><br><span class="line">    <span class="keyword">return</span> functools.reduce(operator.xor, hashes)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ä¸­çš„<code>__eq__</code>æ–¹æ³•çš„æ•ˆçŽ‡å¾ˆå¥½ï¼ˆä¸è¿‡Vector([1, 2] == (1, 2)çš„é—®é¢˜ä»ç„¶å­˜åœ¨ï¼‰ï¼Œä¸è¿‡ç”¨äºŽè®¡ç®—èšåˆå€¼çš„æ•´ä¸ªforå¾ªçŽ¯å¯ä»¥æ›¿æ¢æˆä¸€è¡Œallå‡½æ•°è°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> len(self) == len(other) <span class="keyword">and</span> all(a == b <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(self, other))</span><br></pre></td></tr></table></figure><p><em>zipå‡½æ•°çš„åå­—å–è‡ªæ‹‰é“¾ç³»ç»“ç‰©ï¼ˆzipper fastenerï¼‰ï¼Œå› ä¸ºè¿™ä¸ªç‰©å“ç”¨äºŽæŠŠä¸¤ä¸ªæ‹‰é“¾è¾¹çš„é“¾ç‰™å’¬åˆåœ¨ä¸€èµ·ï¼Œè¿™å½¢è±¡åœ°è¯´æ˜Žäº†zip(left, right)çš„ä½œç”¨ã€‚zipå‡½æ•°ä¸Žæ–‡ä»¶åŽ‹ç¼©æ²¡æœ‰å…³ç³»ã€‚</em></p><p>zipå‡½æ•°åœ¨å½“ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è€—å°½åŽï¼Œå®ƒä¸å‘å‡ºè­¦å‘Šå°±åœæ­¢ã€‚itertools.zip_longestå‡½æ•°çš„è¡Œä¸ºæœ‰æ‰€ä¸åŒï¼šä½¿ç”¨å¯é€‰çš„fillvalueå¡«å……ç¼ºå¤±çš„å€¼ï¼Œå› æ­¤å¯ä»¥ç»§ç»­äº§å‡ºï¼Œç›´åˆ°æœ€é•¿çš„å¯è¿­ä»£å¯¹è±¡è€—å°½ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/itertools#itertools.zip_longest" target="_blank" rel="noopener"><code>itertools.zip_longest(*iterables, fillvalue=None)</code></a></p><p>Make an iterator that aggregates elements from each of the iterables. If the iterables are of uneven length, missing values are filled-in with fillvalue. Iteration continues until the longest iterable is exhausted.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>zip(range(<span class="number">3</span>), <span class="string">'ABCDE'</span>)</span><br><span class="line">&lt;zip object at <span class="number">0x10cc9c088</span>&gt;  <span class="comment"># zipè¿”å›žä¸€ä¸ªç”Ÿæˆå™¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(range(<span class="number">3</span>), <span class="string">'ABCDE'</span>))</span><br><span class="line">[(<span class="number">0</span>, <span class="string">'A'</span>), (<span class="number">1</span>, <span class="string">'B'</span>), (<span class="number">2</span>, <span class="string">'C'</span>)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(range(<span class="number">2</span>), <span class="string">'ABC'</span>, <span class="string">'DEFG'</span>))</span><br><span class="line">[(<span class="number">0</span>, <span class="string">'A'</span>, <span class="string">'D'</span>), (<span class="number">1</span>, <span class="string">'B'</span>, <span class="string">'E'</span>)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip_longest(range(<span class="number">2</span>), <span class="string">'ABC'</span>, <span class="string">'DEFG'</span>, fillvalue=<span class="number">-1</span>))</span><br><span class="line">[(<span class="number">0</span>, <span class="string">'A'</span>, <span class="string">'D'</span>), (<span class="number">1</span>, <span class="string">'B'</span>, <span class="string">'E'</span>), (<span class="number">-1</span>, <span class="string">'C'</span>, <span class="string">'F'</span>), (<span class="number">-1</span>, <span class="number">-1</span>, <span class="string">'G'</span>)]</span><br></pre></td></tr></table></figure><h1 id="æ ¼å¼åŒ–">æ ¼å¼åŒ–</h1><p>Vectorç±»çš„<code>__format__</code>æ–¹æ³•ä¸ŽVector2dç±»çš„ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸ä½¿ç”¨æžåæ ‡ï¼Œè€Œä½¿ç”¨çƒé¢åæ ‡ï¼ˆä¹Ÿå«è¶…çƒé¢åæ ‡ï¼Œhyperspherical coordinateï¼‰ï¼Œå› ä¸ºVectorç±»æ”¯æŒnä¸ªç»´åº¦ï¼Œè€Œè¶…è¿‡å››ç»´åŽï¼Œçƒä½“å˜æˆäº†â€œè¶…çƒä½“â€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼šæŠŠè‡ªå®šä¹‰æ ¼å¼åŽç¼€â€˜pâ€™å˜æˆâ€˜hâ€™ã€‚</p><p>åœ¨å°å¹…åº¦æ”¹åŠ¨<code>__format__</code>æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸¤ä¸ªè¾…åŠ©æ–¹æ³•ï¼šä¸€ä¸ªæ˜¯angle(n)ï¼Œç”¨äºŽè®¡ç®—æŸä¸ªè§’åæ ‡ï¼›å¦ä¸€ä¸ªæ˜¯angles()ï¼Œè¿”å›žç”±æ‰€æœ‰è§’åæ ‡æž„æˆçš„å¯è¿­ä»£å¯¹è±¡ã€‚æˆ‘ä»¬ä¸ä¼šè®²è§£å…¶ä¸­æ¶‰åŠçš„æ•°å­¦åŽŸç†ï¼Œå¦‚æžœä½ å¥½å¥‡çš„è¯ï¼Œå¯ä»¥æŸ¥çœ‹ç»´åŸºç™¾ç§‘ä¸­çš„â€œ<a href="https://en.wikipedia.org/wiki/N-sphere" target="_blank" rel="noopener">nä¸ºçƒä½“</a>â€è¯æ¡ï¼Œé‚£é‡Œæœ‰å‡ ä¸ªå…¬å¼ï¼Œæˆ‘å°±æ˜¯ä½¿ç”¨å®ƒä»¬æŠŠVectorå®žä¾‹åˆ†é‡æ•°ç»„å†…çš„ç¬›å¡å°”åæ ‡è½¬æ¢æˆçƒé¢åæ ‡çš„ã€‚</p><p>æœ€ç»ˆç‰ˆçš„doctestå’Œå…¨éƒ¨ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">A multidimensional ``Vector`` class, take 5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A ``Vector`` is built from an iterable of numbers::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; Vector([3.1, 4.2])</span></span><br><span class="line"><span class="string">    Vector([3.1, 4.2])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; Vector((3, 4, 5))</span></span><br><span class="line"><span class="string">    Vector([3.0, 4.0, 5.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; Vector(range(10))</span></span><br><span class="line"><span class="string">    Vector([0.0, 1.0, 2.0, 3.0, 4.0, ...])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests with two dimensions (same results as ``vector2d_v1.py``)::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector([3, 4])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; x, y = v1</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; x, y</span></span><br><span class="line"><span class="string">    (3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1</span></span><br><span class="line"><span class="string">    Vector([3.0, 4.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone = eval(repr(v1))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 == v1_clone</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(v1)</span></span><br><span class="line"><span class="string">    (3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; octets = bytes(v1)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; octets</span></span><br><span class="line"><span class="string">    b'd\\x00\\x00\\x00\\x00\\x00\\x00\\x08@\\x00\\x00\\x00\\x00\\x00\\x00\\x10@'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(v1)</span></span><br><span class="line"><span class="string">    5.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bool(v1), bool(Vector([0, 0]))</span></span><br><span class="line"><span class="string">    (True, False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Test of ``.frombytes()`` class method:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone = Vector.frombytes(bytes(v1))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone</span></span><br><span class="line"><span class="string">    Vector([3.0, 4.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 == v1_clone</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests with three dimensions::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector([3, 4, 5])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; x, y, z = v1</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; x, y, z</span></span><br><span class="line"><span class="string">    (3.0, 4.0, 5.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1</span></span><br><span class="line"><span class="string">    Vector([3.0, 4.0, 5.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone = eval(repr(v1))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 == v1_clone</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(v1)</span></span><br><span class="line"><span class="string">    (3.0, 4.0, 5.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(v1) # doctest:+ELLIPSIS</span></span><br><span class="line"><span class="string">    7.071067811...</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bool(v1), bool(Vector([0, 0, 0]))</span></span><br><span class="line"><span class="string">    (True, False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests with many dimensions::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7 = Vector(range(7))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7</span></span><br><span class="line"><span class="string">    Vector([0.0, 1.0, 2.0, 3.0, 4.0, ...])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(v7) # doctest:+ELLIPSIS</span></span><br><span class="line"><span class="string">    9.53939201...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Test of ``.__bytes__`` and ``.frombytes()`` methods::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector([3, 4, 5])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone = Vector.frombytes(bytes(v1))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone</span></span><br><span class="line"><span class="string">    Vector([3.0, 4.0, 5.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 == v1_clone</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of sequence behavior::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector([3, 4, 5])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; len(v1)</span></span><br><span class="line"><span class="string">    3</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1[0], v1[len(v1)-1], v1[-1]</span></span><br><span class="line"><span class="string">    (3.0, 5.0, 5.0)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Test of slicing::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7 = Vector(range(7))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7[-1]</span></span><br><span class="line"><span class="string">    6.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7[1:4]</span></span><br><span class="line"><span class="string">    Vector([1.0, 2.0, 3.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7[-1:]</span></span><br><span class="line"><span class="string">    Vector([6.0])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7[1,2]</span></span><br><span class="line"><span class="string">    Traceback (most recent call last):</span></span><br><span class="line"><span class="string">      ...</span></span><br><span class="line"><span class="string">    TypeError: Vector indices must be integers</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of dynamic attribute access::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7 = Vector(range(10))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7.x</span></span><br><span class="line"><span class="string">    0.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7.y, v7.z, v7.t</span></span><br><span class="line"><span class="string">    (1.0, 2.0, 3.0)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Dynamic attribute lookup failures::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v7.k</span></span><br><span class="line"><span class="string">    Traceback (most recent call last):</span></span><br><span class="line"><span class="string">      ...</span></span><br><span class="line"><span class="string">    AttributeError: 'Vector' object has no attribute 'k'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v3 = Vector(range(3))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v3.t</span></span><br><span class="line"><span class="string">    Traceback (most recent call last):</span></span><br><span class="line"><span class="string">      ...</span></span><br><span class="line"><span class="string">    AttributeError: 'Vector' object has no attribute 't'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v3.spam</span></span><br><span class="line"><span class="string">    Traceback (most recent call last):</span></span><br><span class="line"><span class="string">      ...</span></span><br><span class="line"><span class="string">    AttributeError: 'Vector' object has no attribute 'spam'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of hashing::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector([3, 4])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v2 = Vector([3.1, 4.2])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v3 = Vector([3, 4, 5])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v6 = Vector(range(6))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; hash(v1), hash(v3), hash(v6)</span></span><br><span class="line"><span class="string">    (7, 2, 1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Most hash values of non-integers vary from a 32-bit to 64-bit CPython build::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; import sys</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; hash(v2) == (384307168202284039 if sys.maxsize &gt; 2**32 else 357915986)</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of ``format()`` with Cartesian coordinates in 2D::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector([3, 4])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v1)</span></span><br><span class="line"><span class="string">    '(3.0, 4.0)'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v1, '.2f')</span></span><br><span class="line"><span class="string">    '(3.00, 4.00)'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v1, '.3e')</span></span><br><span class="line"><span class="string">    '(3.000e+00, 4.000e+00)'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of ``format()`` with Cartesian coordinates in 3D and 7D::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v3 = Vector([3, 4, 5])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v3)</span></span><br><span class="line"><span class="string">    '(3.0, 4.0, 5.0)'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector(range(7)))</span></span><br><span class="line"><span class="string">    '(0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0)'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of ``format()`` with spherical coordinates in 2D, 3D and 4D::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([1, 1]), 'h') # doctest:+ELLIPSIS</span></span><br><span class="line"><span class="string">    '&lt;1.414213..., 0.785398...&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([1, 1]), '.3eh')</span></span><br><span class="line"><span class="string">    '&lt;1.414e+00, 7.854e-01&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([1, 1]), '0.5fh')</span></span><br><span class="line"><span class="string">    '&lt;1.41421, 0.78540&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([1, 1, 1]), 'h') # doctest:+ELLIPSIS</span></span><br><span class="line"><span class="string">    '&lt;1.73205..., 0.95531..., 0.78539...&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([2, 2, 2]), '.3eh')</span></span><br><span class="line"><span class="string">    '&lt;3.464e+00, 9.553e-01, 7.854e-01&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([0, 0, 0]), '0.5fh')</span></span><br><span class="line"><span class="string">    '&lt;0.00000, 0.00000, 0.00000&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([-1, -1, -1, -1]), 'h') # doctest:+ELLIPSIS</span></span><br><span class="line"><span class="string">    '&lt;2.0, 2.09439..., 2.18627..., 3.92699...&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([2, 2, 2, 2]), '.3eh')</span></span><br><span class="line"><span class="string">    '&lt;4.000e+00, 1.047e+00, 9.553e-01, 7.854e-01&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector([0, 1, 0, 0]), '0.5fh')</span></span><br><span class="line"><span class="string">    '&lt;1.00000, 1.57080, 0.00000, 0.00000&gt;'</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> reprlib</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, components)</span>:</span></span><br><span class="line">        self._components = array(self.typecode, components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter(self._components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        components = reprlib.repr(self._components)</span><br><span class="line">        components = components[components.find(<span class="string">'['</span>):<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Vector(&#123;&#125;)'</span>.format(components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(tuple(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bytes__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (bytes([ord(self.typecode)]) +</span><br><span class="line">                bytes(self._components))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (len(self) == len(other) <span class="keyword">and</span></span><br><span class="line">                all(a == b <span class="keyword">for</span> a, b <span class="keyword">in</span> zip(self, other)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        hashes = (hash(x) <span class="keyword">for</span> x <span class="keyword">in</span> self)</span><br><span class="line">        <span class="keyword">return</span> functools.reduce(operator.xor, hashes, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.sqrt(sum(x * x <span class="keyword">for</span> x <span class="keyword">in</span> self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._components)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        cls = type(self)</span><br><span class="line">        <span class="keyword">if</span> isinstance(index, slice):</span><br><span class="line">            <span class="keyword">return</span> cls(self._components[index])</span><br><span class="line">        <span class="keyword">elif</span> isinstance(index, numbers.Integral):</span><br><span class="line">            <span class="keyword">return</span> self._components[index]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg = <span class="string">'&#123;.__name__&#125; indices must be integers'</span></span><br><span class="line">            <span class="keyword">raise</span> TypeError(msg.format(cls))</span><br><span class="line"></span><br><span class="line">    shortcut_names = <span class="string">'xyzt'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        cls = type(self)</span><br><span class="line">        <span class="keyword">if</span> len(name) == <span class="number">1</span>:</span><br><span class="line">            pos = cls.shortcut_names.find(name)</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= pos &lt; len(self._components):</span><br><span class="line">                <span class="keyword">return</span> self._components[pos]</span><br><span class="line">        msg = <span class="string">'&#123;.__name__!r&#125; object has no attribute &#123;!r&#125;'</span></span><br><span class="line">        <span class="keyword">raise</span> AttributeError(msg.format(cls, name))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">angle</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        r = math.sqrt(sum(x * x <span class="keyword">for</span> x <span class="keyword">in</span> self[n:]))</span><br><span class="line">        a = math.atan2(r, self[n<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">if</span> (n == len(self) - <span class="number">1</span>) <span class="keyword">and</span> (self[<span class="number">-1</span>] &lt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> math.pi * <span class="number">2</span> - a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">angles</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.angle(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">1</span>, len(self)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, fmt_spec=<span class="string">''</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> fmt_spec.endswith(<span class="string">'h'</span>): <span class="comment"># hyperspherical coordinates</span></span><br><span class="line">            fmt_spec = fmt_spec[:<span class="number">-1</span>]</span><br><span class="line">            coords = itertools.chain([abs(self)], self.angles())</span><br><span class="line">            outer_fmt = <span class="string">'&lt;&#123;&#125;&gt;'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            coords = self</span><br><span class="line">            outer_fmt = <span class="string">'(&#123;&#125;)'</span></span><br><span class="line">        components = (format(c, fmt_spec) <span class="keyword">for</span> c <span class="keyword">in</span> coords)</span><br><span class="line">        <span class="keyword">return</span> outer_fmt.format(<span class="string">', '</span>.join(components))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">frombytes</span><span class="params">(cls, octets)</span>:</span></span><br><span class="line">        typecode = chr(octets[<span class="number">0</span>])</span><br><span class="line">        memv = memoryview(octets[<span class="number">1</span>:]).cast(typecode)</span><br><span class="line">        <span class="keyword">return</span> cls(memv)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¦åˆPythoné£Žæ ¼çš„å¯¹è±¡</title>
      <link href="/notes/fluent-python/a-pythonic-object/"/>
      <url>/notes/fluent-python/a-pythonic-object/</url>
      
        <content type="html"><![CDATA[<p>å¾—ç›ŠäºŽPythonæ•°æ®æ¨¡åž‹ï¼Œè‡ªå®šä¹‰ç±»åž‹çš„è¡Œä¸ºå¯ä»¥åƒå†…ç½®ç±»åž‹é‚£æ ·è‡ªç„¶ã€‚å®žçŽ°å¦‚æ­¤è‡ªç„¶çš„è¡Œä¸ºï¼Œé çš„ä¸æ˜¯ç»§æ‰¿ï¼Œè€Œæ˜¯é¸­å­ç±»åž‹ï¼ˆduck typingï¼‰ï¼šæˆ‘ä»¬åªéœ€æŒ‰ç…§é¢„å®šè¡Œä¸ºå®žçŽ°å¯¹è±¡æ‰€éœ€çš„æ–¹æ³•å³å¯ã€‚</p><h1 id="å¯¹è±¡è¡¨ç¤ºå½¢å¼">å¯¹è±¡è¡¨ç¤ºå½¢å¼</h1><p>æ¯é—¨é¢å‘å¯¹è±¡çš„è¯­è¨€è‡³å°‘éƒ½æœ‰ä¸€ç§èŽ·å–å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼çš„æ ‡å‡†æ–¹å¼ã€‚Pythonæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚</p><p>repr()ï¼šä»¥ä¾¿äºŽå¼€å‘è€…ç†è§£çš„æ–¹å¼è¿”å›žå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œç”±ç‰¹æ®Šæ–¹æ³•<code>__repr__</code>æ”¯æŒã€‚</p><p>str()ï¼šä»¥ä¾¿äºŽç”¨æˆ·ç†è§£çš„æ–¹å¼è¿”å›žå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œç”±ç‰¹æ®Šæ–¹æ³•<code>__str__</code>æ”¯æŒã€‚</p><p>ä¸ºäº†ç»™å¯¹è±¡æä¾›å…¶ä»–çš„è¡¨ç¤ºå½¢å¼ï¼Œè¿˜ä¼šç”¨åˆ°å¦å¤–ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•ï¼š<code>__bytes__</code>å’Œ<code>__format__</code>ã€‚<code>__bytes__</code>æ–¹æ³•ä¸Ž<code>__str__</code>æ–¹æ³•ç±»ä¼¼ï¼Œbytes()å‡½æ•°è°ƒç”¨å®ƒèŽ·å–å¯¹è±¡çš„å­—èŠ‚åºåˆ—è¡¨ç¤ºå½¢å¼ã€‚è€Œ<code>__format__</code>æ–¹æ³•ä¼šè¢«å†…ç½®çš„format()å‡½æ•°å’Œstr.format()æ–¹æ³•è°ƒç”¨ï¼Œä½¿ç”¨ç‰¹æ®Šçš„æ ¼å¼ä»£ç æ˜¾ç¤ºå¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</p><a id="more"></a><h1 id="å†è°ˆå‘é‡ç±»">å†è°ˆå‘é‡ç±»</h1><p>ä¸ºäº†è¯´æ˜Žç”¨äºŽç”Ÿæˆå¯¹è±¡è¡¨ç¤ºå½¢å¼çš„ä¼—å¤šæ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªVector2dç±»ã€‚</p><figure class="highlight python"><figcaption><span>vector2d.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span>  <span class="comment"># ç±»å±žæ€§ï¼Œåœ¨å®žä¾‹å’Œå­—èŠ‚åºåˆ—ä¹‹é—´è½¬æ¢æ—¶ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.x = float(x)  <span class="comment"># æŠŠxå’Œyè½¬æ¢æˆæµ®ç‚¹æ•°ï¼Œå°½æ—©æ•èŽ·é”™è¯¯</span></span><br><span class="line">        self.y = float(y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>  <span class="comment"># æŠŠVector2då˜æˆå¯è¿­ä»£å¯¹è±¡ï¼Œè¿™æ ·æ‰èƒ½æ‹†åŒ…</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>  <span class="comment"># __repr__æ–¹æ³•ä½¿ç”¨&#123;!r&#125;èŽ·å–å„ä¸ªåˆ†é‡çš„è¡¨ç¤ºå½¢å¼ï¼Œç„¶åŽæ’å€¼ï¼Œæž„æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        class_name = type(self).__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125;(&#123;!r&#125;, &#123;!r&#125;)'</span>.format(class_name, *self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span>  <span class="comment"># ä»Žå¯è¿­ä»£çš„å®žä¾‹ä¸­å¯ä»¥è½»æ¾åœ°å¾—åˆ°ä¸€ä¸ªå…ƒç»„</span></span><br><span class="line">        <span class="keyword">return</span> str(tuple(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bytes__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (bytes([ord(self.typecode)]) +  <span class="comment"># ä¸ºäº†ç”Ÿæˆå­—èŠ‚åºåˆ—ï¼ŒæŠŠtypecodeè½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œç„¶åŽ</span></span><br><span class="line">                bytes(array(self.typecode, self)))  <span class="comment"># è¿­ä»£å®žä¾‹ï¼Œå¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œå†æŠŠæ•°ç»„è½¬æ¢æˆå­—èŠ‚åºåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span>  <span class="comment"># å¯ç”¨ï¼Œä½†æœ‰ç‚¹é—®é¢˜ï¼Œæ¯”å¦‚Vector2d(3, 4) == [3, 4]çš„ç»“æžœä¼šæ˜¯Trueã€‚</span></span><br><span class="line">        <span class="keyword">return</span> tuple(self) == tuple(other)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.hypot(self.x, self.y)  <span class="comment"># æ¨¡æ˜¯xå’Œyåˆ†é‡æž„æˆçš„ç›´è§’ä¸‰è§’å½¢çš„æ–œè¾¹é•¿</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))  <span class="comment"># abs(0.0)æ˜¯Falseï¼Œéžé›¶å€¼æ˜¯True</span></span><br></pre></td></tr></table></figure><p>Vector2då®žä¾‹å…·æœ‰ä»¥ä¸‹åŸºæœ¬è¡Œä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector2d(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(v1.x, v1.y)  <span class="comment"># å®žä¾‹çš„åˆ†é‡å¯ä»¥ç›´æŽ¥é€šè¿‡å±žæ€§è®¿é—®</span></span><br><span class="line"><span class="number">3.0</span> <span class="number">4.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x, y = v1  <span class="comment"># å®žä¾‹å¯ä»¥æ‹†åŒ…æˆå˜é‡å…ƒç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x, y</span><br><span class="line">(<span class="number">3.0</span>, <span class="number">4.0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1  <span class="comment"># reprå‡½æ•°è°ƒç”¨å®žä¾‹ï¼Œå¾—åˆ°çš„ç»“æžœç±»ä¼¼äºŽæž„å»ºå®žä¾‹çš„æºç </span></span><br><span class="line">Vector2d(<span class="number">3.0</span>, <span class="number">4.0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1_clone = eval(repr(v1))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 == v1_clone</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(v1)  <span class="comment"># printå‡½æ•°ä¼šè°ƒç”¨strå‡½æ•°</span></span><br><span class="line">(<span class="number">3.0</span>, <span class="number">4.0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets = bytes(v1)  <span class="comment"># byteså‡½æ•°ä¼šè°ƒç”¨__bytes__æ–¹æ³•ï¼Œç”Ÿæˆå®žä¾‹çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets</span><br><span class="line"><span class="string">b'd\\x00\\x00\\x00\\x00\\x00\\x00\\x08@\\x00\\x00\\x00\\x00\\x00\\x00\\x10@'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>abs(v1)  <span class="comment"># abså‡½æ•°ä¼šè°ƒç”¨__abs__æ–¹æ³•ï¼Œè¿”å›žå®žä¾‹çš„æ¨¡</span></span><br><span class="line"><span class="number">5.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bool(v1), bool(Vector2d(<span class="number">0</span>, <span class="number">0</span>))  <span class="comment"># boolå‡½æ•°ä¼šè°ƒç”¨__bool__æ–¹æ³•ï¼Œå¦‚æžœå®žä¾‹çš„æ¨¡ä¸º0ï¼Œè¿”å›žFalseï¼Œå¦åˆ™è¿”å›žTrue</span></span><br><span class="line"><span class="literal">True</span>, <span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="å¤‡é€‰æž„é€ æ–¹æ³•">å¤‡é€‰æž„é€ æ–¹æ³•</h1><p>æˆ‘ä¹ˆå¯ä»¥æŠŠVector2då®žä¾‹è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼›åŒç†ï¼Œä¹Ÿåº”è¯¥èƒ½ä»Žå­—èŠ‚åºåˆ—è½¬æ¢æˆVector2då®žä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ç±»ä¸­å®šä¹‰</span></span><br><span class="line"><span class="meta">@classmethod  # ç±»æ–¹æ³•ï¼šä»Žå­—èŠ‚åºåˆ—è½¬æ¢æˆVector2då®žä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">frombytes</span><span class="params">(cls, octets)</span>:</span>  <span class="comment"># ä¸ç”¨ä¼ å…¥selfå‚æ•°ï¼Œç›¸åï¼Œè¦é€šè¿‡clsä¼ å…¥ç±»æœ¬èº«</span></span><br><span class="line">    typecode = chr(octets[<span class="number">0</span>])  <span class="comment"># ä»Žç¬¬ä¸€ä¸ªå­—èŠ‚ä¸­è¯»å–typecode</span></span><br><span class="line">    memv = memoryview(octets[<span class="number">1</span>:]).cast(typecode)  <span class="comment"># ä½¿ç”¨ä¼ å…¥çš„octetså­—èŠ‚åºåˆ—åˆ›å»ºä¸€ä¸ªmemoryviewï¼Œç„¶åŽä½¿ç”¨typecodeè½¬æ¢</span></span><br><span class="line">    <span class="keyword">return</span> cls(*memv)  <span class="comment"># æ‹†åŒ…è½¬æ¢åŽçš„memoryviewï¼Œå¾—åˆ°æž„é€ æ–¹æ³•æ‰€éœ€çš„ä¸€å¯¹å‚æ•°</span></span><br></pre></td></tr></table></figure><h2 id="classmethodä¸Žstaticmethod">classmethodä¸Žstaticmethod</h2><p>classmethodè£…é¥°å™¨å®šä¹‰æ“ä½œç±»ï¼Œè€Œä¸æ˜¯æ“ä½œå®žä¾‹çš„æ–¹æ³•ã€‚classmethodæ”¹å˜äº†è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ï¼Œå› æ­¤ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯å®žä¾‹ã€‚classmethodæœ€å¸¸è§çš„ç”¨é€”æ˜¯å®šä¹‰å¤‡é€‰æž„é€ æ–¹æ³•ã€‚æŒ‰ç…§çº¦å®šï¼Œç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°åä¸ºclsï¼ˆä½†æ˜¯Pythonä¸ä»‹æ„å…·ä½“æ€Žä¹ˆå‘½åï¼‰ã€‚</p><p>staticmethodè£…é¥°å™¨ä¹Ÿä¼šæ”¹å˜æ–¹æ³•çš„è°ƒç”¨æ–¹å¼ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯ç‰¹æ®Šçš„å€¼ã€‚å…¶å®žï¼Œé™æ€æ–¹æ³•å°±æ˜¯æ™®é€šçš„å‡½æ•°ï¼Œåªæ˜¯ç¢°å·§åœ¨ç±»çš„å®šä¹‰ä½“ä¸­ï¼Œè€Œä¸æ˜¯åœ¨æ¨¡å—å±‚å®šä¹‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Demo</span>:</span></span><br><span class="line"><span class="meta">... </span>    @classmethod</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">klassmeth</span><span class="params">(*args)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> args  <span class="comment"># è¿”å›žå…¨éƒ¨å‚æ•°</span></span><br><span class="line"><span class="meta">... </span>    @staticmethod</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">statmeth</span><span class="params">(*args)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> args  <span class="comment"># è¿”å›žå…¨éƒ¨å‚æ•°</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Demo.klassmeth()  <span class="comment"># ä¸ç®¡æ€Žæ ·è°ƒç”¨ç±»æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆæ˜¯Demoç±»</span></span><br><span class="line">(&lt;class '__main__.Demo'&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Demo.klassmeth(<span class="string">'spam'</span>)</span><br><span class="line">(&lt;class '__main__.Demo'&gt;, 'spam')</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Demo.statmeth()  <span class="comment"># é™æ€æ–¹æ³•çš„è¡Œä¸ºä¸Žæ™®é€šçš„å‡½æ•°ç±»ä¼¼</span></span><br><span class="line">()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Demo.statmeth(<span class="string">'spam'</span>)</span><br><span class="line">(<span class="string">'spam'</span>,)</span><br></pre></td></tr></table></figure><h1 id="æ ¼å¼åŒ–æ˜¾ç¤º">æ ¼å¼åŒ–æ˜¾ç¤º</h1><p>å†…ç½®çš„format()å‡½æ•°å’Œstr.format()æ–¹æ³•æŠŠå„ä¸ªç±»åž‹çš„æ ¼å¼åŒ–æ–¹æ³•å§”æ‰˜ç»™ç›¸åº”çš„<code>.__format__(format_spec)</code>æ–¹æ³•ã€‚format_specæ˜¯æ ¼å¼è¯´æ˜Žç¬¦ï¼Œå®ƒæ˜¯ï¼š</p><ul><li>format(my_obj, format_spec)çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ–è€…</li><li>str.format()æ–¹æ³•çš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œ{}é‡Œä»£æ¢å­—æ®µä¸­å†’å·åŽé¢çš„éƒ¨åˆ†ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>brl = <span class="number">1</span>/<span class="number">2.43</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>brl</span><br><span class="line"><span class="number">0.4115226337448559</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(brl, <span class="string">'0.4f'</span>)  <span class="comment"># æ ¼å¼è¯´æ˜Žç¬¦æ˜¯ '0.4f'</span></span><br><span class="line"><span class="string">'0.4115'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'1 BRL = &#123;rate:0.2f&#125; USD'</span>.format(rate=brl)  <span class="comment"># æ ¼å¼è¯´æ˜Žç¬¦æ˜¯ '0.2f'</span></span><br><span class="line"><span class="string">'1 BRL = 0.41 USD'</span></span><br></pre></td></tr></table></figure><p>'{rate:0.2f}'è¿™æ ·çš„æ ¼å¼å­—ç¬¦ä¸²åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå†’å·å·¦è¾¹çš„'rate'åœ¨ä»£æ¢å­—æ®µå¥æ³•ä¸­æ˜¯å­—æ®µåï¼Œå†’å·åŽé¢çš„'0.2f'æ˜¯æ ¼å¼è¯´æ˜Žç¬¦ã€‚æ ¼å¼è¯´æ˜Žç¬¦ä½¿ç”¨çš„è¡¨ç¤ºæ³•å«æ ¼å¼è§„èŒƒå¾®è¯­è¨€ï¼ˆâ€œ<a href="https://devdocs.io/python~3.6/library/string#formatspec" target="_blank" rel="noopener">Format Specification Mini-LMini-Language</a>â€œï¼‰ã€‚</p><p>æ ¼å¼è§„èŒƒå¾®è¯­è¨€æ˜¯å¯æ‰©å±•çš„ï¼Œå› ä¸ºå„ä¸ªç±»å¯ä»¥è‡ªè¡Œå†³å®šå¦‚æžœè§£é‡Šformat_specå‚æ•°ã€‚ä¾‹å¦‚ï¼Œdatetimeæ¨¡å—ä¸­çš„ç±»ï¼Œå®ƒä»¬çš„<code>__format__</code>æ–¹æ³•ä½¿ç”¨çš„æ ¼å¼ä»£ç ä¸Žstrftime()å‡½æ•°ä¸€æ ·ã€‚ä¸‹é¢æ˜¯å†…ç½®çš„format()å‡½æ•°å’Œstr.format()æ–¹æ³•çš„å‡ ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now = datetime.now()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(now, <span class="string">'%H:%M:%S'</span>)</span><br><span class="line"><span class="string">'11:46:10'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"It's now &#123;:%I:%M %p&#125;"</span>.format(now)</span><br><span class="line"><span class="string">"It's now 11:46 AM"</span></span><br></pre></td></tr></table></figure><p>å¦‚æžœç±»æ²¡æœ‰å®šä¹‰<code>__format__</code>æ–¹æ³•ï¼Œä»Žobjectç»§æ‰¿çš„æ–¹æ³•ä¼šè¿”å›žstr(my_object)ã€‚ç„¶è€Œæ²¡å¦‚æžœä¼ å…¥æ ¼å¼è¯´æ˜Žç¬¦ï¼Œ<code>object.__format__</code>æ–¹æ³•ä¼šæŠ›å‡ºTypeErrorã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector2d(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(v1)  <span class="comment"># è‹¥æ²¡æœ‰å®šä¹‰__format__æ–¹æ³•ï¼Œåˆ™è¿”å›žstr(v1)</span></span><br><span class="line"><span class="string">'(3.0, 4.0)'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(v1, <span class="string">'.3f'</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">TypeError: unsupported format string passed to Vector2d.__format__</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†è‡ªå·±å®žçŽ°å¾®è¯­è¨€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆï¼Œå‡è®¾ç”¨æˆ·æä¾›çš„æ ¼å¼è¯´æ˜Žç¬¦æ˜¯ç”¨äºŽæ ¼å¼åŒ–å‘é‡ä¸­å„ä¸ªæµ®ç‚¹æ•°åˆ†é‡çš„ï¼Œæƒ³è¾¾åˆ°çš„æ•ˆæžœæ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector2d(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(v1)</span><br><span class="line"><span class="string">'(3.0, 4.0)'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(v1, <span class="string">'.2f'</span>)</span><br><span class="line"><span class="string">'(3.00, 4.00)'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(v1, <span class="string">'.3e'</span>)</span><br><span class="line"><span class="string">'(3.000e+00, 4.000e+00)'</span></span><br></pre></td></tr></table></figure><p>å®žçŽ°è¿™ç§è¾“å‡ºçš„<code>__format__</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ç±»ä¸­å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, fmt_spec=<span class="string">''</span>)</span>:</span></span><br><span class="line">    components = (format(c, fmt_spec) <span class="keyword">for</span> c <span class="keyword">in</span> self)  <span class="comment"># ä½¿ç”¨å†…ç½®çš„formatå‡½æ•°æŠŠfmt_specåº”ç”¨åˆ°å‘é‡çš„å„ä¸ªåˆ†é‡ä¸Š</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'(&#123;&#125;, &#123;&#125;)'</span>.format(*components)</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¦åœ¨å¾®è¯­è¨€ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„æ ¼å¼ä»£ç ï¼šå¦‚æžœæ ¼å¼è¯´æ˜Žç¬¦ä»¥'p'ç»“å°¾ï¼Œé‚£ä¹ˆåœ¨æžåæ ‡ä¸­æ˜¾ç¤ºå‘é‡ï¼Œå³&lt;r, <span class="math inline">\(\theta\)</span>&gt;ï¼Œå…¶ä¸­ræ˜¯æ¨¡ï¼Œ<span class="math inline">\(\theta\)</span>æ˜¯å¼§åº¦ï¼›å…¶ä»–éƒ¨åˆ†ï¼ˆ'p'ä¹‹å‰çš„éƒ¨åˆ†ï¼‰åƒå¾€å¸¸é‚£æ ·è§£é‡Šã€‚</p><p>å¯¹æžåæ ‡æ¥è¯´ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†è®¡ç®—æ¨¡çš„<code>__abs__</code>æ–¹æ³•ï¼Œå› æ­¤è¿˜è¦å®šä¹‰ä¸€ä¸ªç®€å•çš„angleæ–¹æ³•ï¼Œä½¿ç”¨math.atan2()å‡½æ•°è®¡ç®—è§’åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ç±»ä¸­å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">angle</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> math.atan2(self.y, self.x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, fmt_spec)</span>:</span>  <span class="comment"># å¢žå¼ºåž‹__format__æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> fmt_spec.endswith(<span class="string">'p'</span>):</span><br><span class="line">        fmt_spec = fmt_spec[:<span class="number">-1</span>]</span><br><span class="line">        coords = (abs(self), self.angle())  <span class="comment"># æžåæ ‡</span></span><br><span class="line">        outer_fmt = <span class="string">'&lt;&#123;&#125;, &#123;&#125;&gt;'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        coords = self</span><br><span class="line">        outer_fmt = <span class="string">'(&#123;&#125;, &#123;&#125;)'</span></span><br><span class="line">    components = (format(c, fmt_spec) <span class="keyword">for</span> c <span class="keyword">in</span> coords)</span><br><span class="line">    <span class="keyword">return</span> outer_fmt.format(*components)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ä¸­çš„ä»£ç å¾—åˆ°çš„ç»“æžœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(Vector2d(<span class="number">1</span>, <span class="number">1</span>), <span class="string">'p'</span>)</span><br><span class="line"><span class="string">'&lt;1.4142135623730951, 0.7853981633974483&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(Vector2d(<span class="number">1</span>, <span class="number">1</span>), <span class="string">'.3ep'</span>)</span><br><span class="line"><span class="string">'&lt;1.414e+00, 7.854e-01&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>format(Vector2d(<span class="number">1</span>, <span class="number">1</span>), <span class="string">'0.5fp'</span>)</span><br><span class="line"><span class="string">'&lt;1.41421, 0.78540&gt;'</span></span><br></pre></td></tr></table></figure><h1 id="å¯æ•£åˆ—çš„vector2d">å¯æ•£åˆ—çš„Vector2d</h1><p>ç›®å‰Vector2då®žä¾‹æ˜¯ä¸å¯æ•£åˆ—çš„ï¼Œå› æ­¤ä¸èƒ½æ”¾å…¥é›†åˆï¼ˆsetï¼‰ä¸­ã€‚ä¸ºäº†æŠŠVector2då®žä¾‹å˜æˆå¯æ•£åˆ—çš„ï¼Œå¿…é¡»ä½¿ç”¨<code>__hash__</code>æ–¹æ³•ï¼ˆè¿˜éœ€è¦<code>__eq__</code>æ–¹æ³•ï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜è¦è®©å‘é‡ä¸å¯å˜ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦æŠŠxå’Œyåˆ†é‡è®¾ä¸ºåªè¯»å±žæ€§ã€‚ï¼ˆè¦æƒ³åˆ›å»ºå¯æ•£åˆ—çš„ç±»åž‹ï¼Œä¸ä¸€å®šè¦å®žçŽ°ç‰¹æ€§ï¼Œä¹Ÿä¸ä¸€å®šè¦ä¿æŠ¤å®žä¾‹å±žæ€§ã€‚åªéœ€æ­£ç¡®åœ°å®žçŽ°<code>__hash__</code>å’Œ<code>__eq__</code>æ–¹æ³•å³å¯ã€‚ä½†æ˜¯å®žä¾‹çš„æ•£åˆ—å€¼ç»ä¸åº”è¯¥å˜åŒ–ï¼Œå› æ­¤å€Ÿæœºæåˆ°äº†åªè¯»å±žæ€§ï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç±»ä¸­å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">    self.__x = x  <span class="comment"># ä½¿ç”¨ä¸¤ä¸ªå‰å¯¼ä¸‹åˆ’çº¿ï¼ŒæŠŠå±žæ€§æ ‡è®°ä¸ºç§æœ‰çš„</span></span><br><span class="line">    self.__y = y</span><br><span class="line"></span><br><span class="line"><span class="meta">@property  # @propertyè£…é¥°å™¨æŠŠè¯»å€¼æ–¹æ³•æ ‡è®°ä¸ºç‰¹æ€§</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.__x</span><br><span class="line"></span><br><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">y</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.__y</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜ï¼Œé€šè¿‡self.xå’Œself.yè¯»å–å…¬å¼€ç‰¹æ€§ï¼Œè€Œä¸å¿…è¯»å–ç§æœ‰å±žæ€§</span></span><br></pre></td></tr></table></figure><p>è®©è¿™äº›å‘é‡ä¸å¯å˜æ˜¯æœ‰åŽŸå› çš„ï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½å®žçŽ°<code>__hash__</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥è¿”å›žä¸€ä¸ªæ•´æ•°ï¼Œç†æƒ³æƒ…å†µä¸‹è¿˜è¦è€ƒè™‘å¯¹è±¡å±žæ€§çš„æ•£åˆ—å€¼ï¼ˆ<code>__eq__</code>æ–¹æ³•ä¹Ÿè¦ä½¿ç”¨ï¼‰ï¼Œå› ä¸ºç›¸ç­‰çš„å¯¹è±¡åº”è¯¥å…·æœ‰ç›¸åŒçš„æ•£åˆ—å€¼ã€‚æ ¹æ®<a href="https://docs.python.org/3/reference/datamodel.html" target="_blank" rel="noopener">ç‰¹æ®Šæ–¹æ³•<code>__hash__</code>çš„æ–‡æ¡£</a>ï¼Œæœ€å¥½ä½¿ç”¨ä½è¿ç®—ç¬¦å¼‚æˆ–ï¼ˆ^ï¼‰æ··åˆå„åˆ†é‡çš„æ•£åˆ—å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ç±»ä¸­å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hash(self.x) ^ hash(self.y)</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç æ¸…å•ï¼ŒåŒ…å«å…¨éƒ¨doctestã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">A two-dimensional vector class</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector2d(3, 4)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(v1.x, v1.y)</span></span><br><span class="line"><span class="string">    3.0 4.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; x, y = v1</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; x, y</span></span><br><span class="line"><span class="string">    (3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1</span></span><br><span class="line"><span class="string">    Vector2d(3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone = eval(repr(v1))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 == v1_clone</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; print(v1)</span></span><br><span class="line"><span class="string">    (3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; octets = bytes(v1)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; octets b'd\\x00\\x00\\x00\\x00\\x00\\x00\\x08@\\x00\\x00\\x00\\x00\\x00\\x00\\x10@'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(v1)</span></span><br><span class="line"><span class="string">    5.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; bool(v1), bool(Vector2d(0, 0))</span></span><br><span class="line"><span class="string">    (True, False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Test of ``.frombytes()`` class method:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone = Vector2d.frombytes(bytes(v1))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1_clone</span></span><br><span class="line"><span class="string">    Vector2d(3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 == v1_clone</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of ``format()`` with Cartesian coordinates:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v1)</span></span><br><span class="line"><span class="string">    '(3.0, 4.0)'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v1, '.2f')</span></span><br><span class="line"><span class="string">    '(3.00, 4.00)'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(v1, '.3e')</span></span><br><span class="line"><span class="string">    '(3.000e+00, 4.000e+00)'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of the ``angle`` method::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; Vector2d(0, 0).angle()</span></span><br><span class="line"><span class="string">    0.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; Vector2d(1, 0).angle()</span></span><br><span class="line"><span class="string">    0.0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; epsilon = 10**-8</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(Vector2d(0, 1).angle() - math.pi/2) &lt; epsilon</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; abs(Vector2d(1, 1).angle() - math.pi/4) &lt; epsilon</span></span><br><span class="line"><span class="string">    True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of ``format()`` with polar coordinates:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector2d(1, 1), 'p') # doctest:+ELLIPSIS</span></span><br><span class="line"><span class="string">    '&lt;1.414213..., 0.785398...&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector2d(1, 1), '.3ep')</span></span><br><span class="line"><span class="string">    '&lt;1.414e+00, 7.854e-01&gt;'</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; format(Vector2d(1, 1), '0.5fp')</span></span><br><span class="line"><span class="string">    '&lt;1.41421, 0.78540&gt;'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of `x` and `y` read-only properties:</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1.x, v1.y</span></span><br><span class="line"><span class="string">    (3.0, 4.0)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1.x = 123</span></span><br><span class="line"><span class="string">    Traceback (most recent call last):</span></span><br><span class="line"><span class="string">      ...</span></span><br><span class="line"><span class="string">    AttributeError: can't set attribute</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tests of hashing:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v1 = Vector2d(3, 4)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; v2 = Vector2d(3.1, 4.2)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; hash(v1), hash(v2)</span></span><br><span class="line"><span class="string">    (7, 384307168202284039)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; len(set([v1, v2]))</span></span><br><span class="line"><span class="string">    2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.__x = float(x)</span><br><span class="line">        self.__y = float(y)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__x</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">y</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (i <span class="keyword">for</span> i <span class="keyword">in</span> (self.x, self.y))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        class_name = type(self).__name__</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125;(&#123;!r&#125;, &#123;!r&#125;)'</span>.format(class_name, *self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(tuple(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bytes__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (bytes([ord(self.typecode)]) +</span><br><span class="line">                bytes(array(self.typecode, self)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> tuple(self) == tuple(other)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hash(self.x) ^ hash(self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.hypot(self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(abs(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">angle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> math.atan2(self.y, self.x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, fmt_spec=<span class="string">''</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> fmt_spec.endswith(<span class="string">'p'</span>):</span><br><span class="line">            fmt_spec = fmt_spec[:<span class="number">-1</span>]</span><br><span class="line">            coords = (abs(self), self.angle())</span><br><span class="line">            outer_fmt = <span class="string">'&lt;&#123;&#125;, &#123;&#125;&gt;'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            coords = self</span><br><span class="line">            outer_fmt = <span class="string">'(&#123;&#125;, &#123;&#125;)'</span></span><br><span class="line">            components = (format(c, fmt_spec) <span class="keyword">for</span> c <span class="keyword">in</span> coords)</span><br><span class="line">        <span class="keyword">return</span> outer_fmt.format(*components)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">frombytes</span><span class="params">(cls, octets)</span>:</span></span><br><span class="line">        typecode = chr(octets[<span class="number">0</span>])</span><br><span class="line">        memv = memoryview(octets[<span class="number">1</span>:]).cast(typecode)</span><br><span class="line">        <span class="keyword">return</span> cls(*memv)</span><br></pre></td></tr></table></figure><h1 id="pythonçš„ç§æœ‰å±žæ€§å’Œå—ä¿æŠ¤çš„å±žæ€§">Pythonçš„ç§æœ‰å±žæ€§å’Œâ€œå—ä¿æŠ¤çš„â€å±žæ€§</h1><p>Pythonä¸èƒ½åƒJavaé‚£æ ·ä½¿ç”¨privateä¿®é¥°ç¬¦åˆ›å»ºç§æœ‰å±žæ€§ï¼Œä½†æ˜¯Pythonæœ‰ä¸ªç®€å•çš„æœºåˆ¶ï¼Œèƒ½é¿å…å­ç±»æ„å¤–è¦†ç›–â€œç§æœ‰â€å±žæ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰äººç¼–å†™äº†ä¸€ä¸ªåä¸ºDogçš„ç±»ï¼Œè¿™ä¸ªç±»çš„å†…éƒ¨ç”¨åˆ°äº†moodå®žä¾‹å±žæ€§ï¼Œä½†æ˜¯æ²¡æœ‰å°†å…¶å¼€æ”¾ã€‚çŽ°åœ¨ï¼Œä½ åˆ›å»ºäº†Dogçš„å­ç±»ï¼šBeagleã€‚å¦‚æžœä½ åœ¨æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹åˆåˆ›å»ºäº†åä¸ºmoodçš„å®žä¾‹å±žæ€§ï¼Œé‚£ä¹ˆåœ¨ç»§æ‰¿çš„æ–¹æ³•ä¸­å°±ä¼šæŠŠDogç±»çš„moodå±žæ€§è¦†ç›–æŽ‰ã€‚è¿™æ˜¯ä¸ªéš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¦‚æžœä»¥<code>__mood</code>çš„å½¢å¼å‘½åå®žä¾‹å±žæ€§ï¼ŒPythonä¼šæŠŠå±žæ€§åå­˜å…¥å®žä¾‹çš„<code>__dict__</code>å±žæ€§ä¸­ï¼Œè€Œä¸”ä¼šåœ¨å‰é¢åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿å’Œç±»åã€‚å› æ­¤ï¼Œå¯¹Dogç±»æ¥è¯´ï¼Œ<code>__mood</code>ä¼šå˜æˆ<code>_Dog__mood</code>ï¼›å¯¹Beagleç±»æ¥è¯´ï¼Œä¼šå˜æˆ<code>_Beagle__mood</code>ã€‚è¿™ä¸ªè¯­è¨€ç‰¹æ€§å«åç§°æ”¹å†™ï¼ˆname manglingï¼‰ã€‚åç§°æ”¹å†™æ˜¯ä¸€ç§å®‰å…¨æŽªæ–½ï¼Œä¸èƒ½ä¿è¯ä¸‡æ— ä¸€å¤±ï¼šå®ƒçš„ç›®çš„æ˜¯é¿å…æ„å¤–è®¿é—®ï¼Œä¸èƒ½é˜²æ­¢æ•…æ„åšé”™äº‹ã€‚</p><p>ä»¥ä¸Šä¸€èŠ‚å®šä¹‰çš„Vector2dç±»ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector2d(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1.__dict__</span><br><span class="line">&#123;<span class="string">'_Vector2d__x'</span>: <span class="number">3.0</span>, <span class="string">'_Vector2d__y'</span>: <span class="number">4.0</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1._Vector2d__x  <span class="comment"># æ•…æ„è®¿é—®</span></span><br><span class="line"><span class="number">3.0</span></span><br></pre></td></tr></table></figure><p>ä¸æ˜¯æ‰€æœ‰Pythonç¨‹åºå‘˜éƒ½å–œæ¬¢åç§°æ”¹å†™åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰äººéƒ½å–œæ¬¢<code>self.__x</code>è¿™ç§ä¸å¯¹ç§°çš„åç§°ã€‚æœ‰äº›äººä¸å–œæ¬¢è¿™ç§å¥æ³•ï¼Œä»–ä»¬çº¦å®šä½¿ç”¨ä¸€ä¸ªä¸‹çŽ¯çº¿å‰ç¼€ç¼–å†™â€œå—ä¿æŠ¤â€çš„å±žæ€§ï¼ˆå¦‚<code>self._x</code>ï¼‰ã€‚æ‰¹è¯„ä½¿ç”¨ä¸¤ä¸ªä¸‹åˆ’çº¿è¿™ç§æ”¹å†™æœºåˆ¶çš„äººè®¤ä¸ºï¼Œåº”è¯¥ä½¿ç”¨å‘½åçº¦å®šæ¥é¿å…æ„å¤–è¦†ç›–å±žæ€§ã€‚</p><blockquote><p>ç»å¯¹ä¸è¦ä½¿ç”¨ä¸¤ä¸ªå‰å¯¼ä¸‹åˆ’çº¿ï¼Œè¿™æ˜¯å¾ˆçƒ¦äººçš„è‡ªç§è¡Œä¸ºã€‚å¦‚æžœæ‹…å¿ƒå‘½åå†²çªï¼Œåº”è¯¥æ˜Žç¡®ä½¿ç”¨ä¸€ç§åç§°æ”¹å†™æ–¹å¼ï¼ˆå¦‚<code>_MyThing_blahblah</code>ï¼‰ã€‚è¿™å…¶å®žä¸Žä½¿ç”¨åŒä¸‹åˆ’çº¿ä¸€æ ·ï¼Œä¸è¿‡è‡ªå·±å®šçš„è§„åˆ™æ¯”åŒä¸‹åˆ’çº¿æ˜“äºŽç†è§£ã€‚</p><p>â€”â€” Ian Bickingï¼Œ<a href="http://pythonpaste.org/StyleGuide.html" target="_blank" rel="noopener">Pasteçš„é£Žæ ¼æŒ‡å—</a></p></blockquote><p>Pythonè§£é‡Šå™¨ä¸ä¼šå¯¹ä½¿ç”¨å•ä¸ªä¸‹åˆ’çº¿çš„å±žæ€§ååšç‰¹æ®Šå¤„ç†ï¼Œä¸è¿‡è¿™æ˜¯å¾ˆå¤šPythonç¨‹åºå‘˜ä¸¥æ ¼éµå®ˆçš„çº¦å®šï¼Œä»–ä»¬ä¸ä¼šåœ¨ç±»å¤–éƒ¨è®¿é—®è¿™ç§å±žæ€§ï¼ˆä¸è¿‡åœ¨æ¨¡å—ä¸­ï¼Œé¡¶å±‚åç§°ä½¿ç”¨ä¸€ä¸ªå‰å¯¼ä¸‹åˆ’çº¿çš„è¯ï¼Œçš„ç¡®ä¼šæœ‰å½±å“ï¼šå¯¹from mymod import *æ¥è¯´ï¼Œmymodä¸­å‰ç¼€ä¸ºä¸‹åˆ’çº¿çš„åç§°ä¸ä¼šè¢«å¯¼å…¥ã€‚ç„¶è€Œï¼Œä¾æ—§å¯ä»¥ä½¿ç”¨from mymod import _privatefuncå°†å…¶å¯¼å…¥ï¼‰ã€‚éµå®ˆä½¿ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿æ ‡è®°å¯¹è±¡çš„ç§æœ‰å±žæ€§å¾ˆå®¹æ˜“ï¼Œå°±åƒéµå®ˆä½¿ç”¨å…¨å¤§å†™å­—æ¯ç¼–å†™å¸¸é‡é‚£æ ·å®¹æ˜“ã€‚</p><p>Vector2dçš„åˆ†é‡éƒ½æ˜¯â€ç§æœ‰çš„â€œï¼Œè€Œä¸”Vector2då®žä¾‹éƒ½æ˜¯â€ä¸å¯å˜çš„â€ã€‚æˆ‘ç”¨äº†ä¸¤å¯¹å¼•å·ï¼Œè¿™æ˜¯å› ä¸ºå¹¶ä¸èƒ½çœŸæ­£å®žçŽ°ç§æœ‰å’Œä¸å¯å˜ã€‚</p><h1 id="ä½¿ç”¨__slots__ç±»å±žæ€§èŠ‚çœç©ºé—´">ä½¿ç”¨<code>__slots__</code>ç±»å±žæ€§èŠ‚çœç©ºé—´</h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPythonåœ¨å„ä¸ªå®žä¾‹ä¸­åä¸º<code>__dict__</code>çš„å­—å…¸é‡Œå­˜å‚¨å®žä¾‹å±žæ€§ã€‚ä¸ºäº†ä½¿ç”¨åº•å±‚çš„æ•£åˆ—è¡¨æå‡è®¿é—®é€Ÿåº¦ï¼Œå­—å…¸ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚å¦‚æžœè¦å¤„ç†æ•°ç™¾ä¸‡ä¸ªå±žæ€§ä¸å¤šçš„å®žä¾‹ï¼Œé€šè¿‡<code>__slots__</code>ç±»å±žæ€§ï¼Œèƒ½èŠ‚çœå¤§é‡å†…å­˜ï¼Œæ–¹æ³•æ˜¯è®©è§£é‡Šå™¨åœ¨å…ƒç»„ä¸­å­˜å‚¨å®žä¾‹å±žæ€§ï¼Œè€Œä¸ä½¿ç”¨å­—å…¸ã€‚ï¼ˆç»§æ‰¿è‡ªè¶…ç±»çš„<code>__slots__</code>å±žæ€§æ²¡æœ‰æ•ˆæžœã€‚Pythonåªä¼šä½¿ç”¨å„ä¸ªç±»ä¸­å®šä¹‰çš„<code>__slots__</code>å±žæ€§ï¼‰</p><p>å®šä¹‰<code>__slots__</code>çš„æ–¹å¼æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªç±»å±žæ€§ï¼Œä½¿ç”¨<code>__slots__</code>è¿™ä¸ªåå­—ï¼Œå¹¶æŠŠå®ƒçš„å€¼è®¾ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æž„æˆçš„å¯è¿­ä»£å¯¹è±¡ï¼Œå…¶ä¸­å„ä¸ªå…ƒç´ è¡¨ç¤ºå„ä¸ªå®žä¾‹å±žæ€§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector2d</span>:</span></span><br><span class="line">    __solots__ = (<span class="string">'__x'</span>, <span class="string">'__y'</span>)</span><br><span class="line"></span><br><span class="line">    typecode = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç±»æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>å¦‚æžœè¦å¤„ç†æ•°ç™¾ä¸‡ä¸ªæ•°å€¼å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨NumPyæ•°ç»„ã€‚NumPyæ•°ç»„èƒ½é«˜æ•ˆä½¿ç”¨å†…å­˜ï¼Œè€Œä¸”æä¾›äº†é«˜åº¦ä¼˜åŒ–çš„æ•°å€¼å¤„ç†å‡½æ•°ï¼Œå…¶ä¸­å¾ˆå¤šéƒ½ä¸€æ¬¡æ“ä½œæ•´ä¸ªæ•°ç»„ã€‚</p><p>åœ¨ç±»ä¸­å®šä¹‰<code>__slots__</code>å±žæ€§ä¹‹åŽï¼Œå®žä¾‹ä¸èƒ½å†æœ‰<code>__slots__</code>ä¸­æ‰€åˆ—åç§°ä¹‹å¤–çš„å…¶ä»–å±žæ€§ã€‚è¿™åªæ˜¯ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œä¸æ˜¯<code>__slots__</code>å­˜åœ¨çš„çœŸæ­£åŽŸå› ï¼Œä¸è¦ä½¿ç”¨<code>__slots__</code>å±žæ€§ç¦æ­¢ç±»çš„ç”¨æˆ·æ–°å¢žå®žä¾‹ã€‚<code>__slots__</code>æ˜¯ç”¨äºŽä¼˜åŒ–çš„ï¼Œä¸æ˜¯ä¸ºäº†çº¦æŸç¨‹åºå‘˜ã€‚</p><p>ç„¶è€Œï¼Œâ€œèŠ‚çœçš„å†…å­˜ä¹Ÿå¯èƒ½è¢«å†æ¬¡åƒæŽ‰â€ï¼šå¦‚æžœæŠŠ'<code>__dict__</code>'è¿™ä¸ªåç§°æ·»åŠ åˆ°<code>__slots__</code>ä¸­ï¼Œå®žä¾‹ä¼šåœ¨å…ƒç»„ä¸­ä¿å­˜å„ä¸ªå®žä¾‹çš„å±žæ€§ï¼Œæ­¤å¤–è¿˜æ”¯æŒåŠ¨æ€åˆ›å»ºå±žæ€§ï¼Œè¿™äº›å±žæ€§å­˜å‚¨åœ¨å¸¸è§„çš„<code>__dict__</code>ä¸­ã€‚å½“ç„¶ï¼ŒæŠŠ'<code>__dict__</code>'æ·»åŠ åˆ°<code>__slots__</code>ä¸­å¯èƒ½å®Œå…¨è¿èƒŒäº†åˆè¡·ï¼Œè¿™å–å†³äºŽå„ä¸ªå®žä¾‹çš„é™æ€å±žæ€§å’ŒåŠ¨æ€å±žæ€§çš„æ•°é‡åŠå…¶ç”¨æ³•ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå®žä¾‹å±žæ€§å¯èƒ½éœ€è¦æ³¨æ„ï¼Œå³<code>__weakref__</code>å±žæ€§ï¼Œä¸ºäº†è®©å¯¹è±¡æ”¯æŒå¼±å¼•ç”¨ï¼Œå¿…é¡»æœ‰è¿™ä¸ªå±žæ€§ã€‚ç”¨æˆ·å®šä¹‰çš„ç±»ä¸­é»˜è®¤å°±æœ‰<code>__weakref__</code>å±žæ€§ã€‚å¯æ˜¯ï¼Œå¦‚æžœç±»ä¸­å®šä¹‰äº†<code>__slots__</code>å±žæ€§ï¼Œè€Œä¸”æƒ³æŠŠå®žä¾‹ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ï¼Œé‚£ä¹ˆè¦æŠŠ'<code>__weakref__</code>'æ·»åŠ åˆ°<code>__slots__</code>ä¸­ã€‚</p><p>ç»¼ä¸Šï¼Œ<code>__slots__</code>å±žæ€§æœ‰äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œè€Œä¸”ä¸èƒ½æ»¥ç”¨ï¼Œä¸èƒ½ä½¿ç”¨å®ƒé™åˆ¶ç”¨æˆ·èƒ½èµ‹å€¼çš„å±žæ€§ã€‚å¤„ç†åˆ—è¡¨æ•°æ®æ—¶<code>__slots__</code>å±žæ€§æœ€æœ‰ç”¨ï¼Œä¾‹å¦‚æ¨¡å¼å›ºå®šçš„æ•°æ®åº“è®°å½•ï¼Œä»¥åŠç‰¹å¤§åž‹æ•°æ®åº“ã€‚ç„¶è€Œï¼Œå¦‚æžœä½ ç»å¸¸å¤„ç†å¤§é‡æ•°æ®ï¼Œä¸€å®šè¦äº†è§£ä¸€ä¸‹<a href="http://www.numpy.org" target="_blank" rel="noopener">NumPy</a>ï¼›æ­¤å¤–ï¼Œæ•°æ®åˆ†æžåº“<a href="http://pandas.pydata.org" target="_blank" rel="noopener">pandas</a>ä¹Ÿå€¼å¾—äº†è§£ï¼Œè¿™ä¸ªåº“å¯ä»¥å¤„ç†éžæ•°å€¼æ•°æ®ï¼Œè€Œä¸”èƒ½å¯¼å…¥/å¯¼å‡ºå¾ˆå¤šä¸åŒçš„åˆ—è¡¨æ•°æ®æ ¼å¼ã€‚</p><p>æ€»ä¹‹ï¼Œå¦‚æžœä½¿ç”¨å¾—å½“ï¼Œ<code>__slots__</code>èƒ½æ˜¾è‘—èŠ‚çœå†…å­˜ï¼Œä¸è¿‡è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ¯ä¸ªå­ç±»éƒ½è¦å®šä¹‰<code>__slots__</code>å±žæ€§ï¼Œå› ä¸ºè§£é‡Šå™¨ä¼šå¿½ç•¥ç»§æ‰¿çš„<code>__slots__</code>å±žæ€§ã€‚</li><li>å®žä¾‹åªèƒ½æ‹¥æœ‰<code>__slots__</code>ä¸­åˆ—å‡ºçš„å±žæ€§ï¼Œé™¤éžæŠŠ'<code>__dict__</code>'åŠ å…¥<code>__slots__</code>ä¸­ï¼ˆè¿™æ ·åšå°±å¤±åŽ»äº†èŠ‚çœå†…å­˜çš„åŠŸæ•ˆï¼‰ã€‚</li><li>å¦‚æžœä¸æŠŠ'<code>__weakref__'</code>åŠ å…¥<code>__slots__</code>ï¼Œå®žä¾‹å°±ä¸èƒ½ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ã€‚</li></ul><h1 id="è¦†ç›–ç±»å±žæ€§">è¦†ç›–ç±»å±žæ€§</h1><p>Pythonæœ‰ä¸ªå¾ˆç‹¬ç‰¹çš„ç‰¹æ€§ï¼šç±»å±žæ€§å¯ç”¨äºŽä¸ºå®žä¾‹å±žæ€§æä¾›é»˜è®¤å€¼ã€‚Vector2dä¸­æœ‰ä¸ªtypecodeç±»å±žæ€§ï¼Œ<code>__bytes__</code>æ–¹æ³•ä¸¤æ¬¡ç”¨åˆ°äº†å®ƒï¼Œè€Œä¸”éƒ½æ•…æ„ä½¿ç”¨self.typecodeè¯»å–å®ƒçš„å€¼ã€‚å› æ­¤Vector2då®žä¾‹æœ¬èº«æ²¡æœ‰typecodeå±žæ€§ï¼Œæ‰€ä»¥self.typecodeé»˜è®¤èŽ·å–çš„æ˜¯Vector2d.typecodeç±»å±žæ€§çš„å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æžœä¸ºä¸å­˜åœ¨çš„å®žä¾‹å±žæ€§èµ‹å€¼ï¼Œä¼šæ–°å»ºå®žä¾‹å±žæ€§ã€‚å‡å¦‚æˆ‘ä»¬ä¸ºtypecodeå®žä¾‹å±žæ€§èµ‹å€¼ï¼Œé‚£ä¹ˆåŒåç±»å±žæ€§ä¸å—å½±å“ã€‚ç„¶è€Œï¼Œè‡ªæ­¤ä¹‹åŽï¼Œå®žä¾‹è¯»å–çš„self.typecodeæ˜¯å®žä¾‹å±žæ€§typecodeï¼Œä¹Ÿå°±æ˜¯æŠŠåŒåç±»å±žæ€§é®ç›–äº†ã€‚å€ŸåŠ©è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥ä¸ºå„ä¸ªå®žä¾‹çš„typecodeå±žæ€§å®šåˆ¶ä¸åŒçš„å€¼ã€‚</p><p>Vector2d.typecodeå±žæ€§çš„é»˜è®¤å€¼æ˜¯'d'ï¼Œå³è½¬æ¢æˆå­—èŠ‚åºåˆ—æ—¶ä½¿ç”¨8å­—èŠ‚åŒç²¾åº¦æµ®ç‚¹æ•°è¡¨ç¤ºå‘é‡çš„å„ä¸ªåˆ†é‡ã€‚å¦‚æžœè½¬æ¢ä¹‹å‰æŠŠVector2då®žä¾‹çš„typecodeå±žæ€§è®¾ä¸º'f'ï¼Œé‚£ä¹ˆä½¿ç”¨4å­—èŠ‚çš„å•ç²¾åº¦æµ®ç‚¹æ•°è¡¨ç¤ºå„ä¸ªåˆ†é‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector2d(<span class="number">1.1</span>, <span class="number">2.2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dumpd = bytes(v1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dumpd</span><br><span class="line"><span class="string">b'd\x9a\x99\x99\x99\x99\x99\xf1?\x9a\x99\x99\x99\x99\x99\x01@'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(dumpd)</span><br><span class="line"><span class="number">17</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1.typecode = <span class="string">'f'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dumpf = bytes(v1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dumpf</span><br><span class="line"><span class="string">b'f\xcd\xcc\x8c?\xcd\xcc\x0c@'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(dumpf)</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Vector2d.typecode, v1.typecode</span><br><span class="line">(<span class="string">'d'</span>, <span class="string">'f'</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æžœæƒ³ä¿®æ”¹ç±»å±žæ€§çš„å€¼ï¼Œå¿…é¡»ç›´æŽ¥åœ¨ç±»ä¸Šä¿®æ”¹ï¼Œä¸èƒ½é€šè¿‡å®žä¾‹ä¿®æ”¹ã€‚å¦‚æžœæƒ³ä¿®æ”¹æ‰€æœ‰å®žä¾‹ï¼ˆæ²¡æœ‰typecodeå®žä¾‹å˜é‡ï¼‰çš„typecodeå±žæ€§çš„é»˜è®¤å€¼ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Vector2d.typecode = <span class="string">'f'</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œæœ‰ç§ä¿®æ”¹æ–¹æ³•æ›´ç¬¦åˆPythoné£Žæ ¼ï¼Œè€Œä¸”æ•ˆæžœæŒä¹…ï¼Œä¹Ÿæ›´æœ‰é’ˆå¯¹æ€§ã€‚ç±»å±žæ€§æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ä¼šè¢«å­ç±»ç»§æ‰¿ï¼ŒäºŽæ˜¯ç»å¸¸ä¼šåˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œåªç”¨äºŽå®šåˆ¶ç±»çš„æ•°æ®å±žæ€§ã€‚DiangoåŸºäºŽç±»çš„è§†å›¾å°±å¤§é‡ä½¿ç”¨äº†è¿™ä¸ªæŠ€æœ¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShortVector2d</span><span class="params">(Vector2d)</span>:</span></span><br><span class="line">    typecode = <span class="string">'f'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹è±¡å¼•ç”¨ã€å¯å˜æ€§å’Œåžƒåœ¾å›žæ”¶</title>
      <link href="/notes/fluent-python/object-references-mutability-and-recycling/"/>
      <url>/notes/fluent-python/object-references-mutability-and-recycling/</url>
      
        <content type="html"><![CDATA[<h1 id="å˜é‡ä¸æ˜¯ç›’å­">å˜é‡ä¸æ˜¯ç›’å­</h1><p>ä»¥ä¸€ä¸ªæ¯”å–»è¯´æ˜ŽPythonçš„å˜é‡ï¼šå˜é‡æ˜¯æ ‡æ³¨ï¼Œè€Œä¸æ˜¯ç›’å­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦æŠ›å¼ƒå˜é‡æ˜¯å­˜å‚¨æ•°æ®çš„ç›’å­è¿™ä¸€é”™è¯¯è§‚å¿µã€‚Pythonå˜é‡ç±»ä¼¼äºŽJavaä¸­çš„å¼•ç”¨å¼å˜é‡ï¼Œå› æ­¤æœ€å¥½æŠŠä»–ä»¬ç†è§£ä¸ºé™„åŠ åœ¨å¯¹è±¡ä¸Šçš„æ ‡æ³¨ã€‚åœ¨ç¤ºä¾‹æ‰€ç¤ºçš„äº¤äº’å¼æŽ§åˆ¶å°ä¸­ï¼Œæ— æ³•ä½¿ç”¨â€œå˜é‡æ˜¯ç›’å­â€åšè§£é‡Šã€‚è€Œä¾¿åˆ©è´´åˆ™æŒ‡å‡ºäº†å˜é‡çš„æ­£ç¡®å·¥ä½œæ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(<span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/fluent-python/variables-as-sticky-notes.png"></p><p>èµ‹å€¼æ–¹å¼ï¼šå¯¹å¼•ç”¨å¼å˜é‡æ¥è¯´ï¼Œè¯´æŠŠå˜é‡åˆ†é…ç»™å¯¹è±¡æ›´åˆç†ï¼Œåè¿‡æ¥è¯´å°±æœ‰é—®é¢˜ã€‚æ¯•ç«Ÿï¼Œå¯¹è±¡åœ¨èµ‹å€¼ä¹‹å‰å°±åˆ›å»ºäº†ã€‚ä¸‹é¢çš„ç¤ºä¾‹è¯æ˜Žèµ‹å€¼è¯­å¥çš„å³è¾¹å…ˆæ‰§è¡Œã€‚</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Gizmo</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'Gizmo id: %d'</span> %id(self))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = Gizmo()</span><br><span class="line">Gizmo id: <span class="number">4533161544</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = Gizmo() * <span class="number">10</span>  <span class="comment"># åœ¨ä¹˜æ³•è¿ç®—ä¸­ä½¿ç”¨Gizmoå®žä¾‹ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">Gizmo id: <span class="number">4533161376</span>  <span class="comment"># åœ¨å°è¯•æ±‚ç§¯ä¹‹å‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Gizmoå®žä¾‹</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> *: <span class="string">'Gizmo'</span> <span class="keyword">and</span> <span class="string">'int'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir()  <span class="comment"># dir()çš„ç»“æžœè¡¨æ˜Žå˜é‡yæ²¡æœ‰è¢«åˆ›å»º</span></span><br><span class="line">[<span class="string">'Gizmo'</span>, <span class="string">'__annotations__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'x'</span>]</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ç†è§£Pythonä¸­çš„èµ‹å€¼å±…äºŽï¼Œåº”è¯¥å§‹ç»ˆå…ˆè¯»å³è¾¹ã€‚å¯¹è±¡åœ¨å³è¾¹åˆ›å»ºæˆ–èŽ·å–ï¼Œåœ¨æ­¤ä¹‹åŽå·¦è¾¹çš„å˜é‡æ‰ä¼šç»‘å®šåˆ°å¯¹è±¡ä¸Šï¼Œè¿™å°±åƒä¸ºå¯¹è±¡è´´ä¸Šæ ‡æ³¨ã€‚å› ä¸ºå˜é‡åªä¸è¿‡æ˜¯æ ‡æ³¨ï¼Œæ‰€ä»¥æ— æ³•ç§Ÿå‡ºä¸ºå¯¹è±¡è´´ä¸Šå¤šä¸ªæ ‡æ³¨ã€‚è´´çš„å¤šä¸ªæ ‡æ³¨ï¼Œå°±æ˜¯åˆ«åã€‚</p><h1 id="æ ‡è¯†ç›¸ç­‰æ€§å’Œåˆ«å">æ ‡è¯†ã€ç›¸ç­‰æ€§å’Œåˆ«å</h1><p>Lewis Carrollæ˜¯Charles Lutwidge Dodgsonæ•™æŽˆçš„ç¬”åã€‚Carrollå…ˆç”ŸæŒ‡çš„å°±æ˜¯Dodgsonæ•™æŽˆï¼ŒäºŒè€…æ˜¯åŒä¸€ä¸ªäººã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>charles = &#123;<span class="string">'name'</span>: <span class="string">'Charles L. Dodgson'</span>, <span class="string">'born'</span>: <span class="number">1832</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lweis = charles</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lweis <span class="keyword">is</span> charles</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(charles), id(lweis)</span><br><span class="line">(<span class="number">4531455896</span>, <span class="number">4531455896</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lweis[<span class="string">'balance'</span>] = <span class="number">950</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>charles</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'Charles L. Dodgson'</span>, <span class="string">'born'</span>: <span class="number">1832</span>, <span class="string">'balance'</span>: <span class="number">950</span>&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œå‡å¦‚æœ‰å†’å……è€…ï¼ˆAlexander Pedachenkoåšå£«ï¼‰ç”ŸäºŽ1832å¹´ï¼Œå£°ç§°ä»–æ˜¯Charles L. Dodgsonã€‚è¿™ä¸ªå†’å……è€…çš„è¯ä»¶å¯èƒ½ä¸€æ ·ï¼Œä½†æ˜¯Pedachenkoåšå£«ä¸æ˜¯Dodgsonæ•™æŽˆã€‚</p><p><img src="/uploads/image/fluent-python/python-is-and-equal.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>alex = &#123;<span class="string">'name'</span>: <span class="string">'Charles L. Dodgson'</span>, <span class="string">'born'</span>: <span class="number">1832</span>, <span class="string">'balance'</span>: <span class="number">950</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>alex == charles</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>alex <span class="keyword">is</span> <span class="keyword">not</span> charles</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(alex), id(charles)</span><br><span class="line">(<span class="number">4533183904</span>, <span class="number">4531455896</span>)</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªå˜é‡éƒ½æœ‰æ ‡è¯†ã€ç±»åž‹å’Œå€¼ã€‚å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå®ƒçš„æ ‡è¯†ç»ä¸ä¼šå˜ã€‚isè¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ ‡è¯†ï¼šid()å‡½æ•°è¿”å›žå¯¹è±¡è¡¨ç¤ºçš„æ•´æ•°æ ‡è¯†ã€‚</p><p>å¯¹è±¡IDçš„çœŸæ­£æ„ä¹‰åœ¨ä¸åŒçš„å®žçŽ°ä¸­æœ‰æ‰€ä¸åŒã€‚åœ¨CPythonä¸­ï¼Œid()è¿”å›žå¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œä½†æ˜¯åœ¨å…¶ä»–Pythonè§£é‡Šå™¨ä¸­å¯èƒ½æ˜¯åˆ«çš„å€¼ã€‚å…³é”®æ˜¯ï¼ŒIDä¸€å®šæ˜¯å”¯ä¸€çš„æ•°å€¼æ ‡æ³¨ï¼Œè€Œä¸”åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸­ç»ä¸ä¼šå˜ã€‚</p><h2 id="åœ¨å’Œisä¹‹é—´é€‰æ‹©">åœ¨==å’Œisä¹‹é—´é€‰æ‹©</h2><p>==è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼ï¼ˆå¯¹è±¡ä¸­ä¿å­˜çš„æ•°æ®ï¼‰ï¼Œè€Œisæ¯”è¾ƒå¯¹è±¡çš„æ ‡è¯†ã€‚ï¼ˆ==ç›¸å½“äºŽJavaä¸­çš„equal()æ–¹æ³•ï¼Œè€Œisç›¸å½“äºŽJavaä¸­çš„==ï¼‰ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯æ ‡è¯†ï¼Œå› æ­¤Pythonä»£ç ä¸­==çš„å‡ºçŽ°é¢‘çŽ‡æ¯”isé«˜ã€‚</p><p><strong>ç„¶è€Œï¼Œåœ¨å˜é‡å’Œå•ä¾‹å€¼ä¹‹é—´æ¯”è¾ƒæ—¶ï¼Œåº”è¯¥ä½¿ç”¨isã€‚ç›®å‰ï¼Œæœ€å¸¸ä½¿ç”¨isæ£€æŸ¥å˜é‡ç»‘å®šçš„å€¼æ˜¯ä¸æ˜¯Noneã€‚</strong>ä¸‹é¢æ˜¯æŽ¨èçš„å†™æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>isè¿ç®—ç¬¦æ¯”==é€Ÿåº¦å¿«ï¼Œå› ä¸ºå®ƒä¸èƒ½é‡è½½ï¼Œæ‰€ä»¥Pythonä¸ç”¨å¯»æ‰¾å¹¶è°ƒç”¨ç‰¹æ®Šæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æŽ¥æ¯”è¾ƒä¸¤ä¸ªæ•´æ•°IDã€‚è€Œa==bæ˜¯è¯­æ³•ç³–ï¼Œç­‰åŒäºŽ<code>a.__eq__(b)</code>ã€‚ç»§æ‰¿è‡ªobjectçš„<code>__eq__</code>æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„IDï¼Œç»“æžœä¸Žisä¸€æ ·ï¼Œä½†æ˜¯å¤šæ•°å†…ç½®ç±»åž‹ä½¿ç”¨æ›´æœ‰æ„ä¹‰çš„æ–¹å¼è¦†ç›–äº†<code>__eq__</code>æ–¹æ³•ï¼Œä¼šè€ƒè™‘å¯¹è±¡å±žæ€§çš„å€¼ã€‚ç›¸ç­‰æ€§æµ‹è¯•å¯èƒ½æ¶‰åŠå¤§é‡å¤„ç†å·¥ä½œï¼Œä¾‹å¦‚ï¼Œæ¯”è¾ƒå¤§åž‹é›†åˆæˆ–åµŒå¥—å±‚çº§æ·±çš„æœºæž„æ—¶ã€‚</p><h2 id="å…ƒç»„çš„ç›¸å¯¹ä¸å˜æ€§">å…ƒç»„çš„ç›¸å¯¹ä¸å˜æ€§</h2><p>å…ƒç´ ä¸Žå¤šæ•°Pythoné›†åˆï¼ˆåˆ—è¡¨ã€å­—å…¸ã€é›†ï¼Œç­‰ç­‰ï¼‰ä¸€æ ·ï¼Œä¿å­˜çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ˆstrã€byteså’Œarray.arrayç­‰å•ä¸€ç±»åž‹åºåˆ—æ˜¯æ‰å¹³çš„ï¼Œå®ƒä»¬ä¿å­˜çš„ä¸æ˜¯å¼•ç”¨ï¼Œè€Œæ˜¯åœ¨è¿žç»­çš„å†…å®¹ä¸­ä¿å­˜æ•°æ®æœ¬èº«ï¼‰ã€‚å¦‚æžœå¼•ç”¨çš„å…ƒç´ æ˜¯å¯å˜çš„ï¼Œå³ä½¿å…ƒç»„æœ¬èº«ä¸å¯å˜ï¼Œå…ƒç´ ä¾ç„¶å¯å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ƒç»„çš„ä¸å¯å˜æ€§å…¶å®žæ˜¯æŒ‡tupleæ•°æ®ç»“æž„çš„ç‰©ç†å†…å®¹ï¼ˆå³ä¿å­˜çš„å¼•ç”¨ï¼‰ä¸å¯å˜ï¼Œä¸Žå¼•ç”¨çš„å¯¹è±¡æ— å…³ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t2 = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 == t2, t1 <span class="keyword">is</span> t2  <span class="comment"># t1ä¸Žt2ç›¸ç­‰ï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">(<span class="literal">True</span>, <span class="literal">False</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(t1[<span class="number">-1</span>])</span><br><span class="line"><span class="number">4533178056</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1[<span class="number">-1</span>].append(<span class="number">99</span>)  <span class="comment"># æ”¹å˜t[-1]çš„å†…å®¹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(t1[<span class="number">-1</span>])  <span class="comment"># t[-1]çš„æ ‡è¯†æ²¡å˜</span></span><br><span class="line"><span class="number">4533178056</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 == t2  <span class="comment"># å†…å®¹ä¸å†ç›¸ç­‰</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><p>æ¥è‡ª2.6.1èŠ‚çš„ä¸€ä¸ªè°œé¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">2</span>] += [<span class="number">50</span>, <span class="number">60</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ä¸ªè¡¨è¾¾å¼çš„è¿è¡Œç»“æžœæ˜¯å“ªä¸€ä¸ªï¼Ÿ</p><ol type="a"><li><p>tå˜æˆ(1, 2, [30, 40, 50, 60])ã€‚</p></li><li><p>å› ä¸ºtupleä¸æ”¯æŒå¯¹å®ƒçš„å…ƒç´ èµ‹å€¼ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºTypeErrorå¼‚å¸¸ã€‚</p></li><li><p>ä»¥ä¸Šä¸¤ä¸ªéƒ½ä¸æ˜¯ã€‚</p></li><li><p>aå’Œbéƒ½æ˜¯å¯¹çš„ã€‚</p></li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ========== è°œé¢˜ç­”æ¡ˆ ==========</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">2</span>] += [<span class="number">50</span>, <span class="number">60</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">'tuple'</span> object does <span class="keyword">not</span> support item assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>])  <span class="comment"># ç”±æ­¤å¯è§è°œé¢˜çš„ç­”æ¡ˆæ˜¯ d</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dis.dis(<span class="string">'s[a] += b'</span>)  <span class="comment"># æŸ¥çœ‹ s[a] += b èƒŒåŽçš„å­—èŠ‚ç </span></span><br><span class="line">  <span class="number">1</span>           <span class="number">0</span> LOAD_NAME                <span class="number">0</span> (s)</span><br><span class="line">              <span class="number">2</span> LOAD_NAME                <span class="number">1</span> (a)</span><br><span class="line">              <span class="number">4</span> DUP_TOP_TWO</span><br><span class="line">              <span class="number">6</span> BINARY_SUBSCR                       <span class="comment"># å°†s[a]çš„å€¼å­˜å…¥TOS(Top Of Stackï¼Œæ ˆçš„é¡¶ç«¯)</span></span><br><span class="line">              <span class="number">8</span> LOAD_NAME                <span class="number">2</span> (b)</span><br><span class="line">             <span class="number">10</span> INPLACE_ADD                         <span class="comment"># è®¡ç®—TOS += bã€‚è¿™ä¸€æ­¥èƒ½å¤Ÿå®Œæˆï¼Œæ˜¯å› ä¸ºTOSæŒ‡å‘çš„æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡</span></span><br><span class="line">             <span class="number">12</span> ROT_THREE</span><br><span class="line">             <span class="number">14</span> STORE_SUBSCR                        <span class="comment"># s[a] = TOSèµ‹å€¼ã€‚è¿™ä¸€æ­¥å¤±è´¥ï¼Œæ˜¯å› ä¸ºsæ˜¯ä¸å¯å˜çš„å…ƒç»„</span></span><br><span class="line">             <span class="number">16</span> LOAD_CONST               <span class="number">0</span> (<span class="literal">None</span>)</span><br><span class="line">             <span class="number">18</span> RETURN_VALUE</span><br></pre></td></tr></table></figure><p>è¿™å…¶å®žæ˜¯ä¸ªéžå¸¸ç½•è§çš„è¾¹ç•Œæƒ…å†µï¼Œåœ¨15å¹´çš„Pythonç”Ÿæ¶¯ä¸­ï¼Œæˆ‘è¿˜æ²¡è§è¿‡è°åœ¨è¿™ä¸ªåœ°æ–¹åƒè¿‡äºã€‚è‡³æ­¤æˆ‘å¾—åˆ°äº†3ä¸ªæ•™è®­ã€‚</p><ul><li>ä¸è¦æŠŠå¯å˜å¯¹è±¡æ”¾åœ¨å…ƒç»„é‡Œé¢ã€‚</li><li>å¢žé‡èµ‹å€¼ä¸æ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œã€‚æˆ‘ä»¬åˆšæ‰ä¹Ÿçœ‹åˆ°äº†ï¼Œå®ƒè™½ç„¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†è¿˜æ˜¯å®Œæˆäº†æ“ä½œã€‚</li><li>æŸ¥çœ‹Pythonçš„å­—èŠ‚ç å¹¶ä¸éš¾ï¼Œè€Œä¸”å®ƒå¯¹æˆ‘ä»¬äº†è§£ä»£ç èƒŒåŽçš„è¿è¡Œæœºåˆ¶å¾ˆæœ‰å¸®åŠ©ã€‚</li></ul><h1 id="é»˜è®¤åšæµ…å¤åˆ¶">é»˜è®¤åšæµ…å¤åˆ¶</h1><p>å¤åˆ¶åˆ—è¡¨ï¼ˆæˆ–å¤šæ•°å†…ç½®çš„å¯å˜é›†åˆï¼‰æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨å†…ç½®çš„ç±»åž‹æž„é€ æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1 = [<span class="number">3</span>, [<span class="number">55</span>, <span class="number">44</span>], (<span class="number">7</span>, <span class="number">8</span> ,<span class="number">9</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 = list(l1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 == l1, l2 <span class="keyword">is</span> l1  <span class="comment"># äºŒè€…ç›¸ç­‰ï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">(<span class="literal">True</span>, <span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>å¯¹åˆ—è¡¨å’Œå…¶ä»–å¯å˜åºåˆ—æ¥è¯´ï¼Œè¿˜èƒ½ä½¿ç”¨ç®€æ´çš„l2=l1[:]è¯­å¥åˆ›å»ºå‰¯æœ¬ã€‚ç„¶è€Œï¼Œæž„é€ æ–¹æ³•æˆ–[:]åšçš„æ˜¯æµ…å¤åˆ¶ï¼ˆå³å¤åˆ¶äº†æœ€å¤–å±‚å®¹å™¨ï¼Œå‰¯æœ¬ä¸­çš„å…ƒç´ æ˜¯æºå®¹å™¨ä¸­å…ƒç´ çš„å¼•ç”¨ï¼‰ã€‚å¦‚æžœæ‰€æœ‰å…ƒç´ éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆè¿™æ ·æ²¡æœ‰é—®é¢˜ï¼Œè¿˜èƒ½èŠ‚çœå†…å­˜ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæœ‰å¯å˜çš„å…ƒç´ ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1 = [<span class="number">3</span>, [<span class="number">66</span>, <span class="number">55</span>, <span class="number">44</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 = list(l1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1[<span class="number">1</span>] <span class="keyword">is</span> l2[<span class="number">1</span>], l1[<span class="number">2</span>] <span class="keyword">is</span> l2[<span class="number">2</span>]  <span class="comment"># æµ…å¤åˆ¶å¤åˆ¶çš„æ˜¯å¼•ç”¨</span></span><br><span class="line">(<span class="literal">True</span>, <span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1.append(<span class="number">100</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1[<span class="number">1</span>].remove(<span class="number">55</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="number">3</span>, [<span class="number">66</span>, <span class="number">44</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>), <span class="number">100</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2</span><br><span class="line">[<span class="number">3</span>, [<span class="number">66</span>, <span class="number">44</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2[<span class="number">1</span>] += [<span class="number">33</span>, <span class="number">22</span>]  <span class="comment"># å¯¹å¯å˜çš„å¯¹è±¡æ¥è¯´ï¼Œ+=è¿ç®—ç¬¦å°±åœ°ä¿®æ”¹åˆ—è¡¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2[<span class="number">2</span>] += (<span class="number">10</span>, <span class="number">11</span>)  <span class="comment"># å¯¹å…ƒç»„æ¥è¯´ï¼Œ+=è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªæ–°å…ƒç»„ï¼Œç„¶åŽé‡æ–°ç»‘å®šç»™å˜é‡</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1</span><br><span class="line">[<span class="number">3</span>, [<span class="number">66</span>, <span class="number">44</span>, <span class="number">33</span>, <span class="number">22</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>), <span class="number">100</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2</span><br><span class="line">[<span class="number">3</span>, [<span class="number">66</span>, <span class="number">44</span>, <span class="number">33</span>, <span class="number">22</span>], (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>)]</span><br></pre></td></tr></table></figure><h2 id="ä¸ºä»»æ„å¯¹è±¡åšæ·±å¤åˆ¶å’Œæµ…å¤åˆ¶">ä¸ºä»»æ„å¯¹è±¡åšæ·±å¤åˆ¶å’Œæµ…å¤åˆ¶</h2><p>copyæ¨¡å—æä¾›çš„deepcopyå’Œcopyå‡½æ•°èƒ½ä¸ºä»»æ„å¯¹è±¡åšæ·±å¤åˆ¶å’Œæµ…å¤åˆ¶ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Bus</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, passengers=None)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">if</span> passengers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"><span class="meta">... </span>            self.passengers = []</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>            self.passengers = list(passengers)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers.append(name)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">drop</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers.remove(name)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> copy <span class="keyword">import</span> copy, deepcopy</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1 = Bus([<span class="string">'Alice'</span>, <span class="string">'Bill'</span>, <span class="string">'Claire'</span>, <span class="string">'David'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2 = copy(bus1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3 = deepcopy(bus1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(bus1), id(bus2), id(bus3)  <span class="comment"># 3ä¸ªä¸åŒçš„å®žä¾‹</span></span><br><span class="line">(<span class="number">4533933560</span>, <span class="number">4533933840</span>, <span class="number">4533934232</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.drop(<span class="string">'Bill'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.passengers  <span class="comment"># bus1ä¸­çš„Billä¸‹è½¦åŽï¼Œbus2ä¸­ä¹Ÿæ²¡æœ‰ä»–äº†</span></span><br><span class="line">[<span class="string">'Alice'</span>, <span class="string">'Claire'</span>, <span class="string">'David'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3.passengers</span><br><span class="line">[<span class="string">'Alice'</span>, <span class="string">'Bill'</span>, <span class="string">'Claire'</span>, <span class="string">'David'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(bus1.passengers), id(bus2.passengers), id(bus3.passengers)  <span class="comment"># å®¡æŸ¥passengerså±žæ€§ï¼Œbus1å’Œbus2å…±äº«åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ï¼ˆæµ…å¤åˆ¶ï¼‰</span></span><br><span class="line">(<span class="number">4533897800</span>, <span class="number">4533897800</span>, <span class="number">4533249800</span>)</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ·±å¤åˆ¶ä¸æ˜¯ä»¶ç®€å•çš„äº‹ã€‚å¦‚æžœå¯¹è±¡æœ‰å¾ªçŽ¯å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæœ´ç´ çš„ç®—æ³•ä¼šè¿›å…¥æ— é™å¾ªçŽ¯ã€‚deepcopyå‡½æ•°ä¼šè®°ä½å·²ç»å¤åˆ¶çš„å¯¹è±¡ï¼Œå› æ­¤èƒ½ä¼˜é›…åœ°å¤„ç†å¾ªçŽ¯å¼•ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">10</span>, <span class="number">20</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [a, <span class="number">30</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.append(b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="number">10</span>, <span class="number">20</span>, [[...], <span class="number">30</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = deepcopy(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">[<span class="number">10</span>, <span class="number">20</span>, [[...], <span class="number">30</span>]]</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œæ·±å¤åˆ¶æœ‰æ—¶å¯èƒ½å¤ªæ·±äº†ã€‚ä¾‹å¦‚ï¼Œå¯¹è±¡å¯èƒ½ä¼šå¼•ç”¨ä¸è¯¥å¤åˆ¶çš„å¤–éƒ¨èµ„æºæˆ–å•ä¾‹å€¼ã€‚æˆ‘ä»¬å¯ä»¥å®žçŽ°ç‰¹æ®Šæ–¹æ³•<code>__copy__()</code>å’Œ<code>__deepcopy__()</code>ï¼ŒæŽ§åˆ¶copyå’Œdeepcopyçš„è¡Œä¸ºã€‚</p><h1 id="å‡½æ•°çš„å‚æ•°ä½œä¸ºå¼•ç”¨æ—¶">å‡½æ•°çš„å‚æ•°ä½œä¸ºå¼•ç”¨æ—¶</h1><p>Pythonå”¯ä¸€æ”¯æŒçš„å‚æ•°ä¼ é€’æ¨¡å¼æ˜¯å…±äº«å‚æ•°ï¼ˆcall by sharingï¼‰ã€‚å¤šæ•°é¢å‘å¯¹è±¡è¯­è¨€éƒ½é‡‡ç”¨è¿™ä¸€æ¨¡å¼ã€‚å…±äº«ä¼ å‚æŒ‡å‡½æ•°çš„å„ä¸ªå½¢å¼å‚æ•°èŽ·å¾—å®žå‚ä¸­å„ä¸ªå¼•ç”¨çš„å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°å†…éƒ¨çš„å½¢å‚æ˜¯å®žå‚çš„åˆ«åã€‚è¿™ç§æ–¹æ¡ˆçš„ç»“æžœæ˜¯ï¼Œå‡½æ•°å¯èƒ½ä¼šä¿®æ”¹ä½œä¸ºå‚æ•°ä¼ å…¥çš„å¯å˜å¯¹è±¡ï¼Œä½†æ˜¯æ— æ³•ä¿®æ”¹é‚£äº›å¯¹è±¡çš„æ ‡è¯†ã€‚</p><h2 id="ä¸è¦ä½¿ç”¨å¯å˜ç±»åž‹ä½œä¸ºå‚æ•°çš„é»˜è®¤å€¼">ä¸è¦ä½¿ç”¨å¯å˜ç±»åž‹ä½œä¸ºå‚æ•°çš„é»˜è®¤å€¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">HauntedBus</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">"""å¤‡å—å¹½çµä¹˜å®¢æŠ˜ç£¨çš„æ ¡è½¦"""</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, passengers=[])</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers = passengers</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers.append(name)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">drop</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers.remove(name)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1 = HauntedBus([<span class="string">'Alice'</span>, <span class="string">'Bill'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.pick(<span class="string">'Charlie'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.drop(<span class="string">'Alice'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus1.passengers</span><br><span class="line">[<span class="string">'Bill'</span>, <span class="string">'Charlie'</span>]  <span class="comment"># ä¸ä½¿ç”¨é»˜è®¤å€¼æ²¡ä»€ä¹ˆé—®é¢˜</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2 = HauntedBus()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.pick(<span class="string">'Carrie'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.passengers</span><br><span class="line">[<span class="string">'Carrie'</span>]  <span class="comment"># ä½¿ç”¨é»˜è®¤å€¼ï¼Œç›®å‰ä¸ºæ­¢ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3 = HauntedBus()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3.passengers  <span class="comment"># bus3ä¸æ˜¯é¢„æœŸä¸­çš„ç©ºè½¦</span></span><br><span class="line">[<span class="string">'Carrie'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3.pick(<span class="string">'Dave'</span>)  <span class="comment"># Daveç™»ä¸Šbus3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus2.passengers  <span class="comment"># Daveå‡ºçŽ°åœ¨äº†bus2ä¸­</span></span><br><span class="line">[<span class="string">'Carrie'</span>, <span class="string">'Dave'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus3.passengers <span class="keyword">is</span> bus2.passengers  <span class="comment"># passergerså±žæ€§æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>é—®é¢˜åœ¨äºŽï¼Œæ²¡æœ‰æŒ‡å®šåˆå§‹ä¹˜å®¢çš„HauntedBuså®žä¾‹ä¼šå…±äº«åŒä¸€ä¸ªä¹˜å®¢åˆ—è¡¨ã€‚è¿™æ˜¯å› ä¸ºself.passengerså˜æˆäº†passengerså‚æ•°é»˜è®¤å€¼çš„åˆ«åã€‚å‡ºçŽ°è¿™ä¸ªé—®é¢˜çš„æ ¹æºæ˜¯ï¼Œé»˜è®¤å€¼åœ¨å®šä¹‰å‡½æ•°æ—¶è®¡ç®—ï¼ˆé€šå¸¸åœ¨åŠ è½½æ¨¡å—æ—¶ï¼‰ï¼Œå› æ­¤é»˜è®¤å€¼å˜æˆäº†å‡½æ•°å¯¹è±¡çš„å±žæ€§ã€‚å› æ­¤ï¼Œå¦‚æžœé»˜è®¤å€¼æ˜¯å¯å˜å¯¹è±¡ï¼Œè€Œä¸”ä¿®æ”¹äº†å®ƒçš„å€¼ï¼Œé‚£ä¹ˆåŽç»­çš„å‡½æ•°è°ƒç”¨éƒ½ä¼šå—åˆ°å½±å“ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>HauntedBus.__init__.__defaults__</span><br><span class="line">([<span class="string">'Carrie'</span>, <span class="string">'Dave'</span>],)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>HauntedBus.__init__.__defaults__[<span class="number">0</span>] <span class="keyword">is</span> bus2.passengers <span class="keyword">is</span> bus3.passengers</span><br><span class="line"><span class="literal">True</span>  <span class="comment"># ä½¿ç”¨é»˜è®¤å€¼çš„å®žä¾‹ï¼Œå…¶passengerså±žæ€§å®žé™…ä¸Šéƒ½æ˜¯é»˜è®¤å€¼[]çš„åˆ«å</span></span><br></pre></td></tr></table></figure><h2 id="é˜²å¾¡å¯å˜å‚æ•°">é˜²å¾¡å¯å˜å‚æ•°</h2><p>å¦‚æžœå®šä¹‰çš„å‡½æ•°æŽ¥æ”¶å¯å˜å‚æ•°ï¼Œåº”è¯¥è°¨æ…Žè€ƒè™‘è°ƒç”¨æ–¹æ˜¯å¦æœŸæœ›ä¿®æ”¹ä¼ å…¥çš„å‚æ•°ã€‚å…·ä½“æƒ…å†µå…·ä½“åˆ†æžï¼Œè¿™å…¶å®žéœ€è¦å‡½æ•°çš„ç¼–å†™è€…å’Œè°ƒç”¨æ–¹è¾¾æˆå…±è¯†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">TwilightBus</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">"""è®©ä¹˜å®¢é”€å£°åŒ¿è¿¹çš„æ ¡è½¦</span></span><br><span class="line"><span class="string"><span class="meta">... </span>    ä¸€ä¸ªç®€å•çš„ç±»ï¼Œè¯´æ˜ŽæŽ¥å—å¯å˜å‚æ•°çš„é£Žé™©"""</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, passengers=None)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">if</span> passengers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"><span class="meta">... </span>            self.passengers = <span class="literal">None</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>            self.passengers = passengers  <span class="comment"># self.passengerså˜æˆpassengersçš„åˆ«å</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers.append(name)</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">drop</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.passengers.remove(name)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>basketball_team = [<span class="string">'Sue'</span>, <span class="string">'Tina'</span>, <span class="string">'Maya'</span>, <span class="string">'Diana'</span>, <span class="string">'Pat'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus = TwilightBus(basketball_team)  <span class="comment"># self.passengerså˜æˆäº†å®žå‚basketball_teamçš„åˆ«å</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus.drop(<span class="string">'Tina'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bus.drop(<span class="string">'Pat'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>basketball_team  <span class="comment"># ä¸‹è½¦çš„å­¦ç”Ÿä»Žç¯®çƒé˜Ÿä¸­æ¶ˆå¤±äº†</span></span><br><span class="line">[<span class="string">'Sue'</span>, <span class="string">'Maya'</span>, <span class="string">'Diana'</span>]</span><br></pre></td></tr></table></figure><p>TwilightBusè¿åäº†è®¾è®¡æŽ¥å£çš„æœ€ä½³å®žè·µï¼Œå³â€œæœ€å°‘æƒŠè®¶åŽŸåˆ™â€ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œæ ¡è½¦è‡ªå·±ç»´æŠ¤ä¹˜å®¢åˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, passengers=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> passengers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        self.passengers = []</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.passengers = list(passengers)  <span class="comment"># ä¿®æ”¹æ­¤å¤„ï¼Œåˆ›å»ºpassengersçš„å‰¯æœ¬ï¼Œç„¶åŽèµ‹å€¼ç»™self.passengers</span></span><br></pre></td></tr></table></figure><p>åœ¨å†…éƒ¨åƒè¿™æ ·å¤„ç†ä¹˜å®¢åˆ—è¡¨ï¼Œå°±ä¸ä¼šå½±å“åˆå§‹åŒ–æ ¡è½¦æ—¶ä¼ å…¥çš„å‚æ•°äº†ã€‚æ­¤å¤–ï¼Œè¿™ç§å¤„ç†æ–¹å¼è¿˜æ›´çµæ´»ï¼šçŽ°åœ¨ä¼ ç»™passengerså‚æ•°çš„å€¼å¯ä»¥æ˜¯å…ƒç»„æˆ–ä»»ä½•å…¶ä»–å¯è¿­ä»£å¯¹è±¡ï¼Œä¾‹å¦‚setå¯¹è±¡ï¼Œç”šè‡³æ•°æ®åº“æŸ¥è¯¢ç»“æžœã€‚</p><h1 id="delå’Œåžƒåœ¾å›žæ”¶">delå’Œåžƒåœ¾å›žæ”¶</h1><p>delè¯­å¥åˆ é™¤åç§°ï¼Œè€Œä¸æ˜¯å¯¹è±¡ã€‚delå‘½ä»¤å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡è¢«å½“ä½œåžƒåœ¾å›žæ”¶ï¼Œä½†æ˜¯ä»…å½“åˆ é™¤çš„å˜é‡ä¿å­˜çš„æ˜¯å¯¹è±¡çš„æœ€åŽä¸€ä¸ªå¼•ç”¨ï¼Œæˆ–è€…æ— æ³•å¾—åˆ°å¯¹è±¡æ—¶ï¼ˆå¦‚æžœä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå½“å®ƒä»¬çš„å¼•ç”¨åªå­˜åœ¨äºŒè€…ä¹‹é—´æ—¶ï¼Œåžƒåœ¾å›žæ”¶ç¨‹åºä¼šåˆ¤å®šå®ƒä»¬æ— æ³•èŽ·å–ï¼Œè¿›è€ŒæŠŠå®ƒä»¬éƒ½é”€æ¯ï¼‰ã€‚é‡æ–°ç»‘å®šä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡çš„å¼•ç”¨æ•°é‡å½’é›¶ï¼Œå¯¼è‡´å¯¹è±¡è¢«é”€æ¯ã€‚</p><p>æœ‰ä¸ª<code>__del__</code>ç‰¹æ®Šæ–¹æ³•ï¼Œå®ƒæ˜¯ä»–ä¸ä¼šé”€æ¯å®žä¾‹ï¼Œä¸åº”è¯¥åœ¨ä»£ç ä¸­è°ƒç”¨ã€‚å³å°†é”€æ¯å®žä¾‹æ—¶ï¼ŒPythonè§£é‡Šå™¨ä¼šè°ƒç”¨<code>__del__</code>æ–¹æ³•ï¼Œç»™å®žä¾‹æœ€åŽçš„æœºä¼šï¼Œé‡Šæ”¾å¤–éƒ¨èµ„æºã€‚è‡ªå·±ç¼–å†™çš„ä»£ç å¾ˆå°‘éœ€è¦å®žçŽ°<code>__del__</code>ã€‚</p><p>åœ¨CPythonä¸­ï¼Œåžƒåœ¾å›žæ”¶ä½¿ç”¨çš„ä¸»è¦ç®—æ³•æ˜¯å¼•ç”¨è®¡æ•°ã€‚å®žé™…ä¸Šï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»Ÿè®¡æœ‰å¤šå°‘å¼•ç”¨æŒ‡å‘è‡ªå·±ã€‚å½“å¼•ç”¨è®¡æ•°å½’é›¶æ—¶ï¼Œå¯¹è±¡ç«‹å³å°±è¢«é”€æ¯ï¼šCPythonä¼šåœ¨å¯¹è±¡ä¸Šè°ƒç”¨<code>__del__</code>æ–¹æ³•ï¼ˆå¦‚æžœå®šä¹‰äº†ï¼‰ï¼Œç„¶åŽé‡Šæ”¾åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜ã€‚CPython 2.0å¢žåŠ äº†åˆ†ä»£åžƒåœ¾å›žæ”¶ç®—æ³•ï¼Œç”¨äºŽæ£€æµ‹å¼•ç”¨å¾ªçŽ¯ä¸­æ¶‰åŠçš„å¯¹è±¡ç»„â€”â€”å¦‚æžœä¸€ç»„å¯¹è±¡ä¹‹é—´å…¨æ˜¯ç›¸äº’å¼•ç”¨ï¼Œå³ä½¿å†å‡ºè‰²çš„å¼•ç”¨æ–¹å¼ä¹Ÿä¼šå¯¼è‡´ç»„ä¸­çš„å¯¹è±¡ä¸å¯èŽ·å–ã€‚Pythonçš„å…¶ä»–å®žçŽ°æœ‰æ›´å¤æ‚çš„åžƒåœ¾å›žæ”¶ç¨‹åºï¼Œè€Œä¸”ä¸ä¾èµ–å¼•ç”¨è®¡æ•°ï¼Œè¿™æ„å‘³ç€ï¼Œå¯¹è±¡çš„å¼•ç”¨æ•°é‡å½’é›¶æ—¶å¯èƒ½ä¸ä¼šç«‹å³è°ƒç”¨<code>__del__</code>æ–¹æ³•ã€‚</p><p>å¯¹äº†æ¼”ç¤ºå¯¹è±¡ç”Ÿå‘½ç»“æŸæ—¶çš„æƒ…å½¢ï¼Œä½¿ç”¨weakref.finalizeæ³¨å†Œä¸€ä¸ªå›žè°ƒå‡½æ•°ï¼Œåœ¨é”€æ¯å¯¹è±¡æ—¶è°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> weakref</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = s1  <span class="comment"># s1å’Œs2æŒ‡å‘åŒä¸€ä¸ªé›†åˆ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">bye</span><span class="params">()</span>:</span>  <span class="comment"># è¿™ä¸ªå‡½æ•°ä¸€å®šä¸èƒ½æ˜¯è¦é”€æ¯çš„å¯¹è±¡çš„ç»‘å®šæ–¹æ³•ï¼Œå¦åˆ™ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'Gone with the wind...'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ender = weakref.finalize(s1, bye)  <span class="comment"># åœ¨s1å¼•ç”¨çš„å¯¹è±¡ä¸Šæ³¨å†Œbyeå›žè°ƒï¼ŒfinalizeæŒæœ‰&#123;1, 2, 3&#125;çš„å¼±å¼•ç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ender.alive</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> s1  <span class="comment"># åˆ é™¤å¼•ç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ender.alive  <span class="comment"># å¯¹è±¡ä¾ç„¶å­˜åœ¨</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="string">'spam'</span>  <span class="comment"># é‡æ–°ç»‘å®šäº†s2ï¼ŒåŽŸæ¥çš„é›†åˆå¯¹è±¡æ— æ³•èŽ·å–ï¼Œå¯¹è±¡è¢«é”€æ¯äº†</span></span><br><span class="line">Gone <span class="keyword">with</span> the wind...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ender.alive</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="å¼±å¼•ç”¨">å¼±å¼•ç”¨</h1><p>å¼±å¼•ç”¨ä¸ä¼šå¢žåŠ å¯¹è±¡çš„å¼•ç”¨æ•°é‡ã€‚å¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ç§°ä¸ºæ‰€æŒ‡å¯¹è±¡ï¼ˆreferentï¼‰ã€‚å› æ­¤ï¼Œå¼±å¼•ç”¨ä¸ä¼šå¦¨ç¢æ‰€æŒ‡å¯¹è±¡è¢«å½“ä½œåžƒåœ¾å›žæ”¶ã€‚å¼±å¼•ç”¨åœ¨ç¼“å­˜åº”ç”¨ä¸­å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³ä»…å› ä¸ºè¢«ç¼“å­˜å¼•ç”¨ç€è€Œå§‹ç»ˆä¿å­˜ç¼“å­˜å¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a_set = &#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wref = weakref.ref(a_set)  <span class="comment"># åˆ›å»ºå¼±å¼•ç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wref  <span class="comment"># å®¡æŸ¥</span></span><br><span class="line">&lt;weakref at <span class="number">0x10e3dae08</span>; to <span class="string">'set'</span> at <span class="number">0x10e326ac8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wref()  <span class="comment"># è°ƒç”¨wref()è¿”å›žçš„æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å› ä¸ºè¿™æ˜¯æŽ§åˆ¶å°ä¼šè¯ï¼Œæ‰€ä»¥&#123;0, 1&#125;ä¼šç»‘å®šç»™ _ å˜é‡</span></span><br><span class="line">&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>_</span><br><span class="line">&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a_set = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;  <span class="comment"># &#123;0, 1&#125;çš„å¼•ç”¨æ•°å‡å°‘äº†ï¼Œä½†æ˜¯ _ å˜é‡ä»ç„¶æŒ‡ä»£å®ƒ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wref()  <span class="comment"># ä¾æ—§è¿”å›ž&#123;0, 1&#125;</span></span><br><span class="line">&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wref() <span class="keyword">is</span> <span class="literal">None</span>  <span class="comment"># è®¡ç®—è¡¨è¾¾å¼æ—¶ï¼Œ&#123;0, 1&#125;å­˜åœ¨ï¼Œå› æ­¤è¿”å›žFalseï¼ŒéšåŽ _ ç»‘å®šåˆ°ç»“æžœå€¼Falseï¼ŒçŽ°åœ¨&#123;0, 1&#125;æ²¡æœ‰å¼ºå¼•ç”¨äº†</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>wref() <span class="keyword">is</span> <span class="literal">None</span>  <span class="comment"># &#123;0, 1&#125;å¯¹è±¡ä¸å­˜åœ¨äº†ï¼Œæ‰€ä»¥è¿”å›žTrue</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p><a href="http://docs.python.org/3/library/weakref.html" target="_blank" rel="noopener">weakrefæ¨¡å—çš„æ–‡æ¡£</a>æŒ‡å‡ºï¼Œweakref.refç±»å…¶å®žæ˜¯åº•å±‚æŽ¥å£ï¼Œä¾›é«˜çº§ç”¨é€”ä½¿ç”¨ï¼Œå¤šæ•°ç¨‹åºæœ€å¥½ä½¿ç”¨weakrefé›†åˆå’Œfinalizeã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”è¯¥ä½¿ç”¨WeakKeyDictionaryã€WeakValueDictionaryã€WeakSetå’Œfinalizeï¼ˆåœ¨å†…éƒ¨ä½¿ç”¨å¼±å¼•ç”¨ï¼‰ï¼Œä¸è¦è‡ªå·±åŠ¨æ‰‹åˆ›å»ºå¹¶å¤„ç†weakref.refå®žä¾‹ã€‚</p><h2 id="weakvaluedictionaryç®€ä»‹">WeakValueDictionaryç®€ä»‹</h2><p>WeakValueDictionaryç±»å®žçŽ°çš„æ˜¯ä¸€ç§å¯å˜æ˜ å°„ï¼Œé‡Œé¢çš„å€¼æ˜¯å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œè¢«å¼•ç”¨çš„å¯¹è±¡åœ¨ç¨‹åºçš„å…¶ä»–åœ°æ–¹è¢«å½“ä½œåžƒåœ¾å›žæ”¶åŽï¼Œå¯¹åº”çš„é”®ä¼šè‡ªåŠ¨ä»ŽWeakValueDictionaryä¸­åˆ é™¤ã€‚å› æ­¤WeakValueDictionaryç»å¸¸ç”¨äºŽç¼“å­˜ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Cheese</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, kind)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.kind = kind</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">'Cheese(%r)'</span> % self.kind</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> weakref</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stock = weakref.WeakValueDictionary()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>catalog = [Cheese(<span class="string">'Red Leicester'</span>), Cheese(<span class="string">'Tilsit'</span>), Cheese(<span class="string">'Brie'</span>), Cheese(<span class="string">'Parmesan'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> cheese <span class="keyword">in</span> catalog:  <span class="comment"># å¾ªçŽ¯ä¸­cheeseæ˜¯å…¨å±€å˜é‡ï¼Œå¾ªçŽ¯ç»“æŸåŽä¹Ÿä¸ä¼šæ¶ˆå¤±</span></span><br><span class="line"><span class="meta">... </span>    stock[cheese.kind] = cheese</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(stock.keys())  <span class="comment"># stockæ˜¯å®Œæ•´çš„</span></span><br><span class="line">[<span class="string">'Brie'</span>, <span class="string">'Parmesan'</span>, <span class="string">'Red Leicester'</span>, <span class="string">'Tilsit'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> catalog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(stock.keys())  <span class="comment"># ä¸ºä»€ä¹ˆä¼šå‰©ä¸‹ä¸€ä¸ª</span></span><br><span class="line">[<span class="string">'Parmesan'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> cheese  <span class="comment"># ä¸´æ—¶å˜é‡cheeseå¼•ç”¨äº†å¯¹è±¡ï¼Œå¯¼è‡´è¯¥å˜é‡å­˜åœ¨æ—¶é—´æ¯”é¢„æœŸé•¿</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(stock.keys())</span><br><span class="line">[]</span><br></pre></td></tr></table></figure><p>ä¸ŽWeakValueDictionaryå¯¹åº”çš„æ˜¯WeakKeyDictionaryï¼ŒåŽè€…çš„é”®æ˜¯å¼±å¼•ç”¨ã€‚WeakKeyDictionaryå®žä¾‹å¯ä»¥ä¸ºåº”ç”¨ä¸­å…¶ä»–éƒ¨åˆ†æ‹¥æœ‰çš„å¯¹è±¡é™„åŠ æ•°æ®ï¼Œè¿™æ ·å°±æ— éœ€ä¸ºå¯¹è±¡æ·»åŠ å±žæ€§ã€‚è¿™å¯¹è¦†ç›–å±žæ€§è®¿é—®æƒé™çš„å¯¹è±¡å°¤å…¶æœ‰ç”¨ã€‚WeakSetç±»ï¼šä¿å­˜å…ƒç´ å¼±å¼•ç”¨çš„é›†åˆç±»ã€‚å…ƒç´ æ²¡æœ‰å¼ºåº”ç”¨æ—¶ï¼Œé›†åˆä¼šæŠŠå®ƒåˆ é™¤ã€‚</p><h2 id="å¼±å¼•ç”¨çš„å±€é™">å¼±å¼•ç”¨çš„å±€é™</h2><p>ä¸æ˜¯æ¯ä¸ªPythonå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ï¼ˆæˆ–ç§°æ‰€æŒ‡å¯¹è±¡ï¼‰ã€‚åŸºæœ¬çš„listå’Œdictå®žä¾‹ä¸èƒ½ä½œä¸ºæ‰€æŒ‡å¯¹è±¡ï¼Œä½†æ˜¯ä»–ä»¬çš„å­ç±»å¯ä»¥è½»æ¾åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyList</span><span class="params">(list)</span>:</span></span><br><span class="line">    <span class="string">"""listçš„å­ç±»ï¼Œå®žä¾‹å¯ä»¥ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡"""</span></span><br><span class="line"></span><br><span class="line">a_list = MyList(range(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># a_listå¯ä»¥ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡</span></span><br><span class="line">wref_to_a_list = weakref.ref(a_list)</span><br></pre></td></tr></table></figure><p>setå®žä¾‹å¯ä»¥ä½œä¸ºæ‰€æŒ‡å¯¹è±¡ï¼ˆå› æ­¤å‰é¢çš„å®žä¾‹æ‰ä½¿ç”¨{0, 1}ï¼‰ï¼Œç”¨æˆ·å®šä¹‰çš„ç±»åž‹ä¹Ÿæ²¡é—®é¢˜ï¼ˆCheeseç±»ï¼‰ã€‚ä½†æ˜¯ï¼Œintå’Œtupleå®žä¾‹ä¸èƒ½ä½œä¸ºå¼±å¼•ç”¨çš„ç›®æ ‡ï¼Œç”šè‡³å®ƒä»¬çš„å­ç±»ä¹Ÿä¸è¡Œã€‚è¿™äº›å±€é™åŸºæœ¬ä¸Šæ˜¯CPythonçš„å®žçŽ°ç»†èŠ‚ï¼Œåœ¨å…¶ä»–Pythonè§£é‡Šå™¨ä¸­æƒ…å†µå¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™äº›å±€é™æ˜¯å†…éƒ¨ä¼˜åŒ–å¯¼è‡´çš„ç»“æžœã€‚</p><h1 id="pythonå¯¹ä¸å¯å˜ç±»åž‹æ–½åŠ çš„æŠŠæˆ">Pythonå¯¹ä¸å¯å˜ç±»åž‹æ–½åŠ çš„æŠŠæˆ</h1><p>å¯¹å…ƒç»„tæ¥è¯´ï¼Œt[:]ä¸åˆ›å»ºå‰¯æœ¬ï¼Œè€Œæ˜¯è¿”å›žåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚æ­¤å¤–ï¼Œtuple(t)èŽ·å¾—çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªå…ƒç»„çš„å¼•ç”¨ã€‚åœ¨PythonæŽ§åˆ¶å°ä¸­è¾“å…¥help(tuple)ï¼Œä½ ä¼šçœ‹åˆ°è¿™å¥è¯ï¼šâ€œIf the argument is a tuple, the return value is the same object.â€ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t2 = tuple(t1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t2 <span class="keyword">is</span> t1</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t3 = t1[:]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t3 <span class="keyword">is</span> t1</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>strã€byteså’Œfrozensetå®žä¾‹ä¹Ÿæœ‰è¿™ç§è¡Œä¸ºã€‚frozensetå®žä¾‹ä¸æ˜¯åºåˆ—ï¼Œä¸èƒ½ä½¿ç”¨fs[:]ï¼Œä½†æ˜¯fs.copy()å…·æœ‰ç›¸åŒçš„æ•ˆæžœï¼šå®ƒä¼šæ¬ºéª—ä½ ï¼Œè¿”å›žåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ã€‚copyæ–¹æ³•ä¸ä¼šå¤åˆ¶æ‰€æœ‰å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå–„æ„çš„è°Žè¨€ï¼Œä¸ºçš„æ˜¯æŽ¥å£çš„å…¼å®¹æ€§ï¼šè¿™ä½¿å¾—frozensetçš„å…¼å®¹æ€§æ¯”setå¼ºã€‚ä¸¤ä¸ªä¸å¯å˜å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡è¿˜æ˜¯å‰¯æœ¬ï¼Œå¯¹æœ€ç»ˆç”¨æˆ·æ¥è¯´æ²¡æœ‰åŒºåˆ«ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t3 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 <span class="keyword">is</span> t3  <span class="comment"># t1å’Œt3ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = <span class="string">'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="string">'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 <span class="keyword">is</span> s2  <span class="comment"># å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œs1å’Œs2æŒ‡ä»£åŒä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>å…±äº«å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸€ç§ä¼˜åŒ–æŽªæ–½ï¼Œç§°ä¸ºé©»ç•™ï¼ˆinterningï¼‰ã€‚CPythonè¿˜ä¼šåœ¨å°çš„æ•´æ•°ä¸Šä½¿ç”¨è¿™ä¸ªä¼˜åŒ–æŽªæ–½ï¼Œé˜²æ­¢é‡å¤åˆ›å»ºâ€œçƒ­é—¨â€æ•°å­—ã€‚æ³¨æ„ï¼ŒCPythonä¸ä¼šé©»ç•™æ‰€æœ‰å­—ç¬¦ä¸²å’Œæ•´æ•°ï¼Œé©»ç•™çš„æ¡ä»¶æ˜¯å®žçŽ°ç»†èŠ‚ï¼Œè€Œä¸”æ²¡æœ‰æ–‡æ¡£è¯´æ˜Žã€‚å› æ­¤ï¼Œåƒä¸‡ä¸è¦ä¾èµ–å­—ç¬¦ä¸²æˆ–æ•´æ•°çš„é©»ç•™ï¼æ¯”è¾ƒå­—ç¬¦ä¸²æˆ–æ•´æ•°æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œåº”è¯¥ä½¿ç”¨==ï¼Œè€Œä¸æ˜¯isã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡å‡†åº“ä¸­çš„è£…é¥°å™¨</title>
      <link href="/notes/fluent-python/decorators-in-standard-library/"/>
      <url>/notes/fluent-python/decorators-in-standard-library/</url>
      
        <content type="html"><![CDATA[<p>æ ‡å‡†åº“ä¸­æœ€å€¼å¾—å…³æ³¨çš„ä¸¤ä¸ªè£…é¥°å™¨æ˜¯lru_cacheå’Œå…¨æ–°çš„singledispatchï¼ˆPython3.4æ–°å¢žï¼‰ã€‚è¿™ä¸¤ä¸ªè£…é¥°å™¨éƒ½åœ¨functoolsæ¨¡å—ä¸­å®šä¹‰ã€‚</p><h1 id="ä½¿ç”¨lru_cacheåšå¤‡å¿˜">ä½¿ç”¨lru_cacheåšå¤‡å¿˜</h1><p>functools.lru_cacheå®žçŽ°äº†å¤‡å¿˜ï¼ˆmemoizationï¼‰åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€é¡¹ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒæŠŠè€—æ—¶çš„å‡½æ•°çš„ç»“æžœä¿å­˜èµ·æ¥ï¼Œé¿å…ä¼ å…¥ç›¸åŒçš„å‚æ•°æ—¶é‡å¤è®¡ç®—ã€‚LRUä¸‰ä¸ªå­—æ¯æ˜¯â€œLeast Recently Usedâ€çš„ç¼©å†™ï¼Œè¡¨æ˜Žç¼“å­˜ä¸ä¼šæ— é™åˆ¶å¢žé•¿ï¼Œä¸€æ®µæ—¶é—´ä¸ç”¨çš„ç¼“å­˜æ¡ç›®ä¼šè¢«æ‰”æŽ‰ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/functools#functools.lru_cache" target="_blank" rel="noopener"><code>@functools.lru_cache(maxsize=128, typed=False)</code></a></p><p>maxsizeå‚æ•°æŒ‡å®šå­˜å‚¨å¤šå°‘ä¸ªè°ƒç”¨çš„ç»“æžœã€‚ç¼“å­˜æ»¡äº†ä¹‹åŽï¼Œæ—§çš„ç»“æžœä¼šè¢«æ‰”æŽ‰ï¼Œè…¾å‡ºç©ºé—´ã€‚ä¸ºäº†å¾—åˆ°æœ€ä½³æ€§èƒ½ï¼Œmaxsizeåº”è¯¥è®¾ä¸º2çš„å¹‚ã€‚</p><p>Typedå‚æ•°å¦‚æžœè®¾ä¸ºTrueï¼ŒæŠŠä¸åŒç±»åž‹å‚æ•°å¾—åˆ°çš„ç»“æžœåˆ†å¼€ä¿å­˜ï¼Œå³æŠŠé€šå¸¸è®¤ä¸ºç›¸åŒçš„æµ®ç‚¹æ•°å’Œæ•´æ•°å‚æ•°ï¼ˆå¦‚1å’Œ1.0ï¼‰åŒºåˆ†å¼€ã€‚</p><p>lru_cacheä½¿ç”¨å­—å…¸å­˜å‚¨ç»“æžœï¼Œè€Œä¸”é”®æ ¹æ®è°ƒç”¨æ—¶ä¼ å…¥çš„å®šä½å‚æ•°å’Œå…³é”®å­—å‚æ•°åˆ›å»ºï¼Œæ‰€ä»¥è¢«lru_cacheè£…é¥°çš„å‡½æ•°ï¼Œå®ƒçš„æ‰€æœ‰å‚æ•°éƒ½å¿…é¡»æ˜¯å¯æ•£åˆ—çš„ã€‚</p></blockquote><a id="more"></a><p>ç”Ÿæˆç¬¬nä¸ªæ–æ³¢é‚£å¥‘è¿™ç§æ…¢é€Ÿé€’å½’å‡½æ•°é€‚åˆä½¿ç”¨lru_cacheã€‚</p><figure class="highlight python"><figcaption><span>clockdemo.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clock</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        t0 = time.time()</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        elapsed = time.time() - t0</span><br><span class="line">        name = func.__name__</span><br><span class="line">        arg_lst = []</span><br><span class="line">        <span class="keyword">if</span> args:</span><br><span class="line">            arg_lst.append(<span class="string">', '</span>.join(repr(arg) <span class="keyword">for</span> arg <span class="keyword">in</span> args))</span><br><span class="line">        <span class="keyword">if</span> kwargs:</span><br><span class="line">            pairs = [<span class="string">'%s=%r'</span> % (k, w) <span class="keyword">for</span> k, w <span class="keyword">in</span> sorted(kwargs.items())]</span><br><span class="line">            arg_lst.append(<span class="string">', '</span>.join(pairs))</span><br><span class="line">        arg_str = <span class="string">', '</span>.join(arg_lst)</span><br><span class="line">        print(<span class="string">'[%0.8fs] %s(%s) -&gt; %r '</span> % (elapsed, name, arg_str, result))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clocked</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> clockdemo <span class="keyword">import</span> clock</span><br><span class="line"></span><br><span class="line"><span class="meta">@clock</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">2</span>) + fibonacci(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(fibonacci(<span class="number">6</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[0.00000095s] fibonacci(0) -&gt; 0</span><br><span class="line">[0.00000095s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00005102s] fibonacci(2) -&gt; 1</span><br><span class="line">[0.00000072s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000000s] fibonacci(0) -&gt; 0</span><br><span class="line">[0.00000000s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000787s] fibonacci(2) -&gt; 1</span><br><span class="line">[0.00001478s] fibonacci(3) -&gt; 2</span><br><span class="line">[0.00007391s] fibonacci(4) -&gt; 3</span><br><span class="line">[0.00000000s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000000s] fibonacci(0) -&gt; 0</span><br><span class="line">[0.00000000s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000691s] fibonacci(2) -&gt; 1</span><br><span class="line">[0.00001407s] fibonacci(3) -&gt; 2</span><br><span class="line">[0.00000119s] fibonacci(0) -&gt; 0</span><br><span class="line">[0.00000000s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000691s] fibonacci(2) -&gt; 1</span><br><span class="line">[0.00000000s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000000s] fibonacci(0) -&gt; 0</span><br><span class="line">[0.00000095s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00000834s] fibonacci(2) -&gt; 1</span><br><span class="line">[0.00001383s] fibonacci(3) -&gt; 2</span><br><span class="line">[0.00002813s] fibonacci(4) -&gt; 3</span><br><span class="line">[0.00005007s] fibonacci(5) -&gt; 5</span><br><span class="line">[0.00013185s] fibonacci(6) -&gt; 8</span><br><span class="line">8</span><br></pre></td></tr></table></figure><p>æµªè´¹æ—¶é—´çš„åœ°æ–¹å¾ˆæ˜Žæ˜¾ï¼šfibonacci(1)è°ƒç”¨äº†8æ¬¡ï¼Œfibonacci(2)è°ƒç”¨äº†5æ¬¡â€¦â€¦ä¸‹é¢ä½¿ç”¨ç¼“å­˜å®žçŽ°ï¼Œé€Ÿåº¦æ›´å¿«ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> clockdemo <span class="keyword">import</span> clock</span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.lru_cache()  # å¿…é¡»åŠ æ‹¬å·ï¼Œå› ä¸ºlru_cacheå¯ä»¥æŽ¥å—é…ç½®å‚æ•°ï¼Œlru_cacheåº”ç”¨åˆ°clockè¿”å›žçš„å‡½æ•°ä¸Š</span></span><br><span class="line"><span class="meta">@clock</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">2</span>) + fibonacci(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(fibonacci(<span class="number">6</span>))</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶é—´å‡åŠäº†ï¼Œè€Œä¸”nçš„æ¯ä¸ªå€¼åªè°ƒç”¨ä¸€æ¬¡å‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[0.00000000s] fibonacci(0) -&gt; 0</span><br><span class="line">[0.00000119s] fibonacci(1) -&gt; 1</span><br><span class="line">[0.00004601s] fibonacci(2) -&gt; 1</span><br><span class="line">[0.00000119s] fibonacci(3) -&gt; 2</span><br><span class="line">[0.00005412s] fibonacci(4) -&gt; 3</span><br><span class="line">[0.00000000s] fibonacci(5) -&gt; 5</span><br><span class="line">[0.00006390s] fibonacci(6) -&gt; 8</span><br><span class="line">8</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¼˜åŒ–é€’å½’ç®—æ³•ä¹‹å¤–ï¼Œlru_cacheåœ¨ä»ŽWebä¸­èŽ·å–ä¿¡æ¯çš„åº”ç”¨ä¸­ä¹Ÿèƒ½å‘æŒ¥å·¨å¤§ä½œç”¨ã€‚</p><h1 id="å•åˆ†æ´¾æ³›å‡½æ•°">å•åˆ†æ´¾æ³›å‡½æ•°</h1><p>å‡è®¾æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªè°ƒè¯•Webåº”ç”¨çš„å·¥å…·ï¼Œæƒ³ç”ŸæˆHTMLï¼Œæ˜¾ç¤ºä¸åŒç±»åž‹çš„Pythonå¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">htmlize</span><span class="params">(obj)</span>:</span></span><br><span class="line">    content = html.escape(repr(obj))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;pre&gt;&#123;&#125;&lt;/pre&gt;'</span>.format(content)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°é€‚ç”¨äºŽä»»ä½•Pythonç±»åž‹ï¼Œä½†æ˜¯çŽ°åœ¨æƒ³åšä¸ªæ‰©å±•ï¼Œè®©å®ƒä½¿ç”¨ç‰¹åˆ«çš„æ–¹å¼æ˜¾ç¤ºæŸäº›ç±»åž‹ã€‚</p><ul><li>str: æŠŠå†…éƒ¨çš„æ¢è¡Œç¬¦æ›¿æ¢ä¸º'&lt;br&gt;\n'ï¼›ä¸ä½¿ç”¨&lt;pre&gt;ï¼Œè€Œæ˜¯ä½¿ç”¨&lt;p&gt;ã€‚</li><li>int: ä»¥åè¿›åˆ¶å’Œåå…­è¿›åˆ¶æ˜¾ç¤ºæ•°å­—ã€‚</li><li>list: è¾“å‡ºä¸€ä¸ªHTMLåˆ—è¡¨ï¼Œæ ¹æ®å„ä¸ªå…ƒç´ çš„ç±»åž‹è¿›è¡Œæ ¼å¼åŒ–ã€‚</li></ul><p>å› ä¸ºPythonä¸æ”¯æŒé‡è½½æ–¹æ³•æˆ–å‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ä¸åŒçš„ç­¾åå®šä¹‰htmlizeçš„å˜ä½“ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨ä¸åŒçš„æ–¹å¼å¤„ç†ä¸åŒçš„æ•°æ®ç±»åž‹ã€‚åœ¨Pythonä¸­ï¼Œä¸€ç§å¸¸è§çš„åšæ³•æ˜¯æŠŠhtmlizeå˜æˆä¸€ä¸ªåˆ†æ´¾å‡½æ•°ï¼Œä½¿ç”¨ä¸€ä¸²if/elif/elifï¼Œè°ƒç”¨ä¸“é—¨çš„å‡½æ•°ï¼Œå¦‚htmlize_strã€htmlize_intï¼Œç­‰ç­‰ã€‚è¿™æ ·ä¸ä¾¿äºŽæ¨¡å—çš„ç”¨æˆ·æ‰©å±•ï¼Œè¿˜æ˜¾å¾—ç¬¨æ‹™ï¼šæ—¶é—´ä¸€é•¿ï¼Œåˆ†æ´¾å‡½æ•°htmlizeä¼šå˜å¾—å¾ˆå¤§ï¼Œè€Œä¸”å®ƒä¸Žå„ä¸ªä¸“é—¨å‡½æ•°ä¹‹é—´çš„è€¦åˆä¹Ÿå¾ˆç´§å¯†ã€‚</p><p>Python3.4æ–°å¢žçš„functools.singledispatchè£…é¥°å™¨å¯ä»¥æŠŠæ•´ä½“æ–¹æ¡ˆæ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œç”šè‡³å¯ä»¥ä¸ºä½ æ— æ³•ä¿®æ”¹çš„ç±»æä¾›ä¸“é—¨çš„å‡½æ•°ã€‚ä½¿ç”¨@singledispatchè£…é¥°çš„æ™®é€šå‡½æ•°ä¼šå˜æˆæ³›å‡½æ•°ï¼ˆgeneric functionï¼‰ï¼šæ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»åž‹ï¼Œä»¥ä¸åŒæ–¹å¼æ‰§è¡Œç›¸åŒæ“ä½œçš„ä¸€ç»„å‡½æ•°ã€‚ï¼ˆè¿™æ‰ç§°å¾—ä¸Šæ˜¯å•åˆ†æ´¾ã€‚å¦‚æžœæ ¹æ®å¤šä¸ªå‚æ•°é€‰æ‹©ä¸“é—¨çš„å‡½æ•°ï¼Œé‚£å°±æ˜¯å¤šåˆ†æ´¾äº†ã€‚ï¼‰å…·ä½“åšæ³•å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line"><span class="meta">@singledispatch  # æ ‡è®°å¤„ç†objectå‡½æ•°çš„åŸºå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">htmlize</span><span class="params">(obj)</span>:</span></span><br><span class="line">    content = html.escape(repr(obj))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;pre&gt;&#123;&#125;&lt;/pre&gt;'</span>.format(content)</span><br><span class="line"></span><br><span class="line"><span class="meta">@htmlize.register(str)  # ä¸“é—¨å‡½æ•°ï¼Œå‡½æ•°åç§°æ— å…³ç´§è¦ï¼Œ_æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(text)</span>:</span></span><br><span class="line">    content = html.escape(text).replace(<span class="string">'\n'</span>, <span class="string">'&lt;br&gt;\n'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;p&gt;&#123;0&#125;&lt;/p&gt;'</span>.format(content)</span><br><span class="line"></span><br><span class="line"><span class="meta">@htmlize.register(numbers.Integral)  # numbers.Integralæ˜¯intçš„è™šæ‹Ÿè¶…ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;pre&gt;&#123;0&#125; (0x&#123;0:x&#125;)&lt;/pre&gt;'</span>.format(n)</span><br><span class="line"></span><br><span class="line"><span class="meta">@htmlize.register(tuple)  # å¯ä»¥å æ”¾å¤šä¸ªregisterè£…é¥°å™¨ï¼Œè®©åŒä¸€ä¸ªå‡½æ•°æ”¯æŒä¸åŒç±»åž‹</span></span><br><span class="line"><span class="meta">@htmlize.register(abc.MutableSequence)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(seq)</span>:</span></span><br><span class="line">    inner = <span class="string">'&lt;/li&gt;\n&lt;li&gt;'</span>.join(htmlize(item) <span class="keyword">for</span> item <span class="keyword">in</span> seq)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;ul&gt;\n&lt;li&gt;'</span> + inner + <span class="string">'&lt;/li&gt;\n&lt;/ul&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(repr(htmlize(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)), <span class="string">'\n'</span>)</span><br><span class="line">    print(repr(htmlize(abs)), <span class="string">'\n'</span>)</span><br><span class="line">    print(repr(htmlize(<span class="string">'Heimlich &amp; Co.\n- a game'</span>)), <span class="string">'\n'</span>)</span><br><span class="line">    print(repr(htmlize(<span class="number">42</span>)), <span class="string">'\n'</span>)</span><br><span class="line">    print(htmlize([<span class="string">'alpha'</span>, <span class="number">66</span>, &#123;<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>&#125;]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;&lt;pre&gt;&#123;1, 2, 3&#125;&lt;/pre&gt;&apos;</span><br><span class="line"></span><br><span class="line">&apos;&lt;pre&gt;&amp;lt;built-in function abs&amp;gt;&lt;/pre&gt;&apos;</span><br><span class="line"></span><br><span class="line">&apos;&lt;p&gt;Heimlich &amp;amp; Co.&lt;br&gt;\n- a game&lt;/p&gt;&apos;</span><br><span class="line"></span><br><span class="line">&apos;&lt;pre&gt;42 (0x2a)&lt;/pre&gt;&apos;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li&gt;&lt;p&gt;alpha&lt;/p&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;pre&gt;66 (0x42)&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;pre&gt;&#123;1, 2, 3&#125;&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure><p>åªè¦å¯èƒ½ï¼Œæ³¨å†Œçš„ä¸“é—¨å‡½æ•°åº”è¯¥å¤„ç†æŠ½è±¡åŸºç±»ï¼ˆå¦‚numbers.Integralå’Œabc.MutableSequenceï¼‰ï¼Œä¸è¦å¤„ç†å…·ä½“å®žçŽ°ç±»ï¼ˆå¦‚intå’Œlistï¼‰ã€‚è¿™æ ·ï¼Œä»£ç æ”¯æŒçš„å…¼å®¹ç±»åž‹æ›´å¹¿æ³›ã€‚</p><p>singledispatchæœºåˆ¶çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹å¾æ˜¯ï¼Œä½ å¯ä»¥åœ¨ç³»ç»Ÿçš„ä»»ä½•åœ°æ–¹å’Œä»»ä½•æ¨¡å—ä¸­æ³¨å†Œä¸“é—¨å‡½æ•°ã€‚å¦‚æžœåŽæ¥åœ¨æ–°çš„æ¨¡å—ä¸­å®šä¹‰äº†æ–°çš„ç±»åž‹ï¼Œå¯ä»¥è½»æ¾åœ°æ·»åŠ ä¸€ä¸ªæ–°çš„ä¸“é—¨å‡½æ•°ç”¨æ¥å¤„ç†é‚£ä¸ªç±»åž‹ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä¸ºä¸æ˜¯è‡ªå·±ç¼–å†™çš„æˆ–è€…ä¸èƒ½ä¿®æ”¹çš„ç±»æ·»åŠ è‡ªå®šä¹‰å‡½æ•°ã€‚</p><p>singledispatchæä¾›çš„ç‰¹æ€§å¾ˆå¤šï¼Œè¿™ä¸ªæœºåˆ¶æœ€å¥½çš„æ–‡æ¡£æ˜¯ <a href="https://www.python.org/dev/peps/pep-0443/" target="_blank" rel="noopener">PEP 443 â€”â€” Single-dispatch generic functions</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> decorators </tag>
            
            <tag> Fluent Python </tag>
            
            <tag> lru_cache </tag>
            
            <tag> singledispatch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®žçŽ°ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨</title>
      <link href="/notes/fluent-python/implementing-a-simple-decorator/"/>
      <url>/notes/fluent-python/implementing-a-simple-decorator/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ä¸ªç®€å•çš„clockè£…é¥°å™¨">ä¸€ä¸ªç®€å•çš„clockè£…é¥°å™¨</h1><p>å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°æ—¶è®¡æ—¶ï¼Œç„¶åŽæŠŠç»è¿‡çš„æ—¶é—´ã€ä¼ å…¥çš„å‚æ•°å’Œè°ƒç”¨çš„ç»“æžœæ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight python"><figcaption><span>clockdeco_demo.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clock</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span><span class="params">(*args)</span>:</span>  <span class="comment"># å®šä¹‰å†…éƒ¨å‡½æ•°clockedï¼Œå®ƒæŽ¥å—ä»»æ„ä¸ªå®šä½å‚æ•°</span></span><br><span class="line">        t0 = time.perf_counter()</span><br><span class="line">        result = func(*args)  <span class="comment"># funcæ˜¯è‡ªç”±å˜é‡</span></span><br><span class="line">        elapsed = time.perf_counter() - t0</span><br><span class="line">        name = func.__name__</span><br><span class="line">        arg_str = <span class="string">', '</span>.join(repr(arg) <span class="keyword">for</span> arg <span class="keyword">in</span> args)</span><br><span class="line">        print(<span class="string">'[%0.8fs] %s(%s) -&gt; %r'</span> % (elapsed, name, arg_str, result))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clocked  <span class="comment"># è¿”å›žå†…éƒ¨å‡½æ•°ï¼Œå–ä»£è¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@clock  # ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">snooze</span><span class="params">(seconds)</span>:</span></span><br><span class="line">    time.sleep(seconds)</span><br><span class="line"></span><br><span class="line"><span class="meta">@clock</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> n * factorial(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'*'</span> * <span class="number">40</span>, <span class="string">'Calling snooze(.123)'</span>)</span><br><span class="line">    snooze(<span class="number">.123</span>)</span><br><span class="line">    print(<span class="string">'*'</span> * <span class="number">40</span>, <span class="string">'Calling factorial(6)'</span>)</span><br><span class="line">    print(<span class="string">'6! ='</span>, factorial(<span class="number">6</span>))</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">**************************************** Calling snooze(.123)</span><br><span class="line">[0.12325113s] snooze(0.123) -&gt; None</span><br><span class="line">**************************************** Calling factorial(6)</span><br><span class="line">[0.00000078s] factorial(1) -&gt; 1</span><br><span class="line">[0.00003158s] factorial(2) -&gt; 2</span><br><span class="line">[0.00010166s] factorial(3) -&gt; 6</span><br><span class="line">[0.00043166s] factorial(4) -&gt; 24</span><br><span class="line">[0.00044242s] factorial(5) -&gt; 120</span><br><span class="line">[0.00045205s] factorial(6) -&gt; 720</span><br><span class="line">6! = 720</span><br></pre></td></tr></table></figure><h1 id="å·¥ä½œåŽŸç†">å·¥ä½œåŽŸç†</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@clock</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> n * factorial(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰ä»·äºŽ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> n * factorial(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">factorial = clock(factorial)</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œåœ¨ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œfactorialä¼šä½œä¸ºfuncå‚æ•°ä¼ ç»™clockã€‚ç„¶åŽï¼Œclockå‡½æ•°ä¼šè¿”å›žclockedå‡½æ•°ï¼ŒPythonè§£é‡Šå™¨åœ¨èƒŒåŽä¼šæŠŠclockedèµ‹å€¼ç»™factorialã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> clockdeco_demo  <span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>clockdeco_demo.factorial.__name__  <span class="comment"># factorialçš„__name__</span></span><br><span class="line"><span class="string">'clocked'</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼ŒçŽ°åœ¨factorialä¿å­˜çš„æ˜¯clockedå‡½æ•°çš„å¼•ç”¨ã€‚è‡ªæ­¤ä¹‹åŽï¼Œæ¯æ¬¡è°ƒç”¨factorial(n)ï¼Œæ‰§è¡Œçš„éƒ½æ˜¯clocked(n)ã€‚è¿™æ˜¯è£…é¥°å™¨çš„å…¸åž‹è¡Œä¸ºï¼šæŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æˆæ–°å‡½æ•°ï¼ŒäºŒè€…æŽ¥å—ç›¸åŒçš„å‚æ•°ï¼Œè€Œä¸”ï¼ˆé€šå¸¸ï¼‰è¿”å›žè¢«è£…é¥°çš„å‡½æ•°æœ¬è¯¥è¿”å›žçš„å€¼ï¼ŒåŒæ—¶è¿˜ä¼šåšäº›é¢å¤–æ“ä½œã€‚</p><p><em>Gammaç­‰äººå†™çš„ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦æ˜¯è¿™æ ·æ¦‚è¿°è£…é¥°å™¨æ¨¡å¼çš„ï¼šâ€œåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚â€å‡½æ•°è£…é¥°å™¨ç¬¦åˆè¿™ä¸€è¯´æ³•ï¼Œä½†æ˜¯ï¼Œåœ¨å®žçŽ°å±‚é¢ï¼ŒPythonè£…é¥°å™¨ä¸ŽGoFæ‰€è¿°çš„è£…é¥°å™¨æ²¡æœ‰å¤šå°‘ç›¸ä¼¼ä¹‹å¤„ã€‚</em></p><p>ä¸Šä¾‹å®žçŽ°çš„clockè£…é¥°å™¨æœ‰å‡ ä¸ªç¼ºç‚¹ï¼šä¸æ”¯æŒå…³é”®å­—å‚æ•°ï¼Œè€Œä¸”é®ç›–äº†è¢«è£…é¥°å‡½æ•°çš„<code>__name__</code>å’Œ<code>__doc__</code>å±žæ€§ï¼Œä¸‹é¢ä½¿ç”¨functools.wrapsè£…é¥°å™¨æŠŠç›¸å…³çš„å±žæ€§ä»Žfuncå¤åˆ¶åˆ°clockedä¸­ã€‚æ­¤å¤–ï¼Œè¿˜èƒ½æ­£ç¡®å¤„ç†å…³é”®å­—å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clock</span><span class="params">(func)</span>:</span>  <span class="comment"># æ–°ç‰ˆclock</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)  # æ ‡å‡†åº“ä¸­çš„è£…é¥°å™¨ä¹‹ä¸€</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clocked</span><span class="params">(*args, **kwargs)</span>:</span>  <span class="comment"># æŽ¥å—å®šä½å’Œå…³é”®å­—å‚æ•°</span></span><br><span class="line">        t0 = time.time()</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        elapsed = time.time() - t0</span><br><span class="line">        name = func.__name__</span><br><span class="line">        arg_lst = []</span><br><span class="line">        <span class="keyword">if</span> args:</span><br><span class="line">            arg_lst.append(<span class="string">', '</span>.join(repr(arg) <span class="keyword">for</span> arg <span class="keyword">in</span> args))</span><br><span class="line">        <span class="keyword">if</span> kwargs:</span><br><span class="line">            pairs = [<span class="string">'%s=%r'</span> % (k, w) <span class="keyword">for</span> k, w <span class="keyword">in</span> sorted(kwargs.items())]</span><br><span class="line">            arg_lst.append(<span class="string">', '</span>.join(pairs))</span><br><span class="line">        arg_str = <span class="string">', '</span>.join(arg_lst)</span><br><span class="line">        print(<span class="string">'[%0.8fs] %s(%s) -&gt; %r '</span> % (elapsed, name, arg_str, result))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> clocked</span><br><span class="line"></span><br><span class="line"><span class="meta">@clock</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> n * factorial(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:  <span class="comment"># æµ‹è¯•</span></span><br><span class="line">    print(<span class="string">'6! ='</span>, factorial(n=<span class="number">6</span>))</span><br><span class="line">    print(factorial.__name__)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[0.00000000s] factorial(1) -&gt; 1</span><br><span class="line">[0.00003505s] factorial(2) -&gt; 2</span><br><span class="line">[0.00014687s] factorial(3) -&gt; 6</span><br><span class="line">[0.00014997s] factorial(4) -&gt; 24</span><br><span class="line">[0.00015521s] factorial(5) -&gt; 120  # é€’å½’æ˜¯é€šè¿‡å®šä½ä¼ å…¥çš„</span><br><span class="line">[0.00015807s] factorial(n=6) -&gt; 720  # æœ€å¤–å±‚æ˜¯é€šè¿‡å…³é”®è¯ä¼ å…¥çš„</span><br><span class="line">6! = 720</span><br><span class="line">factorial  # å‡½æ•°çš„__name__å±žæ€§ä¹Ÿè¢«å¤åˆ¶è¿‡æ¥äº†</span><br></pre></td></tr></table></figure><h1 id="å æ”¾è£…é¥°å™¨">å æ”¾è£…é¥°å™¨</h1><p>æŠŠ <span class="citation" data-cites="d1">@d1</span> å’Œ <span class="citation" data-cites="d2">@d2</span> ä¸¤ä¸ªè£…é¥°å™¨æŒ‰é¡ºåºåº”ç”¨åˆ° f å‡½æ•°ä¸Šï¼Œä½œç”¨ç›¸å½“äºŽ <code>f = d1(d2(f)</code>)ã€‚åœ¨<a href="/notes/fluent-python/decorators-in-standard-library/" title="æ ‡å‡†åº“ä¸­çš„å‡½æ•°">æ ‡å‡†åº“ä¸­çš„å‡½æ•°</a>ä¸€èŠ‚ä¸­ä½¿ç”¨è¿‡è¯¥æŠ€å·§ï¼š<span class="citation" data-cites="lru_cache">@lru_cache</span> åº”ç”¨åˆ° <span class="citation" data-cites="clock">@clock</span> è£…é¥° fibonacci å¾—åˆ°çš„ç»“æžœä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@d1</span></span><br><span class="line"><span class="meta">@d2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰ä»·äºŽ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line">f = d1(d2(f))</span><br></pre></td></tr></table></figure><h1 id="å‚æ•°åŒ–è£…é¥°å™¨">å‚æ•°åŒ–è£…é¥°å™¨</h1><p>è§£æžæºç ä¸­çš„è£…é¥°å™¨æ—¶ï¼ŒPythonæŠŠè¢«è£…é¥°çš„å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ ç»™è£…é¥°å™¨å‡½æ•°ã€‚é‚£æ€Žä¹ˆè®©è£…é¥°å™¨æŽ¥å—å…¶ä»–å‚æ•°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šåˆ›å»ºä¸€ä¸ªè£…é¥°å™¨å·¥åŽ‚å‡½æ•°ï¼ŒæŠŠå‚æ•°ä¼ ç»™å®ƒï¼Œè¿”å›žä¸€ä¸ªè£…é¥°å™¨ï¼Œç„¶åŽå†æŠŠå®ƒåº”ç”¨åˆ°è¦è£…é¥°çš„å‡½æ•°ä¸Šã€‚ä¾‹å¦‚ä¸‹é¢çš„è£…é¥°å™¨ã€‚</p><figure class="highlight python"><figcaption><span>registration.py</span></figcaption><table><tr><td class="code"><pre><span class="line">registry = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'running register(%s)'</span> % func)</span><br><span class="line">    registry.append(func)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line"><span class="meta">@register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f1()'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'running main()'</span>)</span><br><span class="line">print(<span class="string">'registry -&gt;'</span>, registry)</span><br><span class="line">f1()</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä¾¿äºŽå¯ç”¨æˆ–ç¦ç”¨registeræ‰§è¡Œçš„å‡½æ•°æ³¨å†ŒåŠŸèƒ½ï¼Œä¸ºå®ƒæä¾›ä¸€ä¸ªå¯é€‰çš„activeå‚æ•°ï¼Œè®¾ä¸ºFalseæ—¶ï¼Œä¸æ³¨å†Œè¢«è£…é¥°çš„å‡½æ•°ã€‚</p><figure class="highlight python"><figcaption><span>registration_param.py</span></figcaption><table><tr><td class="code"><pre><span class="line">registry = set()  <span class="comment"># ä¾¿äºŽæ·»åŠ å’Œåˆ é™¤å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(active=True)</span>:</span>  <span class="comment"># æŽ¥å—ä¸€ä¸ªå¯é€‰çš„å…³é”®å­—å‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span>  <span class="comment"># çœŸæ­£çš„è£…é¥°å™¨ï¼Œå…¶å‚æ•°æ˜¯å‡½æ•°</span></span><br><span class="line">        print(<span class="string">'running register(active=%s)-&gt;decorate(%s)'</span> % (active, func))</span><br><span class="line">        <span class="keyword">if</span> active:</span><br><span class="line">            registry.add(func)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            registry.discard(func)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> func  <span class="comment"># è¿”å›žä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorate  <span class="comment"># registeræ—¶è£…é¥°å™¨å·¥åŽ‚å‡½æ•°ï¼Œå› æ­¤è¿”å›ždecorate</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@register(active=False)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f1()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@register()  # å³ä½¿ä¸ä¼ å…¥å‚æ•°ï¼Œä¹Ÿå¿…é¡»ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼ˆ@register()ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f2()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f3()'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> registration_param <span class="keyword">import</span> *  <span class="comment"># å¯¼å…¥</span></span><br><span class="line">running register(active=False)-&gt;decorate(&lt;function f1 at 0x109fd0bf8&gt;)</span><br><span class="line">running register(active=True)-&gt;decorate(&lt;function f2 at 0x109fd0c80&gt;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>registry</span><br><span class="line">&#123;&lt;function f2 at <span class="number">0x109fd0c80</span>&gt;&#125;  <span class="comment"># åªæœ‰f2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register()(f3)  <span class="comment"># register()è¿”å›ždecoratroï¼Œç„¶åŽåº”ç”¨åˆ°f3ä¸Š</span></span><br><span class="line">running register(active=True)-&gt;decorate(&lt;function f3 at 0x109fd0b70&gt;)</span><br><span class="line">&lt;function f3 at <span class="number">0x109fd0b70</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>registry</span><br><span class="line">&#123;&lt;function f2 at <span class="number">0x109fd0c80</span>&gt;, &lt;function f3 at <span class="number">0x109fd0b70</span>&gt;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>register(active=<span class="literal">False</span>)(f2)  <span class="comment"># åˆ é™¤f2</span></span><br><span class="line">running register(active=False)-&gt;decorate(&lt;function f2 at 0x109fd0c80&gt;)</span><br><span class="line">&lt;function f2 at <span class="number">0x109fd0c80</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>registry</span><br><span class="line">&#123;&lt;function f3 at <span class="number">0x109fd0b70</span>&gt;&#125;</span><br></pre></td></tr></table></figure><p>å‚æ•°åŒ–è£…é¥°å™¨çš„è¿œç¦»ç›¸å½“å¤æ‚ï¼Œåˆšåˆšè®¨è®ºçš„æ¯”å¤§å¤šæ•°éƒ½ç®€å•ã€‚å‚æ•°åŒ–è£…é¥°å™¨é€šå¸¸ä¼šæŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æŽ‰ï¼Œè€Œä¸”ç»“æž„ä¸Šéœ€è¦å¤šä¸€å±‚åµŒå¥—ã€‚æŽ¥ä¸‹æ¥ä¼šæŽ¢è®¨è¿™ç§å‡½æ•°é‡‘å­—å¡”ã€‚</p><h1 id="å‚æ•°åŒ–clockè£…é¥°å™¨">å‚æ•°åŒ–clockè£…é¥°å™¨</h1><p>ä¸ºclockè£…é¥°å™¨æ·»åŠ ä¸€ä¸ªåŠŸèƒ½ï¼šè®©ç”¨æˆ·ä¼ å…¥ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ï¼ŒæŽ§åˆ¶è¢«è£…é¥°å‡½æ•°çš„è¾“å‡ºã€‚</p><figure class="highlight python"><figcaption><span>clockdeco_param.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">DEFAULT_FMT = <span class="string">'[&#123;elapsed:0.8f&#125;s] &#123;name&#125;(&#123;args&#125;) -&gt; &#123;result&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clock</span><span class="params">(fmt=DEFAULT_FMT)</span>:</span>  <span class="comment"># è£…é¥°å™¨å·¥åŽ‚å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span>  <span class="comment"># çœŸæ­£çš„è£…é¥°å™¨</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">clocked</span><span class="params">(*_args)</span>:</span>  <span class="comment"># åŒ…è£…è¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line">            t0 = time.time()</span><br><span class="line">            _result = func(*_args)  <span class="comment"># è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line">            elapsed = time.time() - t0</span><br><span class="line">            name = func.__name__</span><br><span class="line">            args = <span class="string">', '</span>.join(repr(arg) <span class="keyword">for</span> arg <span class="keyword">in</span> _args)</span><br><span class="line">            result = repr(_result)</span><br><span class="line">            print(fmt.format(**locals()))  <span class="comment"># å¼•ç”¨clockçš„å±€éƒ¨å˜é‡</span></span><br><span class="line">            <span class="keyword">return</span> _result  <span class="comment"># è¿”å›žè¢«è£…é¥°å‡½æ•°è¿”å›žçš„å€¼</span></span><br><span class="line">        <span class="keyword">return</span> clocked</span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line"><span class="meta">    @clock()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">snooze</span><span class="params">(seconds)</span>:</span></span><br><span class="line">        time.sleep(seconds)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @clock('&#123;name&#125;: &#123;elapsed&#125;s')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">snooze1</span><span class="params">(seconds)</span>:</span></span><br><span class="line">        time.sleep(seconds)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @clock('&#123;name&#125;(&#123;args&#125;) dt=&#123;elapsed:0.3f&#125;s')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">snooze2</span><span class="params">(seconds)</span>:</span></span><br><span class="line">        time.sleep(seconds)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> func <span class="keyword">in</span> [snooze, snooze1, snooze2]:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            func(<span class="number">.123</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[0.12812114s] snooze(0.123) -&gt; None</span><br><span class="line">[0.12493706s] snooze(0.123) -&gt; None</span><br><span class="line">[0.12483931s] snooze(0.123) -&gt; None</span><br><span class="line">snooze1: 0.12311005592346191s</span><br><span class="line">snooze1: 0.12802791595458984s</span><br><span class="line">snooze1: 0.12346792221069336s</span><br><span class="line">snooze2(0.123) dt=0.124s</span><br><span class="line">snooze2(0.123) dt=0.123s</span><br><span class="line">snooze2(0.123) dt=0.124s</span><br></pre></td></tr></table></figure><p><em>Graham Dumpletonå’ŒLennart Regebroï¼ˆFluent Pythonä¸€ä¹¦çš„æŠ€æœ¯å®¡æ ¡ä¹‹ä¸€ï¼‰è®¤ä¸ºï¼Œè£…é¥°å™¨æœ€å¥½é€šè¿‡å®žçŽ°<code>__call__</code>æ–¹æ³•çš„ç±»å®žçŽ°ï¼Œä¸åº”è¯¥é€šè¿‡å‡½æ•°å®žçŽ°ã€‚</em></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> decorators </tag>
            
            <tag> Fluent Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‡½æ•°è£…é¥°å™¨å’Œé—­åŒ…</title>
      <link href="/notes/fluent-python/function-decorators-and-closures/"/>
      <url>/notes/fluent-python/function-decorators-and-closures/</url>
      
        <content type="html"><![CDATA[<p>å‡½æ•°è£…é¥°å™¨ç”¨äºŽåœ¨æºç ä¸­â€œæ ‡è®°â€å‡½æ•°ï¼Œä»¥æŸç§æ–¹å¼å¢žå¼ºå‡½æ•°çš„è¡Œä¸ºã€‚è¿™æ˜¯ä¸€é¡¹å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†æ˜¯è‹¥æƒ³æŽŒæ¡ï¼Œå¿…é¡»ç†è§£é—­åŒ…ã€‚é™¤äº†åœ¨è£…é¥°å™¨ä¸­æœ‰ç”¨å¤„ä¹‹å¤–ï¼Œé—­åŒ…è¿˜æ˜¯å›žè°ƒå¼å¼‚æ­¥ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹é£Žæ ¼çš„åŸºç¡€ã€‚</p><h1 id="è£…é¥°å™¨åŸºç¡€çŸ¥è¯†">è£…é¥°å™¨åŸºç¡€çŸ¥è¯†</h1><p>è£…é¥°å™¨æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œå…¶å‚æ•°æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼ˆè¢«è£…é¥°çš„å‡½æ•°ï¼‰ã€‚è£…é¥°å™¨å¯èƒ½ä¼šå¤„ç†è¢«è£…é¥°çš„å‡½æ•°ï¼Œç„¶åŽæŠŠå®ƒè¿”å›žï¼Œæˆ–è€…å°†å…¶æ›¿æ¢æˆå¦ä¸€ä¸ªå‡½æ•°æˆ–å¯è°ƒç”¨å¯¹è±¡ã€‚</p><p>å‡å¦‚æœ‰ä¸ªåä¸ºdecorateçš„è£…é¥°å™¨ï¼Œä¸‹è¿°ä¸¤ç§å†™æ³•çš„æ•ˆæžœä¸€æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å†™æ³•1</span></span><br><span class="line"><span class="meta">@decorate</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">target</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running target()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™æ³•2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">target</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running target()'</span>)</span><br><span class="line"></span><br><span class="line">target = decorate(target)</span><br></pre></td></tr></table></figure><a id="more"></a><p>ä¸¤ä¸ªä»£ç ç‰‡æ®µæ‰§è¡Œå®Œæ¯•åŽå¾—åˆ°çš„æ˜¯decorate(target)è¿”å›žçš„å‡½æ•°ã€‚ä¸ºäº†ç¡®è®¤è¢«è£…é¥°çš„å‡½æ•°ä¼šè¢«æ›¿æ¢ï¼Œçœ‹ä¸€ä¸ªå®žä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">deco</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>        print(<span class="string">'running inner()'</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> inner  <span class="comment"># è¿”å›žinnerå‡½æ•°</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@deco  <span class="comment"># ä½¿ç”¨decoè£…é¥°targetå‡½æ•°</span></span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">target</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">'running target()'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>target()</span><br><span class="line">running inner()  <span class="comment"># è¢«è£…é¥°çš„targetå‡½æ•°å…¶å®žä¼šè¿è¡Œinner</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>target  <span class="comment"># å®¡æŸ¥å¯¹è±¡ï¼ŒtargetçŽ°åœ¨æ˜¯innerçš„å¼•ç”¨</span></span><br><span class="line">&lt;function deco.&lt;locals&gt;.inner at <span class="number">0x106580d08</span>&gt;</span><br></pre></td></tr></table></figure><p>è£…é¥°å™¨å¯ä»¥åƒå¸¸è§„çš„å¯è°ƒç”¨å¯¹è±¡é‚£æ ·è°ƒç”¨ï¼Œå…¶å‚æ•°æ˜¯å¦ä¸€ä¸ªå‡½æ•°ã€‚æœ‰æ—¶ï¼Œè¿™æ ·åšæ›´æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯åšå…ƒç¼–ç¨‹ï¼ˆåœ¨è¿è¡Œæ—¶æ”¹å˜ç¨‹åºçš„è¡Œä¸ºï¼‰æ—¶ã€‚</p><ul><li>è£…é¥°å™¨çš„ä¸€å¤§ç‰¹æ€§æ˜¯ï¼Œèƒ½æŠŠè¢«è£…é¥°çš„å‡½æ•°æ›¿æ¢æˆå…¶ä»–å‡½æ•°ã€‚</li><li>ç¬¬äºŒä¸ªç‰¹æ€§æ˜¯ï¼Œè£…é¥°å™¨åœ¨åŠ è½½æ¨¡å—æ—¶ç«‹å³æ‰§è¡Œã€‚</li></ul><h1 id="pythonä½•æ—¶æ‰§è¡Œè£…é¥°å™¨">Pythonä½•æ—¶æ‰§è¡Œè£…é¥°å™¨</h1><p>è£…é¥°å™¨çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯ï¼Œå®ƒä»¬åœ¨è¢«è£…é¥°çš„å‡½æ•°å®šä¹‰ä¹‹åŽç«‹å³è¿è¡Œã€‚è¿™é€šå¸¸æ˜¯åœ¨å¯¼å…¥æ—¶ï¼ˆå³PythonåŠ è½½æ¨¡å—æ—¶ï¼‰ã€‚</p><figure class="highlight python"><figcaption><span>registration.py</span></figcaption><table><tr><td class="code"><pre><span class="line">registry = []  <span class="comment"># ä¿å­˜è¢«@registerè£…é¥°çš„å‡½æ•°å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(func)</span>:</span>  <span class="comment"># å‚æ•°æ˜¯å‡½æ•°</span></span><br><span class="line">    print(<span class="string">'running register(%s'</span> % func)  <span class="comment"># ä¸ºäº†æ¼”ç¤ºï¼Œæ˜¾ç¤ºè¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line">    registry.append(func)  <span class="comment"># å­˜å…¥è¢«è£…é¥°çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> func  <span class="comment"># è¿”å›žå€¼æ˜¯å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">     print(<span class="string">'running f1()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running f2()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span>  <span class="comment"># f1å’Œf2è¢«è£…é¥°ï¼Œf3æ²¡æœ‰è£…é¥°</span></span><br><span class="line">    print(<span class="string">'running f3()'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running main()'</span>)</span><br><span class="line">    print(<span class="string">'registry -&gt;'</span>, registry)</span><br><span class="line">    f1()</span><br><span class="line">    f2()</span><br><span class="line">    f3()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()  <span class="comment"># ä½œä¸ºè„šæœ¬è¿è¡Œæ—¶æ‰è°ƒç”¨main()</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ python registration.py  <span class="comment"># æŠŠregistration.pyå½“ä½œè„šæœ¬è¿è¡Œæ—¶</span></span><br><span class="line">running register(&lt;function f1 at <span class="number">0x10a8e46a8</span>&gt;</span><br><span class="line">running register(&lt;function f2 at <span class="number">0x10a8e4730</span>&gt;</span><br><span class="line">running main()</span><br><span class="line">registry -&gt; [&lt;function f1 at 0x10a8e46a8&gt;, &lt;function f2 at 0x10a8e4730&gt;]</span><br><span class="line">running f1()</span><br><span class="line">running f2()</span><br><span class="line">running f3()</span><br><span class="line"></span><br><span class="line">$ python  <span class="comment"># è¿è¡Œpythonè§£é‡Šå™¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> registration  <span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line">running register(&lt;function f1 at <span class="number">0x10e893b70</span>&gt;</span><br><span class="line">running register(&lt;function f2 at <span class="number">0x10e893bf8</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>registration.registry  <span class="comment"># æŸ¥çœ‹registryçš„å€¼</span></span><br><span class="line">[&lt;function f1 at <span class="number">0x10e893b70</span>&gt;, &lt;function f2 at <span class="number">0x10e893bf8</span>&gt;]</span><br></pre></td></tr></table></figure><p>ä¸Šä¾‹ä¸»è¦æƒ³å¼ºè°ƒï¼Œå‡½æ•°è£…é¥°å™¨åœ¨å¯¼å…¥æ¨¡å—æ—¶ç«‹å³æ‰§è¡Œï¼ˆregisterè¿è¡Œäº†ä¸¤æ¬¡ï¼Œåˆ†åˆ«è£…é¥°äº†f1å’Œf2ï¼‰ï¼Œè€Œè¢«è£…é¥°çš„å‡½æ•°åªæœ‰åœ¨æ˜Žç¡®è°ƒç”¨æ—¶è¿è¡Œã€‚è¿™çªå‡ºäº†å¯¼å…¥æ—¶å’Œè¿è¡Œæ—¶ä¹‹é—´çš„åŒºåˆ«ã€‚</p><p>è€ƒè™‘åˆ°è£…é¥°å™¨åœ¨çœŸå®žä»£ç ä¸­çš„å¸¸ç”¨æ–¹å¼ï¼Œä¸Šä¾‹æœ‰ä¸¤ä¸ªä¸å¯»å¸¸çš„åœ°æ–¹ã€‚</p><ul><li>è£…é¥°å™¨å‡½æ•°ä¸Žè¢«è£…é¥°çš„å‡½æ•°åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰ã€‚å®žé™…æƒ…å†µæ˜¯ï¼Œè£…é¥°å™¨é€šå¸¸åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰ï¼Œç„¶åŽåº”ç”¨åˆ°å…¶ä»–æ¨¡å—ä¸­çš„å‡½æ•°ä¸Šã€‚</li><li>registerè£…é¥°å™¨è¿”å›žçš„å‡½æ•°ä¸Žé€šè¿‡å‚æ•°ä¼ å…¥çš„å‡½æ•°ç›¸åŒã€‚å®žé™…ä¸Šï¼Œå¤§å¤šæ•°è£…é¥°å™¨ä¼šåœ¨å†…éƒ¨å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åŽå°†å…¶è¿”å›žã€‚</li></ul><p>è™½ç„¶registerè£…é¥°å™¨åŽŸå°ä¸åŠ¨åœ°è¿”å›žè¢«è£…é¥°çš„å‡½æ•°ï¼Œåˆ°é‚£æ—¶è¿™ç§æŠ€æœ¯å¹¶éžæ²¡æœ‰ç”¨å¤„ã€‚å¾ˆå¤šPython Webæ¡†æž¶ä½¿ç”¨è¿™æ ·çš„è£…é¥°å™¨æŠŠå‡½æ•°æ·»åŠ åˆ°æŸç§ä¸­å¤®æ³¨å†Œå¤„ï¼Œä¾‹å¦‚æŠŠURLæ¨¡å¼æ˜ å°„åˆ°ç”ŸæˆHTTPå“åº”çš„å‡½æ•°ä¸Šçš„æ³¨å†Œå¤„ã€‚è¿™ç§æ³¨å†Œè£…é¥°å™¨å¯èƒ½ä¼šä¹Ÿå¯èƒ½ä¸ä¼šä¿®æ”¹è¢«è£…é¥°çš„å‡½æ•°ã€‚</p><h1 id="ä½¿ç”¨è£…é¥°å™¨æ”¹è¿›ç­–ç•¥æ¨¡å¼">ä½¿ç”¨è£…é¥°å™¨æ”¹è¿›ç­–ç•¥æ¨¡å¼</h1><p>å›žé¡¾ï¼Œæ”¯æŒ<a href="/notes/fluent-python/design-patterns-with-first-class-functions/" title="é€‰æ‹©æœ€ä½³ç­–ç•¥">é€‰æ‹©æœ€ä½³ç­–ç•¥</a>çš„ç®€å•æ–¹æ¡ˆï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fidelity_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> order.total() * <span class="number">.05</span> <span class="keyword">if</span> order.customer.fidelity &gt;= <span class="number">1000</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bulk_item_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£"""</span></span><br><span class="line">    discount = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> order.cart:</span><br><span class="line">        <span class="keyword">if</span> item.quantity &gt;= <span class="number">20</span>:</span><br><span class="line">            discount += item.total() * <span class="number">.1</span></span><br><span class="line">    <span class="keyword">return</span> discount</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">large_order_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£"""</span></span><br><span class="line">    distinct_items = &#123;item.product <span class="keyword">for</span> item <span class="keyword">in</span> order.cart&#125;</span><br><span class="line">    <span class="keyword">if</span> len(distinct_items) &gt;= <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> order.total() * <span class="number">.07</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">promos = [fidelity_promo, bulk_item_promo, large_order_promo]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">best_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> max(promo(order) <span class="keyword">for</span> promo <span class="keyword">in</span> promos)  <span class="comment"># è¿”å›žæŠ˜æ‰£é¢åº¦æœ€å¤§çš„é‚£ä¸ª</span></span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ¡ˆçš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œå®šä¹‰ä½“ä¸­æœ‰å‡½æ•°çš„åç§°ï¼Œä½†æ˜¯best_promoç”¨æ¥åˆ¤æ–­å“ªä¸ªæŠ˜æ‰£å¹…åº¦æœ€å¤§çš„promosåˆ—è¡¨ä¸­ä¹Ÿæœ‰å‡½æ•°åç§°ã€‚è¿™ç§é‡å¤æ˜¯ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ–°å¢žç­–ç•¥å‡½æ•°åŽå¯èƒ½ä¼šå¿˜è®°æŠŠå®ƒæ·»åŠ åˆ°promosåˆ—è¡¨ä¸­ï¼Œå¯¼è‡´best_promoå¿½ç•¥æ–°ç­–ç•¥ï¼Œè€Œä¸æŠ¥é”™ï¼Œä¸ºç³»ç»Ÿå¼•å…¥äº†ä¸æ˜“å¯Ÿè§‰çš„ç¼ºé™·ã€‚ä¸‹é¢ä½¿ç”¨æ³¨å†Œè£…é¥°å™¨è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">promos = []  <span class="comment"># åˆ—è¡¨èµ·åˆæ˜¯ç©ºçš„</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">promotion</span><span class="params">(promo_func)</span>:</span></span><br><span class="line">    promos.append(promo_func)  <span class="comment"># æ·»åŠ åˆ°promosåˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> promo_func  <span class="comment"># åŽŸå°ä¸åŠ¨è¿”å›ž</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@promotion  # è£…é¥°ç­–ç•¥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fidelity_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> order.total() * <span class="number">.05</span> <span class="keyword">if</span> order.customer.fidelity &gt;= <span class="number">1000</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@promotion</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bulk_item_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£"""</span></span><br><span class="line">    discount = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> order.cart:</span><br><span class="line">        <span class="keyword">if</span> item.quantity &gt;= <span class="number">20</span>:</span><br><span class="line">            discount += item.total() * <span class="number">.1</span></span><br><span class="line">    <span class="keyword">return</span> discount</span><br><span class="line"></span><br><span class="line"><span class="meta">@promotion</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">large_order_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£"""</span></span><br><span class="line">    distinct_items = &#123;item.product <span class="keyword">for</span> item <span class="keyword">in</span> order.cart&#125;</span><br><span class="line">    <span class="keyword">if</span> len(distinct_items) &gt;= <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> order.total() * <span class="number">.07</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">best_promo</span><span class="params">(order)</span>:</span>  <span class="comment"># ä¸å˜</span></span><br><span class="line">    <span class="string">"""é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> max(promo(order) <span class="keyword">for</span> promo <span class="keyword">in</span> promos)</span><br></pre></td></tr></table></figure><p>ä¸Žä½¿ç”¨globals()æˆ–ç”¨insepectæ‰¾å‡ºå…¨éƒ¨ç­–ç•¥çš„æ–¹æ¡ˆç›¸æ¯”ï¼Œä½¿ç”¨è£…é¥°å™¨æœ‰å‡ ä¸ªä¼˜ç‚¹ã€‚</p><ul><li>ä¿ƒé”€ç­–ç•¥å‡½æ•°æ— é¡»ä½¿ç”¨ç‰¹æ®Šçš„åç§°ï¼ˆå³ä¸ç”¨ä»¥_promoç»“å°¾ï¼‰ã€‚</li><li><span class="citation" data-cites="promotionè£…é¥°å™¨çªå‡ºäº†è¢«è£…é¥°çš„å‡½æ•°çš„ä½œç”¨">@promotionè£…é¥°å™¨çªå‡ºäº†è¢«è£…é¥°çš„å‡½æ•°çš„ä½œç”¨</span>ï¼Œè¿˜ä¾¿äºŽä¸´æ—¶ç¦ç”¨æŸä¸ªä¿ƒé”€ç­–ç•¥ï¼šåªéœ€æŠŠè£…é¥°å™¨æ³¨é‡ŠæŽ‰ã€‚</li><li>ä¿ƒé”€æŠ˜æ‰£ç­–ç•¥å¯ä»¥åœ¨å…¶ä»–æ¨¡å—ä¸­å®šä¹‰ï¼Œåœ¨ç³»ç»Ÿä¸­çš„ä»»ä½•åœ°æ–¹éƒ½è¡Œï¼Œåªè¦ä½¿ç”¨@promotionè£…é¥°å³å¯ã€‚</li></ul><p>ä¸è¿‡ï¼Œå¤šæ•°è£…é¥°å™¨ä¼šä¿®æ”¹è¢«è£…é¥°çš„å‡½æ•°ã€‚é€šå¸¸å®ƒä»¬ä¼šå®šä¹‰ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œç„¶åŽå°†å…¶è¿”å›žï¼Œæ›¿æ¢è¢«è£…é¥°çš„å‡½æ•°ã€‚ä½¿ç”¨å†…éƒ¨å‡½æ•°çš„ä»£ç å‡ ä¹Žéƒ½è¦é é—­åŒ…æ‰èƒ½æ­£ç¡®è¿ä½œã€‚</p><h1 id="å˜é‡ä½œç”¨åŸŸè§„åˆ™">å˜é‡ä½œç”¨åŸŸè§„åˆ™</h1><p>ä¸ºäº†ç†è§£é—­åŒ…ï¼Œå…ˆäº†è§£Pythonä¸­çš„å˜é‡ä½œç”¨åŸŸã€‚ç¤ºä¾‹ ä¸€ä¸ªå‡½æ•°ï¼Œè¯»å–ä¸€ä¸ªå±€éƒ¨å˜é‡å’Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(a)</span>:</span></span><br><span class="line">        print(a)</span><br><span class="line">        print(b)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">3</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">3</span>, <span class="keyword">in</span> f1</span><br><span class="line">NameError: name <span class="string">'b'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">6</span>  <span class="comment"># å…ˆç»™å…¨å±€å˜é‡bèµ‹å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1(<span class="number">3</span>)  <span class="comment"># å†è°ƒç”¨å°±ä¸ä¼šå‡ºé”™</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢çœ‹ä¸€ä¸ªå¯èƒ½ä¼šè®©ä½ åƒæƒŠçš„ç¤ºä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(a)</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(a)</span><br><span class="line"><span class="meta">... </span>    print(b)</span><br><span class="line"><span class="meta">... </span>    b = <span class="number">9</span>  <span class="comment"># ç”±äºŽç»™å˜é‡bèµ‹å€¼ï¼Œç¼–è¯‘å™¨å°†bå½’ç±»ä¸ºå±€éƒ¨å˜é‡</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2(<span class="number">3</span>)</span><br><span class="line"><span class="number">3</span>  <span class="comment"># print(a)æ‰§è¡Œäº†</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">3</span>, <span class="keyword">in</span> f2</span><br><span class="line">UnboundLocalError: local variable <span class="string">'b'</span> referenced before assignment  <span class="comment"># å±€éƒ¨å˜é‡'b'æœªå®šä¹‰</span></span><br></pre></td></tr></table></figure><p>Pythonç¼–è¯‘å‡½æ•°çš„å®šä¹‰ä½“æ—¶ï¼Œå®ƒåˆ¤æ–­bæ˜¯å±€éƒ¨å˜é‡ï¼Œå› ä¸ºåœ¨å‡½æ•°ä¸­ç»™å®ƒèµ‹å€¼äº†ã€‚ç”Ÿæˆçš„å­—èŠ‚ç ï¼ˆå¯ä»¥ç”¨dis.dis(f2)æŸ¥çœ‹f2çš„å­—èŠ‚ç ï¼‰è¯å®žäº†è¿™ç§åˆ¤æ–­ï¼ŒPythonä¼šå°è¯•ä»Žæœ¬åœ°çŽ¯å¢ƒèŽ·å–bã€‚åŽé¢è°ƒç”¨f2(3)æ—¶ï¼Œf2çš„å®šä¹‰ä½“ä¼šèŽ·å–å¹¶æ‰“å°å±€éƒ¨å˜é‡açš„å€¼ï¼Œä½†æ˜¯å°è¯•èŽ·å–å±€éƒ¨å˜é‡bçš„å€¼æ—¶ï¼Œå‘çŽ°bæ²¡æœ‰ç»‘å®šå€¼ã€‚</p><p>è¿™ä¸æ˜¯ç¼ºé™·ï¼Œè€Œæ˜¯è®¾è®¡é€‰æ‹©ï¼šPythonä¸è¦æ±‚å£°æ˜Žå˜é‡ï¼Œä½†æ˜¯å‡å®šåœ¨å‡½æ•°å®šä¹‰ä½“ä¸­èµ‹å€¼çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ã€‚JavaScriptä¹Ÿä¸è¦æ±‚å£°æ˜Žå˜é‡ï¼Œä½†æ˜¯å¦‚æžœå¿˜è®°æŠŠå˜é‡å£°æ˜Žä¸ºå±€éƒ¨å˜é‡ï¼ˆä½¿ç”¨varï¼‰ï¼Œå¯èƒ½ä¼šåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹èŽ·å–å…¨å±€å˜é‡ã€‚</p><p>å¦‚æžœåœ¨å‡½æ•°ä¸­èµ‹å€¼æ—¶æƒ³è®©è§£é‡Šå™¨æŠŠbå½“æˆå…¨å±€å˜é‡ï¼Œè¦ä½¿ç”¨globalå£°æ˜Žã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(a)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">global</span> b</span><br><span class="line"><span class="meta">... </span>    print(a)</span><br><span class="line"><span class="meta">... </span>    print(b)</span><br><span class="line"><span class="meta">... </span>    b = <span class="number">9</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f3(<span class="number">3</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f3(<span class="number">3</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure><h1 id="é—­åŒ…">é—­åŒ…</h1><p>åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å‡½æ•°ä¸å¸¸è§ï¼Œç›´åˆ°å¼€å§‹ä½¿ç”¨åŒ¿åå‡½æ•°æ‰ä¼šè¿™æ ·åšã€‚è€Œä¸”ï¼Œåªæœ‰æ¶‰åŠåµŒå¥—å‡½æ•°æ—¶æ‰æœ‰é—­åŒ…é—®é¢˜ã€‚å…¶å®žï¼Œé—­åŒ…æŒ‡å»¶ä¼¸äº†ä½œç”¨åŸŸçš„å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬å‡½æ•°å®šä¹‰ä½“ä¸­å¼•ç”¨ã€ä½†æ˜¯ä¸åœ¨å®šä¹‰ä½“ä¸­å®šä¹‰çš„éžå…¨å±€å˜é‡ã€‚å‡½æ•°æ˜¯ä¸æ˜¯åŒ¿åçš„æ²¡æœ‰å…³ç³»ï¼Œå…³é”®æ˜¯å®ƒèƒ½è®¿é—®å®šä¹‰ä½“ä¹‹å¤–å®šä¹‰çš„éžå…¨å±€å˜é‡ã€‚</p><p>å‡å¦‚æœ‰ä¸ªåä¸ºavgçš„å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®¡ç®—ä¸æ–­å¢žåŠ çš„ç³»åˆ—å€¼çš„å‡å€¼ã€‚ä¾‹å¦‚ï¼Œæ•´ä¸ªåŽ†å²ä¸­æŸä¸ªå•†å“çš„å¹³å‡æ”¶ç›˜ä»·ã€‚æ¯å¤©éƒ½ä¼šå¢žåŠ æ–°ä»·æ ¼ï¼Œå› æ­¤å¹³å‡å€¼è¦è€ƒè™‘è‡³ç›®å‰ä¸ºæ­¢æ‰€æœ‰çš„ä»·æ ¼ã€‚èµ·åˆï¼Œavgæ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">10</span>)</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">11</span>)</span><br><span class="line"><span class="number">10.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">12</span>)</span><br><span class="line"><span class="number">11.0</span></span><br></pre></td></tr></table></figure><p>avgä»Žä½•è€Œæ¥ï¼Œå®ƒåˆåœ¨å“ªé‡Œä¿å­˜åŽ†å²å€¼å‘¢ï¼Ÿä¸‹é¢çœ‹ä¸¤ç§å®žçŽ°ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Averager</span><span class="params">()</span>:</span>  <span class="comment"># ä½¿ç”¨ç±»å®žçŽ°</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.series = []</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, new_value)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.series.append(new_value)</span><br><span class="line"><span class="meta">... </span>        total = sum(self.series)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> total / len(self.series)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg = Averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">1</span>)</span><br><span class="line"><span class="number">1.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg = Averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">10</span>)</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">11</span>)</span><br><span class="line"><span class="number">10.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">12</span>)</span><br><span class="line"><span class="number">11.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.series  <span class="comment"># åŽ†å²å€¼ä¿å­˜åœ¨å®žä¾‹çš„serieså±žæ€§ä¸­</span></span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span>  <span class="comment"># å‡½æ•°å¼å®žçŽ°</span></span><br><span class="line"><span class="meta">... </span>    series = []  <span class="comment"># seriesæ˜¯make_averagerçš„å±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line"><span class="meta">... </span>        series.append(new_value)  <span class="comment"># è®¿é—®äº†å®šä¹‰ä½“ä¹‹å¤–çš„å±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="meta">... </span>        total = sum(series)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> total / len(series)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> averager</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg = make_averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">10</span>)</span><br><span class="line"><span class="number">10.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">11</span>)</span><br><span class="line"><span class="number">10.5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">12</span>)</span><br><span class="line"><span class="number">11.0</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°å¼å®žçŽ°ä¸­çš„avgå‡½æ•°åœ¨å“ªé‡Œå¯»æ‰¾serieså‘¢ï¼Ÿæ³¨æ„ï¼Œseriesæ˜¯make_averagerå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå› ä¸ºé‚£ä¸ªå‡½æ•°çš„å®šä¹‰ä½“ä¸­åˆå§‹åŒ–äº†seriesã€‚å¯æ˜¯ï¼Œè°ƒç”¨avg(10)æ—¶ï¼Œmake_averagerå‡½æ•°å·²ç»è¿”å›žäº†ï¼Œè€Œå®ƒçš„æœ¬åœ°ä½œç”¨åŸŸä¹Ÿä¸€åŽ»ä¸å¤è¿”äº†ã€‚</p><p>åœ¨averagerå‡½æ•°ä¸­ï¼Œseriesæ˜¯è‡ªç”±å˜é‡ï¼ˆfree variableï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯æœ¯è¯­ï¼ŒæŒ‡æœªåœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­ç»‘å®šçš„å˜é‡ï¼ˆseriesçš„ç»‘å®šå‘ç”Ÿåœ¨make_averagerå®šä¹‰ä½“ä¸­ï¼‰ã€‚</p><p><img src="/uploads/image/fluent-python/closure-and-free-variable.png"></p><p>averagerçš„é—­åŒ…å»¶ä¼¸åˆ°é‚£ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸä¹‹å¤–ï¼ŒåŒ…å«è‡ªç”±å˜é‡seriesçš„ç»‘å®šã€‚å®¡æŸ¥è¿”å›žçš„averagerå¯¹è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__code__.co_varnames</span><br><span class="line">(<span class="string">'new_value'</span>, <span class="string">'total'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__code__.co_freevars</span><br><span class="line">(<span class="string">'series'</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__closure__</span><br><span class="line">(&lt;cell at <span class="number">0x106562738</span>: list object at <span class="number">0x10658fd48</span>&gt;,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg.__closure__[<span class="number">0</span>].cell_contents</span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼Œé—­åŒ…æ˜¯ä¸€ç§å‡½æ•°ï¼Œå®ƒä¼šä¿ç•™å®šä¹‰å‡½æ•°æ—¶å­˜åœ¨çš„è‡ªç”±å˜é‡çš„ç»‘å®šï¼Œè¿™æ ·è°ƒç”¨å‡½æ•°æ—¶ï¼Œè™½ç„¶å®šä¹‰ä½œç”¨åŸŸä¸å¯ç”¨äº†ï¼Œä½†æ˜¯ä»èƒ½ä½¿ç”¨é‚£äº›ç»‘å®šã€‚æ³¨æ„ï¼Œåªæœ‰åµŒå¥—åœ¨å…¶ä»–å‡½æ•°ä¸­çš„å‡½æ•°ï¼ˆæœ¬ä¾‹çš„averagerå‡½æ•°ï¼‰æ‰å¯èƒ½éœ€è¦å¤„ç†ä¸åœ¨å…¨å±€ä½œç”¨åŸŸä¸­çš„å¤–éƒ¨å˜é‡ï¼ˆæœ¬ä¾‹çš„seriesï¼‰ã€‚</p><h1 id="nonlocalå£°æ˜Ž">nonlocalå£°æ˜Ž</h1><p>åœ¨ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰å€¼å­˜å‚¨åœ¨åŽ†å²æ•°åˆ—ä¸­ï¼Œç„¶åŽåœ¨æ¯æ¬¡è°ƒç”¨averageræ—¶ä½¿ç”¨sumæ±‚å’Œã€‚æ›´å¥½çš„å®žçŽ°æ–¹å¼æ˜¯ï¼Œåªå­˜å‚¨ç›®å‰çš„æ€»å€¼å’Œå…ƒç´ ä¸ªæ•°ï¼Œç„¶åŽä½¿ç”¨è¿™ä¸¤ä¸ªæ•°è®¡ç®—å‡å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    count = <span class="number">0</span></span><br><span class="line"><span class="meta">... </span>    total = <span class="number">0</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line"><span class="meta">... </span>        count += <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>        total += new_value</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> total / count</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> averager</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg = make_averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">10</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">5</span>, <span class="keyword">in</span> averager</span><br><span class="line">UnboundLocalError: local variable <span class="string">'count'</span> referenced before assignment</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæƒ³è±¡ä¸­çš„è‡ªç”±å˜é‡countä¼šå˜æˆå±€éƒ¨å˜é‡å‘¢ï¼Ÿ</p><p><strong>é—®é¢˜æ˜¯ï¼Œå½“countæ˜¯ä»»ä½•ä¸å¯å˜ç±»åž‹ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å…ƒç»„ç­‰ï¼‰æ—¶ï¼Œcount += 1è¯­å¥çš„ä½œç”¨å…¶å®žä¸Žcount = count + 1ä¸€æ ·ã€‚å› æ­¤ï¼Œåœ¨averagerå®šä¹‰ä½“ä¸­ä¸ºcountèµ‹å€¼äº†ï¼Œè¿™ä¼šæŠŠcountå˜æˆå±€éƒ¨å˜é‡ã€‚totalå˜é‡ä¹Ÿå—è¿™ä¸ªé—®é¢˜å½±å“ã€‚</strong></p><p><strong>å¯¹ä¸å¯å˜ç±»åž‹æ¥è¯´ï¼Œåªèƒ½è¯»å–ï¼Œä¸èƒ½æ›´æ–°ã€‚å¦‚æžœå°è¯•é‡æ–°ç»‘å®šï¼Œä¾‹å¦‚count = count + 1ï¼Œå…¶å®žä¼šéšå¼åˆ›å»ºå±€éƒ¨å˜é‡countã€‚è¿™æ ·ï¼Œcountå°±ä¸æ˜¯è‡ªç”±å˜é‡ï¼Œå› æ­¤ä¸ä¼šä¿å­˜åœ¨é—­åŒ…ä¸­ã€‚</strong></p><p>Python3å¼•å…¥äº†nonlocalå£°æ˜Žã€‚å®ƒçš„ä½œç”¨æ˜¯æŠŠå˜é‡æ ‡è®°ä¸ºè‡ªç”±å˜é‡ï¼Œå³ä½¿åœ¨å‡½æ•°ä¸­ä¸ºå˜é‡èµ‹äºˆæ–°å€¼äº†ï¼Œä¹Ÿä¼šå˜æˆè‡ªç”±å˜é‡ã€‚å¦‚æžœä¸ºnonlocalå£°æ˜Žçš„å˜é‡èµ‹äºˆæ–°å€¼ï¼Œé—­åŒ…ä¸­ä¿å­˜çš„ç»‘å®šä¼šæ›´æ–°ã€‚ä½¿ç”¨nonlocalä¿®æ­£åŽçš„å‡½æ•°å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> count, total</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        total += new_value</span><br><span class="line">        <span class="keyword">return</span> total / count</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> averager</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> decorators </tag>
            
            <tag> Fluent Python </tag>
            
            <tag> strategy </tag>
            
            <tag> closures </tag>
            
            <tag> global </tag>
            
            <tag> nonlocal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UMLç±»å›¾</title>
      <link href="/documentation/uml-class-diagram/"/>
      <url>/documentation/uml-class-diagram/</url>
      
        <content type="html"><![CDATA[<p><a href="https://design-patterns.readthedocs.io/zh_CN/latest/read_uml.html" target="_blank" rel="noopener">çœ‹æ‡‚UMLç±»å›¾å’Œæ—¶åºå›¾</a></p><p><a href="https://plantuml.com/zh/class-diagram" target="_blank" rel="noopener">ç±»å›¾çš„è¯­æ³•å’ŒåŠŸèƒ½</a></p><h1 id="ä»Žä¸€ä¸ªç¤ºä¾‹å¼€å§‹">ä»Žä¸€ä¸ªç¤ºä¾‹å¼€å§‹</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@startuml</span><br><span class="line">title ç¤ºä¾‹</span><br><span class="line">abstract è½¦ &lt;&lt;abstract&gt;&gt;</span><br><span class="line">hide empty fields</span><br><span class="line">hide empty methods</span><br><span class="line">å°æ±½è½¦ .up.|&gt; è½¦ : å®žçŽ°</span><br><span class="line">è‡ªè¡Œè½¦ .up.|&gt; è½¦ : å®žçŽ°</span><br><span class="line">SUV -left-|&gt; å°æ±½è½¦ : æ³›åŒ–</span><br><span class="line">å°æ±½è½¦ â€œ1â€ *-down- â€œ4â€ è½®èƒŽ : ç»„åˆ</span><br><span class="line">å°æ±½è½¦ â€œ1â€ *-down- â€œ1â€ å‘åŠ¨æœº : ç»„åˆ</span><br><span class="line">å­¦ç”Ÿ .right.&gt; è‡ªè¡Œè½¦ : ä¾èµ–</span><br><span class="line">ç­çº§ â€œ1â€ -up-o â€œmanyâ€ å­¦ç”Ÿ : èšåˆ</span><br><span class="line">å­¦ç”Ÿ â€œ1â€ -down- â€œ1â€ èº«ä»½è¯ : å…³è”</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><img src="http://www.plantuml.com/plantuml/svg/AyaioKbLUBvarvDztLo9ISKbHOd99GelzYvJiB61SUtik38oKr8LKdCBIYeLSbDparABk9vkw7-sSIz8eLvfWLwD7LYFbSBJTVEUzstWUj6-wiN27boomQ5X2hevgMabka0PX45M2iysptxQCmt9x4SDSmmVDSnLqD9DoI_FqmNnJK3y5tlNlMZk0-fulhlbwOGE_3h0_AVz4vzshNWsPnUIfhNBda-Phw1Nb9cUKQ87T2FSqLOAJ_RDVR5r6jVp_hNFTos76w9RMg2R3-Bb9kPLWas5666byA9n5fAHSFMeRdYnQ_MJtNjVh6y41KNhvXUDKm00"><ul><li>å°æ±½è½¦ä¸Žè‡ªè¡Œè½¦å’ŒæŠ½è±¡ç±»è½¦ä¹‹é—´çš„å…³ç³»ä¸º<strong>å®žçŽ°</strong>å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„è™šçº¿è¡¨ç¤ºã€‚</li><li>å°æ±½è½¦ä¸ŽSUVä¹‹é—´çš„å…³ç³»æ˜¯<strong>æ³›åŒ–</strong>å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®žçº¿è¡¨ç¤ºã€‚</li><li>å°æ±½è½¦ä¸Žå‘åŠ¨æœºã€è½®èƒŽä¹‹é—´æ˜¯<strong>ç»„åˆ</strong>å…³ç³»ï¼Œä½¿ç”¨å¸¦å®žå¿ƒç®­å¤´çš„å®žçº¿è¡¨ç¤ºã€‚</li><li>å­¦ç”Ÿä¸Žç­çº§ä¹‹é—´æ˜¯<strong>èšåˆ</strong>å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®žçº¿è¡¨ç¤ºã€‚</li><li>å­¦ç”Ÿä¸Žèº«ä»½è¯ä¹‹é—´æ˜¯<strong>å…³è”</strong>å…³ç³»ï¼Œä½¿ç”¨ä¸€æ ¹å®žçº¿è¡¨ç¤ºã€‚</li><li>å­¦ç”Ÿä¸Šå­¦éœ€è¦ç”¨åˆ°è‡ªè¡Œè½¦ï¼Œä¸Žè‡ªè¡Œè½¦æ˜¯ä¸€ç§<strong>ä¾èµ–</strong>å…³ç³»ï¼Œä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤ºã€‚</li></ul><a id="more"></a><h1 id="ç±»ä¹‹é—´çš„å…³ç³»">ç±»ä¹‹é—´çš„å…³ç³»</h1><h2 id="æ³›åŒ–å’Œå®žçŽ°">æ³›åŒ–å’Œå®žçŽ°</h2><p>æ³›åŒ–å…³ç³»ï¼ˆgeneralizationï¼‰ï¼šæœ€ç»ˆä»£ç ä¸­ï¼Œæ³›åŒ–å…³ç³»è¡¨çŽ°ä¸ºç»§æ‰¿éžæŠ½è±¡ç±»æˆ–å®žçŽ°æŽ¥å£ï¼ˆéœ€è¦ç¼–ç¨‹è¯­è¨€æ”¯æŒï¼‰ã€‚</p><p>å®žçŽ°å…³ç³»ï¼ˆrealizeï¼‰ï¼š æœ€ç»ˆä»£ç ä¸­ï¼Œå®žçŽ°å…³ç³»è¡¨çŽ°ä¸ºç»§æ‰¿æŠ½è±¡ç±»ã€‚</p><h2 id="èšåˆå’Œç»„åˆ">èšåˆå’Œç»„åˆ</h2><p>èšåˆå…³ç³»ï¼ˆaggregationï¼‰ï¼šè¡¨ç¤ºæ•´ä½“ç”±éƒ¨åˆ†æž„æˆï¼Œä¸Žç»„åˆå…³ç³»ä¸åŒçš„æ˜¯ï¼Œæ•´ä½“å’Œéƒ¨åˆ†ä¸æ˜¯å¼ºä¾èµ–çš„ï¼Œå³ä½¿æ•´ä½“ä¸å­˜åœ¨äº†ï¼Œéƒ¨åˆ†ä»ç„¶å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œéƒ¨é—¨æ’¤é”€äº†ï¼Œäººå‘˜ä¸ä¼šæ¶ˆå¤±ï¼Œä»–ä»¬ä¾ç„¶å­˜åœ¨ã€‚</p><p>ç»„åˆå…³ç³»ï¼ˆcompositionï¼‰ï¼šç»„åˆå…³ç³»æ˜¯ä¸€ç§å¼ºä¾èµ–çš„ç‰¹æ®Šèšåˆå…³ç³»ï¼Œå¦‚æžœæ•´ä½“ä¸å­˜åœ¨äº†ï¼Œåˆ™éƒ¨åˆ†ä¹Ÿä¸å­˜åœ¨äº†ã€‚ä¾‹å¦‚ï¼Œå…¬å¸ä¸å­˜åœ¨äº†ï¼Œéƒ¨é—¨ä¹Ÿå°†ä¸å­˜åœ¨äº†ã€‚</p><h2 id="å…³è”å’Œä¾èµ–">å…³è”å’Œä¾èµ–</h2><p>å…³è”å…³ç³»ï¼ˆassociationï¼‰ï¼šæè¿°ä¸åŒç±»çš„å¯¹è±¡ä¹‹é—´çš„ç»“æž„å…³ç³»ï¼Œå®ƒæ˜¯ä¸€ç§é™æ€å…³ç³»ï¼Œé€šå¸¸ä¸Žè¿è¡ŒçŠ¶æ€æ— å…³ï¼Œä¸€èˆ¬ç”±å¸¸è¯†ç­‰å› ç´ å†³å®šã€‚å…³è”å…³ç³»æ˜¯ä¸€ç§â€œå¼ºå…³è”â€çš„å…³ç³»ã€‚æ¯”å¦‚ï¼Œä¹˜è½¦äººå’Œè½¦ç¥¨ã€å­¦ç”Ÿä¸Žå­¦æ ¡ä¹‹é—´å°±æ˜¯ä¸€ç§å…³è”å…³ç³»ã€‚å…³è”å…³ç³»é»˜è®¤ä¸å¼ºè°ƒæ–¹å‘ï¼Œè¡¨ç¤ºå¯¹è±¡ç›¸äº’çŸ¥é“ã€‚åœ¨æœ€ç»ˆä»£ç ä¸­ï¼Œå…³è”å¯¹è±¡é€šå¸¸æ˜¯ä»¥æˆå‘˜å˜é‡çš„å½¢å¼å®žçŽ°çš„ã€‚</p><p>ä¾èµ–å…³ç³»ï¼ˆdependencyï¼‰ï¼šæè¿°ä¸€ä¸ªå¯¹è±¡åœ¨è¿è¡ŒæœŸé—´ä¼šç”¨åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚ä¸Žå…³è”å…³ç³»ä¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ç§ä¸´æ—¶æ€§çš„å…³ç³»ï¼Œé€šå¸¸åœ¨è¿è¡ŒæœŸé—´äº§ç”Ÿï¼Œå¹¶ä¸”éšç€è¿è¡Œæ—¶çš„å˜åŒ–ï¼Œä¾èµ–å…³ç³»ä¹Ÿå¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚æ˜¾ç„¶ï¼Œä¾èµ–ä¹Ÿæœ‰æ–¹å‘ï¼ŒåŒå‘ä¾èµ–æ˜¯ä¸€ç§éžå¸¸ç³Ÿç³•çš„ç»“æž„ï¼Œæˆ‘ä»¬æ€»æ˜¯åº”è¯¥ä¿æŒå•é¡¹ä¾èµ–ï¼Œæœç»åŒå‘ä¾èµ–çš„äº§ç”Ÿã€‚åœ¨æœ€ç»ˆä»£ç ä¸­ï¼Œä¾èµ–å…³ç³»ä½“çŽ°ä¸ºç±»æž„é€ æ–¹æ³•åŠç±»æ–¹æ³•çš„ä¼ å…¥å‚æ•°ï¼Œä½¿ç”¨å¯¹æ–¹çš„æ–¹æ³•å’Œå±žæ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UML </tag>
            
            <tag> plantuml </tag>
            
            <tag> design patterns </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ä¸€ç­‰å‡½æ•°å®žçŽ°è®¾è®¡æ¨¡å¼</title>
      <link href="/notes/fluent-python/design-patterns-with-first-class-functions/"/>
      <url>/notes/fluent-python/design-patterns-with-first-class-functions/</url>
      
        <content type="html"><![CDATA[<p>è™½ç„¶è®¾è®¡æ¨¡å¼ä¸Žè¯­è¨€æ— å…³ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ¯ä¸€ä¸ªæ¨¡å¼éƒ½èƒ½åœ¨æ¯ä¸€é—¨è¯­è¨€ä¸­ä½¿ç”¨ã€‚1996å¹´ï¼ŒPeter Norvigåœ¨é¢˜ä¸ºâ€œ<a href="http://norvig.com/design-patterns/" target="_blank" rel="noopener">Design Patterns in Dynamic Languages</a>â€çš„æ¼”è®²ä¸­æŒ‡å‡ºï¼ŒGammaç­‰äººåˆè‘—çš„ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ä¸­æœ‰23ä¸ªæ¨¡å¼ï¼Œå…¶ä¸­æœ‰16ä¸ªåœ¨åŠ¨æ€è¯­è¨€ä¸­â€œä¸è§äº†ï¼Œæˆ–è€…ç®€åŒ–äº†â€ï¼ˆå‚è§ç¬¬9å¼ å¹»ç¯ç‰‡ï¼‰ã€‚ä»–è®¨è®ºçš„æ˜¯Lispå’ŒDylanï¼Œä¸è¿‡å¾ˆå¤šç›¸å…³çš„åŠ¨æ€ç‰¹æ€§åœ¨Pythonä¸­ä¹Ÿèƒ½æ‰¾åˆ°ã€‚</p><p>å…·ä½“è€Œè¨€ï¼ŒNorvigå»ºè®®åœ¨æœ‰ä¸€ç­‰å‡½æ•°çš„è¯­è¨€ä¸­é‡æ–°å®¡è§†ç­–ç•¥ã€å‘½ä»¤ã€æ¨¡æ¿æ–¹æ³•å’Œè®¿é—®è€…æ¨¡å¼ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æ¨¡å¼ä¸­æ¶‰åŠçš„æŸäº›ç±»çš„å®žä¾‹æ›¿æ¢æˆç®€å•çš„å‡½æ•°ï¼Œä»Žè€Œå‡å°‘æ ·æ¿ä»£ç ã€‚</p><h1 id="é‡æž„ç­–ç•¥æ¨¡å¼">é‡æž„ç­–ç•¥æ¨¡å¼</h1><h2 id="ç»å…¸çš„ç­–ç•¥æ¨¡å¼">ç»å…¸çš„ç­–ç•¥æ¨¡å¼</h2><p>ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦æ˜¯è¿™æ ·æ¦‚çŽ‡ç­–ç•¥æ¨¡å¼çš„ï¼šå®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸€å°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚æœ¬æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºŽä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚</p><a id="more"></a><p>ç”µå•†é¢†åŸŸæœ‰ä¸ªåŠŸèƒ½æ˜Žæ˜¾å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œæ ¹æ®å®¢æˆ·çš„å±žæ€§æˆ–è®¢å•ä¸­çš„å•†å“è®¡ç®—æŠ˜æ‰£ã€‚å‡å¦‚ä¸€ä¸ªç½‘åº—åˆ¶å®šäº†ä¸‹è¿°æŠ˜æ‰£è§„åˆ™ã€‚</p><ul><li>æœ‰1000æˆ–ä»¥ä¸Šç§¯åˆ†çš„é¡¾å®¢ï¼Œæ¯ä¸ªè®¢å•äº«5%æŠ˜æ‰£ã€‚</li><li>åŒä¸€è®¢å•ä¸­ï¼Œå•ä¸ªå•†å“çš„æ•°é‡è¾¾åˆ°20ä¸ªæˆ–ä»¥ä¸Šï¼Œäº«10%æŠ˜æ‰£ã€‚</li><li>è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šï¼Œäº«7%æŠ˜æ‰£ã€‚</li></ul><p>ç®€å•èµ·è§ï¼Œå‡å®šä¸€ä¸ªè®¢å•ä¸€æ¬¡åªèƒ½äº«ç”¨ä¸€ä¸ªæŠ˜æ‰£ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYIiv9B2vMy2zAIIrIgEPI08AI_9B470rDC3kbD1N8gkLAJ2ekAKfCBb48AChFpI_9pC-3Agw6oTGgf6GM9-UNvfM0DK2CTGDQbvDPKWdM1TM1HPbJQKwsPqbgBW5bFeb5wQbWb-9K2F57lYx2dLm85zlKwEgYEWbT4iKXw99erdFbvPUaAYWzsT7rP4VtisdjIWg9nGfvXb3XvskdFP-w529c11LxshhzoTx9o3B6N7c62df5cUaP9NgGEE3ACrBGoqbD0_8HNa0DHZqza4RKC8E8eGSGM1G0"><p>ä¸Šä¸‹æ–‡ï¼šæŠŠä¸€äº›è®¡ç®—å§”æ‰˜ç»™å®žçŽ°ä¸åŒç®—æ³•çš„å¯äº’æ¢ç»„å»ºï¼Œå®ƒæä¾›æœåŠ¡ã€‚åœ¨è¿™ä¸ªç”µå•†ç¤ºä¾‹ä¸­ï¼Œä¸Šä¸‹æ–‡æ˜¯Orderï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„ç®—æ³•è®¡ç®—ä¿ƒé”€æŠ˜æ‰£ã€‚</p><p>ç­–ç•¥ï¼šå®žçŽ°ä¸åŒç®—æ³•çš„ç»„ä»¶å…±åŒçš„æŽ¥å£ã€‚</p><p>å…·ä½“ç­–ç•¥ï¼šç­–ç•¥çš„å…·ä½“å­ç±»ã€‚</p><p>æŒ‰ç…§ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦çš„è¯´æ˜Žï¼Œå…·ä½“ç­–ç•¥ç”±ä¸Šä¸‹æ–‡ç±»çš„å®¢æˆ·é€‰æ‹©ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå®žä¾‹åŒ–è®¢å•ä¹‹å‰ï¼Œç³»ç»Ÿä¼šä»¥æŸç§æ–¹å¼é€‰æ‹©ä¸€ç§ä¿ƒé”€æŠ˜æ‰£ç­–ç•¥ï¼Œç„¶åŽæŠŠå®ƒä¼ ç»™Orderæž„é€ æ–¹æ³•ã€‚å…·ä½“æ€Žä¹ˆé€‰æ‹©ç­–ç•¥ï¼Œä¸åœ¨è¿™ä¸ªæ¨¡å¼çš„èŒè´£èŒƒå›´å†…ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Customer = namedtuple(<span class="string">'Customer'</span>, <span class="string">'name fidelity'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, product, quantity, price)</span>:</span></span><br><span class="line">        self.product = product</span><br><span class="line">        self.quantity = quantity</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.price * self.quantity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>:</span>  <span class="comment"># ä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, customer, cart, promotion=None)</span>:</span></span><br><span class="line">        self.customer = customer</span><br><span class="line">        self.cart = list(cart)</span><br><span class="line">        self.promotion = promotion</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'__total'</span>):</span><br><span class="line">            self.__total = sum(item.total() <span class="keyword">for</span> item <span class="keyword">in</span> self.cart)</span><br><span class="line">        <span class="keyword">return</span> self.__total</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">due</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.promotion <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            discount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            discount = self.promotion.discount(self)</span><br><span class="line">        <span class="keyword">return</span> self.total() - discount</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        fmt = <span class="string">'&lt;Order total: &#123;:.2f&#125; due: &#123;:.2f&#125;&gt;'</span></span><br><span class="line">        <span class="keyword">return</span> fmt.format(self.total(), self.due())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promotion</span><span class="params">(ABC)</span>:</span>  <span class="comment"># ç­–ç•¥:æŠ½è±¡åŸºç±»</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žæŠ˜æ‰£é‡‘é¢(æ­£å€¼)"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FidelityPromo</span><span class="params">(Promotion)</span>:</span>  <span class="comment"># ç¬¬ä¸€ä¸ªå…·ä½“ç­–ç•¥</span></span><br><span class="line">    <span class="string">"""ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> order.total() * <span class="number">.05</span> <span class="keyword">if</span> order.customer.fidelity &gt;= <span class="number">1000</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BulkItemPromo</span><span class="params">(Promotion)</span>:</span>  <span class="comment"># ç¬¬äºŒä¸ªå…·ä½“ç­–ç•¥</span></span><br><span class="line">    <span class="string">"""å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        discount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> order.cart:</span><br><span class="line">            <span class="keyword">if</span> item.quantity &gt;= <span class="number">20</span>:</span><br><span class="line">                discount += item.total() * <span class="number">.1</span></span><br><span class="line">        <span class="keyword">return</span> discount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LargeOrderPromo</span><span class="params">(Promotion)</span>:</span>  <span class="comment"># ç¬¬ä¸‰ä¸ªå…·ä½“ç­–ç•¥</span></span><br><span class="line">    <span class="string">"""è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">discount</span><span class="params">(self, order)</span>:</span></span><br><span class="line">        distinct_items = &#123;item.product <span class="keyword">for</span> item <span class="keyword">in</span> order.cart&#125;</span><br><span class="line">        <span class="keyword">if</span> len(distinct_items) &gt;= <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">return</span> order.total() * <span class="number">.07</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>Promotionå®šä¹‰ä¸ºæŠ½è±¡åŸºç±»ï¼ˆAbstract Base Class, ABCï¼‰ï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†ä½¿ç”¨@abstractmethodè£…é¥°å™¨ï¼Œä»Žè€Œæ˜Žç¡®è¡¨æ˜Žæ‰€ç”¨çš„æ¨¡å¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe = Customer(<span class="string">'John Doe'</span>, <span class="number">0</span>)  <span class="comment"># joeç§¯åˆ†ä¸º0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ann = Customer(<span class="string">'Ann Smith'</span>, <span class="number">1100</span>)  <span class="comment"># annç§¯åˆ†1100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cart = [LineItem(<span class="string">'banana'</span>, <span class="number">4</span>, <span class="number">.5</span>),</span><br><span class="line"><span class="meta">... </span>        LineItem(<span class="string">'apple'</span>, <span class="number">10</span>, <span class="number">1.5</span>),</span><br><span class="line"><span class="meta">... </span>        LineItem(<span class="string">'watermellon'</span>, <span class="number">5</span>, <span class="number">5.0</span>)]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, cart, FidelityPromo())  <span class="comment"># joeä¸äº«æŠ˜æ‰£</span></span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">42.00</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(ann, cart, FidelityPromo())  <span class="comment"># annäº«æœ‰5%ç§¯åˆ†æŠ˜æ‰£</span></span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">39.90</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>banana_cart = [LineItem(<span class="string">'banana'</span>, <span class="number">30</span>, <span class="number">.5</span>),</span><br><span class="line"><span class="meta">... </span>               LineItem(<span class="string">'apple'</span>, <span class="number">10</span>, <span class="number">1.5</span>)]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, banana_cart, BulkItemPromo())  <span class="comment"># é¦™è•‰ä¸ªæ•°è¶…è¿‡20ä¸ªï¼Œé¦™è•‰äº«10%æŠ˜æ‰£</span></span><br><span class="line">&lt;Order total: <span class="number">30.00</span> due: <span class="number">28.50</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>long_order = [LineItem(str(item_code), <span class="number">1</span>, <span class="number">1.0</span>) <span class="keyword">for</span> item_code <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, long_order, LargeOrderPromo())  <span class="comment"># long_orderä¸åŒå•†å“è¾¾åˆ°10ä¸ªï¼Œäº«7%æŠ˜æ‰£</span></span><br><span class="line">&lt;Order total: <span class="number">10.00</span> due: <span class="number">9.30</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, cart, LargeOrderPromo())  <span class="comment"># cartä¸åŒå•†å“æœ‰3ä¸ªï¼Œä¸èƒ½äº«æŠ˜æ‰£</span></span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">42.00</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å‡½æ•°å®žçŽ°ç­–ç•¥æ¨¡å¼">ä½¿ç”¨å‡½æ•°å®žçŽ°ç­–ç•¥æ¨¡å¼</h2><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªå…·ä½“ç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”éƒ½åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå³discountã€‚æ­¤å¤–ï¼Œç­–ç•¥å®žä¾‹æ²¡æœ‰çŠ¶æ€ï¼ˆæ²¡æœ‰å®žä¾‹å±žæ€§ï¼‰ã€‚å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯æ™®é€šçš„å‡½æ•°â€”â€”çš„ç¡®å¦‚æ­¤ã€‚ä¸‹é¢æ˜¯å¯¹ç¤ºä¾‹çš„é‡æž„ï¼ŒæŠŠå…·ä½“ç­–ç•¥æ¢æˆäº†ç®€å•çš„å‡½æ•°ï¼Œè€Œä¸”åŽ»æŽ‰äº†PromoæŠ½è±¡ç±»ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Customer = namedtuple(<span class="string">'Customer'</span>, <span class="string">'name fidelity'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, product, quantity, price)</span>:</span></span><br><span class="line">        self.product = product</span><br><span class="line">        self.quantity = quantity</span><br><span class="line">        self.price = price</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.price * self.quantity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>:</span>  <span class="comment"># ä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, customer, cart, promotion=None)</span>:</span></span><br><span class="line">        self.customer = customer</span><br><span class="line">        self.cart = list(cart)</span><br><span class="line">        self.promotion = promotion</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">total</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'__total'</span>):</span><br><span class="line">            self.__total = sum(item.total() <span class="keyword">for</span> item <span class="keyword">in</span> self.cart)</span><br><span class="line">        <span class="keyword">return</span> self.__total</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">due</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.promotion <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            discount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            discount = self.promotion(self)  <span class="comment"># è®¡ç®—æŠ˜æ‰£åªéœ€è°ƒç”¨self.promotion()å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> self.total() - discount</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        fmt = <span class="string">'&lt;Order total: &#123;:.2f&#125; due: &#123;:.2f&#125;&gt;'</span></span><br><span class="line">        <span class="keyword">return</span> fmt.format(self.total(), self.due())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ— æŠ½è±¡ç±»</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fidelity_promo</span><span class="params">(order)</span>:</span>  <span class="comment"># å„ä¸ªç­–ç•¥éƒ½æ˜¯å‡½æ•°</span></span><br><span class="line">    <span class="string">"""ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> order.total() * <span class="number">.05</span> <span class="keyword">if</span> order.customer.fidelity &gt;= <span class="number">1000</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bulk_item_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£"""</span></span><br><span class="line">    discount = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> order.cart:</span><br><span class="line">        <span class="keyword">if</span> item.quantity &gt;= <span class="number">20</span>:</span><br><span class="line">            discount += item.total() * <span class="number">.1</span></span><br><span class="line">    <span class="keyword">return</span> discount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">large_order_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£"""</span></span><br><span class="line">    distinct_items = &#123;item.product <span class="keyword">for</span> item <span class="keyword">in</span> order.cart&#125;</span><br><span class="line">    <span class="keyword">if</span> len(distinct_items) &gt;= <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> order.total() * <span class="number">.07</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>æ–°çš„Orderç±»ä½¿ç”¨èµ·æ¥æ›´ç®€å•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe = Customer(<span class="string">'John Doe'</span>, <span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ann = Customer(<span class="string">'Ann Smith'</span>, <span class="number">1100</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cart = [LineItem(<span class="string">'banana'</span>, <span class="number">4</span>, <span class="number">.5</span>),</span><br><span class="line"><span class="meta">... </span>        LineItem(<span class="string">'apple'</span>, <span class="number">10</span>, <span class="number">1.5</span>),</span><br><span class="line"><span class="meta">... </span>        LineItem(<span class="string">'watermellon'</span>, <span class="number">5</span>, <span class="number">5.0</span>)]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, cart, fidelity_promo)  <span class="comment"># æ²¡å¿…è¦å®žä¾‹åŒ–å¯¹è±¡ï¼ŒæŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥</span></span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">42.00</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(ann, cart, fidelity_promo)</span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">39.90</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>banana_cart = [LineItem(<span class="string">'banana'</span>, <span class="number">30</span>, <span class="number">.5</span>),</span><br><span class="line"><span class="meta">... </span>               LineItem(<span class="string">'apple'</span>, <span class="number">10</span>, <span class="number">1.5</span>)]</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, banana_cart, bulk_item_promo)</span><br><span class="line">&lt;Order total: <span class="number">30.00</span> due: <span class="number">28.50</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>long_order = [LineItem(str(item_code), <span class="number">1</span>, <span class="number">1.0</span>) <span class="keyword">for</span> item_code <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, long_order, large_order_promo)</span><br><span class="line">&lt;Order total: <span class="number">10.00</span> due: <span class="number">9.30</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, cart, large_order_promo)</span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">42.00</span>&gt;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°å®žçŽ°äº†ç­–ç•¥æ¨¡å¼ï¼Œç”±æ­¤ä¹Ÿå‡ºçŽ°äº†å…¶ä»–å¯èƒ½æ€§ã€‚å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªâ€œå…ƒç­–ç•¥â€ï¼Œè®©å®ƒä¸ºæŒ‡å®šçš„è®¢å•é€‰æ‹©æœ€ä½³æŠ˜æ‰£ã€‚</p><h2 id="é€‰æ‹©æœ€ä½³ç­–ç•¥ç®€å•çš„æ–¹å¼">é€‰æ‹©æœ€ä½³ç­–ç•¥ï¼šç®€å•çš„æ–¹å¼</h2><p>best_promoå‡½æ•°çš„å®žçŽ°ç‰¹åˆ«ç®€å•ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">promos = [fidelity_promo, bulk_item_promo, large_order_promo]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">best_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> max(promo(order) <span class="keyword">for</span> promo <span class="keyword">in</span> promos)  <span class="comment"># è¿”å›žæŠ˜æ‰£é¢åº¦æœ€å¤§çš„é‚£ä¸ª</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, long_order, best_promo)  <span class="comment"># è®¢è´­å¤šç§å•†å“æ—¶ï¼Œé€‰æ‹©larger_order_promo</span></span><br><span class="line">&lt;Order total: <span class="number">10.00</span> due: <span class="number">9.30</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(joe, banana_cart, best_promo)  <span class="comment"># è®¢è´­å¤§é‡é¦™è•‰æ—¶ï¼Œé€‰æ‹©bulk_item_promo</span></span><br><span class="line">&lt;Order total: <span class="number">30.00</span> due: <span class="number">28.50</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Order(ann, cart, best_promo)  <span class="comment"># ä¸ºå¿ å®žé¡¾å®¢annæä¾›fidelity_promoä¼˜æƒ çš„æŠ˜æ‰£</span></span><br><span class="line">&lt;Order total: <span class="number">42.00</span> due: <span class="number">39.90</span>&gt;</span><br></pre></td></tr></table></figure><p>è™½ç„¶ä¸Šè¿°ç¤ºä¾‹å¯ç”¨ï¼Œè€Œä¸”æ˜“è¯»ï¼Œä½†æ˜¯æœ‰äº›é‡å¤å¯èƒ½ä¼šå¯¼è‡´ä¸æ˜“å¯Ÿè§‰çš„ç¼ºé™·ï¼šè‹¥æƒ³æ·»åŠ æ–°çš„ä¿ƒé”€ç­–ç•¥ï¼Œè¦å®šä¹‰ç›¸åº”çš„å‡½æ•°ï¼Œè¿˜è¦è®°å¾—æŠŠå®ƒæ·»åŠ åˆ°promosåˆ—è¡¨ä¸­ï¼›å¦åˆ™ï¼Œå½“æ–°ä¿ƒé”€å‡½æ•°æ˜¾å¼åœ°ä½œä¸ºå‚æ•°ä¼ ç»™Orderæ—¶ï¼Œå®ƒæ˜¯å¯ç”¨çš„ï¼Œä½†æ˜¯best_promoä¸ä¼šè€ƒè™‘å®ƒã€‚ç»§ç»­å¾€ä¸‹è¯»ï¼Œäº†è§£è¿™ä¸ªé—®é¢˜çš„å‡ ç§è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="æ‰¾å‡ºæ¨¡å—ä¸­çš„å…¨éƒ¨ç­–ç•¥">æ‰¾å‡ºæ¨¡å—ä¸­çš„å…¨éƒ¨ç­–ç•¥</h2><p>åœ¨Pythonä¸­ï¼Œæ¨¡å—ä¹Ÿæ˜¯ä¸€ç­‰å¯¹è±¡ï¼Œè€Œä¸”æ ‡å‡†åº“æä¾›äº†å‡ ä¸ªå¤„ç†æ¨¡å—çš„å‡½æ•°ã€‚</p><blockquote><p><code>globals()</code></p><p>è¿”å›žä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºå½“å‰çš„å…¨å±€ç¬¦å·è¡¨ã€‚è¿™ä¸ªç¬¦å·è¡¨å§‹ç»ˆé’ˆå¯¹å½“å‰æ¨¡å—ï¼ˆå¯¹å‡½æ•°æˆ–æ–¹æ³•æ¥è¯´ï¼Œæ˜¯æŒ‡å®šä¹‰å®ƒä»¬çš„æ¨¡å—ï¼Œè€Œä¸æ˜¯è°ƒç”¨å®ƒä»¬çš„æ¨¡å—ï¼‰ã€‚</p></blockquote><p>ç¤ºä¾‹ï¼šä½¿ç”¨globalså‡½æ•°å¸®åŠ©best_promoè‡ªåŠ¨æ‰¾åˆ°å…¶ä»–å¯ç”¨çš„*_promoå‡½æ•°ï¼Œè¿‡ç¨‹ä¼˜ç‚¹æ›²æŠ˜ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">promos = [globals()[name] <span class="keyword">for</span> name <span class="keyword">in</span> globals()</span><br><span class="line">          <span class="keyword">if</span> name.endswith(<span class="string">'_promo'</span>)</span><br><span class="line">          <span class="keyword">and</span> name != <span class="string">'best_promo'</span>]  <span class="comment"># è¿‡æ»¤æŽ‰best_promoè‡ªèº«ï¼Œé˜²æ­¢æ— é™é€’å½’</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">best_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> max(promo(order) <span class="keyword">for</span> promo <span class="keyword">in</span> promos)</span><br></pre></td></tr></table></figure><p>æ”¶é›†æ‰€æœ‰å¯ç”¨ä¿ƒé”€çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ä¸­ä¿å­˜æ‰€æœ‰ç­–ç•¥å‡½æ•°ï¼ŒæŠŠbest_promoæŽ’é™¤åœ¨å¤–ã€‚</p><figure class="highlight python"><figcaption><span>promotions.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fidelity_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""ä¸ºç§¯åˆ†ä¸º1000æˆ–ä»¥ä¸Šçš„é¡¾å®¢æä¾›5%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> order.total() * <span class="number">.05</span> <span class="keyword">if</span> order.customer.fidelity &gt;= <span class="number">1000</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bulk_item_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""å•ä¸ªå•†å“ä¸º20ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›10%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">large_order_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ°10ä¸ªæˆ–ä»¥ä¸Šæ—¶æä¾›7%æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> promotions</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">promos = [func <span class="keyword">for</span> name, func <span class="keyword">in</span> inspect.getmembers(promotions, inspect.isfunction)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">best_promo</span><span class="params">(order)</span>:</span></span><br><span class="line">    <span class="string">"""é€‰æ‹©å¯ç”¨çš„æœ€ä½³æŠ˜æ‰£"""</span></span><br><span class="line">    <span class="keyword">return</span> max(promo(order) <span class="keyword">for</span> promo <span class="keyword">in</span> promos)</span><br></pre></td></tr></table></figure><p>ä¸ç®¡æ€Žä¹ˆå‘½åç­–ç•¥å‡½æ•°ï¼Œä¸Šè¿°ç¤ºä¾‹éƒ½å¯ç”¨ã€‚å”¯ä¸€é‡è¦çš„æ˜¯ï¼Œpromotionsæ¨¡å—åªèƒ½åŒ…å«è®¡ç®—è®¢å•æŠ˜æ‰£çš„å‡½æ•°ã€‚å¦‚æžœæœ‰äººåœ¨promotionsæ¨¡å—ä¸­ä½¿ç”¨ä¸åŒçš„ç­¾åå®šä¹‰å‡½æ•°ï¼Œé‚£ä¹ˆbest_promoå‡½æ•°å°è¯•å°†å…¶åº”ç”¨åˆ°è®¢å•ä¸Šæ—¶ä¼šå‡ºé”™ã€‚å¯ä»¥æ·»åŠ æ›´ä¸ºä¸¥æ ¼çš„æµ‹è¯•ï¼Œå®¡æŸ¥ä¼ ç»™å®žä¾‹çš„å‚æ•°ï¼Œè¿›ä¸€æ­¥è¿‡æ»¤å‡½æ•°ã€‚ä¸Šè¿°ç¤ºä¾‹çš„ç›®çš„ä¸æ˜¯æä¾›å®Œå–„çš„æ–¹æ¡ˆï¼Œè€Œæ˜¯å¼ºè°ƒæ¨¡å—å†…çœçš„ä¸€ç§ç”¨é€”ã€‚</p><p>åŠ¨æ€æ”¶é›†ä¿ƒé”€æŠ˜æ‰£å‡½æ•°æ›´ä¸ºæ˜¾å¼çš„ä¸€ç§æ–¹æ¡ˆæ˜¯ä½¿ç”¨ç®€å•çš„è£…é¥°å™¨ã€‚</p><h1 id="å‘½ä»¤æ¨¡å¼">å‘½ä»¤æ¨¡å¼</h1><p>å‘½ä»¤è®¾è®¡æ¨¡å¼ä¹Ÿå¯ä»¥é€šè¿‡æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è€Œç®€åŒ–ã€‚</p><img src="http://www.plantuml.com/plantuml/svg/XPB1IiD054NtynMFhdIHG6kpAuBejkXUHAR9mmvqPa9c0fLQ4AJWIX3x1Q8W2EhABgH_KzD-Xed9n9cuw2plE-zov_A6B4907kjBuCW7c91mH9M2WpWUiP1g9aMbz56aX0wKJcYeuL1oJaK44mBvcnXz2ZZ6CDMuiqkcrU9nZCB5_pCdL6dS1lLfcCXjq94CKuv2Lm0J2XDzhd6iVo6pthloF3kPEx3Zk1Cx0x5AWfvhLxG5qZCz4UU3dhTVvoH_edJTxTwyqo6B8XHd2RiOwaP0rxj1EfP2QeJMzzjZThjOlxwtW2eGxKhUVDoivo-RwrafTmnzlrnzFPNQNgLbTy_P_BD6kmQTBLRB1tiX8A8Dlk-Sa-Y0NrwJoUmNpdQP-KPXsiqdTKzs7SKySFzTIiw9b59z4CrcHF03"><p>èœå•é©±åŠ¨çš„æ–‡æœ¬ç¼–è¾‘å™¨çš„UMLç±»å›¾ï¼Œä½¿ç”¨å‘½ä»¤è®¾è®¡æ¨¡å¼å®žçŽ°ã€‚å„ä¸ªå‘½ä»¤å¯ä»¥æœ‰ä¸åŒçš„æŽ¥æ”¶è€…ï¼ˆå®žçŽ°æ“ä½œçš„å¯¹è±¡ï¼‰ã€‚å¯¹PasteCommandæ¥è¯´ï¼ŒæŽ¥æ”¶è€…æ˜¯Documentã€‚å¯¹OpenCommandæ¥è¯´ï¼ŒæŽ¥æ”¶è€…æ˜¯åº”ç”¨ç¨‹åºã€‚</p><p>å‘½ä»¤æ¨¡å¼çš„ç›®çš„æ˜¯è§£è€¦è°ƒç”¨æ“ä½œå¯¹è±¡ï¼ˆè°ƒç”¨è€…ï¼‰å’Œæä¾›å®žçŽ°çš„å¯¹è±¡ï¼ˆæŽ¥æ”¶è€…ï¼‰ã€‚è¿™ä¸ªæ¨¡å¼çš„åšæ³•æ˜¯ï¼Œåœ¨äºŒè€…ä¹‹é—´æ”¾ä¸€ä¸ªCommandå¯¹è±¡ï¼Œè®©å®ƒå®žçŽ°åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼ˆexecuteï¼‰çš„æŽ¥å£ï¼Œè°ƒç”¨æŽ¥æ”¶è€…ä¸­çš„æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚è¿™æ ·ï¼Œè°ƒç”¨è€…æ— éœ€äº†è§£æŽ¥æ”¶è€…çš„æŽ¥å£ï¼Œè€Œä¸”ä¸åŒçš„æŽ¥æ”¶è€…å¯ä»¥é€‚åº”ä¸åŒçš„Commandå­ç±»ã€‚è°ƒç”¨è€…æœ‰ä¸€ä¸ªå…·ä½“çš„å‘½ä»¤ï¼Œé€šè¿‡è°ƒç”¨executeæ–¹æ³•æ‰§è¡Œã€‚MacroCommandå¯èƒ½ä¿å­˜ä¸€ç³»åˆ—å‘½ä»¤ï¼Œå®ƒçš„execute()æ–¹æ³•ä¼šåœ¨å„ä¸ªå‘½ä»¤ä¸Šè°ƒç”¨ç›¸åŒçš„æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¸ä¸ºè°ƒç”¨è€…æä¾›ä¸€ä¸ªCommandå®žä¾‹ï¼Œè€Œæ˜¯ç»™å®ƒä¸€ä¸ªå‡½æ•°ã€‚æ­¤æ—¶ï¼Œè°ƒç”¨è€…ä¸ç”¨è°ƒç”¨command.execute()ï¼Œç›´æŽ¥è°ƒç”¨command()å³å¯ã€‚MacroCommandå¯ä»¥å®žçŽ°æˆå®šä¹‰äº†<code>__call__</code>æ–¹æ³•çš„ç±»ã€‚è¿™æ ·ï¼ŒMacroCommandçš„å®žä¾‹å°±æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼Œå„è‡ªç»´æŠ¤ç€ä¸€ä¸ªå‡½æ•°åˆ—è¡¨ï¼Œä¾›ä»¥åŽè°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MacroCommand</span>:</span></span><br><span class="line">    <span class="string">"""ä¸€ä¸ªæ‰§è¡Œä¸€ç»„å‘½ä»¤çš„å‘½ä»¤"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, commands)</span>:</span></span><br><span class="line">        self.commands = list(commands)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> command <span class="keyword">in</span> self.commands:</span><br><span class="line">            command()</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€ç­‰å‡½æ•°å¯¹å‘½ä»¤æ¨¡å¼çš„é‡æ–°å®¡è§†åˆ°æ­¤ç»“æŸã€‚ç«™åœ¨ä¸€å®šé«˜åº¦ä¸Šçœ‹ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ–¹å¼ä¸Žç­–ç•¥æ¨¡å¼æ‰€ç”¨çš„ç±»ä¼¼ï¼š<strong>æŠŠå®žçŽ°å•æ–¹æ³•æŽ¥å£çš„ç±»çš„å®žä¾‹æ›¿æ¢æˆå¯è°ƒç”¨å¯¹è±¡</strong>ã€‚æ¯•ç«Ÿï¼Œæ¯ä¸ªPythonå¯è°ƒç”¨å¯¹è±¡éƒ½å®žçŽ°äº†å•æ–¹æ³•æŽ¥å£ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯<code>__call__</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> command </tag>
            
            <tag> design patterns </tag>
            
            <tag> Fluent Python </tag>
            
            <tag> first-class functions </tag>
            
            <tag> strategy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>networkx all simple paths</title>
      <link href="/source-code/networkx-all-simple-paths/"/>
      <url>/source-code/networkx-all-simple-paths/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><figcaption><span>simple_paths.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all_simple_paths</span><span class="params">(G, source, target, cutoff=None)</span>:</span></span><br><span class="line">    <span class="string">"""Generate all simple paths in the graph G from source to target.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A simple path is a path with no repeated nodes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    G : NetworkX graph</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    source : node</span></span><br><span class="line"><span class="string">       Starting node for path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    target : nodes</span></span><br><span class="line"><span class="string">       Single node or iterable of nodes at which to end path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    cutoff : integer, optional</span></span><br><span class="line"><span class="string">        Depth to stop the search. Only paths of length &lt;= cutoff are returned.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns</span></span><br><span class="line"><span class="string">    -------</span></span><br><span class="line"><span class="string">    path_generator: generator</span></span><br><span class="line"><span class="string">       A generator that produces lists of simple paths.  If there are no paths</span></span><br><span class="line"><span class="string">       between the source and target within the given cutoff the generator</span></span><br><span class="line"><span class="string">       produces no output.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Examples</span></span><br><span class="line"><span class="string">    --------</span></span><br><span class="line"><span class="string">    This iterator generates lists of nodes::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; G = nx.complete_graph(4)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; for path in nx.all_simple_paths(G, source=0, target=3):</span></span><br><span class="line"><span class="string">        ...     print(path)</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        [0, 1, 2, 3]</span></span><br><span class="line"><span class="string">        [0, 1, 3]</span></span><br><span class="line"><span class="string">        [0, 2, 1, 3]</span></span><br><span class="line"><span class="string">        [0, 2, 3]</span></span><br><span class="line"><span class="string">        [0, 3]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    You can generate only those paths that are shorter than a certain</span></span><br><span class="line"><span class="string">    length by using the `cutoff` keyword argument::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; paths = nx.all_simple_paths(G, source=0, target=3, cutoff=2)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; print(list(paths))</span></span><br><span class="line"><span class="string">        [[0, 1, 3], [0, 2, 3], [0, 3]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    To get each path as the corresponding list of edges, you can use the</span></span><br><span class="line"><span class="string">    :func:`networkx.utils.pairwise` helper function::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; paths = nx.all_simple_paths(G, source=0, target=3)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; for path in map(nx.utils.pairwise, paths):</span></span><br><span class="line"><span class="string">        ...     print(list(path))</span></span><br><span class="line"><span class="string">        [(0, 1), (1, 2), (2, 3)]</span></span><br><span class="line"><span class="string">        [(0, 1), (1, 3)]</span></span><br><span class="line"><span class="string">        [(0, 2), (2, 1), (1, 3)]</span></span><br><span class="line"><span class="string">        [(0, 2), (2, 3)]</span></span><br><span class="line"><span class="string">        [(0, 3)]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Pass an iterable of nodes as target to generate all paths ending in any of several nodes::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; G = nx.complete_graph(4)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; for path in nx.all_simple_paths(G, source=0, target=[3, 2]):</span></span><br><span class="line"><span class="string">        ...     print(path)</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        [0, 1, 2]</span></span><br><span class="line"><span class="string">        [0, 1, 2, 3]</span></span><br><span class="line"><span class="string">        [0, 1, 3]</span></span><br><span class="line"><span class="string">        [0, 1, 3, 2]</span></span><br><span class="line"><span class="string">        [0, 2]</span></span><br><span class="line"><span class="string">        [0, 2, 1, 3]</span></span><br><span class="line"><span class="string">        [0, 2, 3]</span></span><br><span class="line"><span class="string">        [0, 3]</span></span><br><span class="line"><span class="string">        [0, 3, 1, 2]</span></span><br><span class="line"><span class="string">        [0, 3, 2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Iterate over each path from the root nodes to the leaf nodes in a</span></span><br><span class="line"><span class="string">    directed acyclic graph using a functional programming approach::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; from itertools import chain</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; from itertools import product</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; from itertools import starmap</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; from functools import partial</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; chaini = chain.from_iterable</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; G = nx.DiGraph([(0, 1), (1, 2), (0, 3), (3, 2)])</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; roots = (v for v, d in G.in_degree() if d == 0)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; leaves = (v for v, d in G.out_degree() if d == 0)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; all_paths = partial(nx.all_simple_paths, G)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; list(chaini(starmap(all_paths, product(roots, leaves))))</span></span><br><span class="line"><span class="string">        [[0, 1, 2], [0, 3, 2]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The same list computed using an iterative approach::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; G = nx.DiGraph([(0, 1), (1, 2), (0, 3), (3, 2)])</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; roots = (v for v, d in G.in_degree() if d == 0)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; leaves = (v for v, d in G.out_degree() if d == 0)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; all_paths = []</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; for root in roots:</span></span><br><span class="line"><span class="string">        ...     for leaf in leaves:</span></span><br><span class="line"><span class="string">        ...         paths = nx.all_simple_paths(G, root, leaf)</span></span><br><span class="line"><span class="string">        ...         all_paths.extend(paths)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; all_paths</span></span><br><span class="line"><span class="string">        [[0, 1, 2], [0, 3, 2]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Iterate over each path from the root nodes to the leaf nodes in a</span></span><br><span class="line"><span class="string">    directed acyclic graph passing all leaves together to avoid unnecessary</span></span><br><span class="line"><span class="string">    compute::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; G = nx.DiGraph([(0, 1), (2, 1), (1, 3), (1, 4)])</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; roots = (v for v, d in G.in_degree() if d == 0)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; leaves = [v for v, d in G.out_degree() if d == 0]</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; all_paths = []</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; for root in roots:</span></span><br><span class="line"><span class="string">        ...     paths = nx.all_simple_paths(G, root, leaves)</span></span><br><span class="line"><span class="string">        ...     all_paths.extend(paths)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; all_paths</span></span><br><span class="line"><span class="string">        [[0, 1, 3], [0, 1, 4], [2, 1, 3], [2, 1, 4]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Notes</span></span><br><span class="line"><span class="string">    -----</span></span><br><span class="line"><span class="string">    This algorithm uses a modified depth-first search to generate the</span></span><br><span class="line"><span class="string">    paths [1]_.  A single path can be found in $O(V+E)$ time but the</span></span><br><span class="line"><span class="string">    number of simple paths in a graph can be very large, e.g. $O(n!)$ in</span></span><br><span class="line"><span class="string">    the complete graph of order $n$.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    References</span></span><br><span class="line"><span class="string">    ----------</span></span><br><span class="line"><span class="string">    .. [1] R. Sedgewick, "Algorithms in C, Part 5: Graph Algorithms",</span></span><br><span class="line"><span class="string">       Addison Wesley Professional, 3rd ed., 2001.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    See Also</span></span><br><span class="line"><span class="string">    --------</span></span><br><span class="line"><span class="string">    all_shortest_paths, shortest_path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> source <span class="keyword">not</span> <span class="keyword">in</span> G:</span><br><span class="line">        <span class="keyword">raise</span> nx.NodeNotFound(<span class="string">'source node %s not in graph'</span> % source)</span><br><span class="line">    <span class="keyword">if</span> target <span class="keyword">in</span> G:</span><br><span class="line">        targets = &#123;target&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            targets = set(target)</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">raise</span> nx.NodeNotFound(<span class="string">'target node %s not in graph'</span> % target)</span><br><span class="line">    <span class="keyword">if</span> source <span class="keyword">in</span> targets:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">if</span> cutoff <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        cutoff = len(G) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> cutoff &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="keyword">if</span> G.is_multigraph():</span><br><span class="line">        <span class="keyword">return</span> _all_simple_paths_multigraph(G, source, targets, cutoff)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> _all_simple_paths_graph(G, source, targets, cutoff)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># source: single node</span></span><br><span class="line"><span class="comment"># targets: set of nodes</span></span><br><span class="line"><span class="comment"># cutoff: maximum edges in a path</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_all_simple_paths_graph</span><span class="params">(G, source, targets, cutoff)</span>:</span></span><br><span class="line">    visited = collections.OrderedDict.fromkeys([source])</span><br><span class="line">    stack = [iter(G[source])]  <span class="comment"># æ·»åŠ é‚»æŽ¥ç»“ç‚¹ã€‚G[node]ç±»ä¼¼äºŽå­—å…¸ï¼Œkeyæ˜¯é‚»æŽ¥ç»“ç‚¹ï¼Œvalueæ˜¯è¾¹çš„å±žæ€§</span></span><br><span class="line">    <span class="keyword">while</span> stack:  <span class="comment"># len(stack) &gt; 0æ—¶ï¼Œbool(stack) = True</span></span><br><span class="line">        children = stack[<span class="number">-1</span>]</span><br><span class="line">        child = next(children, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> child <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            stack.pop()  <span class="comment"># å›žé€€åˆ°ä¸Šä¸€ä¸ªè®¿é—®ç»“ç‚¹</span></span><br><span class="line">            visited.popitem()  <span class="comment"># å·²è®¿é—®ç»“ç‚¹åšåŒæ ·çš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">elif</span> len(visited) &lt; cutoff:</span><br><span class="line">            <span class="keyword">if</span> child <span class="keyword">in</span> visited:  <span class="comment"># è·³è¿‡å·²è®¿é—®ç»“ç‚¹</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> child <span class="keyword">in</span> targets:</span><br><span class="line">                <span class="keyword">yield</span> list(visited) + [child]</span><br><span class="line">            visited[child] = <span class="literal">None</span>  <span class="comment"># å°†å½“å‰ç»“ç‚¹æ”¾å…¥visitedä¸­ï¼Œå€¼æ— æ‰€è°“ï¼Œè¿™é‡Œç”¨çš„æ˜¯None</span></span><br><span class="line">            <span class="keyword">if</span> targets - set(visited.keys()):  <span class="comment"># å¦‚æžœå­˜åœ¨å°šæœªè®¿é—®çš„ç›®æ ‡</span></span><br><span class="line">                stack.append(iter(G[child]))  <span class="comment"># å½“å‰ç»“ç‚¹çš„é‚»æŽ¥ç»“ç‚¹å…¥æ ˆ</span></span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># æ‰€æœ‰ç›®æ ‡å‡å·²è®¿é—®</span></span><br><span class="line">                visited.popitem()  <span class="comment"># åœæ­¢å¯»æ‰¾</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># len(visited) == cutoff:</span></span><br><span class="line">            <span class="comment"># set(children) | &#123;child&#125;: å‰©ä½™çš„æœªè®¿é—®ç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> target <span class="keyword">in</span> (targets &amp; (set(children) | &#123;child&#125;)) - set(visited.keys()):</span><br><span class="line">                <span class="keyword">yield</span> list(visited) + [target]</span><br><span class="line">            stack.pop()</span><br><span class="line">            visited.popitem()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_all_simple_paths_multigraph</span><span class="params">(G, source, targets, cutoff)</span>:</span></span><br><span class="line">    visited = collections.OrderedDict.fromkeys([source])</span><br><span class="line">    stack = [(v <span class="keyword">for</span> u, v <span class="keyword">in</span> G.edges(source))]  <span class="comment"># G.edges(u) returns all edges from u</span></span><br><span class="line">    <span class="comment"># so when there exsit multi-edges between u and v, the v can also appear repeatedly</span></span><br><span class="line">    <span class="keyword">while</span> stack:</span><br><span class="line">        children = stack[<span class="number">-1</span>]</span><br><span class="line">        child = next(children, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> child <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            stack.pop()</span><br><span class="line">            visited.popitem()</span><br><span class="line">        <span class="keyword">elif</span> len(visited) &lt; cutoff:</span><br><span class="line">            <span class="keyword">if</span> child <span class="keyword">in</span> visited:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> child <span class="keyword">in</span> targets:</span><br><span class="line">                <span class="keyword">yield</span> list(visited) + [child]</span><br><span class="line">            visited[child] = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> targets - set(visited.keys()):</span><br><span class="line">                stack.append((v <span class="keyword">for</span> u, v <span class="keyword">in</span> G.edges(child)))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                visited.popitem()</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># len(visited) == cutoff:</span></span><br><span class="line">            <span class="keyword">for</span> target <span class="keyword">in</span> targets - set(visited.keys()):</span><br><span class="line">                count = ([child] + list(children)).count(target)</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(count):</span><br><span class="line">                    <span class="keyword">yield</span> list(visited) + [target]</span><br><span class="line">            stack.pop()</span><br><span class="line">            visited.popitem()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithms </tag>
            
            <tag> stack </tag>
            
            <tag> networkx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python repr å‡½æ•°</title>
      <link href="/programming/python-repr-method/"/>
      <url>/programming/python-repr-method/</url>
      
        <content type="html"><![CDATA[<h1 id="repr">repr</h1><blockquote><p><a href="https://devdocs.io/python~3.6/library/functions#repr" target="_blank" rel="noopener"><code>repr(object)</code></a></p><p>Return a string containing a printable representation of an object. For many types, this function makes an attempt to return a string that would yield an object with the same value when passed to eval(), otherwise the representation is a string enclosed in angle brackets that contains the name of the type of the object together with additional information often including the name and address of the object.</p></blockquote><p>reprçš„è¿”å›žç»“æžœå¤§è‡´æœ‰ä¸¤ç§ç±»åž‹ï¼š</p><ul><li>è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ‰€ä»£è¡¨çš„ä»£ç ä¸ŽåŽŸå¯¹è±¡ç›¸åŒï¼Œå³ <code>eval(repr(object) == object</code>ã€‚</li><li>è¿”å›žä¸€ç»„å°–æ‹¬å·ï¼Œæ‹¬å·å†…åŒ…å«äº†å¯¹è±¡çš„åç§°å’Œåœ°å€ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Student = namedtuple(<span class="string">'Student'</span>, <span class="string">'id name gender'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>alice = Student(<span class="number">1</span>, <span class="string">'Alice'</span>, <span class="string">'female'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>alice</span><br><span class="line">Student(id=<span class="number">1</span>, name=<span class="string">'Alice'</span>, gender=<span class="string">'female'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval(repr(alice)) == alice</span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, id, name, gender)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.id, self.name, self.gender = id, name, gender</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john = Person(<span class="number">2</span>, <span class="string">'John'</span>, <span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john</span><br><span class="line">&lt;__main__.Person object at <span class="number">0x10bf970b8</span>&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="è‡ªå®šä¹‰è¿”å›žå€¼">è‡ªå®šä¹‰è¿”å›žå€¼</h1><p>è‡ªå®šä¹‰è¿”å›žå€¼åªéœ€å®žçŽ° <code>__repr__</code> æ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°é»˜è®¤çš„è¾“å‡ºæ˜¯ç¬¬äºŒç§ï¼Œæƒ³å®žçŽ°ç±»ä¼¼ç¬¬ä¸€ç§å¯ä»¥åƒä¸‹é¢è¿™æ ·åšã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> <span class="string">"%s(%s)"</span> % (self.__class__.__name__, <span class="string">', '</span>.join(<span class="string">'%s=%r'</span> % (k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__dict__.items()))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person.__repr__ = func</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john</span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval(repr(john)) == john</span><br><span class="line"><span class="literal">False</span>                  <span class="comment"># ä¸ç›¸ç­‰æ˜¯å› ä¸ºæ²¡æœ‰å®šä¹‰__eq__</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval(repr(john))   <span class="comment"># ä½†å†…å®¹æ˜¯ç›¸åŒçš„</span></span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šå¯¹ç®€å•ç±»é€šç”¨ã€‚</p><p>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šè¾“å‡ºä¸å¸Œæœ›è¢«çœ‹åˆ°çš„ç§æœ‰å±žæ€§ã€‚å¦‚æžœå†…éƒ¨å˜é‡æœ‰å¾ªçŽ¯å¼•ç”¨çš„è¯ä¼šé™·å…¥æ— é™é€’å½’ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry = Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john = Person(<span class="number">2</span>, <span class="string">'John'</span>, <span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry._sepouse = john  <span class="comment"># ä¸æƒ³è¢«çœ‹åˆ°çš„ä¿¡æ¯</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry</span><br><span class="line">Person(id=<span class="number">3</span>, name=<span class="string">'Marry'</span>, gender=<span class="string">'female'</span>, _sepouse=Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john._sepouse = marry  <span class="comment"># äº’ç›¸å¼•ç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john  <span class="comment"># æ— é™é€’å½’</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">2</span>, <span class="keyword">in</span> func</span><br><span class="line">  ...  <span class="comment"># çœç•¥</span></span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;genexpr&gt;</span><br><span class="line">RecursionError: maximum recursion depth exceeded</span><br></pre></td></tr></table></figure><h1 id="éšè—ç§æœ‰å±žæ€§">éšè—ç§æœ‰å±žæ€§</h1><p>å¸¸ç”¨åšæ³•ï¼šæŒ‡å®šä¼ å…¥çš„å­—å…¸å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, id, name, gender)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.id, self.name, self.gender = id, name, gender</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">"%s(%s)"</span> % (self.__class__.__name__, <span class="string">', '</span>.join(<span class="string">'%s=%r'</span> % (k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> self.get_params().items()))</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">get_params</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> dict(id=self.id, name=self.name, gender=self.gender)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john = Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry = Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john._sepouse = marry</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry._sepouse = john</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john</span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry</span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br></pre></td></tr></table></figure><h1 id="é¿å…æ— é™é€’å½’">é¿å…æ— é™é€’å½’</h1><p>reprlib æä¾›äº†ä¸€ä¸ªè£…é¥°å™¨ï¼Œèƒ½æ£€æµ‹é€’å½’è°ƒç”¨ï¼Œå¹¶ç”¨æŒ‡å®šçš„å­—ç¬¦ä»£æ›¿è°ƒç”¨ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/reprlib#reprlib.recursive_repr" target="_blank" rel="noopener"><code>@reprlib.recursive_repr(fillvalue=&quot;...&quot;)</code></a></p><p>Decorator for <code>__repr__()</code> methods to detect recursive calls within the same thread. If a recursive call is made, the fillvalue is returned, otherwise, the usual <code>__repr__()</code> call is made.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, id, name, gender)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.id, self.name, self.gender = id, name, gender</span><br><span class="line"><span class="meta">... </span>    @reprlib.recursive_repr()  <span class="comment"># å› ä¸ºè£…é¥°å™¨æœ‰å‚æ•°ï¼Œæ‰€ä»¥å¿…é¡»åŠ ä¸Š()</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">'%s(%s)'</span> % (type(self).__name__, <span class="string">', '</span>.join(<span class="string">'%s=%r'</span> % (k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__dict__.items()))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry = Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john = Person(<span class="number">2</span>, <span class="string">'John'</span>, <span class="string">'male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry</span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>)  <span class="comment"># æ— é€’å½’è°ƒç”¨æ—¶</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry._sepouse = john</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>john._sepouse = marry  <span class="comment"># æœ‰é€’å½’è°ƒç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>marry</span><br><span class="line">Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>, _sepouse=Person(id=<span class="number">2</span>, name=<span class="string">'John'</span>, gender=<span class="string">'male'</span>, _sepouse=...))</span><br></pre></td></tr></table></figure><h1 id="è§„é¿è¿‡é•¿çš„æè¿°">è§„é¿è¿‡é•¿çš„æè¿°</h1><p><code>repr()</code> å‡½æ•°çš„ç›®çš„æ˜¯æ–¹ä¾¿ç¨‹åºå‘˜æ£€æŸ¥ã€è°ƒè¯•ç¨‹åºã€‚å¦‚æžœå¯¹è±¡çš„å±žæ€§ä¸­åŒ…å«è¿‡é•¿çš„åˆ—è¡¨ã€å­—ç¬¦ä¸²ç­‰å±žæ€§ï¼Œæœ´ç´ çš„ <code>repr()</code> å‡½æ•°ä¼šæ‰“å°å…¨éƒ¨å†…å®¹ã€‚å…¶ç»“æžœä¼šåœ¨æŽ§åˆ¶å°æˆ–æ—¥å¿—æ–‡ä»¶ä¸­å æ®å¤§é‡ç¯‡å¹…ï¼Œä¸Žåˆè¡·ç›¸æ‚–ã€‚æ­¤æ—¶æŽ¨èçš„åšæ³•æ˜¯è¾“å‡ºå…¶ç®€ç•¥çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ä¸‡å¹¸ï¼Œæˆ‘ä»¬æ— éœ€é‡å¤é€ è½®å­ï¼Œä¹Ÿä¸ä¸€å®šé€ åœ°å¥½ã€‚<code>reprlib.repr()</code> å‡½æ•°èƒ½å¸®æˆ‘ä»¬è¾¾åˆ°é¢„æœŸçš„ç»“æžœã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/reprlib#reprlib.repr" target="_blank" rel="noopener"><code>reprlib.repr(obj)</code></a></p><p>This is the repr() method of aRepr. It returns a string similar to that returned by the built-in function of the same name, but with limits on most sizes.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.array(range(<span class="number">10000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a  <span class="comment"># numpyå°±åšäº†ç±»ä¼¼å¤„ç†</span></span><br><span class="line">array([   <span class="number">0</span>,    <span class="number">1</span>,    <span class="number">2</span>, ..., <span class="number">9997</span>, <span class="number">9998</span>, <span class="number">9999</span>])</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> reprlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = list(range(<span class="number">10000</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reprlib.repr(b)</span><br><span class="line"><span class="string">'[0, 1, 2, 3, 4, 5, ...]'</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> reprlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Text</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, content)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.content = content</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">'Text(%s)'</span> % reprlib.repr(self.content)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = Text(<span class="string">'The beginning to learn a programming language is to print "Hello World!"'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">Text(<span class="string">'The beginnin...Hello World!"'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> repr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ç­‰å‡½æ•°</title>
      <link href="/notes/fluent-python/first-class-functions/"/>
      <url>/notes/fluent-python/first-class-functions/</url>
      
        <content type="html"><![CDATA[<h1 id="æŠŠå‡½æ•°è¯•ä½œå¯¹è±¡">æŠŠå‡½æ•°è¯•ä½œå¯¹è±¡</h1><p>åœ¨ Python ä¸­ï¼Œæ•´æ•°ã€å­—ç¬¦ä¸²ã€å­—å…¸å’Œå‡½æ•°éƒ½æ˜¯ä¸€ç­‰å¯¹è±¡ã€‚â€œä¸€ç­‰å¯¹è±¡â€ä¸ºæ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„è¿‡ç¨‹å®žä½“ï¼š</p><ul><li>åœ¨è¿è¡Œæ—¶åˆ›å»º</li><li>èƒ½èµ‹å€¼ç»™å˜é‡æˆ–æ•°æ®ç»“æž„ä¸­çš„å…ƒç´ </li><li>èƒ½ä½œä¸ºå‚æ•°ä¼ ç»™å‡½æ•°</li><li>èƒ½ä½œä¸ºå‡½æ•°çš„è¿”å›žç»“æžœ</li></ul><p>äººä»¬ç»å¸¸å°†â€œæŠŠå‡½æ•°è§†ä½œä¸€ç­‰å¯¹è±¡â€ç®€ç§°ä¸ºâ€œä¸€ç­‰å‡½æ•°â€ã€‚è¿™æ ·è¯´å¹¶ä¸å®Œç¾Žï¼Œä¼¼ä¹Žè¡¨æ˜Žè¿™æ˜¯å‡½æ•°ä¸­çš„ç‰¹æ®Šç¾¤ä½“ã€‚åœ¨ Python ä¸­ï¼Œæ‰€æœ‰å‡½æ•°éƒ½æ˜¯ä¸€ç­‰å¯¹è±¡ã€‚</p><a id="more"></a><h1 id="é«˜é˜¶å‡½æ•°">é«˜é˜¶å‡½æ•°</h1><p>æŽ¥å—å‡½æ•°ä¸ºå‚æ•°ï¼Œæˆ–è€…æŠŠå‡½æ•°ä½œä¸ºç»“æžœè¿”å›žçš„å‡½æ•°éƒ½æ˜¯é«˜é˜¶å‡½æ•°ï¼ˆhigher-order functionï¼‰ã€‚ä½¿ç”¨é«˜é˜¶å‡½æ•°æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚å¸¸è§çš„é«˜é˜¶å‡½æ•°æœ‰ <code>max</code>, <code>min</code>, <code>sorted</code>, <code>map</code>, <code>filter</code>, <code>reduce</code>ã€‚</p><p><code>max</code>, <code>min</code>, <code>sorted</code> ä¸­çš„ key å‚æ•°æŽ¥å—å‡½æ•°ï¼Œä»»ä½•å•å‚æ•°å‡½æ•°éƒ½èƒ½ä½œä¸º key å‚æ•°çš„å€¼ã€‚ä¾‹å¦‚ï¼Œæƒ³æ ¹æ®å•è¯é•¿åº¦æŽ’åºæ—¶ï¼Œåªéœ€æŠŠ len å‡½æ•°ä¼ å…¥ã€‚è‹¥æƒ³åˆ›å»ºæŠ¼éŸµè¯å…¸ï¼ˆæ°´æžœä¸­çš„å„ç±»æµ†æžœ *berry éƒ½æŽ’åœ¨ä¸€èµ·ï¼‰ï¼Œå¯ä»¥æŠŠå„ä¸ªå•è¯åè¿‡æ¥æ‹¼å†™ï¼Œç„¶åŽæŽ’åºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits = [<span class="string">'strawberry'</span>, <span class="string">'fig'</span>, <span class="string">'apple'</span>, <span class="string">'cherry'</span>, <span class="string">'raspberry'</span>, <span class="string">'banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(fruits, key=len)</span><br><span class="line">[<span class="string">'fig'</span>, <span class="string">'apple'</span>, <span class="string">'cherry'</span>, <span class="string">'banana'</span>, <span class="string">'raspberry'</span>, <span class="string">'strawberry'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(fruits, key=<span class="keyword">lambda</span> i: i[::<span class="number">-1</span>])</span><br><span class="line">[<span class="string">'banana'</span>, <span class="string">'apple'</span>, <span class="string">'fig'</span>, <span class="string">'raspberry'</span>, <span class="string">'strawberry'</span>, <span class="string">'cherry'</span>]</span><br></pre></td></tr></table></figure><p><code>map</code>, <code>filter</code>, <code>reduce</code> åœ¨å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸‹éƒ½æœ‰æ›´å¥½çš„æ›¿ä»£å“ã€‚</p><h2 id="mapfilterå’Œreduceçš„æ›¿ä»£å“">mapã€filterå’Œreduceçš„æ›¿ä»£å“</h2><p>åœ¨ Python3 ä¸­ï¼Œ<code>map</code> å’Œ <code>filter</code> è¿”å›žç”Ÿæˆå™¨ï¼ˆä¸€ç§è¿­ä»£å™¨ï¼‰ï¼Œå› æ­¤å®ƒä»¬çš„ç›´æŽ¥æ›¿ä»£å“æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆåœ¨ Python2 ä¸­ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°è¿”å›žåˆ—è¡¨ï¼Œå› æ­¤æœ€æŽ¥è¿‘çš„æ›¿ä»£å“æ˜¯åˆ—è¡¨æŽ¨å¯¼ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="string">"""Returns n!"""</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> n * fact(n - <span class="number">1</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>map(fact, range(<span class="number">6</span>))</span><br><span class="line">&lt;map object at <span class="number">0x10c597f98</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>(fact(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">6</span>))</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x10c58b780</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(fact, range(<span class="number">6</span>)))</span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[fact(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">6</span>)]</span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">120</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(fact, filter(<span class="keyword">lambda</span> n: n % <span class="number">2</span>, range(<span class="number">6</span>))))</span><br><span class="line">[<span class="number">1</span>, <span class="number">6</span>, <span class="number">120</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[fact(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">6</span>) <span class="keyword">if</span> n % <span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">6</span>, <span class="number">120</span>]</span><br></pre></td></tr></table></figure><p><code>reduce</code> è¿™ä¸ªå‡½æ•°æœ€å¸¸ç”¨äºŽæ±‚å’Œï¼Œå¯ä½¿ç”¨ <code>sum</code> å‡½æ•°æ›¿ä»£ï¼Œåœ¨å¯è¯»æ€§å’Œæ€§èƒ½æ–¹é¢ï¼Œè¿™æ˜¯ä¸€é¡¹é‡å¤§æ”¹å–„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(add, range(<span class="number">100</span>))</span><br><span class="line"><span class="number">4950</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum(range(<span class="number">100</span>))</span><br><span class="line"><span class="number">4950</span></span><br></pre></td></tr></table></figure><h2 id="å½’çº¦å‡½æ•°">å½’çº¦å‡½æ•°</h2><p><code>sum</code> å’Œ <code>reduce</code> çš„é€šç”¨æ€æƒ³æ˜¯æŠŠæŸä¸ªæ“ä½œè¿žç»­åº”ç”¨åˆ°åºåˆ—çš„å…ƒç´ ä¸Šï¼Œç´¯è®¡ä¹‹å‰çš„ç»“æžœï¼ŒæŠŠä¸€ç³»åˆ—å€¼å½’çº¦æˆä¸€ä¸ªå€¼ã€‚<code>all</code> å’Œ <code>any</code> ä¹Ÿæ˜¯å†…ç½®çš„å½’çº¦å‡½æ•°ã€‚</p><blockquote><p><code>all(iterable)</code></p><p>Return True if all elements of the iterable are true (or if the iterable is empty).</p><p><code>any(iterable)</code></p><p>Return True if any element of the iterable is true. If the iterable is empty, return False.</p></blockquote><h1 id="åŒ¿åå‡½æ•°">åŒ¿åå‡½æ•°</h1><p>lambda å…³é”®å­—åœ¨ Python è¡¨è¾¾å¼å†…åˆ›å»ºåŒ¿åå‡½æ•°ã€‚ç„¶è€Œï¼ŒPython ç®€å•çš„å¥æ³•é™åˆ¶äº† lambda å‡½æ•°çš„å®šä¹‰ä½“åªèƒ½ä½¿ç”¨çº¯è¡¨è¾¾å¼ã€‚æ¢å¥è¯è¯´ï¼Œlambda å‡½æ•°çš„å®šä¹‰ä½“ä¸­ä¸èƒ½èµ‹å€¼ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ while å’Œ try ç­‰ Python è¯­å¥ã€‚</p><p>å¦‚æžœä½¿ç”¨ lambda è¡¨è¾¾å¼å¯¼è‡´ä¸€æ®µä»£ç éš¾ä»¥ç†è§£ï¼ŒFredrik Lundh å»ºè®®åƒä¸‹é¢è¿™æ ·é‡æž„ã€‚</p><p>ï¼ˆ1ï¼‰ç¼–å†™æ³¨é‡Šï¼Œè¯´æ˜Ž lambda è¡¨è¾¾å¼çš„ä½œç”¨ã€‚</p><p>ï¼ˆ2ï¼‰ç ”ç©¶ä¸€ä¼šæ³¨é‡Šï¼Œå¹¶æ‰¾å‡ºä¸€ä¸ªåç§°æ¥æ¦‚æ‹¬æ³¨é‡Šã€‚</p><p>ï¼ˆ3ï¼‰æŠŠ lambda è¡¨è¾¾å¼è½¬æ¢æˆdefè¯­å¥ï¼Œä½¿ç”¨é‚£ä¸ªåç§°æ¥å®šä¹‰å‡½æ•°ã€‚</p><p>ï¼ˆ4ï¼‰åˆ é™¤æ³¨é‡Šã€‚</p><p>ä¸Ždefè¯­å¥ä¸€æ ·ï¼Œlambda è¡¨è¾¾å¼ä¼šåˆ›å»ºå‡½æ•°å¯¹è±¡ã€‚è¿™æ˜¯ Python ä¸­å‡ ç§å¯è°ƒç”¨å¯¹è±¡çš„ä¸€ç§ã€‚</p><h1 id="å¯è°ƒç”¨å¯¹è±¡">å¯è°ƒç”¨å¯¹è±¡</h1><p>é™¤äº†ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œè°ƒç”¨è¿ç®—ç¬¦ï¼Œå³ <code>()</code>ï¼Œè¿˜å¯ä»¥åº”ç”¨åˆ°å…¶ä»–å¯¹è±¡ä¸Šã€‚å¦‚æžœæƒ³åˆ¤æ–­å¯¹è±¡èƒ½å¦è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ <code>callable</code> å‡½æ•°ã€‚Python æ•°æ®æ¨¡åž‹æ–‡æ¡£åˆ—å‡ºäº† 7 ç§å¯è°ƒç”¨å¯¹è±¡ã€‚</p><ul><li>ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼šä½¿ç”¨ def è¯­å¥æˆ– lambda è¡¨è¾¾å¼åˆ›å»ºã€‚</li><li>å†…ç½®å‡½æ•°ï¼šä½¿ç”¨ C è¯­è¨€ï¼ˆCPythonï¼‰å®žçŽ°çš„å‡½æ•°ï¼Œå¦‚ len æˆ– <code>time.strftime</code>ã€‚</li><li>å†…ç½®æ–¹æ³•ï¼šä½¿ç”¨ C è¯­è¨€å®žçŽ°çš„æ–¹æ³•ï¼Œå¦‚ <code>dict.get</code>ã€‚</li><li>æ–¹æ³•ï¼šåœ¨ç±»çš„å®šä¹‰ä½“ä¸­å®šä¹‰çš„å‡½æ•°ã€‚</li><li>ç±»ï¼šè°ƒç”¨ç±»æ—¶ä¼šè¿è¡Œç±»çš„ <code>__new__</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªå®žä¾‹ï¼Œç„¶åŽè¿è¡Œ <code>__init__</code> æ–¹æ³•ï¼Œåˆå§‹åŒ–å®žä¾‹ï¼Œæœ€åŽæŠŠå®žä¾‹è¿”å›žç»™è°ƒç”¨æ–¹ã€‚å› ä¸º Python æ²¡æœ‰ new è¿ç®—ç¬¦ï¼Œæ‰€ä»¥è°ƒç”¨ç±»ç›¸å½“äºŽè°ƒç”¨å‡½æ•°ã€‚</li><li>ç±»çš„å®žä¾‹ï¼šå¦‚æžœç±»å®šä¹‰äº† <code>__call__</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„å®žä¾‹å¯ä»¥ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚</li><li>ç”Ÿæˆå™¨å‡½æ•°ï¼šä½¿ç”¨ yield å…³é”®å­—çš„å‡½æ•°æˆ–æ–¹æ³•ã€‚è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°è¿”å›žçš„æ˜¯ç”Ÿæˆå™¨å¯¹è±¡ã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨å¾ˆå¤šæ–¹é¢ä¸Žå…¶ä»–å¯è°ƒç”¨å¯¹è±¡ä¸åŒã€‚</li></ul><p>Python ä¸­æœ‰å„ç§å„æ ·å¯è°ƒç”¨çš„ç±»åž‹ï¼Œå› æ­¤åˆ¤æ–­å¯¹è±¡èƒ½å¦è°ƒç”¨ï¼Œæœ€å®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®çš„ callable å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>abs, str, <span class="number">1</span></span><br><span class="line">(&lt;built-in function abs&gt;, &lt;class 'str'&gt;, 1)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[callable(obj) <span class="keyword">for</span> obj <span class="keyword">in</span> (abs, str, <span class="number">1</span>)]</span><br><span class="line">[<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>]</span><br></pre></td></tr></table></figure><h1 id="å‡½æ•°å†…çœ">å‡½æ•°å†…çœ</h1><p>å‡½æ•°å¯¹è±¡æœ‰å¾ˆå¤šå±žæ€§ã€‚ä½¿ç”¨ dir å‡½æ•°å¯ä»¥æŽ¢çŸ¥ fact å…·æœ‰ä»¥ä¸‹å±žæ€§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(fact)</span><br><span class="line">[<span class="string">'__annotations__'</span>, <span class="string">'__call__'</span>, <span class="string">'__class__'</span>, <span class="string">'__closure__'</span>, <span class="string">'__code__'</span>, <span class="string">'__defaults__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__get__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__globals__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__kwdefaults__'</span>, <span class="string">'__le__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__name__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__qualname__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¤§å¤šæ•°å±žæ€§æ˜¯ Python å¯¹è±¡å…±æœ‰çš„ã€‚</p><p>ä¸Žç”¨æˆ·å®šä¹‰çš„å¸¸è§„ç±»ä¸€æ ·ï¼Œå‡½æ•°ä½¿ç”¨ <code>__dict__</code> å±žæ€§å­˜å‚¨èµ‹äºˆå®ƒçš„ç”¨æˆ·å±žæ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºå‡½æ•°éšæ„èµ‹äºˆå±žæ€§ä¸æ˜¯å¾ˆå¸¸è§çš„åšæ³•ã€‚</p><p>ä¸‹é¢é‡ç‚¹è¯´æ˜Žå‡½æ•°ä¸“æœ‰è€Œç”¨æˆ·å®šä¹‰çš„ä¸€èˆ¬å¯¹è±¡æ²¡æœ‰çš„å±žæ€§ã€‚è®¡ç®—ä¸¤ä¸ªå±žæ€§é›†åˆçš„å·®é›†ä¾¿èƒ½å¾—åˆ°å‡½æ•°ä¸“æœ‰å±žæ€§åˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span> <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = C()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(set(dir(func)) - set(dir(obj)))</span><br><span class="line">[<span class="string">'__annotations__'</span>, <span class="string">'__call__'</span>, <span class="string">'__closure__'</span>, <span class="string">'__code__'</span>, <span class="string">'__defaults__'</span>, <span class="string">'__get__'</span>, <span class="string">'__globals__'</span>, <span class="string">'__kwdefaults__'</span>, <span class="string">'__name__'</span>, <span class="string">'__qualname__'</span>]</span><br></pre></td></tr></table></figure><table><thead><tr class="header"><th>åç§°</th><th>ç±»åž‹</th><th>è¯´æ˜Ž</th></tr></thead><tbody><tr class="odd"><td><code>__annotations__</code></td><td>dict</td><td>å‚æ•°å’Œè¿”å›žå€¼çš„æ³¨è§£</td></tr><tr class="even"><td><code>__call__</code></td><td>method-wrapper</td><td>å®žçŽ°()è¿ç®—ç¬¦ï¼šå³å¯è°ƒç”¨å¯¹è±¡åè®®</td></tr><tr class="odd"><td><code>__closure__</code></td><td>tuple</td><td>å‡½æ•°é—­åŒ…ï¼Œå³è‡ªç”±å˜é‡çš„ç»‘å®šï¼ˆé€šå¸¸æ˜¯Noneï¼‰</td></tr><tr class="even"><td><code>__code__</code></td><td>code</td><td>ç¼–è¯‘æˆå­—èŠ‚ç çš„å‡½æ•°å…ƒæ•°æ®å’Œå‡½æ•°å®šä¹‰ä½“</td></tr><tr class="odd"><td><code>__defaults__</code></td><td>tuple</td><td>å½¢å¼å‚æ•°çš„é»˜è®¤å€¼</td></tr><tr class="even"><td><code>__get__</code></td><td>method-wrapper</td><td>å®žçŽ°åªè¯»æè¿°ç¬¦åè®®</td></tr><tr class="odd"><td><code>__globals__</code></td><td>dict</td><td>å‡½æ•°æ‰€åœ¨æ¨¡å—ä¸­çš„å…¨å±€å˜é‡</td></tr><tr class="even"><td><code>__kwdefaults__</code></td><td>dict</td><td>ä»…é™å…³é”®å­—å½¢å¼å‚æ•°çš„é»˜è®¤å€¼</td></tr><tr class="odd"><td><code>__name__</code></td><td>str</td><td>å‡½æ•°åç§°</td></tr><tr class="even"><td><code>__qualname__</code></td><td>str</td><td>å‡½æ•°çš„é™å®šåç§°ï¼Œå¦‚Random.choiceï¼ˆ<a href="https://www.python.org/dev/peps/pep-3155/" target="_blank" rel="noopener">å‚é˜…PEP 3155</a>ï¼‰</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> first-class functions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»Žå®šä½å‚æ•°åˆ°ä»…é™å…³é”®å­—å‚æ•°</title>
      <link href="/notes/fluent-python/from-positional-to-keyword-only-parameters/"/>
      <url>/notes/fluent-python/from-positional-to-keyword-only-parameters/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»Žå®šä½å‚æ•°åˆ°ä»…é™å…³é”®å­—å‚æ•°">ä»Žå®šä½å‚æ•°åˆ°ä»…é™å…³é”®å­—å‚æ•°</h1><p>Pythonæœ€å¥½çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯æä¾›äº†æžä¸ºçµæ´»çš„å‚æ•°å¤„ç†æœºåˆ¶ï¼Œè€Œä¸”Python3è¿›ä¸€æ­¥æä¾›äº†ä»…é™å…³é”®å­—å‚æ•°ï¼ˆkeyword-only argumentï¼‰ã€‚ä¸Žä¹‹å¯†åˆ‡ç›¸å…³çš„æ˜¯ï¼Œè°ƒç”¨å‡½æ•°æ—¶ä½¿ç”¨<code>*</code>å’Œ<code>**</code>â€œå±•å¼€â€å¯è¿­ä»£å¯¹è±¡ï¼Œæ˜ å°„åˆ°å•ä¸ªå‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(name, *content, cls=None, **attrs)</span>:</span></span><br><span class="line">    <span class="string">"""ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªHTMLæ ‡ç­¾"""</span></span><br><span class="line">    <span class="keyword">if</span> cls <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        attrs[<span class="string">'class'</span>] = cls</span><br><span class="line">    <span class="keyword">if</span> attrs:</span><br><span class="line">        attr_str = <span class="string">''</span>.join(<span class="string">' %s="%s"'</span> % (attr, value)</span><br><span class="line">            <span class="keyword">for</span> attr, value <span class="keyword">in</span> sorted(attrs.items()))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        attr_str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> content:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'\n'</span>.join(<span class="string">'&lt;%s%s&gt;%s&lt;/%s&gt;'</span> %</span><br><span class="line">            (name, attr_str, c, name) <span class="keyword">for</span> c <span class="keyword">in</span> content)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;%s%s /&gt;'</span> % (name, attr_str)</span><br></pre></td></tr></table></figure><a id="more"></a><p>tagå‡½æ•°çš„è°ƒç”¨æ–¹å¼å¾ˆå¤š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tag(<span class="string">'br'</span>)  <span class="comment"># A</span></span><br><span class="line"><span class="string">'&lt;br /&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tag(<span class="string">'p'</span>, <span class="string">'hello'</span>, <span class="string">'sidebar'</span>)  <span class="comment"># B</span></span><br><span class="line"><span class="string">'&lt;p&gt;hello&lt;/p&gt;\n&lt;p&gt;sidebar&lt;/p&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tag(<span class="string">'p'</span>, <span class="string">'hello'</span>, cls=<span class="string">'sidebar'</span>)  <span class="comment"># C</span></span><br><span class="line"><span class="string">'&lt;p class="sidebar"&gt;hello&lt;/p&gt;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_tag = &#123;<span class="string">'name'</span>: <span class="string">'img'</span>, <span class="string">'title'</span>: <span class="string">'Sunset Boulevard'</span>, <span class="string">'src'</span>: <span class="string">'sunset.jpg'</span>, <span class="string">'cls'</span>: <span class="string">'framed'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tag(**my_tag)  <span class="comment"># D</span></span><br><span class="line"><span class="string">'&lt;img class="framed" src="sunset.jpg" title="Sunset Boulevard" /&gt;'</span></span><br></pre></td></tr></table></figure><p>A. ä¼ å…¥å•ä¸ªå®šä½å‚æ•°ã€‚</p><p>B. ä¼ å…¥å¤šä¸ªå®šä½å‚æ•°ï¼Œæ ¹æ®å‡½æ•°å®šä¹‰ï¼Œç¬¬1ä¸ªå‚æ•°è¢«ä¼ å…¥nameï¼Œå‰©ä½™çš„æœªå‘½åå®šä½å‚æ•°è¢«ä¼ å…¥contentã€‚</p><p>C. clså‚æ•°åªèƒ½é€šè¿‡å…³é”®å­—å‚æ•°æŒ‡å®šï¼Œå®ƒä¸€å®šä¸ä¼šæ•èŽ·æœªå‘½åçš„å®šä½å‚æ•°ã€‚ï¼ˆå› ä¸ºclså‚æ•°åœ¨æœ‰<code>*</code>å‚æ•°çš„åŽé¢ï¼ˆä¸èƒ½æ”¾åœ¨<code>**</code>å‚æ•°çš„åŽé¢ï¼‰ï¼Œè‹¥ä¸æŒ‡å®šå…³é”®å­—ï¼Œåˆ™ç¼–è¯‘å™¨æ— æ³•åˆ¤æ–­å®ƒæ˜¯è¯¥ä¼ å…¥contentè¿˜æ˜¯è¯¥ä¼ å…¥clsï¼‰</p><p>D. åœ¨my_tagå‰é¢åŠ ä¸Š<code>**</code>ï¼Œå­—å…¸ä¸­çš„æ‰€æœ‰å…ƒç´ ä½œä¸ºå•ä¸ªå‚æ•°ä¼ å…¥ï¼ŒåŒåé”®ä¼šç»‘å®šåˆ°å¯¹åº”çš„å…·åå‚æ•°ä¸Šï¼Œä½™ä¸‹çš„è¢«<code>**attrs</code>æ•èŽ·ã€‚</p><p>å¦‚æžœä¸æƒ³æ”¯æŒæ•°é‡ä¸å®šçš„å®šä½å‚æ•°ï¼ˆå³<code>*content</code>ï¼‰ï¼Œä½†æƒ³æ”¯æŒä»…é™å…³é”®å­—å‚æ•°ï¼Œåœ¨ç­¾åä¸­æ”¾ä¸€ä¸ª<code>*</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, *, b)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a, b</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># å¼ºåˆ¶ä»¥å…³é”®å­—ä¼ å…¥</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: f() takes <span class="number">1</span> positional argument but <span class="number">2</span> were given</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>, b=<span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><h1 id="èŽ·å–å…³äºŽå‚æ•°çš„ä¿¡æ¯">èŽ·å–å…³äºŽå‚æ•°çš„ä¿¡æ¯</h1><p>æŸ¥çœ‹<code>__defaultS__</code>ã€<code>__code__.co_varnames</code>ã€<code>__code__.co_argcount</code>çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, b=None, *c, d=None, **e)</span>:</span> f, g = <span class="number">0</span>, <span class="number">1</span>; <span class="keyword">return</span> f + g</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__defaults__  <span class="comment"># å½¢å¼å‚æ•°çš„é»˜è®¤å€¼</span></span><br><span class="line">(<span class="literal">None</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__kwdefaults__  <span class="comment"># ä»…é™å…³é”®å­—å½¢å¼å‚æ•°çš„é»˜è®¤å€¼</span></span><br><span class="line">&#123;<span class="string">'d'</span>: <span class="literal">None</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__code__.co_varnames  <span class="comment"># å‚æ•°åç§°+å‡½æ•°å®šä¹‰ä½“ä¸­åˆ›å»ºçš„å±€éƒ¨å˜é‡</span></span><br><span class="line">(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__code__.co_argcount  <span class="comment"># å‚æ•°æ•°é‡ï¼ˆçœ‹æ¥ä¸åŒ…æ‹¬å¸¦*å‚æ•°ä»¥åŠåœ¨å…¶åŽé¢çš„å‚æ•°ï¼‰</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç»„ç»‡æ–¹å¼ä¸å‹å¥½ï¼Œæˆ‘ä»¬æœ‰æ›´å¥½çš„æ¨¡å—inspectæ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sig = signature(f)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sig</span><br><span class="line">&lt;Signature (a, b=<span class="literal">None</span>, *c, d=<span class="literal">None</span>, **e)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> name, param <span class="keyword">in</span> sig.parameters.items():</span><br><span class="line"><span class="meta">... </span>    print(param.kind, <span class="string">':'</span>, name, <span class="string">'='</span>, param.default)</span><br><span class="line">...</span><br><span class="line">POSITIONAL_OR_KEYWORD : a = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">POSITIONAL_OR_KEYWORD</span> :</span> b = <span class="literal">None</span></span><br><span class="line">VAR_POSITIONAL : c = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">KEYWORD_ONLY</span> :</span> d = <span class="literal">None</span></span><br><span class="line">VAR_KEYWORD : e = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;</span></span><br></pre></td></tr></table></figure><p>signatureè¿”å›žä¸€ä¸ªSignatureå¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ªparameterså±žæ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰åºæ˜ å°„ï¼ŒæŠŠå‚æ•°åå’ŒParameterå¯¹è±¡å¯¹åº”èµ·æ¥ã€‚Parameterä¹Ÿæœ‰è‡ªå·±çš„å±žæ€§ã€‚ä¾‹å¦‚nameã€defaultã€kindã€annotationï¼ˆä¸‹ä¸€èŠ‚å‡½æ•°æ³¨è§£ä¸­ä½¿ç”¨æ­¤å±žæ€§èŽ·å–é™„åŠ çš„å…ƒæ•°æ®ï¼‰ã€‚ç‰¹æ®Šçš„<code>inspect._empty</code>è¡¨ç¤ºå‚æ•°æ²¡æœ‰é»˜è®¤å€¼ã€‚kindå±žæ€§æ˜¯<code>_ParameterKind</code>ç±»ä¸­çš„5ä¸ªå€¼ä¹‹ä¸€ã€‚</p><ul><li><p>POSITIONAL_OR_KEYWORDï¼šå¯ä»¥é€šè¿‡å®šä½å‚æ•°å’Œå…³é”®å­—å‚æ•°ä¼ å…¥çš„å½¢å‚ï¼ˆå¤šæ•°Pythonå‡½æ•°çš„å‚æ•°å±žäºŽæ­¤ç±»ï¼‰ã€‚</p></li><li><p>VAR_POSITIONALï¼šå®šä½å‚æ•°å…ƒç»„ã€‚</p></li><li><p>VAR_KEYWORDï¼šå…³é”®å­—å‚æ•°å­—å…¸ã€‚</p></li><li><p>KEYWORD_ONLYï¼šä»…é™å…³é”®å­—å‚æ•°ï¼ˆPython3æ–°å¢žï¼‰ã€‚</p></li><li><p>POSITIONAL_ONLYï¼šä»…é™å®šä½å‚æ•°ï¼›ç›®å‰ï¼ŒPythonå£°æ˜Žå‡½æ•°çš„å¥æ³•ä¸æ”¯æŒï¼Œä½†æ˜¯æœ‰äº›ä½¿ç”¨Cè¯­è¨€å®žçŽ°ä¸”ä¸æŽ¥å—å…³é”®å­—å‚æ•°çš„å‡½æ•°ï¼ˆå¦‚divmodï¼‰æ”¯æŒã€‚</p></li></ul><p>Signatureå¯¹è±¡æœ‰ä¸ªbindæ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠä»»æ„ä¸ªå‚æ•°ç»‘å®šåˆ°ç­¾åä¸­çš„å½¢å‚ä¸Šï¼Œæ‰€ç”¨çš„è§„åˆ™ä¸Žå®žå‚åˆ°å½¢å‚çš„åŒ¹é…æ–¹å¼ä¸€æ ·ã€‚æ¡†æž¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•åœ¨çœŸæ­£è°ƒç”¨å‡½æ•°å‰éªŒè¯å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sig = signature(tag)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_tag = &#123;<span class="string">'name'</span>: <span class="string">'img'</span>, <span class="string">'title'</span>: <span class="string">'Sunset Boulevard'</span>, <span class="string">'src'</span>: <span class="string">'sunset.jpg'</span>, <span class="string">'cls'</span>: <span class="string">'framed'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bound_args = sig.bind(**my_tag)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bound_args</span><br><span class="line">&lt;BoundArguments (name=<span class="string">'img'</span>, cls=<span class="string">'framed'</span>, attrs=&#123;<span class="string">'title'</span>: <span class="string">'Sunset Boulevard'</span>, <span class="string">'src'</span>: <span class="string">'sunset.jpg'</span>&#125;)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> bound_args.arguments.items():</span><br><span class="line"><span class="meta">... </span>    print(k, <span class="string">'='</span>, v)</span><br><span class="line">...</span><br><span class="line">name = img</span><br><span class="line">cls = framed</span><br><span class="line">attrs = &#123;<span class="string">'title'</span>: <span class="string">'Sunset Boulevard'</span>, <span class="string">'src'</span>: <span class="string">'sunset.jpg'</span>&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> my_tag[<span class="string">'name'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bound_args = sig.bind(**my_tag)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Users/cws/opt/anaconda3/envs/python36/lib/python3.6/inspect.py"</span>, line <span class="number">2997</span>, <span class="keyword">in</span> bind</span><br><span class="line">    <span class="keyword">return</span> args[<span class="number">0</span>]._bind(args[<span class="number">1</span>:], kwargs)</span><br><span class="line">  File <span class="string">"/Users/cws/opt/anaconda3/envs/python36/lib/python3.6/inspect.py"</span>, line <span class="number">2912</span>, <span class="keyword">in</span> _bind</span><br><span class="line">    <span class="keyword">raise</span> TypeError(msg) <span class="keyword">from</span> <span class="literal">None</span></span><br><span class="line">TypeError: missing a required argument: <span class="string">'name'</span></span><br></pre></td></tr></table></figure><h1 id="å‡½æ•°æ³¨è§£">å‡½æ•°æ³¨è§£</h1><p>Python3æä¾›äº†ä¸€ç§å¥æ³•ï¼Œç”¨äºŽä¸ºå‡½æ•°å£°æ˜Žä¸­çš„å‚æ•°å’Œè¿”å›žå€¼é™„åŠ å…ƒæ•°æ®ã€‚å‡½æ•°å£°æ˜Žä¸­çš„å„ä¸ªå‚æ•°å¯ä»¥åœ¨<code>:</code>ä¹‹åŽå¢žåŠ æ³¨è§£è¡¨è¾¾å¼ã€‚</p><p>Pythonå¯¹æ³¨è§£æ‰€åšçš„å”¯ä¸€çš„äº‹æƒ…æ˜¯ï¼ŒæŠŠå®ƒä»¬å­˜å‚¨åœ¨å‡½æ•°çš„<code>__annotations__</code>å±žæ€§é‡Œã€‚ä»…æ­¤è€Œå·²ï¼ŒPythonä¸åšæ£€æŸ¥ã€ä¸åšå¼ºåˆ¶ã€ä¸åšéªŒè¯ï¼Œä»€ä¹ˆæ“ä½œéƒ½ä¸åšã€‚æ¢å¥è¯è¯´ï¼Œæ³¨è§£å¯¹Pythonè§£é‡Šå™¨æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚æ³¨è§£åªæ˜¯å…ƒæ•°æ®ï¼Œå¯ä»¥ä¾›IDEã€æ¡†æž¶å’Œè£…é¥°å™¨ç­‰å·¥å…·ä½¿ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, b, c, d)</span>:</span> <span class="keyword">pass</span>  <span class="comment"># å¸¸è§„</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(a, b: str, c: <span class="string">'int &gt; 0'</span>, d: float=<span class="number">0.0</span>)</span> -&gt; str:</span> <span class="keyword">pass</span>  <span class="comment"># åŠ æ³¨è§£</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__annotations__</span><br><span class="line">&#123;'b': &lt;class 'str'&gt;, 'c': 'int &gt; 0', 'd': &lt;class 'float'&gt;, 'return': &lt;class 'str'&gt;&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> inspect <span class="keyword">import</span> signature</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sig = signature(f)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sig.return_annotation</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">for</span> <span class="title">param</span> <span class="title">in</span> <span class="title">sig</span>.<span class="title">parameters</span>.<span class="title">values</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    note = repr(param.annotation).ljust(<span class="number">26</span>)</span><br><span class="line"><span class="meta">... </span>    print(note, <span class="string">':'</span>, param.name, <span class="string">'='</span>, param.default)</span><br><span class="line">...</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;   :</span> a = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">str</span>'&gt;              :</span> b = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;</span></span><br><span class="line"><span class="class">'<span class="title">int</span> &gt; 0'                  :</span> c = &lt;<span class="class"><span class="keyword">class</span> '<span class="title">inspect</span>.<span class="title">_empty</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">float</span>'&gt;            :</span> d = <span class="number">0.0</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> parameters </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„åŒ…</title>
      <link href="/notes/fluent-python/packages-for-functional-programming/"/>
      <url>/notes/fluent-python/packages-for-functional-programming/</url>
      
        <content type="html"><![CDATA[<h1 id="operatoræ¨¡å—">operatoræ¨¡å—</h1><p>Pythonçš„ç›®æ ‡ä¸æ˜¯å˜æˆå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯å¾—ç›ŠäºŽoperatorå’Œfunctoolsç­‰åŒ…çš„æ”¯æŒï¼Œå‡½æ•°å¼ç¼–ç¨‹é£Žæ ¼ä¹Ÿå¯ä»¥ä¿¡æ‰‹æ‹ˆæ¥ã€‚ä¸‹é¢æ˜¯operatoræ¨¡å—ä¸­å®šä¹‰çš„éƒ¨åˆ†å‡½æ•°ï¼ˆçœç•¥äº†ä»¥_å¼€å¤´çš„åç§°ï¼Œå› ä¸ºå®ƒä»¬åŸºæœ¬ä¸Šæ˜¯å®žçŽ°ç»†èŠ‚ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> operator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[name <span class="keyword">for</span> name <span class="keyword">in</span> dir(operator) <span class="keyword">if</span> <span class="keyword">not</span> name.startswith(<span class="string">'_'</span>)]</span><br><span class="line">[<span class="string">'abs'</span>, <span class="string">'add'</span>, <span class="string">'and_'</span>, <span class="string">'attrgetter'</span>, <span class="string">'concat'</span>, <span class="string">'contains'</span>, <span class="string">'countOf'</span>, <span class="string">'delitem'</span>, <span class="string">'eq'</span>, <span class="string">'floordiv'</span>, <span class="string">'ge'</span>, <span class="string">'getitem'</span>, <span class="string">'gt'</span>, <span class="string">'iadd'</span>, <span class="string">'iand'</span>, <span class="string">'iconcat'</span>, <span class="string">'ifloordiv'</span>, <span class="string">'ilshift'</span>, <span class="string">'imatmul'</span>, <span class="string">'imod'</span>, <span class="string">'imul'</span>, <span class="string">'index'</span>, <span class="string">'indexOf'</span>, <span class="string">'inv'</span>, <span class="string">'invert'</span>, <span class="string">'ior'</span>, <span class="string">'ipow'</span>, <span class="string">'irshift'</span>, <span class="string">'is_'</span>, <span class="string">'is_not'</span>, <span class="string">'isub'</span>, <span class="string">'itemgetter'</span>, <span class="string">'itruediv'</span>, <span class="string">'ixor'</span>, <span class="string">'le'</span>, <span class="string">'length_hint'</span>, <span class="string">'lshift'</span>, <span class="string">'lt'</span>, <span class="string">'matmul'</span>, <span class="string">'methodcaller'</span>, <span class="string">'mod'</span>, <span class="string">'mul'</span>, <span class="string">'ne'</span>, <span class="string">'neg'</span>, <span class="string">'not_'</span>, <span class="string">'or_'</span>, <span class="string">'pos'</span>, <span class="string">'pow'</span>, <span class="string">'rshift'</span>, <span class="string">'setitem'</span>, <span class="string">'sub'</span>, <span class="string">'truediv'</span>, <span class="string">'truth'</span>, <span class="string">'xor'</span>]</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="ç®—æœ¯è¿ç®—ç¬¦å‡½æ•°">ç®—æœ¯è¿ç®—ç¬¦å‡½æ•°</h2><p>åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦æŠŠç®—æœ¯è¿ç®—ç¬¦å½“ä½œå‡½æ•°ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸ä½¿ç”¨é€’å½’è¿›è¡Œé˜¶ä¹˜</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> a, b: a*b, range(<span class="number">1</span>, n+<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>operatoræ¨¡å—ä¸ºå¤šä¸ªç®—æœ¯è¿ç®—ç¬¦æä¾›äº†å¯¹åº”çš„å‡½æ•°ï¼Œä»Žè€Œé¿å…ç¼–å†™<code>lambda a, b: a*b</code>è¿™ç§å¹³å‡¡çš„åŒ¿åå‡½æ•°ã€‚ä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦å‡½æ•°ï¼Œå¯ä»¥æŠŠä¸Šä¾‹æ”¹å†™ä¸º</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">_fact</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> reduce(mul, range(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>all(fact(i) == _fact(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>))</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="getterå‡½æ•°">getterå‡½æ•°</h2><p>operatoræ¨¡å—ä¸­è¿˜æœ‰ä¸€ç±»å‡½æ•°ï¼Œèƒ½æ›¿ä»£ä»Žåºåˆ—ä¸­å–å‡ºå…ƒç´ æˆ–è¯»å–å¯¹è±¡å±žæ€§çš„lambdaè¡¨è¾¾å¼ï¼šå› æ­¤ï¼Œitemgetterå’Œattrgetterå…¶å®žä¼šè‡ªè¡Œæž„å»ºå‡½æ•°ï¼ˆç‚¹å‡»é“¾æŽ¥æŸ¥çœ‹å…¶ç­‰ä»·å‡½æ•°ï¼‰ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/operator#operator.itemgetter" target="_blank" rel="noopener"><code>operator.itemgetter(item) operator.itemgetter(*items)</code></a></p><p>Return a callable object that fetches <em>item</em> from its operand using the operandâ€™s <code>__getitem__()</code> method. If multiple items are specified, returns a tuple of lookup values. For example:</p><ul><li>After <code>f = itemgetter(2)</code>, the call <code>f(r)</code> returns <code>r[2]</code>.</li><li>After <code>g = itemgetter(2, 5, 3)</code>, the call <code>g(r)</code> returns <code>(r[2], r[5], r[3])</code>.</li></ul><hr><p><a href="https://devdocs.io/python~3.6/library/operator#operator.attrgetter" target="_blank" rel="noopener"><code>operator.attrgetter(attr) operator.attrgetter(*attrs)</code></a></p><p>Return a callable object that fetches <em>attr</em> from its operand. If more than one attribute is requested, returns a tuple of attributes. The attribute names can also contain dots. For example:</p><ul><li>After <code>f = attrgetter('name')</code>, the call <code>f(b)</code> returns <code>b.name</code>.</li><li>After <code>f = attrgetter('name', 'date')</code>, the call <code>f(b)</code> returns <code>(b.name, b.date)</code>.</li><li>After <code>f = attrgetter('name.first', 'name.last')</code>, the call <code>f(b)</code> returns <code>(b.name.first, b.name.last)</code>.</li></ul></blockquote><h2 id="methodcallå‡½æ•°">methodcallå‡½æ•°</h2><p>å®ƒçš„ä½œç”¨ä¸Žattrgetterå’Œitemgetterç±»ä¼¼ï¼Œå®ƒä¼šè‡ªè¡Œåˆ›å»ºå‡½æ•°ã€‚methodcalleråˆ›å»ºçš„å‡½æ•°ä¼šåœ¨å¯¹è±¡ä¸Šè°ƒç”¨å‚æ•°æŒ‡å®šçš„æ–¹æ³•ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/operator#operator.methodcaller" target="_blank" rel="noopener"><code>operator.methodcaller(name[, args...])</code></a></p><p>Return a callable object that calls the method <em>name</em> on its operand. If additional arguments and/or keyword arguments are given, they will be given to the method as well. For example:</p><ul><li>After <code>f = methodcaller('name')</code>, the call <code>f(b)</code> returns <code>b.name()</code>.</li><li>After <code>f = methodcaller('name', 'foo', bar=1)</code>, the call <code>f(b)</code> returns <code>b.name('foo', bar=1)</code>.</li></ul></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> methodcaller</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'The time has come'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>upcase = methodcaller(<span class="string">'upper'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>upcase(s)  <span class="comment"># ç›¸å½“äºŽs.upper()</span></span><br><span class="line"><span class="string">'THE TIME HAS COME'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hiphenate = methodcaller(<span class="string">'replace'</span>, <span class="string">' '</span>, <span class="string">'-'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hiphenate(s)  <span class="comment"># ç›¸å½“äºŽs.replace(' ', '-')</span></span><br><span class="line"><span class="string">'The-time-has-come'</span></span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨functools.partialå†»ç»“å‚æ•°">ä½¿ç”¨functools.partialå†»ç»“å‚æ•°</h1><blockquote><p><a href="https://devdocs.io/python~3.6/library/functools#functools.partial" target="_blank" rel="noopener"><code>functools.partial(func, *args, **keywords)</code></a></p></blockquote><p>partialè¿™ä¸ªé«˜é˜¶å‡½æ•°ç”¨äºŽéƒ¨åˆ†åº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚éƒ¨åˆ†åº”ç”¨æ˜¯æŒ‡ï¼ŒåŸºäºŽä¸€ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„è°ƒç”¨å¯¹è±¡ï¼ŒæŠŠåŽŸå‡½æ•°çš„æŸäº›å‚æ•°å›ºå®šã€‚ä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥æŠŠæŽ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°æ”¹ç¼–æˆéœ€è¦å›žè°ƒçš„APIï¼Œè¿™æ ·å‚æ•°æ›´å°‘ã€‚</p><p>ç¤ºä¾‹ï¼šä½¿ç”¨partialæŠŠä¸€ä¸ªä¸¤å‚æ•°å‡½æ•°æ”¹ç¼–æˆéœ€è¦å•å‚æ•°çš„å¯è°ƒç”¨å¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple = partial(mul, <span class="number">3</span>)  <span class="comment"># ç›¸å½“äºŽ lambda e: mul(3, e)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple</span><br><span class="line">functools.partial(&lt;built-<span class="keyword">in</span> function mul&gt;, <span class="number">3</span>)  <span class="comment"># è¿”å›žä¸€ä¸ªpartialå¯¹è±¡</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple(<span class="number">7</span>)  <span class="comment"># tripleæŽ¥å—å•å‚æ•°</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(triple, range(<span class="number">1</span>, <span class="number">10</span>)))</span><br><span class="line">[<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">21</span>, <span class="number">24</span>, <span class="number">27</span>]</span><br></pre></td></tr></table></figure><p>functools.partialmethodå‡½æ•°ï¼ˆPython3.4æ–°å¢žï¼‰çš„ä½œç”¨ä¸Žpartialä¸€æ ·ï¼Œä¸è¿‡æ˜¯ç”¨äºŽå¤„ç†æ–¹æ³•ï¼ˆåœ¨ç±»ä¸­å®šä¹‰çš„å‡½æ•°ï¼‰çš„ã€‚</p><blockquote><p><a href="https://devdocs.io/python~3.6/library/functools#functools.partialmethod" target="_blank" rel="noopener"><code>class functools.partialmethod(func, *args, **keywords)</code></a></p></blockquote><p>Example:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Cell</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self._alive = <span class="literal">False</span></span><br><span class="line"><span class="meta">... </span>    @property</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">alive</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> self._alive</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">set_state</span><span class="params">(self, state)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self._alive = bool(state)</span><br><span class="line"><span class="meta">... </span>    set_alive = partialmethod(set_state, <span class="literal">True</span>)</span><br><span class="line"><span class="meta">... </span>    set_dead = partialmethod(set_state, <span class="literal">False</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = Cell()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.alive</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.set_alive()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.alive</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> functional programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dictï¼šå¤„ç†æ‰¾ä¸åˆ°çš„é”®</title>
      <link href="/notes/fluent-python/handling-missing-keys-in-a-dict/"/>
      <url>/notes/fluent-python/handling-missing-keys-in-a-dict/</url>
      
        <content type="html"><![CDATA[<h1 id="get">get</h1><blockquote><p><code>get(key[, default])</code></p></blockquote><p>å½“keyå­˜åœ¨æ—¶ï¼Œè¿”å›žå…¶å¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¿”å›ždefaultï¼Œdefautçš„é»˜è®¤å€¼ä¸ºNoneï¼Œè¿™æ¯”å¤„ç†KeyErrorè¦æ–¹ä¾¿ä¸å°‘ã€‚ç›¸å½“äºŽ<code>return m[key] if key in a else default</code>ã€‚</p><p>ä½†æ˜¯è¦æ›´æ–°æŸä¸ªé”®å¯¹åº”çš„å€¼æ—¶ï¼Œä¸ç®¡ä½¿ç”¨<code>__getitem__</code>ï¼ˆå³ç±»ä¼¼m[key]çš„å½¢å¼ï¼‰è¿˜æ˜¯getéƒ½ä¼šä¸è‡ªç„¶ï¼Œè€Œä¸”æ•ˆçŽ‡ä½Žã€‚</p><h1 id="setdefault">setdefault</h1><blockquote><p><code>setdefault(key[, default])</code></p></blockquote><p>å½“keyä¸å­˜åœ¨æ—¶ï¼Œä¼šå…ˆæ›´æ–°keyçš„å€¼ä¸ºdefaultï¼Œç„¶åŽè¿”å›ždefaultã€‚å½“keyå­˜åœ¨æ—¶ï¼Œè¿”å›žkeyçš„å€¼ã€‚ç›¸å½“äºŽï¼š</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setdefault</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> self[key]  <span class="comment"># keyå·²å­˜åœ¨æ—¶</span></span><br><span class="line">    <span class="keyword">except</span> KeyError:</span><br><span class="line">        self[key] = default  <span class="comment"># keyä¸å­˜åœ¨æ—¶</span></span><br><span class="line">        <span class="keyword">return</span> default</span><br></pre></td></tr></table></figure><p>get(key, default)ä¸Žsetdefault(key, default)åœ¨keyä¸å­˜åœ¨æ—¶éƒ½èƒ½è¿”å›ždefaultï¼Œä¸åŒçš„æ˜¯setdefaultåœ¨è¿”å›žå‰æ›´æ–°äº†keyçš„å€¼ï¼Œè¿™åœ¨æŸäº›æ—¶å€™ï¼ˆæ¯”å¦‚å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”å¯¹å…¶è¿›è¡Œä¿®æ”¹æ—¶ï¼‰éžå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name_list = m.get(<span class="string">'names'</span>, [])  <span class="comment"># ç¬¬1æ¬¡æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name_list.append(<span class="string">'Alice'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m[<span class="string">'names'</span>] = name_list  <span class="comment"># ç¬¬2æ¬¡æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m</span><br><span class="line">&#123;<span class="string">'names'</span>: [<span class="string">'Alice'</span>]&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.setdefault(<span class="string">'names'</span>, []).append(<span class="string">'John'</span>)  <span class="comment"># 1æ­¥åˆ°ä½</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m</span><br><span class="line">&#123;<span class="string">'names'</span>: [<span class="string">'Alice'</span>, <span class="string">'John'</span>]&#125;</span><br></pre></td></tr></table></figure><h1 id="defaultdict">defaultdict</h1><blockquote><p><code>class collections.defaultdict([default_factory[, ...]])</code></p></blockquote><p>åœ¨ç”¨æˆ·åˆ›å»ºdefaultdictå¯¹è±¡çš„æ—¶å€™ï¼Œå°±éœ€è¦ç»™å®ƒé…ç½®ä¸€ä¸ªä¸ºæ‰¾ä¸åˆ°çš„é”®åˆ›é€ é»˜è®¤å€¼çš„æ–¹æ³•ã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨å®žä¾‹åŒ–ä¸€ä¸ªdefaultdictçš„æ—¶å€™ï¼Œéœ€è¦ç»™æž„é€ æ–¹æ³•æä¾›ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œè¿™ä¸ªå¯è°ƒç”¨å¯¹è±¡ä¼šåœ¨<code>__getitem__</code>ç¢°åˆ°æ‰¾ä¸åˆ°çš„é”®çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œè®©<code>__getitem__</code>è¿”å›žæŸç§é»˜è®¤å€¼ã€‚</p><p>defaultdicté‡Œçš„<code>default_factory</code>åªä¼šåœ¨<code>__getitem__</code>é‡Œè¢«è°ƒç”¨ï¼Œåœ¨å…¶ä»–çš„æ–¹æ³•é‡Œå®Œå…¨ä¸ä¼šå‘æŒ¥ä½œç”¨ã€‚æ¯”å¦‚ï¼Œddæ˜¯ä¸ªdefaultdictï¼Œkæ˜¯ä¸ªæ‰¾ä¸åˆ°çš„é”®ï¼Œdd[k]è¿™ä¸ªè¡¨è¾¾å¼ä¼šè°ƒç”¨<code>default_factory</code>åˆ›é€ æŸä¸ªé»˜è®¤å€¼ï¼Œè€Œdd.get(k)åˆ™ä¼šè¿”å›žNoneã€‚</p><p>æ‰€æœ‰è¿™ä¸€åˆ‡èƒŒåŽçš„åŠŸè‡£å…¶å®žæ˜¯ç‰¹æ®Šæ–¹æ³•<code>__missing__</code>ã€‚å®ƒä¼šåœ¨defaultdicté‡åˆ°æ‰¾ä¸åˆ°çš„é”®çš„æ—¶å€™è°ƒç”¨<code>default_factory</code>ï¼Œè€Œå®žé™…ä¸Šè¿™ä¸ªç‰¹æ€§æ˜¯æ‰€æœ‰æ˜ å°„ç±»åž‹éƒ½å¯ä»¥é€‰æ‹©åŽ»æ”¯æŒçš„ã€‚</p><p>ä½¿ç”¨ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = defaultdict(list)  <span class="comment"># default_factory=list</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="string">'names'</span>].append(<span class="string">'Alice'</span>)  <span class="comment"># default_factorä¼šè¢«è°ƒç”¨ï¼Œä¸ºæŸ¥è¯¢ä¸åˆ°çš„é”®åˆ›å»ºä¸€ä¸ªå€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">defaultdict(&lt;class 'list'&gt;, &#123;'names': ['Alice']&#125;)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.get(<span class="number">0</span>)  <span class="comment"># default_factorä¼šè¢«è°ƒç”¨ä¸ä¼šè¢«è°ƒç”¨</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.get(<span class="string">'names'</span>)</span><br><span class="line">[<span class="string">'Alice'</span>]</span><br></pre></td></tr></table></figure><h1 id="ç‰¹æ®Šæ–¹æ³•">ç‰¹æ®Šæ–¹æ³•</h1><p><strong>æ‰€æœ‰çš„æ˜ å°„ç±»åž‹åœ¨å¤„ç†æ‰¾ä¸åˆ°çš„é”®çš„æ—¶å€™ï¼Œéƒ½ä¼šç‰µæ‰¯åˆ°<code>__missing__</code>æ–¹æ³•ã€‚</strong>è¿™ä¹Ÿæ˜¯è¿™ä¸ªæ–¹æ³•ç§°ä½œâ€œmissingâ€çš„åŽŸå› ã€‚è™½ç„¶åŸºç±»dictå¹¶æ²¡æœ‰å®šä¹‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯dictæ˜¯çŸ¥é“æœ‰è¿™ä¹ˆä¸ªä¸œè¥¿å­˜åœ¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœæœ‰ä¸€ä¸ªç±»ç»§æ‰¿äº†dictï¼Œç„¶åŽè¿™ä¸ªç»§æ‰¿ç±»æä¾›äº†<code>__missing__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨<code>__getitem__</code>ç¢°åˆ°æ‰¾ä¸åˆ°çš„é”®çš„æ—¶å€™ï¼ŒPython å°±ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒï¼Œè€Œä¸æ˜¯æŠ›å‡ºä¸€ä¸ªKeyErrorå¼‚å¸¸ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">StrKeyDict</span><span class="params">(dict)</span>:</span>  <span class="comment"># ç»§æ‰¿è‡ªdict</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span><span class="params">(self, key)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">if</span> isinstance(key, str):  <span class="comment"># å¦‚æžœkeyæœ¬èº«æ˜¯å­—ç¬¦ä¸²ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">raise</span> KeyError(key)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> self[str(key)]  <span class="comment"># å¦åˆ™ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²åœ¨è¿›è¡ŒæŸ¥æ‰¾</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">return</span> self[key]  <span class="comment"># å°†getæ–¹æ³•çš„æŸ¥æ‰¾å·¥ä½œå§”æ‰˜ç»™__getitem__ï¼Œè¿™æ ·åœ¨å®£å¸ƒ</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">except</span> KeyError:      <span class="comment"># æŸ¥æ‰¾å¤±è´¥ä¹‹å‰ï¼Œè¿˜èƒ½é€šè¿‡__missing__å†ç»™æŸä¸ªé”®ä¸€æ¬¡æœºä¼š</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">return</span> default</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span>  <span class="comment"># ç»§æ‰¿çš„__contains__æ–¹æ³•åœ¨æ‰¾ä¸åˆ°é”®æ—¶ä¸ä¼šè°ƒç”¨__missing__</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> key <span class="keyword">in</span> self.keys() <span class="keyword">or</span> str(key) <span class="keyword">in</span> self.keys()  <span class="comment"># å› æ­¤è¿™é‡Œéœ€è¦é‡å†™æ­¤æ–¹æ³•</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = StrKeyDict(&#123;i <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> str(i): i**<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m</span><br><span class="line">&#123;<span class="number">0</span>: <span class="number">0</span>, <span class="string">'1'</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">4</span>, <span class="string">'3'</span>: <span class="number">9</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="string">'5'</span>: <span class="number">25</span>, <span class="number">6</span>: <span class="number">36</span>, <span class="string">'7'</span>: <span class="number">49</span>, <span class="number">8</span>: <span class="number">64</span>, <span class="string">'9'</span>: <span class="number">81</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m[<span class="number">0</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.get(<span class="number">0</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m[<span class="number">1</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.get(<span class="number">1</span>)  <span class="comment"># ä¸Ždefaultdictä¸åŒï¼Œèƒ½è§¦å‘__missing__</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0</span> <span class="keyword">in</span> m</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">in</span> m</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li><p><code>__missing__</code>æ–¹æ³•ä¸­isinstanceæ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å½“str(key)æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„é”®æ—¶ï¼Œä¼šé™·å…¥æ— é™é€’å½’ã€‚</p></li><li><p><code>__contains__</code>æ–¹æ³•ä¸­æ²¡æœ‰ç”¨key in my_dictæ¥æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼Œå› ä¸ºé‚£ä¹Ÿä¼šå¯¼è‡´<code>__contains__</code>è¢«é€’å½’è°ƒç”¨ï¼ˆorå…³é”®å­—åŽé¢çš„ç¬¬äºŒæ¬¡æŸ¥æ‰¾ä¼šè°ƒç”¨<code>__contains__</code>ï¼‰ã€‚ä¸ºäº†é¿å…è¿™ä¸€æƒ…å†µï¼Œè¿™é‡Œé‡‡ç”¨äº†æ›´æ˜¾å¼çš„æ–¹æ³•ï¼Œç›´æŽ¥åœ¨self.keys()é‡ŒæŸ¥è¯¢ã€‚</p></li><li><p>åƒ<code>k in my_dict.keys()</code>è¿™ç§æ“ä½œåœ¨Python 3ä¸­æ˜¯å¾ˆå¿«çš„ï¼Œè€Œä¸”å³ä¾¿æ˜ å°„ç±»åž‹å¯¹è±¡å¾ˆåºžå¤§ä¹Ÿæ²¡å…³ç³»ã€‚è¿™æ˜¯å› ä¸ºdict.keys()çš„è¿”å›žå€¼æ˜¯ä¸€ä¸ªâ€è§†å›¾â€œã€‚è§†å›¾å°±åƒä¸€ä¸ªé›†åˆï¼Œè€Œä¸”è·Ÿå­—å…¸ç±»ä¼¼çš„æ˜¯ï¼Œåœ¨è§†å›¾é‡ŒæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ çš„é€Ÿåº¦å¾ˆå¿«ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dict </tag>
            
            <tag> Fluent Python </tag>
            
            <tag> defaultdict </tag>
            
            <tag> special methods </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨bisectæ¥ç®¡ç†å·²æŽ’åºçš„åºåˆ—</title>
      <link href="/notes/fluent-python/managing-ordered-sequences-with-bisect/"/>
      <url>/notes/fluent-python/managing-ordered-sequences-with-bisect/</url>
      
        <content type="html"><![CDATA[<h1 id="bisect">bisect</h1><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th>Method</th><th>Doc</th></tr></thead><tbody><tr class="odd"><td><code>bisect.bisect_left(a, x, lo=0, hi=len(a))</code></td><td>Return the leftmost index where to insert item x in list a, assuming a is sorted.</td></tr><tr class="even"><td><code>bisect.bisect_right(a, x, lo=0, hi=len(a))</code></td><td>Return the rightmost index where to insert item x in list a, assuming a is sorted.</td></tr><tr class="odd"><td><code>bisect.bisect(a, x, lo=0, hi=len(a))</code></td><td>Equal to bisect_right.</td></tr><tr class="even"><td><code>bisect.insort_left(a, x, lo=0, hi=len(a))</code></td><td>Insert item x in a and keep it sorted assuming a is sorted. If equal keys are found, add to the left.</td></tr><tr class="odd"><td><code>bisect.insort_right(a, x, lo=0, hi=len(a))</code></td><td>Insert item x in a and keep it sorted assuming a is sorted. If equal keys are found, add to the right.</td></tr><tr class="even"><td><code>bisect.insort(a, x, lo=0, hi=len(a))</code></td><td>Equal to insort_right.</td></tr></tbody></table><a id="more"></a><h1 id="sortedcollection">SortedCollection</h1><p>Pythonçš„é«˜äº§è´¡çŒ®è€…Raymond Hettingerå†™äº†ä¸€ä¸ªæŽ’åºé›†åˆæ¨¡å—<a href="http://code.activestate.com/recipes/577197-sortedcollection/" target="_blank" rel="noopener">SortedCollection</a>ï¼Œæ¨¡å—é‡Œé›†æˆäº†bisectåŠŸèƒ½ï¼Œä½†æ˜¯æ¯”ç‹¬ç«‹çš„bisectæ›´æ˜“ç”¨ã€‚</p><table><colgroup><col style="width: 33%"><col style="width: 66%"></colgroup><thead><tr class="header"><th>Method</th><th>Doc</th></tr></thead><tbody><tr class="odd"><td><code>def clear(self)</code></td><td></td></tr><tr class="even"><td><code>def copy(self)</code></td><td></td></tr><tr class="odd"><td><code>def index(self, item)</code></td><td>Find the position of an item. Raise ValueError if not found.</td></tr><tr class="even"><td><code>def count(self, item)</code></td><td>Return number of occurrences of item.</td></tr><tr class="odd"><td><code>def insert(self, item)</code></td><td>Insert a new item. If equal keys are found, add to the left.</td></tr><tr class="even"><td><code>def insert_right(self, item)</code></td><td>Insert a new item. If equal keys are found, add to the right.</td></tr><tr class="odd"><td><code>def remove(self, item)</code></td><td>Remove first occurence of item. Raise ValueError if not found.</td></tr><tr class="even"><td><code>def find(self, k)</code></td><td>Return first item with a key == k. Raise ValueError if not found.</td></tr><tr class="odd"><td><code>def find_le(self, k)</code></td><td>Return last item with a key &lt;= k. Raise ValueError if not found.</td></tr><tr class="even"><td><code>def find_lt(self, k)</code></td><td>Return last item with a key &lt; k. Raise ValueError if not found.</td></tr><tr class="odd"><td><code>def find_ge(self, k)</code></td><td>Return first item with a key &gt;= k. Raise ValueError if not found.</td></tr><tr class="even"><td><code>def find_gt(self, k)</code></td><td>Return first item with a key &gt; k. Raise ValueError if not found.</td></tr></tbody></table><h1 id="bisectæºç ">bisectæºç </h1><figure class="highlight python"><figcaption><span>bisect.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="string">"""Bisection algorithms."""</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insort_right</span><span class="params">(a, x, lo=<span class="number">0</span>, hi=None)</span>:</span></span><br><span class="line">    <span class="string">"""Insert item x in list a, and keep it sorted assuming a is sorted.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If x is already in a, insert it to the right of the rightmost x.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Optional args lo (default 0) and hi (default len(a)) bound the</span></span><br><span class="line"><span class="string">    slice of a to be searched.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lo &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'lo must be non-negative'</span>)</span><br><span class="line">    <span class="keyword">if</span> hi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        hi = len(a)</span><br><span class="line">    <span class="keyword">while</span> lo &lt; hi:</span><br><span class="line">        mid = (lo+hi)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; a[mid]: hi = mid</span><br><span class="line">        <span class="keyword">else</span>: lo = mid+<span class="number">1</span></span><br><span class="line">    a.insert(lo, x)</span><br><span class="line"></span><br><span class="line">insort = insort_right   <span class="comment"># backward compatibility</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bisect_right</span><span class="params">(a, x, lo=<span class="number">0</span>, hi=None)</span>:</span></span><br><span class="line">    <span class="string">"""Return the index where to insert item x in list a, assuming a is sorted.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The return value i is such that all e in a[:i] have e &lt;= x, and all e in</span></span><br><span class="line"><span class="string">    a[i:] have e &gt; x.  So if x already appears in the list, a.insert(x) will</span></span><br><span class="line"><span class="string">    insert just after the rightmost x already there.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Optional args lo (default 0) and hi (default len(a)) bound the</span></span><br><span class="line"><span class="string">    slice of a to be searched.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lo &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'lo must be non-negative'</span>)</span><br><span class="line">    <span class="keyword">if</span> hi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        hi = len(a)</span><br><span class="line">    <span class="keyword">while</span> lo &lt; hi:</span><br><span class="line">        mid = (lo+hi)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; a[mid]: hi = mid</span><br><span class="line">        <span class="keyword">else</span>: lo = mid+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> lo</span><br><span class="line"></span><br><span class="line">bisect = bisect_right   <span class="comment"># backward compatibility</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insort_left</span><span class="params">(a, x, lo=<span class="number">0</span>, hi=None)</span>:</span></span><br><span class="line">    <span class="string">"""Insert item x in list a, and keep it sorted assuming a is sorted.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If x is already in a, insert it to the left of the leftmost x.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Optional args lo (default 0) and hi (default len(a)) bound the</span></span><br><span class="line"><span class="string">    slice of a to be searched.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lo &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'lo must be non-negative'</span>)</span><br><span class="line">    <span class="keyword">if</span> hi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        hi = len(a)</span><br><span class="line">    <span class="keyword">while</span> lo &lt; hi:</span><br><span class="line">        mid = (lo+hi)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> a[mid] &lt; x: lo = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>: hi = mid</span><br><span class="line">    a.insert(lo, x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bisect_left</span><span class="params">(a, x, lo=<span class="number">0</span>, hi=None)</span>:</span></span><br><span class="line">    <span class="string">"""Return the index where to insert item x in list a, assuming a is sorted.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The return value i is such that all e in a[:i] have e &lt; x, and all e in</span></span><br><span class="line"><span class="string">    a[i:] have e &gt;= x.  So if x already appears in the list, a.insert(x) will</span></span><br><span class="line"><span class="string">    insert just before the leftmost x already there.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Optional args lo (default 0) and hi (default len(a)) bound the</span></span><br><span class="line"><span class="string">    slice of a to be searched.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lo &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'lo must be non-negative'</span>)</span><br><span class="line">    <span class="keyword">if</span> hi <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        hi = len(a)</span><br><span class="line">    <span class="keyword">while</span> lo &lt; hi:</span><br><span class="line">        mid = (lo+hi)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> a[mid] &lt; x: lo = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>: hi = mid</span><br><span class="line">    <span class="keyword">return</span> lo</span><br><span class="line"></span><br><span class="line"><span class="comment"># Overwrite above definitions with a fast C implementation</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> _bisect <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h1 id="sortedcollectionæºç ">SortedCollectionæºç </h1><figure class="highlight python"><figcaption><span>recipe-577197-1.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bisect <span class="keyword">import</span> bisect_left, bisect_right</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SortedCollection</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">'''Sequence sorted by a key function.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    SortedCollection() is much easier to work with than using bisect() directly.</span></span><br><span class="line"><span class="string">    It supports key functions like those use in sorted(), min(), and max().</span></span><br><span class="line"><span class="string">    The result of the key function call is saved so that keys can be searched</span></span><br><span class="line"><span class="string">    efficiently.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Instead of returning an insertion-point which can be hard to interpret, the</span></span><br><span class="line"><span class="string">    five find-methods return a specific item in the sequence. They can scan for</span></span><br><span class="line"><span class="string">    exact matches, the last item less-than-or-equal to a key, or the first item</span></span><br><span class="line"><span class="string">    greater-than-or-equal to a key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Once found, an item's ordinal position can be located with the index() method.</span></span><br><span class="line"><span class="string">    New items can be added with the insert() and insert_right() methods.</span></span><br><span class="line"><span class="string">    Old items can be deleted with the remove() method.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The usual sequence methods are provided to support indexing, slicing,</span></span><br><span class="line"><span class="string">    length lookup, clearing, copying, forward and reverse iteration, contains</span></span><br><span class="line"><span class="string">    checking, item counts, item removal, and a nice looking repr.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Finding and indexing are O(log n) operations while iteration and insertion</span></span><br><span class="line"><span class="string">    are O(n).  The initial sort is O(n log n).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The key function is stored in the 'key' attibute for easy introspection or</span></span><br><span class="line"><span class="string">    so that you can assign a new key function (triggering an automatic re-sort).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    In short, the class was designed to handle all of the common use cases for</span></span><br><span class="line"><span class="string">    bisect but with a simpler API and support for key functions.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from pprint import pprint</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from operator import itemgetter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s = SortedCollection(key=itemgetter(2))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; for record in [</span></span><br><span class="line"><span class="string">    ...         ('roger', 'young', 30),</span></span><br><span class="line"><span class="string">    ...         ('angela', 'jones', 28),</span></span><br><span class="line"><span class="string">    ...         ('bill', 'smith', 22),</span></span><br><span class="line"><span class="string">    ...         ('david', 'thomas', 32)]:</span></span><br><span class="line"><span class="string">    ...     s.insert(record)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; pprint(list(s))         # show records sorted by age</span></span><br><span class="line"><span class="string">    [('bill', 'smith', 22),</span></span><br><span class="line"><span class="string">     ('angela', 'jones', 28),</span></span><br><span class="line"><span class="string">     ('roger', 'young', 30),</span></span><br><span class="line"><span class="string">     ('david', 'thomas', 32)]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s.find_le(29)           # find oldest person aged 29 or younger</span></span><br><span class="line"><span class="string">    ('angela', 'jones', 28)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s.find_lt(28)           # find oldest person under 28</span></span><br><span class="line"><span class="string">    ('bill', 'smith', 22)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s.find_gt(28)           # find youngest person over 28</span></span><br><span class="line"><span class="string">    ('roger', 'young', 30)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; r = s.find_ge(32)       # find youngest person aged 32 or older</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s.index(r)              # get the index of their record</span></span><br><span class="line"><span class="string">    3</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s[3]                    # fetch the record at that index</span></span><br><span class="line"><span class="string">    ('david', 'thomas', 32)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; s.key = itemgetter(0)   # now sort by first name</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; pprint(list(s))</span></span><br><span class="line"><span class="string">    [('angela', 'jones', 28),</span></span><br><span class="line"><span class="string">     ('bill', 'smith', 22),</span></span><br><span class="line"><span class="string">     ('david', 'thomas', 32),</span></span><br><span class="line"><span class="string">     ('roger', 'young', 30)]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, iterable=<span class="params">()</span>, key=None)</span>:</span></span><br><span class="line">        self._given_key = key</span><br><span class="line">        key = (<span class="keyword">lambda</span> x: x) <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> key</span><br><span class="line">        decorated = sorted((key(item), item) <span class="keyword">for</span> item <span class="keyword">in</span> iterable)</span><br><span class="line">        self._keys = [k <span class="keyword">for</span> k, item <span class="keyword">in</span> decorated]</span><br><span class="line">        self._items = [item <span class="keyword">for</span> k, item <span class="keyword">in</span> decorated]</span><br><span class="line">        self._key = key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getkey</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_setkey</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">is</span> <span class="keyword">not</span> self._key:</span><br><span class="line">            self.__init__(self._items, key=key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_delkey</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._setkey(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    key = property(_getkey, _setkey, _delkey, <span class="string">'key function'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__init__([], self._key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__class__(self, self._key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._items)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._items[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter(self._items)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> reversed(self._items)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s(%r, key=%s)'</span> % (</span><br><span class="line">            self.__class__.__name__,</span><br><span class="line">            self._items,</span><br><span class="line">            getattr(self._given_key, <span class="string">'__name__'</span>, repr(self._given_key))</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__class__, (self._items, self._given_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        k = self._key(item)</span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        j = bisect_right(self._keys, k)</span><br><span class="line">        <span class="keyword">return</span> item <span class="keyword">in</span> self._items[i:j]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="string">'Find the position of an item.  Raise ValueError if not found.'</span></span><br><span class="line">        k = self._key(item)</span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        j = bisect_right(self._keys, k)</span><br><span class="line">        <span class="keyword">return</span> self._items[i:j].index(item) + i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="string">'Return number of occurrences of item'</span></span><br><span class="line">        k = self._key(item)</span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        j = bisect_right(self._keys, k)</span><br><span class="line">        <span class="keyword">return</span> self._items[i:j].count(item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="string">'Insert a new item.  If equal keys are found, add to the left'</span></span><br><span class="line">        k = self._key(item)</span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        self._keys.insert(i, k)</span><br><span class="line">        self._items.insert(i, item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert_right</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="string">'Insert a new item.  If equal keys are found, add to the right'</span></span><br><span class="line">        k = self._key(item)</span><br><span class="line">        i = bisect_right(self._keys, k)</span><br><span class="line">        self._keys.insert(i, k)</span><br><span class="line">        self._items.insert(i, item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="string">'Remove first occurence of item.  Raise ValueError if not found'</span></span><br><span class="line">        i = self.index(item)</span><br><span class="line">        <span class="keyword">del</span> self._keys[i]</span><br><span class="line">        <span class="keyword">del</span> self._items[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        <span class="string">'Return first item with a key == k.  Raise ValueError if not found.'</span></span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        <span class="keyword">if</span> i != len(self) <span class="keyword">and</span> self._keys[i] == k:</span><br><span class="line">            <span class="keyword">return</span> self._items[i]</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'No item found with key equal to: %r'</span> % (k,))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_le</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        <span class="string">'Return last item with a key &lt;= k.  Raise ValueError if not found.'</span></span><br><span class="line">        i = bisect_right(self._keys, k)</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            <span class="keyword">return</span> self._items[i<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'No item found with key at or below: %r'</span> % (k,))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_lt</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        <span class="string">'Return last item with a key &lt; k.  Raise ValueError if not found.'</span></span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            <span class="keyword">return</span> self._items[i<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'No item found with key below: %r'</span> % (k,))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_ge</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        <span class="string">'Return first item with a key &gt;= equal to k.  Raise ValueError if not found'</span></span><br><span class="line">        i = bisect_left(self._keys, k)</span><br><span class="line">        <span class="keyword">if</span> i != len(self):</span><br><span class="line">            <span class="keyword">return</span> self._items[i]</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'No item found with key at or above: %r'</span> % (k,))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_gt</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        <span class="string">'Return first item with a key &gt; k.  Raise ValueError if not found'</span></span><br><span class="line">        i = bisect_right(self._keys, k)</span><br><span class="line">        <span class="keyword">if</span> i != len(self):</span><br><span class="line">            <span class="keyword">return</span> self._items[i]</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'No item found with key above: %r'</span> % (k,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------  Simple demo and tests  -------------------------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ve2no</span><span class="params">(f, *args)</span>:</span></span><br><span class="line">        <span class="string">'Convert ValueError result to -1'</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> f(*args)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slow_index</span><span class="params">(seq, k)</span>:</span></span><br><span class="line">        <span class="string">'Location of match or -1 if not found'</span></span><br><span class="line">        <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(seq):</span><br><span class="line">            <span class="keyword">if</span> item == k:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slow_find</span><span class="params">(seq, k)</span>:</span></span><br><span class="line">        <span class="string">'First item with a key equal to k. -1 if not found'</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> seq:</span><br><span class="line">            <span class="keyword">if</span> item == k:</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slow_find_le</span><span class="params">(seq, k)</span>:</span></span><br><span class="line">        <span class="string">'Last item with a key less-than or equal to k.'</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> reversed(seq):</span><br><span class="line">            <span class="keyword">if</span> item &lt;= k:</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slow_find_lt</span><span class="params">(seq, k)</span>:</span></span><br><span class="line">        <span class="string">'Last item with a key less-than k.'</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> reversed(seq):</span><br><span class="line">            <span class="keyword">if</span> item &lt; k:</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slow_find_ge</span><span class="params">(seq, k)</span>:</span></span><br><span class="line">        <span class="string">'First item with a key-value greater-than or equal to k.'</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> seq:</span><br><span class="line">            <span class="keyword">if</span> item &gt;= k:</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slow_find_gt</span><span class="params">(seq, k)</span>:</span></span><br><span class="line">        <span class="string">'First item with a key-value greater-than or equal to k.'</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> seq:</span><br><span class="line">            <span class="keyword">if</span> item &gt; k:</span><br><span class="line">                <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line">    pool = [<span class="number">1.5</span>, <span class="number">2</span>, <span class="number">2.0</span>, <span class="number">3</span>, <span class="number">3.0</span>, <span class="number">3.5</span>, <span class="number">4</span>, <span class="number">4.0</span>, <span class="number">4.5</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">            s = [choice(pool) <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">            sc = SortedCollection(s)</span><br><span class="line">            s.sort()</span><br><span class="line">            <span class="keyword">for</span> probe <span class="keyword">in</span> pool:</span><br><span class="line">                <span class="keyword">assert</span> repr(ve2no(sc.index, probe)) == repr(slow_index(s, probe))</span><br><span class="line">                <span class="keyword">assert</span> repr(ve2no(sc.find, probe)) == repr(slow_find(s, probe))</span><br><span class="line">                <span class="keyword">assert</span> repr(ve2no(sc.find_le, probe)) == repr(slow_find_le(s, probe))</span><br><span class="line">                <span class="keyword">assert</span> repr(ve2no(sc.find_lt, probe)) == repr(slow_find_lt(s, probe))</span><br><span class="line">                <span class="keyword">assert</span> repr(ve2no(sc.find_ge, probe)) == repr(slow_find_ge(s, probe))</span><br><span class="line">                <span class="keyword">assert</span> repr(ve2no(sc.find_gt, probe)) == repr(slow_find_gt(s, probe))</span><br><span class="line">            <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(s):</span><br><span class="line">                <span class="keyword">assert</span> repr(item) == repr(sc[i])        <span class="comment"># test __getitem__</span></span><br><span class="line">                <span class="keyword">assert</span> item <span class="keyword">in</span> sc                       <span class="comment"># test __contains__ and __iter__</span></span><br><span class="line">                <span class="keyword">assert</span> s.count(item) == sc.count(item)  <span class="comment"># test count()</span></span><br><span class="line">            <span class="keyword">assert</span> len(sc) == n                         <span class="comment"># test __len__</span></span><br><span class="line">            <span class="keyword">assert</span> list(map(repr, reversed(sc))) == list(map(repr, reversed(s)))    <span class="comment"># test __reversed__</span></span><br><span class="line">            <span class="keyword">assert</span> list(sc.copy()) == list(sc)          <span class="comment"># test copy()</span></span><br><span class="line">            sc.clear()                                  <span class="comment"># test clear()</span></span><br><span class="line">            <span class="keyword">assert</span> len(sc) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    sd = SortedCollection(<span class="string">'The quick Brown Fox jumped'</span>.split(), key=str.lower)</span><br><span class="line">    <span class="keyword">assert</span> sd._keys == [<span class="string">'brown'</span>, <span class="string">'fox'</span>, <span class="string">'jumped'</span>, <span class="string">'quick'</span>, <span class="string">'the'</span>]</span><br><span class="line">    <span class="keyword">assert</span> sd._items == [<span class="string">'Brown'</span>, <span class="string">'Fox'</span>, <span class="string">'jumped'</span>, <span class="string">'quick'</span>, <span class="string">'The'</span>]</span><br><span class="line">    <span class="keyword">assert</span> sd._key == str.lower</span><br><span class="line">    <span class="keyword">assert</span> repr(sd) == <span class="string">"SortedCollection(['Brown', 'Fox', 'jumped', 'quick', 'The'], key=lower)"</span></span><br><span class="line">    sd.key = str.upper</span><br><span class="line">    <span class="keyword">assert</span> sd._key == str.upper</span><br><span class="line">    <span class="keyword">assert</span> len(sd) == <span class="number">5</span></span><br><span class="line">    <span class="keyword">assert</span> list(reversed(sd)) == [<span class="string">'The'</span>, <span class="string">'quick'</span>, <span class="string">'jumped'</span>, <span class="string">'Fox'</span>, <span class="string">'Brown'</span>]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> sd:</span><br><span class="line">        <span class="keyword">assert</span> item <span class="keyword">in</span> sd</span><br><span class="line">    <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(sd):</span><br><span class="line">        <span class="keyword">assert</span> item == sd[i]</span><br><span class="line">    sd.insert(<span class="string">'jUmPeD'</span>)</span><br><span class="line">    sd.insert_right(<span class="string">'QuIcK'</span>)</span><br><span class="line">    <span class="keyword">assert</span> sd._keys ==[<span class="string">'BROWN'</span>, <span class="string">'FOX'</span>, <span class="string">'JUMPED'</span>, <span class="string">'JUMPED'</span>, <span class="string">'QUICK'</span>, <span class="string">'QUICK'</span>, <span class="string">'THE'</span>]</span><br><span class="line">    <span class="keyword">assert</span> sd._items == [<span class="string">'Brown'</span>, <span class="string">'Fox'</span>, <span class="string">'jUmPeD'</span>, <span class="string">'jumped'</span>, <span class="string">'quick'</span>, <span class="string">'QuIcK'</span>, <span class="string">'The'</span>]</span><br><span class="line">    <span class="keyword">assert</span> sd.find_le(<span class="string">'JUMPED'</span>) == <span class="string">'jumped'</span>, sd.find_le(<span class="string">'JUMPED'</span>)</span><br><span class="line">    <span class="keyword">assert</span> sd.find_ge(<span class="string">'JUMPED'</span>) == <span class="string">'jUmPeD'</span></span><br><span class="line">    <span class="keyword">assert</span> sd.find_le(<span class="string">'GOAT'</span>) == <span class="string">'Fox'</span></span><br><span class="line">    <span class="keyword">assert</span> sd.find_ge(<span class="string">'GOAT'</span>) == <span class="string">'jUmPeD'</span></span><br><span class="line">    <span class="keyword">assert</span> sd.find(<span class="string">'FOX'</span>) == <span class="string">'Fox'</span></span><br><span class="line">    <span class="keyword">assert</span> sd[<span class="number">3</span>] == <span class="string">'jumped'</span></span><br><span class="line">    <span class="keyword">assert</span> sd[<span class="number">3</span>:<span class="number">5</span>] ==[<span class="string">'jumped'</span>, <span class="string">'quick'</span>]</span><br><span class="line">    <span class="keyword">assert</span> sd[<span class="number">-2</span>] == <span class="string">'QuIcK'</span></span><br><span class="line">    <span class="keyword">assert</span> sd[<span class="number">-4</span>:<span class="number">-2</span>] == [<span class="string">'jumped'</span>, <span class="string">'quick'</span>]</span><br><span class="line">    <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(sd):</span><br><span class="line">        <span class="keyword">assert</span> sd.index(item) == i</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sd.index(<span class="string">'xyzpdq'</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">0</span>, <span class="string">'Oops, failed to notify of missing value'</span></span><br><span class="line">    sd.remove(<span class="string">'jumped'</span>)</span><br><span class="line">    <span class="keyword">assert</span> list(sd) == [<span class="string">'Brown'</span>, <span class="string">'Fox'</span>, <span class="string">'jUmPeD'</span>, <span class="string">'quick'</span>, <span class="string">'QuIcK'</span>, <span class="string">'The'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> doctest</span><br><span class="line">    <span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line">    print(doctest.testmod())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> bisect </tag>
            
            <tag> binary serch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>list.sortæ–¹æ³•å’Œå†…ç½®å‡½æ•°sorted</title>
      <link href="/notes/fluent-python/list-sort-and-the-sorted-built-in-function/"/>
      <url>/notes/fluent-python/list-sort-and-the-sorted-built-in-function/</url>
      
        <content type="html"><![CDATA[<h1 id="pythonçš„ä¸€ä¸ªæƒ¯ä¾‹">Pythonçš„ä¸€ä¸ªæƒ¯ä¾‹</h1><p>å¦‚æžœä¸€ä¸ªå‡½æ•°æˆ–è€…æ–¹æ³•å¯¹å¯¹è±¡è¿›è¡Œçš„æ˜¯å°±åœ°æ”¹åŠ¨ï¼Œé‚£å®ƒå°±åº”è¯¥è¿”å›žNoneï¼Œå¥½è®©è°ƒç”¨è€…çŸ¥é“ä¼ å…¥çš„å‚æ•°å‘ç”Ÿäº†å˜åŠ¨ï¼Œè€Œä¸”å¹¶æœªäº§ç”Ÿæ–°çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œlist.sortå’Œrandom.shuffleå‡½æ•°ã€‚</p><h1 id="list.sortå’Œsorted">list.sortå’Œsorted</h1><blockquote><p><code>sort(*, key=None, reverse=False)</code></p></blockquote><blockquote><p><code>sorted(iterable, *, key=None, reverse=False)</code></p></blockquote><p>è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æœ‰ä¸¤ä¸ªå¯é€‰çš„å…³é”®å­—å‚æ•°ã€‚</p><ul><li><p>reverseï¼šå¦‚æžœè¢«è®¾å®šä¸ºTrueï¼Œè¢«æŽ’åºçš„åºåˆ—é‡Œçš„å…ƒç´ ä¼šä»¥é™åºè¾“å‡ºã€‚é»˜è®¤å€¼æ˜¯Falseã€‚</p></li><li><p>keyï¼šæŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«ç”¨åœ¨åºåˆ—é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œæ‰€äº§ç”Ÿçš„ç»“æžœå°†æ˜¯æŽ’åºç®—æ³•ä¾èµ–çš„å¯¹æ¯”å…³é”®å­—ã€‚é»˜è®¤å€¼æ˜¯Noneï¼Œç›´æŽ¥æ¯”è¾ƒå…ƒç´ ã€‚</p></li></ul><p>sortedå‡½æ•°ä¼šæ–°å»ºä¸€ä¸ªåˆ—è¡¨ä½œä¸ºè¿”å›žå€¼ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æŽ¥å—ä»»ä½•å½¢å¼çš„å¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”šè‡³åŒ…æ‹¬ä¸å¯å˜åºåˆ—æˆ–ç”Ÿæˆå™¨ã€‚è€Œä¸ç®¡æŽ¥å—çš„æ˜¯æ€Žæ ·çš„å‚æ•°ï¼Œå®ƒæœ€åŽéƒ½ä¼šè¿”å›žä¸€ä¸ªåˆ—è¡¨ã€‚</p><a id="more"></a><h1 id="ä¾‹">ä¾‹</h1><p>å‚æ•°ä½¿ç”¨ä¾‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits = [<span class="string">'grape'</span>, <span class="string">'apple'</span>, <span class="string">'banana'</span>, <span class="string">'Grape'</span>, <span class="string">'Apple'</span>, <span class="string">'Banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits.sort()  <span class="comment"># é»˜è®¤</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits  <span class="comment"># å‚æ•°æœ¬èº«æ”¹å˜äº†</span></span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Banana'</span>, <span class="string">'Grape'</span>, <span class="string">'apple'</span>, <span class="string">'banana'</span>, <span class="string">'grape'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits.sort(reverse=<span class="literal">True</span>)  <span class="comment"># é™åº</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits</span><br><span class="line">[<span class="string">'grape'</span>, <span class="string">'banana'</span>, <span class="string">'apple'</span>, <span class="string">'Grape'</span>, <span class="string">'Banana'</span>, <span class="string">'Apple'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits.sort(key=len)  <span class="comment"># æŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦æŽ’åº</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits</span><br><span class="line">[<span class="string">'grape'</span>, <span class="string">'apple'</span>, <span class="string">'Grape'</span>, <span class="string">'Apple'</span>, <span class="string">'banana'</span>, <span class="string">'Banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits.sort(key=str.lower)  <span class="comment"># æŒ‰ç…§å°å†™å­—æ¯çš„å¤§å°æŽ’åº</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits</span><br><span class="line">[<span class="string">'apple'</span>, <span class="string">'Apple'</span>, <span class="string">'banana'</span>, <span class="string">'Banana'</span>, <span class="string">'grape'</span>, <span class="string">'Grape'</span>]</span><br></pre></td></tr></table></figure><p>sortedå‡½æ•°ä½¿ç”¨ä¾‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits = [<span class="string">'grape'</span>, <span class="string">'apple'</span>, <span class="string">'banana'</span>, <span class="string">'Grape'</span>, <span class="string">'Apple'</span>, <span class="string">'Banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = sorted(fruits)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fruits  <span class="comment"># å‚æ•°ä¸å˜</span></span><br><span class="line">[<span class="string">'grape'</span>, <span class="string">'apple'</span>, <span class="string">'banana'</span>, <span class="string">'Grape'</span>, <span class="string">'Apple'</span>, <span class="string">'Banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r  <span class="comment"># è¿”å›žä¸€ä¸ªæ–°åˆ—è¡¨</span></span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Banana'</span>, <span class="string">'Grape'</span>, <span class="string">'apple'</span>, <span class="string">'banana'</span>, <span class="string">'grape'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = sorted(fruits)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r1 = sorted(tuple(fruits))  <span class="comment"># å‚æ•°æ˜¯ä¸å¯å˜åºåˆ—ï¼ˆå…ƒç»„ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r2 = sorted(set(fruits))  <span class="comment"># å‚æ•°æ˜¯é›†åˆ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r == r1 == r2</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = [(<span class="string">'amily'</span>, <span class="number">12</span>), (<span class="string">'william'</span>, <span class="number">17</span>), (<span class="string">'joseph'</span>, <span class="number">16</span>), (<span class="string">'olivia'</span>, <span class="number">13</span>), (<span class="string">'amily'</span>, <span class="number">11</span>), (<span class="string">'olivia'</span>, <span class="number">17</span>)]  <span class="comment"># (name, age)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = sorted(m)  <span class="comment"># é»˜è®¤å‚æ•°ï¼šæŒ‰nameå‡åºæŽ’åˆ—ï¼Œnameå®Œå…¨ä¸€æ ·ï¼ŒæŒ‰ageå‡åºæŽ’åˆ—</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r</span><br><span class="line">[(<span class="string">'amily'</span>, <span class="number">11</span>), (<span class="string">'amily'</span>, <span class="number">12</span>), (<span class="string">'joseph'</span>, <span class="number">16</span>), (<span class="string">'olivia'</span>, <span class="number">13</span>), (<span class="string">'olivia'</span>, <span class="number">17</span>), (<span class="string">'william'</span>, <span class="number">17</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = sorted(m, key=<span class="keyword">lambda</span> i: i[<span class="number">1</span>])  <span class="comment"># æŒ‰å¹´é¾„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r</span><br><span class="line">[(<span class="string">'amily'</span>, <span class="number">11</span>), (<span class="string">'amily'</span>, <span class="number">12</span>), (<span class="string">'olivia'</span>, <span class="number">13</span>), (<span class="string">'joseph'</span>, <span class="number">16</span>), (<span class="string">'william'</span>, <span class="number">17</span>), (<span class="string">'olivia'</span>, <span class="number">17</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = sorted(m, key=<span class="keyword">lambda</span> i: (i[<span class="number">1</span>], i[<span class="number">0</span>]))  <span class="comment"># å…ˆæŒ‰å¹´é¾„æŽ’åºï¼Œå¹´é¾„ç›¸åŒæ—¶æŒ‰åå­—æŽ’åº</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r</span><br><span class="line">[(<span class="string">'amily'</span>, <span class="number">11</span>), (<span class="string">'amily'</span>, <span class="number">12</span>), (<span class="string">'olivia'</span>, <span class="number">13</span>), (<span class="string">'joseph'</span>, <span class="number">16</span>), (<span class="string">'olivia'</span>, <span class="number">17</span>), (<span class="string">'william'</span>, <span class="number">17</span>)]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> sorted </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ‡ç‰‡</title>
      <link href="/notes/fluent-python/slicing/"/>
      <url>/notes/fluent-python/slicing/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆåˆ‡ç‰‡å’ŒåŒºé—´ä¼šå¿½ç•¥æœ€åŽä¸€ä¸ªå…ƒç´ ">ä¸ºä»€ä¹ˆåˆ‡ç‰‡å’ŒåŒºé—´ä¼šå¿½ç•¥æœ€åŽä¸€ä¸ªå…ƒç´ </h1><p>åœ¨åˆ‡ç‰‡å’ŒåŒºé—´æ“ä½œé‡Œä¸åŒ…å«åŒºé—´èŒƒå›´çš„æœ€åŽä¸€ä¸ªå…ƒç´ æ˜¯Pythonçš„é£Žæ ¼ï¼Œè¿™ä¸ªä¹ æƒ¯ç¬¦åˆPythonã€Cå’Œå…¶ä»–è¯­è¨€é‡Œä»¥0ä½œä¸ºèµ·å§‹ä¸‹æ ‡çš„ä¼ ç»Ÿã€‚è¿™æ ·åšå¸¦æ¥çš„å¥½å¤„å¦‚ä¸‹ã€‚</p><ul><li>å½“åªæœ‰æœ€åŽä¸€ä¸ªä½ç½®ä¿¡æ¯æ—¶ï¼Œå¯ä»¥å¿«é€Ÿçœ‹å‡ºåˆ‡ç‰‡å’ŒåŒºé—´é‡Œæœ‰å‡ ä¸ªå…ƒç´ ï¼šrange(3)å’Œmy_list[:3]éƒ½è¿”å›ž3ä¸ªå…ƒç´ ã€‚</li><li>å½“èµ·æ­¢ä½ç½®ä¿¡æ¯éƒ½å¯è§æ—¶ï¼Œå¯ä»¥å¿«é€Ÿè®¡ç®—å‡ºåˆ‡ç‰‡å’ŒåŒºé—´çš„é•¿åº¦ï¼Œç”¨åŽä¸€ä¸ªæ•°å‡åŽ»ç¬¬ä¸€ä¸ªä¸‹æ ‡(stop - start)å³å¯ã€‚</li><li>å¯ä»¥åˆ©ç”¨ä»»æ„ä¸€ä¸ªä¸‹æ ‡æ¥æŠŠåºåˆ—åˆ†å‰²æˆä¸é‡å çš„ä¸¤éƒ¨åˆ†ï¼Œåªè¦å†™æˆmy_list[:x]å’Œmy_list[x:]å°±å¯ä»¥äº†ã€‚</li></ul><h1 id="åˆ‡ç‰‡ç¤ºä¾‹">åˆ‡ç‰‡ç¤ºä¾‹</h1><p>åœ¨Pythoné‡Œï¼Œåƒåˆ—è¡¨ï¼ˆlistï¼‰ã€å…ƒç»„ï¼ˆtupleï¼‰å’Œå­—ç¬¦ä¸²ï¼ˆstrï¼‰è¿™ç±»åºåˆ—ç±»åž‹éƒ½æ”¯æŒåˆ‡ç‰‡æ“ä½œã€‚</p><p>å¸¸ç”¨ç”¨æ³•ï¼š<code>my_list[start:stop]</code></p><p>ç†è§£ï¼šå–å‡ºä¸‹æ ‡ä»Žstartåˆ°stop - 1ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼Œç»„æˆæ–°åˆ—è¡¨ã€‚</p><p>ç›¸å½“äºŽï¼š<code>[my_list[i] for i in range(start, stop)]</code></p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>li = list(range(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">0</span>:len(li)]  <span class="comment"># æ‹·è´æ•´ä¸ªåˆ—è¡¨</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[:]  <span class="comment"># å¸¸ç”¨å†™æ³•ï¼Œæ›´ç®€å•æ˜“è¯»</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">1</span>:]  <span class="comment"># ä»Žç¬¬1ä¸ªå…ƒç´ åˆ‡åˆ°æœ€åŽä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[:<span class="number">5</span>]  <span class="comment"># ä»Žç¬¬0ä¸ªå…ƒç´ åˆ‡åˆ°ç¬¬4ä¸ªå…ƒç´ </span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">1</span>:<span class="number">5</span>] <span class="comment"># ä»Žç¬¬0ä¸ªå…ƒç´ åˆ‡åˆ°ç¬¬4ä¸ªå…ƒç´ </span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure><p>æ›´é«˜çº§çš„ï¼š<code>my_list[start:stop:step]</code></p><p>ç†è§£ï¼šå°†my_list[start:stop]æŒ‰åºåˆ†ç»„ï¼Œæ¯ç»„stepä¸ªå…ƒç´ ï¼Œå–å‡ºæ¯ç»„çš„ç¬¬1ä¸ªå…ƒç´ ç»„æˆæ–°åˆ—è¡¨ã€‚</p><p>ç›¸å½“äºŽï¼š<code>[my_list[i] for i in range(start, stop, step)]</code></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[::<span class="number">1</span>]  <span class="comment"># ç­‰ä»·äºŽ li[:]</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[::<span class="number">3</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[::<span class="number">-1</span>] <span class="comment"># stepå¯ä»¥ä¸ºè´Ÿå€¼ï¼Œè´Ÿå€¼æ„å‘³ç€åå‘å–å€¼</span></span><br><span class="line">[<span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">5</span>:<span class="number">1</span>:<span class="number">-2</span>]</span><br><span class="line">[<span class="number">5</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure><h1 id="åˆ‡ç‰‡å¯¹è±¡">åˆ‡ç‰‡å¯¹è±¡</h1><blockquote><p><code>class slice(stop)</code></p></blockquote><blockquote><p><code>class slice(start, stop[, step])</code></p></blockquote><p><code>a:b:c</code>è¿™ç§ç”¨æ³•åªèƒ½ä½œä¸ºç´¢å¼•æˆ–è€…ä¸‹æ ‡ç”¨åœ¨[]ä¸­æ¥è¿”å›žä¸€ä¸ªåˆ‡ç‰‡å¯¹è±¡ï¼šslice(a, b, c)ã€‚åœ¨å¯¹seq[start:stop:step]è¿›è¡Œæ±‚å€¼çš„æ—¶å€™ï¼ŒPythonä¼šè°ƒç”¨<code>seq.__getitem__(slice(start, stop, step))</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>first_five = slice(<span class="number">5</span>)  <span class="comment"># 1ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[first_five]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>last_five = slice(len(li) - <span class="number">5</span>, len(li))  <span class="comment"># 2ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[last_five]</span><br><span class="line">[<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd = slice(<span class="number">1</span>, len(li), <span class="number">2</span>)  <span class="comment"># å…¨éƒ¨3ä¸ªå‚æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[odd]</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><h1 id="ç»™åˆ‡ç‰‡èµ‹å€¼">ç»™åˆ‡ç‰‡èµ‹å€¼</h1><p>å¦‚æžœæŠŠåˆ‡ç‰‡æ”¾åœ¨èµ‹å€¼è¯­å¥çš„å·¦è¾¹ï¼Œæˆ–æŠŠå®ƒä½œä¸ºdelæ“ä½œçš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹åºåˆ—è¿›è¡Œå«æŽ¥ã€åˆ‡é™¤æˆ–å°±åœ°ä¿®æ”¹æ“ä½œã€‚</p><p>å¦‚æžœèµ‹å€¼çš„å¯¹è±¡æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œé‚£ä¹ˆèµ‹å€¼è¯­å¥çš„å³ä¾§å¿…é¡»æ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚å³ä¾¿åªæœ‰å•ç‹¬ä¸€ä¸ªå€¼ï¼Œä¹Ÿè¦æŠŠå®ƒè½¬æ¢æˆå¯è¿­ä»£çš„åºåˆ—ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">2</span>:<span class="number">3</span>] = <span class="number">-2</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: can only assign an iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">2</span>:<span class="number">3</span>] = [<span class="number">-2</span>]  <span class="comment"># å¿…é¡»å¯è¿­ä»£</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">-2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">0</span>:<span class="number">6</span>] = [<span class="number">-1</span>, <span class="number">-2</span>, <span class="number">-3</span>, <span class="number">-4</span>, <span class="number">-5</span>]  <span class="comment"># åˆ‡é™¤å‰6ä¸ªå…ƒç´ ï¼Œå«æŽ¥5ä¸ªæ–°å…ƒç´ </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li</span><br><span class="line">[<span class="number">-1</span>, <span class="number">-2</span>, <span class="number">-3</span>, <span class="number">-4</span>, <span class="number">-5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li = list(range(<span class="number">10</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li[<span class="number">2</span>::<span class="number">2</span>] = [<span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-6</span>, <span class="number">-8</span>]  <span class="comment"># å¶æ•°æ”¹ä¸ºè´Ÿå€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">-2</span>, <span class="number">3</span>, <span class="number">-4</span>, <span class="number">5</span>, <span class="number">-6</span>, <span class="number">7</span>, <span class="number">-8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> li[<span class="number">1</span>::<span class="number">2</span>]  <span class="comment"># åˆ é™¤å¥‡æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>li</span><br><span class="line">[<span class="number">0</span>, <span class="number">-2</span>, <span class="number">-4</span>, <span class="number">-6</span>, <span class="number">-8</span>]</span><br></pre></td></tr></table></figure><h1 id="å¤šç»´åˆ‡ç‰‡å’Œçœç•¥">å¤šç»´åˆ‡ç‰‡å’Œçœç•¥</h1><p>[]è¿ç®—ç¬¦é‡Œè¿˜å¯ä»¥ä½¿ç”¨é€—å·åˆ†å¼€çš„å¤šä¸ªç´¢å¼•æˆ–è€…æ˜¯åˆ‡ç‰‡ï¼Œå¤–éƒ¨åº“NumPyé‡Œå°±ç”¨åˆ°äº†è¿™ä¸ªç‰¹æ€§ï¼ŒäºŒç»´çš„numpy.ndarrayå°±å¯ä»¥ç”¨a[i, j]è¿™ç§å½¢å¼æ¥èŽ·å–ï¼ŒæŠ‘æˆ–æ˜¯a[m:n, k:l]çš„æ–¹å¼æ¥å¾—åˆ°äºŒç»´åˆ‡ç‰‡ã€‚è¦æ­£ç¡®å¤„ç†è¿™ç§[]è¿ç®—ç¬¦çš„è¯ï¼Œå¯¹è±¡çš„ç‰¹æ®Šæ–¹æ³•<code>__getitem__</code>å’Œ<code>__setitem__</code>éœ€è¦ä»¥å…ƒç»„çš„å½¢å¼æ¥æŽ¥æ”¶a[i, j]ä¸­çš„ç´¢å¼•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœè¦å¾—åˆ°a[i, j]çš„å€¼ï¼ŒPythonä¼šè°ƒç”¨<code>a.__getitem__((i, j))</code>ã€‚</p><p>Pythonå†…ç½®çš„åºåˆ—ç±»åž‹éƒ½æ˜¯ä¸€ç»´çš„ï¼Œå› æ­¤å®ƒä»¬åªæ”¯æŒå•ä¸€çš„ç´¢å¼•ï¼Œæˆå¯¹å‡ºçŽ°çš„ç´¢å¼•æ˜¯æ²¡æœ‰ç”¨çš„ã€‚</p><p>çœç•¥ï¼ˆellipsisï¼‰çš„æ­£ç¡®ä¹¦å†™æ–¹æ³•æ˜¯ä¸‰ä¸ªè‹±æ–‡å¥å·ï¼ˆ<code>...</code>ï¼‰ã€‚çœç•¥åœ¨Pythonè§£é‡Šå™¨çœ¼é‡Œæ˜¯ä¸€ä¸ªç¬¦å·ï¼Œè€Œå®žé™…ä¸Šå®ƒæ˜¯Ellipsiså¯¹è±¡çš„åˆ«åï¼Œè€ŒEllipsiså¯¹è±¡åˆæ˜¯ellipsisç±»çš„å•ä¸€å®žä¾‹ï¼ˆæ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œellipsisæ˜¯ç±»åï¼Œå…¨å°å†™ï¼Œè€Œå®ƒçš„å†…ç½®å®žä¾‹å†™ä½œEllipsisã€‚è¿™å…¶å®žè·Ÿboolæ˜¯å°å†™ï¼Œä½†æ˜¯å®ƒçš„ä¸¤ä¸ªå®žä¾‹å†™ä½œTrueå’ŒFalseå¼‚æ›²åŒå·¥ï¼‰ã€‚å®ƒå¯ä»¥å½“ä½œåˆ‡ç‰‡è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å‡½æ•°çš„å‚æ•°æ¸…å•ä¸­ï¼Œæ¯”å¦‚<code>f(a, ..., z)</code>ï¼Œæˆ–<code>a[i:...]</code>ã€‚åœ¨NumPyä¸­ï¼Œ<code>...</code>ç”¨ä½œå¤šç»´æ•°ç»„åˆ‡ç‰‡çš„å¿«æ·æ–¹å¼ã€‚å¦‚æžœxæ˜¯å››ç»´æ•°ç»„ï¼Œé‚£ä¹ˆ<code>x[i,...]</code>å°±æ˜¯<code>x[i, :, :, :]</code>çš„ç¼©å†™ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.arange(<span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(a)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">numpy</span>.<span class="title">ndarray</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">a</span>.<span class="title">shape</span>  # æŸ¥çœ‹ç»´åº¦</span></span><br><span class="line"><span class="class"><span class="params">(<span class="number">12</span>,)</span>  # ä¸€ç»´çš„å«æœ‰12ä¸ªå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">&gt;&gt;&gt; a.shape = 3, 4  # å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªäºŒç»´çš„æ•°ç»„</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</span><br><span class="line">       [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">       [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.shape</span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>)  <span class="comment"># äºŒç»´ï¼Œå„ç»´åº¦åˆ†åˆ«å«æœ‰3ã€4ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">0</span>, <span class="number">1</span>]  <span class="comment"># ç­‰ä»·äºŽa[0][1]</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>:, <span class="number">2</span>:]</span><br><span class="line">array([[ <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">       [<span class="number">10</span>, <span class="number">11</span>]])</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.shape = <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>  <span class="comment"># è½¬æ¢ä¸ºä¸‰ç»´æ•°ç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>],</span><br><span class="line">        [ <span class="number">2</span>,  <span class="number">3</span>]],</span><br><span class="line"></span><br><span class="line">       [[ <span class="number">4</span>,  <span class="number">5</span>],</span><br><span class="line">        [ <span class="number">6</span>,  <span class="number">7</span>]],</span><br><span class="line"></span><br><span class="line">       [[ <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">11</span>]]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>:, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">array([<span class="number">5</span>, <span class="number">9</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>, <span class="built_in">Ellipsis</span>]  <span class="comment"># å®Œæ•´çš„å–å‡ºç¬¬1ä¸ªç»´åº¦çš„1å·å…ƒç´ </span></span><br><span class="line">array([[<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">       [<span class="number">6</span>, <span class="number">7</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>...</span><br><span class="line"><span class="built_in">Ellipsis</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>, ...]  <span class="comment"># å®Œæ•´çš„å–å‡ºç¬¬1ä¸ªç»´åº¦çš„1å·å…ƒç´ </span></span><br><span class="line">array([[<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">       [<span class="number">6</span>, <span class="number">7</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>, :, :]</span><br><span class="line">array([[<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">       [<span class="number">6</span>, <span class="number">7</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[..., <span class="number">1</span>]  <span class="comment"># å–å‡ºæœ€åŽ1ä¸ªç»´åº¦çš„1å·å…ƒç´ </span></span><br><span class="line">array([[ <span class="number">1</span>,  <span class="number">3</span>],</span><br><span class="line">       [ <span class="number">5</span>,  <span class="number">7</span>],</span><br><span class="line">       [ <span class="number">9</span>, <span class="number">11</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[..., <span class="number">1</span>, ...]  <span class="comment"># ä¸èƒ½åŒ…å«å¤šä¸ªellipsis</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">IndexError: an index can only have a single ellipsis (<span class="string">'...'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> slicing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python map filter å‡½æ•°</title>
      <link href="/programming/python-map-filter-methods/"/>
      <url>/programming/python-map-filter-methods/</url>
      
        <content type="html"><![CDATA[<h1 id="map">map</h1><blockquote><p><a href="https://devdocs.io/python~3.6/library/functions#map" target="_blank" rel="noopener"><code>map(function, iterable, ...)</code></a></p></blockquote><p>å°† iterable ä¸­çš„å…ƒç´ ä¾æ¬¡ä¼ å…¥ functionï¼Œè¿”å›ž function çš„è¿”å›žå€¼ã€‚ç›¸å½“äºŽ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">map</span><span class="params">(function, *iterable)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> zip(*iterable):</span><br><span class="line">        <span class="keyword">yield</span> function(*e)</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç±»åž‹è½¬æ¢</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(int, <span class="string">'0123456789'</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹åº”ä½ç½®ä¸¤æ•°ç›¸åŠ ã€‚å½“åˆ—è¡¨é•¿åº¦ä¸ä¸€è‡´æ—¶ï¼ŒæŒ‰ç…§æœ€å°çš„é‚£ä¸ªé•¿åº¦ç®—ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(<span class="keyword">lambda</span> x, y: x + y, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># map çš„è‰¯å¥½æ›¿ä»£ï¼šåˆ—è¡¨æŽ¨å¯¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[int(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'0123456789'</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x + y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip(range(<span class="number">1</span>, <span class="number">6</span>), range(<span class="number">1</span>, <span class="number">5</span>))]</span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure><h1 id="filter">filter</h1><blockquote><p><a href="https://devdocs.io/python~3.6/library/functions#filter" target="_blank" rel="noopener"><code>filter(function, iterable)</code></a></p></blockquote><p>å°† iterable ä¸­çš„å…ƒç´ ä¾æ¬¡ä¼ å…¥ functionï¼Œè¿”å›ž function çš„è¿”å›žå€¼ä¸ºçœŸæ—¶çš„å…ƒç´ ã€‚</p><p>å½“ <code>function != None</code> æ—¶ï¼Œç›¸å½“äºŽ <code>(item for item in iterable if function(item))</code>ï¼›</p><p>å½“ <code>function == None</code> æ—¶ï¼Œç›¸å½“äºŽ <code>(item for item in iterable if item)</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿”å›ž10ä»¥ä¸‹çš„å¶æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span>, range(<span class="number">11</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—è¡¨æŽ¨å¯¼ä¹Ÿæ˜¯filterçš„è‰¯å¥½æ›¿ä»£</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><h1 id="ç»„åˆä½¿ç”¨">ç»„åˆä½¿ç”¨</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€‰å‡ºå°äºŽ10çš„å¶æ•°ï¼Œå¹¶è½¬æˆå­—ç¬¦ä¸²ç±»åž‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(map(str, filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span> ==<span class="number">0</span>, range(<span class="number">10</span>))))</span><br><span class="line">[<span class="string">'0'</span>, <span class="string">'2'</span>, <span class="string">'4'</span>, <span class="string">'6'</span>, <span class="string">'8'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[str(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">[<span class="string">'0'</span>, <span class="string">'2'</span>, <span class="string">'4'</span>, <span class="string">'6'</span>, <span class="string">'8'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åè¿‡æ¥ï¼Œå°†ä»£è¡¨æ•°å€¼å°äºŽ10çš„å­—ç¬¦ä¸²è½¬æˆintï¼Œå†é€‰å‡ºå…¶ä¸­çš„å¶æ•°ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(filter(<span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span>, map(int, <span class="string">'0123456789'</span>)))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[int(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'0123456789'</span> <span class="keyword">if</span> int(i) % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•</title>
      <link href="/notes/fluent-python/how-special-methods-are-used/"/>
      <url>/notes/fluent-python/how-special-methods-are-used/</url>
      
        <content type="html"><![CDATA[<p>ä¸ç®¡åœ¨å“ªç§æ¡†æž¶ä¸‹å†™ç¨‹åºï¼Œéƒ½ä¼šèŠ±è´¹å¤§é‡æ—¶é—´åŽ»å®žçŽ°é‚£äº›ä¼šè¢«æ¡†æž¶æœ¬èº«è°ƒç”¨çš„æ–¹æ³•ï¼ŒPythonä¹Ÿä¸ä¾‹å¤–ã€‚Pythonè§£é‡Šå™¨ç¢°åˆ°ç‰¹æ®Šçš„å¥æ³•æ—¶ï¼Œä¼šä½¿ç”¨ç‰¹æ®Šæ–¹æ³•åŽ»æ¿€æ´»ä¸€äº›åŸºæœ¬çš„å¯¹è±¡æ“ä½œï¼Œè¿™äº›ç‰¹æ®Šæ–¹æ³•çš„åå­—ä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿ç»“å°¾(ä¾‹å¦‚<code>__getitem__</code>)ã€‚æ¯”å¦‚obj[key]çš„èƒŒåŽå°±æ˜¯<code>__getitem__</code>æ–¹æ³•ï¼Œä¸ºäº†èƒ½æ±‚å¾—my_collection[key]çš„å€¼ï¼Œè§£é‡Šå™¨å®žé™…ä¸Šä¼šè°ƒç”¨<code>my_collection.__getitem__(key)</code>ã€‚</p><p>è¿™äº›ç‰¹æ®Šæ–¹æ³•åèƒ½è®©ä½ è‡ªå·±çš„å¯¹è±¡å®žçŽ°å’Œæ”¯æŒä»¥ä¸‹çš„è¯­è¨€æž¶æž„ï¼Œå¹¶ä¸Žä¹‹äº¤äº’ï¼š</p><ul><li>è¿­ä»£</li><li>é›†åˆç±»</li><li>å±žæ€§è®¿é—®</li><li>è¿ç®—ç¬¦é‡è½½</li><li>å‡½æ•°å’Œæ–¹æ³•çš„è°ƒç”¨</li><li>å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯</li><li>å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼å’Œæ ¼å¼åŒ–</li><li>ç®¡ç†ä¸Šä¸‹æ–‡ï¼ˆå³withå—ï¼‰</li></ul><a id="more"></a><h1 id="ä¸€æ‘žpythoné£Žæ ¼çš„çº¸ç‰Œ">ä¸€æ‘žPythoné£Žæ ¼çš„çº¸ç‰Œ</h1><figure class="highlight python"><figcaption><span>french_deck.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">Card = collections.namedtuple(<span class="string">'Card'</span>, [<span class="string">'rank'</span>, <span class="string">'suit'</span>])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrenchDeck</span>:</span></span><br><span class="line">    ranks = [str(n) <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">11</span>)] + list(<span class="string">'JQKA'</span>)</span><br><span class="line">    suits = <span class="string">'spades diamonds clubs hearts'</span>.split()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'__init__'</span>)</span><br><span class="line">        self._cards = [Card(rank, suit) <span class="keyword">for</span> suit <span class="keyword">in</span> self.suits</span><br><span class="line">                       <span class="keyword">for</span> rank <span class="keyword">in</span> self.ranks]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'__len__'</span>)</span><br><span class="line">        <span class="keyword">return</span> len(self._cards)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'__getitem__'</span>)</span><br><span class="line">        <span class="keyword">return</span> self._cards[item]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">'__setitem__'</span>)</span><br><span class="line">        self._cards[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'__iter__'</span>)</span><br><span class="line"></span><br><span class="line">suit_values = dict(spades=<span class="number">3</span>, hearts=<span class="number">2</span>, diamonds=<span class="number">1</span>, clubs=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spades_high</span><span class="params">(card)</span>:</span></span><br><span class="line">    <span class="comment"># æŒ‰ç…§å¸¸è§„ï¼Œç”¨ç‚¹æ•°æ¥åˆ¤å®šæ‰‘å…‹ç‰Œçš„å¤§å°ï¼Œ2 æœ€å°ã€A æœ€å¤§ï¼›</span></span><br><span class="line">    <span class="comment"># åŒæ—¶è¿˜è¦åŠ ä¸Šå¯¹èŠ±è‰²çš„åˆ¤å®šï¼Œé»‘æ¡ƒæœ€å¤§ã€çº¢æ¡ƒæ¬¡ä¹‹ã€æ–¹å—å†æ¬¡ã€æ¢…èŠ±æœ€å°ã€‚</span></span><br><span class="line">    rank_value = FrenchDeck.ranks.index(card.rank)</span><br><span class="line">    <span class="keyword">return</span> rank_value * len(suit_values) + suit_values[card.suit]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> french_deck <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> random <span class="keyword">import</span> choice, randrange</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck = FrenchDeck()  <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">__init__</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(deck)  <span class="comment"># len</span></span><br><span class="line">__len__</span><br><span class="line"><span class="number">52</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck[<span class="number">0</span>]  <span class="comment"># ä¸‹æ ‡è®¿é—®</span></span><br><span class="line">__getitem__</span><br><span class="line">Card(rank=<span class="string">'2'</span>, suit=<span class="string">'spades'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>choice(deck)  <span class="comment"># éšæœºæŠ½å–</span></span><br><span class="line">__len__</span><br><span class="line">__getitem__</span><br><span class="line">Card(rank=<span class="string">'K'</span>, suit=<span class="string">'diamonds'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck[randrange(<span class="number">0</span>, len(deck))]  <span class="comment"># éšæœºæŠ½å–ç­‰ä»·æ›¿ä»£</span></span><br><span class="line">__len__</span><br><span class="line">__getitem__</span><br><span class="line">Card(rank=<span class="string">'8'</span>, suit=<span class="string">'clubs'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> card <span class="keyword">in</span> deck:  <span class="comment"># è¿­ä»£ï¼Œæ— éœ€è°ƒç”¨__len__æ–¹æ³•</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line">__getitem__</span><br><span class="line"><span class="comment"># ä¸­é—´å…¨éƒ½æ˜¯__getitem__ #</span></span><br><span class="line">__getitem__</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck[<span class="number">-2</span>:]  <span class="comment"># åˆ‡ç‰‡ï¼Œæ³¨æ„åªè°ƒç”¨ä¸€æ¬¡__getitem__æ–¹æ³•</span></span><br><span class="line">__getitem__</span><br><span class="line">[Card(rank=<span class="string">'K'</span>, suit=<span class="string">'hearts'</span>), Card(rank=<span class="string">'A'</span>, suit=<span class="string">'hearts'</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck[<span class="number">12</span>::<span class="number">13</span>]  <span class="comment"># ä»Žç¬¬12å¼ ç‰Œå¼€å§‹ï¼Œæ¯éš”13å¼ å–ä¸€å¼ ç‰Œ</span></span><br><span class="line">__getitem__</span><br><span class="line">[Card(rank=<span class="string">'A'</span>, suit=<span class="string">'spades'</span>), Card(rank=<span class="string">'A'</span>, suit=<span class="string">'diamonds'</span>), Card(rank=<span class="string">'A'</span>, suit=<span class="string">'clubs'</span>), Card(rank=<span class="string">'A'</span>, suit=<span class="string">'hearts'</span>)]</span><br></pre></td></tr></table></figure><p>è¿­ä»£é€šå¸¸æ˜¯éšå¼çš„ï¼Œè­¬å¦‚è¯´ä¸€ä¸ªé›†åˆç±»åž‹æ²¡æœ‰å®žçŽ°<code>__contains__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆinè¿ç®—ç¬¦å°±ä¼šæŒ‰é¡ºåºåšä¸€æ¬¡è¿­ä»£æœç´¢ã€‚äºŽæ˜¯ï¼Œinè¿ç®—ç¬¦å¯ä»¥ç”¨åœ¨æˆ‘ä»¬çš„FrenchDeckç±»ä¸Šï¼Œå› ä¸ºå®ƒæ˜¯å¯è¿­ä»£çš„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>deck[<span class="number">2</span>]</span><br><span class="line">__getitem__</span><br><span class="line">Card(rank=<span class="string">'4'</span>, suit=<span class="string">'spades'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Card(<span class="string">'4'</span>, <span class="string">'spades'</span>) <span class="keyword">in</span> deck  <span class="comment"># inï¼Œæ²¡æœ‰å®žçŽ°__contains__æ–¹å¼æ—¶ï¼ŒæŒ‰é¡ºåºæŸ¥æ‰¾</span></span><br><span class="line">__getitem__</span><br><span class="line">__getitem__</span><br><span class="line">__getitem__</span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> card <span class="keyword">in</span> sorted(deck, key=spades_high):  <span class="comment"># sorted</span></span><br><span class="line"><span class="meta">... </span>    print(card)</span><br><span class="line">...</span><br><span class="line">__len__</span><br><span class="line">__getitem__</span><br><span class="line"><span class="comment"># çœç•¥ #</span></span><br><span class="line">__getitem__</span><br><span class="line">Card(rank=<span class="string">'2'</span>, suit=<span class="string">'clubs'</span>)</span><br><span class="line">Card(rank=<span class="string">'2'</span>, suit=<span class="string">'diamonds'</span>)</span><br><span class="line"><span class="comment"># çœç•¥ #</span></span><br><span class="line">Card(rank=<span class="string">'A'</span>, suit=<span class="string">'hearts'</span>)</span><br><span class="line">Card(rank=<span class="string">'A'</span>, suit=<span class="string">'spades'</span>)</span><br></pre></td></tr></table></figure><p>è™½ç„¶FrenchDeckéšå¼åœ°ç»§æ‰¿äº†objectç±»ï¼Œä½†åŠŸèƒ½å´ä¸æ˜¯ç»§æ‰¿è€Œæ¥çš„ã€‚æˆ‘ä»¬é€šè¿‡æ•°æ®æ¨¡åž‹å’Œä¸€äº›åˆæˆæ¥å®žçŽ°è¿™äº›åŠŸèƒ½ã€‚é€šè¿‡å®žçŽ°<code>__len__</code>å’Œ<code>__getitem__</code>è¿™ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•ï¼ŒFrenchDeckå°±è·Ÿä¸€ä¸ªPythonè‡ªæœ‰çš„åºåˆ—æ•°æ®ç±»åž‹ä¸€æ ·ï¼Œå¯ä»¥ä½“çŽ°å‡ºPythonçš„æ ¸å¿ƒè¯­è¨€ç‰¹æ€§ï¼ˆä¾‹å¦‚è¿­ä»£å’Œåˆ‡ç‰‡ï¼‰ã€‚åŒæ—¶è¿™ä¸ªç±»è¿˜å¯ä»¥ç”¨äºŽæ ‡å‡†åº“ä¸­è¯¸å¦‚random.choiceã€reversedå’Œsortedè¿™äº›å‡½æ•°ã€‚å¦å¤–ï¼Œå¯¹åˆæˆçš„è¿ç”¨ä½¿å¾—<code>__len__</code>å’Œ<code>__getitem__</code>çš„å…·ä½“å®žçŽ°å¯ä»¥ä»£ç†ç»™self._cardsè¿™ä¸ªPythonåˆ—è¡¨ï¼ˆå³listå¯¹è±¡ï¼‰ã€‚</p><table><thead><tr class="header"><th>æ“ä½œ</th><th>åº•å±‚æ”¯æŒ</th></tr></thead><tbody><tr class="odd"><td>åˆå§‹åŒ–</td><td><code>__init__</code></td></tr><tr class="even"><td>èŽ·å–é•¿åº¦</td><td><code>__len__</code></td></tr><tr class="odd"><td>ä¸‹æ ‡è®¿é—®</td><td><code>__getitem__</code></td></tr><tr class="even"><td>éšæœºæŠ½å–</td><td><code>__len__</code>, <code>__getitem__</code></td></tr><tr class="odd"><td>æŸ¥è¯¢</td><td><code>__getitem__</code>ï¼ˆæ²¡æœ‰å®žçŽ°<code>__contains__</code>æ–¹æ³•æ—¶ï¼Œinè¿ç®—ç¬¦ä¼šåšä¸€æ¬¡é¡ºåºæœç´¢ï¼‰</td></tr><tr class="even"><td>è¿­ä»£</td><td><code>__getitem__</code>ï¼ˆè°ƒç”¨æ¬¡æ•°ä¸Žè¿­ä»£æ¬¡æ•°æœ‰å…³ï¼Œç¥žå¥‡çš„æ˜¯ä¸éœ€è¦è°ƒç”¨<code>__len__</code>ï¼‰</td></tr><tr class="odd"><td>åˆ‡ç‰‡</td><td><code>__getitem__</code>ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼ŒåŒæ ·ä¸éœ€è¦è°ƒç”¨<code>__len__</code>ï¼‰</td></tr><tr class="even"><td>æŽ’åº</td><td><code>__len__</code>ï¼ˆä¸€æ¬¡ï¼‰, <code>__getitem__</code>ï¼ˆè°ƒç”¨æ¬¡æ•°ä¸Žè¿­ä»£æ¬¡æ•°æœ‰å…³ï¼‰</td></tr></tbody></table><h1 id="å¦‚ä½•ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•">å¦‚ä½•ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•</h1><p>é¦–å…ˆæ˜Žç¡®ä¸€ç‚¹ï¼Œç‰¹æ®Šæ–¹æ³•çš„å­˜åœ¨æ˜¯ä¸ºäº†è¢«Pythonè§£é‡Šå™¨è°ƒç”¨çš„ï¼Œä½ è‡ªå·±å¹¶ä¸éœ€è¦è°ƒç”¨å®ƒä»¬ã€‚ä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰<code>my_object.__len__()</code>è¿™ç§å†™æ³•ï¼Œè€Œåº”è¯¥ä½¿ç”¨len(my_object)ã€‚åœ¨æ‰§è¡Œlen(my_object)çš„æ—¶å€™ï¼Œå¦‚æžœmy_objectæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆPythonä¼šè‡ªå·±åŽ»è°ƒç”¨å…¶ä¸­ç”±ä½ å®žçŽ°çš„<code>__len__</code>æ–¹æ³•ã€‚</p><p>ç„¶è€Œå¦‚æžœæ˜¯Pythonå†…ç½®çš„ç±»åž‹ï¼Œæ¯”å¦‚åˆ—è¡¨(list)ã€å­—ç¬¦ä¸²(str)ã€å­—èŠ‚åºåˆ—(bytearray)ç­‰ï¼Œé‚£ä¹ˆCPythonä¼šæŠ„ä¸ªè¿‘è·¯ï¼Œ<code>__len__</code>å®žé™…ä¸Šä¼šç›´æŽ¥è¿”å›žPyVarObjecté‡Œçš„ob_sizeå±žæ€§ã€‚PyVarObjectæ˜¯è¡¨ç¤ºå†…å­˜ä¸­é•¿åº¦å¯å˜çš„å†…ç½®å¯¹è±¡çš„Cè¯­è¨€ç»“æž„ä½“ã€‚ç›´æŽ¥è¯»å–è¿™ä¸ªå€¼æ¯”è°ƒç”¨ä¸€ä¸ªæ–¹æ³•è¦å¿«å¾ˆå¤šã€‚</p><p>å¾ˆå¤šæ—¶å€™ï¼Œç‰¹æ®Šæ–¹æ³•çš„è°ƒç”¨æ˜¯éšå¼çš„ï¼Œæ¯”å¦‚for i in xè¿™ä¸ªè¯­å¥ï¼ŒèƒŒåŽå…¶å®žç”¨çš„æ˜¯iter(x)ï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„èƒŒåŽåˆ™æ˜¯<code>x.__iter__()</code>æ–¹æ³•ã€‚å½“ç„¶<strong>å‰æ</strong>æ˜¯è¿™ä¸ªæ–¹æ³•åœ¨xä¸­è¢«å®žçŽ°äº†ã€‚</p><p>é€šå¸¸ä½ çš„ä»£ç æ— éœ€ç›´æŽ¥ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•ã€‚é™¤éžæœ‰å¤§é‡çš„å…ƒç¼–ç¨‹å­˜åœ¨ï¼Œç›´æŽ¥è°ƒç”¨ç‰¹æ®Šæ–¹æ³•çš„é¢‘çŽ‡åº”è¯¥è¿œè¿œä½ŽäºŽä½ åŽ»å®žçŽ°å®ƒä»¬çš„æ¬¡æ•°ã€‚å”¯ä¸€çš„ä¾‹å¤–å¯èƒ½æ˜¯<code>__init__</code>æ–¹æ³•ï¼Œä½ çš„ä»£ç é‡Œå¯èƒ½ç»å¸¸ä¼šç”¨åˆ°å®ƒï¼Œç›®çš„æ˜¯åœ¨ä½ è‡ªå·±çš„å­ç±»çš„<code>__init__</code>æ–¹æ³•ä¸­è°ƒç”¨è¶…ç±»çš„æž„é€ å™¨ã€‚</p><p>é€šè¿‡å†…ç½®çš„å‡½æ•°ï¼ˆä¾‹å¦‚lenã€iterã€strï¼Œç­‰ç­‰ï¼‰æ¥ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚è¿™äº›å†…ç½®å‡½æ•°ä¸ä»…ä¼šè°ƒç”¨ç‰¹æ®Šæ–¹æ³•ï¼Œé€šå¸¸è¿˜æä¾›é¢å¤–çš„å¥½å¤„ï¼Œè€Œä¸”å¯¹äºŽå†…ç½®çš„ç±»æ¥è¯´ï¼Œå®ƒä»¬çš„é€Ÿåº¦æ›´å¿«ã€‚</p><p>ä¸è¦è‡ªå·±æƒ³å½“ç„¶åœ°éšæ„æ·»åŠ ç‰¹æ®Šæ–¹æ³•ï¼Œæ¯”å¦‚<code>__foo__</code>ä¹‹ç±»çš„ï¼Œå› ä¸ºè™½ç„¶çŽ°åœ¨è¿™ä¸ªåå­—æ²¡æœ‰è¢«Pythonå†…éƒ¨ä½¿ç”¨ï¼Œä»¥åŽå°±ä¸ä¸€å®šäº†ã€‚</p><h2 id="æ¨¡æ‹Ÿæ•°å€¼ç±»åž‹">æ¨¡æ‹Ÿæ•°å€¼ç±»åž‹</h2><p><img src="/uploads/image/fluent-python/example-of-2d-vector-addition.png" title="ä¸€ä¸ªäºŒç»´å‘é‡åŠ æ³•çš„ä¾‹å­"></p><p>ä¸€ä¸ªäºŒç»´å‘é‡åŠ æ³•çš„ä¾‹å­ï¼ŒVector(2, 4) + Vector(2, 1) = Vector(4, 5)</p><p>å‘é‡åŠ æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 = Vector(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v2 = Vector(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v1 + v2</span><br><span class="line">Vector(<span class="number">4</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>å‘é‡çš„æ¨¡ï¼šabsæ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œå¦‚æžœè¾“å…¥æ˜¯æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°ï¼Œå®ƒè¿”å›žçš„æ˜¯è¾“å…¥å€¼çš„ç»å¯¹å€¼ï¼›å¦‚æžœè¾“å…¥æ˜¯å¤æ•°(complex number)ï¼Œé‚£ä¹ˆè¿”å›žè¿™ä¸ªå¤æ•°çš„æ¨¡ã€‚ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œæˆ‘ä»¬çš„APIåœ¨ç¢°åˆ°abså‡½æ•°çš„æ—¶å€™ï¼Œä¹Ÿåº”è¯¥è¿”å›žè¯¥å‘é‡çš„æ¨¡ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v = Vector(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>abs(v)</span><br><span class="line"><span class="number">5.0</span></span><br></pre></td></tr></table></figure><p>æ ‡é‡ä¹˜æ³•ï¼ˆå³å‘é‡ä¸Žæ•°çš„ä¹˜æ³•ï¼Œå¾—åˆ°çš„ç»“æžœå‘é‡çš„æ–¹å‘ä¸ŽåŽŸå‘é‡ä¸€è‡´ï¼Œæ¨¡å˜å¤§ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>v * <span class="number">3</span></span><br><span class="line">Vector(<span class="number">9</span>, <span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>abs(v * <span class="number">3</span>)</span><br><span class="line"><span class="number">15.0</span></span><br></pre></td></tr></table></figure><h2 id="å®žçŽ°">å®žçŽ°</h2><figure class="highlight python"><figcaption><span>vector.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> hypot</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x=<span class="number">0</span>, y=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Vector(%r, %r)'</span> % (self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__abs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> hypot(self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> bool(self.x <span class="keyword">or</span> self.y)  <span class="comment"># æ›´é«˜æ•ˆ</span></span><br><span class="line">        <span class="comment"># return bool(abs(self))</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        x = self.x + other.x</span><br><span class="line">        y = self.y + other.y</span><br><span class="line">        <span class="keyword">return</span> Vector(x, y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, scalar)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Vector(self.x * scalar, self.y * scalar)</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰çš„å¸ƒå°”å€¼">è‡ªå®šä¹‰çš„å¸ƒå°”å€¼</h2><p>å°½ç®¡Pythoné‡Œæœ‰boolç±»åž‹ï¼Œä½†å®žé™…ä¸Šä»»ä½•å¯¹è±¡éƒ½å¯ä»¥ç”¨äºŽéœ€è¦å¸ƒå°”å€¼çš„ä¸Šä¸‹æ–‡ä¸­ï¼ˆæ¯”å¦‚ifæˆ–whileè¯­å¥ï¼Œæˆ–è€…andã€orå’Œnotè¿ç®—ç¬¦ï¼‰ã€‚ä¸ºäº†åˆ¤å®šä¸€ä¸ªå€¼xä¸ºçœŸè¿˜æ˜¯ä¸ºå‡ï¼ŒPythonä¼šè°ƒç”¨bool(x)ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½è¿”å›žTrueæˆ–è€…Falseã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»çš„å®žä¾‹æ€»è¢«è®¤ä¸ºæ˜¯çœŸçš„ï¼Œé™¤éžè¿™ä¸ªç±»å¯¹<code>__bool__</code>æˆ–è€…<code>__len__</code>å‡½æ•°æœ‰è‡ªå·±çš„å®žçŽ°ã€‚bool(x)çš„èƒŒåŽæ˜¯è°ƒç”¨<code>x.__bool__()</code>çš„ç»“æžœï¼›å¦‚æžœä¸å­˜åœ¨<code>__bool__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆbool(x)ä¼šå°è¯•è°ƒç”¨<code>x.__len__()</code>ã€‚è‹¥è¿”å›ž0ï¼Œåˆ™boolä¼šè¿”å›žFalseï¼›å¦åˆ™è¿”å›žTrueã€‚</p><table><thead><tr class="header"><th>æ“ä½œ</th><th>åº•å±‚æ”¯æŒ</th></tr></thead><tbody><tr class="odd"><td>å–ç»å¯¹å€¼æˆ–å–æ¨¡</td><td><code>__abs__</code></td></tr><tr class="even"><td>å¸ƒå°”è¿ç®—</td><td><code>__bool__</code>ï¼ˆä¼˜å…ˆè°ƒç”¨ï¼‰ï¼Œ<code>__len__</code>ï¼ˆä¸å­˜åœ¨<code>__bool__</code>æ—¶è°ƒç”¨ï¼‰</td></tr><tr class="odd"><td>åŠ æ³•</td><td><code>__add__</code></td></tr><tr class="even"><td>ä¹˜æ³•</td><td><code>__mul__</code></td></tr></tbody></table><h1 id="ç‰¹æ®Šæ–¹æ³•ä¸€è§ˆ">ç‰¹æ®Šæ–¹æ³•ä¸€è§ˆ</h1><p>Pythonè¯­è¨€å‚è€ƒæ‰‹å†Œä¸­çš„<a href="https://docs.python.org/3/reference/datamodel.html" target="_blank" rel="noopener">â€œData Modelâ€</a>ä¸€ç« åˆ—å‡ºäº†83ä¸ªç‰¹æ®Šæ–¹æ³•çš„åå­—ï¼Œå…¶ä¸­47ä¸ªç”¨äºŽå®žçŽ°ç®—æœ¯è¿ç®—ã€ä½è¿ç®—å’Œæ¯”è¾ƒæ“ä½œã€‚</p><h2 id="è·Ÿè¿ç®—æ— å…³çš„ç‰¹æ®Šæ–¹æ³•">è·Ÿè¿ç®—æ— å…³çš„ç‰¹æ®Šæ–¹æ³•</h2><table><thead><tr class="header"><th>ç±»åˆ«</th><th>æ–¹æ³•å</th></tr></thead><tbody><tr class="odd"><td>å­—ç¬¦ä¸² / å­—èŠ‚åºåˆ—è¡¨ç¤ºå½¢å¼</td><td><code>__repr__</code>ã€<code>__str__</code>ã€<code>__format__</code>ã€<code>__bytes__</code></td></tr><tr class="even"><td>æ•°å€¼è½¬æ¢</td><td><code>__abs__</code>ã€<code>__bool__</code>ã€<code>__complex__</code>ã€<code>__int__</code>ã€<code>__float__</code>ã€<code>__hash__</code>ã€<code>__index__</code></td></tr><tr class="odd"><td>é›†åˆæ¨¡æ‹Ÿ</td><td><code>__len__</code>ã€<code>__getitem__</code>ã€<code>__setitem__</code>ã€<code>__delitem__</code>ã€<code>__contains__</code></td></tr><tr class="even"><td>è¿­ä»£æžšä¸¾</td><td><code>__iter__</code>ã€<code>__reversed__</code>ã€<code>__next__</code></td></tr><tr class="odd"><td>å¯è°ƒç”¨æ¨¡æ‹Ÿ</td><td><code>__call__</code></td></tr><tr class="even"><td>ä¸Šä¸‹æ–‡ç®¡ç†</td><td><code>__enter__</code>ã€<code>__exit__</code></td></tr><tr class="odd"><td>å®žä¾‹åˆ›å»ºå’Œé”€æ¯</td><td><code>__new__</code>ã€<code>__init__</code>ã€<code>__del__</code></td></tr><tr class="even"><td>å±žæ€§ç®¡ç†</td><td><code>__getattr__</code>ã€<code>__getattribute__</code>ã€<code>__setattr__</code>ã€<code>__delattr__</code>ã€<code>__dir__</code></td></tr><tr class="odd"><td>å±žæ€§æè¿°ç¬¦</td><td><code>__get__</code>ã€<code>__set__</code>ã€<code>__delete__</code></td></tr><tr class="even"><td>è·Ÿç±»ç›¸å…³çš„æœåŠ¡</td><td><code>__prepare__</code>ã€<code>__instancecheck__</code>ã€<code>__subclasscheck__</code></td></tr></tbody></table><h2 id="è·Ÿè¿ç®—ç¬¦ç›¸å…³çš„ç‰¹æ®Šæ–¹æ³•">è·Ÿè¿ç®—ç¬¦ç›¸å…³çš„ç‰¹æ®Šæ–¹æ³•</h2><table><colgroup><col style="width: 23%"><col style="width: 76%"></colgroup><thead><tr class="header"><th>ç±»åˆ«</th><th>æ–¹æ³•åå’Œå¯¹åº”çš„è¿ç®—ç¬¦</th></tr></thead><tbody><tr class="odd"><td>ä¸€å…ƒè¿ç®—ç¬¦</td><td><code>__neg__ -</code>ã€<code>__pos__ +</code>ã€<code>__abs__ abs()</code></td></tr><tr class="even"><td>æ¯”è¾ƒè¿ç®—ç¬¦</td><td><code>__lt__ &lt;</code>ã€<code>__le__ &lt;=</code>ã€<code>__eq__ ==</code>ã€<code>__ne__ !=</code>ã€<code>__gt__ &gt;</code>ã€<code>__ge__ &gt;=</code></td></tr><tr class="odd"><td>ç®—æœ¯è¿ç®—ç¬¦</td><td><code>__add__ +</code>ã€<code>__sub__ -</code>ã€<code>__mul__ *</code>ã€<code>__truediv__ /</code>ã€<code>__floordiv__ //</code>ã€<code>__mod__ %</code>ã€<code>__divmod__ divmod()</code>ã€<code>__pow__ **</code>æˆ–<code>pow()</code>ã€<code>__round__ round()</code></td></tr><tr class="even"><td>åå‘ç®—æœ¯è¿ç®—ç¬¦</td><td><code>__radd__</code>ã€<code>__rsub__</code>ã€<code>__rmul__</code>ã€<code>__rtruediv__</code>ã€ <code>__rfloordiv__</code>ã€<code>__rmod__</code>ã€<code>__rdivmod__</code>ã€<code>__rpow__</code></td></tr><tr class="odd"><td>å¢žé‡èµ‹å€¼ç®—æœ¯è¿ç®—ç¬¦</td><td><code>__iadd__</code>ã€<code>__isub__</code>ã€<code>__imul__</code>ã€<code>__itruediv__</code>ã€ <code>__ifloordiv__</code>ã€<code>__imod__</code>ã€<code>__ipow__</code></td></tr><tr class="even"><td>ä½è¿ç®—ç¬¦</td><td><code>__invert__ ~</code>ã€<code>__lshift__ &lt;&lt;</code>ã€<code>__rshift__ &gt;&gt;</code>ã€<code>__and__ &amp;</code>ã€<code>__or__ |</code>ã€<code>__xor__ ^</code></td></tr><tr class="odd"><td>åå‘ä½è¿ç®—ç¬¦</td><td><code>__rlshift__</code>ã€<code>__rrshift__</code>ã€<code>__rand__</code>ã€<code>__rxor__</code>ã€<code>__ror__</code></td></tr><tr class="even"><td>å¢žé‡èµ‹å€¼ä½è¿ç®—ç¬¦</td><td><code>__ilshift__</code>ã€<code>__irshift__</code>ã€<code>__iand__</code>ã€<code>__ixor__</code>ã€<code>__ior__</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Fluent Python </tag>
            
            <tag> special methods </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jupyter Notebook ModuleNotFoundError</title>
      <link href="/programming/jupyter-notebook-ModuleNotFoundError/"/>
      <url>/programming/jupyter-notebook-ModuleNotFoundError/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/qq_34650787/article/details/83304080" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹åŽŸæ–‡</a></p><p>å¯èƒ½åŽŸå› ï¼šå®‰è£…äº†å¤šä¸ªPythonç‰ˆæœ¬ï¼Œç»ˆç«¯å’ŒJupyter Notebookä½¿ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªPythonã€‚</p><p>åœ¨Terminalå’ŒJupyter Notebookä¸­åˆ†åˆ«æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.executable</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒå„è‡ªçš„è¾“å‡ºè·¯å¾„ã€‚è‹¥ä¸ç›¸åŒï¼Œä¾‹å¦‚</p><p>Terminalï¼š<code>/Users/cws/opt/anaconda3/bin/python</code></p><p>Notebookï¼š<code>/usr/local/bin/python3.6</code></p><p>åˆ™å¯æŒ‰ç…§ä¸‹è¿°æ“ä½œè§£å†³æ­¤é—®é¢˜ã€‚æ‰“å¼€Terminalï¼Œ</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(base) MacBook-Pro:~ cws$ jupyter kernelspec list</span><br><span class="line">Available kernels:  <span class="comment"># åˆ—å‡ºæ‰€æœ‰å†…æ ¸</span></span><br><span class="line">  python36    /Users/cws/Library/Jupyter/kernels/python36</span><br><span class="line">  python3     /Library/Frameworks/Python.framework/Versions/<span class="number">3.6</span>/share/jupyter/kernels/python3</span><br></pre></td></tr></table></figure><p>æ ¹æ®è‡ªå·±æ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ï¼Œä¾‹å¦‚python3ï¼Œè¿›å…¥å¯¹åº”ç›®å½•/Library/.../python3ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶kernel.json</p><figure class="highlight diff"><figcaption><span>kernel.json</span></figcaption><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> "argv": [</span><br><span class="line"><span class="deletion">- "python",</span></span><br><span class="line"><span class="addition">+ "/Users/cws/opt/anaconda3/bin/python",</span></span><br><span class="line">  "-m",</span><br><span class="line">  "ipykernel_launcher",</span><br><span class="line">  "-f",</span><br><span class="line">  "&#123;connection_file&#125;"</span><br><span class="line"> ],</span><br><span class="line"> "display_name": "Python 3",</span><br><span class="line"> "language": "python"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åŽä¿å­˜ï¼Œé‡å¯Notebookã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> jupyter notebook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¢é»‘æ ‘</title>
      <link href="/notes/introduction-to-algorithms/red-black-trees/"/>
      <url>/notes/introduction-to-algorithms/red-black-trees/</url>
      
        <content type="html"><![CDATA[<h1 id="çº¢é»‘æ ‘">çº¢é»‘æ ‘</h1><p>çº¢é»‘æ ‘ï¼ˆred-black treeï¼‰æ˜¯ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼Œæ˜¯è®¸å¤šå¹³è¡¡æœç´¢æ ‘çš„ä¸€ç§ã€‚å®ƒåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¢žåŠ äº†ä¸€ä¸ªå­˜å‚¨ä½æ¥è¡¨ç¤ºç»“ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯REDæˆ–BLACKã€‚é€šè¿‡å¯¹ä»»ä½•ä¸€æ¡ä»Žæ ¹åˆ°å¶å­çš„ç®€å•è·¯å¾„ä¸Šå„ä¸ªç»“ç‚¹çš„é¢œè‰²è¿›è¡Œçº¦æŸï¼Œ<strong>çº¢é»‘æ ‘ç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿å‡º2å€</strong>ï¼Œå› è€Œæ˜¯è¿‘ä¼¼äºŽå¹³è¡¡çš„ã€‚</p><h1 id="æ€§è´¨">æ€§è´¨</h1><p>æ ‘ä¸­æ¯ä¸ªç»“ç‚¹åŒ…å«5ä¸ªå±žæ€§ï¼šcolorã€keyã€leftã€rightå’Œpã€‚</p><p>ä¸€æ£µçº¢é»‘æ ‘æ˜¯æ»¡è¶³ä¸‹é¢<strong>çº¢é»‘æ€§è´¨</strong>çš„äºŒå‰æœç´¢æ ‘ï¼š</p><ol type="1"><li>æ¯ä¸ªç»“ç‚¹æˆ–æ˜¯çº¢è‰²çš„ï¼Œæˆ–æ˜¯é»‘è‰²çš„ã€‚</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ã€‚</li><li>æ¯ä¸ªå¶å­ç»“ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²çš„ã€‚</li><li>å¦‚æžœä¸€ä¸ªç»“ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚</li><li>å¯¹æ¯ä¸ªç»“ç‚¹ï¼Œä»Žè¯¥èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰åŽä»£å¶èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹ã€‚</li></ol><a id="more"></a><p>ä¸ºäº†ä¾¿äºŽå¤„ç†çº¢é»‘æ ‘ä¸­çš„è¾¹ç•Œæ¡ä»¶ï¼Œä½¿ç”¨ä¸€ä¸ªå“¨å…µæ¥ä»£æ›¿NILã€‚å“¨å…µçš„color=BLACKï¼Œå…¶ä»–å±žæ€§çš„pã€leftã€rightã€keyçš„å–å€¼ä¸é‡è¦ã€‚å°½ç®¡å¯ä»¥ä¸ºæ ‘ä¸­æ¯ä¸€ä¸ªNILï¼ˆå¶å­ç»“ç‚¹ï¼‰æ–°å¢žä¸€ä¸ªä¸åŒçš„å“¨å…µç»“ç‚¹ï¼Œä½†ä¼šæµªè´¹ç©ºé—´ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä½¿ç”¨ä¸€ä¸ªå“¨å…µT.nilâ€‹æ¥ä»£è¡¨æ‰€æœ‰çš„NILã€‚å¦‚å›¾(b)å¯ä»¥ç”¨æ›´å°‘çš„ç©ºé—´ç­‰ä»·åœ°è¡¨ç¤ºå›¾(a)ã€‚å…¶ä¸­é»‘è‰²ç»“ç‚¹ç”¨é»‘è‰²ã€çº¢è‰²èŠ‚ç‚¹ç”¨ç°è‰²è¡¨ç¤ºã€‚</p><p><strong>é»‘é«˜</strong>ï¼ˆblack-heightï¼‰ï¼šä»ŽæŸä¸ªç»“ç‚¹xå‡ºå‘ï¼ˆä¸å«è¯¥ç»“ç‚¹ï¼‰åˆ°è¾¾ä¸€ä¸ªå¶èŠ‚ç‚¹çš„ä»»æ„ä¸€æ¡ç®€å•è·¯å¾„ä¸Šçš„é»‘è‰²ç»“ç‚¹ä¸ªæ•°ï¼ˆæ ¹æ®æ€§è´¨5å¯çŸ¥ç»“ç‚¹çš„é»‘é«˜æ˜¯å”¯ä¸€çš„ï¼‰ç§°ä¸ºè¯¥ç»“ç‚¹çš„é»‘é«˜ï¼Œè®°ä¸ºbh(x)â€‹ã€‚å®šä¹‰çº¢é»‘æ ‘çš„é»‘é«˜ä¸ºå…¶æ ¹èŠ‚ç‚¹çš„é»‘é«˜ã€‚å¦‚å›¾(a)æ‰€ç¤ºçš„çº¢é»‘æ ‘ä¸­ï¼Œçº¢é»‘æ ‘çš„é»‘é«˜ä¸º3ã€‚å›¾(c)çœç•¥äº†å“¨å…µï¼Œå¤šæ•°æ—¶å€™é‡‡ç”¨è¿™ç§æ›´ç®€æ´çš„ç”»æ³•ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/red-black-tree.png"></p><blockquote><p>å¼•ç†13.1</p><p>ä¸€æ£µæœ‰nä¸ªå†…éƒ¨ç»“ç‚¹çš„çº¢é»‘æ ‘çš„é«˜åº¦è‡³å¤šä¸º<span class="math inline">\(2\lg(n+1)\)</span>ã€‚</p></blockquote><p><strong>è¯æ˜Ž</strong>ï¼š å…ˆè¯æ˜Žä»¥ä»»ä¸€ç»“ç‚¹xä¸ºæ ¹çš„å­æ ‘ä¸­è‡³å°‘åŒ…å«<span class="math inline">\(2^{bh(x)}-1\)</span>ä¸ªå†…éƒ¨ç»“ç‚¹ã€‚ä½¿ç”¨å½’çº³æ³•è¯æ˜Žã€‚</p><ol type="1"><li><p>å¦‚æžœxçš„é«˜åº¦ä¸º0ï¼Œåˆ™xä¸ºå¶èŠ‚ç‚¹ï¼ˆT.nil)ï¼Œä¸”ä»¥xä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘è‡³å°‘åŒ…å«<span class="math inline">\(2^{bh(x)}-1=2^0-1=0\)</span>ä¸ªå†…éƒ¨ç»“ç‚¹ã€‚</p></li><li><p>å¦‚æžœxçš„é«˜åº¦ä¸ºh(h&gt;0)ï¼Œå‡è®¾ä»¥xä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘è‡³å°‘åŒ…å«<span class="math inline">\(2^{bh(x)}-1\)</span>ä¸ªå†…éƒ¨ç»“ç‚¹æˆç«‹ã€‚</p></li><li><p>è€ƒè™‘é«˜åº¦h+1ä¸”æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å†…éƒ¨èŠ‚ç‚¹<span class="math inline">\(x^\prime\)</span>ã€‚å­èŠ‚ç‚¹çš„é«˜åº¦ä¸ºhï¼Œé»‘é«˜ä¸º</p><ul><li><span class="math inline">\(bh(x^\prime)\)</span>ï¼ˆå½“å­èŠ‚ç‚¹ä¸ºçº¢è‰²æ—¶ï¼‰ï¼Œ</li><li>æˆ–<span class="math inline">\(bh(x^\prime)-1\)</span>ï¼ˆå½“å­èŠ‚ç‚¹ä¸ºé»‘è‰²æ—¶ï¼‰ã€‚</li></ul><p>æ ¹æ®å½’çº³å‡è®¾ï¼Œä»¥å­èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘è‡³å°‘åŒ…å«<span class="math inline">\(2^{bh(x)-1}-1\)</span>ä¸ªç»“ç‚¹ã€‚äºŽæ˜¯ï¼Œä»¥<span class="math inline">\(x^\prime\)</span>ä¸ºæ ¹çš„å­æ ‘è‡³å°‘åŒ…å«<span class="math inline">\((2^{bh(x)-1}-1)+(2^{bh(x)-1}-1)+1=2^{bh(x)}-1\)</span>ä¸ªå†…éƒ¨ç»“ç‚¹ã€‚</p></li></ol><p>ä¹‹åŽï¼Œè¯æ˜Žå¼•ç†ï¼šè®¾hä¸ºæ ‘çš„é«˜åº¦ã€‚æ ¹æ®æ€§è´¨4ï¼Œä»Žæ ¹åˆ°å¶èŠ‚ç‚¹çš„ä»»ä½•ä¸€æ¡ç®€å•è·¯å¾„ä¸Šéƒ½è‡³å°‘æœ‰ä¸€åŠçš„ç»“ç‚¹ä¸ºé»‘è‰²ã€‚å› æ­¤ï¼Œæ ¹çš„é»‘é«˜è‡³å°‘ä¸ºh/2ï¼ŒäºŽæ˜¯æœ‰<span class="math inline">\(n\ge2^{h/2}-1\)</span>ï¼Œå°†1ç§»åˆ°å·¦è¾¹ï¼Œå†å¯¹ä¸¤è¾¹å–å¯¹æ•°ï¼Œå¾—åˆ°<span class="math inline">\(h\le2\lg(n+1)\)</span>ã€‚</p><h1 id="æ—‹è½¬">æ—‹è½¬</h1><p>æœç´¢æ ‘æ“ä½œTREE-INSERTå’ŒTREE-DELETEåœ¨å«nä¸ªå…³é”®å­—çš„çº¢é»‘æ ‘ä¸Šï¼Œè¿è¡ŒèŠ±è´¹æ—¶é—´ä¸º<span class="math inline">\(O(\lg{n})\)</span>ã€‚ç”±äºŽè¿™ä¸¤ä¸ªæ“ä½œå¯¹æ ‘åšäº†ä¿®æ”¹ï¼Œç»“æžœå¯èƒ½è¿åçº¢é»‘æ€§è´¨ã€‚ä¸ºäº†ç»´æŠ¤è¿™äº›æ€§è´¨ï¼Œå¿…é¡»è¦æ”¹å˜æ ‘ä¸­æŸäº›ç»“ç‚¹çš„é¢œè‰²ä»¥åŠæŒ‡é’ˆç»“æž„ã€‚</p><p>æŒ‡é’ˆç»“æž„çš„ä¿®æ”¹æ˜¯é€šè¿‡<strong>æ—‹è½¬</strong>ï¼ˆrotationï¼‰æ¥å®Œæˆçš„ï¼Œè¿™æ˜¯ä¸€ç§èƒ½ä¿æŒäºŒå‰æœç´¢æ ‘æ€§è´¨çš„å±€éƒ¨æ“ä½œã€‚<strong>åœ¨æ—‹è½¬æ“ä½œä¸­åªæœ‰æŒ‡é’ˆæ”¹å˜</strong>ï¼Œå…¶ä»–æ‰€æœ‰å±žæ€§éƒ½ä¿æŒä¸å˜ã€‚ä¸‹å›¾ç»™å‡ºäº†ä¸¤ç§æ—‹è½¬ï¼šå·¦æ—‹å’Œå³æ—‹ã€‚</p><ul><li>å·¦æ—‹ï¼šç»“ç‚¹xå–ä»£<span class="math inline">\(\beta\)</span>æˆä¸ºyçš„å·¦å­©å­ç»“ç‚¹ï¼Œ<span class="math inline">\(\beta\)</span>å–ä»£yæˆä¸ºxçš„å³å­©å­ç»“ç‚¹ã€‚</li><li>å³æ—‹ï¼šç»“ç‚¹yå–ä»£<span class="math inline">\(\beta\)</span>æˆä¸ºxçš„å·¦å­©å­ç»“ç‚¹ï¼Œ<span class="math inline">\(\beta\)</span>å–ä»£xæˆä¸ºyçš„å·¦å­©å­ç»“ç‚¹ã€‚</li></ul><p><img src="/uploads/image/introduction-to-algorithms/red-black-tree-rotation.png"></p><p>å®¹æ˜“è§‚å¯Ÿåˆ°ï¼Œæ—‹è½¬å‰ä¸Žæ—‹è½¬åŽå„å…ƒç´ çš„å¤§å°é¡ºåºæ²¡æœ‰æ”¹å˜ï¼Œéƒ½æ˜¯<span class="math inline">\(\alpha\le{x}\le\beta\le{y}\le\gamma\)</span>ã€‚</p><p>åœ¨LEFT-ROTATEçš„ä¼ªä»£ç ä¸­ï¼Œå‡è®¾<span class="math inline">\(x.right\ne{T.nil}\)</span>ä¸”æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºT.nilã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LEFT-ROTATE(T, x):</span><br><span class="line">y = x.right              <span class="comment"># yçš„ä½ç½®ï¼ˆç»“åˆä¸Šå›¾ç†è§£ï¼‰</span></span><br><span class="line">x.right = y.left         <span class="comment"># betaå–ä»£yæˆä¸ºxçš„å³å­©å­</span></span><br><span class="line"><span class="keyword">if</span> y.left != T.nil:      <span class="comment"># æ­¤æ—¶y.leftè¿˜æ˜¯betaç»“ç‚¹</span></span><br><span class="line">    y.left.p = x         <span class="comment"># ä¿®æ”¹betaçš„çˆ¶èŠ‚ç‚¹ä¸ºx</span></span><br><span class="line">y.p = x.p                <span class="comment"># ä¿®æ”¹yçš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> x.p == T.nil:         <span class="comment"># è‹¥xåŽŸæœ¬æ˜¯æ ¹èŠ‚ç‚¹ï¼Œyå°†å˜ä¸ºæ ‘çš„æ ¹</span></span><br><span class="line">    T.root = y</span><br><span class="line"><span class="keyword">elif</span> x == x.p.left:      <span class="comment"># è‹¥åŽŸæœ¬xæ˜¯å·¦å­©å­ï¼Œyå–ä»£xåŽä¾æ—§æ˜¯å·¦å­©å­</span></span><br><span class="line">    x.p.left = y</span><br><span class="line"><span class="keyword">else</span>:                    <span class="comment"># è‹¥åŽŸæœ¬xæ˜¯å³å­©å­ï¼Œyå–ä»£xåŽä¾æ—§æ˜¯å³å­©å­</span></span><br><span class="line">    x.p.right = y</span><br><span class="line">y.left = x               <span class="comment"># xå˜ä¸ºyçš„å·¦å­©å­</span></span><br><span class="line">x.p = y                  <span class="comment"># ä¿®æ”¹xçš„çˆ¶èŠ‚ç‚¹ä¸ºy</span></span><br></pre></td></tr></table></figure><p>RIGHT-ROTATEæ“ä½œçš„ä»£ç æ˜¯å¯¹ç§°çš„ã€‚å®ƒä»¬éƒ½åœ¨O(1)æ—¶é—´å†…è¿è¡Œå®Œæˆã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/red-black-tree-left-rotate.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RIGHT-ROTATE(T, x):</span><br><span class="line">y = x.p</span><br><span class="line">y.left = x.right</span><br><span class="line"><span class="keyword">if</span> x.right != T.nil:</span><br><span class="line">    x.right.p = y</span><br><span class="line">x.p = y.p</span><br><span class="line"><span class="keyword">if</span> y.p == T.nil:</span><br><span class="line">    T.root = x</span><br><span class="line"><span class="keyword">elif</span> y == y.p.left:</span><br><span class="line">    y.p.left = x</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    y.p.right = x</span><br><span class="line">x.right = y</span><br><span class="line">y.p = x</span><br></pre></td></tr></table></figure><h1 id="æ’å…¥">æ’å…¥</h1><p>åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„æ’å…¥è¿‡ç¨‹ï¼Œç•¥ä½œä¿®æ”¹æ¥å°†ç»“ç‚¹zæ’å…¥æ ‘Tå†…ï¼Œå°±å¥½åƒTæ˜¯ä¸€æ£µæ™®é€šçš„äºŒå‰æœç´¢æ ‘ä¸€æ ·ï¼Œç„¶åŽå°†zç€ä¸ºçº¢è‰²ã€‚ä¸ºäº†ä¿è¯çº¢é»‘æ€§è´¨èƒ½ç»§ç»­ä¿æŒï¼Œè°ƒç”¨ä¸€ä¸ªè¾…åŠ©ç¨‹åºRB-INSERT-FIXUPæ¥å¯¹ç»“ç‚¹é‡æ–°ç€è‰²å¹¶æ—‹è½¬ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RB-INSERT(T, z):</span><br><span class="line">y = T.nil             <span class="comment"># ä¸Žæ™®é€šçš„äºŒå‰æœç´¢æ ‘ä¸åŒï¼Œæ­¤å¤„yæŒ‡å‘å“¨å…µ</span></span><br><span class="line">x = T.root            <span class="comment"># å¯»æ‰¾zçš„æ’å…¥ä½ç½®</span></span><br><span class="line"><span class="keyword">while</span> x != T.nil:</span><br><span class="line">    y = x</span><br><span class="line">    <span class="keyword">if</span> z.key &lt; x.key:</span><br><span class="line">        x = x.left</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x = x.right</span><br><span class="line">z.p = y               <span class="comment"># æ’å…¥ç»“ç‚¹z</span></span><br><span class="line"><span class="keyword">if</span> y == T.nil:</span><br><span class="line">    T.root = z</span><br><span class="line"><span class="keyword">elif</span> z.key &lt; y.key:</span><br><span class="line">    y.left = z</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    y.right = z</span><br><span class="line">z.left = T.nil        <span class="comment"># è®¾ç½®æ–°èŠ‚ç‚¹çš„å·¦å³å­©å­ä¸ºå“¨å…µç»“ç‚¹ï¼Œä»¥ä¿æŒåˆç†çš„æ ‘ç»“æž„</span></span><br><span class="line">z.right = T.nil</span><br><span class="line">z.color = RED         <span class="comment"># æ–°æ’å…¥èŠ‚ç‚¹ç€çº¢è‰²</span></span><br><span class="line">RB-INSERT-FIXUP(T, z) <span class="comment"># è¾…åŠ©ç¨‹åºï¼Œå¯¹ç»“ç‚¹é‡æ–°ç€è‰²å¹¶æ—‹è½¬ä»¥ç»´æŠ¤çº¢é»‘æ€§è´¨</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RB-INSERT-FIXUP(T, z):</span><br><span class="line"><span class="keyword">while</span> z.p.color == RED:        <span class="comment"># zçš„çˆ¶èŠ‚ç‚¹ä¹Ÿä¸ºçº¢è‰²ï¼Œè¿åæ€§è´¨4</span></span><br><span class="line">    <span class="keyword">if</span> z.p == z.p.p.left:      <span class="comment"># å¦‚æžœzçš„çˆ¶èŠ‚ç‚¹æ˜¯å·¦å­©å­ç»“ç‚¹</span></span><br><span class="line">        y = z.p.p.right        <span class="comment"># zçš„å”ç»“ç‚¹(çˆ¶èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå…„å¼Ÿç»“ç‚¹)</span></span><br><span class="line">        <span class="keyword">if</span> y.color == RED:        <span class="comment"># æƒ…å†µ1ï¼šzçš„å”ç»“ç‚¹yä¹Ÿæ˜¯çº¢è‰²çš„</span></span><br><span class="line">            z.p.color = BLACK          <span class="comment"># zçš„çˆ¶èŠ‚ç‚¹æ¶‚é»‘</span></span><br><span class="line">            y.color = BLACK            <span class="comment"># zçš„å”ç»“ç‚¹ä¹Ÿæ¶‚é»‘</span></span><br><span class="line">            z.p.p.color = RED          <span class="comment"># zçš„ç¥–çˆ¶ç»“ç‚¹æ¶‚çº¢(å°†ç¥–çˆ¶ç»“ç‚¹æ¶‚çº¢å¯èƒ½è¿åæ€§è´¨4)</span></span><br><span class="line">            z = z.p.p                  <span class="comment"># zæŒ‡é’ˆä¸Šå‡è‡³ç¥–çˆ¶ç»“ç‚¹ï¼Œç­‰å€™ä¸‹ä¸€æ¬¡å¾ªçŽ¯ä¿®å¤æ€§è´¨</span></span><br><span class="line">        <span class="keyword">elif</span> z == z.p.right:      <span class="comment"># æƒ…å†µ2ï¼šå”ç»“ç‚¹éžçº¢ä¸”zæ˜¯å³å­©å­ç»“ç‚¹</span></span><br><span class="line">            z = z.p                    <span class="comment"># æ³¨æ„æ­¤æ—¶æ— è®ºæƒ…å†µ1æ˜¯å¦å‘ç”Ÿï¼Œzçš„çˆ¶èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²</span></span><br><span class="line">            LEFT-ROTATE(T, z)          <span class="comment"># å·¦æ—‹ï¼Œè½¬ä¸ºæƒ…å†µ3</span></span><br><span class="line">                                  <span class="comment"># æƒ…å†µ3ï¼šå”ç»“ç‚¹éžçº¢ä¸”zæ˜¯å·¦å­©å­ç»“ç‚¹(æ³¨æ„å·¦æ—‹åŽzçš„ä½ç½®å˜åŒ–)</span></span><br><span class="line">        z.p.color = BLACK         <span class="comment"># çˆ¶èŠ‚ç‚¹æ¶‚é»‘</span></span><br><span class="line">        z.p.p.color = RED         <span class="comment"># ç¥–çˆ¶ç»“ç‚¹æ¶‚çº¢</span></span><br><span class="line">        RIGHT-ROTATE(T, z.p.p)    <span class="comment"># å³æ—‹</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        same <span class="keyword">as</span> then clause <span class="keyword">with</span> <span class="string">"right"</span> <span class="keyword">and</span> <span class="string">"left"</span> exchanged</span><br><span class="line">T.root.color = BLACK              <span class="comment"># æ ¹èŠ‚ç‚¹æ¶‚é»‘ï¼Œä¿®å¤æ€§è´¨2</span></span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨RB-INSERT-FIXUPæ“ä½œæ—¶ï¼Œå“ªäº›çº¢é»‘æ€§è´¨å¯èƒ½ä¼šè¢«ç ´åå‘¢ï¼Ÿæ€§è´¨1ï¼ˆéžçº¢å³é»‘ï¼‰å’Œæ€§è´¨3ï¼ˆå¶å­å…¨é»‘ï¼‰ç»§ç»­æˆç«‹ï¼Œå› ä¸ºæ–°æ’å…¥çš„çº¢èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯å“¨å…µT.nilã€‚æ€§è´¨5ï¼ˆé»‘é«˜ç›¸ç­‰ï¼‰ä¹Ÿä¼šæˆç«‹ï¼Œå› ä¸ºç»“ç‚¹zä»£æ›¿äº†é»‘è‰²çš„å“¨å…µç»“ç‚¹ï¼Œå¹¶ä¸”zæœ¬èº«æ˜¯çº¢ç»“ç‚¹ä¸”æœ‰å“¨å…µç»“ç‚¹ã€‚ä»…å¯èƒ½è¢«ç ´åçš„å°±æ˜¯æ€§è´¨2ï¼ˆæ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼‰å’Œæ€§è´¨4ï¼ˆçº¢èŠ‚ç‚¹ä¸èƒ½æœ‰çº¢å­©å­ï¼‰ã€‚å¦‚æžœzæ˜¯æ ¹èŠ‚ç‚¹ï¼Œåˆ™ç ´åäº†æ€§è´¨2ï¼›å¦‚æžœzçš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢èŠ‚ç‚¹ï¼Œåˆ™ç ´åäº†æ€§è´¨4ã€‚</p><p>å½“è¿åæ€§è´¨4æ—¶ï¼Œzä¸Žçˆ¶èŠ‚ç‚¹z.péƒ½æ—¶çº¢è‰²ï¼Œæ­¤æ—¶å¯èƒ½å‘ç”Ÿçš„æƒ…å†µå¦‚ä¸‹ï¼š</p><ul><li>æƒ…å†µ1ï¼šzçš„å”ç»“ç‚¹yæ˜¯çº¢è‰²çš„ã€‚é€šè¿‡é‡æ–°ç€è‰²ä¿®å¤æ€§è´¨ã€‚</li><li>zçš„å”ç»“ç‚¹yæ˜¯é»‘è‰²ï¼š<ul><li>æƒ…å†µ2ï¼šzæ˜¯ä¸€ä¸ªå³å­©å­ã€‚é€šè¿‡å·¦æ—‹è½¬åŒ–ä¸ºæƒ…å†µ3ã€‚ï¼ˆè¡¨æ˜Žè¿™å‡ ç§æƒ…å†µä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼‰</li><li>æƒ…å†µ3ï¼šzæ˜¯ä¸€ä¸ªå·¦å­©å­ã€‚é€šè¿‡é‡æ–°ç€è‰²å’Œå³æ—‹ä¿®å¤æ€§è´¨ã€‚</li></ul></li></ul><p>ä¸‹å›¾ç»™å‡ºä¸€ä¸ªèŒƒä¾‹ï¼Œæ˜¾ç¤ºåœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸ŠRB-INSERT-FIXUPå¦‚ä½•æ“ä½œã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/red-black-tree-insert-fixup.png"></p><p>ç”±äºŽä¸€æ£µæœ‰nä¸ªç»“ç‚¹çš„çº¢é»‘æ ‘çš„é«˜åº¦ä¸º<span class="math inline">\(O(\lg{n})\)</span>ï¼Œå› æ­¤RB-INSERTçš„æ’å…¥æ“ä½œè¦èŠ±è´¹<span class="math inline">\(O(\lg{n})\)</span>æ—¶é—´ã€‚åœ¨RB-INSERT-FIXUPä¸­ï¼Œä»…å½“æƒ…å†µ1å‘ç”Ÿï¼Œç„¶åŽæŒ‡é’ˆzæ²¿ç€æ ‘ä¸Šå‡2å±‚ï¼Œwhileå¾ªçŽ¯æ‰ä¼šé‡å¤æ‰§è¡Œã€‚æ‰€ä»¥whileå¾ªçŽ¯å¯èƒ½è¢«æ‰§è¡Œçš„æ€»æ¬¡æ•°ä¸º<span class="math inline">\(O(\lg{n})\)</span>ã€‚å› æ­¤ï¼ŒRB-INSERTæ€»å…±èŠ±è´¹<span class="math inline">\(O(\lg{n})\)</span>æ—¶é—´ã€‚æ­¤å¤–ï¼Œè¯¥ç¨‹åºæ‰€åšçš„æ—‹è½¬ä¸è¶…è¿‡2æ¬¡ï¼Œå› ä¸ºåªè¦æ‰§è¡Œäº†æƒ…å†µ2ï¼ˆå…ˆå·¦æ—‹åŽå³æ—‹ï¼Œæ—‹è½¬ä¸¤æ¬¡ï¼‰æˆ–æƒ…å†µ3ï¼ˆä¸€æ¬¡å³æ—‹ï¼‰ï¼Œwhileå¾ªçŽ¯å°±ç»“æŸäº†ã€‚</p><h1 id="åˆ é™¤">åˆ é™¤</h1><p>ä»Žä¸€æ£µçº¢é»‘æ ‘ä¸­åˆ é™¤ç»“ç‚¹çš„è¿‡ç¨‹æ˜¯åŸºäºŽäºŒå‰æœç´¢æ ‘çš„åˆ é™¤è¿‡ç¨‹è€Œæ¥çš„ã€‚é¦–å…ˆï¼Œéœ€è¦ç‰¹åˆ«è®¾è®¡ä¸€ä¸ªå­è¿‡ç¨‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RB-TRANSPLANT(T, u, v): <span class="comment"># ç”¨æ ¹èŠ‚ç‚¹ä¸ºvçš„å­æ ‘æ›¿æ¢æ ¹èŠ‚ç‚¹ä¸ºuçš„å­æ ‘</span></span><br><span class="line"><span class="keyword">if</span> u.p == T.nil:        <span class="comment"># è‹¥uä¸ºæ ¹ç»“ç‚¹ï¼Œåªéœ€æ”¹å˜æ ‘çš„æ ¹æŒ‡é’ˆå³å¯</span></span><br><span class="line">    T.root = v</span><br><span class="line"><span class="keyword">elif</span> u == u.p.left:     <span class="comment"># è‹¥uæ˜¯å·¦å­©å­</span></span><br><span class="line">    u.p.left = v        <span class="comment"># ç§»æ¤v</span></span><br><span class="line"><span class="keyword">else</span>:                   <span class="comment"># è‹¥uæ˜¯å³å­©å­</span></span><br><span class="line">    u.p.right = v</span><br><span class="line">v.p = u.p               <span class="comment"># æ— æ¡ä»¶æ‰§è¡Œï¼Œå› ä¸ºçº¢é»‘æ ‘æ‰€æœ‰ç»“ç‚¹(åŒ…æ‹¬å“¨å…µç»“ç‚¹)éƒ½æœ‰çˆ¶èŠ‚ç‚¹å±žæ€§</span></span><br></pre></td></tr></table></figure><p>è¿‡ç¨‹RB-DELETEä¸ŽTREE-DELETEç±»ä¼¼ï¼Œä¸¤ä¸ªè¿‡ç¨‹å…·æœ‰ç›¸åŒçš„åŸºæœ¬ç»“æž„ã€‚åœ¨RB-DELETEä¸­èƒ½å¤Ÿæ‰¾åˆ°TREE-DELETEçš„æ¯ä¸€è¡Œè¯­å¥ï¼ˆå…¶ä¸­NILè¢«æ›¿æ¢æˆäº†T.nilï¼ŒTRANSPLANTæ¢æˆäº†RB-TRANSPLANTï¼‰ï¼Œå…¶æ‰§è¡Œçš„æ¡ä»¶ç›¸åŒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RB-DELETE(T, z):</span><br><span class="line">y = z                             <span class="comment"># yä¸ºä»Žæ ‘ä¸­åˆ é™¤çš„ç»“ç‚¹æˆ–è€…ç§»è‡³æ ‘å†…çš„ç»“ç‚¹</span></span><br><span class="line">y-original-color = y.color        <span class="comment"># è®°å½•yçš„åŽŸå§‹é¢œè‰²</span></span><br><span class="line"><span class="keyword">if</span> z.left == T.nil:               <span class="comment"># æƒ…å†µ(a)ï¼šå·¦å­©å­ä¸ºç©º</span></span><br><span class="line">    x = z.right                     <span class="comment"># ç§»æ¤åŽçš„ç»“ç‚¹å¯èƒ½ä¼šç ´åçº¢é»‘æ€§è´¨ï¼Œç”¨xè®°å½•å…¶è¸ªè¿¹</span></span><br><span class="line">    RB-TRANSPLANT(T, z, z.right)    <span class="comment"># ç”¨zçš„å³å­©å­(å¯èƒ½ä¸ºT.nil)æ›¿æ¢zï¼Œè¾¾åˆ°åˆ é™¤zçš„ç›®çš„</span></span><br><span class="line"><span class="keyword">elif</span> z.right == T.nil:            <span class="comment"># æƒ…å†µ(b)ï¼šå³å­©å­ä¸ºç©º</span></span><br><span class="line">    x = z.left                      <span class="comment"># è®°å½•xçš„è¸ªè¿¹</span></span><br><span class="line">    RB-TRANSPLANT(T, z, z.left)     <span class="comment"># ç”¨zçš„å·¦å­©å­æ›¿æ¢z</span></span><br><span class="line"><span class="keyword">else</span>:                             <span class="comment"># æƒ…å†µ(c)å’Œ(d)ï¼šæœ‰ä¸¤ä¸ªå­©å­ï¼Œç”¨zçš„åŽç»§ç»“ç‚¹yæ›¿æ¢z</span></span><br><span class="line">    y = TREE-MINIMUM(z.right)       <span class="comment"># æŸ¥æ‰¾åŽç»§ç»“ç‚¹y</span></span><br><span class="line">    y-original-color = y.color      <span class="comment"># è®°å½•yçš„åˆå§‹é¢œè‰²</span></span><br><span class="line">    x = y.right                     <span class="comment"># è®°å½•xçš„è¸ªè¿¹</span></span><br><span class="line">    <span class="keyword">if</span> y.p != z                   <span class="comment"># æƒ…å†µ(d)ï¼šåŽç»§ç»“ç‚¹yä¸æ˜¯zçš„å­èŠ‚ç‚¹</span></span><br><span class="line">        RB-TRANSPLANT(T, y, y.right)</span><br><span class="line">        y.right = z.right</span><br><span class="line">        y.right.p = y</span><br><span class="line">    <span class="keyword">else</span>:                         <span class="comment"># æƒ…å†µ(c)ï¼šyæ˜¯zçš„å­èŠ‚ç‚¹</span></span><br><span class="line">        x.p = y                     <span class="comment"># æ²¡æžæ‡‚ä½ å­˜åœ¨çš„æ„ä¹‰</span></span><br><span class="line">    RB-TRANSPLANT(T, z, y)</span><br><span class="line">    y.left = z.left</span><br><span class="line">    y.left.p = y</span><br><span class="line">    y.color = z.color             <span class="comment"># åˆ é™¤zåŽï¼Œå°†æ›¿æ¢zçš„ç»“ç‚¹yæ¶‚ä¸Žzç›¸åŒçš„é¢œè‰²</span></span><br><span class="line"><span class="keyword">if</span> y-original-color == BLACK:  <span class="comment"># å¦‚æžœåŽŸå§‹ä¸ºé»‘è‰²ï¼Œåˆ é™¤æˆ–ç§»åŠ¨yä¼šç ´åçº¢é»‘æ€§è´¨ï¼›åŽŸå§‹ä¸ºçº¢è‰²ï¼Œåˆ™ä¸ä¼š</span></span><br><span class="line">    RB-DELETE-FIXUP(T, x)      <span class="comment"># è°ƒç”¨å­è¿‡ç¨‹ä¿®å¤çº¢é»‘æ€§è´¨</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤è¿‡ç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li><p>ä¸ŽäºŒå‰æœç´¢æ ‘çš„åˆ é™¤æ“ä½œç›¸åŒçš„åˆ é™¤æ“ä½œã€‚ä¸‹å›¾æè¿°äº†åœ¨äºŒå‰æœç´¢æ ‘ä¸Šåˆ é™¤ç»“ç‚¹æ—¶çš„4ç§æƒ…å†µï¼Œåœ¨çº¢é»‘æ ‘ä¸Šåˆ é™¤ç»“ç‚¹æ—¶åŒæ ·è€ƒè™‘è¿™4ç§æƒ…å†µã€‚</p></li><li><p>ä¿®å¤çº¢é»‘æ€§è´¨çš„RB-DELETE-FIXUPæ“ä½œã€‚ä¸ºæ­¤ï¼Œåœ¨åˆ é™¤ç»“ç‚¹æ—¶ç”¨å˜é‡y-original-colorå’Œxè®°å½•äº†å¿…è¦çš„ä¿¡æ¯ã€‚</p></li></ul><p><img src="/uploads/image/introduction-to-algorithms/binary-search-tree-delete.png"></p><p>åœ¨RB-DELETEçš„æœ€åŽï¼Œå¦‚æžœç»“ç‚¹yæ˜¯é»‘è‰²çš„ï¼Œå°±æœ‰å¯èƒ½å·²ç»å¼•å…¥äº†ä¸€ä¸ªæˆ–å¤šä¸ªçº¢é»‘æ€§è´¨è¢«ç ´åçš„æƒ…å†µï¼Œæ‰€ä»¥è°ƒç”¨RB-DELETE-FIXUPæ¥æ¢å¤çº¢é»‘æ€§è´¨ã€‚å¦‚æžœç»“ç‚¹yæ˜¯çº¢è‰²ï¼Œå½“yè¢«åˆ é™¤æˆ–ç§»åŠ¨æ—¶ï¼Œçº¢é»‘æ€§è´¨ä»ç„¶ä¿æŒï¼ŒåŽŸå› å¦‚ä¸‹ï¼š</p><ol type="1"><li>æ ‘ä¸­çš„é»‘é«˜æ²¡æœ‰å˜åŒ–ã€‚</li><li>ä¸å­˜åœ¨ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²ç»“ç‚¹ï¼š<ul><li>æƒ…å†µ(a)æˆ–æƒ…å†µ(b)å‘ç”Ÿæ—¶ï¼ˆyä¸Žzç›¸åŒï¼‰ï¼Œyæ˜¯çº¢è‰²ï¼Œåˆ™å…¶å­èŠ‚ç‚¹ä¸€å®šæ˜¯é»‘è‰²ã€‚yè¢«åˆ é™¤åŽï¼Œå…¶å­èŠ‚ç‚¹æ›¿æ¢yçš„ä½ç½®ã€‚å› æ­¤ï¼Œä¸ä¼šå‡ºçŽ°ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²ç»“ç‚¹ã€‚</li><li>æƒ…å†µ(c)å‘ç”Ÿæ—¶ï¼ˆyæ˜¯zçš„åŽç»§ç»“ç‚¹ï¼‰ï¼Œyæ˜¯çº¢è‰²ï¼Œåˆ™yçš„å³å­©å­xä¸€å®šæ˜¯é»‘è‰²ï¼Œyæ›¿æ¢zåŽè¢«æ¶‚æˆä¸Žzç›¸åŒçš„é¢œè‰²ï¼Œyå’Œxä¸ä¼šå‡ºçŽ°ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²ç»“ç‚¹ã€‚</li><li>æƒ…å†µ(d)çš„ç¬¬ä¸€æ­¥æ›¿æ¢ä¸­ï¼Œyæ˜¯çº¢è‰²ï¼Œåˆ™xæ˜¯é»‘è‰²ï¼Œxæ›¿æ¢yä¹‹åŽä¸ä¼šå‡ºçŽ°ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²ç»“ç‚¹ã€‚ç¬¬äºŒæ­¥æ›¿æ¢ä¸­ï¼Œyæ›¿æ¢zå¹¶ä¸”è¢«æ¶‚æˆä¸Žzç›¸åŒçš„é¢œè‰²ã€‚å› æ­¤yä¸Žrä¸ä¼šæ˜¯ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²ç»“ç‚¹ï¼ˆyä¸Žrçš„é¢œè‰²å°±æ˜¯åŽŸæ¥zä¸Žrçš„é¢œè‰²ï¼‰ã€‚</li></ul></li><li>yæ˜¯çº¢è‰²ï¼Œå°±ä¸å¯èƒ½æ˜¯æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹ä»æ—§æ˜¯é»‘è‰²ã€‚</li></ol><p>å¦‚æžœç»“ç‚¹yæ˜¯é»‘è‰²ï¼Œåˆ™ä¼šäº§ç”Ÿä¸‰ä¸ªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨RB-DELETE-FIXUPè¿›è¡Œä¿®å¤ã€‚</p><ol type="1"><li>åœ¨æƒ…å†µ(a)å’Œ(b)ä¸­ï¼Œyï¼ˆä¸Žzç›¸åŒï¼‰æ˜¯é»‘è‰²ï¼Œè‹¥yçš„ä¸€ä¸ªçº¢è‰²çš„å­©å­ï¼ˆlæˆ–rï¼‰æ›¿æ¢äº†yæˆä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼Œåˆ™è¿åäº†æ€§è´¨2ï¼ˆæ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼‰ã€‚</li><li>åœ¨æƒ…å†µ(c)å’Œ(d)ä¸­ï¼Œyæ˜¯é»‘è‰²ï¼Œè‹¥y.pä¸ŽxåŒæ—¶ä¸ºçº¢è‰²ï¼Œåˆ™åˆ é™¤zåŽå‡ºçŽ°y.pä¸Žxéƒ½æ˜¯çº¢è‰²çš„æƒ…å†µï¼Œè¿åäº†æ€§è´¨4ï¼ˆçº¢è‰²ç»“ç‚¹çš„å­©å­æ˜¯é»‘è‰²çš„ï¼‰ã€‚</li><li>yä¸ºé»‘è‰²ï¼Œç§»åŠ¨yå°†å¯¼è‡´åŒ…å«yçš„ä»»ä½•ç®€å•è·¯å¾„ä¸Šçš„é»‘ç»“ç‚¹ä¸ªæ•°å°‘1ã€‚å› æ­¤ï¼Œyçš„ä»»ä½•ç¥–å…ˆéƒ½ä¸æ»¡è¶³æ€§è´¨5ï¼ˆåˆ°å¶èŠ‚ç‚¹çš„ç®€å•è·¯å¾„å«æœ‰ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹ï¼‰ã€‚æ”¹æ­£è¿™ä¸€é—®é¢˜çš„åŠžæ³•æ˜¯å°†çŽ°åœ¨å æœ‰yåŽŸæ¥ä½ç½®çš„ç»“ç‚¹xè§†ä¸ºè¿˜æœ‰ä¸€é‡é¢å¤–çš„é»‘è‰²ã€‚å½“å°†é»‘è‰²ç»“ç‚¹yåˆ é™¤æˆ–ç§»åŠ¨æ—¶ï¼Œå°†å…¶é»‘è‰²â€œä¸‹æŽ¨â€œç»™ç»“ç‚¹xã€‚è¿™ä¸ªé¢å¤–çš„é»‘è‰²æ˜¯é’ˆå¯¹ç»“ç‚¹xçš„ï¼Œè€Œä¸æ˜¯åæ˜ åœ¨å®ƒçš„colorå±žæ€§ä¸Šçš„ã€‚x.colorä»ç„¶æ˜¯REDï¼ˆå¦‚æžœxæ˜¯çº¢é»‘è‰²çš„ï¼‰æˆ–BLACKï¼ˆå¦‚æžœxæ˜¯åŒé‡é»‘è‰²çš„ï¼‰ã€‚xæ—¶åŒé‡é»‘è‰²æˆ–çº¢é»‘è‰²æ—¶ï¼Œåˆ†åˆ«ç»™åŒ…å«xçš„ç®€å•è·¯å¾„ä¸Šé»‘ç»“ç‚¹æ•°è´¡çŒ®äº†2æˆ–1ã€‚</li></ol><p>ä¸‹é¢æ˜¯è¿‡ç¨‹RB-DELETE-FIXUPçš„ä¼ªä»£ç ã€‚è¯¥è¿‡ç¨‹å¯ä»¥æ¢å¤æ€§è´¨1ã€æ€§è´¨2å’Œæ€§è´¨4ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RB-DELETE-FIXUP(T, x):</span><br><span class="line"><span class="keyword">while</span> x != T.root <span class="keyword">and</span> x.color == BLACK:<span class="comment"># xä¸ºåŒé‡é»‘è‰²ï¼Œä¸ºé»‘è‰²ç»“ç‚¹æ•°è´¡çŒ®2</span></span><br><span class="line">    <span class="keyword">if</span> x == x.p.left:</span><br><span class="line">        w = x.p.right                  <span class="comment"># wæŒ‡å‘å…„å¼Ÿç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> w.color == RED:             <span class="comment"># æƒ…å†µ1ï¼šwæ˜¯çº¢è‰²çš„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œè½¬åŒ–ä¸ºæƒ…å†µ2ã€3æˆ–4</span></span><br><span class="line">            w.color = BLACK               <span class="comment"># è€Œä¸ä¼šè¿åçº¢é»‘æ ‘çš„ä»»ä½•æ€§è´¨</span></span><br><span class="line">            x.p.color = RED            <span class="comment"># æ”¹å˜wå’Œx.pçš„é¢œè‰²</span></span><br><span class="line">            LEFT-ROTATE(T, x.p)        <span class="comment"># ç„¶åŽå¯¹x.påšä¸€æ¬¡å·¦æ—‹</span></span><br><span class="line">            w = x.p.right              <span class="comment"># xçš„æ–°çš„å…„å¼Ÿç»“ç‚¹wæ˜¯é»‘è‰²äº†</span></span><br><span class="line">        <span class="keyword">if</span> w.left.color == BLACK <span class="keyword">and</span> w.right.color == BLACK: <span class="comment"># æƒ…å†µ2ï¼šwå’Œwçš„ä¸¤ä¸ªå­©å­éƒ½æ˜¯é»‘è‰²çš„</span></span><br><span class="line">            w.color = RED              <span class="comment"># æŠ¹åŽ»wçš„é»‘è‰²ï¼Œwçš„æ‰€æœ‰ç¥–å…ˆçš„é»‘é«˜é™ä½Žäº†1</span></span><br><span class="line">            x = x.p                    <span class="comment"># ä½œä¸ºè¡¥å¿ï¼Œåœ¨x.p(ä¹Ÿæ˜¯wçš„çˆ¶èŠ‚ç‚¹)ä¸Šæ–°å¢žä¸€é‡é¢å¤–çš„é»‘è‰²</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># æƒ…å†µ3å’Œæƒ…å†µ4çš„å…¬å…±å‰æï¼šwæ˜¯é»‘è‰²çš„ï¼Œä½†ä¸¤ä¸ªå­©å­ä¸å…¨æ˜¯é»‘è‰²</span></span><br><span class="line">            <span class="keyword">if</span> w.right.color == BLACK: <span class="comment"># æƒ…å†µ3ï¼šwçš„å³å­©å­æ˜¯é»‘è‰²çš„ï¼Œæš—ç¤ºç€å·¦å­©å­æ˜¯çº¢è‰²çš„</span></span><br><span class="line">                w.left.color = BLACK      <span class="comment"># é€šè¿‡ä¸‹åˆ—æ“ä½œè½¬åŒ–ä¸ºæƒ…å†µ4è€Œä¸è¿åçº¢é»‘æ ‘çš„ä»»ä½•æ€§è´¨</span></span><br><span class="line">                w.color = RED             <span class="comment"># wä¸Žå…¶å·¦å­©å­äº¤æ¢é¢œè‰²(wå˜ä¸ºçº¢è‰²äº†)</span></span><br><span class="line">                RIGHT-ROTATE(T, w)        <span class="comment"># ç„¶åŽå¯¹wè¿›è¡Œå³æ—‹(æ—‹è½¬åŽçš„wå˜æˆäº†æ–°wçš„å³å­©å­)</span></span><br><span class="line">                w = x.p.right             <span class="comment"># xçš„æ–°çš„å…„å¼Ÿç»“ç‚¹wä»æ—§æ˜¯é»‘è‰²çš„</span></span><br><span class="line">            w.color = x.p.color        <span class="comment"># æƒ…å†µ4ï¼šwçš„å³å­©å­æ˜¯çº¢è‰²çš„ï¼Œå·¦å­©å­é¢œè‰²æ— æ‰€è°“</span></span><br><span class="line">            x.p.color = BLACK          <span class="comment"># wæ¶‚ä¸Šçˆ¶èŠ‚ç‚¹çš„é¢œè‰²</span></span><br><span class="line">            w.right.color = BLACK      <span class="comment"># ç„¶åŽå°†çˆ¶èŠ‚ç‚¹x.på’Œå³å­©å­w.rightæ¶‚æˆé»‘è‰²</span></span><br><span class="line">            LEFT-ROTATE(T, x.p)        <span class="comment"># æœ€åŽå¯¹x.pè¿›è¡Œä¸€æ¬¡å·¦æ—‹ï¼Œå³å¯åŽ»æŽ‰xçš„é¢å¤–çš„é»‘è‰²</span></span><br><span class="line">            x = T.root                 <span class="comment"># å°†xè®¾ç½®ä¸ºrootï¼Œé€€å‡ºwhileå¾ªçŽ¯</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">         <span class="comment"># same as then clause with "right" and "left" exchanged</span></span><br><span class="line">x.color = BLACK                        <span class="comment"># è‹¥xæŒ‡å‘çº¢é»‘ç»“ç‚¹æˆ–æ ¹èŠ‚ç‚¹ï¼Œç›´æŽ¥æ¶‚æˆé»‘è‰²å³å¯ä¿®å¤æ€§è´¨5</span></span><br></pre></td></tr></table></figure><p>whileå¾ªçŽ¯çš„ç›®æ ‡æ˜¯å°†é¢å¤–çš„é»‘è‰²æ²¿æ ‘ä¸Šç§»ï¼Œç›´åˆ°å¯ä»¥å°†é¢å¤–çš„é»‘è‰²ç§»é™¤ï¼š</p><ol type="1"><li>xæŒ‡å‘çº¢é»‘ç»“ç‚¹ï¼Œæ­¤æ—¶å°†xç€ä¸ºé»‘è‰²ï¼ˆx.color = BLACKï¼‰ï¼Œâ€ç§»é™¤â€é¢å¤–çš„é»‘è‰²ã€‚</li><li>xæŒ‡å‘æ ¹ç»“ç‚¹ï¼Œæ­¤æ—¶â€ç§»é™¤â€œé¢å¤–çš„é»‘è‰²å³å¯ã€‚æ ¹ç»“ç‚¹xåˆ°æ‰€æœ‰å¶å­ç»“ç‚¹çš„ç®€å•è·¯å¾„çš„é»‘è‰²ç»“ç‚¹æ•°éƒ½é™ä½Ž1ã€‚</li><li>æ‰§è¡Œé€‚å½“çš„æ—‹è½¬å’Œé‡æ–°ç€è‰²ï¼Œé€€å‡ºå¾ªçŽ¯ï¼ˆwhileå¾ªçŽ¯å†…çš„ä»£ç ï¼‰ã€‚</li></ol><p>åœ¨whileå¾ªçŽ¯ä¸­ï¼Œxæ€»æ˜¯æŒ‡å‘ä¸€ä¸ªå…·æœ‰åŒé‡é»‘è‰²çš„éžæ ¹ç»“ç‚¹ã€‚è¦åˆ¤æ–­xæ˜¯å·¦å­©å­è¿˜æ˜¯å³å­©å­ã€‚ä¸ºå·¦å­©å­æ—¶çš„ä»£ç ä¸Žä¸ºå³å­©å­æ—¶çš„ä»£ç æ˜¯å¯¹ç§°çš„ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/red-black-tree-delete-fixup.png"></p><p>å¯¹å›¾çš„è¯´æ˜Žï¼š</p><ul><li>åŠ é»‘çš„ç»“ç‚¹colorå±žæ€§ä¸ºBLACKï¼Œæ·±é˜´å½±çš„ç»“ç‚¹colorå±žæ€§ä¸ºREDï¼Œæµ…é˜´å½±çš„ç»“ç‚¹colorå±žæ€§ç”¨cå’Œ<span class="math inline">\(c^\prime\)</span>è¡¨ç¤ºï¼Œå®ƒæ—¢å¯ä¸ºREDä¹Ÿå¯ä¸ºBLACKã€‚å­—æ¯<span class="math inline">\(\alpha,\beta,\dots,\zeta\)</span>ä»£è¡¨ä»»æ„çš„å­æ ‘ã€‚å®¹æ˜“è§‚å¯Ÿåˆ°åœ¨ä¸Šè¿°4ä¸­æ“ä½œä¸­ï¼Œä»»æ„ç»“ç‚¹çš„é»‘é«˜éƒ½æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ˆæ³¨æ„xçš„é»‘è‰²å±‚æ•°ï¼‰ã€‚</li><li>xæŒ‡å‘çš„ç»“ç‚¹å¸¦æœ‰é¢å¤–çš„ä¸€é‡é»‘è‰²ï¼Œå³xä¸ºåŒé‡é»‘è‰²æˆ–çº¢é»‘è‰²ã€‚</li></ul><p>å¯¹ä»£ç å†…æ³¨é‡Šçš„æ•´ç†ï¼š</p><ul><li>xçš„å…„å¼Ÿç»“ç‚¹wæ˜¯çº¢è‰²çš„ã€‚æ”¹å˜wå’Œx.pçš„é¢œè‰²ï¼Œå¯¹x.påšä¸€æ¬¡å·¦æ—‹ã€‚æ—‹è½¬åŽï¼Œxçš„æ–°å…„å¼Ÿç»“ç‚¹new wæ˜¯é»‘è‰²çš„ï¼Œå°±å°†æƒ…å†µ1è½¬æ¢ä¸ºæƒ…å†µ2ã€3æˆ–4ã€‚</li><li>xçš„å…„å¼Ÿç»“ç‚¹wæ˜¯é»‘è‰²çš„ã€‚<ul><li>wçš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚åŽ»æŽ‰wçš„é»‘è‰²ï¼Œä½œä¸ºè¡¥å¿å¯¹w.pï¼ˆ=x.pï¼‰è¡¥å¿ä¸€å±‚é»‘è‰²ã€‚åœ¨ä»£ç ä¸­è¡¨çŽ°ä¸ºæŒ‡é’ˆxçš„ç§»åŠ¨ã€‚</li><li>wçš„ä¸¤ä¸ªå­©å­ä¸å…¨æ˜¯é»‘è‰²çš„ã€‚<ul><li>wçš„å·¦å­©å­æ˜¯çº¢è‰²çš„ï¼Œå³å­©å­æ˜¯é»‘è‰²çš„ã€‚äº¤æ¢wå’Œå·¦å­©å­w.leftçš„é¢œè‰²ï¼Œå¯¹wè¿›è¡Œå³æ—‹ã€‚æ—‹è½¬åŽï¼Œxçš„æ–°å…„å¼Ÿç»“ç‚¹wæ˜¯ä¸€ä¸ªæœ‰çº¢è‰²å³å­©å­çš„é»‘è‰²ç»“ç‚¹ï¼Œå°†æƒ…å†µ3è½¬æ¢æˆæƒ…å†µ4ã€‚</li><li>wçš„å³å­©å­æ˜¯çº¢è‰²çš„ï¼Œå·¦å­©å­é¢œè‰²å¯çº¢å¯é»‘ã€‚é€šè¿‡è¿›è¡ŒæŸäº›é¢œè‰²ä¿®æ”¹å¹¶å¯¹x.påšä¸€æ¬¡å·¦æ—‹ï¼Œå¯ä»¥åŽ»æŽ‰xçš„é¢å¤–çš„é»‘è‰²ï¼Œä»Žè€Œä½¿å®ƒå˜ä¸ºå•é»‘è‰²ã€‚å°†xè®¾ç½®ä¸ºæ ¹åŽï¼Œå½“whileå¾ªçŽ¯æµ‹è¯•å¾ªçŽ¯æ¡ä»¶æ—¶ï¼Œå¾ªçŽ¯ç»ˆæ­¢ã€‚</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> data structures </tag>
            
            <tag> red-black tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå¯ç”¨WebDAV</title>
      <link href="/server/nginx-set-up-a-webdav/"/>
      <url>/server/nginx-set-up-a-webdav/</url>
      
        <content type="html"><![CDATA[<h1 id="çŽ¯å¢ƒ">çŽ¯å¢ƒ</h1><p><a href="https://en.wikipedia.org/wiki/WebDAV" target="_blank" rel="noopener">WebDAV</a>: Web Distributed Authoring and Versioning.</p><ul><li><p>ç³»ç»Ÿï¼šubuntu 18.04.2 LTS</p></li><li><p>nginxï¼š1.14.0</p></li><li><p>å®¢æˆ·ç«¯ï¼šiOS documents å’Œ Windows winscp</p></li></ul><h1 id="å®‰è£…nginx">å®‰è£…nginx</h1><p>nginxé»˜è®¤æ”¯æŒdavï¼Œä½†PROPFINDã€OPTIONSæ“ä½œè¿˜ä¸æ”¯æŒã€‚æ”¯æŒè¿™äº›æ“ä½œéœ€è¦é¢å¤–çš„æ¨¡å—ã€‚</p><ul><li>å®Œå…¨å®‰è£…ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ubuntu@ip:~$ sudo apt-get update</span><br><span class="line">ubuntu@ip:~$ sudo apt-get install nginx-full</span><br></pre></td></tr></table></figure><ul><li>éƒ¨åˆ†å®‰è£…ã€‚</li></ul><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ubuntu@ip:~$ sudo apt-get update</span><br><span class="line">ubuntu@ip:~$ sudo apt-get install nginx nginx-extras</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="é…ç½®">é…ç½®</h1><p>ä½¿ç”¨æ–°åŸŸåã€‚åœ¨sites-availableç›®å½•ä¸‹æ·»åŠ é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight plain"><figcaption><span>/etc/nginx/sites-available/dav</span></figcaption><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        listen [::]:443 ssl;</span><br><span class="line"></span><br><span class="line">        server_name your_dav_domain.com;</span><br><span class="line">        root /var/www/nginx/dav;</span><br><span class="line"></span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate /your/path/dav.crt;</span><br><span class="line">        ssl_certificate_key /your/path/dav.key;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                charset         utf-8;</span><br><span class="line">                autoindex       on;</span><br><span class="line"></span><br><span class="line">                client_body_temp_path   /etc/nginx/client_temp;</span><br><span class="line">                client_max_body_size    512m;  # æœ€å¤§æ–‡ä»¶ï¼Œè‹¥ä¸º0åˆ™è¡¨ç¤ºä¸é™åˆ¶</span><br><span class="line"></span><br><span class="line">                dav_methods PUT DELETE MKCOL COPY MOVE;</span><br><span class="line">                dav_ext_methods PROPFIND OPTIONS;  # éœ€è¦é¢å¤–çš„æ¨¡å—æ”¯æŒ</span><br><span class="line"></span><br><span class="line">                create_full_put_path    on;</span><br><span class="line">                dav_access              group:rw all:r;</span><br><span class="line"></span><br><span class="line">                auth_basic              &quot;Access limited&quot;;</span><br><span class="line">                auth_basic_user_file    /etc/nginx/user.passwd;</span><br><span class="line"></span><br><span class="line">                access_log              /var/log/nginx/access.dav.log;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ç”¨è¯¥é…ç½®ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:/etc/nginx/sites-enabled$ <span class="built_in">cd</span> /etc/nginx/sites-available/</span><br><span class="line">git@ip:/etc/nginx/sites-available$ sudo ln -s dav ../sites-enabled/dav</span><br><span class="line">git@ip:/etc/nginx/sites-available$ sudo nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line">git@ip:/etc/nginx/sites-available$ sudo nginx -s reload</span><br></pre></td></tr></table></figure><h1 id="åˆ é™¤æ–‡ä»¶å¤¹">åˆ é™¤æ–‡ä»¶å¤¹</h1><p>æ­å»ºäº†webdavæœåŠ¡å™¨åŽï¼Œèƒ½è®¿é—®å¹¶å¯ä»¥æ‰§è¡Œéƒ¨åˆ†æ“ä½œï¼Œå¦‚åˆ›å»ºæ–‡ä»¶ç­‰ã€‚ä½†ä¹Ÿæœ‰ä¸èƒ½æ‰§è¡Œçš„æ“ä½œï¼Œå‡ºçŽ°æ­¤é—®é¢˜çš„åŽŸå› æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¦æ±‚ä¸å…¼å®¹ã€‚æ¯”å¦‚winscpå¯ä»¥åˆ é™¤æ–‡ä»¶å¤¹ï¼Œä½†ä¸å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤¹åç§°ã€‚documentsä¸å¯ä»¥åˆ é™¤æ–‡ä»¶å¤¹ï¼ˆä½†æ˜¯æ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶ä¼šè¢«æˆåŠŸåˆ é™¤ï¼‰ï¼Œä¹Ÿä¸èƒ½é‡å‘½åæ–‡ä»¶å¤¹ï¼ˆå®¢æˆ·ç«¯æç¤ºæƒé™ä¸è¶³ï¼Œæç¤ºå¹¶ä¸æ­£ç¡®ï¼Œçœ‹nginxçš„é”™è¯¯æ—¥å¿—ï¼‰ã€‚</p><table><thead><tr class="header"><th>æ“ä½œ</th><th>winscp</th><th>documents</th><th>err_log</th></tr></thead><tbody><tr class="odd"><td>æµè§ˆ</td><td>Y</td><td>Y</td><td></td></tr><tr class="even"><td>åˆ›å»ºæ–‡ä»¶</td><td>Y</td><td>Y</td><td></td></tr><tr class="odd"><td>åˆ›å»ºæ–‡ä»¶å¤¹</td><td>Y</td><td>Y</td><td></td></tr><tr class="even"><td>ç§»åŠ¨æ–‡ä»¶ï¼ˆåŒ…æ‹¬é‡å‘½åï¼‰</td><td>Y</td><td>Y</td><td></td></tr><tr class="odd"><td>ç§»åŠ¨æ–‡ä»¶å¤¹ï¼ˆåŒ…æ‹¬é‡å‘½åï¼‰</td><td>N</td><td>N</td><td>&quot;/folder&quot; is collection</td></tr><tr class="even"><td>åˆ é™¤æ–‡ä»¶</td><td>Y</td><td>Y</td><td></td></tr><tr class="odd"><td>åˆ é™¤æ–‡ä»¶å¤¹</td><td>Y</td><td>N</td><td>DELETE &quot;/folder&quot; failed (21: Is a directory)</td></tr></tbody></table><p>æ ¹æ®æ—¥å¿—ï¼ŒæŠ¥é”™çš„åŽŸå› æ˜¯nginxè¦æ±‚å¯¹æ–‡ä»¶å¤¹çš„æ“ä½œè¯·æ±‚çš„æœ«å°¾å¸¦ä¸Šæ–œçº¿/ï¼Œæ¯”å¦‚åˆ é™¤æ–‡ä»¶å¤¹å¿…é¡»æ˜¯DELETE /folder/ï¼Œä½†æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚æ˜¯DELETE /folderï¼Œå› æ­¤æŠ¥é”™ã€‚</p><p>ä¿®å¤æ–¹æ³•æ˜¯é‡å†™è¯·æ±‚ï¼Œåœ¨webdavçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸‹åˆ—ä¿®æ”¹ï¼š</p><figure class="highlight diff"><figcaption><span>/etc/nginx/sites-enabled/dav</span></figcaption><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"><span class="addition">+    # å¦‚æžœè¯·æ±‚å†…å®¹æ˜¯æ–‡ä»¶å¤¹ï¼Œåœ¨è¯·æ±‚æœ«å°¾åŠ ä¸Š/</span></span><br><span class="line"><span class="addition">+    if ( -d $request_filename ) &#123;  </span></span><br><span class="line"><span class="addition">+        rewrite ^(.*[^/])$ $1/ break;</span></span><br><span class="line"><span class="addition">+    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç§»åŠ¨æ–‡ä»¶å¤¹">ç§»åŠ¨æ–‡ä»¶å¤¹</h1><p>åŠ äº†å¦‚ä¸Šé…ç½®åŽï¼Œdocumentså¯ä»¥åˆ é™¤æ–‡ä»¶å¤¹äº†ï¼Œä½†æ˜¯ä¸è®ºwinscpè¿˜æ˜¯documentséƒ½æ— æ³•é‡å‘½åæ–‡ä»¶å¤¹ã€‚é”™è¯¯æ—¥å¿—ä¸º<code>both URI &quot;/fog/&quot; and &quot;Destination&quot; URI &quot;https://dav.server.demo/fofg&quot; should be either collections or non-collections</code>ã€‚å³nginxæ”¶åˆ°äº†å°†æ–‡ä»¶å¤¹é‡å‘½åä¸ºæ–‡ä»¶çš„æ“ä½œè¯·æ±‚ï¼ŒäºŽæ˜¯æŠ¥å‡ºä»¥ä¸Šé”™è¯¯ã€‚åœ¨å°è¯•äº†å„ç§é…ç½®æ— æ³•è§£å†³åŽï¼Œæˆ‘åœ¨nginxæºæ–‡ä»¶ngx_http_dav_module.cä¸­æ‰¾åˆ°äº†è¿™æ®µä»£ç ã€‚è¿™æ®µä»£ç è¦æ±‚URIå’ŒDestinationä¸€è‡´ï¼Œè¦ä¹ˆéƒ½å¸¦/ï¼Œè¦ä¹ˆéƒ½ä¸å¸¦/ã€‚</p><figure class="highlight c"><figcaption><span>~/nginx-1.14.0/src/http/modules/ngx_http_dav_module.c</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ((r-&gt;uri.data[r-&gt;uri.len - <span class="number">1</span>] == <span class="string">'/'</span> &amp;&amp; *(last - <span class="number">1</span>) != <span class="string">'/'</span>)</span><br><span class="line">    || (r-&gt;uri.data[r-&gt;uri.len - <span class="number">1</span>] != <span class="string">'/'</span> &amp;&amp; *(last - <span class="number">1</span>) == <span class="string">'/'</span>))</span><br><span class="line">&#123;</span><br><span class="line">    ngx_log_error(NGX_LOG_ERR, r-&gt;connection-&gt;<span class="built_in">log</span>, <span class="number">0</span>,</span><br><span class="line">                  <span class="string">"both URI \"%V\" and \"Destination\" URI \"%V\" "</span></span><br><span class="line">                  <span class="string">"should be either collections or non-collections"</span>,</span><br><span class="line">                  &amp;r-&gt;uri, &amp;dest-&gt;value);</span><br><span class="line">    <span class="keyword">return</span> NGX_HTTP_CONFLICT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ³¨é‡ŠæŽ‰äº†è¿™æ®µä»£ç ï¼Œé‡æ–°ç¼–è¯‘nginxã€‚</p><h1 id="ç¼–è¯‘nginx">ç¼–è¯‘nginx</h1><p>ä¸‹è½½nginxå’Œnginx-dav-ext-moduleã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ubuntu@ip:~$ wget http://nginx.org/download/nginx-1.14.0.tar.gz</span><br><span class="line">ubuntu@ip:~$ tar xzf nginx-1.14.0.tar.gz</span><br><span class="line">ubuntu@ip:~$ git <span class="built_in">clone</span> https://github.com/arut/nginx-dav-ext-module.git</span><br></pre></td></tr></table></figure><p>åœ¨nginxæºç ä¸­æ³¨é‡ŠæŽ‰ä¸Šè¿°ä»£ç ã€‚</p><figure class="highlight c"><figcaption><span>~/nginx-1.14.0/src/http/modules/ngx_http_dav_module.c</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if ((r-&gt;uri.data[r-&gt;uri.len - 1] == '/' &amp;&amp; *(last - 1) != '/')</span></span><br><span class="line"><span class="comment">    || (r-&gt;uri.data[r-&gt;uri.len - 1] != '/' &amp;&amp; *(last - 1) == '/'))</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    ngx_log_error(NGX_LOG_ERR, r-&gt;connection-&gt;log, 0,</span></span><br><span class="line"><span class="comment">                  "both URI \"%V\" and \"Destination\" URI \"%V\" "</span></span><br><span class="line"><span class="comment">                  "should be either collections or non-collections",</span></span><br><span class="line"><span class="comment">                  &amp;r-&gt;uri, &amp;dest-&gt;value);</span></span><br><span class="line"><span class="comment">    return NGX_HTTP_CONFLICT;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¼–è¯‘å‚æ•°ï¼Œ<a href="https://xuexb.github.io/learn-nginx/guide/nginx-configure-descriptions.html" target="_blank" rel="noopener">ç¼–è¯‘å‚æ•°ä»‹ç»</a>ã€‚ä¸æƒ³æ·±ç©¶ç¼–è¯‘å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é»˜è®¤çš„ç¼–è¯‘å‚æ•°ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ubuntu@ip:~/nginx-1.14.0$ nginx -V  <span class="comment"># æŸ¥çœ‹ç¼–è¯‘å‚æ•°</span></span><br><span class="line">nginx version: nginx/1.14.0 (Ubuntu)</span><br><span class="line">built with OpenSSL 1.1.1  11 Sep 2018</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-cc-opt=<span class="string">'-g -O2 -fdebug-prefix-map=/build/nginx-DUghaW/nginx-1.14.0=. -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2'</span> --with-ld-opt=<span class="string">'-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -fPIC'</span> --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_geoip_module=dynamic --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_sub_module --with-http_xslt_module=dynamic --with-stream=dynamic --with-stream_ssl_module --with-mail=dynamic --with-mail_ssl_module</span><br></pre></td></tr></table></figure><p>ä¿æŒè¿™äº›å‚æ•°ä¸å˜ï¼Œæ·»åŠ é¢å¤–çš„nginx-dav-ext-moduleæ¨¡å—ã€‚</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ubuntu@ip:~/nginx-1.14.0$ ./configure --with-cc-opt=...åŽŸæ¥çš„å‚æ•°... --add-module=../nginx-dav-ext-module</span><br><span class="line">ubuntu@ip:~/nginx-1.14.0$ make  <span class="comment"># ç¼–è¯‘</span></span><br><span class="line">ubuntu@ip:~/nginx-1.14.0$ sudo objs/nginx -t  <span class="comment"># æµ‹è¯•</span></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line">ubuntu@ip:~/nginx-1.14.0$ sudo cp /usr/sbin/nginx /usr/sbin/nginx.bak  <span class="comment"># å¤‡ä»½</span></span><br><span class="line">ubuntu@ip:~/nginx-1.14.0$ sudo nginx -s stop  <span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">ubuntu@ip:~/nginx-1.14.0$ sudo cp objs/nginx /usr/sbin/nginx  <span class="comment"># æ›¿æ¢</span></span><br><span class="line">ubuntu@ip:~/nginx-1.14.0$ sudo service nginx start  <span class="comment"># é‡å¯</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æœåŠ¡å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> webdav </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UbuntuæŒ‚è½½å’Œå¸é™¤æ–‡ä»¶ç³»ç»Ÿ</title>
      <link href="/server/ubuntu-mount-and-unmount-drive/"/>
      <url>/server/ubuntu-mount-and-unmount-drive/</url>
      
        <content type="html"><![CDATA[<h1 id="æŒ‚è½½">æŒ‚è½½</h1><p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo fdisk -l</span><br><span class="line">...çœç•¥...</span><br><span class="line">Disk /dev/xvdb: 20 GiB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure><p>ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿä¸º/dev/xvdbã€‚æŒ‚è½½ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo mkdir /mnt/data</span><br><span class="line">git@ip:~$ sudo mount /dev/xvdb /mnt/data/</span><br><span class="line">git@ip:~$ sudo df -h  <span class="comment"># æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">...çœç•¥...</span><br><span class="line">/dev/xvdb        20G  208M   19G   2% /mnt/data</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="å¸é™¤">å¸é™¤</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo umount /dev/xvdb  <span class="comment"># é€šè¿‡è®¾å¤‡å</span></span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo umount /mnt/data  <span class="comment"># é€šè¿‡æŒ‚è½½ç‚¹</span></span><br></pre></td></tr></table></figure><h1 id="è‡ªåŠ¨æŒ‚è½½">è‡ªåŠ¨æŒ‚è½½</h1><p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo e2label /dev/xvdb data  <span class="comment"># ä¿®æ”¹å·æ ‡</span></span><br><span class="line">git@ip:~$ sudo blkid /dev/xvdb</span><br><span class="line">/dev/xvdb: LABEL=<span class="string">"data"</span> UUID=<span class="string">"a0001bdb-4b69-4419-9339-f57ddec2f007"</span> TYPE=<span class="string">"ext4"</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹fstabæ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo nano /etc/fstab</span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸€åˆ—ï¼š</p><figure class="highlight diff"><figcaption><span>/etc/fstab</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="addition">+    LABEL=data              /mnt/data       ext4    defaults                0 2</span></span><br></pre></td></tr></table></figure><p>/etc/fstabæ–‡ä»¶åŒ…å«äº†å¦‚ä¸‹å­—æ®µï¼Œé€šè¿‡ç©ºæ ¼æˆ–Tabåˆ†éš”ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;file system&gt;    &lt;dir&gt;    &lt;type&gt;    &lt;options&gt;    &lt;dump&gt;    &lt;pass&gt;</span><br></pre></td></tr></table></figure><ul><li><file system> - è¦æŒ‚è½½çš„åˆ†åŒºæˆ–å­˜å‚¨è®¾å¤‡ã€‚</file></li><li><dir><ul><li>file systemsçš„æŒ‚è½½ä½ç½®ã€‚</li></ul></dir></li><li><type> - æ–‡ä»¶ç³»ç»Ÿç±»åž‹ï¼Œæ”¯æŒè®¸å¤šç§ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼šext2, ext3, ext4, reiserfs, xfs, jfs, smbfs, iso9660, vfat, ntfs, swapåŠautoã€‚è®¾ç½®æˆautoç±»åž‹ï¼Œmountå‘½ä»¤ä¼šçŒœæµ‹ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç±»åž‹ï¼Œå¯¹CDROMå’ŒDVDç­‰ç§»åŠ¨è®¾å¤‡æ˜¯éžå¸¸æœ‰ç”¨çš„ã€‚</type></li><li><options> - æŒ‚è½½æ—¶ä½¿ç”¨çš„å‚æ•°ï¼Œæ³¨æ„æœ‰äº›å‚æ•°æ˜¯ç‰¹å®šæ–‡ä»¶ç³»ç»Ÿæ‰æœ‰çš„ã€‚</options></li><li><dump> - dumpå·¥å…·é€šè¿‡å®ƒå†³å®šä½•æ—¶ä½œå¤‡ä»½ã€‚dumpä¼šæ£€æŸ¥å…¶å†…å®¹ï¼Œå¹¶ç”¨æ•°å­—æ¥å†³å®šæ˜¯å¦å¯¹è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¤‡ä»½ã€‚å…è®¸çš„æ•°å­—æ˜¯0å’Œ1ã€‚0è¡¨ç¤ºå¿½ç•¥ï¼Œ1åˆ™è¿›è¡Œå¤‡ä»½ã€‚å¤§éƒ¨åˆ†çš„ç”¨æˆ·æ˜¯æ²¡æœ‰å®‰è£…dumpçš„ï¼Œå¯¹ä»–ä»¬è€Œè¨€<dump>åº”è®¾ä¸º0ã€‚</dump></dump></li><li><pass> - fsckè¯»å–<pass>çš„æ•°å€¼æ¥å†³å®šéœ€è¦æ£€æŸ¥çš„æ–‡ä»¶ç³»ç»Ÿçš„æ£€æŸ¥é¡ºåºã€‚å…è®¸çš„æ•°å­—æ˜¯0, 1, å’Œ2ã€‚æ ¹ç›®å½•åº”å½“èŽ·å¾—æœ€é«˜çš„ä¼˜å…ˆæƒ1,å…¶å®ƒæ‰€æœ‰éœ€è¦è¢«æ£€æŸ¥çš„è®¾å¤‡è®¾ç½®ä¸º2ã€‚0è¡¨ç¤ºè®¾å¤‡ä¸ä¼šè¢«fsckæ‰€æ£€æŸ¥ã€‚</pass></pass></li></ul><p><strong>éªŒè¯é…ç½®çš„æ­£ç¡®æ€§</strong>ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git@ip:~$ sudo mount -a  <span class="comment"># æœ‰é”™è¯¯æ—¶æ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">mount: /mnt/data: can<span class="string">'t find LABEL=date.</span></span><br></pre></td></tr></table></figure><p>æœ€åŽå¯ä»¥é‡å¯ç³»ç»ŸéªŒè¯ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æœåŠ¡å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> command </tag>
            
            <tag> mount </tag>
            
            <tag> unmount </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonè¿­ä»£å™¨ä¸Žç”Ÿæˆå™¨</title>
      <link href="/programming/python-iterator-generator/"/>
      <url>/programming/python-iterator-generator/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿­ä»£å™¨">è¿­ä»£å™¨</h1><p>è¿­ä»£æ˜¯è®¿é—®é›†åˆå…ƒç´ çš„ä¸€ç§æ–¹å¼ã€‚è¿­ä»£å™¨ä»Žé›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ è¢«è®¿é—®å®Œã€‚è¿­ä»£å™¨åªèƒ½å¾€å‰è®¿é—®ï¼Œä¸èƒ½åŽé€€ã€‚å­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ï¼Œé›†åˆç­‰é›†åˆå¯¹è±¡éƒ½å¯ç”¨äºŽåˆ›å»ºè¿­ä»£å™¨ã€‚</p><p>å¤šæ•°æƒ…å†µä¸‹ï¼Œæ›´å€¾å‘äºŽé€šè¿‡ä»¥ä¸‹æ–¹å¼éåŽ†é›†åˆï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line"><span class="meta">... </span>    print(i, end=<span class="string">' '</span>)</span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    print()</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><p>ç­‰ä»·åœ°ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªé›†åˆaçš„è¿­ä»£å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>it = iter(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">try</span>:</span><br><span class="line"><span class="meta">... </span>        print(next(it), end=<span class="string">' '</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">except</span> StopIteration:   <span class="comment"># è®¿é—®ç»“æŸåŽå†æ¬¡è°ƒç”¨next(it)ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸</span></span><br><span class="line"><span class="meta">... </span>        print()</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">break</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘å¸Œæœ›åƒéåŽ†æ•°ç»„ä¸€æ ·å¯ä»¥éåŽ†é“¾è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        self.key, self.next = key, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.y = self  <span class="comment"># ç”¨å˜é‡yè®°å½•ä½ç½®</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.y <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># é˜Ÿå°¾åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x = self.y  <span class="comment"># æš‚å­˜</span></span><br><span class="line">            <span class="keyword">if</span> self.y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># æ›´æ–°ä½ç½®ä»¥ä¾¿ä¸‹æ¬¡è®¿é—®</span></span><br><span class="line">                self.y = self.y.next</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a, b, c = Node(<span class="number">1</span>), Node(<span class="number">2</span>), Node(<span class="number">3</span>)</span><br><span class="line">    a.next, b.next, c.next = b, c, <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> a:             <span class="comment"># for each</span></span><br><span class="line">        print(i, end=<span class="string">' '</span>)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    it = iter(b)            <span class="comment"># iterator</span></span><br><span class="line">    print(next(it))</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">2</span><br></pre></td></tr></table></figure><h1 id="ç”Ÿæˆå™¨">ç”Ÿæˆå™¨</h1><p>åœ¨Pythonä¸­ï¼Œä½¿ç”¨äº†yieldçš„å‡½æ•°è¢«ç§°ä¸ºç”Ÿæˆå™¨ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›žè¿­ä»£å™¨çš„å‡½æ•°ï¼Œåªèƒ½ç”¨äºŽè¿­ä»£æ“ä½œï¼Œæ›´ç®€å•ç‚¹ç†è§£ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p><p>pythonå¯ä»¥é€šè¿‡åˆ—è¡¨è§£æžï¼ˆlist comprehensionï¼‰çš„æ–¹å¼æž„å»ºé›†åˆï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure><p>å®žé™…ä¸Šï¼Œ<code>(i for i in range(10))</code>å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">generator</span>'&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ç”Ÿæˆå™¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡é‡åˆ°yieldæ—¶å‡½æ•°ä¼šæš‚åœå¹¶ä¿å­˜å½“å‰æ‰€æœ‰çš„è¿è¡Œä¿¡æ¯ï¼Œè¿”å›žyieldçš„å€¼ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œnext()æ–¹æ³•æ—¶ä»Žå½“å‰ä½ç½®ç»§ç»­è¿è¡Œã€‚</p><p>è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæœ€è¿‘ç ”ç©¶å¦‚ä½•èŽ·å¾—ä¸€ä¸ªå›¾ä¸­ä¸¤ç‚¹ä¹‹é—´çš„æ‰€æœ‰ç®€å•è·¯å¾„ã€‚ä¸€ä¸ªæµ‹è¯•ç¤ºä¾‹ä¸­å¤§æ¦‚åŒ…å«ä¸€åƒä¸‡æ¡ä¸åŒçš„ç®€å•è·¯å¾„ï¼Œè‹¥æ˜¯ä¸€æ¬¡æ€§å°†è¿™ä¸€åƒä¸‡æ¡ä½œä¸ºæ•°ç»„è¿”å›žï¼Œâ€¦â€¦ï¼Œå¤§æ¦‚æˆ‘çš„ç¬”è®°æœ¬ä¼šåŽŸåœ°çˆ†ç‚¸å§ã€‚</p><p>è¿™æ—¶ç”Ÿæˆå™¨å°±æŽ’ä¸Šç”¨åœºäº†ã€‚ä¸ºäº†ç®€åŒ–è¯´æ˜Žï¼Œä½¿ç”¨æ–æ³¢é‚£å¥‘æ•°åˆ—ä½œä¸ºç¤ºä¾‹ã€‚ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—çš„è¿­ä»£ç‰ˆæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="string">"""è¿”å›žæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‰nä¸ªå…ƒç´ ç»„æˆçš„åˆ—è¡¨"""</span></span><br><span class="line">    a, b, c, r = <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, []</span><br><span class="line">    <span class="keyword">while</span> c &lt; n:</span><br><span class="line">        r.append(a)</span><br><span class="line">        a, b, c = b, a + b, c + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure><p>å‡è®¾éœ€è¦èŽ·å¾—å‰ä¸€åƒä¸‡ä¸ªæ•°ï¼Œâ€¦â€¦ï¼Œ(#`Oâ€²)ã€‚ä¸‹é¢ä½¿ç”¨yieldå°†ä¹‹å˜ä¸ºç”Ÿæˆå™¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci_it</span><span class="params">(n)</span>:</span> <span class="comment"># å®ƒæ˜¯ä¸€ä¸ªè¿­ä»£å™¨</span></span><br><span class="line">    a, b, c = <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> c &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> a  <span class="comment"># æ¯æ¬¡æ‰§è¡Œåˆ°æ­¤å¤„æš‚åœï¼Œè¿”å›žä¸€ä¸ªç»“æžœï¼Œä¸‹æ¬¡è°ƒç”¨nextæ—¶å°†ä»Žæ­¤å¤„ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">        a, b, c = b, a + b, c + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> fibonacci_it(<span class="number">10</span>):    <span class="comment"># ä½¿ç”¨</span></span><br><span class="line">        print(i, end=<span class="string">' '</span>)</span><br><span class="line">    print()</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 1 1 2 3 5 8 13 21 34</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> iterator </tag>
            
            <tag> recursion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NetworkX æ–‡æ¡£</title>
      <link href="/documentation/networkx-documentation/"/>
      <url>/documentation/networkx-documentation/</url>
      
        <content type="html"><![CDATA[<h1 id="å›¾çš„ç§ç±»">å›¾çš„ç§ç±»</h1><p>æœ‰ 4 ç§ + 1 ç±» <a href="https://networkx.github.io/documentation/stable/reference/classes/index.html#basic-graph-types" target="_blank" rel="noopener">Basic graph types</a>ã€‚</p><ul><li><code>Graph</code>ï¼šæ— å‘å›¾ï¼Œå…è®¸è‡ªçŽ¯ï¼ˆé¡¶ç‚¹ä¸Žè‡ªèº«è¿žæŽ¥çš„è¾¹ï¼‰ã€‚</li><li><code>DiGraph</code>ï¼šæœ‰å‘å›¾ï¼Œå…è®¸è‡ªçŽ¯ã€‚</li><li><code>MultiGraph</code>ï¼šæ— å‘å›¾ï¼Œå…è®¸è‡ªçŽ¯å’Œå¹³è¡Œè¾¹ï¼ˆä¸¤æ¡æˆ–å¤šæ¡ä¸ŽåŒä¸€å¯¹é¡¶ç‚¹ç›¸è¿žæŽ¥çš„è¾¹ï¼‰ã€‚</li><li><code>MultiDiGraph</code>ï¼šæœ‰å‘å›¾ï¼Œå…è®¸è‡ªçŽ¯å’Œå¹³è¡Œè¾¹ã€‚</li><li>Ordered Graphï¼š<code>OrderedGraph</code>ï¼Œ<code>OrderedDiGraph</code>ï¼Œ<code>OrderedMultiGraph</code>ï¼Œ<code>OrderedMultiDiGraph</code>ã€‚</li></ul><p>Ordered Graph çš„å­˜åœ¨æ„ä¹‰ï¼šåœ¨è¿”å›žå›¾ä¸­é¡¶ç‚¹æˆ–è¾¹çš„é›†åˆæ—¶ï¼ŒOrdered Graph æ€»æ˜¯ä»¥ä¸€ä¸ªå›ºå®šçš„é¡ºåºè¿”å›žã€‚</p><p>å½“<strong>æ— éœ€æ­¤é¡¹æ€§è´¨</strong>æˆ–<strong>ä½¿ç”¨Python 3.6+</strong>ï¼ˆPython 3.6+ä¸­ï¼Œé›†åˆçš„é¡ºåºæ˜¯å›ºå®šçš„ï¼‰æ—¶ï¼Œä½¿ç”¨å‰å››ç§åŸºæœ¬ç±»å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = nx.Graph()</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="graph-çš„æ–¹æ³•">Graph çš„æ–¹æ³•</h1><p>å…¶ä»–ç±»çš„æ–¹æ³•å¤§åŒå°å¼‚ã€‚</p><h2 id="adding-and-removing-nodes-and-edges">Adding and removing nodes and edges</h2><table><colgroup><col style="width: 23%"><col style="width: 76%"></colgroup><thead><tr class="header"><th>Method</th><th>Description</th></tr></thead><tbody><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.__init__.html#networkx.Graph.__init__" target="_blank" rel="noopener"><code>Graph.__init__([incoming_graph_data])</code></a></td><td>Initialize a graph with edges, name, or graph attributes.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.add_node.html#networkx.Graph.add_node" target="_blank" rel="noopener"><code>Graph.add_node(node_for_adding, **attr)</code></a></td><td>Add a single node node_for_adding and update node attributes.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.add_nodes_from.html#networkx.Graph.add_nodes_from" target="_blank" rel="noopener"><code>Graph.add_nodes_from(nodes_for_adding, **attr)</code></a></td><td>Add multiple nodes.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.remove_node.html#networkx.Graph.remove_node" target="_blank" rel="noopener"><code>Graph.remove_node(n)</code></a></td><td>Remove node n.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.remove_nodes_from.html#networkx.Graph.remove_nodes_from" target="_blank" rel="noopener"><code>Graph.remove_nodes_from(nodes)</code></a></td><td>Remove multiple nodes.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.add_edge.html#networkx.Graph.add_edge" target="_blank" rel="noopener"><code>Graph.add_edge(u_of_edge, v_of_edge, **attr)</code></a></td><td>Add an edge between u and v.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.add_edges_from.html#networkx.Graph.add_edges_from" target="_blank" rel="noopener"><code>Graph.add_edges_from(ebunch_to_add, **attr)</code></a></td><td>Add all the edges in ebunch_to_add.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.add_weighted_edges_from.html#networkx.Graph.add_weighted_edges_from" target="_blank" rel="noopener"><code>Graph.add_weighted_edges_from(ebunch_to_add)</code></a></td><td>Add weighted edges in ebunch_to_add with specified weight attr</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.remove_edge.html#networkx.Graph.remove_edge" target="_blank" rel="noopener"><code>Graph.remove_edge(u, v)</code></a></td><td>Remove the edge between u and v.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.remove_edges_from.html#networkx.Graph.remove_edges_from" target="_blank" rel="noopener"><code>Graph.remove_edges_from(ebunch)</code></a></td><td>Remove all edges specified in ebunch.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.update.html#networkx.Graph.update" target="_blank" rel="noopener"><code>Graph.update([edges, nodes])</code></a></td><td>Update the graph using nodes/edges/graphs as input.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.clear.html#networkx.Graph.clear" target="_blank" rel="noopener"><code>Graph.clear()</code></a></td><td>Remove all nodes and edges from the graph.</td></tr></tbody></table><h2 id="reporting-nodes-edges-and-neighbors">Reporting nodes edges and neighbors</h2><table><colgroup><col style="width: 23%"><col style="width: 76%"></colgroup><thead><tr class="header"><th>Method</th><th>Description</th></tr></thead><tbody><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.nodes.html#networkx.Graph.nodes" target="_blank" rel="noopener"><code>Graph.nodes</code></a></td><td>A NodeView of the Graph as G.nodes or G.nodes().</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.__iter__.html#networkx.Graph.__iter__" target="_blank" rel="noopener"><code>Graph.__iter__()</code></a></td><td>Iterate over the nodes.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.has_node.html#networkx.Graph.has_node" target="_blank" rel="noopener"><code>Graph.has_node(n)</code></a></td><td>Returns True if the graph contains the node n.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.__contains__.html#networkx.Graph.__contains__" target="_blank" rel="noopener"><code>Graph.__contains__(n)</code></a></td><td>Returns True if n is a node, False otherwise.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.edges.html#networkx.Graph.edges" target="_blank" rel="noopener"><code>Graph.edges</code></a></td><td>An EdgeView of the Graph as G.edges or G.edges().</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.has_edge.html#networkx.Graph.has_edge" target="_blank" rel="noopener"><code>Graph.has_edge(u, v)</code></a></td><td>Returns True if the edge (u, v) is in the graph.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.get_edge_data.html#networkx.Graph.get_edge_data" target="_blank" rel="noopener"><code>Graph.get_edge_data(u, v[, default])</code></a></td><td>Returns the attribute dictionary associated with edge (u, v).</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.neighbors.html#networkx.Graph.neighbors" target="_blank" rel="noopener"><code>Graph.neighbors(n)</code></a></td><td>Returns an iterator over all neighbors of node n.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.adj.html#networkx.Graph.adj" target="_blank" rel="noopener"><code>Graph.adj</code></a></td><td>Graph adjacency object holding the neighbors of each node.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.__getitem__.html#networkx.Graph.__getitem__" target="_blank" rel="noopener"><code>Graph.__getitem__(n)</code></a></td><td>Returns a dict of neighbors of node n.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.adjacency.html#networkx.Graph.adjacency" target="_blank" rel="noopener"><code>Graph.adjacency()</code></a></td><td>Returns an iterator over (node, adjacency dict) tuples for all nodes.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.nbunch_iter.html#networkx.Graph.nbunch_iter" target="_blank" rel="noopener"><code>Graph.nbunch_iter([nbunch])</code></a></td><td>Returns an iterator over nodes contained in nbunch that are also in the graph.</td></tr></tbody></table><h2 id="counting-nodes-edges-and-neighbors">Counting nodes edges and neighbors</h2><table><colgroup><col style="width: 23%"><col style="width: 76%"></colgroup><thead><tr class="header"><th>Method</th><th>Description</th></tr></thead><tbody><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.order.html#networkx.Graph.order" target="_blank" rel="noopener"><code>Graph.order()</code></a></td><td>Returns the number of nodes in the graph.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.number_of_nodes.html#networkx.Graph.number_of_nodes" target="_blank" rel="noopener"><code>Graph.number_of_nodes()</code></a></td><td>Returns the number of nodes in the graph.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.__len__.html#networkx.Graph.__len__" target="_blank" rel="noopener"><code>Graph.__len__()</code></a></td><td>Returns the number of nodes in the graph.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.degree.html#networkx.Graph.degree" target="_blank" rel="noopener"><code>Graph.degree</code></a></td><td>A DegreeView for the Graph as G.degree or G.degree().</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.size.html#networkx.Graph.size" target="_blank" rel="noopener"><code>Graph.size([weight])</code></a></td><td>Returns the number of edges or total of all edge weights.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.number_of_edges.html#networkx.Graph.number_of_edges" target="_blank" rel="noopener"><code>Graph.number_of_edges([u, v])</code></a></td><td>Returns the number of edges between two nodes.</td></tr></tbody></table><h2 id="making-copies-and-subgraphs">Making copies and subgraphs</h2><table><colgroup><col style="width: 23%"><col style="width: 76%"></colgroup><thead><tr class="header"><th>Method</th><th>Description</th></tr></thead><tbody><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.copy.html#networkx.Graph.copy" target="_blank" rel="noopener"><code>Graph.copy([as_view])</code></a></td><td>Returns a copy of the graph.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.to_undirected.html#networkx.Graph.to_undirected" target="_blank" rel="noopener"><code>Graph.to_undirected([as_view])</code></a></td><td>Returns an undirected copy of the graph.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.to_directed.html#networkx.Graph.to_directed" target="_blank" rel="noopener"><code>Graph.to_directed([as_view])</code></a></td><td>Returns a directed representation of the graph.</td></tr><tr class="even"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.subgraph.html#networkx.Graph.subgraph" target="_blank" rel="noopener"><code>Graph.subgraph(nodes)</code></a></td><td>Returns a SubGraph view of the subgraph induced on nodes.</td></tr><tr class="odd"><td><a href="https://networkx.github.io/documentation/stable/reference/classes/generated/networkx.Graph.edge_subgraph.html#networkx.Graph.edge_subgraph" target="_blank" rel="noopener"><code>Graph.edge_subgraph(edges)</code></a></td><td>Returns the subgraph induced by the specified edges.</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> networkx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢</title>
      <link href="/notes/introduction-to-algorithms/breadth-first-search-and-depth-first-search/"/>
      <url>/notes/introduction-to-algorithms/breadth-first-search-and-depth-first-search/</url>
      
        <content type="html"><![CDATA[<h1 id="å¹¿åº¦ä¼˜å…ˆæœç´¢">å¹¿åº¦ä¼˜å…ˆæœç´¢</h1><p>å¹¿åº¦ä¼˜å…ˆæœç´¢æ˜¯æœ€ç®€å•çš„å›¾æœç´¢ç®—æ³•ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯è®¸å¤šé‡è¦ç®—æ³•çš„åŽŸåž‹ã€‚<strong>Primçš„æœ€å°ç”Ÿæˆæ ‘ç®—æ³•å’ŒDijkstraçš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•éƒ½ä½¿ç”¨äº†ç±»ä¼¼å¹¿åº¦ä¼˜å…ˆæœç´¢çš„æ€æƒ³</strong>ã€‚</p><p>ç»™å®šå›¾G=(V,E)å’Œä¸€ä¸ªå¯ä»¥è¯†åˆ«çš„æºç»“ç‚¹sï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢å¯¹å›¾Gä¸­çš„è¾¹è¿›è¡Œç³»ç»Ÿæ€§çš„æŽ¢ç´¢æ¥å‘çŽ°<strong>å¯ä»¥ä»Žæºç»“ç‚¹såˆ°è¾¾çš„æ‰€æœ‰ç»“ç‚¹</strong>ã€‚è¯¥ç®—æ³•èƒ½å¤Ÿè®¡ç®—ä»Žæºç»“ç‚¹såˆ°æ¯ä¸ªå¯åˆ°è¾¾çš„ç»“ç‚¹çš„è·ç¦»ï¼ˆæœ€å°‘çš„è¾¹æ•°ï¼‰ï¼ŒåŒæ—¶ç”Ÿæˆä¸€æ£µâ€œå¹¿åº¦ä¼˜å…ˆæœç´¢æ ‘â€ã€‚è¯¥æ ‘ä»¥æºç»“ç‚¹sä¸ºæ ¹èŠ‚ç‚¹ï¼ŒåŒ…å«æ‰€æœ‰å¯ä»¥ä»Žsåˆ°è¾¾çš„ç»“ç‚¹ã€‚å¯¹äºŽæ¯ä¸ªä»Žæºç»“ç‚¹så¯ä»¥åˆ°è¾¾çš„ç»“ç‚¹vï¼Œåœ¨å¹¿åº¦ä¼˜å…ˆæœç´¢æ ‘é‡Œä»Žç»“ç‚¹såˆ°ç»“ç‚¹vçš„ç®€å•è·¯å¾„æ‰€å¯¹åº”çš„å°±æ˜¯å›¾Gä¸­ä»Žç»“ç‚¹såˆ°ç»“ç‚¹vçš„â€œæœ€çŸ­è·¯å¾„â€ï¼Œå³åŒ…å«æœ€å°‘è¾¹æ•°çš„è·¯å¾„ã€‚è¯¥ç®—æ³•æ—¢å¯ä»¥ç”¨äºŽæœ‰å‘å›¾ï¼Œä¹Ÿå¯ä»¥ç”¨äºŽæ— å‘å›¾ã€‚</p><p>å¹¿åº¦ä¼˜å…ˆæœç´¢ä¹‹æ‰€ä»¥å¦‚æ­¤å¾—åæ˜¯å› ä¸ºè¯¥ç®—æ³•å§‹ç»ˆæ˜¯å°†å·²å‘çŽ°ç»“ç‚¹å’Œæœªå‘çŽ°ç»“ç‚¹ä¹‹é—´çš„è¾¹ç•Œï¼Œæ²¿å…¶å¹¿åº¦æ–¹å‘å‘å¤–æ‰©å±•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç®—æ³•éœ€è¦åœ¨å‘çŽ°æ‰€æœ‰è·ç¦»æºç»“ç‚¹sä¸ºkçš„æ‰€æœ‰ç»“ç‚¹ä¹‹åŽï¼Œæ‰ä¼šå‘çŽ°è·ç¦»æºç»“ç‚¹sä¸ºk+1çš„å…¶ä»–ç»“ç‚¹</strong>ã€‚</p><h2 id="ç®—æ³•">ç®—æ³•</h2><p>ä¸ºäº†è·Ÿè¸ªç®—æ³•çš„è¿›å±•ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢åœ¨æ¦‚å¿µä¸Šå°†æ¯ä¸ªç»“ç‚¹æ¶‚ä¸Šç™½è‰²ã€ç°è‰²æˆ–é»‘è‰²ã€‚æ‰€æœ‰ç»“ç‚¹åœ¨ä¸€å¼€å§‹çš„æ—¶å€™æ¶‚ä¸Šç™½è‰²ã€‚åœ¨ç®—æ³•æŽ¨è¿›è¿‡ç¨‹ä¸­ï¼Œè¿™äº›ç»“ç‚¹å¯èƒ½ä¼šå˜æˆç°è‰²æˆ–é»‘è‰²ï¼ˆç°è‰²æˆ–é»‘è‰²ç»“ç‚¹ä¸ä¼šå˜å›žç™½è‰²ï¼‰ã€‚åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°ä¸€ä¸ªç»“ç‚¹å°±ç§°è¯¥ç»“ç‚¹è¢«â€œ<strong>å‘çŽ°</strong>â€ï¼Œæ­¤æ—¶è¯¥ç»“ç‚¹çš„é¢œè‰²å°†å‘ç”Ÿæ”¹å˜ã€‚å› æ­¤ï¼Œå‡¡æ˜¯ç°è‰²å’Œé»‘è‰²çš„ç»“ç‚¹éƒ½æ˜¯å·²è¢«å‘çŽ°çš„ç»“ç‚¹ã€‚</p><a id="more"></a><p>å¦‚æžœè¾¹<span class="math inline">\((u,v)\in{E}\)</span>ä¸”ç»“ç‚¹uæ˜¯é»‘è‰²ï¼Œåˆ™ç»“ç‚¹væ—¢å¯èƒ½æ˜¯ç°è‰²ä¹Ÿå¯èƒ½æ˜¯é»‘è‰²ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ä¸Žé»‘è‰²ç»“ç‚¹é‚»æŽ¥çš„ç»“ç‚¹éƒ½å·²ç»è¢«å‘çŽ°ã€‚å¯¹äºŽç°è‰²ç»“ç‚¹æ¥è¯´ï¼Œå…¶é‚»æŽ¥ç»“ç‚¹ä¸­å¯èƒ½å­˜åœ¨æœªè¢«å‘çŽ°çš„ç™½è‰²ç»“ç‚¹ã€‚ç°è‰²ç»“ç‚¹æ‰€ä»£è¡¨çš„å°±æ˜¯å·²çŸ¥å’ŒæœªçŸ¥ä¸¤ä¸ªé›†åˆä¹‹é—´çš„è¾¹ç•Œã€‚</p><p>åœ¨æ‰§è¡Œå¹¿åº¦ä¼˜å…ˆæœç´¢çš„è¿‡ç¨‹ä¸­å°†æž„é€ å‡ºä¸€æ£µå¹¿åº¦ä¼˜å…ˆæ ‘ã€‚ä¸€å¼€å§‹ï¼Œè¯¥æ ‘ä»…å«æœ‰æ ¹èŠ‚ç‚¹ï¼Œå°±æ˜¯æºç»“ç‚¹sã€‚åœ¨æ‰«æå·²å‘çŽ°ç»“ç‚¹uçš„é‚»æŽ¥é“¾è¡¨æ—¶ï¼Œæ¯å½“å‘çŽ°ä¸€ä¸ªç™½è‰²ç»“ç‚¹vï¼Œå°±å°†ç»“ç‚¹vå’Œè¾¹(u,v)åŒæ—¶åŠ å…¥è¯¥æ£µæ ‘ä¸­ã€‚åœ¨å¹¿åº¦ä¼˜å…ˆæ ‘ä¸­ï¼Œç§°ç»“ç‚¹uæ˜¯ç»“ç‚¹vçš„<strong>å‰é©±</strong>æˆ–è€…<strong>çˆ¶ç»“ç‚¹</strong>ã€‚ç”±äºŽæ¯ä¸ªç»“ç‚¹æœ€å¤šè¢«å‘çŽ°ä¸€æ¬¡ï¼Œå®ƒæœ€å¤šåªæœ‰ä¸€ä¸ªçˆ¶ç»“ç‚¹ã€‚å¹¿åº¦ä¼˜å…ˆæ ‘ä¸­çš„ç¥–å…ˆå’ŒåŽä»£å…³ç³»çš†ä»¥ç›¸å¯¹äºŽæ ¹èŠ‚ç‚¹sçš„ä½ç½®æ¥å®šä¹‰ï¼šå¦‚æžœç»“ç‚¹uæ˜¯ä»Žæ ¹èŠ‚ç‚¹såˆ°ç»“ç‚¹vçš„ç®€å•è·¯å¾„ä¸Šçš„ä¸€ä¸ªç»“ç‚¹ï¼Œåˆ™ç»“ç‚¹uæ˜¯ç»“ç‚¹vçš„ç¥–å…ˆï¼Œç»“ç‚¹væ˜¯ç»“ç‚¹uçš„åŽä»£ã€‚</p><p>åœ¨ä¸‹é¢ç»™å‡ºçš„ å¹¿åº¦ä¼˜å…ˆæœç´¢è¿‡ç¨‹BFSä¸­ï¼Œå‡å®šè¾“å…¥å›¾G=(V,E)æ˜¯ä»¥é‚»æŽ¥é“¾è¡¨æ‰€è¡¨ç¤ºçš„ã€‚è¯¥ç®—æ³•ä¸ºå›¾ä¸­æ¯ä¸ªç»“ç‚¹èµ‹äºˆäº†ä¸€äº›é¢å¤–çš„å±žæ€§ï¼š</p><ul><li>u.colorï¼šæ¯ä¸ªç»“ç‚¹uçš„é¢œè‰²ã€‚</li><li>u.piï¼šuçš„å‰é©±ç»“ç‚¹ï¼Œå¦‚æžœuæ²¡æœ‰å‰é©±ç»“ç‚¹ï¼Œåˆ™u.pi=NILã€‚</li><li>u.dï¼šBFSç®—æ³•æ‰€è®¡ç®—å‡ºçš„ä»Žæºç»“ç‚¹såˆ°ç»“ç‚¹uä¹‹é—´çš„è·ç¦»ã€‚</li></ul><p>è¯¥ç®—æ³•ä½¿ç”¨ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—Qæ¥ç®¡ç†ç°è‰²ç»“ç‚¹é›†ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">BFS(G, s):</span><br><span class="line">    <span class="keyword">for</span> each vertex u <span class="keyword">in</span> G.V-&#123;s&#125;:  <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        u.color = WHITE</span><br><span class="line">        u.d = infinity</span><br><span class="line">        u.pi = NIL</span><br><span class="line">    s.color = GRAY</span><br><span class="line">    s.d = <span class="number">0</span></span><br><span class="line">    s.pi = NIL</span><br><span class="line">    Q = &#123;&#125;</span><br><span class="line">    ENQUEUE(Q, s)</span><br><span class="line">    <span class="keyword">while</span> Q <span class="keyword">is</span> <span class="keyword">not</span> empty:</span><br><span class="line">        u = DEQUEUE(Q)</span><br><span class="line">        <span class="keyword">for</span> each v <span class="keyword">in</span> G.Adj[u]:</span><br><span class="line">            <span class="keyword">if</span> v.color == WHITE:</span><br><span class="line">                v.color = GRAY</span><br><span class="line">                v.d = u.d + <span class="number">1</span></span><br><span class="line">                v.pi = u</span><br><span class="line">                ENQUEUE(Q, v)</span><br><span class="line">        u.color = BLACK</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾æè¿°çš„æ˜¯BFSåœ¨ä¸€ä¸ªæ ·æœ¬å›¾ä¸Šçš„æŽ¨è¿›è¿‡ç¨‹ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/operation-of-BFS-on-an-undirected-graph.png" title="BFSåœ¨ä¸€ä¸ªæ— å‘å›¾ä¸Šçš„æŽ¨è¿›è¿‡ç¨‹"></p><h2 id="åˆ†æž">åˆ†æž</h2><p>æ¯ä¸ªç»“ç‚¹çš„å…¥é˜Ÿï¼ˆå½“å®ƒæ˜¯ç™½è‰²æ—¶ï¼‰æ¬¡æ•°æœ€å¤šä¸ºä¸€æ¬¡ï¼Œå› è€Œå‡ºé˜Ÿæœ€å¤šä¸€æ¬¡ã€‚å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ—¶é—´å‡ä¸ºO(1)ï¼Œå› æ­¤ï¼Œå¯¹é˜Ÿåˆ—è¿›è¡Œæ“ä½œçš„æ€»æ—¶é—´ä¸ºO(V)ã€‚å› ä¸ºç®—æ³•åªåœ¨ä¸€ä¸ªç»“ç‚¹å‡ºé˜Ÿçš„æ—¶å€™æ‰å¯¹è¯¥ç»“ç‚¹çš„é‚»æŽ¥é“¾è¡¨è¿›è¡Œæ‰«æï¼Œæ‰€ä»¥æ¯ä¸ªé‚»æŽ¥é“¾è¡¨æœ€å¤šåªæ‰«æä¸€æ¬¡ã€‚ç”±äºŽæ‰€æœ‰é‚»æŽ¥é“¾è¡¨çš„é•¿åº¦ä¹‹å’Œæ˜¯<span class="math inline">\(\Theta(E)\)</span>ï¼Œç”¨äºŽæ‰«æé‚»æŽ¥é“¾è¡¨çš„æ€»æ—¶é—´ä¸ºO(E)ã€‚åˆå§‹åŒ–æ“ä½œçš„æˆæœ¬æ˜¯O(V)ï¼Œå› æ­¤<strong>å¹¿åº¦ä¼˜å…ˆæœç´¢çš„æ€»è¿è¡Œæ—¶é—´ä¸º</strong>O(V+E)ã€‚å› æ­¤ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢çš„è¿è¡Œæ—¶é—´æ˜¯å›¾Gçš„é‚»æŽ¥é“¾è¡¨å¤§å°çš„ä¸€ä¸ªçº¿æ€§å‡½æ•°ã€‚</p><h2 id="ä»£ç ">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> networkx <span class="keyword">import</span> Graph</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_f</span><span class="params">(graph)</span>:</span></span><br><span class="line">    fmt = <span class="string">'&#123;0:&lt;10s&#125; &#123;1:&lt;10s&#125; &#123;2:&lt;10s&#125;\n'</span></span><br><span class="line">    title = fmt.format(<span class="string">'vertex'</span>, <span class="string">'distance'</span>, <span class="string">'previous'</span>)</span><br><span class="line">    data = <span class="string">''</span>.join(fmt.format(str(k), str(attr[<span class="string">'distance'</span>]), str(attr[<span class="string">'previous'</span>])) <span class="keyword">for</span> k, attr <span class="keyword">in</span> graph.nodes.items())</span><br><span class="line">    print(title + data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">breadth_first_search</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> graph.nodes.values():</span><br><span class="line">        attr[<span class="string">'visited'</span>], attr[<span class="string">'distance'</span>], attr[<span class="string">'previous'</span>] = <span class="literal">False</span>, float(<span class="string">'inf'</span>), <span class="literal">None</span></span><br><span class="line">    graph.nodes[s][<span class="string">'visited'</span>], graph.nodes[s][<span class="string">'distance'</span>], q = <span class="literal">True</span>, <span class="number">0</span>, Queue()</span><br><span class="line">    q.put(s)</span><br><span class="line">    <span class="keyword">while</span> q.empty() <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        u = q.get()</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> graph[u].keys():</span><br><span class="line">            v_attr, u_attr = graph.nodes[v], graph.nodes[u]</span><br><span class="line">            <span class="keyword">if</span> v_attr[<span class="string">'visited'</span>] <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">                v_attr[<span class="string">'visited'</span>], v_attr[<span class="string">'distance'</span>], v_attr[<span class="string">'previous'</span>] = <span class="literal">True</span>, u_attr[<span class="string">'distance'</span>] + <span class="number">1</span>, u</span><br><span class="line">                q.put(v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    g = Graph()</span><br><span class="line">    g.add_nodes_from(<span class="string">'rstuvwxy'</span>)</span><br><span class="line">    g.add_edges_from(</span><br><span class="line">        [(<span class="string">'r'</span>, <span class="string">'v'</span>), (<span class="string">'r'</span>, <span class="string">'s'</span>), (<span class="string">'s'</span>, <span class="string">'w'</span>), (<span class="string">'w'</span>, <span class="string">'t'</span>), (<span class="string">'w'</span>, <span class="string">'x'</span>), (<span class="string">'t'</span>, <span class="string">'x'</span>), (<span class="string">'t'</span>, <span class="string">'u'</span>), (<span class="string">'u'</span>, <span class="string">'x'</span>), (<span class="string">'u'</span>, <span class="string">'y'</span>),</span><br><span class="line">         (<span class="string">'x'</span>, <span class="string">'y'</span>)])</span><br><span class="line">    breadth_first_search(g, <span class="string">'s'</span>)</span><br><span class="line">    print_f(g)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vertex     distance   previous  </span><br><span class="line">r          1          s</span><br><span class="line">s          0          None</span><br><span class="line">t          2          w</span><br><span class="line">u          3          t</span><br><span class="line">v          2          r</span><br><span class="line">w          1          s</span><br><span class="line">x          2          w</span><br><span class="line">y          3          x</span><br></pre></td></tr></table></figure><h1 id="æ·±åº¦ä¼˜å…ˆæœç´¢">æ·±åº¦ä¼˜å…ˆæœç´¢</h1><p>æ·±åº¦ä¼˜å…ˆæœç´¢æ€»æ˜¯å¯¹æœ€è¿‘æ‰å‘çŽ°çš„ç»“ç‚¹vçš„å‡ºå‘è¾¹è¿›è¡Œæœç´¢ï¼Œç›´åˆ°è¯¥ç»“ç‚¹çš„æ‰€æœ‰å‡ºå‘è¾¹éƒ½è¢«å‘çŽ°ä¸ºæ­¢ã€‚ä¸€æ—¦ç»“ç‚¹vçš„æ‰€æœ‰å‡ºå‘è¾¹éƒ½è¢«å‘çŽ°ï¼Œæœç´¢åˆ™â€œå›žæº¯â€åˆ°vçš„å‰é©±ç»“ç‚¹ï¼Œæ¥æœç´¢è¯¥å‰é©±ç»“ç‚¹çš„å‡ºå‘è¾¹ã€‚è¯¥è¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°ä»Žæºç»“ç‚¹å¯ä»¥è¾¾åˆ°çš„æ‰€æœ‰ç»“ç‚¹éƒ½è¢«å‘çŽ°ä¸ºæ­¢ã€‚å¦‚æžœè¿˜å­˜åœ¨å°šæœªå‘çŽ°çš„ç»“ç‚¹ï¼Œåˆ™æ·±åº¦ä¼˜å…ˆæœç´¢å°†ä»Žè¿™äº›æœªè¢«å‘çŽ°çš„ç»“ç‚¹ä¸­ä»»é€‰ä¸€ä¸ªä½œä¸ºæ–°çš„æºç»“ç‚¹ï¼Œå¹¶é‡å¤åŒæ ·çš„æœç´¢è¿‡ç¨‹ã€‚è¯¥ç®—æ³•é‡å¤æ•´ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å›¾ä¸­çš„æ‰€æœ‰ç»“ç‚¹éƒ½è¢«å‘çŽ°ä¸ºæ­¢ã€‚</p><p>ä¸Žå¹¿åº¦ä¼˜å…ˆæœç´¢ä¸åŒçš„æ˜¯ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢çš„å‰é©±å­å›¾å½¢æˆä¸€æ£µæ ‘ï¼Œè€Œæ·±åº¦ä¼˜å…ˆæœç´¢çš„å‰é©±å­å›¾å¯èƒ½ç”±å¤šæ£µæ ‘ç»„æˆï¼Œå› ä¸ºæœç´¢å¯èƒ½ä»Žå¤šä¸ªæºç»“ç‚¹é‡å¤è¿›è¡Œã€‚æ·±åº¦ä¼˜å…ˆæœç´¢çš„å‰é©±å­å›¾å½¢æˆä¸€ä¸ªç”±å¤šæ£µ<strong>æ·±åº¦ä¼˜å…ˆæ ‘</strong>æž„æˆçš„<strong>æ·±åº¦ä¼˜å…ˆæ£®æž—</strong>ã€‚</p><h2 id="ç®—æ³•-1">ç®—æ³•</h2><p>åƒå¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ä¸€æ ·ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•åœ¨æœç´¢è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¯¹ç»“ç‚¹è¿›è¡Œæ¶‚è‰²æ¥æŒ‡æ˜Žç»“ç‚¹çš„çŠ¶æ€ã€‚æ¯ä¸ªç»“ç‚¹çš„åˆå§‹é¢œè‰²éƒ½æ˜¯ç™½è‰²ï¼Œåœ¨ç»“ç‚¹è¢«<strong>å‘çŽ°</strong>åŽå˜ä¸ºç°è‰²ï¼Œåœ¨å…¶é‚»æŽ¥é“¾è¡¨è¢«æ‰«æå®ŒæˆåŽå˜ä¸ºé»‘è‰²ã€‚è¯¥æ–¹æ³•å¯ä»¥ä¿è¯æ¯ä¸ªç»“ç‚¹ä»…åœ¨ä¸€æ£µæ·±åº¦ä¼˜å…ˆæ ‘ä¸­å‡ºçŽ°ï¼Œå› æ­¤ï¼Œæ‰€æœ‰çš„æ·±åº¦ä¼˜å…ˆæ ‘æ˜¯ä¸ç›¸äº¤çš„ï¼ˆdisjointï¼‰ã€‚</p><p>æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•è¿˜åœ¨æ¯ä¸ªç»“ç‚¹ç›–ä¸Šä¸€ä¸ª<strong>æ—¶é—´æˆ³</strong>ã€‚æ¯ä¸ªç»“ç‚¹væœ‰ä¸¤ä¸ªæ—¶é—´æˆ³ï¼šç¬¬ä¸€ä¸ªæ—¶é—´æˆ³v.dè®°å½•ç»“ç‚¹vç¬¬ä¸€æ¬¡è¢«å‘çŽ°çš„æ—¶é—´ï¼ˆæ¶‚ä¸Šç°è‰²çš„æ—¶å€™ï¼‰ï¼Œç¬¬äºŒä¸ªæ—¶é—´æˆ³v.fè®°å½•çš„æ˜¯æœç´¢å®Œæˆå¯¹vçš„é‚»æŽ¥é“¾è¡¨æ‰«æçš„æ—¶é—´ï¼ˆæ¶‚ä¸Šé»‘è‰²çš„æ—¶å€™ï¼‰ã€‚è¿™äº›æ—¶é—´æˆ³æä¾›äº†å›¾ç»“æž„çš„é‡è¦ä¿¡æ¯ï¼Œé€šå¸¸èƒ½å¤Ÿå¸®åŠ©æŽ¨æ–­æ·±åº¦ä¼˜å…ˆç®—æ³•çš„è¡Œä¸ºã€‚</p><p>å› ä¸º|V|ä¸ªç»“ç‚¹ä¸­æ¯ä¸ªç»“ç‚¹åªèƒ½æœ‰ä¸€ä¸ªå‘çŽ°äº‹ä»¶å’Œä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼Œæ‰€ä»¥è¿™äº›æ—¶é—´æˆ³éƒ½æ˜¯å¤„äºŽ1å’Œ2|V|ä¹‹é—´çš„æ•´æ•°ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¯¹äºŽæ¯ä¸ªç»“ç‚¹uï¼Œæˆ‘ä»¬æœ‰ï¼šu.d &lt; u.fã€‚ç»“ç‚¹uåœ¨æ—¶åˆ»u.dä¹‹å‰ä¸ºç™½è‰²ï¼Œåœ¨æ—¶åˆ»u.då’Œu.fä¹‹é—´ä¸ºç°è‰²ï¼Œåœ¨æ—¶åˆ»u.fä¹‹åŽä¸ºé»‘è‰²ã€‚</p><p>ä¸‹é¢çš„ä¼ªä»£ç ç»™å‡ºçš„æ˜¯åŸºæœ¬çš„æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ã€‚è¾“å…¥å›¾Gæ—¢å¯ä»¥æ˜¯æ— å‘å›¾ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ‰å‘å›¾ã€‚å˜é‡timeæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œç”¨æ¥è®¡ç®—æ—¶é—´æˆ³ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DFS(G):</span><br><span class="line">    <span class="keyword">for</span> each vertex u <span class="keyword">in</span> G.V:  <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        u.color = WHITE</span><br><span class="line">        u.pi = NIL</span><br><span class="line">    time = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> each vertex u <span class="keyword">in</span> G.V:</span><br><span class="line">        <span class="keyword">if</span> u.color == WHITE:</span><br><span class="line">            DFS-VISIT(G, u)  <span class="comment"># ä»¥uä¸ºæºç»“ç‚¹è¿›è¡Œæ·±åº¦ä¼˜å…ˆæŽ¢ç´¢</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DFS-VISIT(G, u):</span><br><span class="line">    time = time + <span class="number">1</span></span><br><span class="line">    u.d = time</span><br><span class="line">    u.color = GRAY            <span class="comment"># å‘çŽ°</span></span><br><span class="line">    <span class="keyword">for</span> each v <span class="keyword">in</span> G.Adj[u]:   <span class="comment"># æŽ¢ç´¢uçš„é‚»æŽ¥ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> v.color == WHITE:  <span class="comment"># è‹¥å‘çŽ°æ–°çš„æœªæŽ¢ç´¢ç»“ç‚¹</span></span><br><span class="line">            v.pi = u</span><br><span class="line">            DFS-VISIT(G, v)   <span class="comment"># ä¼˜å…ˆé€’å½’æŽ¢ç´¢æ–°çš„ç»“ç‚¹v</span></span><br><span class="line">            <span class="comment"># æŽ¢ç´¢å®ŒvåŽï¼Œå¾ªçŽ¯ç»§ç»­è¿›è¡Œï¼ŒæŽ¢ç´¢uçš„ä¸‹ä¸€ä¸ªé‚»æŽ¥ç»“ç‚¹</span></span><br><span class="line">    u.color = BLACK</span><br><span class="line">    time = time + <span class="number">1</span></span><br><span class="line">    u.f = time                <span class="comment"># æŽ¢ç´¢å®Œæˆ</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæ·±åº¦ä¼˜å…ˆç®—æ³•çš„ç»“æžœå¯èƒ½ä¾èµ–äºŽç®—æ³•DFSä¸­ç¬¬6è¡Œå¯¹ç»“ç‚¹è¿›è¡Œæ£€æŸ¥çš„æ¬¡åºå’Œç®—æ³•DFS-VISITä¸­çš„ç¬¬5è¡Œå¯¹ä¸€ä¸ªç»“ç‚¹çš„é‚»æŽ¥ç»“ç‚¹è¿›è¡Œè®¿é—®çš„æ¬¡åºã€‚ä¸è¿‡ï¼Œè¿™äº›ä¸åŒçš„è®¿é—®æ¬¡åºåœ¨å®žé™…ä¸­å¹¶ä¸ä¼šå¯¼è‡´é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸å¯ä»¥å¯¹ä»»æ„çš„æ·±åº¦ä¼˜å…ˆæœç´¢ç»“æžœåŠ ä»¥æœ‰æ•ˆåˆ©ç”¨ï¼Œå¹¶èŽ·å¾—ç­‰ä»·çš„ç»“æžœã€‚</p><p>ä¸‹å›¾å±•ç¤ºç®—æ³•DFSåœ¨æœ‰å‘å›¾ä¸Šçš„è¿è¡Œè¿‡ç¨‹ã€‚ç»“ç‚¹ä¸­çš„æ—¶é—´æˆ³è¡¨æ˜Žè¯¥ç»“ç‚¹çš„å‘çŽ°æ—¶é—´å’Œå®Œæˆæ—¶é—´ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/progress-of-the-depth-first-search-algorithm-DFS-on-a-directed-graph.png"></p><h2 id="åˆ†æž-1">åˆ†æž</h2><p>å¦‚æžœæŽ’é™¤è°ƒç”¨DFS-VISITçš„æ—¶é—´ï¼ŒDFSä¸­ä¸¤ä¸ªå¾ªçŽ¯æ‰€éœ€çš„æ—¶é—´å‡ä¸º<span class="math inline">\(\Theta(V)\)</span>ã€‚å¯¹æ¯ä¸ªç»“ç‚¹<span class="math inline">\(v\in{V}\)</span>æ¥è¯´ï¼ŒDFS-VISITè¢«è°ƒç”¨çš„æ¬¡æ•°åˆšå¥½ä¸º1æ¬¡ï¼Œè¿™æ˜¯å› ä¸ºåœ¨å¯¹ä¸€ä¸ªç»“ç‚¹uè°ƒç”¨DFS-VISITæ—¶ï¼Œè¯¥ç»“ç‚¹uå¿…é¡»æ˜¯ç™½è‰²ï¼Œè€ŒDFS-VISITæ‰€åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å°†ç»“ç‚¹uæ¶‚ä¸Šç°è‰²ã€‚åœ¨æ‰§è¡ŒDFS-VISIT(G, v)çš„è¿‡ç¨‹ä¸­ï¼Œ5~8è¡Œçš„å¾ªçŽ¯æ‰€æ‰§è¡Œçš„æ¬¡æ•°ä¸º|Adj[v]|ã€‚ç”±äºŽ<span class="math inline">\(\sum_{v\in{V}}|Adj[v]|=\Theta(E)\)</span>ï¼Œæ‰§è¡Œå¾ªçŽ¯æ“ä½œçš„æ€»æˆæœ¬æ˜¯<span class="math inline">\(\Theta(E)\)</span>ã€‚å› æ­¤ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(V+E)\)</span>ã€‚</p><h2 id="ä»£ç -1">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> networkx <span class="keyword">import</span> Graph, DiGraph</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_f</span><span class="params">(g)</span>:</span></span><br><span class="line">    fmt = <span class="string">'&#123;0:&lt;10s&#125; &#123;1:&lt;10s&#125; &#123;2:&lt;10s&#125;\n'</span></span><br><span class="line">    title = fmt.format(<span class="string">'vertex'</span>, <span class="string">'distance'</span>, <span class="string">'previous'</span>)</span><br><span class="line">    data = <span class="string">''</span>.join(fmt.format(str(k), str(attr[<span class="string">'distance'</span>]), str(attr[<span class="string">'previous'</span>])) <span class="keyword">for</span> k, attr <span class="keyword">in</span> g.nodes.items())</span><br><span class="line">    print(title + data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depth_first_search</span><span class="params">(g)</span>:</span>  <span class="comment"># å‡½æ•°å…¥å£</span></span><br><span class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> g.nodes.values():  <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        attr[<span class="string">'visited'</span>], attr[<span class="string">'previous'</span>] = <span class="literal">False</span>, <span class="literal">None</span></span><br><span class="line">    g.graph[<span class="string">'time'</span>] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> u, attr <span class="keyword">in</span> g.nodes.items():  <span class="comment"># é€’å½’æœç´¢æ— æ³•è®¿é—®åˆ°éžè¿žé€šçš„éƒ¨åˆ†ï¼Œé€šè¿‡æ­¤å¤„å¾ªçŽ¯è§£å†³</span></span><br><span class="line">        <span class="keyword">if</span> attr[<span class="string">'visited'</span>] <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            dfs_visit(g, u)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dfs_visit</span><span class="params">(g, u)</span>:</span>  <span class="comment"># é€’å½’æ–¹æ³•ä¸»ä½“</span></span><br><span class="line">    g.graph[<span class="string">'time'</span>] += <span class="number">1</span></span><br><span class="line">    g.nodes[u][<span class="string">'distance'</span>], g.nodes[u][<span class="string">'visited'</span>] = g.graph[<span class="string">'time'</span>], <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> g[u].keys():</span><br><span class="line">        <span class="keyword">if</span> g.nodes[v][<span class="string">'visited'</span>] <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            g.nodes[v][<span class="string">'previous'</span>] = u</span><br><span class="line">            dfs_visit(g, v)  <span class="comment"># é€’å½’</span></span><br><span class="line">    g.nodes[u][<span class="string">'visited'</span>] = <span class="literal">True</span></span><br><span class="line">    g.graph[<span class="string">'time'</span>] += <span class="number">1</span></span><br><span class="line">    g.nodes[u][<span class="string">'distance'</span>] = str(g.nodes[u][<span class="string">'distance'</span>]) + <span class="string">'/'</span> + str(g.graph[<span class="string">'time'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    h = DiGraph()</span><br><span class="line">    h.add_nodes_from(<span class="string">'uvwxyz'</span>)</span><br><span class="line">    h.add_edges_from([(<span class="string">'u'</span>, <span class="string">'v'</span>), (<span class="string">'u'</span>, <span class="string">'x'</span>), (<span class="string">'x'</span>, <span class="string">'v'</span>), (<span class="string">'v'</span>, <span class="string">'y'</span>), (<span class="string">'y'</span>, <span class="string">'x'</span>), (<span class="string">'w'</span>, <span class="string">'y'</span>), (<span class="string">'w'</span>, <span class="string">'z'</span>), (<span class="string">'z'</span>, <span class="string">'z'</span>)])</span><br><span class="line">    depth_first_search(h)</span><br><span class="line">    print_f(h)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vertex     distance   previous  </span><br><span class="line">u          1/8        None</span><br><span class="line">v          2/7        u</span><br><span class="line">w          9/12       None</span><br><span class="line">x          4/5        y</span><br><span class="line">y          3/6        v</span><br><span class="line">z          10/11      w</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> algorithms </tag>
            
            <tag> stack </tag>
            
            <tag> recursion </tag>
            
            <tag> queue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾çš„è¡¨ç¤º</title>
      <link href="/notes/introduction-to-algorithms/representations-of-graphs/"/>
      <url>/notes/introduction-to-algorithms/representations-of-graphs/</url>
      
        <content type="html"><![CDATA[<h1 id="å›¾çš„è¡¨ç¤º">å›¾çš„è¡¨ç¤º</h1><p>å¯¹äºŽå›¾G=(V,E)ï¼Œå¯ä»¥ç”¨ä¸¤ç§æ ‡å‡†è¡¨ç¤ºæ–¹æ³•è¡¨ç¤ºã€‚ä¸¤ç§è¡¨ç¤ºæ–¹æ³•éƒ½æ—¢å¯ä»¥è¡¨ç¤ºæ— å‘å›¾ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºæœ‰å‘å›¾ã€‚</p><ul><li><p><strong>é‚»æŽ¥é“¾è¡¨è¡¨ç¤º</strong>ï¼šå°†å›¾ä½œä¸ºé‚»æŽ¥é“¾è¡¨çš„ç»„åˆã€‚</p><p>åœ¨è¡¨ç¤º<strong>ç¨€ç–å›¾</strong>ï¼ˆè¾¹çš„æ¡æ•°|E|è¿œè¿œå°äºŽ<span class="math inline">\(|V|^2\)</span>çš„å›¾ï¼‰æ—¶éžå¸¸ç´§å‡‘è€Œæˆä¸ºé€šå¸¸çš„é€‰æ‹©ã€‚</p></li><li><p><strong>é‚»æŽ¥çŸ©é˜µè¡¨ç¤º</strong>ï¼šå°†å›¾ä½œä¸ºé‚»æŽ¥çŸ©é˜µæ¥çœ‹å¾…ã€‚</p><p>åœ¨<strong>ç¨ å¯†å›¾</strong>ï¼ˆ|E|æŽ¥è¿‘<span class="math inline">\(|V|^2\)</span>çš„å›¾ï¼‰çš„æƒ…å†µä¸‹ï¼Œå€¾å‘äºŽä½¿ç”¨é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºæ³•ã€‚å¦å¤–ï¼Œå¦‚æžœéœ€è¦å¿«é€Ÿåˆ¤æ–­ä»»æ„ä¸¤ä¸ªç»“ç‚¹ä¹‹é—´æ˜¯å¦æœ‰è¾¹ç›¸è¿žï¼Œå¯èƒ½ä¹Ÿéœ€è¦ä½¿ç”¨é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºæ³•ã€‚</p></li></ul><p><img src="/uploads/image/introduction-to-algorithms/two-representations-of-an-undirected-graph.png" title="æ— å‘å›¾çš„è¡¨ç¤ºæ–¹æ³•"></p><p><img src="/uploads/image/introduction-to-algorithms/two-representations-of-a-directed-graph.png" title="æœ‰å‘å›¾çš„è¡¨ç¤ºæ–¹æ³•"></p><a id="more"></a><h1 id="é‚»æŽ¥é“¾è¡¨è¡¨ç¤º">é‚»æŽ¥é“¾è¡¨è¡¨ç¤º</h1><p>å¦‚ä¸Šå›¾(b)æ‰€ç¤ºï¼šå¯¹äºŽå›¾G=(V,E)æ¥è¯´ï¼Œå…¶<strong>é‚»æŽ¥é“¾è¡¨è¡¨ç¤º</strong>ç”±ä¸€ä¸ªåŒ…å«|V|æ¡é“¾è¡¨çš„æ•°ç»„Adjæ‰€æž„æˆï¼Œæ¯ä¸ªç»“ç‚¹æœ‰ä¸€æ¡é“¾è¡¨ã€‚å¯¹äºŽæ¯ä¸ªç»“ç‚¹<span class="math inline">\(u\in{V}\)</span>ï¼Œé‚»æŽ¥é“¾è¡¨Adj[u]åŒ…å«æ‰€æœ‰ä¸Žç»“ç‚¹uä¹‹é—´æœ‰è¾¹ç›¸é‚»çš„ç»“ç‚¹vï¼Œå³Adj[u]åŒ…å«å›¾Gä¸­æ‰€æœ‰ä¸Žué‚»æŽ¥çš„ç»“ç‚¹ï¼ˆä¹Ÿå¯ä»¥è¯´ï¼Œè¯¥é“¾è¡¨é‡ŒåŒ…å«æŒ‡å‘è¿™äº›ç»“ç‚¹çš„æŒ‡é’ˆï¼‰ã€‚</p><p>å¦‚æžœGæ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œåˆ™å¯¹äºŽè¾¹(u,v)æ¥è¯´ï¼Œç»“ç‚¹vå°†å‡ºçŽ°åœ¨é“¾è¡¨Adj[u]é‡Œï¼Œå› æ­¤ï¼Œæ‰€æœ‰é‚»æŽ¥é“¾è¡¨çš„é•¿åº¦ä¹‹å’Œç­‰äºŽ|E|ã€‚å¦‚æžœGæ˜¯ä¸€ä¸ªæ— å‘å›¾ï¼Œåˆ™å¯¹äºŽè¾¹(u,v)æ¥è¯´ï¼Œç»“ç‚¹vå°†å‡ºçŽ°åœ¨é“¾è¡¨Adj[u]é‡Œï¼Œç»“ç‚¹uå°†å‡ºçŽ°åœ¨é“¾è¡¨Adj[v]é‡Œï¼Œå› æ­¤ï¼Œæ‰€æœ‰é‚»æŽ¥é“¾è¡¨çš„é•¿åº¦ä¹‹å’Œä¸º2|E|ã€‚ä½†ä¸ç®¡æ˜¯æœ‰å‘å›¾è¿˜æ˜¯æ— å‘å›¾ï¼Œé‚»æŽ¥é“¾è¡¨è¡¨ç¤ºæ³•çš„å­˜å‚¨ç©ºé—´éœ€æ±‚å‡ä¸º<span class="math inline">\(\Theta(V+E)\)</span>ã€‚</p><p>å¯¹é‚»æŽ¥é“¾è¡¨ç¨åŠ ä¿®æ”¹ï¼Œå³å¯ä»¥ç”¨æ¥è¡¨ç¤º<strong>æƒé‡å›¾</strong>ï¼Œæƒé‡å›¾æ˜¯å›¾ä¸­çš„æ¯æ¡è¾¹éƒ½å¸¦æœ‰ä¸€ä¸ªç›¸å…³çš„æƒé‡çš„å›¾ã€‚å¯ä»¥ç›´æŽ¥å°†è¾¹<span class="math inline">\((u,v)\in{E}\)</span>çš„æƒé‡å€¼w(u,v)å­˜æ”¾åœ¨ç»“ç‚¹uçš„é‚»æŽ¥é“¾è¡¨é‡Œã€‚ä»Žè¿™ç§æ„ä¹‰ä¸Šè¯´ï¼Œé‚»æŽ¥é“¾è¡¨è¡¨ç¤ºæ³•çš„é²æ£’æ€§å¾ˆé«˜ï¼Œå¯ä»¥é€šè¿‡å¯¹å…¶è¿›è¡Œç®€å•ä¿®æ”¹æ¥æ”¯æŒè®¸å¤šå…¶ä»–çš„å›¾å˜ç§ã€‚</p><p>é‚»æŽ¥é“¾è¡¨çš„ä¸€ä¸ªæ½œåœ¨ç¼ºé™·æ˜¯æ— æ³•å¿«é€Ÿåˆ¤æ–­ä¸€æ¡è¾¹(u,v)æ˜¯å¦æ˜¯å›¾ä¸­çš„ä¸€æ¡è¾¹ï¼Œå”¯ä¸€çš„åŠžæ³•æ˜¯åœ¨é‚»æŽ¥é“¾è¡¨Adj[u]é‡Œé¢æœç´¢ç»“ç‚¹vã€‚é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºåˆ™å…‹æœäº†è¿™ä¸ªç¼ºé™·ï¼Œä½†ä»˜å‡ºçš„ä»£ä»·æ˜¯æ›´å¤§çš„å­˜å‚¨ç©ºé—´æ¶ˆè€—ã€‚</p><h1 id="é‚»æŽ¥çŸ©é˜µè¡¨ç¤º">é‚»æŽ¥çŸ©é˜µè¡¨ç¤º</h1><p>å¯¹äºŽ<strong>é‚»æŽ¥çŸ©é˜µè¡¨ç¤º</strong>æ¥è¯´ï¼Œé€šå¸¸ä¼šå°†å›¾Gä¸­çš„ç»“ç‚¹ç¼–ä¸º<code>1,2,...,|V|</code>ï¼Œè¿™ç§ç¼–å·å¯ä»¥æ˜¯ä»»æ„çš„ã€‚åœ¨è¿›è¡Œæ­¤ç§ç¼–å·ä¹‹åŽï¼Œå›¾Gçš„é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºç”±ä¸€ä¸ª<span class="math inline">\(|V|\times|V|\)</span>çš„çŸ©é˜µ<span class="math inline">\(A=(a_{ij})\)</span>äºˆä»¥è¡¨ç¤ºï¼Œè¯¥çŸ©é˜µæ»¡è¶³ä¸‹è¿°æ¡ä»¶ï¼š <span class="math display">\[a_{ij}=\begin{cases}1\quad\text{if }(i,j)\in{E}\\0\quad\text{otherwise}\end{cases}\]</span> å›¾(c)ç»™å‡ºçš„æ˜¯å›¾(a)çš„é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºã€‚ä¸ç®¡ä¸€ä¸ªå›¾ä¸­ç”±å¤šå°‘æ¡è¾¹ï¼Œé‚»æŽ¥çŸ©é˜µçš„ç©ºé—´éœ€æ±‚çš†ä¸º<span class="math inline">\(\Theta(V^2)\)</span>ã€‚</p><p>æ— å‘å›¾çš„é‚»æŽ¥çŸ©é˜µæ˜¯ä¸€ä¸ªå¯¹ç§°çŸ©é˜µã€‚ç”±äºŽåœ¨æ— å‘å›¾ä¸­ï¼Œè¾¹(u,v)å’Œè¾¹(v,u)æ˜¯åŒä¸€æ¡è¾¹ï¼Œæ— å‘å›¾çš„é‚»æŽ¥çŸ©é˜µAå°±æ˜¯è‡ªå·±çš„è½¬ç½®ï¼Œå³<span class="math inline">\(A=A^T\)</span>ã€‚åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œå¯èƒ½åªéœ€è¦å­˜æ”¾å¯¹è§’çº¿åŠå…¶ä»¥ä¸Šçš„è¿™éƒ¨åˆ†é‚»æŽ¥çŸ©é˜µï¼ˆå³åŠä¸ªçŸ©é˜µï¼‰ï¼Œä»Žè€Œå°†å›¾å­˜å‚¨ç©ºé—´éœ€è¦å‡å°‘å‡ ä¹Žä¸€åŠã€‚</p><p>ä¸Žé‚»æŽ¥é“¾è¡¨è¡¨ç¤ºæ³•ä¸€æ ·ï¼Œé‚»æŽ¥çŸ©é˜µä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºæƒé‡å›¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœG=(V,E)ä¸ºä¸€ä¸ªæƒé‡å›¾ï¼Œåˆ™ç›´æŽ¥å°†è¾¹<span class="math inline">\((u,v)\in{E}\)</span>çš„æƒé‡w(u,v)å­˜æ”¾åœ¨é‚»æŽ¥çŸ©é˜µä¸­çš„ç¬¬uè¡Œç¬¬våˆ—è®°å½•ä¸Šã€‚å¯¹äºŽä¸å­˜åœ¨çš„è¾¹ï¼Œåˆ™åœ¨ç›¸åº”çš„è¡Œåˆ—è®°å½•ä¸Šå­˜æ”¾å€¼NILã€‚ä¸è¿‡ï¼Œå¯¹äºŽè®¸å¤šé—®é¢˜æ¥è¯´ï¼Œç”¨0æˆ–<span class="math inline">\(\infty\)</span>æ¥è¡¨ç¤ºä¸€æ¡ä¸å­˜åœ¨çš„è¾¹å¯èƒ½æ›´ä¸ºä¾¿æ·ã€‚</p><p>é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºæ³•æ›´ä¸ºç®€å•ï¼Œå› æ­¤åœ¨å›¾è§„æ¨¡æ¯”è¾ƒå°æ—¶ï¼Œå¯èƒ½æ›´å€¾å‘äºŽä½¿ç”¨é‚»æŽ¥çŸ©é˜µè¡¨ç¤ºæ³•ã€‚</p><p>è€Œä¸”ï¼Œå¯¹äºŽæ— å‘å›¾æ¥è¯´ï¼Œé‚»æŽ¥çŸ©é˜µè¿˜æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼šæ¯ä¸ªçºªå½•é¡¹åªéœ€è¦1ä½ç©ºé—´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> graph </tag>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> adjacent list </tag>
            
            <tag> adjacent matrix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å°è´¹ç”¨æµé—®é¢˜</title>
      <link href="/notes/minimum-cost-flow-problems/"/>
      <url>/notes/minimum-cost-flow-problems/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ€å°è´¹ç”¨æµé—®é¢˜">æœ€å°è´¹ç”¨æµé—®é¢˜</h1><p>æœ€å°è´¹ç”¨æµé—®é¢˜ï¼ˆMCFPï¼‰è¯•å›¾åœ¨ä¸€ä¸ªæµç½‘ç»œä¸­å¯»æ‰¾å‘é€æŒ‡å®šæµé‡çš„æœ€ä¾¿å®œçš„å¯è¡Œæ–¹æ¡ˆã€‚ä¸€ä¸ªå…¸åž‹çš„åº”ç”¨æ˜¯å¯»æ‰¾å·¥åŽ‚åˆ°ä»“åº“ä¹‹é—´çš„æœ€ä½³é…é€è·¯å¾„ï¼Œæ¯æ®µè·¯çº¿éƒ½æœ‰ç›¸åº”çš„å®¹é‡å’Œè´¹ç”¨ã€‚</p><p><strong>å®šä¹‰</strong></p><p>æœ‰å‘å›¾G=(V,E)å®šä¹‰çš„æµç½‘ç»œä¸­ï¼Œæºç»“ç‚¹ä¸º<span class="math inline">\(s\in{V}\)</span>ï¼Œæ±‡ç‚¹ä¸ºtï¼Œæ¯æ¡è¾¹<span class="math inline">\((u,v)\in{E}\)</span>æœ‰å®¹é‡c(u,v)&gt;0ï¼Œæµ<span class="math inline">\(f(u,v)\ge0\)</span>å’Œä»£ä»·a(u,v)ï¼ˆä»£ä»·å¯ä»¥ä¸ºè´Ÿï¼‰ã€‚æ²¿æŸæ¡è¾¹(u,v)å‘é€æµé‡çš„ä»£ä»·ä¸ºf(u,v)*a(u,v)ã€‚é—®é¢˜è¦æ±‚ä»Žæºç»“ç‚¹så‘é€æŒ‡å®šå¤§å°çš„æµé‡dåˆ°æ±‡ç‚¹tã€‚æœ€å°è´¹ç”¨æµé—®é¢˜è¯•å›¾æœ€å°åŒ–æ‰€æœ‰è¾¹çš„æ€»ä»£ä»·ï¼š<span class="math inline">\(\sum_{(u,v)\in{E}}a(u,v)*f(u,v)\)</span></p><p>æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ï¼š</p><ul><li>å®¹é‡é™åˆ¶ï¼šå¯¹äºŽæ‰€æœ‰çš„ç»“ç‚¹<span class="math inline">\(u,v\in{V}\)</span>ï¼Œè¦æ±‚<span class="math inline">\(0\le{f(u,v)}\le{c(u,v)}\)</span>ã€‚</li><li>æµé‡å®ˆæ’ï¼šå¯¹äºŽæ‰€æœ‰çš„ç»“ç‚¹<span class="math inline">\(u\in{V-\lbrace{s,t}\rbrace}\)</span>ï¼Œè¦æ±‚<span class="math inline">\(\sum_{v\in{V}}f(v,u)=\sum_{v\in{V}}f(uï¼Œv)\)</span>ã€‚</li><li>æµé‡è¦æ±‚ï¼š<span class="math inline">\(\sum_{v\in{V}}f(s,v)=d\quad\text{and}\quad\sum_{v\in{V}}f(v,t)=d\)</span>ã€‚</li></ul><h1 id="è´ŸæƒçŽ¯è·¯æ¶ˆé™¤æ³•">è´ŸæƒçŽ¯è·¯æ¶ˆé™¤æ³•</h1><p>è´ŸæƒçŽ¯è·¯æ˜¯æŒ‡æœ‰å‘å›¾G=(V,E)ä¸­çš„çŽ¯è·¯ä¸”æž„æˆçŽ¯è·¯çš„æ‰€æœ‰è¾¹çš„æƒé‡ä¹‹å’Œä¸ºè´Ÿæ•°å€¼ã€‚</p><a id="more"></a><h2 id="æ®‹å­˜ç½‘ç»œ">æ®‹å­˜ç½‘ç»œ</h2><p>å‡å®šç”±ä¸€ä¸ªæµç½‘ç»œG=(V,E)ï¼Œå…¶æºç»“ç‚¹ä¸ºsï¼Œæ±‡ç‚¹ä¸ºtã€‚è®¾fä¸ºå›¾Gä¸­çš„ä¸€ä¸ªæµï¼Œè€ƒè™‘ç»“ç‚¹å¯¹<span class="math inline">\(u,v\in{V}\)</span>ï¼Œå®šä¹‰æ®‹å­˜å®¹é‡<span class="math inline">\(c_f(u,v)\)</span>å¦‚ä¸‹ï¼š <span class="math display">\[c_f(u,v)=\begin{cases}c(u,v)-f(u,v)&amp;\text{if }(u,v)\in{E}\\f(v,u)&amp;\text{if }(v,u)\in{E}\\0&amp;otherwise\end{cases}\]</span> å®šä¹‰æ®‹å­˜ç½‘ç»œä»£ä»·<span class="math inline">\(a_f(u,v)\)</span>å¦‚ä¸‹ï¼š <span class="math display">\[a_f(u,v)=\begin{cases}a(u,v)&amp;\text{if }(u,v)\in{E}\\-a(u,v)&amp;\text{if }(v,u)\in{E}\\0&amp;otherwise\end{cases}\]</span> è´ŸæƒçŽ¯è·¯æ¶ˆé™¤æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨æ®‹å­˜ç½‘ç»œä¸­å¯»æ‰¾ä»Žæºç»“ç‚¹så¯è¾¾çš„è´ŸæƒçŽ¯è·¯ï¼Œç„¶åŽæ²¿çŽ¯è·¯å‘é€æµé‡ã€‚ç›´åˆ°æ®‹å­˜ç½‘è·¯ä¸­ä¸å­˜åœ¨ä»Žæºç»“ç‚¹så¯è¾¾çš„è´ŸæƒçŽ¯è·¯ä¸ºæ­¢ã€‚ç®—æ³•çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li>è®¾G=(V,E)ä¸ºä¸€ä¸ªæµç½‘ç»œï¼Œæ±‚å‡ºå€¼ä¸ºdçš„ä¸€ä¸ªæµã€‚é€šè¿‡ä¿®æ”¹æœ€å¤§æµçš„Ford-Fulkersonç®—æ³•ï¼Œå¯ä»¥æ±‚å‡ºå€¼ä¸ºdçš„ä¸€ä¸ªæµã€‚</li><li>åœ¨æ®‹å­˜ç½‘ç»œä¸­å¯»æ‰¾ä»Žæºç»“ç‚¹så¯è¾¾çš„è´ŸæƒçŽ¯è·¯ã€‚å•æºæœ€çŸ­è·¯å¾„ç®—æ³•çš„Bellman-Fordç®—æ³•å¯ä»¥æ£€æµ‹å›¾G=(V,E)ä¸­æ˜¯å¦å«æœ‰è´ŸæƒçŽ¯è·¯ï¼Œé€šè¿‡ä¿®æ”¹Bellman-Fordç®—æ³•å¯ä»¥æ±‚å‡ºè¯¥çŽ¯è·¯ã€‚</li><li>è‹¥å­˜åœ¨ï¼Œæ²¿çŽ¯è·¯å‘é€æµé‡ï¼Œè¿”å›žæ­¥éª¤2ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™å½“å‰ç½‘ç»œä¸­çš„æµä¸ºæœ€ä½³æ–¹æ¡ˆã€‚</li></ol><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> graph.max_flow <span class="keyword">import</span> find_path</span><br><span class="line"><span class="keyword">from</span> graph.bellman_ford <span class="keyword">import</span> initialize_single_source, relax</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_f</span><span class="params">(graph)</span>:</span></span><br><span class="line">    print(<span class="string">'min cost:'</span>, graph.graph[<span class="string">'min_cost'</span>])</span><br><span class="line">    fmt = <span class="string">'&#123;0:&lt;4s&#125; &#123;1:&lt;4s&#125; &#123;2:&lt;4s&#125; &#123;3:&lt;4s&#125; &#123;4:&lt;8s&#125;\n'</span></span><br><span class="line">    title = fmt.format(<span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'flow'</span>, <span class="string">'cost'</span>, <span class="string">'capacity'</span>)</span><br><span class="line">    data = <span class="string">''</span>.join(</span><br><span class="line">        fmt.format(str(u), str(v), str(attr[<span class="string">'flow'</span>]), str(attr[<span class="string">'cost'</span>]), str(attr[<span class="string">'capacity'</span>]))</span><br><span class="line">        <span class="keyword">for</span> u, v, attr <span class="keyword">in</span> graph.edges(data=<span class="literal">True</span>) <span class="keyword">if</span> attr[<span class="string">'flow'</span>] &gt; <span class="number">0</span>)</span><br><span class="line">    print(title + data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flow</span><span class="params">(graph, s, t, f)</span>:</span></span><br><span class="line">    <span class="string">"""æ±‚å‡ºä»»æ„ä¸€ä¸ªå€¼ä¸ºfçš„æµ"""</span></span><br><span class="line">    p = find_path(graph, s, t, set())</span><br><span class="line">    <span class="keyword">while</span> p <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        residual = [graph[u][v][<span class="string">'capacity'</span>] - graph[u][v][<span class="string">'flow'</span>] <span class="keyword">for</span> u, v <span class="keyword">in</span> p]</span><br><span class="line">        augment_flow = min(min(residual), f)</span><br><span class="line">        <span class="keyword">for</span> u, v <span class="keyword">in</span> p:</span><br><span class="line">            graph[u][v][<span class="string">'flow'</span>] += augment_flow</span><br><span class="line">            graph[v][u][<span class="string">'flow'</span>] -= augment_flow</span><br><span class="line">        f -= augment_flow</span><br><span class="line">        <span class="keyword">if</span> f == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        p = find_path(graph, s, t, set())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bellman_ford</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    initialize_single_source(graph, s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(graph.number_of_nodes() - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> u, v, e_attr <span class="keyword">in</span> graph.edges(data=<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">if</span> e_attr[<span class="string">'capacity'</span>] - e_attr[<span class="string">'flow'</span>] &gt; <span class="number">0</span>:  <span class="comment"># åªæœ‰æ­¤å€¼å¤§äºŽ0çš„è¾¹å­˜åœ¨äºŽæ®‹å­˜ç½‘ç»œä¸­</span></span><br><span class="line">                relax(graph, u, v, e_attr[<span class="string">'cost'</span>])</span><br><span class="line">    <span class="keyword">for</span> u, v, e_attr <span class="keyword">in</span> graph.edges(data=<span class="literal">True</span>):</span><br><span class="line">        residual = e_attr[<span class="string">'capacity'</span>] - e_attr[<span class="string">'flow'</span>]</span><br><span class="line">        <span class="keyword">if</span> residual &gt; <span class="number">0</span> <span class="keyword">and</span> graph.nodes[v][<span class="string">'distance'</span>] &gt; graph.nodes[u][<span class="string">'distance'</span>] + e_attr[<span class="string">'cost'</span>]:</span><br><span class="line">            <span class="comment"># å½“å­˜åœ¨è´ŸæƒçŽ¯è·¯æ—¶ï¼Œè¿”å›žä»ŽçŽ¯è·¯å¯è¾¾çš„ä¸€ä¸ªç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">return</span> u</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_negative_cycle</span><span class="params">(graph, v, cycle)</span>:</span></span><br><span class="line">    <span class="string">"""æ ¹æ®previouså±žæ€§æ‰¾å‡ºçŽ¯è·¯"""</span></span><br><span class="line">    <span class="comment"># å…ˆæ‰¾åˆ°çŽ¯è·¯ä¸­ä»»ä¸€ç»“ç‚¹</span></span><br><span class="line">    visit = &#123;v&#125;</span><br><span class="line">    pre = graph.nodes[v][<span class="string">'previous'</span>]  <span class="comment"># å‰é©±ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> pre <span class="keyword">not</span> <span class="keyword">in</span> visit:</span><br><span class="line">        visit.add(pre)</span><br><span class="line">        pre = graph.nodes[pre][<span class="string">'previous'</span>]</span><br><span class="line">    <span class="comment"># é€šè¿‡previousæ‰¾å‡ºçŽ¯è·¯</span></span><br><span class="line">    anchor = pre</span><br><span class="line">    end, start = pre, graph.nodes[pre][<span class="string">'previous'</span>]</span><br><span class="line">    <span class="keyword">while</span> start != anchor:</span><br><span class="line">        cycle.append((start, end))</span><br><span class="line">        end = start</span><br><span class="line">        start = graph.nodes[start][<span class="string">'previous'</span>]</span><br><span class="line">    cycle.append((start, end))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">negative_cycle_canceling</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    key = bellman_ford(graph, s)  <span class="comment"># bellman fordæ±‚æœ€çŸ­è·¯å¾„çš„æ–¹å¼å¯»æ‰¾çŽ¯è·¯</span></span><br><span class="line">    <span class="keyword">while</span> key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        cycle = []</span><br><span class="line">        get_negative_cycle(graph, key, cycle)</span><br><span class="line">        cancel_flow = min(graph[u][v][<span class="string">'capacity'</span>] - graph[u][v][<span class="string">'flow'</span>] <span class="keyword">for</span> u, v <span class="keyword">in</span> cycle)  <span class="comment"># ä¿®æ”¹çŽ¯è·¯ä¸Šçš„æµé‡</span></span><br><span class="line">        <span class="keyword">for</span> u, v <span class="keyword">in</span> cycle:</span><br><span class="line">            graph[u][v][<span class="string">'flow'</span>] += cancel_flow</span><br><span class="line">            graph[v][u][<span class="string">'flow'</span>] -= cancel_flow</span><br><span class="line">        key = bellman_ford(graph, s)  <span class="comment"># é‡æ–°å¯»æ‰¾çŽ¯è·¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">min_cost</span><span class="params">(graph, s, t, d)</span>:</span></span><br><span class="line">    <span class="string">"""æ±‚è§£æµé‡å€¼ä¸ºdçš„æœ€å°è´¹ç”¨æµ"""</span></span><br><span class="line">    flow(graph, s, t, d)  <span class="comment"># å…ˆæ‰¾åˆ°ä¸€ä¸ªå¯è¡Œè§£ï¼Œå½“då¤§äºŽæœ€å¤§æµé‡æ—¶ï¼Œæ‰¾åˆ°çš„å¯è¡Œè§£æ˜¯æœ€å¤§æµé‡</span></span><br><span class="line">    negative_cycle_canceling(graph, s)  <span class="comment"># ç§»é™¤è´ŸæƒçŽ¯è·¯</span></span><br><span class="line">    graph.graph[<span class="string">'min_cost'</span>] = sum(attr[<span class="string">'flow'</span>] * attr[<span class="string">'cost'</span>] <span class="keyword">for</span> attr <span class="keyword">in</span> graph.edges.values() <span class="keyword">if</span> attr[<span class="string">'flow'</span>] &gt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize_graph</span><span class="params">(graph, vertices, edges)</span>:</span></span><br><span class="line">    graph.add_nodes_from(vertices)</span><br><span class="line">    <span class="keyword">for</span> u, v, cap, cost <span class="keyword">in</span> edges:</span><br><span class="line">        graph.add_edges_from([(u, v, &#123;<span class="string">'capacity'</span>: cap, <span class="string">'cost'</span>: cost&#125;), (v, u, &#123;<span class="string">'capacity'</span>: <span class="number">0</span>, <span class="string">'cost'</span>: -cost&#125;)], flow=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    g = nx.DiGraph()</span><br><span class="line">    v = <span class="string">'s1234t'</span></span><br><span class="line">    e = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">10</span>, <span class="number">2</span>), (<span class="string">'s'</span>, <span class="string">'3'</span>, <span class="number">35</span>, <span class="number">4</span>), (<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="number">20</span>, <span class="number">6</span>), (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="number">10</span>, <span class="number">1</span>), (<span class="string">'2'</span>, <span class="string">'t'</span>, <span class="number">35</span>, <span class="number">2</span>),</span><br><span class="line">         (<span class="string">'3'</span>, <span class="string">'2'</span>, <span class="number">5</span>, <span class="number">6</span>), (<span class="string">'3'</span>, <span class="string">'4'</span>, <span class="number">30</span>, <span class="number">2</span>), (<span class="string">'4'</span>, <span class="string">'2'</span>, <span class="number">15</span>, <span class="number">2</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">10</span>, <span class="number">7</span>)]</span><br><span class="line">    initialize_graph(g, v, e)</span><br><span class="line">    min_cost(g, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="number">20</span>)</span><br><span class="line">    print_f(g)</span><br><span class="line"></span><br><span class="line">    g.clear()</span><br><span class="line">    e = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">16</span>, <span class="number">3</span>), (<span class="string">'s'</span>, <span class="string">'2'</span>, <span class="number">13</span>, <span class="number">4</span>), (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="number">12</span>, <span class="number">7</span>), (<span class="string">'2'</span>, <span class="string">'1'</span>, <span class="number">4</span>, <span class="number">3</span>), (<span class="string">'2'</span>, <span class="string">'4'</span>, <span class="number">14</span>, <span class="number">6</span>),</span><br><span class="line">         (<span class="string">'3'</span>, <span class="string">'2'</span>, <span class="number">9</span>, <span class="number">5</span>), (<span class="string">'3'</span>, <span class="string">'t'</span>, <span class="number">20</span>, <span class="number">6</span>), (<span class="string">'4'</span>, <span class="string">'3'</span>, <span class="number">7</span>, <span class="number">8</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">4</span>, <span class="number">9</span>)]</span><br><span class="line">    initialize_graph(g, v, e)</span><br><span class="line">    min_cost(g, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="number">19</span>)</span><br><span class="line">    print_f(g)</span><br></pre></td></tr></table></figure><p>ç»“æžœ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">min cost: 195</span><br><span class="line">u    v    flow cost capacity</span><br><span class="line">s    1    10   2    10</span><br><span class="line">s    3    10   4    35</span><br><span class="line">1    2    5    6    20</span><br><span class="line">1    3    5    1    10</span><br><span class="line">2    t    20   2    35</span><br><span class="line">3    4    15   2    30</span><br><span class="line">4    2    15   2    15</span><br><span class="line"></span><br><span class="line">min cost: 340</span><br><span class="line">u    v    flow cost capacity</span><br><span class="line">s    1    12   3    16</span><br><span class="line">s    2    7    4    13</span><br><span class="line">1    3    12   7    12</span><br><span class="line">2    4    7    6    14</span><br><span class="line">3    t    15   6    20</span><br><span class="line">4    3    3    8    7</span><br><span class="line">4    t    4    9    4</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithms </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å¤§å­æ•°ç»„é—®é¢˜</title>
      <link href="/notes/introduction-to-algorithms/maximum-subarray-problems/"/>
      <url>/notes/introduction-to-algorithms/maximum-subarray-problems/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ€å¤§åŒ–æ”¶ç›Š">æœ€å¤§åŒ–æ”¶ç›Š</h1><p>å‡è®¾ä½ çŸ¥é“äº†æœªæ¥ 17 å¤©æŸå…¬å¸çš„è‚¡ç¥¨ä»·æ ¼ï¼Œä½ çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–æ”¶ç›Šã€‚</p><ul><li>ä½ å¯èƒ½è®¤ä¸ºå¯ä»¥â€œä½Žä»·ä¹°è¿›ï¼Œé«˜ä»·å–å‡ºâ€â€”â€”åœ¨æœ€ä½Žä»·æ ¼æ—¶ä¹°è¿›è‚¡ç¥¨ï¼Œä¹‹åŽåœ¨æœ€é«˜ä»·æ ¼æ—¶å–å‡ºï¼Œè¿™æ ·å¯ä»¥æœ€å¤§åŒ–æ”¶ç›Šã€‚ä½†é—æ†¾çš„æ˜¯ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå¯èƒ½æ— æ³•åšåˆ°åœ¨æœ€ä½Žä»·æ ¼æ—¶ä¹°è¿›è‚¡ç¥¨ï¼Œç„¶åŽåœ¨æœ€é«˜ä»·æ ¼æ—¶å–å‡ºã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾ä¸­ï¼Œæœ€ä½Žä»·åœ¨åŽï¼Œæœ€é«˜ä»·åœ¨å‰ã€‚</li></ul><p><img src="/uploads/image/introduction-to-algorithms/maximum-subarray-problem-price-of-stock.png" title="æœªæ¥ 17 å¤©è‚¡ç¥¨ä»·æ ¼"></p><a id="more"></a><ul><li>ä½ è¿˜å¯èƒ½è®¤ä¸ºå¯ä»¥åœ¨æœ€ä½Žä»·æ ¼æ—¶ä¹°è¿›ï¼Œæˆ–åœ¨æœ€é«˜ä»·æ ¼æ—¶å–å‡ºï¼Œå³å¯æœ€å¤§åŒ–æ”¶ç›Šã€‚å¦‚æžœè¿™ç§ç­–ç•¥æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ™ç¡®å®šæœ€å¤§åŒ–æ”¶ç›Šæ˜¯éžå¸¸ç®€å•çš„ï¼šå¯»æ‰¾æœ€é«˜å’Œæœ€ä½Žä»·æ ¼ï¼Œç„¶åŽä»Žæœ€é«˜ä»·æ ¼å¼€å§‹å‘å·¦å¯»æ‰¾ä¹‹å‰çš„æœ€ä½Žä»·æ ¼ï¼›ä»Žæœ€ä½Žä»·æ ¼å¼€å§‹å‘å³å¯»æ‰¾ä¹‹åŽçš„æœ€é«˜ä»·æ ¼ï¼›å–ä¸¤å¯¹ä»·æ ¼ä¸­å·®å€¼æœ€å¤§è€…ã€‚ä¾‹å¦‚ä¸Šå›¾ä¸­ï¼Œåœ¨ç¬¬ 7 å¤©è‚¡ç¥¨ä»·æ ¼æœ€ä½Žæ—¶ä¹°å…¥ï¼Œå³å¯æœ€å¤§åŒ–æ”¶ç›Šã€‚ä½†ä¸‹å›¾ç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„åä¾‹ï¼Œæ˜¾ç¤ºæœ‰æ—¶æœ€å¤§æ”¶ç›Šæ—¢ä¸æ˜¯åœ¨æœ€ä½Žä»·æ ¼æ—¶ä¹°è¿›ï¼Œä¹Ÿä¸æ˜¯åœ¨æœ€é«˜ä»·æ ¼æ—¶å–å‡ºã€‚</li></ul><p><img src="/uploads/image/introduction-to-algorithms/maximum-subarray-problem-a-counter-example.png" title="ä¸€ä¸ªåä¾‹ï¼šæœ€å¤§æ”¶ç›Šæ—¢ä¸æ˜¯åœ¨æœ€ä½Žä»·æ ¼æ—¶ä¹°è¿›ï¼Œä¹Ÿä¸æ˜¯åœ¨æœ€é«˜ä»·æ ¼æ—¶å–å‡º"></p><p>æš´åŠ›æ±‚è§£æ–¹æ³•ï¼š</p><p>å°è¯•æ¯å¯¹å¯èƒ½çš„ä¹°è¿›å’Œå–å‡ºæ—¥æœŸç»„åˆï¼Œåªè¦å–å‡ºæ—¥æœŸåœ¨ä¹°è¿›æ—¥æœŸä¹‹åŽå³å¯ã€‚n å¤©ä¸­å…±æœ‰ <span class="math inline">\(\begin{pmatrix}n\\2\end{pmatrix}=\Theta(n^2)\)</span> ç§æ—¥æœŸç»„åˆã€‚å¤„ç†æ¯å¯¹æ—¥æœŸæ‰€èŠ±è´¹çš„æ—¶é—´è‡³å°‘ä¹Ÿæ˜¯å¸¸é‡ï¼Œå› æ¬¡è¿™ç§æ–¹æ³•çš„è¿è¡Œæ—¶é—´ä¸º <span class="math inline">\(\Omega(n^2)\)</span>ã€‚</p><h1 id="æœ€å¤§å­æ•°ç»„é—®é¢˜">æœ€å¤§å­æ•°ç»„é—®é¢˜</h1><p>ä»Žä¸€ä¸ªç¨å¾®ä¸åŒçš„è§’åº¦æ¥çœ‹å¾…è¾“å…¥æ•°æ®ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯å¯»æ‰¾ä¸€æ®µæ—¥æœŸï¼Œä½¿å¾—ä»Žç¬¬ä¸€å¤©åˆ°æœ€åŽä¸€å¤©çš„è‚¡ç¥¨ä»·æ ¼å‡€å˜å€¼æœ€å¤§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å†ä»Žæ¯æ—¥ä»·æ ¼çš„è§’åº¦æ¥çœ‹å¾…è¾“å…¥æ•°æ®ï¼Œè€Œæ˜¯è€ƒå¯Ÿæ¯æ—¥ä»·æ ¼å˜åŒ–ï¼Œç¬¬ <code>i</code> å¤©çš„ä»·æ ¼å˜åŒ–å®šä¹‰ä¸ºç¬¬iå¤©å’Œç¬¬ <code>i-1</code> å¤©çš„ä»·æ ¼å·®ã€‚ç¬¬ä¸€å¹…å›¾çš„æœ€åŽä¸€è¡Œç»™å‡ºäº†æ¯æ—¥ä»·æ ¼å˜åŒ–ã€‚å¦‚æžœå°†è¿™ä¸€è¡Œçœ‹ä½œä¸€ä¸ªæ•°ç»„Aï¼Œé‚£ä¹ˆé—®é¢˜å°±è½¬åŒ–ä¸ºå¯»æ‰¾Açš„<strong>å’Œæœ€å¤§çš„éžç©ºè¿žç»­å­æ•°ç»„</strong>ã€‚è¿™æ ·çš„è¿žç»­å­æ•°ç»„ä¸º<strong>æœ€å¤§å­æ•°ç»„</strong>ï¼ˆmaximum subarrayï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯¹ç¬¬ä¸€å¹…å›¾ä¸­çš„æ•°ç»„ï¼Œ<code>A[1...16]</code> çš„æœ€å¤§å­æ•°ç»„ä¸º <code>A[8...11]</code>ï¼Œå…¶å’Œä¸º 43ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨ç¬¬ 8 å¤©å¼€å§‹å‰ï¼ˆç¬¬ 7 å¤©ç»“æŸåŽï¼‰ä¹°å…¥è‚¡ç¥¨ï¼Œå¹¶åœ¨ç¬¬ 11 å¤©ç»“æŸåŽå–å‡ºï¼ŒèŽ·å¾—æ¯è‚¡æ”¶ç›Š 43ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/maximum-subarray.png" title="æœ€å¤§å­æ•°ç»„"></p><p>ä¹ä¸€çœ‹ï¼Œè¿™ç§å˜æ¢å¯¹é—®é¢˜æ±‚è§£å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ã€‚å¯¹äºŽä¸€æ®µ n å¤©çš„æ—¥æœŸï¼Œä»éœ€è¦æ£€æŸ¥ <span class="math inline">\(\begin{pmatrix}n-1\\2\end{pmatrix}=\Theta(n^2)\)</span> ä¸ªå­æ•°ç»„ã€‚è®¡ç®—ä¸€ä¸ªå­æ•°ç»„ä¹‹å’Œæ‰€éœ€çš„æ—¶é—´æ˜¯çº¿æ€§çš„ï¼Œä½†å½“è®¡ç®—æ‰€æœ‰ <span class="math inline">\(\Theta(n^2)\)</span> ä¸ªå­æ•°ç»„å’Œæ—¶ï¼Œå¯ä»¥é‡æ–°ç»„ç»‡è®¡ç®—æ–¹å¼ï¼Œåˆ©ç”¨ä¹‹å‰è®¡ç®—å‡ºçš„å­æ•°ç»„å’Œæ¥è®¡ç®—å½“å‰å­æ•°ç»„çš„å’Œï¼Œä½¿å¾—æ¯ä¸ªå­æ•°ç»„å’Œçš„è®¡ç®—æ—¶é—´ä¸º <span class="math inline">\(O(1)\)</span>ï¼Œä»Žè€Œæš´åŠ›æ±‚è§£æ–¹æ³•æ‰€èŠ±è´¹çš„æ—¶é—´ä»ä¸º <span class="math inline">\(\Theta(n^2)\)</span>ã€‚</p><p>æŽ¥ä¸‹æ¥ï¼Œå¯»æ‰¾æœ€å¤§å­æ•°ç»„é—®é¢˜çš„æ›´é«˜æ•ˆçš„æ±‚è§£æ–¹æ³•ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è¯´â€œä¸€ä¸ªæœ€å¤§å­æ•°ç»„â€è€Œä¸æ˜¯â€œæœ€å¤§å­æ•°ç»„â€ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªå­æ•°ç»„è¾¾åˆ°æœ€å¤§å’Œã€‚</p><p>åªæœ‰å½“æ•°ç»„ä¸­åŒ…å«è´Ÿæ•°æ—¶ï¼Œæœ€å¤§å­æ•°ç»„é—®é¢˜æ‰æœ‰æ„ä¹‰ã€‚å¦‚æžœæ‰€æœ‰æ•°ç»„å…ƒç´ éƒ½æ˜¯éžè´Ÿçš„ï¼Œæœ€å¤§å­æ•°ç»„é—®é¢˜æ²¡æœ‰ä»»ä½•éš¾åº¦ï¼Œå› ä¸ºæ•´ä¸ªæ•°ç»„çš„å’Œè‚¯å®šæ˜¯æœ€å¤§çš„ã€‚</p><h1 id="ä½¿ç”¨åˆ†æ²»ç­–ç•¥çš„ç®—æ³•">ä½¿ç”¨åˆ†æ²»ç­–ç•¥çš„ç®—æ³•</h1><p>å‡å®šè¦å¯»æ‰¾å­æ•°ç»„ <code>A[low...high]</code> çš„æœ€å¤§å­æ•°ç»„ã€‚ä½¿ç”¨åˆ†æ²»æŠ€æœ¯æ„å‘³ç€è¦å°†å­æ•°ç»„åˆ’åˆ†æˆä¸¤ä¸ªè§„æ¨¡å°½é‡ç›¸ç­‰çš„å­æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰¾åˆ°å­æ•°ç»„çš„ä¸­å¤®ä½ç½®ï¼Œæ¯”å¦‚ <code>mid</code>ï¼Œç„¶åŽè€ƒè™‘æ±‚è§£ä¸¤ä¸ªå­æ•°ç»„ <code>A[low...mid]</code> å’Œ <code>A[mid+1...high]</code>ã€‚å¦‚ä¸‹å›¾(a)æ‰€ç¤ºï¼Œ<code>A[low...high]</code> çš„ä»»ä½•è¿žç»­å­æ•°ç»„ <code>A[i...j]</code> æ‰€å¤„çš„ä½ç½®å¿…ç„¶æ˜¯ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€ï¼š</p><ul><li>å®Œå…¨ä½äºŽå­æ•°ç»„ <code>A[low...mid]</code> ä¸­ï¼Œå› æ­¤ <span class="math inline">\(low\le{i}\le{j}\le{mid}\)</span>ã€‚</li><li>å®Œå…¨ä½äºŽå­æ•°ç»„ <code>A[mid+1...high]</code> ä¸­ï¼Œå› æ­¤ <span class="math inline">\(mid&lt;i\le{j}\le{high}\)</span>ã€‚</li><li>è·¨è¶Šäº†ä¸­ç‚¹ï¼Œå› æ­¤ <span class="math inline">\(low\le{i}\le{mid}&lt;j\le{high}\)</span>ã€‚</li></ul><p><img src="/uploads/image/introduction-to-algorithms/maximum-subarray-problem-possible-locations.png" title="æœ€å¤§å­æ•°ç»„æ‰€å¤„çš„ä¸‰ç§ä½ç½®"></p><p>æˆ‘ä»¬å¯ä»¥é€’å½’åœ°æ±‚è§£ <code>A[low...mid]</code> å’Œ <code>A[mid+1...high]</code> çš„æœ€å¤§å­æ•°ç»„ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå­é—®é¢˜ä»æ˜¯æœ€å¤§å­æ•°ç»„é—®é¢˜ï¼Œåªæ˜¯è§„æ¨¡æ›´å°ã€‚å› æ­¤ï¼Œå‰©ä¸‹çš„å…¨éƒ¨å·¥ä½œå°±æ˜¯å¯»æ‰¾è·¨è¶Šä¸­ç‚¹çš„æœ€å¤§å­æ•°ç»„ï¼Œç„¶åŽåœ¨ä¸‰ç§æƒ…å†µä¸­é€‰å–å’Œæœ€å¤§è€…ã€‚</p><p>æ±‚å‡ºè·¨è¶Šä¸­ç‚¹çš„æœ€å¤§å­æ ‘ç»„å¹¶éžåŽŸé—®é¢˜è§„æ¨¡æ›´å°çš„å®žä¾‹ï¼Œå› ä¸ºå®ƒåŠ å…¥äº†é™åˆ¶â€”â€”æ±‚å‡ºçš„å­æ•°ç»„å¿…é¡»è·¨è¶Šä¸­ç‚¹ã€‚å¦‚ä¸Šå›¾(b)æ‰€ç¤ºï¼Œä»»ä½•è·¨è¶Šä¸­ç‚¹çš„å­æ•°ç»„éƒ½æœ‰ä¸¤ä¸ªå­æ•°ç»„ <code>A[i...mid]</code> å’Œ <code>A[mid+1...j]</code> ç»„æˆã€‚å› æ­¤ï¼Œåªéœ€æ‰¾å‡ºå½¢å¦‚ <code>A[i...mid]</code> å’Œ <code>A[mid+1...j]</code> çš„æœ€å¤§å­æ•°ç»„ï¼Œç„¶åŽå°†å…¶åˆå¹¶å³å¯ã€‚è¿‡ç¨‹ <code>FIND-MAX-CROSSING-SUBARRAY</code> æŽ¥æ”¶æ•°ç»„Aå’Œä¸‹æ ‡ <code>low</code>ã€<code>mid</code> å’Œ <code>high</code> ä¸ºè¾“å…¥ï¼Œè¿”å›žä¸€ä¸ªä¸‹æ ‡å…ƒç»„åˆ’å®šè·¨è¶Šä¸­ç‚¹çš„æœ€å¤§å­æ•°ç»„çš„è¾¹ç•Œï¼Œå¹¶è¿”å›žæœ€å¤§å­æ•°ç»„å€¼çš„å’Œã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIND-MAX-CROSSING-SUBARRAY(A, low, mid, high):  <span class="comment"># è®¾ high-low+1 = n</span></span><br><span class="line">    left-sum = -infinty</span><br><span class="line">    sum = <span class="number">0</span>                   <span class="comment"># æ±‚å‡ºå·¦åŠéƒ¨çš„æœ€å¤§å­æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> i = mid downto low:   <span class="comment"># å¾ªçŽ¯ mid-low+1 æ¬¡</span></span><br><span class="line">        sum = sum + A[i]      <span class="comment"># å¾ªçŽ¯ä½“èŠ±è´¹å¸¸æ•°æ—¶é—´</span></span><br><span class="line">        <span class="keyword">if</span> sum &gt; left-sumï¼š</span><br><span class="line">            left-sum = sum</span><br><span class="line">            max-left = i</span><br><span class="line">    right-sum = -infinty</span><br><span class="line">    sum = <span class="number">0</span>                   <span class="comment"># æ±‚å‡ºå³åŠéƒ¨çš„æœ€å¤§å­æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> j = mid + <span class="number">1</span> to high:  <span class="comment"># å¾ªçŽ¯ high-(mid+1)+1=high-mid æ¬¡</span></span><br><span class="line">        sum = sum + A[j]      <span class="comment"># å¾ªçŽ¯ä½“èŠ±è´¹å¸¸æ•°æ—¶é—´</span></span><br><span class="line">        <span class="keyword">if</span> sum &gt; right-sum:</span><br><span class="line">            right-sum = sum</span><br><span class="line">            max-right = j</span><br><span class="line">    <span class="keyword">return</span> (max-left, max-right, left-sum + right-sum)</span><br></pre></td></tr></table></figure><p>å¦‚æžœå­æ•°ç»„ <code>A[low...high]</code> åŒ…å« n ä¸ªå…ƒç´ ï¼Œåˆ™ä¸¤ä¸ª for å¾ªçŽ¯çš„æ€»è¿­ä»£æ¬¡æ•°ä¸º n æ¬¡ï¼Œæ¯æ¬¡è¿­ä»£èŠ±è´¹ <span class="math inline">\(\Theta(1)\)</span> æ—¶é—´ï¼Œå› æ­¤è°ƒç”¨ <code>FIND-MAX-CROSSING-SUBARRAY(A, low, mid, high)</code> èŠ±è´¹ <span class="math inline">\(\Theta(n)\)</span>æ—¶é—´ã€‚</p><p>æ±‚è§£æœ€å¤§å­æ•°ç»„é—®é¢˜çš„åˆ†æ²»ç®—æ³•çš„ä¼ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIND-MAXIMUM-SUBARRAY(A, low, high):</span><br><span class="line">    <span class="keyword">if</span> high == low:  <span class="comment"># åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æƒ…å†µï¼ŒèŠ±è´¹å¸¸é‡æ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> (low, high, A[low])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mid = math.floor((low+high)/<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># åˆ†è§£æˆå­é—®é¢˜</span></span><br><span class="line">        (left-low, left-high, left-sum)    = FIND-MAXIMUM-SUBARRAY(A, low, mid)  <span class="comment"># é€’å½’</span></span><br><span class="line">        (right-low, right-high, right-sum) = FIND-MAXIMUM-SUBARRAY(A, mid+<span class="number">1</span>, high)</span><br><span class="line">        (cross-low, cross-high, cross-sum) = FIND-MAX-CROSSING-SUBARRAY(A, low, mid, high)  <span class="comment"># å¯¹ç¬¬ä¸‰ç§æƒ…å†µå•ç‹¬æ±‚è§£</span></span><br><span class="line">        <span class="comment"># åˆå¹¶ï¼šä¸‰ç§ç»“æžœä¸­æœ€å¤§çš„å­æ•°ç»„ä¸ºåŽŸé—®é¢˜çš„è§£</span></span><br><span class="line">        <span class="keyword">if</span> left-sum &gt;= right-sum <span class="keyword">and</span> left-sum &gt;= cross-sum:</span><br><span class="line">            <span class="keyword">return</span> (left-low, left-high, left-sum)</span><br><span class="line">        <span class="keyword">elif</span> right-sum &gt;= left-sum <span class="keyword">and</span> right-sum &gt;= cross-sum:</span><br><span class="line">            <span class="keyword">return</span> (right-low, right-high, right-sum)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (cross-low, cross-high, cross-sum)</span><br></pre></td></tr></table></figure><p>åˆå§‹è°ƒç”¨ <code>FIND-MAXIMUM-SUBARRAY(A, 0, A.lenght-1)</code> å³å¯æ±‚å‡º <code>A[0...n-1]</code> çš„æœ€å¤§å­æ•°ç»„ã€‚</p><h2 id="åˆ†æž">åˆ†æž</h2><p>å»ºç«‹ä¸€ä¸ªé€’å½’å¼æ¥æè¿°é€’å½’è¿‡ç¨‹ <code>FIND-MAXIMUM-SUBARRAY</code> çš„è¿è¡Œæ—¶é—´ã€‚å¯¹é—®é¢˜è¿›è¡Œç®€åŒ–ï¼Œå‡è®¾åŽŸé—®é¢˜çš„è§„æ¨¡ä¸º 2 çš„å¹‚ï¼Œè¿™æ ·æ‰€æœ‰å­é—®é¢˜çš„è§„æ¨¡å‡ä¸ºæ•´æ•°ã€‚ç”¨ <span class="math inline">\(T(n)\)</span> è¡¨ç¤º <code>FIND-MAXIMUM-SUBARRAY</code> æ±‚è§£ n ä¸ªå…ƒç´ çš„æœ€å¤§å­æ•°ç»„çš„è¿è¡Œæ—¶é—´ã€‚</p><p>å¯¹äºŽ <code>n=1</code> çš„åŸºæœ¬æƒ…å†µï¼ŒèŠ±è´¹å¸¸é‡æ—¶é—´ï¼Œå› æ­¤ <span class="math inline">\(T(1)=\Theta(1)\)</span>ã€‚</p><p>å½“ <code>n&gt;1</code> æ—¶ä¸ºé€’å½’æƒ…å†µã€‚åˆ°è¾¾é€’å½’è°ƒç”¨å‰èŠ±è´¹ <span class="math inline">\(\Theta(1)\)</span> æ—¶é—´ã€‚é€’å½’æ±‚è§£çš„å­é—®é¢˜å‡ä¸º n/2 ä¸ªå…ƒç´ çš„å­æ•°ç»„ï¼ˆå‡å®šåŽŸé—®é¢˜è§„æ¨¡ä¸º 2 çš„å¹‚ï¼Œä¿è¯äº† n/2 ä¸ºæ•´æ•°ï¼‰ï¼Œå› æ­¤æ¯ä¸ªå­é—®é¢˜æ±‚è§£æ—¶é—´ä¸º <span class="math inline">\(T(n/2)\)</span>ã€‚è°ƒç”¨ <code>FIND-MAX-CROSSING-SUBARRAY</code> èŠ±è´¹ <span class="math inline">\(\Theta(n)\)</span> æ—¶é—´ã€‚åˆå¹¶è¿‡ç¨‹èŠ±è´¹ <span class="math inline">\(\Theta(1)\)</span> æ—¶é—´ã€‚å› æ­¤ï¼Œå¯¹äºŽé€’å½’æƒ…å†µï¼Œæœ‰ <span class="math inline">\(T(n)=\Theta(1)+2T(n/2)+\Theta(n)+\Theta(1)=2T(n/2)+\Theta(n)\)</span>ã€‚</p><p>ç»“åˆä¸¤å¼ï¼Œå¾—åˆ° <code>FIND-MAXIMUM-SUBARRAY</code> è¿è¡Œæ—¶é—´ <span class="math inline">\(T(n)\)</span> çš„é€’å½’å¼ï¼š</p><p><span class="math display">\[T(n)=\begin{cases}\Theta(1)&amp;\text{if }n=1\\2T(n/2)+Theta(n)&amp;\text{if }n&gt;1\end{cases}\]</span></p><p>æ­¤é€’å½’å¼ä¸Žå½’å¹¶æŽ’åºçš„é€’å½’å¼ä¸€æ ·ï¼Œå…¶è§£ä¸º <span class="math inline">\(T(n)=\Theta(n\lg{n})\)</span>ã€‚åˆ©ç”¨åˆ†æ²»ç­–ç•¥çš„æ±‚è§£æ–¹æ³•æ¸è¿›å¤æ‚æ€§ä¼˜äºŽæš´åŠ›æ±‚è§£æ–¹æ³•ã€‚</p><h2 id="ä»£ç ">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_max_crossing_subarray</span><span class="params">(a, low, mid, high)</span>:</span></span><br><span class="line">    left_sum = right_sum = float(<span class="string">'-inf'</span>)</span><br><span class="line">    max_left = max_right = t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(low, mid + <span class="number">1</span>)):</span><br><span class="line">        t += a[i]</span><br><span class="line">        <span class="keyword">if</span> t &gt; left_sum:</span><br><span class="line">            left_sum, max_left = t, i</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(mid + <span class="number">1</span>, high + <span class="number">1</span>):</span><br><span class="line">        t += a[i]</span><br><span class="line">        <span class="keyword">if</span> t &gt; right_sum:</span><br><span class="line">            right_sum, max_right = t, i</span><br><span class="line">    <span class="keyword">return</span> max_left, max_right, left_sum + right_sum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_maximum_subarray_dac</span><span class="params">(a, low, high)</span>:</span></span><br><span class="line">    <span class="string">"""divide and conquer"""</span></span><br><span class="line">    <span class="keyword">if</span> high == low:</span><br><span class="line">        <span class="keyword">return</span> low, high, a[low]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">        left_low, left_high, left_sum = find_maximum_subarray_dac(a, low, mid)</span><br><span class="line">        right_low, right_high, right_sum = find_maximum_subarray_dac(a, low + <span class="number">1</span>, high)</span><br><span class="line">        cross_low, cross_high, cross_sum = find_max_crossing_subarray(a, low, mid, high)</span><br><span class="line">        <span class="keyword">if</span> left_sum &gt;= right_sum <span class="keyword">and</span> left_sum &gt;= cross_sum:</span><br><span class="line">            <span class="keyword">return</span> left_low, left_high, left_sum</span><br><span class="line">        <span class="keyword">elif</span> right_sum &gt;= left_sum <span class="keyword">and</span> right_sum &gt;= cross_sum:</span><br><span class="line">            <span class="keyword">return</span> right_low, right_high, right_sum</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> cross_low, cross_high, cross_sum</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">13</span>, <span class="number">-3</span>, <span class="number">-25</span>, <span class="number">20</span>, <span class="number">-3</span>, <span class="number">-16</span>, <span class="number">-23</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">-7</span>, <span class="number">12</span>, <span class="number">-5</span>, <span class="number">-22</span>, <span class="number">15</span>, <span class="number">-4</span>, <span class="number">7</span>]</span><br><span class="line">    print(find_maximum_subarray_dac(arr, <span class="number">0</span>, len(arr) - <span class="number">1</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(7, 10, 43)</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç®—æ³•">ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç®—æ³•</h1><p>ä»Žæ•°ç»„çš„å·¦è¾¹ç•Œå¼€å§‹ï¼Œä»Žå·¦è‡³å³å¤„ç†ï¼Œè®°å½•åˆ°ç›®å‰ä¸ºæ­¢å·²ç»å¤„ç†è¿‡çš„æœ€å¤§å­æ•°ç»„ã€‚å®šä¹‰æ•°ç»„ <code>dp</code>ï¼Œå…¶ä¸­ <code>dp[j]</code> ä»£è¡¨æ•°ç»„<code>A[0...j]</code>ä¸­ä»¥ <code>A[j]</code> ç»“å°¾çš„æœ€å¤§å­æ•°ç»„ï¼Œåˆ™</p><ul><li><code>j = 0</code> æ—¶ï¼Œä»¥ <code>A[j]</code> ç»“å°¾çš„æœ€å¤§å­æ•°ç»„å°±æ˜¯å…¶æœ¬èº«ã€‚</li><li><code>j &gt; 0</code> æ—¶ï¼Œä»¥ <code>A[j]</code> ç»“å°¾çš„æœ€å¤§å­æ•°ç»„å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼š<ul><li>æœ€å¤§å­æ•°ç»„æ˜¯ <code>A[i..j]</code>ï¼Œæ­¤æ—¶ <code>dp[j] = dp[j - 1] + A[j]</code></li><li>æœ€å¤§å­æ•°ç»„æ˜¯ <code>A[j]</code>ï¼Œæ­¤æ—¶ <code>dp[j] = A[j]</code>ã€‚</li></ul></li></ul><p>å³</p><p><span class="math display">\[dp[j]=\begin{cases}A[j]&amp;j=0\\max(dp[j-1],0)+A[j]&amp;j=1\dots{n-1}\end{cases}\]</span></p><h2 id="ä»£ç -1">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kadanes</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    dp = [<span class="number">0</span>] * len(a)</span><br><span class="line">    dp[<span class="number">0</span>] = a[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(a)):</span><br><span class="line">        dp[i] = max(dp[i - <span class="number">1</span>], <span class="number">0</span>) + a[i]</span><br><span class="line">    <span class="keyword">return</span> max(dp)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: a = [13, -3, -25, 20, -3, -16, -23, 18, 20, -7, 12, -5, -22, 15, -4, 7]</span><br><span class="line">Output: 43</span><br></pre></td></tr></table></figure><h2 id="åˆ†æž-1">åˆ†æž</h2><p>å¯¹ä¸€ä¸ªè¾“å…¥è§„æ¨¡ä¸º <span class="math inline">\(n\)</span> çš„æ•°ç»„ï¼Œè¿­ä»£æ¬¡æ•°ä¸º <span class="math inline">\(n\)</span>ï¼Œæ¯æ¬¡è¿­ä»£èŠ±è´¹ <span class="math inline">\(\Theta(1)\)</span> æ—¶é—´ã€‚å› æ­¤ï¼Œç®—æ³•çš„æ€»ä»£ä»·ä¸º <span class="math inline">\(n*\Theta(1)=\Theta(n)\)</span>ã€‚</p><p>ç®—æ³•ä½¿ç”¨äº†ä¸€ä¸ªé•¿åº¦ä¸º <span class="math inline">\(n\)</span> çš„è¾…åŠ©æ•°ç»„ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦ä¸º <span class="math inline">\(\Theta(n)\)</span>ã€‚</p><h2 id="é™ä½Žç©ºé—´å¤æ‚åº¦">é™ä½Žç©ºé—´å¤æ‚åº¦</h2><p>è‹¥åªéœ€è¦æ•´ä¸ªæ•°ç»„çš„æœ€å¤§å­æ•°ç»„ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸€ä¸ªå˜é‡ä»£æ›¿ <code>dp</code> æ•°ç»„ï¼Œä»Žè€Œé™ä½ŽåŠ¨æ€è§„åˆ’ç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ã€‚è¯¥å˜é‡è®°å½•åˆ°ç›®å‰ä¸ºæ­¢å·²å¤„ç†è¿‡çš„æœ€å¤§å­æ•°ç»„ä¸­æœ€å¤§çš„å€¼ã€‚ä¿®æ”¹åŽçš„ç®—æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kadanes_r1</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    curr = res = a[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(a)):</span><br><span class="line">        curr = max(curr, <span class="number">0</span>) + a[i]</span><br><span class="line">        res = max(res, curr)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åŽçš„ç®—æ³•æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯ <span class="math inline">\(\Theta(n)\)</span>ï¼Œç©ºé—´å¤æ‚åº¦é™ä½Žä¸º <span class="math inline">\(O(1)\)</span>ã€‚</p><h2 id="è®°å½•å­æ•°ç»„ä½ç½®">è®°å½•å­æ•°ç»„ä½ç½®</h2><p>å±•å¼€ <code>max</code>ï¼Œåœ¨ <code>curr</code> å’Œ <code>res</code> çš„å€¼å‘ç”Ÿæ”¹å˜çš„åŒæ—¶ï¼Œæ›´æ–°èµ·å§‹æˆ–ç»ˆæ­¢ä½ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kadanes_r2</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> a:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    curr = res = a[<span class="number">0</span>]</span><br><span class="line">    start = end = <span class="number">0</span></span><br><span class="line">    temp = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(a)):</span><br><span class="line">        <span class="keyword">if</span> curr &lt; <span class="number">0</span>:</span><br><span class="line">            curr, temp = <span class="number">0</span>, i</span><br><span class="line">        curr += a[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> res &lt; curr:</span><br><span class="line">            res = curr             <span class="comment"># æ›´æ–°æœ€ä¼˜è§£</span></span><br><span class="line">            start, end = temp, i   <span class="comment"># è®°å½•èµ·å§‹ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">return</span> start, end, res</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ä¸º <span class="math inline">\(\Theta(n)\)</span>ï¼Œç©ºé—´å¤æ‚åº¦ä¸º <span class="math inline">\(O(1)\)</span>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dynamic programming </tag>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> algorithms </tag>
            
            <tag> divide and conquer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡ºåºç»Ÿè®¡é‡</title>
      <link href="/notes/introduction-to-algorithms/order-statistics/"/>
      <url>/notes/introduction-to-algorithms/order-statistics/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡ºåºç»Ÿè®¡é‡">é¡ºåºç»Ÿè®¡é‡</h1><p>åœ¨ä¸€ä¸ªç”±nä¸ªå…ƒç´ ç»„æˆçš„é›†åˆä¸­ï¼Œç¬¬iä¸ªé¡ºåºç»Ÿè®¡é‡ï¼ˆorder statisticï¼‰æ˜¯è¯¥é›†åˆä¸­ç¬¬iå°çš„å…ƒç´ ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå…ƒç´ é›†åˆä¸­ï¼Œæœ€å°å€¼æ˜¯ç¬¬1ä¸ªé¡ºåºç»Ÿè®¡é‡ï¼ˆi=1ï¼‰ï¼Œæœ€å¤§å€¼æ˜¯ç¬¬nä¸ªé¡ºåºç»Ÿè®¡é‡ï¼ˆi=nï¼‰ã€‚</p><p>å°†ä»Žä¸€ä¸ªç”±nä¸ªäº’å¼‚çš„å…ƒç´ æž„æˆçš„é›†åˆä¸­é€‰æ‹©ç¬¬iä¸ªé¡ºåºç»Ÿè®¡é‡çš„é—®é¢˜å½¢å¼åŒ–å®šä¹‰ä¸ºå¦‚ä¸‹çš„<strong>é€‰æ‹©é—®é¢˜</strong>ï¼š</p><p><strong>è¾“å…¥</strong>ï¼š ä¸€ä¸ªåŒ…å«nä¸ªï¼ˆäº’å¼‚çš„ï¼‰æ•°çš„é›†åˆAå’Œä¸€ä¸ªæ•´æ•°<span class="math inline">\(iï¼Œ1\le{i}\le{n}\)</span>ã€‚</p><p><strong>è¾“å‡º</strong>ï¼š å…ƒç´ <span class="math inline">\(x\in{A}\)</span>ï¼Œä¸”Aä¸­æ°å¥½æœ‰i-1ä¸ªå…¶ä»–å…ƒç´ å°äºŽå®ƒã€‚</p><a id="more"></a><h1 id="æœ€å¤§å€¼å’Œæœ€å°å€¼">æœ€å¤§å€¼å’Œæœ€å°å€¼</h1><h2 id="æ‰¾åˆ°æœ€å°å€¼æˆ–æœ€å¤§å€¼">æ‰¾åˆ°æœ€å°å€¼æˆ–æœ€å¤§å€¼</h2><p>åœ¨ä¸€ä¸ªæœ‰nä¸ªå…ƒç´ çš„é›†åˆä¸­ï¼Œæ‰¾å‡ºå…¶æœ€å°å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">minimum</span><span class="params">(a)</span>:</span>  <span class="comment"># ä¸Žmin()ä½œç”¨ç›¸åŒ</span></span><br><span class="line">    <span class="keyword">if</span> len(a) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'minimum() arg is an empty sequence'</span>)</span><br><span class="line">    m = a[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(a)):  <span class="comment"># å¾ªçŽ¯n-1æ¬¡ï¼Œnä½æ•°ç»„é•¿åº¦</span></span><br><span class="line">        m = min(m, a[i])  <span class="comment"># å…ƒç´ ä¹‹é—´æ¯”è¾ƒn-1æ¬¡</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">18</span>, <span class="number">24</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">35</span>, <span class="number">41</span>, <span class="number">39</span>, <span class="number">46</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">52</span>]</span><br><span class="line">    print(<span class="string">'min ='</span>, minimum(arr))</span><br></pre></td></tr></table></figure><p>éœ€è¦åšn-1æ¬¡æ¯”è¾ƒï¼Œn-1æ¬¡æ—¢æ˜¯å…¶æ¯”è¾ƒæ¬¡æ•°ä¸Šç•Œäº¦æ˜¯å…¶ä¸‹ç•Œã€‚æ‰¾å‡ºæœ€å¤§å€¼çš„æ–¹æ³•ç±»ä¼¼ã€‚</p><p>åœ¨ä¸€ä¸ªåŒ…å«nä¸ªå…ƒç´ çš„é›†åˆä¸­æ‰¾å‡ºæœ€å°å€¼ï¼ˆæœ€å¤§å€¼ï¼‰çš„æ—¶é—´æ˜¯<span class="math inline">\(\Theta(n)\)</span>ã€‚</p><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">min = 3</span><br></pre></td></tr></table></figure><h2 id="åŒæ—¶æ‰¾åˆ°æœ€å°å€¼å’Œæœ€å¤§å€¼">åŒæ—¶æ‰¾åˆ°æœ€å°å€¼å’Œæœ€å¤§å€¼</h2><p>å¯ä»¥åˆ†åˆ«ç‹¬ç«‹åœ°æ‰¾å‡ºæœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œè¿™å„éœ€è¦n-1æ¬¡æ¯”è¾ƒï¼Œå…±éœ€2n-2æ¬¡æ¯”è¾ƒã€‚å³å°†æ¯ä¸ªå…ƒç´ ä¸Žå½“å‰æœ€å°å€¼æ¯”è¾ƒä¸€æ¬¡ï¼Œå†ä¸Žæœ€å¤§å…ƒç´ æ¯”è¾ƒä¸€æ¬¡ã€‚ä»£ä»·æ˜¯æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦2æ¬¡æ¯”è¾ƒã€‚</p><p>äº‹å®žä¸Šï¼Œåªéœ€è¦æœ€å¤š<span class="math inline">\(3\lfloor{n/2}\rfloor\)</span>æ¬¡æ¯”è¾ƒå°±å¯ä»¥åŒæ—¶æ‰¾åˆ°æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚</p><p>è®°å½•å·²çŸ¥çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œå¯¹è¾“å…¥å…ƒç´ æˆå¯¹åœ°è¿›è¡Œå¤„ç†ã€‚é¦–å…ˆï¼Œå°†ä¸€å¯¹è¾“å…¥å…ƒç´ ç›¸äº’è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åŽæŠŠè¾ƒå°çš„ä¸Žå½“å‰æœ€å°å€¼æ¯”è¾ƒï¼ŒæŠŠè¾ƒå¤§çš„ä¸Žå½“å‰æœ€å¤§å€¼è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ ·ï¼Œå¯¹æ¯è¿žä¸ªå…ƒç´ å…±éœ€3æ¬¡æ¯”è¾ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">min_max</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(a) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'min_max() arg is an empty sequence'</span>)</span><br><span class="line">    mini = maxi = a[<span class="number">0</span>]  <span class="comment"># nä¸ºå¥‡æ•°æ—¶ï¼Œä¸´æ—¶å˜é‡åŒæ—¶æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> len(a) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        mini, maxi = a[<span class="number">0</span>], a[<span class="number">1</span>]  <span class="comment"># nä¸ºå¶æ•°æ—¶ï¼Œå…ˆæ¯”è¾ƒå‰ä¸¤ä¸ªå…ƒç´ ç¡®å®šå½“å‰æœ€å°å€¼å’Œæœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">if</span> mini &lt; maxi:</span><br><span class="line">            mini, maxi = maxi, mini</span><br><span class="line">        i = <span class="number">3</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; len(a):</span><br><span class="line">        x, y = a[i - <span class="number">1</span>], a[i]</span><br><span class="line">        <span class="keyword">if</span> a[i - <span class="number">1</span>] &gt; a[i]:</span><br><span class="line">            x, y = y, x  <span class="comment"># å…ˆæ¯”è¾ƒæ•°ç»„ä¸­ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">        mini = min(mini, x)  <span class="comment"># å°çš„å…ƒç´ ä¸Žå½“å‰æœ€å°å€¼æ¯”è¾ƒ</span></span><br><span class="line">        maxi = max(maxi, y)  <span class="comment"># å¤§çš„å…ƒç´ ä¸Žå½“å‰æœ€å¤§å€¼æ¯”è¾ƒ</span></span><br><span class="line">        i += <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> mini, maxi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">18</span>, <span class="number">24</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">35</span>, <span class="number">41</span>, <span class="number">39</span>, <span class="number">46</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">52</span>]</span><br><span class="line">    print(<span class="string">'(min, max) ='</span>, min_max(arr))</span><br></pre></td></tr></table></figure><p>åˆ†æžä»¥ä¸‹æ€»çš„æ¯”è¾ƒæ¬¡æ•°ï¼š</p><ul><li>å¦‚æžœnæ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ ä¸ç”¨æ¯”è¾ƒï¼ŒåŽn-1ä¸ªå…ƒç´ æ¯ä¸¤ä¸ªè¿›è¡Œ3æ¬¡æ¯”è¾ƒï¼Œæ€»å…±è¿›è¡Œ<span class="math inline">\(3(n-1)/2=3\lfloor{n/2}\rfloor\)</span>æ¬¡æ¯”è¾ƒã€‚</li><li>å¦‚æžœnæ˜¯å¶æ•°ï¼Œé‚£ä¹ˆå‰ä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒ1æ¬¡ï¼ŒåŽn-2ä¸ªå…ƒç´ æ¯ä¸¤ä¸ªè¿›è¡Œ3æ¬¡æ¯”è¾ƒï¼Œæ€»å…±è¿›è¡Œ<span class="math inline">\(1+3(n-2)/2=3n/2-2&lt;3\lfloor{n/2}\rfloor\)</span>ã€‚</li></ul><p>å› æ­¤ï¼Œä¸ç®¡æ˜¯å“ªä¸€ç§æƒ…å†µï¼Œæ€»çš„æ¯”è¾ƒæ¬¡æ•°è‡³å¤šæ˜¯<span class="math inline">\(3\lfloor{n/2}\rfloor\)</span>ã€‚</p><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(min, max) = (3, 52)</span><br></pre></td></tr></table></figure><h1 id="æœŸæœ›ä¸ºçº¿æ€§æ—¶é—´çš„é€‰æ‹©ç®—æ³•">æœŸæœ›ä¸ºçº¿æ€§æ—¶é—´çš„é€‰æ‹©ç®—æ³•</h1><p>ä¸€èˆ¬é€‰æ‹©é—®é¢˜çœ‹èµ·æ¥è¦æ¯”æ‰¾æœ€å°å€¼è¿™æ ·çš„ç®€å•é—®é¢˜æ›´éš¾ã€‚ä½†ä»¤äººæƒŠå¥‡çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜çš„æ¸è¿›è¿è¡Œæ—¶é—´ç¡®å®žç›¸åŒçš„ï¼š<span class="math inline">\(\Theta(n)\)</span>ã€‚ä¸‹é¢ä»‹ç»ä¸€ç§è§£å†³é€‰æ‹©é—®é¢˜çš„åˆ†æ²»ç®—æ³•ã€‚RANDOMIZED-SELECTç®—æ³•æ˜¯ä»¥å¿«é€ŸæŽ’åºç®—æ³•ä¸ºæ¨¡åž‹çš„ã€‚</p><ul><li><p>ä¸Žå¿«é€ŸæŽ’åºä¸€æ ·ï¼Œå°†è¾“å…¥æ•°ç»„è¿›è¡Œé€’å½’åˆ’åˆ†ã€‚</p></li><li><p>ä¸Žå¿«é€ŸæŽ’åºä¸åŒçš„æ˜¯ï¼Œå¿«é€ŸæŽ’åºä¼šé€’å½’å¤„ç†åˆ’åˆ†çš„ä¸¤è¾¹ï¼Œè€ŒRANDOMIZED-SELECTåªå¤„ç†åˆ’åˆ†çš„ä¸€è¾¹ã€‚å¿«é€ŸæŽ’åºçš„æœŸæœ›è¿è¡Œæ—¶é—´æ˜¯<span class="math inline">\(n\lg(n)\)</span>ï¼Œè€ŒRANDOMIZED-SELECTçš„æœŸæœ›è¿è¡Œæ—¶é—´ä¸ºO(n)ã€‚</p></li></ul><p>RANDOMIZED-SELECTè¿”å›žæ•°ç»„<code>A[p...r]</code>ä¸­ç¬¬iå°çš„å…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RANDOMIZED-SELECT(A, p, r, i):</span><br><span class="line">    <span class="keyword">if</span> p == r:          <span class="comment"># å¦‚æžœæ•°ç»„ä¸­åªåŒ…æ‹¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶iå¿…ç„¶ç­‰äºŽ1</span></span><br><span class="line">        <span class="keyword">return</span> A[p]    <span class="comment"># æ­¤æ—¶åªéœ€è¿”å›žè¿™å”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    q = RANDOMIZED-PARTITION(A, p, r)  <span class="comment"># éšæœºé€‰æ‹©ä¸»å…ƒå¹¶åˆ’åˆ†ï¼Œè¿”å›žä¸»å…ƒä½ç½®ã€‚å› ä¸ºä¸»å…ƒä¸Žå…¶ä»–å…ƒç´ </span></span><br><span class="line">    k = q-p+<span class="number">1</span>  <span class="comment"># ä¸»å…ƒæ˜¯ç¬¬kå°             # éƒ½æ¯”è¾ƒè¿‡ï¼Œæ‰€ä»¥ä¸»å…ƒæ‰€åœ¨ä½ç½®å°±æ˜¯æœ€ç»ˆåœ¨å·²æŽ’åºæ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> i == k:          <span class="comment"># æ£€æµ‹A[q]æ˜¯å¦æ˜¯ç¬¬iå°å…ƒç´ </span></span><br><span class="line">        <span class="keyword">return</span> A[q]</span><br><span class="line">    <span class="keyword">elif</span> i &lt; k:         <span class="comment"># i&lt;kè¯´æ˜ŽA[q]è¿‡å¤§ï¼Œè¦æ‰¾çš„å…ƒç´ è½åœ¨å·¦è¾¹</span></span><br><span class="line">        <span class="keyword">return</span> RANDOMIZED-SELECT(A, p, q<span class="number">-1</span>, i)</span><br><span class="line">    <span class="keyword">else</span>:               <span class="comment"># å¦åˆ™è½åœ¨å³è¾¹</span></span><br><span class="line">        <span class="keyword">return</span> RANDOMIZED-SELECT(A, q+<span class="number">1</span>, r, i-k)  <span class="comment"># å·¦è¾¹+ä¸»å…ƒä¸€å…±kä¸ªå…ƒç´ ï¼Œåœ¨å³è¾¹è¦æ‰¾ç¬¬i-kå°å…ƒç´ </span></span><br></pre></td></tr></table></figure><p>ç¨‹åºåˆ¤æ–­äº†p==rå³å­æ•°ç»„åªå«æœ‰1ä¸ªå…ƒç´ çš„æƒ…å†µï¼Œé‚£ä¹ˆå«æœ‰0ä¸ªå…ƒç´ çš„æƒ…å†µå‘¢ï¼Ÿåˆ’åˆ†æ“ä½œæœ‰å¯èƒ½äº§ç”Ÿé•¿åº¦ä¸º0çš„å­æ•°ç»„ï¼Œé‚£ä¹ˆä¸Šè¿°é€’å½’æ“ä½œä¼šè°ƒç”¨å«æœ‰0ä¸ªå…ƒç´ çš„å­æ•°ç»„å—ï¼Ÿç­”æ¡ˆæ˜¯è¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿã€‚è€ƒè™‘ä¸»å…ƒä½äºŽè¾¹ç•Œçš„æƒ…å†µï¼š</p><ul><li>p=qï¼šå·¦è¾¹å­æ•°ç»„é•¿åº¦ä¸º0ï¼Œå³è¾¹ä¸ä¸º0ã€‚ä¸»å…ƒæ˜¯ç¬¬1å°å…ƒç´ ï¼Œç”±äºŽiä¸å¯èƒ½å°äºŽ1ï¼Œè‹¥æ‰€å¯»ç›®æ ‡i=1ï¼Œç¨‹åºç»“æŸå¹¶è¿”å›žï¼›è‹¥i&gt;1ï¼Œç¨‹åºå°†åœ¨å³è¾¹çš„å­æ•°ç»„ä¸­é€’å½’å¯»æ‰¾ã€‚</li><li>p=rï¼šä¸Žp=qæ˜¯å¯¹ç§°çš„ã€‚iä¸å¯èƒ½å¤§äºŽnï¼ˆæ•°ç»„ä¸­å…ƒç´ æ€»ä¸ªæ•°ï¼‰ã€‚æ­¤æ—¶ä¸»å…ƒæ˜¯ç¬¬nå°ï¼Œè‹¥i=nï¼Œç¨‹åºç»“æŸå¹¶è¿”å›žï¼›è‹¥i&lt;nï¼Œåˆ™åœ¨å·¦è¾¹çš„å­æ•°ç»„ä¸­é€’å½’å¯»æ‰¾ã€‚</li></ul><p>å› æ­¤ï¼Œç¨‹åºä¼šä¸é€’å½’è°ƒç”¨å«æœ‰0ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚</p><h2 id="åˆ†æž">åˆ†æž</h2><p>RANDOMIZED-SELECTçš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(n^2)\)</span>ï¼Œå³ä½¿æ˜¯æ‰¾æœ€å°å…ƒç´ ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºåœ¨æ¯æ¬¡åˆ’åˆ†æ—¶å¯èƒ½æžä¸èµ°è¿åœ°æ€»æ˜¯æŒ‰ä½™ä¸‹çš„å…ƒç´ ä¸­æœ€å¤§çš„æ¥è¿›è¡Œåˆ’åˆ†ï¼Œè€Œåˆ’åˆ†æ“ä½œéœ€è¦<span class="math inline">\(\Theta(n)\)</span>æ—¶é—´ã€‚ä½†å› ä¸ºç®—æ³•æ˜¯éšæœºåŒ–çš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¸€ä¸ªç‰¹å®šçš„ä¼šå¯¼è‡´å…¶æœ€åæƒ…å†µå‘ç”Ÿçš„è¾“å…¥æ•°æ®ã€‚ä¸‹é¢åˆ†æžç®—æ³•çš„æœŸæœ›è¿è¡Œæ—¶é—´ã€‚</p><p>è®¾è¯¥ç®—æ³•åœ¨ä¸€ä¸ªå«æœ‰nä¸ªå…ƒç´ çš„è¾“å…¥æ•°ç»„<code>A[p...r]</code>ä¸Šçš„è¿è¡Œæ—¶é—´æ˜¯ä¸€ä¸ªéšæœºå˜é‡ï¼Œè®°ä¸ºT(n)ã€‚å¯¹æ¯ä¸€ä¸ª<span class="math inline">\(k(1\le{k}\le{n})\)</span>ï¼Œå­æ•°ç»„<code>A[p...q]</code>ï¼ˆå…¨éƒ¨å°äºŽæˆ–ç­‰äºŽä¸»å…ƒï¼‰æœ‰kä¸ªå…ƒç´ çš„æ¦‚çŽ‡æ˜¯1/nã€‚å¯¹æ‰€æœ‰çš„<code>k=1,2,...,n</code>ï¼Œå®šä¹‰æŒ‡ç¤ºå™¨å˜é‡<span class="math inline">\(X_k\)</span>ä¸ºï¼š<span class="math inline">\(X_k=I\lbraceå­æ•°ç»„A[p...q]æ­£å¥½åŒ…å«kä¸ªå…ƒç´ \rbrace\)</span>ã€‚å‡è®¾å…ƒç´ æ˜¯äº’å¼‚çš„ï¼Œæœ‰<span class="math inline">\(E[X_k]=1/n\)</span>ã€‚</p><p>ä¸ºäº†å¾—åˆ°æ‰€éœ€æ—¶é—´çš„ä¸Šç•Œï¼Œå‡å®šæŸ¥æ‰¾çš„ç¬¬iä¸ªå…ƒç´ æ€»æ˜¯åœ¨åˆ’åˆ†ä¸­åŒ…å«è¾ƒå¤§å…ƒç´ çš„ä¸€è¾¹ã€‚æŒ‡ç¤ºå™¨éšæœºå˜é‡<span class="math inline">\(X_k\)</span>æ°å¥½åœ¨ç»™å®šçš„kå€¼ä¸Šå–å€¼1ï¼Œå¯¹å…¶ä»–å€¼éƒ½ä¸º0ã€‚å½“<span class="math inline">\(X_k=1\)</span>æ—¶ï¼Œå¯èƒ½è¦é€’å½’å¤„ç†çš„ä¸¤ä¸ªå­æ•°ç»„å¤§å°åˆ†åˆ«ä¸ºk-1å’Œn-kã€‚å› æ­¤å¯ä»¥å¾—åˆ°é€’å½’å¼ï¼š <span class="math display">\[\begin{aligned}T(n)&amp;\le\sum_{k=1}^nX_k\cdot\Bigl(T\bigl(max(k-1,n-k)\bigr)+O(n)\Bigr)\\&amp;=\sum_{k=1}^nX_k\cdot{T(max(k-1,n-k))}+O(n)\end{aligned}\]</span> ä¸¤è¾¹å–æœŸæœ›å€¼ï¼Œå¾—åˆ° <span class="math display">\[\begin{aligned}E[T(n)]&amp;\le{E\Big[\sum_{k=1}^nX_k\cdot{T(max(k-1,n-k))}+O(n)\Bigr]}\\&amp;=\sum_{k=1}^nE\Big[X_k\cdot{T(max(k-1,n-k))}\Big]+O(n)\quad\text{(æœŸæœ›çš„çº¿æ€§æ€§è´¨)}\\&amp;=\sum_{k=1}^nE[X_k]\cdot{E[T(max(k-1,n-k))]}+O(n)\quad\text{(}X_k\text{å’Œ}T(max(k-1,n-k))\text{ç›¸äº’ç‹¬ç«‹)}\\&amp;=\sum_{k=1}^n\frac{1}{n}\cdot{E[T(max(k-1,n-k))]}+O(n)\end{aligned}\]</span> è€ƒè™‘è¡¨è¾¾å¼max(k-1,n-k)ï¼Œæœ‰ <span class="math display">\[max(k-1,n-k)=\begin{cases}k-1\quad\text{è‹¥}k&gt;\lceil{n/2}\rceil\\n-k\quad\text{è‹¥}k\le\lceil{n/2}\rceil\end{cases}\]</span> è§‚å¯Ÿåˆ°è¡¨è¾¾å¼max(k-1,n-k)çš„å–å€¼æ˜¯æˆå¯¹å‡ºçŽ°çš„ï¼š</p><ul><li>å¦‚æžœnæ˜¯å¶æ•°ï¼Œåˆ™<span class="math inline">\(k=1,2,\dots,n/2\)</span>ä¸Ž<span class="math inline">\(k=n,n-1,\dots,n/2+1\)</span>æ—¶çš„å–å€¼ç›¸ç­‰ï¼Œå–å€¼åˆ†åˆ«æ˜¯<span class="math inline">\(n-1,n-2,\dots,n/2\)</span>ã€‚</li><li>å¦‚æžœnæ˜¯å¥‡æ•°ï¼Œåˆ™<span class="math inline">\(k=1,2,\dots,\lfloor{n/2}\rfloor\)</span>ä¸Ž<span class="math inline">\(k=n,n-1,\dots,\lceil{n/2}\rceil+1\)</span>æ—¶çš„å–å€¼ç›¸ç­‰ï¼Œåˆ†åˆ«æ˜¯<span class="math inline">\(n-1,n-2,\dots,\lceil{n/2}\rceil\)</span>ã€‚æ­¤å¤–<span class="math inline">\(k=\lceil{n/2}\rceil\)</span>æ—¶çš„å–å€¼å•ç‹¬å‡ºçŽ°ï¼Œå€¼æ˜¯<span class="math inline">\(\lfloor{2/n}\rfloor\)</span>ã€‚</li></ul><p>å› æ­¤ï¼Œæœ‰ <span class="math display">\[E[T(n)]\le\frac{2}{n}\sum_{k=\lfloor{n/2}\rfloor}^{n-1}E[T(k)]+O(n)\]</span> ä¸‹é¢ç”¨æ›¿ä»£æ³•æ¥å¾—åˆ°E[T(n)]=O(n)ã€‚</p><p>å‡è®¾å¯¹æŸä¸ªå¸¸æ•°cï¼Œæœ‰<span class="math inline">\(E[T(n)]\le{cn}\)</span>ã€‚å‡è®¾å¯¹å°äºŽæŸä¸ªå¸¸æ•°çš„nï¼Œæœ‰T(n)=O(1)ã€‚åŒæ—¶ï¼Œé€‰æ‹©ä¸€ä¸ªå¸¸æ•°aï¼Œä½¿å¾—å¯¹æ‰€æœ‰n&gt;0ï¼Œä¸Šå¼ä¸­O(n)é¡¹æ‰€æè¿°çš„å‡½æ•°æœ‰ä¸Šç•Œanã€‚åˆ©ç”¨è¿™ä¸ªå½’çº³å‡è®¾ï¼Œå¯ä»¥å¾—åˆ°ï¼š <span class="math display">\[\begin{aligned}E[T(n)]&amp;\le\frac{2}{n}\sum_{k=\lfloor{n/2}\rfloor}^{n-1}ck+an\\&amp;=\frac{2c}{n}\Big(\sum_{k=1}^{n-1}k-\sum_{k=1}^{\lfloor{n/2}\rfloor-1}k\Big)+an\\&amp;=\frac{2c}{n}\Big(\frac{(n-1)n}{2}-\frac{(\lfloor{n/2}\rfloor-1)\lfloor{n/2}\rfloor}{2}\Big)+an\\&amp;\le\frac{2c}{n}\Big(\frac{(n-1)n}{2}-\frac{(n/2-2)(n/2-1)}{2}\Big)+an\\&amp;=\frac{2c}{n}\Big(\frac{n^2-n}{2}-\frac{n^2-3n/2+2}{2}\Big)+an\\&amp;=\frac{c}{n}(\frac{3n}{4}+\frac{1}{2}-\frac{2}{n})+an\\&amp;\le\frac{3cn}{4}+\frac{c}{2}+an\\&amp;=cn-\color{red}{(\frac{cn}{4}-\frac{c}{2}-an)}\end{aligned}\]</span> ä¸ºäº†å®Œæˆè¯æ˜Žï¼Œè¿˜éœ€è¦è¯æ˜Žï¼šå¯¹è¶³å¤Ÿå¤§çš„nï¼Œæœ€åŽä¸€ä¸ªè¡¨è¾¾å¼è‡³å¤šæ˜¯cnã€‚ <span class="math display">\[\begin{aligned}\frac{cn}{4}-\frac{c}{2}-an&amp;\ge0\\n(\frac{c}{4}-a)&amp;\ge\frac{c}{2}\end{aligned}\]</span> åªè¦é€‰æ‹©çš„å¸¸æ•°cèƒ½å¤Ÿæ»¡è¶³c/4-a&gt;0ï¼Œå°±å¯ä»¥å°†ä¸¤è¾¹åŒæ—¶é™¤ä»¥c/4-aï¼Œå¾—åˆ° <span class="math display">\[n\ge\frac{c/2}{c/4-a}=\frac{2c}{c-4a}\]</span> å› æ­¤ï¼Œå¦‚æžœå‡è®¾å¯¹æ‰€æœ‰n&lt;2c/(c-4a)ï¼Œéƒ½æœ‰T(n)=O(1)ï¼Œé‚£ä¹ˆå°±æœ‰E[T(n)]=O(n)ã€‚</p><p>ç»“æžœï¼šå‡è®¾æ‰€æœ‰å…ƒç´ æ˜¯äº’å¼‚çš„ï¼Œåœ¨æœŸæœ›çº¿æ€§æ—¶é—´å†…ï¼Œå¯ä»¥æ‰¾åˆ°ä»»ä¸€é¡ºåºç»Ÿè®¡é‡ï¼Œç‰¹åˆ«æ˜¯ä¸­ä½æ•°ï¼ˆï¼Ÿï¼‰ã€‚</p><h2 id="ä»£ç ">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sort.quick_sort <span class="keyword">import</span> partition</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomized_select</span><span class="params">(a, p, r, i)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> p == r:  <span class="comment"># åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œiä¸€å®šç­‰äºŽ1ï¼Œiä»£è¡¨çš„æ˜¯åœ¨a[p..r]ä¸­ç¬¬iå°</span></span><br><span class="line">        <span class="keyword">return</span> a[p]</span><br><span class="line">    q = partition(a, p, r, randint(p, r))  <span class="comment"># éšæœºé€‰æ‹©ä¸»å…ƒå¹¶åˆ’åˆ†</span></span><br><span class="line">    k = q - p + <span class="number">1</span>  <span class="comment"># ä¸»å…ƒæ˜¯ç¬¬kå°å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> i == k:</span><br><span class="line">        <span class="keyword">return</span> a[q]</span><br><span class="line">    <span class="keyword">elif</span> i &lt; k:  <span class="comment"># åœ¨å·¦è¾¹ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> randomized_select(a, p, q - <span class="number">1</span>, i)</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># åœ¨å³è¾¹ç»§ç»­å¯»æ‰¾ï¼Œæ³¨æ„è¦å¯»æ‰¾çš„åºå·è¦å˜åŒ–</span></span><br><span class="line">        <span class="keyword">return</span> randomized_select(a, q + <span class="number">1</span>, r, i - k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">18</span>, <span class="number">24</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">35</span>, <span class="number">41</span>, <span class="number">39</span>, <span class="number">46</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">52</span>]</span><br><span class="line">    print([randomized_select(arr, <span class="number">0</span>, len(arr) - <span class="number">1</span>, i + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr))])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[3, 7, 17, 18, 21, 23, 24, 26, 30, 35, 38, 39, 41, 46, 52]</span><br></pre></td></tr></table></figure><h1 id="æœ€åæƒ…å†µä¸ºçº¿æ€§æ—¶é—´çš„é€‰æ‹©ç®—æ³•">æœ€åæƒ…å†µä¸ºçº¿æ€§æ—¶é—´çš„é€‰æ‹©ç®—æ³•</h1><p>æœ¬èŠ‚ä»‹ç»ä¸€ä¸ªæœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(n)\)</span>çš„é€‰æ‹©ç®—æ³•ï¼šSELECTç®—æ³•ã€‚åƒRANDOMIZED-SELECTä¸€æ ·ï¼ŒSELECTç®—æ³•é€šè¿‡å¯¹è¾“å…¥æ•°ç»„çš„é€’å½’åˆ’åˆ†æ¥æ‰¾å‡ºæ‰€éœ€å…ƒç´ ï¼Œä½†æ˜¯ï¼Œåœ¨è¯¥ç®—æ³•ä¸­<strong>èƒ½å¤Ÿä¿è¯å¾—åˆ°å¯¹æ•°ç»„çš„ä¸€ä¸ªå¥½çš„åˆ’åˆ†</strong>ã€‚</p><p>SELECTç®—æ³•çš„æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol type="1"><li>å¦‚æžœn=1ï¼Œåˆ™è¿”å›žå”¯ä¸€å…ƒç´ ä½œä¸ºç¬¬iå°çš„å…ƒç´ ã€‚å¦åˆ™å°†è¾“å…¥æ•°ç»„çš„nä¸ªå…ƒç´ åˆ’åˆ†ä¸º<span class="math inline">\(\lfloor{n/5}\rfloor\)</span>ç»„ï¼Œæ¯ç»„5ä¸ªå…ƒç´ ï¼Œå‰©ä¸‹çš„ä¸€ç»„è‡³å¤šç”±n%5ä¸ªå…ƒç´ ç»„æˆã€‚</li><li>å¯»æ‰¾è¿™<span class="math inline">\(\lceil{n/5}\rceil\)</span>ç»„ä¸­æ¯ä¸€ç»„çš„ä¸­ä½æ•°ï¼šé¦–å…ˆå¯¹æ¯ç»„å…ƒç´ è¿›è¡Œæ’å…¥æŽ’åºï¼Œç„¶åŽç¡®å®šæ¯ç»„æœ‰åºå…ƒç´ çš„ä¸­ä½æ•°ã€‚</li><li>å¯¹ç¬¬2æ­¥ä¸­æ‰¾å‡ºçš„<span class="math inline">\(\lceil{n/5}\rceil\)</span>ä¸ªä¸­ä½æ•°ï¼Œé€’å½’è°ƒç”¨SELECTä»¥æ‰¾å‡ºå…¶ä¸­çš„ä¸­ä½æ•°xï¼ˆå¦‚æžœç”±å¶æ•°ä¸ªä¸­ä½æ•°ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œçº¦å®šxæ˜¯è¾ƒå°çš„ä¸­ä½æ•°ï¼‰ã€‚</li><li>æŒ‰ä¸­ä½æ•°çš„ä¸­ä½æ•°xå¯¹è¾“å…¥æ•°ç»„è¿›è¡Œåˆ’åˆ†ã€‚è®©kæ¯”åˆ’åˆ†çš„ä½ŽåŒºä¸­çš„å…ƒç´ æ•°ç›®å¤š1ï¼Œå› æ­¤xæ˜¯ç¬¬kå°çš„å…ƒç´ ï¼Œå¹¶ä¸”æœ‰n-kä¸ªå…ƒç´ åœ¨åˆ’åˆ†çš„é«˜åŒºã€‚</li><li>å¦‚æžœi=kï¼Œåˆ™è¿”å›žxã€‚å¦‚æžœi&lt;kï¼Œåˆ™åœ¨åœ°åŒºé€’å½’è°ƒç”¨SELECTæ¥æ‰¾å‡ºç¬¬iå°çš„å…ƒç´ ã€‚å¦‚æžœi&gt;kï¼Œåˆ™åœ¨é«˜åŒºé€’å½’æŸ¥æ‰¾ç¬¬i-kå°çš„å…ƒç´ ã€‚</li></ol><h2 id="åˆ†æž-1">åˆ†æž</h2><p>é¦–å…ˆç¡®å®šå¤§äºŽåˆ’åˆ†ä¸»å…ƒxçš„å…ƒç´ ä¸ªæ•°çš„ä¸‹ç•Œã€‚ä¸‹å›¾ç»™å‡ºäº†ä¸€äº›å½¢è±¡çš„è¯´æ˜Žã€‚åœ¨ç¬¬2æ­¥æ‰¾å‡ºçš„ä¸­ä½æ•°ä¸­ï¼Œè‡³å°‘æœ‰ä¸€åŠå¤§äºŽæˆ–ç­‰äºŽä¸­ä½æ•°çš„ä¸­ä½æ•°xã€‚å› æ­¤ï¼Œåœ¨è¿™<span class="math inline">\(\lceil{n/5}\rceil\)</span>ä¸ªç»„ä¸­ï¼Œ é™¤äº†å½“nä¸èƒ½è¢«5æ•´é™¤æ—¶äº§ç”Ÿçš„æ‰€å«å…ƒç´ å°‘äºŽ5çš„é‚£ä¸ªç»„ï¼Œå’ŒåŒ…å«xçš„é‚£ä¸ªç»„ä¹‹å¤–ï¼Œè‡³å°‘æœ‰ä¸€åŠçš„ç»„ä¸­æœ‰3ä¸ªå…ƒç´ å¤§äºŽxã€‚ä¸ç®—è¿™ä¸¤ä¸ªç»„ï¼Œå¤§äºŽxçš„å…ƒç´ ä¸ªæ•°è‡³å°‘ä¸º <span class="math display">\[3\Bigl(\big\lceil\frac{1}{2}\lceil\frac{n}{5}\rceil\big\rceil-2\Bigr)\ge\frac{3n}{10}-6\]</span> ç±»ä¼¼åœ°ï¼Œè‡³å°‘æœ‰3n/10-6ä¸ªå…ƒç´ å°äºŽxã€‚å› æ­¤ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ï¼Œåœ¨ç¬¬5æ­¥ä¸­ï¼ŒSELECTçš„é€’å½’è°ƒç”¨æœ€å¤šä½œç”¨äºŽ7n/10+6ä¸ªå…ƒç´ ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/select-analysis.png" title="ç°è‰²é˜´å½±è¦†ç›–çš„å…ƒç´ å…¨éƒ½å¤§äºŽx"></p><p>çŽ°åœ¨ï¼Œè®¾è®¡ä¸€ä¸ªé€’å½’å¼æ¥æŽ¨åˆ°SELECTç®—æ³•çš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´T(n)ã€‚</p><p>æ­¥éª¤1ï¼šåˆ†ç»„éœ€è¦O(n)æ—¶é—´ã€‚</p><p>æ­¥éª¤2ï¼šå¯¹å¤§å°ä¸ºO(1)ï¼ˆå¤§å°ä¸º5ï¼‰çš„é›†åˆè°ƒç”¨O(n)ï¼ˆ<span class="math inline">\(\lceil{n/5}\rceil\)</span>æ¬¡ï¼‰æ’å…¥æŽ’åºï¼Œæ€»æ—¶é—´ä¹Ÿä¸ºO(n)ã€‚</p><p>æ­¥éª¤3ï¼šé€’å½’æ‰€éœ€æ—¶é—´ä¸º<span class="math inline">\(T(\lceil{n/5}\rceil)\)</span>ã€‚</p><p>æ­¥éª¤4ï¼špartitionæ‰€éœ€æ—¶é—´ä¸ºO(n)ã€‚</p><p>æ­¥éª¤5ï¼šé€’å½’æ‰€éœ€æ—¶é—´è‡³å¤šä¸ºT(7n/10+6)ã€‚</p><p>å°†ä¸Šè¿°æ—¶é—´ç´¯åŠ ï¼Œå¯å¾—åˆ° <span class="math display">\[T(n)\le{T(\lceil{n/5}\rceil)+T(7n/10+6)+O(n)}\]</span> ä¸‹é¢ç”¨æ›¿æ¢æ³•è¯æ˜Žè¿™ä¸ªè¿è¡Œæ—¶é—´æ˜¯çº¿æ€§çš„ã€‚æ›´æ˜Žç¡®åœ°è¯´ï¼Œè¯æ˜Žå¯¹æŸä¸ªé€‚å½“å¤§çš„å¸¸æ•°cå’Œæ‰€æœ‰çš„n&gt;0ï¼Œæœ‰<span class="math inline">\(T(n)\le{cn}\)</span>ã€‚æŒ‘é€‰ä¸€ä¸ªå¸¸æ•°aï¼Œä½¿å¾—å¯¹æ‰€æœ‰çš„n&gt;0ï¼Œå…¬å¼ä¸­çš„O(n)é¡¹æ‰€å¯¹åº”çš„å‡½æ•°æœ‰ä¸Šç•Œanã€‚å‡è®¾<span class="math inline">\(T(n)\le{cn}\)</span>æˆç«‹ã€‚å°†å‡è®¾å¸¦å…¥ä¸Šè¿°é€’å½’å¼çš„å³è¾¹ï¼Œå¾—åˆ° <span class="math display">\[\begin{aligned}T(n)&amp;\le{c\lceil{n/5}\rceil}+c(7n/10+6)+an\\&amp;\le{cn/5+c}+7cn/10+6c+an\\&amp;=9cn/10+7c+an\\&amp;=cn+\color{red}{(-cn/10+7c+an)}\end{aligned}\]</span> è‹¥<span class="math inline">\(-cn/10+7c+an\le0\)</span>æ—¶ï¼Œåˆ™<span class="math inline">\(T(n)\le{cn}\)</span>æˆç«‹ã€‚ <span class="math display">\[\begin{aligned}-cn/10+7c+an&amp;\le0\\cn/10-7c&amp;\ge{an}\\c\frac{n-70}{10}&amp;\ge{an}\end{aligned}\]</span> è§‚å¯Ÿä¸Šå¼å¯çŸ¥ï¼Œå½“n&gt;70æ—¶ï¼Œ<span class="math inline">\(-cn/10+7c+an\le0\)</span>ï¼Œæ­¤æ—¶<span class="math inline">\(c\ge10a\color{red}{(n/(n-70))}\)</span>ã€‚ <span class="math display">\[\frac{n}{n-70}=\frac{1}{1-\frac{70}{n}}\]</span> å½“nå¢žå¤§æ—¶ï¼Œn/(n-70)å‡å°ï¼Œå› æ­¤åªè¦é€‚å½“åœ°é€‰æ‹©cçš„å€¼ï¼Œä½¿ä¸ç­‰å¼<span class="math inline">\(-cn/10+7c+an\le0\)</span>æˆç«‹ï¼Œå°±èƒ½è¯æ˜Ž<span class="math inline">\(T(n)\le{cn}\)</span>ã€‚ä¾‹å¦‚ï¼Œn&gt;70æ—¶ï¼Œ<span class="math inline">\(n/(n-70)\le71\)</span>ï¼Œé€‰æ‹©å¸¸æ•°<span class="math inline">\(c\ge710a\)</span>å³å¯æ»¡è¶³<span class="math inline">\(T(n)\le{cn}\)</span>ã€‚åˆä¾‹å¦‚ï¼Œå½“<span class="math inline">\(n\ge140\)</span>æ—¶ï¼Œ<span class="math inline">\(n/(n-70)\le2\)</span>ï¼Œé€‰æ‹©å¸¸æ•°<span class="math inline">\(c\ge20a\)</span>å³å¯ã€‚æ— è®ºå¦‚ä½•é€‰æ‹©nçš„è¾¹ç•Œxï¼Œåœ¨n&lt;xæ—¶ï¼Œ<span class="math inline">\(T(n)\le{cn}\)</span>æˆç«‹ï¼ˆåªéœ€é€‰æ‹©è¶³å¤Ÿå¤§çš„cå³å¯ï¼‰ã€‚å› æ­¤ï¼Œæœ€åæƒ…å†µä¸‹SELECTçš„è¿è¡Œæ—¶é—´æ˜¯çº¿æ€§çš„ã€‚</p><h2 id="ä»£ç -1">ä»£ç </h2><p>ä¸åŒçš„æ˜¯ï¼šå°†é€‰æ‹©ä¸­ä½æ•°çš„ä¸­ä½æ•°è¿‡ç¨‹ï¼ˆæ­¥éª¤1~3ï¼‰ä»Žé€‰æ‹©ç®—æ³•ä¸­ç‹¬ç«‹å‡ºæ¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sort.quick_sort <span class="keyword">import</span> partition</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exchange</span><span class="params">(a, i, j)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> i != j:</span><br><span class="line">        a[i], a[j] = a[j], a[i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insertion_sort</span><span class="params">(a, p, r)</span>:</span>  <span class="comment"># ä¿®æ”¹è¿‡çš„æ’å…¥æŽ’åºï¼Œå¯¹a[p..r]è¿›è¡ŒæŽ’åº</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(p + <span class="number">1</span>, r + <span class="number">1</span>):</span><br><span class="line">        key = a[j]</span><br><span class="line">        i = j - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &gt;= p <span class="keyword">and</span> a[i] &gt; key:</span><br><span class="line">            a[i + <span class="number">1</span>] = a[i]</span><br><span class="line">            i -= <span class="number">1</span></span><br><span class="line">        a[i + <span class="number">1</span>] = key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">median_of_median</span><span class="params">(a, p, r)</span>:</span></span><br><span class="line">    <span class="string">"""å°†æ•°ç»„åˆ†æˆæ¯5ä¸ªå…ƒç´ ä¸€ç»„ï¼Œæ‰¾å…¶ä¸­ä½æ•°ï¼Œè‹¥æœ‰å¤šä¸ªï¼Œé€’å½’ä¸­ä½æ•°ç»„æˆçš„æ•°ç»„ï¼Œç»§ç»­å¯»æ‰¾"""</span></span><br><span class="line">    <span class="keyword">if</span> p == r:</span><br><span class="line">        <span class="keyword">return</span> a[p]</span><br><span class="line">    <span class="comment"># å¯¹æ¯5ä¸ªå…ƒç´ è°ƒç”¨æ’å…¥æŽ’åº</span></span><br><span class="line">    left = p</span><br><span class="line">    <span class="keyword">while</span> left &lt;= r:</span><br><span class="line">        right = min(left + <span class="number">4</span>, r)</span><br><span class="line">        insertion_sort(a, left, right)  <span class="comment"># å¯¹æ¯5ä¸ªæ•°æŽ’åºï¼Œå‰©ä¸‹çš„ä¸€ç»„è‹¥ä¸è¶³5ä¸ªï¼Œæœ‰å‡ ä¸ªç®—å‡ ä¸ª</span></span><br><span class="line">        <span class="comment"># äº¤æ¢ä¸­ä½æ•°åˆ°æ•°ç»„å‰é¢ï¼Œæ–¹ä¾¿é€’å½’è°ƒç”¨</span></span><br><span class="line">        exchange(a, p + (right - p) // <span class="number">5</span>, (right + left) // <span class="number">2</span>)</span><br><span class="line">        left += <span class="number">5</span></span><br><span class="line">    n = ceil((r - p + <span class="number">1</span>) / <span class="number">5</span>)  <span class="comment"># æ‰€æœ‰åˆ†ç»„çš„ä¸­ä½æ•°çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">return</span> median_of_median(a, p, p + n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(a, p, r, i)</span>:</span></span><br><span class="line">    median_of_median(a, p, r)  <span class="comment"># æ‰¾å‡ºä¸­ä½æ•°çš„ä¸­ä½æ•°ï¼Œè¿‡ç¨‹ç»“æŸæ—¶æ‰¾åˆ°çš„ä¸­ä½æ•°ä½ç½®ä¸ºp</span></span><br><span class="line">    q = partition(a, p, r, p)  <span class="comment"># ä»¥æ‰¾åˆ°çš„ä¸­ä½æ•°ä¸ºpivotï¼Œåˆ’åˆ†æ•°ç»„</span></span><br><span class="line">    k = q - p + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == k:</span><br><span class="line">        <span class="keyword">return</span> a[q]</span><br><span class="line">    <span class="keyword">elif</span> i &lt; k:</span><br><span class="line">        <span class="keyword">return</span> select(a, p, q - <span class="number">1</span>, i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> select(a, q + <span class="number">1</span>, r, i - k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">18</span>, <span class="number">24</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">21</span>, <span class="number">7</span>, <span class="number">23</span>, <span class="number">35</span>, <span class="number">41</span>, <span class="number">39</span>, <span class="number">46</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">38</span>, <span class="number">52</span>]</span><br><span class="line">    print([select(arr, <span class="number">0</span>, len(arr) - <span class="number">1</span>, i + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr))])</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[3, 7, 17, 18, 21, 23, 24, 26, 30, 35, 38, 39, 41, 46, 52]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> algorithms </tag>
            
            <tag> divide and conquer </tag>
            
            <tag> quicksort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å¤§æµ</title>
      <link href="/notes/introduction-to-algorithms/maximum-flow/"/>
      <url>/notes/introduction-to-algorithms/maximum-flow/</url>
      
        <content type="html"><![CDATA[<h1 id="æµç½‘ç»œå’Œæµ">æµç½‘ç»œå’Œæµ</h1><p><strong>æµç½‘ç»œ</strong>G=(V,E)æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œå›¾ä¸­æ¯æ¡è¾¹<span class="math inline">\((u,v)\in{E}\)</span>æœ‰ä¸€ä¸ªéžè´Ÿçš„<strong>å®¹é‡å€¼</strong><span class="math inline">\(c(u,v)\ge0\)</span>ã€‚è€Œä¸”ï¼Œå¦‚æžœè¾¹é›†åˆEåŒ…å«ä¸€æ¡è¾¹(u,v)ï¼Œåˆ™å›¾ä¸­ä¸å­˜åœ¨åå‘è¾¹(v,u)ã€‚å¦‚æžœ<span class="math inline">\((u,v)\notin{E}\)</span>ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œå®šä¹‰c(u,v)=0ï¼Œå¹¶ä¸”åœ¨å›¾ä¸­ä¸å…è®¸è‡ªå¾ªçŽ¯ã€‚</p><p>åœ¨æµç½‘ç»œçš„æ‰€æœ‰ç»“ç‚¹ä¸­ï¼Œç‰¹åˆ«åˆ†è¾¨å‡ºä¸¤ä¸ªç‰¹æ®Šç»“ç‚¹ï¼š<strong>æºç»“ç‚¹</strong>så’Œ<strong>æ±‡ç‚¹</strong>tã€‚ä¸ºæ–¹ä¾¿èµ·ç‚¹ï¼Œå‡å®šæ¯ä¸ªç»“ç‚¹éƒ½åœ¨ä»Žæºç»“ç‚¹åˆ°æ±‡ç‚¹çš„æŸæ¡è·¯å¾„ä¸Šã€‚å› æ­¤ï¼Œæµç½‘ç»œå›¾æ˜¯è¿žé€šçš„ï¼Œå¹¶ä¸”ç”±äºŽé™¤æºç»“ç‚¹å¤–çš„æ¯ä¸ªç»“ç‚¹éƒ½è‡³å°‘æœ‰ä¸€æ¡è¿›å…¥çš„è¾¹ï¼Œæœ‰<span class="math inline">\(|E|\ge|V|-1\)</span>ã€‚ä¸‹å›¾æè¿°çš„æ˜¯ä¸€ä¸ªæµç½‘ç»œçš„ä¾‹å­ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/flow-network.png" title="ä¸€ä¸ªæµç½‘ç»œ"></p><a id="more"></a><p>ä¸‹é¢ç»™å‡ºæµçš„å½¢å¼åŒ–å®šä¹‰ã€‚è®¾G=(V,E)ä¸ºä¸€ä¸ªæµç½‘ç»œï¼Œå…¶å®¹é‡å‡½æ•°ä¸ºcã€‚è®¾sä¸ºç½‘ç»œçš„æºç»“ç‚¹ï¼Œtä¸ºæ±‡ç‚¹ã€‚Gä¸­çš„<strong>æµ</strong>æ˜¯ä¸€ä¸ªå®žå€¼å‡½æ•°<span class="math inline">\(f:V\times{V}\rightarrow\mathbb{R}\)</span>ï¼Œæ»¡è¶³ä¸‹é¢çš„ä¸¤æ¡æ€§è´¨ï¼š</p><ul><li>å®¹é‡é™åˆ¶ï¼šå¯¹äºŽæ‰€æœ‰çš„ç»“ç‚¹<span class="math inline">\(u,v\in{V}\)</span>ï¼Œè¦æ±‚<span class="math inline">\(0\le{f(u,v)}\le{c(u,v)}\)</span>ã€‚</li><li>æµé‡å®ˆæ’ï¼šå¯¹äºŽæ‰€æœ‰çš„ç»“ç‚¹<span class="math inline">\(u\in{V-\lbrace{s,t}\rbrace}\)</span>ï¼Œè¦æ±‚</li></ul><p><span class="math display">\[\sum_{v\in{V}}f(v,u)=\sum_{v\in{V}}f(uï¼Œv)\]</span></p><p>å½“<span class="math inline">\((u,v)\notin{E}\)</span>æ—¶ï¼Œä»Žç»“ç‚¹uåˆ°ç»“ç‚¹vä¹‹é—´æ²¡æœ‰æµï¼Œå› æ­¤f(u,v)=0ã€‚</p><p>å®¹é‡é™åˆ¶æ€§è´¨è¯´æ˜Žï¼Œä»Žä¸€ä¸ªç»“ç‚¹åˆ°å¦ä¸€ä¸ªç»“ç‚¹ä¹‹é—´çš„æµå¿…é¡»ä¸ºéžè´Ÿå€¼ä¸”ä¸èƒ½è¶…è¿‡ç»™å®šçš„å®¹é‡é™åˆ¶ã€‚</p><p>æµé‡å®ˆæ’æ€§è´¨è¯´æ˜Žï¼Œæµå…¥ä¸€ä¸ªç»“ç‚¹ï¼ˆæºç»“ç‚¹å’Œæ±‡ç‚¹é™¤å¤–ï¼‰çš„æ€»æµé‡å¿…é¡»ç­‰äºŽæµå‡ºè¯¥èŠ‚ç‚¹çš„æ€»æµé‡ï¼Œâ€œæµå…¥ç­‰äºŽæµå‡ºâ€ã€‚</p><p>ä¸€ä¸ªæµfçš„<strong>å€¼</strong>|f|ï¼ˆè¿™é‡Œï¼Œç¬¦å·| |è¡¨ç¤ºæµçš„å€¼ï¼‰å®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[|f|=\sum_{v\in{V}}f(s,v)-\sum_{v\in{V}}f(v,s)\tag{26.1}\]</span> ä¹Ÿå°±æ˜¯è¯´ï¼Œæµfçš„å€¼æ˜¯ä»Žæºç»“ç‚¹æµå‡ºçš„æ€»æµé‡å‡åŽ»æµå…¥æºç»“ç‚¹çš„æ€»æµé‡ã€‚åœ¨<strong>æœ€å¤§æµé—®é¢˜</strong>ä¸­ï¼Œç»™å®šä¸€ä¸ªæµç½‘ç»œGã€ä¸€ä¸ªæºç»“ç‚¹sã€ä¸€ä¸ªæ±‡ç‚¹tï¼Œå¸Œæœ›æ‰¾åˆ°å€¼æœ€å¤§çš„ä¸€ä¸ªæµã€‚</p><h1 id="åå¹³è¡Œè¾¹å¤šæºç‚¹æ±‡ç‚¹">åå¹³è¡Œè¾¹ã€å¤šæºç‚¹æ±‡ç‚¹</h1><p>ä¸Šè¿°æµç½‘ç»œå‡è®¾ï¼šå¦‚æžœè¾¹<span class="math inline">\((u,v)\in{E}\)</span>ï¼Œåˆ™<span class="math inline">\((v,u)\notin{E}\)</span>ã€‚ç§°(u,v)å’Œè¾¹(v,u)ä¸º<strong>åå¹³è¡Œ</strong>ï¼ˆantiparallelï¼‰ã€‚å¦‚æžœä¸€ä¸ªæµé—®é¢˜ä¸­åŒ…å«åå¹³è¡Œè¾¹ï¼Œå¿…é¡»å°†è¿™ç§ç½‘ç»œè½¬æ¢ä¸ºä¸€ä¸ªç­‰ä»·çš„ä½†ä¸åŒ…å«åå¹³è¡Œè¾¹çš„ç½‘ç»œã€‚ä¸‹å›¾æè¿°çš„å°±æ˜¯è¿™æ ·ä¸€ä¸ªç­‰ä»·ç½‘ç»œã€‚é€‰æ‹©ä¸¤æ¡åå¹³è¡Œè¾¹ä¸­çš„ä¸€æ¡ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯è¾¹<span class="math inline">\((v_1,v_2)\)</span>ï¼Œé€šè¿‡åŠ å…¥ä¸€ä¸ªæ–°ç»“ç‚¹<span class="math inline">\(v^\prime\)</span>æ¥å°†å…¶åˆ†ä¸”ä¸ºä¸¤æ®µï¼Œå¹¶ä»¥è¾¹<span class="math inline">\((v_1,v^\prime)\)</span>å’Œ<span class="math inline">\((v^\prime,v_2)\)</span>æ¥æ›¿æ¢è¾¹<span class="math inline">\((v_1,v_2)\)</span>ã€‚åŒæ—¶å°†ä¸¤æ¡æ–°è®¾ç«‹çš„è¾¹çš„å®¹é‡è®¾ç½®ä¸ºä¸ŽåŽŸæ¥çš„è¾¹çš„å®¹é‡ç›¸åŒã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/flow-network-with-antiparallel-edges.png" title="å¸¦æœ‰åå¹³è¡Œè¾¹çš„æµç½‘ç»œ"></p><p>ä¸€ä¸ªæœ€å¤§æµé—®é¢˜å¯èƒ½æœ‰å‡ ä¸ªæºç»“ç‚¹å’Œå‡ ä¸ªæ±‡ç‚¹ã€‚åœ¨å…·æœ‰å¤šä¸ªæºç»“ç‚¹å’Œæ±‡ç‚¹çš„ç½‘ç»œä¸­ï¼Œç¡®å®šæœ€å¤§æµçš„é—®é¢˜å¯ä»¥è§„çº¦ä¸ºä¸€ä¸ªæ™®é€šçš„æœ€å¤§æµé—®é¢˜ã€‚ä¸‹å›¾(bæè¿°çš„æ˜¯å¦‚ä½•å°†(a)æ‰€ç¤ºçš„ç½‘ç»œè½¬æ¢ä¸ºåªæœ‰ä¸€ä¸ªæºç»“ç‚¹å’Œä¸€ä¸ªæ±‡ç‚¹çš„æ™®é€šæµç½‘ç»œã€‚è½¬æ¢æ–¹æ³•æ˜¯åŠ å…¥ä¸€ä¸ª<strong>è¶…çº§æºç»“ç‚¹</strong>sï¼Œå¹¶åŠ å…¥æœ‰å‘è¾¹<span class="math inline">\((s,s_i),i=1,2,\dots,m\)</span>ï¼Œå…¶å®¹é‡<span class="math inline">\(c(s,s_i)=\infty\)</span>ã€‚åŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„<strong>è¶…çº§æ±‡ç‚¹</strong>tï¼Œå¹¶åŠ å…¥æœ‰å‘è¾¹<span class="math inline">\((t_i,t),i=1,2,\dots,n\)</span>ï¼Œå…¶å®¹é‡<span class="math inline">\(c(t_i,t)=\infty\)</span>ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/flow-network-with-multiple-source-multiple-sink.png" title="å«æœ‰å¤šä¸ªæºç»“ç‚¹å’Œæ±‡ç‚¹çš„æµç½‘ç»œ"></p><h1 id="ford-fulkersonæ–¹æ³•">Ford-Fulkersonæ–¹æ³•</h1><p>Ford-Fulkersonæ–¹æ³•æ˜¯è§£å†³æœ€å¤§æµé—®é¢˜çš„ä¸€ç§æ–¹æ³•ã€‚ä¹‹æ‰€ä»¥ç§°å…¶ä¸ºâ€œæ–¹æ³•â€è€Œä¸æ˜¯â€œç®—æ³•â€ï¼Œæ˜¯å› ä¸ºå®ƒåŒ…å«äº†å‡ ç§è¿è¡Œæ—¶é—´å„ä¸ç›¸åŒçš„å…·ä½“å®žçŽ°ã€‚Ford-Fulkersonæ–¹æ³•ä¾èµ–äºŽä¸‰ç§é‡è¦æ€æƒ³ï¼Œå®ƒä»¬ä¸Žè®¸å¤šçš„æµç®—æ³•å’Œé—®é¢˜æœ‰å…³ï¼šæ®‹å­˜ç½‘ç»œã€å¢žå¹¿è·¯å¾„å’Œåˆ‡å‰²ã€‚è¿™äº›æ€æƒ³æ˜¯æœ€å¤§æµæœ€å°åˆ‡å‰²å®šç†çš„ç²¾é«“ã€‚</p><p>Ford-Fulkersonæ–¹æ³•å¾ªçŽ¯å¢žåŠ æµçš„å€¼ã€‚</p><ul><li>åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œå¯¹äºŽæ‰€æœ‰çš„ç»“ç‚¹<span class="math inline">\(u,v\in{V}\)</span>ï¼Œf(u,v)=0ï¼Œç»™å‡ºçš„åˆå§‹æµå€¼ä¸º0ã€‚</li><li>åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œå°†å›¾Gçš„æµå€¼è¿›è¡Œå¢žåŠ ï¼Œæ–¹æ³•æ˜¯åœ¨ä¸€ä¸ªå…³è”çš„â€œæ®‹å­˜ç½‘ç»œâ€<span class="math inline">\(G_f\)</span>ä¸­å¯»æ‰¾ä¸€æ¡â€œå¢žå¹¿è·¯å¾„â€ã€‚å¢žåŠ çš„æ˜¯æ•´ä¸ªç½‘ç»œä¸­çš„æµé‡ï¼Œå¯¹äºŽå›¾ä¸­ç‰¹å®šçš„ä¸€æ¡è¾¹æ¥è¯´ï¼Œå…¶æµé‡åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯èƒ½å¢žåŠ ï¼Œä¹Ÿå¯èƒ½å‡å°‘ã€‚å¯¹æŸäº›è¾¹çš„æµè¿›è¡Œç¼©å‡å¯èƒ½æ˜¯å¿…è¦çš„ï¼Œä»¥ä¾¿è®©ç®—æ³•å¯ä»¥å°†æ›´å¤šçš„æµä»Žæºç»“ç‚¹å‘é€åˆ°æ±‡ç‚¹ã€‚</li><li>é‡å¤å¯¹æµè¿›è¡Œä¸Šè¿°è¿­ä»£è¿‡ç¨‹ï¼Œç›´åˆ°æ®‹å­˜ç½‘ç»œä¸­ä¸å†å­˜åœ¨å¢žå¹¿è·¯å¾„æœªçŸ¥ã€‚æœ€å¤§æµæœ€å°åˆ‡å‰²å®šç†å°†è¯´æ˜Žåœ¨ç®—æ³•ç»ˆæ­¢æ—¶ï¼Œå°†èŽ·å¾—ä¸€ä¸ªæœ€å¤§æµã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FORD-FULKERSON-METHOD(G, s, t):</span><br><span class="line">    initialize flow f to <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> there exists an augmenting path p <span class="keyword">in</span> the residual network:</span><br><span class="line">        augment flow f along p</span><br><span class="line">    <span class="keyword">return</span> f</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®žçŽ°å’Œåˆ†æžFord-Fulkersonæ–¹æ³•ï¼Œéœ€è¦å¼•å…¥å‡ ä¸ªæ–°çš„æ¦‚å¿µã€‚</p><h2 id="æ®‹å­˜ç½‘ç»œ">æ®‹å­˜ç½‘ç»œ</h2><p>ä»Žç›´è§‚ä¸Šçœ‹ï¼Œç»™å®šæµç½‘ç»œGå’Œæµé‡fï¼Œæ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ç”±é‚£äº›ä»æœ‰ç©ºé—´å¯¹æµé‡è¿›è¡Œè°ƒæ•´çš„è¾¹æž„æˆã€‚</p><ul><li>æµç½‘ç»œçš„ä¸€æ¡è¾¹å¯ä»¥å…è®¸çš„é¢å¤–æµé‡ç­‰äºŽè¯¥è¾¹çš„å®¹é‡å‡åŽ»è¯¥è¾¹ä¸Šçš„æµé‡ã€‚å¦‚æžœè¯¥å·®å€¼ä¸ºæ­£ï¼Œåˆ™å°†è¯¥æ¡è¾¹ç½®äºŽå›¾<span class="math inline">\(G_f\)</span>ä¸­ï¼Œå¹¶å°†å…¶æ®‹å­˜å®¹é‡è®¾ç½®ä¸º<span class="math inline">\(c_f(u,v)=c(u,v)-f(u,v)\)</span>ã€‚å¦‚æžœè¾¹(u,v)çš„æµé‡ç­‰äºŽå…¶å®¹é‡ï¼Œåˆ™å…¶<span class="math inline">\(c_f(u,v)=0\)</span>ï¼Œè¯¥æ¡è¾¹å°†ä¸å±žäºŽ<span class="math inline">\(G_f\)</span>ã€‚</li><li>æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>è¿˜å¯èƒ½åŒ…å«å›¾Gä¸­ä¸å­˜åœ¨çš„è¾¹ã€‚ç®—æ³•å¯¹æµé‡è¿›è¡Œæ“ä½œçš„ç›®æ ‡æ˜¯å¢žåŠ æ€»æµé‡ï¼Œä¸ºæ­¤ï¼Œç®—æ³•å¯èƒ½å¯¹æŸäº›ç‰¹å®šè¾¹ä¸Šçš„æµé‡è¿›è¡Œç¼©å‡ã€‚ä¸ºäº†è¡¨ç¤ºå¯¹ä¸€ä¸ªæ­£æµé‡f(u,v)çš„ç¼©å‡ï¼Œå°†è¾¹(v,u)åŠ å…¥åˆ°å›¾<span class="math inline">\(G_f\)</span>ä¸­ï¼Œå¹¶å°†å…¶æ®‹å­˜å®¹é‡è®¾ç½®ä¸º<span class="math inline">\(c_f(v,u)=f(u,v)\)</span>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ¡è¾¹æ‰€èƒ½å…è®¸çš„åå‘æµé‡æœ€å¤šå°†å…¶æ­£å‘æµé‡æŠµæ¶ˆã€‚</li></ul><p>æ®‹å­˜ç½‘ç»œä¸­çš„è¿™äº›åå‘è¾¹å…è®¸ç®—æ³•å°†å·²ç»å‘é€å‡ºæ¥çš„æµé‡å‘é€å›žåŽ»ã€‚è€Œå°†æµé‡ä»ŽåŒä¸€æ¡è¾¹å‘é€å›žåŽ»ç­‰åŒäºŽç¼©å‡è¯¥æ¡è¾¹çš„æµé‡ï¼Œè¿™ç§æ“ä½œåœ¨è®¸å¤šç®—æ³•ä¸­éƒ½æ˜¯å¿…è¦çš„ã€‚</p><p>æ›´å½¢å¼åŒ–åœ°ï¼Œå‡å®šç”±ä¸€ä¸ªæµç½‘ç»œG=(V,E)ï¼Œå…¶æºç»“ç‚¹ä¸ºsï¼Œæ±‡ç‚¹ä¸ºtã€‚è®¾fä¸ºå›¾Gä¸­çš„ä¸€ä¸ªæµï¼Œè€ƒè™‘ç»“ç‚¹å¯¹<span class="math inline">\(u,v\in{V}\)</span>ï¼Œå®šä¹‰æ®‹å­˜å®¹é‡<span class="math inline">\(c_f(u,v)\)</span>å¦‚ä¸‹ï¼š <span class="math display">\[c_f(u,v)=\begin{cases}c(u,v)-f(u,v)&amp;\text{if }(u,v)\in{E}\\f(v,u)&amp;\text{if }(v,u)\in{E}\\0&amp;otherwise\end{cases}\tag{26.2}\]</span> å› ä¸ºå‡å®šè¾¹<span class="math inline">\((u,v)\in{E}\)</span>æ„å‘³ç€<span class="math inline">\((v,u)\notin{E}\)</span>ï¼ˆå¯¹æµç½‘ç»œçš„å‡è®¾ï¼‰ï¼Œå¯¹äºŽæ¯ä¸€å¯¹è¾¹æ¥è¯´ï¼Œä¸Šè¿°å…¬å¼ä¸­åªæœ‰ä¸€ç§æƒ…å†µæˆç«‹ã€‚ä¸‹å›¾ä¸­ï¼Œ(a)æ‰€ç¤ºçš„æµç½‘ç»œä¸­æµfæ‰€å¯¹åº”çš„æ®‹å­˜ç½‘ç»œå¦‚(b)æ‰€ç¤ºã€‚</p><p>ç»™å®šä¸€ä¸ªæµç½‘ç»œG=(V,E)å’Œä¸€ä¸ªæµfï¼Œåˆ™ç”±fæ‰€è¯±å¯¼çš„å›¾Gçš„æ®‹å­˜ç½‘ç»œä¸º<span class="math inline">\(G_f=(V,E_f)\)</span>ï¼Œå…¶ä¸­ <span class="math display">\[E_f=\lbrace(u,v)\in{V\times{V}}:c_f(u,v)&gt;0\rbrace\]</span> ä¹Ÿå°±æ˜¯è¯´ï¼Œæ®‹å­˜ç½‘ç»œçš„æ¯æ¡è¾¹æˆ–<strong>æ®‹å­˜è¾¹</strong>ï¼Œå¿…é¡»å…è®¸å¤§äºŽ0çš„æµé‡é€šè¿‡ã€‚å›¾(a)ç»™å‡ºäº†æµç½‘ç»œGå’Œæµé‡fï¼Œå›¾(b)æè¿°çš„æ˜¯å¯¹åº”çš„æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ã€‚<span class="math inline">\(E_f\)</span>ä¸­çš„è¾¹è¦ä¹ˆæ˜¯Eä¸­åŽŸæœ‰çš„è¾¹ï¼Œè¦ä¹ˆæ˜¯å…¶åå‘è¾¹ï¼Œå› æ­¤æœ‰ <span class="math display">\[|E_f|\le2|E|\]</span></p><p><img src="/uploads/image/introduction-to-algorithms/maximum-flow-problem.png" title="æœ€å¤§æµé—®é¢˜ä»¥åŠæ®‹å­˜ç½‘ç»œ"></p><p>å¯ä»¥åœ¨æ®‹å­˜ç½‘ç»œä¸­å®šä¹‰ä¸€ä¸ªæµï¼Œå®ƒæ»¡è¶³æµçš„å®šä¹‰ï¼Œä½†æ˜¯é’ˆå¯¹çš„æ˜¯æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­çš„å®¹é‡<span class="math inline">\(c_f\)</span>ã€‚æ®‹å­˜ç½‘ç»œä¸­çš„ä¸€ä¸ªæµæŒ‡å‡ºçš„æ˜¯ä¸€æ¡è·¯çº¿å›¾ï¼šå¦‚ä½•åœ¨åŽŸæ¥çš„æµç½‘ç»œä¸­å¢žåŠ æµã€‚å¦‚æžœfæ˜¯Gçš„ä¸€ä¸ªæµï¼Œ<span class="math inline">\(f^\prime\)</span>æ˜¯å¯¹åº”çš„æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­çš„ä¸€ä¸ªæµï¼Œå®šä¹‰<span class="math inline">\(f\uparrow{f^\prime}\)</span>ä¸ºæµ<span class="math inline">\(f^\prime\)</span>å¯¹æµfçš„<strong>é€’å¢ž</strong>ï¼ˆaugmentationï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»Ž<span class="math inline">\(V\times{V}\)</span>åˆ°<span class="math inline">\(\mathbb{R}\)</span>çš„å‡½æ•°ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[(f\uparrow{f^\prime})(u,v)=\begin{cases}f(u,v)+f^\prime(u,v)-f^\prime(v,u)&amp;if (u,v)\in{E}\\0&amp;otherwise\end{cases}\tag{26.4}\]</span></p><p>è¯¥å®šä¹‰èƒŒåŽçš„ç›´è§‚è§£é‡Šéµå¾ªæ®‹å­˜ç½‘ç»œçš„å®šä¹‰ã€‚å› ä¸ºåœ¨æ®‹å­˜ç½‘ç»œä¸­å°†æµé‡å‘é€åˆ°åå‘è¾¹ä¸Šç­‰åŒäºŽåœ¨åŽŸæ¥çš„ç½‘ç»œä¸­ç¼©å‡æµé‡ï¼Œæ‰€ä»¥å°†è¾¹(u,v)çš„æµé‡å¢žåŠ äº†<span class="math inline">\(f^\prime(u,v)\)</span>ï¼Œä½†å‡å°‘äº†<span class="math inline">\(f^\prime(v,u)\)</span>ã€‚åœ¨æ®‹å­˜ç½‘ç»œä¸­å°†æµé‡æŽ¨é€å›žåŽ»ä¹Ÿç§°ä¸º<strong>æŠµæ¶ˆæ“ä½œ</strong>ï¼ˆcancellationï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœå°†5è´§ç®±çš„å†°çƒä»ŽåŸŽå¸‚uå‘é€åˆ°åŸŽå¸‚vï¼ŒåŒæ—¶å°†2è´§ç®±å†°çƒä»ŽåŸŽå¸‚vå‘é€åˆ°åŸŽå¸‚uï¼Œé‚£ä¹ˆå¯ä»¥ç­‰ä»·ï¼ˆä»¥æœ€åŽç»“æžœæ¥çœ‹ï¼‰åœ°å°†3è´§ç®±å†°çƒä»ŽåŸŽå¸‚uå‘é€åˆ°åŸŽå¸‚vï¼Œè€Œä¸ä»ŽåŸŽå¸‚vå‘é€è´§ç®±åˆ°åŸŽå¸‚uã€‚è¿™ç±»æŠµæ¶ˆæ“ä½œå¯¹äºŽä»»ä½•æœ€å¤§æµç®—æ³•æ¥è¯´éƒ½æ˜¯éžå¸¸å…³é”®çš„ã€‚</p><blockquote><p>å¼•ç†26.1</p><p>è®¾G=(V,E)ä¸ºä¸€ä¸ªæµç½‘ç»œï¼Œæºç»“ç‚¹ä¸ºsï¼Œæ±‡ç‚¹ä¸ºtï¼Œè®¾fä¸ºGä¸­çš„ä¸€ä¸ªæµã€‚è®¾<span class="math inline">\(G_f\)</span>ä¸ºç”±æµfæ‰€è¯±å¯¼çš„Gçš„æ®‹å­˜ç½‘ç»œï¼Œè®¾<span class="math inline">\(f^\prime\)</span>ä¸º<span class="math inline">\(G_f\)</span>ä¸­çš„ä¸€ä¸ªæµã€‚é‚£ä¹ˆå¼(26.4)æ‰€å®šä¹‰çš„å‡½æ•°<span class="math inline">\(f\uparrow{f^\prime}\)</span>æ˜¯Gçš„ä¸€ä¸ªæµï¼Œå…¶å€¼<span class="math inline">\(|f\uparrow{f^\prime}|=|f|+|f^\prime|\)</span>ã€‚</p></blockquote><p><strong>è¯æ˜Ž</strong>ï¼šé¦–å…ˆè¯æ˜Ž<span class="math inline">\(f\uparrow{f^\prime}\)</span>æ˜¯Gçš„ä¸€ä¸ªæµï¼Œå³æ»¡è¶³æµçš„ä¸¤æ¡æ€§è´¨ï¼šå®¹é‡é™åˆ¶å’Œæµé‡å®ˆæ’ã€‚</p><p>å¯¹äºŽå®¹é‡é™åˆ¶ï¼Œæ³¨æ„åˆ°ï¼Œå¦‚æžœè¾¹<span class="math inline">\((u,v)\in{E}\)</span>ï¼Œåˆ™<span class="math inline">\(c_f(v,u)=f(u,v)\)</span>ã€‚è€Œä¸”<span class="math inline">\(f^\prime(v,u)\le{c_f(v,u)}=f(u,v)\)</span>ã€‚å› æ­¤ï¼Œ <span class="math display">\[\begin{aligned}(f\uparrow{f^\prime})(u,v)&amp;=f(u,v)+f^\prime(u,v)-f^\prime(v,u)&amp;\text{(by equation(26.4))}\\&amp;\ge{f(u,v)+f^\prime(u,v)}-f(u,v)&amp;\text{(because }f^\prime(v,u)\le{f(u,v)}\text{)}\\&amp;=f^\prime(u,v)\\&amp;\ge0\end{aligned}\]</span> æ­¤å¤–ï¼Œ <span class="math display">\[\begin{aligned}(f\uparrow{f^\prime})(u,v)&amp;=f(u,v)+f^\prime(u,v)-f^\prime(v,u)&amp;\text{(by equation(26.4))}\\&amp;\le{f(u,v)+f^\prime(u,v)}&amp;\text{(because flows are nonnegative}\\&amp;\le{f(u,v)+c_f(u,v)}&amp;\text{(capacity constraint)}\\&amp;=f(u,v)+c(u,v)-f(u,v)&amp;\text{(by definition (26.2))}\\&amp;=c(u,v)\end{aligned}\]</span></p><p>å¯¹äºŽæµé‡å®ˆæ’æ€§è´¨ï¼Œå› ä¸ºfå’Œ<span class="math inline">\(f^\prime\)</span>å‡éµå®ˆæµé‡å®ˆæ’æ€§è´¨ï¼Œæ‰€ä»¥æœ‰<span class="math inline">\(f(u,v)=f(v,u)\)</span>å’Œ<span class="math inline">\(f^\prime(u,v)=f^\prime(v,u)\)</span>ã€‚å› æ­¤ï¼Œå¯¹äºŽæ‰€æœ‰çš„ç»“ç‚¹<span class="math inline">\(u\in{V-\lbrace{s,t}\rbrace}\)</span>ï¼Œæœ‰</p><p><span class="math display">\[\begin{aligned}\sum_{v\in{V}}(f\uparrow{f^\prime})(u,v)&amp;=\sum_{v\in{V}}(f(u,v)+f^\prime(u,v)-f^\prime(v,u))\\&amp;=\sum_{v\in{V}}f(u,v)+\sum_{v\in{V}}f^\prime(u,v)-\sum_{v\in{V}}f^\prime(v,u)\\&amp;=\sum_{v\in{V}}f(v,u)+\sum_{v\in{V}}f^\prime(v,u)-\sum_{v\in{V}}f^\prime(u,v)\\&amp;=\sum_{v\in{V}}(f(v,u)+f^\prime(v,u)-f^\prime(u,v))\\&amp;=\sum_{v\in{V}}(f\uparrow{f^\prime})(v,u)\end{aligned}\]</span></p><p>æœ€åŽï¼Œè®¡ç®—<span class="math inline">\(f\uparrow{f^\prime}\)</span>çš„å€¼ã€‚å°†é¡¶ç‚¹é›†åˆåˆ†<span class="math inline">\(V_1\)</span>å’Œ<span class="math inline">\(V_2\)</span>ä¸¤ä¸ªé›†åˆã€‚å®šä¹‰<span class="math inline">\(V_1=\lbrace{v:(s,v)\in{E}}\rbrace\)</span>ä¸ºæœ‰è¾¹ä»Žæºç»“ç‚¹såˆ°è¾¾çš„ç»“ç‚¹é›†åˆï¼Œ<span class="math inline">\(V_2=\lbrace{v:(v,s)\in{E}}\rbrace\)</span>ä¸ºæœ‰è¾¹é€šå¾€sçš„ç»“ç‚¹é›†åˆï¼Œæœ‰<span class="math inline">\(V_1\bigcup{V_2}\subseteq{V}\)</span>ã€‚å¹¶ä¸”å› ä¸ºä¸å…è®¸æœ‰åå¹³è¡Œè¾¹ï¼Œåˆæœ‰<span class="math inline">\(V_1\bigcap{V_2}=\varnothing\)</span>ã€‚çŽ°åœ¨æ¥è®¡ç®—</p><p><span class="math display">\[\begin{aligned}|f\uparrow{f^\prime}|&amp;=\sum_{v\in{V}}(f\uparrow{f^\prime})(s,v)-\sum_{v\in{V}}(f\uparrow{f^\prime})(v,s)\\&amp;=\sum_{v\in{V_1\cup{V_2}}}(f\uparrow{f^\prime})(s,v)-\sum_{v\in{V_1\cup{V_2}}}(f\uparrow{f^\prime})(v,s)\\\end{aligned}\tag{26.5}\]</span> å›žå¿†ä¹‹é—´çš„å†…å®¹ï¼Œå¯¹äºŽè¾¹<span class="math inline">\((u,v)\notin{E}\)</span>ï¼Œå®šä¹‰f(u,v)=0ï¼Œå› æ­¤æœ‰<span class="math inline">\(f(s,v)=0\text{, if }{v\in{V_2}}\)</span>å’Œ<span class="math inline">\(f(v,s)=0\text{, if }{v\in{V_1}}\)</span>ã€‚çŽ°åœ¨å°†<span class="math inline">\(f\uparrow{f^\prime}\)</span>çš„å®šä¹‰åº”ç”¨åˆ°å¼(26.5)ä¸Šï¼Œç„¶åŽå¯¹å’Œå€¼é¡¹è¿›è¡Œé‡æ–°æŽ’åºä¸Žé‡ç»„å¯ä»¥èŽ·å¾—ï¼š <span class="math display">\[\begin{aligned}|f\uparrow{f^\prime}|&amp;=\sum_{v\in{V_1}}(f\uparrow{f&#39;})(s,v)-\sum_{v\in{V_2}}(f\uparrow{f&#39;})(v,s)\\&amp;=\sum_{v\in{V_1}}(f(s,v)+f&#39;(s,v)-f&#39;(v,s))-\sum_{v\in{V_2}}(f(v,s)+f&#39;(v,s)-f&#39;(s,v))\\&amp;=\sum_{v\in{V_1}}f(s,v)-\sum_{v\in{V_2}}f(v,s)+\sum_{v\in{V_1}}f&#39;(s,v)+\sum_{v\in{V_2}}f&#39;(s,v)-\sum_{v\in{V_1}}f&#39;(v,s)-\sum_{v\in{V_2}}f&#39;(v,s)\\&amp;=\sum_{v\in{V_1}}f(s,v)-\sum_{v\in{V_2}}f(v,s)+\sum_{v\in{V_1\bigcup{V_2}}}f&#39;(s,v)-\sum_{v\in{V_1\bigcup{V_2}}}f&#39;(v,s)\\&amp;=\sum_{v\in{V}}f(s,v)-\sum_{v\in{V}}f(v,s)+\sum_{v\in{V}}f&#39;(s,v)-\sum_{v\in{V}}f&#39;(v,s)\\&amp;=|f|+|f&#39;|\end{aligned}\]</span></p><h2 id="å¢žå¹¿è·¯å¾„">å¢žå¹¿è·¯å¾„</h2><p>ç»™å®šæµç½‘ç»œG=(V,E)å’Œæµfï¼Œå¢žå¹¿è·¯å¾„pæ˜¯æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­ä¸€æ¡ä»Žæºç»“ç‚¹åˆ°æ±‡ç‚¹tçš„ç®€å•è·¯å¾„ã€‚æ ¹æ®æ®‹å­˜ç½‘ç»œçš„å®šä¹‰ï¼Œå¯¹äºŽä¸€æ¡å¢žå¹¿è·¯å¾„ä¸Šçš„è¾¹(u,v)ï¼Œå¯ä»¥å¢žåŠ å…¶æµé‡çš„å¹…åº¦æœ€å¤§ä¸º<span class="math inline">\(c_f(u,v)\)</span>ï¼Œè€Œä¸ä¼šè¿ååŽŸå§‹æµç½‘ç»œGä¸­å¯¹è¾¹(u,v)æˆ–(v,u)çš„å®¹é‡é™åˆ¶ã€‚</p><p>ä¸Šå›¾(b)ä¸­é˜´å½±è¦†ç›–çš„è·¯å¾„æ˜¯ä¸€æ¡å¢žå¹¿è·¯å¾„ã€‚å¦‚æžœå°†å›¾ä¸­çš„æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>çœ‹ä½œä¸€ä¸ªæµç½‘ç»œï¼Œé‚£ä¹ˆå¯ä»¥å¯¹è¿™æ¡è·¯å¾„ä¸Šæ¯æ¡è¾¹çš„æµé‡å¢žåŠ 4ä¸ªå•ä½ï¼Œè€Œä¸ä¼šè¿åå®¹é‡é™åˆ¶ï¼Œå› ä¸ºè¯¥æ¡è·¯å¾„ä¸Šæœ€å°çš„æ®‹å­˜å®¹é‡æ˜¯<span class="math inline">\(c_f(v_2,v_3)=4\)</span>ã€‚ç§°åœ¨ä¸€æ¡å¢žå¹¿è·¯å¾„pä¸Šèƒ½å¤Ÿä¸ºæ¯æ¡è¾¹å¢žåŠ çš„æµé‡çš„æœ€å¤§å€¼ä¸ºè·¯å¾„pçš„<strong>æ®‹å­˜å®¹é‡</strong>ï¼Œè¯¥å®¹é‡ç”±ä¸‹é¢çš„è¡¨è¾¾å¼ç»™å‡ºï¼š <span class="math display">\[c_f(p)=min\lbrace{c_f(u,v):(u,v)\text{ å±žäºŽè·¯å¾„ }p}\rbrace\]</span></p><p>ä¸‹é¢ç²¾ç¡®é˜è¿°æ®‹å­˜ç½‘ç»œä¸­çš„æµï¼š</p><blockquote><p>å¼•ç†26.2</p><p>è®¾G=(V,E)ä¸ºä¸€ä¸ªæµç½‘ç»œï¼Œè®¾fä¸ºGä¸­çš„ä¸€ä¸ªæµï¼Œè®¾pä¸ºæ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­çš„ä¸€æ¡å¢žå¹¿è·¯å¾„ã€‚å®šä¹‰ä¸€ä¸ªå‡½æ•°<span class="math inline">\(f_p:V\times{V}\rightarrow\mathbb{R}\)</span>å¦‚ä¸‹ï¼š <span class="math display">\[f_p(u,v)=\begin{cases}c_f(p)&amp;\text{if }(u,v)\text{ is on }p\\0&amp;otherwise\end{cases}\tag{26.8}\]</span> åˆ™<span class="math inline">\(f_p\)</span>æ˜¯æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­çš„ä¸€ä¸ªæµï¼Œå…¶å€¼ä¸º<span class="math inline">\(|f_p|=c_f(p)&gt;0\)</span>ã€‚</p></blockquote><p>å¼(26.8)è¡¨ç¤ºï¼Œæ®‹å­˜ç½‘ç»œä¸­åœ¨å¢žå¹¿è·¯å¾„pä¸Šçš„è¾¹çš„æµé‡ç­‰äºŽæ®‹å­˜å®¹é‡<span class="math inline">\(c_f(p)\)</span>ï¼Œä¸åœ¨å¢žå¹¿è·¯å¾„pä¸Šçš„è¾¹çš„æµé‡ä¸º0ã€‚</p><p>ä¸‹é¢çš„æŽ¨è®ºè¯æ˜Žï¼Œå¦‚æžœå°†æµfå¢žåŠ <span class="math inline">\(f_p\)</span>çš„é‡ï¼Œåˆ™å°†èŽ·å¾—Gçš„å¦ä¸€ä¸ªæµï¼Œè¯¥æµçš„å€¼æ›´åŠ æŽ¥è¿‘æœ€å¤§å€¼ã€‚</p><blockquote><p>æŽ¨è®º26.3</p><p>è®¾G=(V,E)ä¸ºä¸€ä¸ªæµç½‘ç»œï¼Œè®¾fä¸ºGä¸­çš„ä¸€ä¸ªæµï¼Œè®¾pä¸ºæ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­çš„ä¸€æ¡å¢žå¹¿è·¯å¾„ã€‚è®¾<span class="math inline">\(f_p\)</span>ç”±å¼(26.8)æ‰€å®šä¹‰ï¼Œå‡å®šå°†få¢žåŠ <span class="math inline">\(f_p\)</span>çš„é‡ï¼Œåˆ™å‡½æ•°<span class="math inline">\(f\uparrow{f_p}\)</span>æ˜¯å›¾Gä¸­çš„ä¸€ä¸ªæµï¼Œå…¶å€¼ä¸º<span class="math inline">\(|f\uparrow{f_p}|=|f|+|f_p|&gt;|f|\)</span>ã€‚</p></blockquote><p><strong>è¯æ˜Ž</strong>ï¼šæ ¹æ®å¼•ç†26.1å’Œå¼•ç†26.2å¯å¾—åˆ°ä¸Šè¿°ç»“è®ºã€‚</p><h2 id="æµç½‘ç»œçš„åˆ‡å‰²">æµç½‘ç»œçš„åˆ‡å‰²</h2><p>Ford-Fulkersonæ–¹æ³•çš„æ ¸å¿ƒå°±æ˜¯æ²¿ç€å¢žå¹¿è·¯å¾„é‡å¤å¢žåŠ è·¯å¾„ä¸Šçš„æµé‡ï¼Œç›´åˆ°æ‰¾åˆ°æœ€å¤§æµä¸ºæ­¢ã€‚å¦‚ä½•çŸ¥é“åœ¨ç®—æ³•ä¸­ç»ˆæ­¢æ—¶ï¼Œç¡®å®žæ‰¾åˆ°äº†ä¸€ä¸ªæœ€å¤§æµå‘¢ï¼Ÿæœ€å¤§æµæœ€å°å‰²å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸€ä¸ªæµæ˜¯æœ€å¤§æµå½“ä¸”ä»…å½“å…¶æ®‹å­˜ç½‘ç»œä¸­ä¸åŒ…å«ä»»ä½•å¢žå¹¿è·¯å¾„ã€‚ä¸ºäº†è¯æ˜Žè¿™ä¸ªå®šç†ï¼Œé¦–å…ˆæ¥æŽ¢è®¨ä¸€ä¸‹æµç½‘ç»œä¸­çš„åˆ‡å‰²æ¦‚å¿µã€‚</p><p>æµç½‘ç»œG=(V,E)ä¸­çš„ä¸€ä¸ªåˆ‡å‰²(S,T)å°†ç»“ç‚¹é›†åˆVåˆ’åˆ†ä¸ºSå’ŒT=V-Sä¸¤ä¸ªé›†åˆï¼Œä½¿å¾—<span class="math inline">\(s\in{S},t\in{T}\)</span>ã€‚è‹¥fæ˜¯ä¸€ä¸ªæµï¼Œåˆ™å®šä¹‰æ¨ªè·¨åˆ‡å‰²(S,T)çš„<strong>å‡€æµé‡</strong>f(S,T)å¦‚ä¸‹ï¼š <span class="math display">\[f(S,T)=\sum_{u\in{S}}\sum_{v\in{T}}f(u,v)-\sum_{u\in{S}}\sum_{v\in{T}}f(v,u)\tag{26.9}\]</span> åˆ‡å‰²(S,T)çš„<strong>å®¹é‡</strong>æ˜¯ï¼š <span class="math display">\[c(S,T)=\sum_{u\in{S}}\sum_{v\in{T}}c(u,v)\tag{26.10}\]</span> ä¸€ä¸ªç½‘ç»œçš„æœ€å°åˆ‡å‰²æ˜¯æ•´ä¸ªç½‘ç»œä¸­<strong>å®¹é‡æœ€å°</strong>çš„åˆ‡å‰²ã€‚</p><p>æµçš„å®šä¹‰å’Œåˆ‡å‰²å®¹é‡çš„å®šä¹‰ä¹‹é—´å­˜åœ¨ç€ä¸å¯¹ç§°æ€§ï¼Œè¿™ç§ä¸å¯¹ç§°æ€§æ˜¯æœ‰æ„è€Œä¸ºï¼Œå¹¶ä¸”å¾ˆé‡è¦ã€‚</p><ul><li>å¯¹äºŽå®¹é‡ï¼Œè®¡ç®—ä»Žé›†åˆSå‘å‡ºè¿›å…¥é›†åˆTçš„è¾¹çš„å®¹é‡ï¼Œè€Œå¿½ç•¥åæ–¹å‘è¾¹ä¸Šçš„å®¹é‡ã€‚</li><li>å¯¹äºŽæµï¼Œè€ƒè™‘çš„åˆ™æ˜¯ä»ŽSåˆ°Tçš„æµé‡å‡åŽ»ä»ŽTåˆ°Sçš„åæ–¹å‘çš„æµé‡ã€‚</li></ul><p>ä¸‹å›¾æè¿°çš„æ˜¯æµç½‘ç»œçš„ä¸€ä¸ªåˆ‡å‰²ï¼ˆ<span class="math inline">\(\lbrace{s,v_1,v_2}\rbrace,\lbrace{v_3,v_4,t}\rbrace\)</span>ï¼‰ã€‚æ¨ªè·¨è¯¥åˆ‡å‰²çš„å‡€æµé‡æ˜¯<span class="math inline">\(f(v_1,v_3)+f(v_2,v_4)-f(v_3,v_2)=12+11-4=19\)</span>ã€‚è¯¥åˆ‡å‰²çš„å®¹é‡æ˜¯<span class="math inline">\(c(v_1,v_3)+c(v_2,v_4)=12+14=26\)</span>ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/s-t-cut-in-flow-network.png" title="æµç½‘ç»œçš„ä¸€ä¸ªSTåˆ‡å‰²"></p><blockquote><p>å¼•ç†26.4</p><p>è®¾fä¸ºæµç½‘ç»œGçš„ä¸€ä¸ªæµï¼Œè¯¥æµç½‘ç»œçš„æºç»“ç‚¹ä¸ºsï¼Œæ±‡ç‚¹ä¸ºtï¼Œè®¾(S,T)ä¸ºæµç½‘ç»œGçš„ä»»æ„åˆ‡å‰²ï¼Œåˆ™æ¨ªè·¨åˆ‡å‰²(S,T)çš„å‡€æµé‡ä¸ºf(S,T)=|f|ã€‚</p></blockquote><p>ç›´è§‚ä¸Šï¼Œä»Žæºç»“ç‚¹så‘å¾€æ±‡ç‚¹tçš„æµé‡å¿…ç„¶ç»è¿‡åˆ‡å‰²çš„è¾¹ç•Œï¼ˆå›¾ä¸­è™šçº¿ï¼‰,å¹¶ä¸”æµæ»¡è¶³æµé‡å®ˆæ’æ€§è´¨ï¼Œè¡¨æ˜Žæ‰€æœ‰ä»Žæºç»“ç‚¹så‘å‡ºçš„æµé‡æœ€ç»ˆéƒ½ä¼šæµå…¥æ±‡ç‚¹tã€‚å› æ­¤æ‰€æœ‰æ¨ªè·¨è¾¹ç•Œçš„å‡€æµé‡ç­‰äºŽæµçš„å€¼ã€‚</p><p>å½¢å¼åŒ–åœ°ï¼šå¯¹äºŽä»»æ„ç»“ç‚¹<span class="math inline">\(u\in{V-\lbrace{s,t}\rbrace}\)</span>ï¼Œé‡å†™ï¼ˆå°†å³è¾¹çš„å­å¼ç§»åˆ°å·¦è¾¹ï¼‰æµé‡å®ˆæ’æ€§è´¨å¦‚ä¸‹ï¼š <span class="math display">\[\begin{aligned}\sum_{v\in{V}}f(u,v)-\sum_{v\in{V}}f(v,u)=0\qquad{u\in{V-\lbrace{s,t}\rbrace}}\end{aligned}\tag{26.11}\]</span> é’ˆå¯¹æ‰€æœ‰ç»“ç‚¹<span class="math inline">\(S-\lbrace{s}\rbrace\)</span>æ±‚å’Œï¼š <span class="math display">\[\sum_{u\in{S-\{s\}}}(\sum_{v\in{V}}f(u,v)-\sum_{v\in{V}}f(v,u))=0\]</span> æ ¹æ®å¼(26.1)å¯¹|f|çš„å®šä¹‰ï¼Œå°†ä¸Šå¼çš„å·¦é¡¹åŠ è¿›æ¥ï¼š <span class="math display">\[\begin{aligned}|f|&amp;=\sum_{v\in{V}}f(s,v)-\sum_{v\in{V}}f(v,s)+\sum_{u\in{S-\{s\}}}(\sum_{v\in{V}}f(u,v)-\sum_{v\in{V}}f(v,u))\\&amp;=\sum_{v\in{V}}f(s,v)-\sum_{v\in{V}}f(v,s)+\sum_{u\in{S-\{s\}}}\sum_{v\in{V}}f(u,v)-\sum_{u\in{S-\{s\}}}\sum_{v\in{V}}f(v,u)\\&amp;=\sum_{v\in{V}}(f(s,v)+\sum_{u\in{S-\{s\}}}f(u,v))-\sum_{v\in{V}}(f(v,s)+\sum_{u\in{S-\{s\}}}f(v,s))\\&amp;=\sum_{v\in{V}}\sum_{u\in{S}}f(u,v)-\sum_{v\in{V}}\sum_{u\in{S}}f(v,u)\end{aligned}\]</span></p><p>å› ä¸º<span class="math inline">\(V=S\bigcup{T},S\bigcap{T}=\varnothing\)</span>ï¼Œå°†ä¸Šè¿°è¡¨è¾¾å¼ä¸­é’ˆå¯¹é›†åˆVçš„æ±‚å’Œåˆ†è§£ä¸ºé’ˆå¯¹Så’ŒTçš„æ±‚å’Œï¼Œå¾—åˆ°ï¼š <span class="math display">\[\begin{aligned}|f|&amp;=\sum_{v\in{S}}\sum_{u\in{S}}f(u,v)+\sum_{v\in{T}}\sum_{u\in{S}}f(u,v)-\sum_{v\in{S}}\sum_{u\in{S}}f(v,u)-\sum_{v\in{T}}\sum_{u\in{S}}f(v,u)\\&amp;=\sum_{v\in{T}}\sum_{u\in{S}}f(u,v)-\sum_{v\in{T}}\sum_{u\in{S}}f(v,u)+\color{red}{\Bigl(\sum_{v\in{S}}\sum_{u\in{S}}f(u,v)-\sum_{v\in{S}}\sum_{u\in{S}}f(v,u)\Bigr)}\end{aligned}\]</span> ä¸Šå¼è¡¨è¾¾å¼æ‹¬å·é‡Œé¢çš„ä¸¤ä¸ªæ±‚å’Œé¡¹å®žé™…ä¸Šæ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œè¿™äº›æ±‚å’Œé¡¹ç›¸äº’æŠµæ¶ˆï¼Œå¾—åˆ°ï¼š <span class="math display">\[|f|=\sum_{v\in{T}}\sum_{u\in{S}}f(u,v)-\sum_{v\in{T}}\sum_{u\in{S}}f(v,u)=f(S,T)\]</span></p><blockquote><p>æŽ¨è®º26.5</p><p>æµç½‘ç»œGä¸­ä»»æ„æµfçš„å€¼ä¸èƒ½è¶…è¿‡Gçš„ä»»æ„åˆ‡å‰²å®¹é‡ã€‚</p></blockquote><p><strong>è¯æ˜Ž</strong>ï¼šè®¾(S,T)ä¸ºæµç½‘ç»œGçš„ä»»æ„åˆ‡å‰²ï¼Œè®¾fä¸ºGä¸­çš„ä»»æ„æµã€‚æ ¹æ®å¼•ç†26.4å’Œå®¹é‡é™åˆ¶æ€§è´¨ï¼Œæœ‰ <span class="math display">\[\begin{aligned}|f|=f(S,T)&amp;=\sum_{u\in{S}}\sum_{v\in{T}}f(u,v)-\sum_{u\in{S}}\sum_{v\in{T}}f(v,u)\\&amp;\le\sum_{u\in{}S}\sum_{v\in{T}}f(u,v)\le\sum_{u\in{}S}\sum_{v\in{T}}c(u,v)=c(S,T)\end{aligned}\]</span></p><h2 id="æœ€å¤§æµæœ€å°å‰²å®šç†">æœ€å¤§æµæœ€å°å‰²å®šç†</h2><blockquote><p>å®šç†26.6 ï¼ˆæœ€å¤§æµæœ€å°å‰²å®šç†ï¼‰</p><p>è®¾fä¸ºæµç½‘ç»œG=(V,E)ä¸­çš„ä¸€ä¸ªæµï¼Œè¯¥æµç½‘ç»œçš„æºç»“ç‚¹ä¸ºsï¼Œæ±‡ç‚¹ä¸ºtï¼Œåˆ™ä¸‹é¢çš„æ¡ä»¶æ˜¯ç­‰ä»·çš„ï¼š</p><ol type="1"><li>fæ˜¯Gçš„ä¸€ä¸ªæœ€å¤§æµã€‚</li><li>æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸åŒ…å«ä»»ä½•å¢žå¹¿è·¯å¾„ã€‚</li><li>|f|=c(S,T)ï¼Œå…¶ä¸­(S,T)æ˜¯æµç½‘ç»œçš„æŸä¸ªåˆ‡å‰²ã€‚</li></ol></blockquote><p><strong>è¯æ˜Ž</strong>ï¼š</p><ul><li><p><span class="math inline">\((1)\Rightarrow(2)\)</span>ï¼šä½¿ç”¨åè¯æ³•ã€‚å‡å®šfæ˜¯Gçš„ä¸€ä¸ªæœ€å¤§æµï¼Œä½†æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>åŒæ—¶åŒ…å«ä¸€æ¡å¢žå¹¿è·¯å¾„pã€‚é‚£ä¹ˆæ ¹æ®æŽ¨è®º26.3ï¼Œå¯¹få¢žåŠ æµé‡<span class="math inline">\(f_p\)</span>æ‰€å½¢æˆçš„æµæ˜¯Gä¸­çš„ä¸€ä¸ªå€¼ä¸¥æ ¼å¤§äºŽ|f|çš„æµï¼Œè¿™ä¸Žfæ˜¯æœ€å¤§æµçš„å‡è®¾çŸ›ç›¾ã€‚</p></li><li><p><span class="math inline">\((2)\Rightarrow(3)\)</span>ï¼šå‡è®¾<span class="math inline">\(G_f\)</span>ä¸åŒ…å«ä»»ä½•å¢žå¹¿è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ®‹å­˜ç½‘ç»œ<span class="math inline">\(G_f\)</span>ä¸­ä¸å­˜åœ¨ä»»ä½•ä»Žæºç»“ç‚¹såˆ°æ±‡ç‚¹tçš„è·¯å¾„ã€‚å®šä¹‰<span class="math inline">\(S=\lbrace{v\in{V}:\text{åœ¨ }G_f\text{ä¸­å­˜åœ¨ä»Ž }s\text{åˆ°}v\text{çš„è·¯å¾„}}\rbrace,T=V-S\)</span>ã€‚æ˜¾ç„¶ï¼Œ<span class="math inline">\(s\in{S}\)</span>ï¼Œè€Œå› ä¸º<span class="math inline">\(G_f\)</span>ä¸­ä¸å­˜åœ¨ä»Žsåˆ°tçš„è·¯å¾„ï¼ˆå¢žå¹¿è·¯å¾„ï¼‰ï¼Œæ‰€ä»¥<span class="math inline">\(t\notin{S}\)</span>ã€‚å› æ­¤ï¼Œåˆ’åˆ†(S,T)æ˜¯æµç½‘ç»œGçš„ä¸€ä¸ªåˆ‡å‰²ã€‚ä¸‹é¢è¯æ˜Ž|f|=c(S,T)ã€‚</p><p>è€ƒè™‘ä¸€å¯¹ç»“ç‚¹<span class="math inline">\(u\in{S}\)</span>å’Œ<span class="math inline">\(v\in{T}\)</span>ã€‚</p><ul><li>å¦‚æžœ<span class="math inline">\((u,v)\in{E}\)</span>ï¼Œåˆ™å¿…æœ‰f(u,v)=c(u,v)ï¼Œå¦åˆ™è¾¹(u,v)å°†å±žäºŽ<span class="math inline">\(E_f\)</span>ï¼Œåœ¨æ®‹å­˜ç½‘ç»œä¸­å­˜åœ¨ä¸€æ¡è·¯å¾„<span class="math inline">\(s\rightsquigarrow{u}\rightarrow{v}\)</span>åˆ°è¾¾ç»“ç‚¹vï¼Œå³<span class="math inline">\(v\in{S}\)</span>ï¼Œè¿™ä¸Žç»“ç‚¹<span class="math inline">\(v\in{T}\)</span>çŸ›ç›¾ã€‚</li><li>å¦‚æžœ<span class="math inline">\((v,u)\in{E}\)</span>ï¼Œåˆ™å¿…æœ‰f(v,u)=0ï¼Œå¦åˆ™è¾¹(u,v)å°†å±žäºŽ<span class="math inline">\(E_f\)</span>ï¼Œå¾—å‡º<span class="math inline">\(v\in{S}\)</span>ï¼Œä¸Ž<span class="math inline">\(v\in{T}\)</span>çŸ›ç›¾ã€‚</li><li>å¦‚æžœè¾¹(u,v)å’Œ(v,u)éƒ½ä¸åœ¨é›†åˆEä¸­ï¼Œåˆ™f(u,v)=f(v,u)=0ã€‚</li></ul></li></ul><p>å› æ­¤æœ‰ <span class="math display">\[\begin{aligned}f(S,T)&amp;=\sum_{u\in{S}}\sum_{v\in{T}}f(u,v)-\sum_{u\in{S}}\sum_{v\in{T}}f(v,u)\\&amp;=\sum_{u\in{S}}\sum_{v\in{T}}f(u,v)-\sum_{u\in{S}}\sum_{v\in{T}}0\\&amp;=c(S,T)\end{aligned}\]</span></p><ul><li><span class="math inline">\((3)\Rightarrow(1)\)</span>ï¼šæ ¹æ®æŽ¨è®º26.5ï¼Œå¯¹äºŽæ‰€æœ‰åˆ‡å‰²(S,T)ï¼Œ<span class="math inline">\(|f|\le{c(S,T)}\)</span>ã€‚å› æ­¤ï¼Œæ¡ä»¶|f|=c(S,T)éšå«ç€|f|æ˜¯ä¸€ä¸ªæœ€å¤§æµã€‚</li></ul><h1 id="åŸºæœ¬çš„ford-fulkersonç®—æ³•">åŸºæœ¬çš„Ford-Fulkersonç®—æ³•</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FORD-FULKERSON(G, s, t):</span><br><span class="line">    <span class="keyword">for</span> each edge (u,v) <span class="keyword">in</span> G.E:  <span class="comment"># å°†æµfåˆå§‹åŒ–ä¸º0</span></span><br><span class="line">        (u,v).f = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> there exists a path p <span class="keyword">from</span> s to t <span class="keyword">in</span> the residual network:  <span class="comment"># å¯»æ‰¾å¢žå¹¿è·¯å¾„</span></span><br><span class="line">        c_f(p) = min&#123;c_f(u,v):(u,v) <span class="keyword">is</span> <span class="keyword">in</span> p&#125;   <span class="comment"># æ®‹å­˜å®¹é‡</span></span><br><span class="line">        <span class="keyword">for</span> each edge (u,v) <span class="keyword">in</span> p:              <span class="comment"># ä¿®æ”¹åŽŸå§‹æµç½‘ç»œä¸­çš„æµ</span></span><br><span class="line">            <span class="keyword">if</span> (u,v) <span class="keyword">in</span> E:</span><br><span class="line">                (u,v).f = (u,v).f + c_f(p)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                (v,u).f = (v,u).f - c_f(p)</span><br></pre></td></tr></table></figure><p>FORD-FULKERSONç®—æ³•ä»…æ˜¯å¯¹FORD-FULKERSON-METHODè¿‡ç¨‹çš„ç®€å•æ‰©å±•ã€‚ä¸‹å›¾æè¿°çš„æ˜¯ä¸€ä¸ªæ ·æœ¬è¿è¡Œè¿‡ç¨‹çš„æ¯æ¬¡è¿­ä»£çš„ç»“æžœã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/ford-fulkerson-example.png" title="Ford-Fulkersonç¤ºä¾‹"></p><h2 id="åˆ†æž">åˆ†æž</h2><p>å‡å®šæ‰€é€‰æ‹©çš„ä»»æ„å¢žå¹¿è·¯å¾„å’Œæ‰€æœ‰çš„å®¹é‡éƒ½æ˜¯æ•´æ•°ï¼ˆå¦‚æžœå®¹é‡ä¸ºæœ‰ç†æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¹˜ä»¥æŸä¸ªç³»æ•°æ¥å°†å…¶è½¬æ¢ä¸ºæ•´æ•°ï¼›å¦‚æžœå®¹é‡ä¸ºæ— ç†æ•°ï¼Œåˆ™Ford-Fulkersonæ–¹æ³•å¯èƒ½ä¸ä¼šç»ˆæ­¢ï¼‰ã€‚</p><ul><li>åˆå§‹åŒ–ï¼šå¯¹æ¯æ¡è¾¹èµ‹åˆå§‹å€¼0ï¼Œæˆæœ¬æ˜¯O(E)ã€‚</li><li>å¯»æ‰¾å¢žå¹¿è·¯å¾„ï¼šå¦‚æžœç”¨æ¥å®žçŽ°æµç½‘ç»œG=(V,E)çš„æ•°æ®ç»“æž„æ˜¯åˆç†çš„ï¼Œä½¿ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢æˆ–å¹¿åº¦ä¼˜å…ˆæœç´¢åœ¨ä¸€ä¸ªæ®‹å­˜ç½‘ç»œä¸­æ‰¾åˆ°ä¸€æ¡è·¯å¾„çš„æ—¶é—´åº”æ˜¯O(V+E)=O(E)ã€‚</li><li>whileå¾ªçŽ¯ï¼šæ‰§è¡Œä¸€éçš„æ—¶é—´ä¸ºO(E)ã€‚å¦‚æžœ<span class="math inline">\(f^\star\)</span>è¡¨ç¤ºç½‘ç»œä¸­çš„ä¸€ä¸ªæœ€å¤§æµï¼Œåˆ™åœ¨FORD-FULKERSONç®—æ³•ä¸­ï¼Œwhileå¾ªçŽ¯çš„æ¬¡æ•°æœ€å¤šä¸º<span class="math inline">\(|f^\star|\)</span>æ¬¡ï¼Œå› ä¸ºæµé‡å€¼åœ¨æ¯æ¬¡è¿­ä»£ä¸­æœ€å°‘å¢žåŠ ä¸€ä¸ªå•ä½ã€‚</li></ul><p>ä»Žè€Œæ•´ä¸ªFORD-FULKERSONç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(O(E|f^\star|)\)</span>ã€‚</p><p>å½“å®¹é‡éƒ½æ˜¯æ•´æ•°å€¼ä¸”æœ€ä¼˜çš„æµé‡å€¼<span class="math inline">\(|f^\star|\)</span>è¾ƒå°æ—¶ï¼ŒFORD-FULKERSONç®—æ³•çš„è¿è¡Œæ—¶é—´ç›¸å½“ä¸é”™ã€‚ä¸‹å›¾æè¿°çš„æ˜¯å½“<span class="math inline">\(|f^\star|\)</span>çš„å–å€¼è¾ƒå¤§æ—¶å¯èƒ½å‘ç”Ÿçš„æƒ…å†µã€‚è¯¥ç½‘ç»œçš„ä¸€ä¸ªæœ€å¤§æµå–å€¼ä¸º2 000 000ï¼Œ1 000 000å•ä½çš„æµé‡æµç»è·¯å¾„<span class="math inline">\(s\rightarrow{u}\rightarrow{t}\)</span>ï¼Œå¦å¤–1 000 000å•ä½çš„æµé‡æµç»è·¯å¾„<span class="math inline">\(s\rightarrow{v}\rightarrow{t}\)</span>ã€‚</p><p>å¦‚æžœFORD-FULKERSONç®—æ³•æ‰¾åˆ°çš„ç¬¬ä¸€æ¡å¢žå¹¿è·¯å¾„ä¸º<span class="math inline">\(s\rightarrow{u}\rightarrow{v}\rightarrow{t}\)</span>ï¼Œå¦‚å›¾(a)æ‰€ç¤ºï¼Œåˆ™åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£åŽï¼Œæµçš„å€¼ä¸º1ã€‚äº§ç”Ÿçš„æ®‹å­˜ç½‘ç»œå¦‚å›¾(b)æ‰€ç¤ºï¼Œæ‰¾åˆ°çš„ç¬¬äºŒæ¡å¢žå¹¿è·¯å¾„ä¸º<span class="math inline">\(s\rightarrow{v}\rightarrow{u}\rightarrow{t}\)</span>ï¼Œç„¶åŽæµçš„å€¼å°†ä¸º2ã€‚å›¾(c)æè¿°çš„æ˜¯ç»“æžœæ®‹å­˜ç½‘ç»œã€‚</p><p>å¦‚æ­¤ç»§ç»­ä¸‹åŽ»ï¼Œåœ¨æ¯ä¸ªå¥‡æ•°æ¬¡è¿­ä»£ä¸­ï¼Œé€‰æ‹©å¢žå¹¿è·¯å¾„<span class="math inline">\(s\rightarrow{u}\rightarrow{v}\rightarrow{t}\)</span>ï¼Œåœ¨æ¯ä¸ªå¶æ•°æ¬¡è¿­ä»£ä¸­ï¼Œé€‰æ‹©å¢žå¹¿è·¯å¾„<span class="math inline">\(s\rightarrow{v}\rightarrow{u}\rightarrow{t}\)</span>ï¼Œè¿™æ ·å°†ä¸€å…±æ‰§è¡Œ2 000 000æ¬¡é€’å¢žæ“ä½œï¼Œæ¯æ¬¡å°†æµé‡å¢žåŠ 1ä¸ªå•ä½ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/ford-fulkerson-analysis.png" title="å¾ªçŽ¯æ¬¡æ•°å¾ˆå¤§çš„ä¸€ä¸ªç¤ºä¾‹é—®é¢˜"></p><h1 id="edmonds-karpç®—æ³•">Edmonds-Karpç®—æ³•</h1><p>ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢å¯»æ‰¾å¢žå¹¿è·¯å¾„å¯ä»¥æ”¹å–„FORD-FULKERSONç®—æ³•çš„æ•ˆçŽ‡ã€‚å¹¿åº¦ä¼˜å…ˆæœç´¢å¾—åˆ°çš„å¢žå¹¿è·¯å¾„æ˜¯ä¸€æ¡ä»Žæºç»“ç‚¹såˆ°æ±‡ç‚¹tçš„<strong>æœ€çŸ­</strong>ï¼ˆè¾¹æ•°æœ€å°‘ï¼‰è·¯å¾„ã€‚ç§°å¦‚æ­¤å®žçŽ°çš„Ford-Fulkersonæ–¹æ³•ä¸ºEdmonds-Karpç®—æ³•ã€‚è¯¥ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(O(VE^2)\)</span>ï¼Œåªä¸Žæµç½‘ç»œçš„è§„æ¨¡æœ‰å…³ï¼Œä¸Žæœ€ä¼˜çš„æµé‡å€¼æ— å…³ã€‚</p><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_f</span><span class="params">(graph)</span>:</span></span><br><span class="line">    print(<span class="string">'max flow:'</span>, graph.graph[<span class="string">'max_flow'</span>])</span><br><span class="line">    fmt = <span class="string">'&#123;0:&lt;4s&#125; &#123;1:&lt;4s&#125; &#123;2:&lt;4s&#125; &#123;3:&lt;8s&#125;\n'</span></span><br><span class="line">    title = fmt.format(<span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'flow'</span>, <span class="string">'capacity'</span>)</span><br><span class="line">    data = <span class="string">''</span>.join(</span><br><span class="line">        fmt.format(str(u), str(v), str(attr[<span class="string">'flow'</span>]), str(attr[<span class="string">'capacity'</span>])) <span class="keyword">for</span> u, v, attr <span class="keyword">in</span> graph.edges(data=<span class="literal">True</span>) <span class="keyword">if</span></span><br><span class="line">        attr[<span class="string">'flow'</span>] &gt; <span class="number">0</span>)</span><br><span class="line">    print(title + data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_path_dfs</span><span class="params">(graph, s, t, p)</span>:</span></span><br><span class="line">    <span class="string">"""å¯»æ‰¾å¢žå¹¿è·¯å¾„ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆé€’å½’å®žçŽ°ï¼‰"""</span></span><br><span class="line">    <span class="keyword">if</span> s == t:</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> graph.get_e(s):</span><br><span class="line">        residuals = e.c - e.f</span><br><span class="line">        <span class="keyword">if</span> residuals &gt; <span class="number">0</span> <span class="keyword">and</span> e <span class="keyword">not</span> <span class="keyword">in</span> p:</span><br><span class="line">            p.add(e)  <span class="comment"># å°†å½“å‰é‚»æŽ¥è¾¹åŠ å…¥pathï¼Œå‘sinkå¯»è·¯</span></span><br><span class="line">            result = find_path_dfs(graph, e.v, t, p)</span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">            p.remove(e)  <span class="comment"># è‹¥æ²¡æ‰¾åˆ°é€šå‘sinkçš„è·¯ï¼Œä»Žpathä¸­ç§»é™¤å½“å‰è¾¹ï¼Œå¾ªçŽ¯ä¸‹ä¸€æ¡é‚»æŽ¥è¾¹</span></span><br><span class="line">    <span class="comment"># æœªæ‰¾åˆ°è·¯å¾„ï¼Œå°†è¿”å›žé»˜è®¤å€¼None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_path_bfs</span><span class="params">(graph, s, t, p)</span>:</span></span><br><span class="line">    <span class="string">"""Ford-Fulkerson Methodçš„ä¸€ç§ç‰¹æ®Šå®žçŽ°ï¼šEdmonds-Karp algorithm</span></span><br><span class="line"><span class="string">    ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢å¯»æ‰¾å¢žå¹¿è·¯å¾„ï¼Œå¯»æ‰¾ä¸€æ¡è¾¹æ•°æœ€å°‘çš„å¢žå¹¿è·¯å¾„"""</span></span><br><span class="line">    previous, visit, q = &#123;s: <span class="literal">None</span>&#125;, set(), Queue()</span><br><span class="line">    q.put(s)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">        u = q.get()</span><br><span class="line">        visit.add(u)  <span class="comment"># visitç”¨æ¥è®°å½•ç»“ç‚¹æ˜¯å¦æ›¾è¢«è®¿é—®è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> u == t:  <span class="comment"># è¾“å‡ºè·¯å¾„</span></span><br><span class="line">            pre = previous[t]</span><br><span class="line">            <span class="keyword">while</span> pre <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                p.add((pre, u))  <span class="comment"># pathçš„é¡ºåºæ— å½±å“</span></span><br><span class="line">                u = pre</span><br><span class="line">                pre = previous[pre]</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">        <span class="keyword">for</span> v, attr <span class="keyword">in</span> graph[u].items():</span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> visit:</span><br><span class="line">                residual = attr[<span class="string">'capacity'</span>] - attr[<span class="string">'flow'</span>]  <span class="comment"># åˆ¤æ–­æ®‹å­˜å®¹é‡</span></span><br><span class="line">                <span class="keyword">if</span> residual &gt; <span class="number">0</span>:</span><br><span class="line">                    q.put(v)</span><br><span class="line">                    previous[v] = u  <span class="comment"># previousè®°å½•å‰é©±ç»“ç‚¹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_path</span><span class="params">(graph, s, t, path)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> find_path_bfs(graph, s, t, path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max_flow</span><span class="params">(graph, s, t)</span>:</span></span><br><span class="line">    <span class="string">"""æ±‚æœ€å¤§æµ"""</span></span><br><span class="line">    p = find_path(graph, s, t, set())</span><br><span class="line">    <span class="keyword">while</span> p <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        augment_flow = min(graph[u][v][<span class="string">'capacity'</span>] - graph[u][v][<span class="string">'flow'</span>] <span class="keyword">for</span> u, v <span class="keyword">in</span> p)</span><br><span class="line">        <span class="keyword">for</span> u, v <span class="keyword">in</span> p:</span><br><span class="line">            graph[u][v][<span class="string">'flow'</span>] += augment_flow</span><br><span class="line">            graph[v][u][<span class="string">'flow'</span>] -= augment_flow</span><br><span class="line">        p = find_path(graph, s, t, set())</span><br><span class="line">    graph.graph[<span class="string">'max_flow'</span>] = sum(attr[<span class="string">'flow'</span>] <span class="keyword">for</span> attr <span class="keyword">in</span> graph[s].values())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize_graph</span><span class="params">(graph, vertices, edges)</span>:</span></span><br><span class="line">    graph.add_nodes_from(vertices)</span><br><span class="line">    <span class="keyword">for</span> u, v, c <span class="keyword">in</span> edges:</span><br><span class="line">        graph.add_edges_from([(u, v, &#123;<span class="string">'capacity'</span>: c&#125;), (v, u, &#123;<span class="string">'capacity'</span>: <span class="number">0</span>&#125;)], flow=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    g = nx.DiGraph()</span><br><span class="line">    v = <span class="string">'s1234t'</span></span><br><span class="line">    e = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">6</span>), (<span class="string">'s'</span>, <span class="string">'3'</span>, <span class="number">5</span>), (<span class="string">'s'</span>, <span class="string">'4'</span>, <span class="number">1</span>), (<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="number">5</span>), (<span class="string">'1'</span>, <span class="string">'4'</span>, <span class="number">2</span>), (<span class="string">'1'</span>, <span class="string">'t'</span>, <span class="number">3</span>),</span><br><span class="line">         (<span class="string">'2'</span>, <span class="string">'t'</span>, <span class="number">5</span>), (<span class="string">'3'</span>, <span class="string">'1'</span>, <span class="number">2</span>), (<span class="string">'3'</span>, <span class="string">'4'</span>, <span class="number">4</span>), (<span class="string">'4'</span>, <span class="string">'2'</span>, <span class="number">3</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">3</span>)]</span><br><span class="line">    initialize_graph(g, v, e)</span><br><span class="line">    max_flow(g, <span class="string">'s'</span>, <span class="string">'t'</span>)</span><br><span class="line">    print_f(g)</span><br><span class="line"></span><br><span class="line">    g.clear()</span><br><span class="line">    e = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">16</span>), (<span class="string">'s'</span>, <span class="string">'2'</span>, <span class="number">13</span>), (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="number">12</span>), (<span class="string">'2'</span>, <span class="string">'1'</span>, <span class="number">4</span>), (<span class="string">'2'</span>, <span class="string">'4'</span>, <span class="number">14</span>), (<span class="string">'3'</span>, <span class="string">'2'</span>, <span class="number">9</span>),</span><br><span class="line">         (<span class="string">'3'</span>, <span class="string">'t'</span>, <span class="number">20</span>), (<span class="string">'4'</span>, <span class="string">'3'</span>, <span class="number">7</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">4</span>)]</span><br><span class="line">    initialize_graph(g, v, e)</span><br><span class="line">    max_flow(g, <span class="string">'s'</span>, <span class="string">'t'</span>)</span><br><span class="line">    print_f(g)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">max flow: 11</span><br><span class="line">u    v    flow capacity</span><br><span class="line">s    1    6    6</span><br><span class="line">s    3    5    5</span><br><span class="line">1    2    2    5</span><br><span class="line">1    4    2    2</span><br><span class="line">1    t    3    3</span><br><span class="line">2    t    5    5</span><br><span class="line">3    1    1    2</span><br><span class="line">3    4    4    4</span><br><span class="line">4    2    3    3</span><br><span class="line">4    t    3    3</span><br><span class="line"></span><br><span class="line">max flow: 23</span><br><span class="line">u    v    flow capacity</span><br><span class="line">s    1    12   16</span><br><span class="line">s    2    11   13</span><br><span class="line">1    3    12   12</span><br><span class="line">2    4    11   14</span><br><span class="line">3    t    19   20</span><br><span class="line">4    3    7    7</span><br><span class="line">4    t    4    4</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> algorithms </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ Python ä¸­ä½¿ç”¨ CPLEX</title>
      <link href="/operations-research/cplex-in-python/"/>
      <url>/operations-research/cplex-in-python/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾ç½®api">è®¾ç½®API</h1><p>ä»Žæ­å»ºè¿è¡ŒçŽ¯å¢ƒå¼€å§‹ã€‚ä½¿ç”¨çš„è½¯ä»¶å¦‚ä¸‹ï¼š</p><ul><li>ILOG CPLEX Optimization studio 12.9.0 64bitã€‚</li><li>Python3.6.8 64bitã€‚</li></ul><p>å®‰è£…å¥½ILOG CPLEX Optimization studioåŽï¼Œ<a href="https://www.ibm.com/support/knowledgecenter/zh/SSSA5P_12.9.0/ilog.odms.cplex.help/CPLEX/GettingStarted/topics/set_up/Python_setup.html" target="_blank" rel="noopener">è®¾ç½® CPLEX çš„ Python API</a>ã€‚</p><h2 id="ä½¿ç”¨è„šæœ¬-setup.py">ä½¿ç”¨è„šæœ¬ setup.py</h2><p>è¦åœ¨ç³»ç»Ÿä¸Šå®‰è£… CPLEX-Python æ¨¡å—ï¼Œè¯·ä½¿ç”¨ä½äºŽ yourCplexhome/python/VERSION/PLATFORM ä¸­çš„è„šæœ¬ setup.pyã€‚ å¦‚æžœè¦å°† CPLEX-Python æ¨¡å—å®‰è£…åœ¨éžç¼ºçœä½ç½®ï¼Œè¯·ä½¿ç”¨é€‰é¡¹ --home è¯†åˆ«å®‰è£…ç›®å½•ã€‚ ä¾‹å¦‚ï¼Œè¦å°† CPLEX-Python æ¨¡å—å®‰è£…åœ¨ç¼ºçœä½ç½®ï¼Œè¯·ä»Žå‘½ä»¤è¡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><p>è¦å®‰è£…åœ¨ç›®å½• yourPythonPackageshome/cplex ä¸­ï¼Œè¯·ä»Žå‘½ä»¤è¡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python setup.py install --home yourPythonPackageshome/cplex</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå‘½ä»¤ï¼ˆç¼ºçœå’ŒæŒ‡å®šä¸»ç›®å½•ï¼‰å‡ä¼šè°ƒç”¨ Python åŒ… distutilsã€‚ æœ‰å…³é€‚ç”¨äºŽè¯¥è½¯ä»¶åŒ…çš„å…¶ä»–é€‰é¡¹ï¼Œè¯·å‚è€ƒ Python distutils çš„æ–‡æ¡£ã€‚</p><p>è®¾ç½®å®ŒæˆåŽï¼Œè‹¥èƒ½åœ¨Pythonè§£é‡Šå™¨ä¸­å¯¼å…¥cplexåº“ï¼ˆ<code>import cplex</code>ï¼‰è¯´æ˜Žé…ç½®æˆåŠŸã€‚</p><a id="more"></a><p><strong>é™„</strong>ï¼š</p><ol type="1"><li>CPLEX APIå’ŒPythonä½æ•°éœ€ä¸€è‡´ã€‚</li><li>CPLEX Optimization studio 12.9ç‰ˆæœ¬ä¸æ”¯æŒ32bitã€‚</li><li>å¦‚æžœéƒ½å®‰è£…64bitç‰ˆæœ¬ï¼ŒPythonä¸è¦é€‰æ‹©v3.7ï¼ŒæŸäº›åº“å°šä¸æ”¯æŒPython3.7 64bitã€‚</li></ol><h1 id="hello-cplex">Hello CPLEX</h1><p>cplexä¸­é‡è¦çš„ä¸€ä¸ªç±»å°±æ˜¯Cplexç±»ï¼Œå®ƒæä¾›äº†åˆ›å»ºã€ä¿®æ”¹ã€æŸ¥è¯¢æœ€ä¼˜åŒ–é—®é¢˜çš„ä¸€ç³»åˆ—æ–¹æ³•ã€‚Cplex çš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.ibm.com/support/knowledgecenter/zh/SSSA5P_12.9.0/ilog.odms.cplex.help/refpythoncplex/html/cplex.Cplex-class.html" target="_blank" rel="noopener">Class Cplex</a>ã€‚ä½¿ç”¨cplexä¼˜åŒ–ä¸€ä¸ªLPæ¨¡åž‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Maximize</span><br><span class="line">3x1 + 5x2</span><br><span class="line">Subject to</span><br><span class="line"> x1 + 7x2 &lt;= 140</span><br><span class="line"> x1 + 2x2 &lt;= 50</span><br><span class="line">3x1 + 2x2 &lt;= 130</span><br><span class="line">Bounds</span><br><span class="line">0 &lt;= x1 &lt;= infinity</span><br><span class="line">0 &lt;= x2 &lt;= infinity</span><br><span class="line">End</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°å†…å®¹ä¿å­˜è‡³æ–‡ä»¶hello.lpï¼Œä¹‹åŽå¯ä»¥ç›´æŽ¥è¯»å–è¯¥æ–‡ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cplex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    c = cplex.Cplex()</span><br><span class="line">    c.read(<span class="string">'hello.lp'</span>)</span><br><span class="line">    c.solve()</span><br><span class="line">    print(c.solution.get_objective_value(), c.solution.get_values())</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æŽ¥æž„å»ºç›¸åŒçš„æ¨¡åž‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cplex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    c = cplex.Cplex()</span><br><span class="line">    <span class="comment"># è®¾ç½®ä¼˜åŒ–ç›®æ ‡ä¸ºæœ€å¤§åŒ–ï¼Œé»˜è®¤æ˜¯minimize</span></span><br><span class="line">    c.objective.set_sense(c.objective.sense.maximize)</span><br><span class="line">    <span class="comment"># obj: ç›®æ ‡å‡½æ•°</span></span><br><span class="line">    <span class="comment"># names: å˜é‡å</span></span><br><span class="line">    <span class="comment"># lb: lower bound</span></span><br><span class="line">    <span class="comment"># ub: upper bound</span></span><br><span class="line">    c.variables.add(</span><br><span class="line">        obj=[<span class="number">3</span>, <span class="number">5</span>], names=[<span class="string">'x1'</span>, <span class="string">'x2'</span>],</span><br><span class="line">        lb=[<span class="number">0.0</span>, <span class="number">0.0</span>], ub=[cplex.infinity] * <span class="number">2</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># lin_expr: çº¿æ€§è¡¨è¾¾å¼ï¼Œçº¦æŸæ¡ä»¶å·¦è¾¹</span></span><br><span class="line">    <span class="comment"># senses: çº¦æŸæ¡ä»¶çš„æ¯”è¾ƒç¬¦å·ï¼ŒG|L|E|Rï¼Œåˆ†åˆ«è¡¨ç¤ºå¤§äºŽç­‰äºŽ|å°äºŽç­‰äºŽ|ç­‰äºŽ|åŒºé—´çº¦æŸ</span></span><br><span class="line">    <span class="comment"># rhs: right hand sideï¼Œçº¦æŸæ¡ä»¶å³è¾¹çš„å€¼</span></span><br><span class="line">    c.linear_constraints.add(</span><br><span class="line">        lin_expr=[([<span class="string">'x1'</span>, <span class="string">'x2'</span>], [<span class="number">1</span>, <span class="number">7</span>]),</span><br><span class="line">                  ([<span class="number">0</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>]),</span><br><span class="line">                  ([<span class="string">'x1'</span>, <span class="string">'x2'</span>], [<span class="number">3</span>, <span class="number">2</span>])],</span><br><span class="line">        senses=<span class="string">'L'</span> * <span class="number">3</span>,</span><br><span class="line">        rhs=[<span class="number">140.0</span>, <span class="number">50.0</span>, <span class="number">130.0</span>]</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># æ±‚è§£é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆä¿å­˜åœ¨c.solutionå˜é‡</span></span><br><span class="line">    c.solve()</span><br><span class="line">    <span class="comment"># æ‰“å°æœ€ä¼˜å€¼å’Œæ‰€æœ‰å˜é‡çš„å€¼</span></span><br><span class="line">    print(c.solution.get_objective_value(), c.solution.get_values())</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CPXPARAM_Read_DataCheck                          1</span><br><span class="line">Tried aggregator 1 time.</span><br><span class="line">No LP presolve or aggregator reductions.</span><br><span class="line">Presolve time = 0.00 sec. (0.00 ticks)</span><br><span class="line"></span><br><span class="line">Iteration log . . .</span><br><span class="line">Iteration:     1   Dual infeasibility =             0.000000</span><br><span class="line">Iteration:     2   Dual objective     =           175.789474</span><br><span class="line">145.0 [40.0, 5.0]  # æœ€ä¼˜å€¼å’Œæ­¤æ—¶å˜é‡çš„å€¼ï¼Œä¸Šé¢æ˜¯logå†…å®¹</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è¿ç­¹å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linear programming </tag>
            
            <tag> cplex </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•æºæœ€çŸ­è·¯å¾„</title>
      <link href="/notes/introduction-to-algorithms/single-source-shortest-paths/"/>
      <url>/notes/introduction-to-algorithms/single-source-shortest-paths/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹">ç®€ä»‹</h1><p>æœ€çŸ­è·¯å¾„é—®é¢˜ï¼ˆShortest path problem, SPPï¼‰æ—¨åœ¨å¯»æ‰¾å›¾ä¸­ä¸¤ä¸ªç»“ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚æœ¬æ–‡ä»‹ç»å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼šç»™å®šä¸€ä¸ªå›¾ <span class="math inline">\(G=(V,E)\)</span>ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ä»Žç»™å®šæºèŠ‚ç‚¹ <span class="math inline">\(s\)</span> åˆ°æ¯ä¸ªç»“ç‚¹ <span class="math inline">\(v\in{V}\)</span> çš„æœ€çŸ­è·¯å¾„ã€‚å¹¿åº¦ä¼˜å…ˆæœç´¢å°±æ˜¯æƒé‡å‡ä¸º1çš„å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œæ ¹èŠ‚ç‚¹ï¼ˆæºç‚¹ï¼‰åˆ°æ¯ä¸ªç»“ç‚¹çš„æœ€çŸ­è·ç¦»ç­‰äºŽæœ€çŸ­è·¯å¾„ä¸Šçš„è¾¹çš„æ¡æ•°ã€‚å•æºæœ€çŸ­è·¯å¾„é—®é¢˜å¯ä»¥ç”¨æ¥è§£å†³è®¸å¤šå…¶ä»–é—®é¢˜ï¼Œå…¶ä¸­å°±åŒ…æ‹¬å®ƒçš„å‡ ä¸ªå˜ä½“ï¼š</p><ul><li>å•ç›®çš„åœ°æœ€çŸ­è·¯å¾„é—®é¢˜ï¼šæ‰¾åˆ°ä»Žç»™å®šç»“ç‚¹ <span class="math inline">\(v\)</span> åˆ°ç»™å®šç›®çš„åœ°ç»“ç‚¹ <span class="math inline">\(t\)</span> çš„æœ€çŸ­è·¯å¾„ã€‚å¦‚æžœå°†å›¾çš„æ¯æ¡è¾¹çš„æ–¹å‘ç¿»è½¬è¿‡æ¥ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªé—®é¢˜è½¬æ¢ä¸ºå•æºæœ€çŸ­è·¯å¾„é—®é¢˜ã€‚</li><li>å•èŠ‚ç‚¹å¯¹æœ€çŸ­è·¯å¾„é—®é¢˜ï¼šæ‰¾åˆ°ä»Žç»™å®šç»“ç‚¹ <span class="math inline">\(u\)</span> åˆ°ç»™å®šèŠ‚ç‚¹ <span class="math inline">\(v\)</span> çš„æœ€çŸ­è·ç¦»ã€‚å¦‚æžœè§£å†³äº†é’ˆå¯¹å•ä¸ªç»“ç‚¹ <span class="math inline">\(u\)</span> çš„å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œé‚£ä¹ˆä¹Ÿå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è€Œä¸”ï¼Œåœ¨è¯¥é—®é¢˜çš„æ‰€æœ‰å·²çŸ¥ç®—æ³•ä¸­ï¼Œæœ€åæƒ…å†µä¸‹çš„æ¸è¿›è¿è¡Œæ—¶é—´éƒ½å’Œæœ€å¥½çš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸€æ ·ã€‚</li><li>æ‰€æœ‰ç»“ç‚¹å¯¹æœ€çŸ­è·ç¦»ï¼šå¯¹äºŽæ¯å¯¹ç»“ç‚¹ <span class="math inline">\(u\)</span> å’Œ <span class="math inline">\(v\)</span>ï¼Œæ‰¾åˆ°ä»Žç»“ç‚¹ <span class="math inline">\(u\)</span> åˆ°ç»“ç‚¹ <span class="math inline">\(v\)</span> çš„æœ€çŸ­è·¯å¾„ã€‚å¯ä»¥é’ˆå¯¹æ¯ä¸ªç»“ç‚¹è¿è¡Œä¸€éå•æºæœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œä½†å¯ä»¥æ›´å¿«åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ­¤ç±»é—®é¢˜é€‚åˆä½¿ç”¨Floyd-Warshallç®—æ³•ã€‚</li></ul><a id="more"></a><h1 id="æœ€çŸ­è·¯å¾„çš„æœ€ä¼˜å­ç»“æž„">æœ€çŸ­è·¯å¾„çš„æœ€ä¼˜å­ç»“æž„</h1><blockquote><p>å¼•ç†24.1 ï¼ˆæœ€çŸ­è·¯å¾„çš„å­è·¯å¾„ä¹Ÿæ˜¯æœ€çŸ­è·¯å¾„ï¼‰</p><p>ç»™å®šå¸¦æƒé‡çš„æœ‰å‘å›¾ <span class="math inline">\(G=(V,E)\)</span> å’Œæƒé‡å‡½æ•° <span class="math inline">\(w:E\rightarrow{R}\)</span>ã€‚è®¾ <span class="math inline">\(p=\langle{v_0,v_1,\dots,v_k\rangle}\)</span> ä¸ºä»Žç»“ç‚¹ <span class="math inline">\(v_0\)</span> åˆ°ç»“ç‚¹ <span class="math inline">\(v_k\)</span> çš„ä¸€æ¡æœ€çŸ­è·¯å¾„ï¼Œå¹¶ä¸”å¯¹äºŽä»»æ„çš„ <span class="math inline">\(i\)</span> å’Œ <span class="math inline">\(jï¼Œ0\le{I}\le{j}\le{k}\)</span>ï¼Œè®¾ <span class="math inline">\(p_{ij}=\langle{v_i,v_{i+1},\dots,v_j}\rangle\)</span> ä¸ºè·¯å¾„ <span class="math inline">\(p\)</span> ä¸­ä»Žç»“ç‚¹ <span class="math inline">\(v_i\)</span> åˆ°ç»“ç‚¹ <span class="math inline">\(v_j\)</span> çš„å­è·¯å¾„ã€‚é‚£ä¹ˆ <span class="math inline">\(p_{ij}\)</span> æ˜¯ä»Žç»“ç‚¹ <span class="math inline">\(v_i\)</span> åˆ°ç»“ç‚¹ <span class="math inline">\(v_j\)</span> çš„ä¸€æ¡æœ€çŸ­è·¯å¾„ã€‚</p></blockquote><p><strong>è¯æ˜Ž</strong>ï¼šå‡è®¾ <span class="math inline">\(p\)</span> æ˜¯ä»Ž <span class="math inline">\(v_0\)</span> åˆ° <span class="math inline">\(v_k\)</span> çš„ä¸€æ¡æœ€çŸ­è·¯å¾„ã€‚å°†è·¯å¾„påˆ†è§£ä¸º</p><p><span class="math display">\[v_0\mathop{\rightsquigarrow}^{p_{0i}}v_i\mathop{\rightsquigarrow}^{p_{ij}}v_j\mathop{\rightsquigarrow}^{p_{jk}}v_k\]</span></p><p>åˆ™æœ‰ <span class="math inline">\(w(p)=w(p_{0i})+w(p_{ij})+w(p_{jk})\)</span>ã€‚</p><p>å‡è®¾å­˜åœ¨ä¸€æ¡ä»Ž <span class="math inline">\(v_i\)</span> åˆ° <span class="math inline">\(v_j\)</span> çš„è·¯å¾„ <span class="math inline">\(p^\prime_{ij}\)</span>ï¼Œä¸” <span class="math inline">\(w(p^\prime_{ij})&lt;w(p_{ij})\)</span>ã€‚åˆ™</p><p><span class="math display">\[v_0\mathop{\rightsquigarrow}^{p_{0i}}v_i\mathop{\rightsquigarrow}^{\color{red}{p^\prime_{ij}}}v_j\mathop{\rightsquigarrow}^{p_{jk}}v_k\]</span></p><p>æ˜¯ä¸€æ¡ä»Žç»“ç‚¹ <span class="math inline">\(v_0\)</span> åˆ°ç»“ç‚¹ <span class="math inline">\(v_k\)</span> çš„æƒé‡ä¸º <span class="math inline">\(w(p^\prime)=w(p_{0i})+w(p^\prime_{ij})+w(p_{jk})\)</span> çš„è·¯å¾„ï¼Œè€Œè¯¥æƒé‡å°äºŽ <span class="math inline">\(w(p)\)</span>ã€‚</p><p>è¿™ä¸Ž <span class="math inline">\(p\)</span> æ˜¯ä»Ž <span class="math inline">\(v_0\)</span> åˆ° <span class="math inline">\(v_k\)</span> çš„ä¸€æ¡æœ€çŸ­è·¯å¾„è¿™ä¸€å‡è®¾çŸ›ç›¾ã€‚</p><h1 id="çŽ¯è·¯">çŽ¯è·¯</h1><p>ä¸å¤±ä¸€èˆ¬æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å‡å®šæ‰¾åˆ°çš„æœ€çŸ­è·¯å¾„ä¸­æ²¡æœ‰çŽ¯è·¯ï¼Œå³å®ƒä»¬éƒ½æ˜¯ç®€å•è·¯å¾„ã€‚</p><ul><li><p>è‹¥ä¸€æ¡è·¯å¾„åŒ…å«æƒé‡ä¸ºæ­£å€¼çš„çŽ¯è·¯ï¼Œé‚£ä¹ˆå°†çŽ¯è·¯ä»Žè·¯å¾„ä¸Šåˆ é™¤å°±å¯ä»¥å¾—åˆ°ä¸€æ¡æºç‚¹å’Œç»ˆç‚¹ç›¸åŒçš„æƒé‡æ›´å°çš„è·¯å¾„ã€‚</p></li><li><p>è‹¥åŒ…å«æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯ï¼Œé‚£ä¹ˆåªè¦æ²¿ç€çŽ¯è·¯å†éåŽ†ä¸€éï¼Œå°±èƒ½æ‰¾åˆ°ä¸€æ¡æƒé‡æ›´å°çš„è·¯å¾„ã€‚å¦‚æžœä»Žç»“ç‚¹såˆ°ç»“ç‚¹vçš„æŸæ¡è·¯å¾„ä¸Šå­˜åœ¨æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯ï¼Œæˆ‘ä»¬å®šä¹‰ç»“ç‚¹såˆ°ç»“ç‚¹vçš„æœ€çŸ­è·¯å¾„<span class="math inline">\(\delta(s,v)=-\infty\)</span>ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œå­˜åœ¨<span class="math inline">\(\langle{e,f,e}\rangle\)</span>è¿™æ¡æƒé‡ä¸º-3çš„çŽ¯è·¯ï¼Œå› æ­¤æ‰€æœ‰ç»è¿‡è¿™æ¡çŽ¯è·¯å¯è¾¾çš„ç»“ç‚¹e,f,gçš„æœ€çŸ­è·¯å¾„æƒé‡ä¸º<span class="math inline">\(-\infty\)</span>ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/negative-edge-weights-in-a-directed-graph.png" title="åŒ…å«æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯çš„æœ‰å‘å›¾"></p></li><li><p>è‹¥åŒ…å«æƒé‡ä¸º0çš„çŽ¯è·¯ï¼Œé‚£ä¹ˆåˆ é™¤è¯¥çŽ¯è·¯åŽå¾—åˆ°çš„è·¯å¾„æƒé‡ä¸ŽåŽŸæ¥çš„ç›¸ç­‰ã€‚åªè¦ä¸€æ¡æœ€çŸ­è·¯å¾„ä¸Šè¿˜æœ‰æƒé‡ä¸º0çš„çŽ¯è·¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡å¤åˆ é™¤è¿™äº›çŽ¯è·¯ï¼Œç›´åˆ°å¾—åˆ°ä¸€æ¡ä¸åŒ…å«çŽ¯è·¯çš„ç®€å•è·¯å¾„ã€‚</p></li></ul><p>ç”±äºŽå›¾<span class="math inline">\(G=(V,E)\)</span>ä¸­çš„ä»»æ„æ— çŽ¯è·¯å¾„æœ€å¤šåŒ…å«|V|ä¸ªä¸åŒçš„ç»“ç‚¹ï¼Œåˆ°ä»»æ„ç»“ç‚¹çš„æœ€çŸ­è·¯å¾„æœ€å¤šåŒ…å«|V|-1æ¡è¾¹ã€‚</p><h1 id="æœ€çŸ­è·¯å¾„çš„è¡¨ç¤º">æœ€çŸ­è·¯å¾„çš„è¡¨ç¤º</h1><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä½†å¸Œæœ›è®¡ç®—å‡ºæœ€çŸ­è·¯å¾„æƒé‡ï¼Œè¿˜å¸Œæœ›è®¡ç®—å‡ºæœ€çŸ­è·¯å¾„ä¸Šçš„ç»“ç‚¹ã€‚</p><p>ç»™å®šå›¾<span class="math inline">\(G=(V,E)\)</span>ï¼Œå¯¹äºŽæ¯ä¸ªç»“ç‚¹vï¼Œç»´æŒä¸€ä¸ª<strong>å‰é©±ç»“ç‚¹</strong><span class="math inline">\(v.\pi\)</span>ã€‚è¯¥å‰é©±ç»“ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªç»“ç‚¹æˆ–è€…NILã€‚å°†ä»Žç»“ç‚¹vå¼€å§‹çš„å‰é©±ç»“ç‚¹é“¾åè½¬è¿‡æ¥ï¼Œå°±æ˜¯ä»Žsåˆ°vçš„ä¸€æ¡æœ€çŸ­è·¯å¾„ã€‚</p><p>æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯ç”±<span class="math inline">\(\pi\)</span>å€¼æ‰€è¯±å¯¼çš„<strong>å‰é©±å­å›¾</strong><span class="math inline">\(G_\pi=(V_\pi,E_\pi)\)</span>ã€‚å®šä¹‰ç»“ç‚¹é›†<span class="math inline">\(V_\pi\)</span>ä¸ºå›¾Gä¸­çš„å‰é©±ç»“ç‚¹ä¸ä¸ºNILçš„ç»“ç‚¹çš„é›†åˆï¼Œå†åŠ ä¸ŠæºèŠ‚ç‚¹sï¼Œå³<span class="math inline">\(V_\pi=\{v\in{V}:v.\pi\neq{NIL}\}\cup\{s\}\)</span>ã€‚æœ‰å‘è¾¹é›†åˆ<span class="math inline">\(E_\pi\)</span>æ˜¯ç”±<span class="math inline">\(V_\pi\)</span>ä¸­çš„ç»“ç‚¹çš„<span class="math inline">\(\pi\)</span>å€¼æ‰€è¯±å¯¼çš„è¾¹çš„é›†åˆï¼Œå³<span class="math inline">\(E_\pi=\{(v.\pi,v)\in{E}:v\in{V_\pi-\{s\}}\}\)</span>ã€‚</p><p>ä¸€ä¸ªæ­£ç¡®çš„å•æºæœ€çŸ­è·¯å¾„ç®—æ³•ï¼šåœ¨ç®—æ³•ç»ˆæ­¢æ—¶ï¼Œ<span class="math inline">\(G_\pi\)</span>æ˜¯ä¸€æ£µâ€œæœ€çŸ­è·¯å¾„æ ‘â€œã€‚æœ€çŸ­è·¯å¾„æ ‘æ˜¯ä¸€æ£µæœ‰æ ¹èŠ‚ç‚¹çš„æ ‘ï¼Œè¯¥æ ‘åŒ…æ‹¬äº†ä»ŽæºèŠ‚ç‚¹såˆ°æ¯ä¸ªå¯ä»¥ä»Žsåˆ°è¾¾çš„ç»“ç‚¹çš„ä¸€æ¡æœ€çŸ­è·¯å¾„ã€‚ç±»ä¼¼äºŽå¹¿åº¦ä¼˜å…ˆæœç´¢ä¸­çš„å¹¿åº¦ä¼˜å…ˆæ ‘ï¼Œä½†å®ƒæ‰€åŒ…æ‹¬çš„æœ€çŸ­è·¯å¾„æ˜¯ä»¥è¾¹çš„æƒé‡æ¥å®šä¹‰çš„ï¼Œè€Œä¸æ˜¯è¾¹çš„æ¡æ•°ã€‚</p><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæœ€çŸ­è·¯å¾„ä¸ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œæœ€çŸ­è·¯å¾„æ ‘ä¹Ÿä¸ä¸€å®šæ˜¯å”¯ä¸€çš„ã€‚å¦‚ä¸‹å›¾(a)æ‰€ç¤ºçš„å¸¦æƒé‡çš„æœ‰å‘å›¾ä¸­ï¼Œæœ‰(b)å’Œ(c)ä¸¤ç§æœ€çŸ­è·¯å¾„ï¼Œå³å­˜åœ¨ä¸¤æ£µæ ¹èŠ‚ç‚¹ä¸ºsçš„æœ€çŸ­è·¯å¾„æ ‘ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/two-shortest-paths-trees-with-the-same-root.png" title="æ ¹ç»“ç‚¹ç›¸åŒçš„ä¸¤æ£µä¸åŒçš„æœ€çŸ­è·¯å¾„æ ‘"></p><h1 id="æ¾å¼›æ“ä½œ">æ¾å¼›æ“ä½œ</h1><p>æœ¬æ–‡çš„ç®—æ³•éœ€è¦ä½¿ç”¨æ¾å¼›ï¼ˆrelaxationï¼‰æŠ€æœ¯ã€‚å¯¹äºŽæ¯ä¸ªç»“ç‚¹væ¥è¯´ï¼Œç»´æŒä¸€ä¸ªå±žæ€§v.dï¼Œç”¨æ¥è®°å½•ä»ŽæºèŠ‚ç‚¹såˆ°ç»“ç‚¹vçš„æœ€çŸ­è·¯å¾„æƒé‡çš„ä¸Šç•Œã€‚ç§°ä¹‹ä¸ºsåˆ°vçš„<strong>æœ€çŸ­è·¯å¾„ä¼°è®¡</strong>ã€‚ä½¿ç”¨ä¸‹é¢è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(V)\)</span>çš„ç®—æ³•æ¥å¯¹æœ€çŸ­è·¯å¾„ä¼°è®¡å’Œå‰é©±ç»“ç‚¹è¿›è¡Œåˆå§‹åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INITIALIZE-SINGLE-SOURCE(G, s):</span><br><span class="line">    <span class="keyword">for</span> each vertex v <span class="keyword">in</span> G.V:</span><br><span class="line">        v.d = infinity</span><br><span class="line">        v.pi = NIL</span><br><span class="line">    s.d = <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä¼ªä»£ç ç»™å‡ºäº†å¯¹è¾¹(u,v)åœ¨O(1)æ—¶é—´å†…è¿›è¡Œçš„æ¾å¼›æ“ä½œï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">RELAX(u, v, w)ï¼š</span><br><span class="line">    <span class="keyword">if</span> v.d &gt; u.d + w(u, v):</span><br><span class="line">        v.d = u.d + w(u, v)</span><br><span class="line">        v.pi = u</span><br></pre></td></tr></table></figure><p>å¯¹ä¸€æ¡è¾¹çš„æ¾å¼›è¿‡ç¨‹ä¸ºï¼š</p><p>é¦–å…ˆæµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥å¯¹ä»Žsåˆ°vçš„æœ€çŸ­è·ç¦»è¿›è¡Œæ”¹å–„ã€‚æµ‹è¯•æ–¹æ³•æ˜¯ï¼Œå°†ä»Žç»“ç‚¹såˆ°ç»“ç‚¹uä¹‹é—´çš„æœ€çŸ­è·¯å¾„è·ç¦»u.dåŠ ä¸Šç»“ç‚¹uä¸Žvä¹‹é—´çš„è¾¹æƒé‡w(u, v)ï¼Œå¹¶ä¸Žå½“å‰çš„såˆ°vçš„æœ€çŸ­è·¯å¾„ä¼°è®¡v.dè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœå‰è€…æ›´å°ï¼Œåˆ™å¯¹v.då’Œv.piè¿›è¡Œæ›´æ–°ã€‚å¦‚ä¸‹å›¾ï¼š</p><ol type="a"><li><p>v.d=9; u.d=5; w(u,v)=2ï¼Œ9&gt;5+2ï¼Œå› æ­¤vçš„æœ€çŸ­è·¯å¾„ä¼°è®¡v.dé™ä½Žï¼ŒåŒæ—¶vçš„å‰é©±ç»“ç‚¹ä¹Ÿè¦æ›´æ–°ä¸ºuã€‚ç§°è¿™ç§æƒ…å†µä¸ºæ¾å¼›æˆåŠŸã€‚</p></li><li><p>6&lt;5+2ï¼Œå› æ­¤v.då’Œv.piå±žæ€§éƒ½ä¸ä¼šå˜åŒ–ã€‚ç§°è¿™ç§æƒ…å†µä¸ºæ¾å¼›å¤±è´¥ã€‚</p></li></ol><p><img src="/uploads/image/introduction-to-algorithms/single-source-shortest-path-relax.png" title="æ¾å¼›æˆåŠŸå’Œæ¾å¼›å¤±è´¥"></p><h1 id="bellman-fordç®—æ³•">Bellman-Fordç®—æ³•</h1><p>Bellman-Fordç®—æ³•è§£å†³çš„æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹çš„å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ã€‚è¾¹çš„æƒé‡å¯ä»¥ä¸ºè´Ÿå€¼ã€‚ç®—æ³•è¿”å›žä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä»¥è¡¨æ˜Žæ˜¯å¦å­˜åœ¨ä¸€ä¸ªä»ŽæºèŠ‚ç‚¹å¯ä»¥åˆ°è¾¾çš„æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">BELLMAN-FORD(G, w, s):</span><br><span class="line">    INITIALIZE-SINGLE-SOURCE(G, s)</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span> to |G.V| - <span class="number">1</span>:        <span class="comment"># ç®—æ³•å¯¹æ¯æ¡è¾¹è¿›è¡Œ|V|-1æ¬¡å¤„ç†</span></span><br><span class="line">        <span class="keyword">for</span> each edge(u, v) <span class="keyword">in</span> G.E:</span><br><span class="line">            RELAX(u, v, w)</span><br><span class="line">    <span class="keyword">for</span> each edge(u, v) <span class="keyword">in</span> G.E:    <span class="comment"># æ£€æŸ¥æ˜¯å¦å­˜åœ¨æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯</span></span><br><span class="line">        <span class="keyword">if</span> v.d &gt; u.d + w(u, v):</span><br><span class="line">            <span class="keyword">return</span> false           <span class="comment"># è‹¥å­˜åœ¨ï¼Œè¿”å›žfalse</span></span><br><span class="line">    <span class="keyword">return</span> true</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/execution-of-bellman-ford.png" title="Bellman Fordæ¯æ¬¡è¿­ä»£åŽçš„ç»“æžœ"></p><p>ä¾‹å¦‚åœ¨å›¾(a)æ‰€ç¤ºçš„å¸¦æƒé‡çš„æœ‰å‘å›¾ä¸­ï¼ŒæŒ‰(t,x), (t,y), (t,z), (x,t), (y,x), (y,z), (z,x), (z,s), (s,t), (s,y)çš„é¡ºåºå¯¹è¾¹æ‰§è¡Œæ¾å¼›æ“ä½œçš„è¿‡ç¨‹ã€‚æœ‰å‘å›¾ä¸­æœ‰6ä¸ªé¡¶ç‚¹ï¼Œå› æ­¤éœ€è¦å¾ªçŽ¯5æ¬¡ã€‚å•æ¬¡å¾ªçŽ¯åŽçš„ç»“æžœåˆ†ä¸ºå¦‚å›¾(b)~(e)æ‰€ç¤ºã€‚åªæœ‰v.då€¼é™ä½Žçš„ç»“ç‚¹æˆåŠŸæ¾å¼›ã€‚</p><p>è¾¹çš„é¡ºåºä¸ä¼šå¯¹æœ€ç»ˆç»“æžœäº§ç”Ÿå½±å“ï¼Œä½†è‹¥æ–Ÿé…Œé€‰æ‹©ï¼Œå¯ä»¥å‡å°‘æ¾å¼›å¤±è´¥çš„æ¬¡æ•°ï¼Œä»Žè€Œæé«˜ä»£ç çš„æ‰§è¡Œæ•ˆçŽ‡ã€‚åœ¨åŽç»­çš„ä¼˜åŒ–ä¸­å°†ä¼šæåˆ°ä¸€ç§é€‰æ‹©æ–¹æ¡ˆã€‚</p><h2 id="åˆ†æž">åˆ†æž</h2><p>INITIALIZE-SINGLE-SOURCEæ‰€éœ€æ—¶é—´ä¸º<span class="math inline">\(\Theta(V)\)</span>ï¼Œå†…å±‚å¾ªçŽ¯å¯¹æ¯æ¡è¾¹éƒ½æ‰§è¡Œä¸€æ¬¡RELAXæ“ä½œï¼Œå› æ­¤è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(E)\)</span>ï¼Œä¸”ä¸€å…±è¦è¿›è¡Œ|V|-1æ¬¡å¾ªçŽ¯ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯æ‰€éœ€æ—¶é—´ä¸ºO(E)ï¼ŒBellman-Fordç®—æ³•çš„æ€»è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(V)+(|V|-1)\Theta(E)+O(E)=O(VE)\)</span>ã€‚</p><h2 id="ä¼˜åŒ–">ä¼˜åŒ–</h2><ol type="1"><li><p>æå‰è·³å‡ºå¾ªçŽ¯ã€‚</p><p>å®žé™…æ“ä½œä¸­ï¼ŒBellman-Fordç®—æ³•ç»å¸¸ä¼šåœ¨æœªè¾¾åˆ°|V|-1æ¬¡å‰å°±å‡ºè§£ï¼Œ|V|-1å…¶å®žæ˜¯æœ€å¤§å€¼ã€‚äºŽæ˜¯å¯ä»¥åœ¨å¾ªçŽ¯ä¸­è®¾ç½®åˆ¤å®šï¼Œåœ¨æŸæ¬¡å¾ªçŽ¯ä¸å†è¿›è¡Œæ¾å¼›æ—¶ï¼Œç›´æŽ¥é€€å‡ºå¾ªçŽ¯ï¼Œè¿›è¡Œè´ŸæƒçŽ¯åˆ¤å®šã€‚ï¼ˆè‹¥å­˜åœ¨è´ŸæƒçŽ¯ï¼Œåˆ™å¾ªçŽ¯æ¬¡æ•°ä¸€å®šä¼šè¾¾åˆ°|V|-1æ¬¡ï¼Œå› æ­¤ï¼Œè‹¥æ˜¯æå‰è·³å‡ºå¾ªçŽ¯ï¼Œåˆ™è¯´æ˜Žå›¾ä¸­æ²¡æœ‰è´ŸæƒçŽ¯ï¼‰</p></li><li><p>é˜Ÿåˆ—ä¼˜åŒ–ã€‚å‚è€ƒæœ€çŸ­è·¯å¾„å¿«é€Ÿç®—æ³•ã€‚</p><p>æ¾å¼›æ“ä½œå¿…å®šåªä¼šå‘ç”Ÿåœ¨æœ€çŸ­è·¯å¾„å‰é©±ç»“ç‚¹æ¾å¼›æˆåŠŸè¿‡çš„ç»“ç‚¹ä¸Šï¼šç»“ç‚¹vçš„æ‰€æœ‰å‰é©±ç»“ç‚¹<span class="math inline">\(\{u|(u,v)\in{E}\}\)</span>ä¸­ï¼Œè‹¥å­˜åœ¨æ¾å¼›æˆåŠŸï¼ˆæ›´æ–°äº†æœ€çŸ­è·¯å¾„ä¼°è®¡då’Œå‰é©±ç»“ç‚¹piï¼‰çš„ç»“ç‚¹ï¼Œåˆ™å¯¹ç»“ç‚¹væ‰§è¡Œæ¾å¼›æ“ä½œRELAX(v, n, w)ã€‚</p><p>åè¿‡æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å¯¹å“ªäº›ç»“ç‚¹væ‰§è¡Œæ¾å¼›æ“ä½œï¼šè‹¥ç»“ç‚¹uæˆåŠŸæ¾å¼›ï¼Œåˆ™åº”è¯¥å¯¹uçš„æ‰€æœ‰åŽç»§ç»“ç‚¹<span class="math inline">\(\{v|(u,v)\in{E}\}\)</span>æ‰§è¡Œæ¾å¼›æ“ä½œã€‚</p><p>ç”¨ä¸€ä¸ªé˜Ÿåˆ—è®°å½•æ¾å¼›è¿‡çš„ç»“ç‚¹ï¼Œé¿å…äº†å†—ä½™è®¡ç®—ã€‚</p></li></ol><h2 id="ä»£ç ">ä»£ç </h2><p>å›¾ç”¨é‚»æŽ¥é“¾è¡¨çš„æ–¹å¼å­˜å‚¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_f</span><span class="params">(graph, result=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        print(<span class="string">'has negative cycle or not?'</span>, <span class="keyword">not</span> result)</span><br><span class="line">    fmt = <span class="string">'&#123;0:&lt;10s&#125; &#123;1:&lt;10s&#125; &#123;2:&lt;10s&#125;\n'</span></span><br><span class="line">    title = fmt.format(<span class="string">'vertex'</span>, <span class="string">'distance'</span>, <span class="string">'previous'</span>)</span><br><span class="line">    data = <span class="string">''</span>.join(fmt.format(str(k), str(attr[<span class="string">'distance'</span>]), str(attr[<span class="string">'previous'</span>])) <span class="keyword">for</span> k, attr <span class="keyword">in</span> graph.nodes.items())</span><br><span class="line">    print(title + data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize_single_source</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="string">"""åˆå§‹åŒ–å•æºç‚¹"""</span></span><br><span class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> graph.nodes.values():</span><br><span class="line">        attr[<span class="string">'previous'</span>] = <span class="literal">None</span></span><br><span class="line">        attr[<span class="string">'distance'</span>] = float(<span class="string">'inf'</span>)</span><br><span class="line">    graph.nodes[s][<span class="string">'distance'</span>] = <span class="number">0</span>  <span class="comment"># æºç‚¹è·ç¦»åˆå§‹ä¸º0ï¼Œå…¶ä»–ä¸ºæ— ç©·è¿œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">relax</span><span class="params">(graph, u, v, w)</span>:</span></span><br><span class="line">    <span class="string">"""relaxæ“ä½œï¼Œdistanceçš„å€¼åªåœ¨æ­¤å¤„å‘ç”Ÿæ”¹å˜"""</span></span><br><span class="line">    u_attr, v_attr = graph.nodes[u], graph.nodes[v]</span><br><span class="line">    <span class="keyword">if</span> v_attr[<span class="string">'distance'</span>] &gt; u_attr[<span class="string">'distance'</span>] + w:</span><br><span class="line">        v_attr[<span class="string">'distance'</span>] = u_attr[<span class="string">'distance'</span>] + w  <span class="comment"># æ›´æ–°æœ€çŸ­è·ç¦»</span></span><br><span class="line">        v_attr[<span class="string">'previous'</span>] = u  <span class="comment"># æ›´æ–°å‰é©±ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detect_negative_cycle</span><span class="params">(graph)</span>:</span></span><br><span class="line">    <span class="string">"""æ£€æµ‹å›¾gä¸­æ˜¯å¦åŒ…å«è´ŸæƒçŽ¯è·¯"""</span></span><br><span class="line">    <span class="keyword">for</span> u, v, w <span class="keyword">in</span> graph.edges.data(<span class="string">'weight'</span>):</span><br><span class="line">        <span class="keyword">if</span> graph.nodes[v][<span class="string">'distance'</span>] &gt; graph.nodes[u][<span class="string">'distance'</span>] + w:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bellman_ford</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="string">"""Bellman Fordç®—æ³•ï¼ŒåŒæ—¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨æƒé‡ä¸ºè´Ÿå€¼çš„çŽ¯è·¯"""</span></span><br><span class="line">    initialize_single_source(graph, s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(graph.number_of_nodes() - <span class="number">1</span>):  <span class="comment"># é‡å¤|V|-1é</span></span><br><span class="line">        <span class="keyword">for</span> u, v, w <span class="keyword">in</span> graph.edges.data(<span class="string">'weight'</span>):  <span class="comment"># å¯¹æ¯æ¡è¾¹æ‰§è¡Œä¸€æ¬¡relax</span></span><br><span class="line">            relax(graph, u, v, w)</span><br><span class="line">    <span class="keyword">return</span> detect_negative_cycle(graph)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bellman_ford_op_1</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="string">"""ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šæå‰è·³å‡ºå¾ªçŽ¯"""</span></span><br><span class="line">    initialize_single_source(graph, s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(graph.number_of_nodes() - <span class="number">1</span>):</span><br><span class="line">        relaxed = <span class="literal">False</span>  <span class="comment"># ä¸€æ¬¡å¾ªçŽ¯å¼€å§‹å‰ï¼Œæ ‡å¿—ä½ç½®ä¸º0</span></span><br><span class="line">        <span class="keyword">for</span> u, v, w <span class="keyword">in</span> graph.edges.data(<span class="string">'weight'</span>):</span><br><span class="line">            <span class="keyword">if</span> relax(graph, u, v, w) <span class="keyword">is</span> <span class="literal">True</span>:  <span class="comment"># è‹¥æ¾å¼›æˆåŠŸï¼Œæ ‡å¿—ä½ç½®ä¸º1</span></span><br><span class="line">                relaxed = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> relaxed <span class="keyword">is</span> <span class="literal">False</span>:  <span class="comment"># æå‰è·³å‡ºå¾ªçŽ¯</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># è‹¥å®Œæ•´æ‰§è¡Œäº†|V|-1æ¬¡å¾ªçŽ¯ï¼Œåˆ™åŽ»åˆ¤æ–­æ˜¯å¦åŒ…å«è´ŸæƒçŽ¯</span></span><br><span class="line">        <span class="keyword">return</span> detect_negative_cycle(graph)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bellman_ford_op_2</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="string">"""é˜Ÿåˆ—ä¼˜åŒ–"""</span></span><br><span class="line">    initialize_single_source(graph, s)</span><br><span class="line">    q = Queue()</span><br><span class="line">    <span class="keyword">for</span> u, v <span class="keyword">in</span> graph.edges:</span><br><span class="line">        graph[u][v][<span class="string">'__times__'</span>] = <span class="number">0</span>  <span class="comment"># è®°å½•æ¾å¼›æ¬¡æ•°ï¼ˆä¸è®ºç»“æžœï¼‰ï¼Œå½“è¶…è¿‡|V|-1æ¬¡æ—¶ï¼Œè¯´æ˜Žå›¾ä¸­åŒ…å«è´ŸæƒçŽ¯</span></span><br><span class="line">    q.put(s)  <span class="comment"># åˆå§‹æ”¾å…¥æºç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">        u = q.get()</span><br><span class="line">        <span class="keyword">for</span> v, attr <span class="keyword">in</span> graph[u].items():  <span class="comment"># éåŽ†é‚»æŽ¥è¾¹</span></span><br><span class="line">            <span class="keyword">if</span> relax(graph, u, v, attr[<span class="string">'weight'</span>]) <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">                q.put(v)  <span class="comment"># å°†æ¾å¼›æˆåŠŸè¿‡çš„ç»“ç‚¹æ”¾å…¥é˜Ÿåˆ—</span></span><br><span class="line">                graph[u][v][<span class="string">'__times__'</span>] += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> graph[u][v][<span class="string">'__times__'</span>] &gt; graph.number_of_nodes() - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># Bellman-Fordç¤ºä¾‹</span></span><br><span class="line">    g = nx.DiGraph()</span><br><span class="line">    g.add_nodes_from(<span class="string">'stxyz'</span>)</span><br><span class="line">    edges = [(<span class="string">'s'</span>, <span class="string">'t'</span>, <span class="number">6</span>), (<span class="string">'s'</span>, <span class="string">'y'</span>, <span class="number">7</span>), (<span class="string">'t'</span>, <span class="string">'x'</span>, <span class="number">5</span>), (<span class="string">'t'</span>, <span class="string">'y'</span>, <span class="number">8</span>), (<span class="string">'t'</span>, <span class="string">'z'</span>, <span class="number">-4</span>), (<span class="string">'x'</span>, <span class="string">'t'</span>, <span class="number">-2</span>), (<span class="string">'y'</span>, <span class="string">'x'</span>, <span class="number">-3</span>),</span><br><span class="line">             (<span class="string">'y'</span>, <span class="string">'z'</span>, <span class="number">9</span>), (<span class="string">'z'</span>, <span class="string">'s'</span>, <span class="number">2</span>), (<span class="string">'z'</span>, <span class="string">'x'</span>, <span class="number">7</span>)]</span><br><span class="line">    g.add_weighted_edges_from(edges)</span><br><span class="line">    r = bellman_ford(g, <span class="string">'s'</span>)</span><br><span class="line">    print_f(g, r)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸€ä¸ªå¸¦æœ‰è´ŸæƒçŽ¯è·¯çš„ç¤ºä¾‹</span></span><br><span class="line">    g.clear()</span><br><span class="line">    g.add_nodes_from(<span class="string">'s1234t'</span>)</span><br><span class="line">    edges = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">1</span>), (<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="number">1</span>), (<span class="string">'2'</span>, <span class="string">'1'</span>, <span class="number">-2</span>), (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="number">1</span>), (<span class="string">'3'</span>, <span class="string">'4'</span>, <span class="number">-4</span>), (<span class="string">'4'</span>, <span class="string">'1'</span>, <span class="number">1</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">1</span>)]</span><br><span class="line">    g.add_weighted_edges_from(edges)</span><br><span class="line">    r = bellman_ford_op_2(g, <span class="string">'s'</span>)</span><br><span class="line">    print_f(g, r)</span><br><span class="line"></span><br><span class="line">    g.clear()</span><br><span class="line">    g.add_nodes_from(<span class="string">'s1234t'</span>)</span><br><span class="line">    edges = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">3</span>), (<span class="string">'1'</span>, <span class="string">'s'</span>, <span class="number">-3</span>), (<span class="string">'s'</span>, <span class="string">'2'</span>, <span class="number">4</span>), (<span class="string">'2'</span>, <span class="string">'s'</span>, <span class="number">-4</span>), (<span class="string">'2'</span>, <span class="string">'1'</span>, <span class="number">3</span>), (<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="number">-3</span>), (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="number">7</span>),</span><br><span class="line">             (<span class="string">'3'</span>, <span class="string">'1'</span>, <span class="number">-7</span>), (<span class="string">'3'</span>, <span class="string">'2'</span>, <span class="number">5</span>), (<span class="string">'2'</span>, <span class="string">'4'</span>, <span class="number">6</span>), (<span class="string">'4'</span>, <span class="string">'2'</span>, <span class="number">-6</span>), (<span class="string">'3'</span>, <span class="string">'4'</span>, <span class="number">-8</span>), (<span class="string">'3'</span>, <span class="string">'t'</span>, <span class="number">6</span>),</span><br><span class="line">             (<span class="string">'t'</span>, <span class="string">'3'</span>, <span class="number">-6</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">9</span>), (<span class="string">'t'</span>, <span class="string">'4'</span>, <span class="number">-9</span>)]</span><br><span class="line">    g.add_weighted_edges_from(edges)</span><br><span class="line">    r = bellman_ford_op_1(g, <span class="string">'s'</span>)</span><br><span class="line">    print_f(g, r)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">has negative cycle or not? False</span><br><span class="line">vertex     distance   previous  </span><br><span class="line">s          0          None</span><br><span class="line">t          2          x</span><br><span class="line">x          4          y</span><br><span class="line">y          7          s</span><br><span class="line">z          -2         t</span><br><span class="line"></span><br><span class="line">has negative cycle or not? True</span><br><span class="line">vertex     distance   previous  </span><br><span class="line">s          0          None</span><br><span class="line">1          -4         4</span><br><span class="line">2          -3         1</span><br><span class="line">3          -2         1</span><br><span class="line">4          -6         3</span><br><span class="line">t          -4         4</span><br><span class="line"></span><br><span class="line">has negative cycle or not? True</span><br><span class="line">vertex     distance   previous  </span><br><span class="line">s          -23        2</span><br><span class="line">1          -17        3</span><br><span class="line">2          -24        4</span><br><span class="line">3          -15        t</span><br><span class="line">4          -18        3</span><br><span class="line">t          -9         4</span><br></pre></td></tr></table></figure><h1 id="dijkstraç®—æ³•">Dijkstraç®—æ³•</h1><p>Dijkstraç®—æ³•æ˜¯å¦ä¸€ä¸ªè§£å†³å•æºæœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ï¼Œè¯¥è¦æ±‚æ‰€æœ‰è¾¹çš„æƒé‡éƒ½ä¸ºéžè´Ÿå€¼ã€‚</p><p>Dijkstraç®—æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»´æŒçš„å…³é”®ä¿¡æ¯æ˜¯ä¸€ç»„ç»“ç‚¹é›†åˆSã€‚ä»ŽæºèŠ‚ç‚¹såˆ°è¯¥é›†åˆä¸­æ¯ä¸ªç»“ç‚¹ä¹‹é—´çš„æœ€çŸ­è·ç¦»å·²ç»è¢«æ‰¾åˆ°ã€‚ç®—æ³•é‡å¤ä»Žç»“ç‚¹é›†V-Sä¸­é€‰æ‹©<strong>æœ€çŸ­è·¯å¾„ä¼°è®¡æœ€å°</strong>çš„ç»“ç‚¹uï¼Œå°†uåŠ å…¥åˆ°é›†åˆSï¼Œç„¶åŽå¯¹æ‰€æœ‰ä»Žuå‘å‡ºçš„è¾¹è¿›è¡Œæ¾å¼›ï¼ˆå¯¹äºŽè¾¹<span class="math inline">\((u,v),v\in{S}\)</span>æ˜¯æ²¡æœ‰æ¾å¼›çš„å¿…è¦çš„ï¼Œå³ä½¿å¯¹ä¹‹æ¾å¼›ï¼Œæ¾å¼›ä¸€å®šä¸ä¼šæˆåŠŸï¼Œå› ä¸ºsåˆ°vçš„æœ€çŸ­è·ç¦»å·²ç»æ±‚å‡ºï¼‰ã€‚å› ä¸ºç®—æ³•æ€»æ˜¯é€‰æ‹©é›†åˆV-Sä¸­æœ€è¿‘çš„ç»“ç‚¹æ¥åŠ å…¥åˆ°é›†åˆSä¸­ï¼Œè¯¥ç®—æ³•ä½¿ç”¨çš„æ˜¯è´ªå¿ƒç­–ç•¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DIJKSTRA(G, w, s):</span><br><span class="line">    INITIALIZE-SINGLE-SOURCE(G, s)</span><br><span class="line">    S = empty set           <span class="comment"># åˆ°æºç‚¹sçš„æœ€çŸ­è·ç¦»è¢«æ‰¾åˆ°çš„ç»“ç‚¹é›†ï¼Œä¼ªä»£ç ä¸­ä½“çŽ°çš„ä½œç”¨ä¸å¤§</span></span><br><span class="line">    Q = G.V                 <span class="comment"># åˆå§‹æ—¶å°†æ‰€æœ‰ç»“ç‚¹æ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">while</span> Q <span class="keyword">not</span> empty:</span><br><span class="line">        u = EXTRACT-MIN(Q)  <span class="comment"># é€‰æ‹©æœ€çŸ­è·¯å¾„ä¼°è®¡æœ€å°çš„ç»“ç‚¹</span></span><br><span class="line">        S = S + &#123;u&#125;         <span class="comment"># å°†uåŠ å…¥é›†åˆS</span></span><br><span class="line">        <span class="keyword">for</span> each vertex v <span class="keyword">in</span> G.Adj[u]:     <span class="comment"># æ¾å¼›æ‰€æœ‰ä»Žuå‘å‡ºçš„è¾¹</span></span><br><span class="line">            RELAX(u, v, w)  <span class="comment"># å¦‚æžœæ¾å¼›æˆåŠŸï¼Œè¿˜è¦æ”¹å˜ä¼˜å…ˆé˜Ÿåˆ—ä¸­ç»“ç‚¹vçš„å‡å€¼</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/execution-of-dijkstra.png" title="Dijkstraæ¯æ¬¡è¿­ä»£åŽçš„ç»“æžœ"></p><p>åœ¨ä¸€ä¸ªç»“ç‚¹ä¸ªæ•°ä¸º5çš„å¸¦æƒé‡çš„æœ‰å‘å›¾ä¸Šæ‰§è¡ŒDijkstraç®—æ³•çš„è¿‡ç¨‹å¦‚ä¸Šå›¾ã€‚</p><p>(a)~(e) ä¸ºæ¯æ¬¡whileå¾ªçŽ¯å¼€å§‹æ—¶ï¼Œç°è‰²ç»“ç‚¹ä¸ºæœ€çŸ­è·¯å¾„ä¼°è®¡æœ€å°çš„ç»“ç‚¹ã€‚ç™½è‰²ç»“ç‚¹å±žäºŽé›†åˆV-Sã€‚</p><p>(b)~(f) ä¸ºæ¯æ¬¡forå¾ªçŽ¯ç»“æŸåŽï¼Œé˜´å½±çš„è¾¹æè¿°äº†å‰é©±èŠ‚ç‚¹ã€‚é»‘è‰²çš„ç»“ç‚¹å±žäºŽé›†åˆSã€‚å›¾(f)å°±æ˜¯æœ€ç»ˆç»“æžœã€‚</p><h2 id="åˆ†æž-1">åˆ†æž</h2><p>é¦–å…ˆåˆ†æžç®—æ³•çš„å¾ªçŽ¯æ¬¡æ•°ã€‚ç®—æ³•è°ƒç”¨1æ¬¡INITIALIZE-SINGLE-SOURCEæ“ä½œå’Œ1æ¬¡åˆå§‹åŒ–ä¼˜å…ˆé˜Ÿåˆ—æ“ä½œQ=G.Vã€‚ä¹‹åŽçš„whileå¾ªçŽ¯æ‰§è¡Œæ¬¡æ•°ä¸º|V|æ¬¡ï¼Œå› ä¸ºæ¯æ¬¡å¾ªçŽ¯éƒ½ä»Žæœ€å°ä¼˜å…ˆé˜Ÿåˆ—Qä¸­æå–ä¸€ä¸ªç»“ç‚¹ã€‚å› æ­¤ï¼ŒEXTRACT-MINä¹Ÿæ‰§è¡Œäº†|V|æ¬¡ã€‚å†…å±‚çš„forå¾ªçŽ¯å¯¹ä»Žç»“ç‚¹uå‘å‡ºçš„è¾¹æ‰§è¡Œä¸€æ¬¡æ¾å¼›æ“ä½œï¼Œè€Œåœ¨whileå¾ªçŽ¯è¿‡ç¨‹ä¸­ï¼Œuå–åˆ°äº†å›¾ä¸­æ‰€æœ‰çš„ç»“ç‚¹ä¸”å„å–åˆ°ä¸€æ¬¡ã€‚å› æ­¤forå¾ªçŽ¯å®žé™…ä¸Šå¯¹å›¾ä¸­æ‰€æœ‰çš„è¾¹æ‰§è¡Œäº†1æ¬¡æ¾å¼›æ“ä½œï¼Œå³RELAXæ“ä½œçš„æ‰§è¡Œæ¬¡æ•°ä¸º|E|ã€‚æš—å«åœ¨å…¶ä¸­çš„é™ä½Žé”®å€¼DECREASE-KEYæ“ä½œä¹Ÿæ‰§è¡Œäº†|E|æ¬¡ã€‚</p><p>å¦‚ä½•å®žçŽ°ç®—æ³•ä¸­çš„ä¼˜å…ˆé˜Ÿåˆ—ç›´æŽ¥å½±å“åˆ°ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ã€‚åœ¨æ­¤åˆ—å‡º3ä¸­å®žçŽ°ä¸‹çš„æ—¶é—´å¤æ‚åº¦åˆ†æžã€‚</p><table><thead><tr class="header"><th>å®žçŽ°æ–¹å¼</th><th>åˆå§‹åŒ–ä»£ä»·*1</th><th>æå–æœ€å°å€¼ä»£ä»·*V</th><th>é™ä½Žé”®å€¼ä»£ä»·*E</th><th>Dijkstraç®—æ³•æ€»ä»£ä»·</th></tr></thead><tbody><tr class="odd"><td>æ•°ç»„</td><td><span class="math inline">\(O(V)\)</span></td><td><span class="math inline">\(O(V)\)</span>ï¼Œæœç´¢æ•´ä¸ªæ•°ç»„</td><td><span class="math inline">\(O(1)\)</span></td><td><span class="math inline">\(O(V^2+E)=O(V^2)\)</span></td></tr><tr class="even"><td>äºŒå‰å †</td><td><span class="math inline">\(O(V)\)</span></td><td><span class="math inline">\(O(\lg{V})\)</span>ï¼Œè°ƒæ•´é˜Ÿ</td><td><span class="math inline">\(O(\lg{V})\)</span>ï¼Œè°ƒæ•´å †</td><td><span class="math inline">\(O((V+E)\lg{V})\)</span></td></tr><tr class="odd"><td>æ–æ³¢é‚£å¥‘å †</td><td><span class="math inline">\(O(V)\)</span></td><td><span class="math inline">\(O(\lg{V})\)</span>ï¼Œæ‘Šè¿˜ä»£ä»·</td><td><span class="math inline">\(O(1)\)</span>ï¼Œæ‘Šè¿˜ä»£ä»·</td><td><span class="math inline">\(O(V\lg{V}+E)\)</span></td></tr></tbody></table><p>è‹¥æ‰€æœ‰ç»“ç‚¹éƒ½å¯ä»¥ä»ŽæºèŠ‚ç‚¹åˆ°è¾¾ï¼ˆ|V|&lt;|E|ï¼‰ï¼Œåˆ™<span class="math inline">\(O((V+E)\lg{V})=O(E\lg{V})\)</span>ã€‚å¯¹äºŽç¨€ç–å›¾ï¼Œç‰¹åˆ«åœ°ï¼Œå¦‚æžœ<span class="math inline">\(E=o(V^2/\lg{V})\)</span>ï¼Œåˆ™ä½¿ç”¨äºŒå‰å †å®žçŽ°æœ€å°ä¼˜å…ˆé˜Ÿåˆ—ç›¸å¯¹äºŽç”¨æ•°ç»„ç›´æŽ¥å®žçŽ°çš„<span class="math inline">\(O(V^2)\)</span>ä»£ä»·æœ‰æ”¹å–„ã€‚</p><p>Dijkstraç®—æ³•ä¸Žå¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•åŠè®¡ç®—æœ€å°ç”Ÿæˆæ ‘çš„Primç®—æ³•çš„ç›¸ä¼¼ç‚¹ï¼š</p><ul><li>ä¸Žå¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼šé›†åˆSå¯¹åº”çš„æ˜¯å¹¿åº¦ä¼˜å…ˆæœç´¢ä¸­çš„é»‘è‰²ç»“ç‚¹é›†åˆï¼šæ­£å¦‚é›†åˆSä¸­çš„ç»“ç‚¹çš„æœ€çŸ­è·¯å¾„æƒé‡å·²ç»è®¡ç®—å‡ºæ¥ä¸€æ ·ï¼Œåœ¨å¹¿åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œé»‘è‰²ç»“ç‚¹çš„æ­£ç¡®å¹¿åº¦ä¼˜å…ˆè·ç¦»ä¹Ÿå·²ç»è®¡ç®—å‡ºæ¥ã€‚</li><li>ä¸ŽPrimç®—æ³•ï¼šä¸¤ä¸ªç®—æ³•éƒ½ä½¿ç”¨æœ€å°ä¼˜å…ˆé˜Ÿåˆ—æ¥å¯»æ‰¾é›†åˆä¹‹å¤–â€œæœ€è½»â€ç»“ç‚¹ï¼Œå°†è¯¥èŠ‚ç‚¹åŠ å…¥åˆ°é›†åˆé‡Œï¼Œå¹¶å¯¹ä½äºŽé›†åˆå¤–é¢çš„ç»“ç‚¹çš„æƒé‡è¿›è¡Œç›¸åº”è°ƒæ•´ã€‚</li></ul><h2 id="ä»£ç -1">ä»£ç </h2><p>ä½¿ç”¨å†…å»ºçš„ä¼˜å…ˆé˜Ÿåˆ—æ—¶çš„å¦¥åï¼š</p><p>å› ä¸ºæ— æ³•æ”¹å˜ä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„é”®å€¼ï¼ˆæˆ–è€…è¯´æ”¹å˜äº†ä¹Ÿæ²¡æœ‰æ„ä¹‰ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä¸ä¼šè°ƒæ•´ç»“ç‚¹åœ¨é˜Ÿåˆ—ä¸­çš„å…ˆåŽé¡ºåºï¼‰ï¼Œæ‰€ä»¥åœ¨åˆå§‹æ—¶<span class="math inline">\(Q\neq{G.V}\)</span>ï¼Œè€Œæ˜¯åªå°†æºç‚¹sæ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚ä¹‹åŽåœ¨æ¾å¼›è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘çŽ°é›†åˆSä¸­ä¸å­˜åœ¨çš„ç»“ç‚¹ï¼Œå†å°†ä¹‹æ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚</p><p>ä½†è¿™ä¹Ÿéšä¹‹äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼šå¤šæ¡ä¸åŒçš„è¾¹å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªé›†åˆSå¤–çš„ç»“ç‚¹uï¼Œå½“è¿™äº›è¾¹æˆåŠŸæ¾å¼›å¤šæ¬¡æ—¶ï¼Œç»“ç‚¹uè¢«å¤šæ¬¡åŠ å…¥é˜Ÿåˆ—ä¸­ï¼ˆå› ä¸ºå†…å»ºçš„ä¼˜å…ˆé˜Ÿåˆ—æ²¡æœ‰æä¾›DECREASE-KEYæ“ä½œï¼Œåªèƒ½é€šè¿‡é‡å¤æ”¾å…¥çš„æ–¹å¼æ›´æ–°é”®å€¼ï¼‰ã€‚è¿™äº›é‡å¤åŠ å…¥çš„ç»“ç‚¹uæºå¸¦ä¸åŒçš„é”®å€¼ï¼Œæ˜¾ç„¶ï¼Œå› æœ€è¿‘ä¸€æ¬¡æ¾å¼›æˆåŠŸè€Œè¢«åŠ å…¥é˜Ÿåˆ—çš„ç»“ç‚¹uæºå¸¦æœ€å°çš„é”®å€¼ã€‚æºå¸¦è¾ƒå¤§é”®å€¼çš„ç»“ç‚¹uå¯¹ç®—æ³•æ²¡æœ‰æ„ä¹‰ï¼Œä½†å®ƒä»¬ä»ç„¶å­˜åœ¨äºŽé˜Ÿåˆ—ä¸­ã€‚å› æ­¤ï¼Œåœ¨å¾ªçŽ¯å¼€å§‹æ—¶å¯¹å–å¾—çš„ç»“ç‚¹è¿›è¡Œåˆ¤æ–­ï¼šè‹¥uç»“ç‚¹åœ¨visité›†åˆä¸­ï¼Œè¯´æ˜Žæºç»“ç‚¹såˆ°uçš„æœ€çŸ­è·ç¦»å·²ç»æ±‚å‡ºï¼Œè·³è¿‡è¿™æ ·çš„ç»“ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> PriorityQueue</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">from</span> graph.bellman_ford <span class="keyword">import</span> initialize_single_source, relax, print_f</span><br><span class="line"><span class="keyword">from</span> data_structure.fib_heap <span class="keyword">import</span> FibHeap, Node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra_queue</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="string">"""ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—"""</span></span><br><span class="line">    initialize_single_source(graph, s)</span><br><span class="line">    visit, q = set(), PriorityQueue()  <span class="comment"># visitï¼šé›†åˆS</span></span><br><span class="line">    q.put((graph.nodes[s][<span class="string">'distance'</span>], s))  <span class="comment"># åˆå§‹æ—¶så…¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">while</span> q.empty() <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        u = q.get()[<span class="number">1</span>]  <span class="comment"># é€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹u</span></span><br><span class="line">        <span class="keyword">if</span> u <span class="keyword">not</span> <span class="keyword">in</span> visit:</span><br><span class="line">            visit.add(u)</span><br><span class="line">            <span class="keyword">for</span> v, e_attr <span class="keyword">in</span> graph[u].items():</span><br><span class="line">                <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> visit:  <span class="comment"># å·²ç»è®¿é—®è¿‡çš„é¡¶ç‚¹æ— éœ€å…¥é˜Ÿåˆ—</span></span><br><span class="line">                    relax(graph, u, v, e_attr[<span class="string">'weight'</span>])  <span class="comment"># relaxæœ€è¿‘é¡¶ç‚¹uçš„ä¸´ç•Œç‚¹</span></span><br><span class="line">                    q.put((graph.nodes[v][<span class="string">'distance'</span>], v))  <span class="comment"># ä¸´æŽ¥é¡¶ç‚¹å…¥é˜Ÿåˆ—ï¼ŒåŒä¸€é¡¶ç‚¹å¯èƒ½å¸¦æœ‰ä¸åŒçš„distanceå€¼å¤šæ¬¡å…¥é˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra_fibonacci</span><span class="params">(graph, s)</span>:</span></span><br><span class="line">    <span class="string">"""ä½¿ç”¨æ–æ³¢é‚£å¥‘å †ä¼˜åŒ–ç®—æ³•"""</span></span><br><span class="line">    initialize_single_source(graph, s)</span><br><span class="line">    m, visit, heap = &#123;&#125;, set(), FibHeap()  <span class="comment"># mï¼šé¡¶ç‚¹åˆ°å †ä¸­ç»“ç‚¹çš„æ˜ å°„&#123;v.key:Node&#125;</span></span><br><span class="line">    <span class="keyword">for</span> v, v_attr <span class="keyword">in</span> graph.nodes.items():  <span class="comment"># æ‰€æœ‰é¡¶ç‚¹å…¥å †</span></span><br><span class="line">        n = Node(v_attr[<span class="string">'distance'</span>])</span><br><span class="line">        n.v = v  <span class="comment"># ä¸ºfibonacci nodeæ·»åŠ å±žæ€§vï¼Œè®°å½•æŒ‡å‘é¡¶ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">        heap.insert(n)</span><br><span class="line">        m[v] = n</span><br><span class="line">    <span class="keyword">while</span> heap.n &gt; <span class="number">0</span>:  <span class="comment"># å®žé™…ä¸Šå¾ªçŽ¯|V|-1æ¬¡ï¼Œç­‰ä»·äºŽfor i in range(len(g.get_v_set()))</span></span><br><span class="line">        u = heap.pop().v  <span class="comment"># é€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹u</span></span><br><span class="line">        visit.add(u)</span><br><span class="line">        <span class="keyword">for</span> v, e_attr <span class="keyword">in</span> graph[u].items():</span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> visit:</span><br><span class="line">                relax(graph, u, v, e_attr[<span class="string">'weight'</span>])</span><br><span class="line">                heap.decrease_key(m[v], graph.nodes[v][<span class="string">'distance'</span>])  <span class="comment"># ä¿®æ”¹heapä¸­å¯¹åº”èŠ‚ç‚¹çš„keyå€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># Dijkstraç¤ºä¾‹</span></span><br><span class="line">    g = nx.DiGraph()</span><br><span class="line">    g.add_nodes_from(<span class="string">'s12345t'</span>)</span><br><span class="line">    edges = [(<span class="string">'s'</span>, <span class="string">'1'</span>, <span class="number">2</span>), (<span class="string">'s'</span>, <span class="string">'2'</span>, <span class="number">3</span>), (<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="number">4</span>), (<span class="string">'1'</span>, <span class="string">'3'</span>, <span class="number">8</span>), (<span class="string">'1'</span>, <span class="string">'4'</span>, <span class="number">5</span>), (<span class="string">'2'</span>, <span class="string">'4'</span>, <span class="number">3</span>), (<span class="string">'2'</span>, <span class="string">'5'</span>, <span class="number">4</span>),</span><br><span class="line">             (<span class="string">'3'</span>, <span class="string">'4'</span>, <span class="number">2</span>), (<span class="string">'3'</span>, <span class="string">'t'</span>, <span class="number">9</span>), (<span class="string">'4'</span>, <span class="string">'t'</span>, <span class="number">6</span>), (<span class="string">'5'</span>, <span class="string">'t'</span>, <span class="number">10</span>)]</span><br><span class="line">    g.add_weighted_edges_from(edges)</span><br><span class="line">    dijkstra_queue(g, <span class="string">'s'</span>)</span><br><span class="line">    print_f(g)</span><br><span class="line"></span><br><span class="line">    g.clear()</span><br><span class="line">    g.add_nodes_from(<span class="string">'stxyz'</span>)</span><br><span class="line">    edges = [(<span class="string">'s'</span>, <span class="string">'t'</span>, <span class="number">10</span>), (<span class="string">'s'</span>, <span class="string">'y'</span>, <span class="number">5</span>), (<span class="string">'t'</span>, <span class="string">'x'</span>, <span class="number">1</span>), (<span class="string">'t'</span>, <span class="string">'y'</span>, <span class="number">2</span>), (<span class="string">'x'</span>, <span class="string">'z'</span>, <span class="number">4</span>), (<span class="string">'y'</span>, <span class="string">'t'</span>, <span class="number">3</span>), (<span class="string">'y'</span>, <span class="string">'x'</span>, <span class="number">9</span>),</span><br><span class="line">             (<span class="string">'y'</span>, <span class="string">'z'</span>, <span class="number">2</span>), (<span class="string">'z'</span>, <span class="string">'s'</span>, <span class="number">7</span>), (<span class="string">'z'</span>, <span class="string">'x'</span>, <span class="number">6</span>)]</span><br><span class="line">    g.add_weighted_edges_from(edges)</span><br><span class="line">    dijkstra_fibonacci(g, <span class="string">'s'</span>)</span><br><span class="line">    print_f(g)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vertex     distance   previous  </span><br><span class="line">s          0          None</span><br><span class="line">1          2          s</span><br><span class="line">2          3          s</span><br><span class="line">3          10         1</span><br><span class="line">4          6          2</span><br><span class="line">5          7          2</span><br><span class="line">t          12         4</span><br><span class="line"></span><br><span class="line">vertex     distance   previous  </span><br><span class="line">s          0          None</span><br><span class="line">t          8          y</span><br><span class="line">x          9          t</span><br><span class="line">y          5          s</span><br><span class="line">z          7          y</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> algorithms </tag>
            
            <tag> fibonacci heap </tag>
            
            <tag> greedy method </tag>
            
            <tag> priority queue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå‰æœç´¢æ ‘</title>
      <link href="/notes/introduction-to-algorithms/binary-search-trees/"/>
      <url>/notes/introduction-to-algorithms/binary-search-trees/</url>
      
        <content type="html"><![CDATA[<h1 id="äºŒå‰æœç´¢æ ‘">äºŒå‰æœç´¢æ ‘</h1><p>ä¸€æ£µäºŒå‰æœç´¢æ ‘æ˜¯ä»¥ä¸€æ£µäºŒå‰æ ‘æ¥ç»„ç»‡çš„ã€‚æ¯ä¸ªç»“ç‚¹é™¤äº†keyä¹‹å¤–ï¼Œè¿˜åŒ…å«å±žæ€§leftã€rightã€pï¼Œåˆ†åˆ«æŒ‡å‘ç»“ç‚¹çš„å·¦å­©å­ã€å³å­©å­å’Œçˆ¶èŠ‚ç‚¹ã€‚å¦‚æžœçˆ¶èŠ‚ç‚¹æˆ–è€…å­èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™ç›¸åº”å±žæ€§å€¼ä¸ºNILã€‚æ ¹èŠ‚ç‚¹æ˜¯å”¯ä¸€çˆ¶èŠ‚ç‚¹ä¸ºNILçš„ç»“ç‚¹ã€‚</p><h1 id="æ€§è´¨">æ€§è´¨</h1><p>äºŒå‰æœç´¢æ ‘æ€§è´¨ï¼š</p><p>è®¾xæ˜¯äºŒå‰æœç´¢æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ã€‚å¦‚æžœyæ˜¯xå·¦å­æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆ<span class="math inline">\(y.key\le{x.key}\)</span>ã€‚å¦‚æžœyæ˜¯xå³å­æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆ<span class="math inline">\(y.key\ge{x.key}\)</span>ã€‚</p><p>æ ¹æ®æ­¤æ€§è´¨ï¼Œå¯ä»¥é€šè¿‡ä¸­åºéåŽ†ï¼ˆinorder tree walkï¼‰ç®—æ³•æŒ‰åºè¾“å‡ºäºŒå‰æœç´¢æ ‘ä¸­çš„æ‰€æœ‰å…³é”®å­—ã€‚æ¯”è¾ƒç®€å•çš„é€’å½’å®žçŽ°å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INORDER-TREE-WALK(x):</span><br><span class="line">    <span class="keyword">if</span> x != NIL:</span><br><span class="line">        INORDER-TREE-WALK(x.left)</span><br><span class="line">        <span class="keyword">print</span> x.key</span><br><span class="line">        INORDER-TREE-WALK(x.right)</span><br></pre></td></tr></table></figure><p>åŒ…å«ç›¸åŒç»“ç‚¹çš„ä¸¤æ£µé«˜åº¦ä¸åŒçš„äºŒå‰æœç´¢æ ‘ã€‚å¤§éƒ¨åˆ†æœç´¢æ ‘æ“ä½œçš„è¿è¡Œæ—¶é—´ä¸Žæ ‘çš„é«˜åº¦æˆæ­£æ¯”ã€‚å› æ­¤(b)æ¯”(a)ä½Žæ•ˆã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/binary-search-trees.png" title="äºŒå‰æœç´¢æ ‘"></p><h1 id="æ“ä½œ">æ“ä½œ</h1><h2 id="æŸ¥æ‰¾">æŸ¥æ‰¾</h2><p>ä½¿ç”¨ä¸‹é¢çš„è¿‡ç¨‹åœ¨ä¸€æ£µäºŒå‰æœç´¢æ ‘ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…·æœ‰ç»™å®šå…³é”®å­—çš„ç»“ç‚¹ã€‚è¾“å…¥ä¸€ä¸ªæŒ‡å‘æ ‘æ ¹çš„æŒ‡é’ˆxå’Œä¸€ä¸ªå…³é”®å­—kï¼Œå¦‚æžœè¿™ä¸ªç»“ç‚¹å­˜åœ¨ï¼Œè¿”å›žä¸€ä¸ªæŒ‡å‘å…³é”®å­—ä¸ºkçš„ç»“ç‚¹çš„æŒ‡é’ˆï¼›å¦åˆ™è¿”å›žNILã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-SEARCH(x, k):</span><br><span class="line">    <span class="keyword">if</span> x == NIL <span class="keyword">or</span> k == x.key:  <span class="comment"># å¦‚æžœå…³é”®å­—ä¸Žkç›¸ç­‰ï¼Œè¿”å›žç»“æžœ</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">if</span> k &lt; x.key:               <span class="comment"># å¦‚æžœå…³é”®å­—å¤§äºŽkï¼ŒæŸ¥æ‰¾åœ¨å·¦å­æ ‘ä¸­ç»§ç»­</span></span><br><span class="line">        <span class="keyword">return</span> TREE-SEARCH(x.left, k)   <span class="comment"># é€’å½’</span></span><br><span class="line">    <span class="keyword">else</span>:                       <span class="comment"># å¦‚æžœå…³é”®å­—å°äºŽkï¼ŒæŸ¥æ‰¾åœ¨å³å­æ ‘ä¸­ç»§ç»­</span></span><br><span class="line">        <span class="keyword">return</span> TREE-SEARCH(x.right, k)</span><br></pre></td></tr></table></figure><p>å¯ä»¥é‡‡ç”¨å¾ªçŽ¯æ¥å±•å¼€é€’å½’ï¼Œç”¨ä¸€ç§è¿­ä»£æ–¹å¼é‡å†™æ­¤è¿‡ç¨‹ã€‚å¯¹äºŽå¤§å¤šæ•°è®¡ç®—æœºï¼Œè¿­ä»£ç‰ˆæœ¬çš„æ•ˆçŽ‡è¦é«˜å¾—å¤šã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ITERATIVE-TREE-SEARCH(x, k):</span><br><span class="line">    <span class="keyword">while</span> x != NIL <span class="keyword">and</span> k != x.key:  <span class="comment"># è¿­ä»£å®žçŽ°ï¼šå¦‚æžœå…³é”®å­—ä¸Žkä¸ç›¸ç­‰ï¼Œé‡å¤å¾ªçŽ¯</span></span><br><span class="line">        <span class="keyword">if</span> k &lt; x.key:               <span class="comment"># å¦‚æžœå…³é”®å­—å¤§äºŽkï¼ŒæŸ¥æ‰¾åœ¨å·¦å­æ ‘ä¸­ç»§ç»­</span></span><br><span class="line">            x = x.left</span><br><span class="line">        <span class="keyword">else</span>:                       <span class="comment"># å¦åˆ™ï¼Œåœ¨å³å­æ ‘ä¸­ç»§ç»­</span></span><br><span class="line">            x = x.right</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/binary-search-tree-search.png" title="æœç´¢é”®å€¼ç­‰äºŽ13çš„ç»“ç‚¹"></p><p>ä¾‹å¦‚åœ¨å¦‚ä¸Šå›¾æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æŸ¥æ‰¾é”®å€¼ä¸º13çš„æŸ¥æ‰¾è·¯å¾„æ˜¯<span class="math inline">\(15\rightarrow6\rightarrow7\rightarrow13\)</span>ã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š</p><ol type="1"><li>xæŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œæ¯”è¾ƒxä¸Ž13ã€‚13&lt;15ï¼šxæŒ‡å‘x.leftï¼Œåœ¨å·¦å­æ ‘ä¸­ç»§ç»­æŸ¥æ‰¾ã€‚</li><li>13&gt;6ï¼šxæŒ‡å‘x.rightï¼Œåœ¨å³å­æ ‘ä¸­ç»§ç»­æŸ¥æ‰¾ã€‚</li><li>13&gt;7ï¼šxæŒ‡å‘x.rightï¼Œåœ¨å³å­æ ‘ä¸­ç»§ç»­æŸ¥æ‰¾ã€‚</li><li>13=13ï¼šè¿”å›žxã€‚</li></ol><h3 id="æœ€å¤§å’Œæœ€å°å…³é”®å­—">æœ€å¤§å’Œæœ€å°å…³é”®å­—</h3><p>æŸ¥æ‰¾æœ€å°å…³é”®å­—å…ƒç´ ï¼šä»Žæ ¹å¼€å§‹æ²¿ç€leftå­©å­æŒ‡é’ˆç›´åˆ°é‡åˆ°ä¸€ä¸ªNILã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-MINIMUM(X):</span><br><span class="line">    <span class="keyword">while</span> x.left != NIL:  <span class="comment"># å‡è®¾x != NILï¼Œä¸åœæŸ¥æ‰¾å·¦å­æ ‘</span></span><br><span class="line">        x = x.left</span><br><span class="line">    <span class="keyword">return</span> x              <span class="comment"># å½“xçš„å·¦å­æ ‘ä¸ºNILæ—¶ï¼Œxä¸ºæœ€å°å…³é”®å­—å…ƒç´ </span></span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾æœ€å¤§å…³é”®å­—çš„TREE-MAXIMUMçš„ä¼ªä»£ç æ˜¯å¯¹ç§°çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-MAXIMUM(x):</span><br><span class="line">    <span class="keyword">while</span> x.right != NIL:</span><br><span class="line">        x = x.right</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h3 id="åŽç»§å’Œå‰é©±">åŽç»§å’Œå‰é©±</h3><p>ç»™å®šä¸€æ£µäºŒå‰æœç´¢æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œæœ‰æ—¶å€™éœ€è¦æŒ‰ä¸­åºéåŽ†çš„æ¬¡åºæŸ¥æ‰¾å®ƒçš„åŽç»§ã€‚å¦‚æžœæ‰€æœ‰çš„å…³é”®å­—äº’ä¸ç›¸åŒï¼Œåˆ™ä¸€ä¸ªç»“ç‚¹xçš„<strong>åŽç»§</strong>æ˜¯å¤§äºŽx.keyçš„æœ€å°å…³é”®å­—çš„ç»“ç‚¹ã€‚äºŒå‰æœç´¢æ ‘çš„æ€§è´¨å…è®¸æˆ‘ä»¬é€šè¿‡æ²¡æœ‰ä»»ä½•å…³é”®å­—çš„æ¯”è¾ƒæ¥ç¡®å®šä¸€ä¸ªç»“ç‚¹çš„åŽç»§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-SUCCESSOR(x):</span><br><span class="line">    <span class="keyword">if</span> x.right != NIL:  <span class="comment"># å¦‚æžœxçš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œæ ¹æ®æ€§è´¨ï¼Œå³å­æ ‘ä¸­çš„å…³é”®å­—å‡å¤§äºŽxçš„å…³é”®å­—</span></span><br><span class="line">        <span class="keyword">return</span> TREE-MINIMUM(x.right)  <span class="comment"># æ­¤æ—¶xçš„åŽç»§ä¸ºå³å­æ ‘ä¸­æœ€å°çš„ç»“ç‚¹</span></span><br><span class="line">    y = x.p  <span class="comment"># å¦‚æžœå³å­æ ‘ä¸ºç©ºï¼Œé‚£ä¹ˆxçš„åŽç»§æ˜¯ xçš„æœ‰å·¦å­©å­çš„æœ€åº•å±‚ç¥–å…ˆï¼ˆå›žæƒ³ä¸­åºéåŽ†æ¬¡åºï¼‰</span></span><br><span class="line">    <span class="keyword">while</span> y != NIL <span class="keyword">and</span> x == y.right:</span><br><span class="line">        x = y</span><br><span class="line">        y = y.p</span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾<strong>å‰é©±</strong>çš„TREE-PREDECESSORçš„ä¼ªä»£ç æ˜¯å¯¹ç§°çš„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-PREDECESSOR(x):</span><br><span class="line">    <span class="keyword">if</span> x.left != NIL:</span><br><span class="line">        <span class="keyword">return</span> TREE-MAXIMUM(x.left)</span><br><span class="line">    y = x.p</span><br><span class="line">    <span class="keyword">while</span> y != NIL <span class="keyword">and</span> x == y.left:</span><br><span class="line">        x = y</span><br><span class="line">        y = y.p</span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥å’Œåˆ é™¤">æ’å…¥å’Œåˆ é™¤</h2><p>æ’å…¥å’Œåˆ é™¤æ“ä½œä¼šå¼•èµ·ç”±äºŒå‰æœç´¢æ ‘è¡¨ç¤ºçš„åŠ¨æ€é›†åˆçš„å˜åŒ–ï¼ˆäºŒå‰æœç´¢æ ‘ä¸­çš„å…ƒç´ é›†åˆä¼šå˜åŒ–ï¼‰ã€‚ä¸€å®šè¦ä¿®æ”¹æŒ‡é’ˆä»¥ä¿æŒäºŒå‰æœç´¢æ ‘æ€§è´¨çš„æˆç«‹ã€‚</p><h3 id="æ’å…¥">æ’å…¥</h3><p>æ’å…¥æ“ä½œç›¸å¯¹ç®€å•äº›ã€‚å°†ç»“ç‚¹zæ’å…¥åˆ°æ ‘ä¸­çš„ç›¸åº”ä½ç½®ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹è¦ä¿®æ”¹Tå’Œzçš„æŸäº›å±žæ€§ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-INSERT(T, z):</span><br><span class="line">    y = NIL</span><br><span class="line">    x = T.root            <span class="comment"># æ‰¾åˆ°zåœ¨æ ‘ä¸­çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">while</span> x != NIL:</span><br><span class="line">        y = x</span><br><span class="line">        <span class="keyword">if</span> z.key &lt; x.key:</span><br><span class="line">            x = x.left</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x = x.right</span><br><span class="line">    z.p = y               <span class="comment"># æ‰¾åˆ°zçš„ä½ç½®æ—¶ï¼Œyä¸ºzåœ¨æ ‘ä¸­çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> y == NIL:          <span class="comment"># å¦‚æžœçˆ¶èŠ‚ç‚¹ä¸ºNILï¼Œè¯´æ˜Žåœ¨æ’å…¥å‰äºŒå‰æœç´¢æ ‘æ˜¯ç©ºçš„</span></span><br><span class="line">        T.root = z</span><br><span class="line">    <span class="keyword">elif</span> z.key &lt; y.key:   <span class="comment"># åˆ¤æ–­zä¸Žçˆ¶èŠ‚ç‚¹yçš„å¤§å°å…³ç³»ï¼Œå†³å®šzç§°ä¸ºå·¦å­©å­è¿˜æ˜¯å³å­©å­</span></span><br><span class="line">        y.left = z</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        y.right = z</span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/binary-search-tree-insert.png" title="æ’å…¥ä¸€ä¸ªé”®å€¼ç­‰äºŽ13çš„æ–°ç»“ç‚¹"></p><p>ä¾‹å¦‚åœ¨å¦‚ä¸Šå›¾æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ’å…¥é”®å€¼ä¸º13çš„ç»“ç‚¹ã€‚æ­¥éª¤ä¸ºï¼š</p><ol type="1"><li>xæŒ‡å‘æ ¹èŠ‚ç‚¹ã€‚æ¯”è¾ƒxçš„é”®å€¼ä¸Žæ¬²æ’å…¥çš„é”®å€¼13çš„å¤§å°å…³ç³»ï¼š12&lt;13ï¼šxæŒ‡å‘x.rightã€‚æ„å‘³ç€ï¼Œç»“ç‚¹13åº”è¯¥åœ¨æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ä¸­ã€‚</li><li>x.key=18ï¼Œ18&gt;13ï¼šxæŒ‡å‘x.leftã€‚</li><li>x.key=15ï¼Œ15&gt;13ï¼šxæŒ‡å‘x.leftã€‚</li><li>x=NILï¼Œxå°±æ˜¯ç»“ç‚¹13åº”è¯¥æ’å…¥çš„ä½ç½®ã€‚ä¿®æ”¹ç›¸åº”æŒ‡é’ˆå®Œæˆæ’å…¥æ“ä½œã€‚</li></ol><h3 id="åˆ é™¤">åˆ é™¤</h3><p>ä»Žä¸€æ£µäºŒå‰æœç´¢æ ‘Tä¸­åˆ é™¤ä¸€ä¸ªç»“ç‚¹zæ—¶éœ€è¦è€ƒè™‘ä¸‰ç§åŸºæœ¬æƒ…å†µã€‚</p><ul><li>å¦‚æžœzæ²¡æœ‰å­©å­ç»“ç‚¹ã€‚</li><li>å¦‚æžœzåªæœ‰ä¸€ä¸ªå­©å­ã€‚</li><li>å¦‚æžœzæ—¢æœ‰å·¦å­©å­åˆæœ‰å³å­©å­ã€‚</li></ul><p>åœ¨å…·ä½“çš„åˆ é™¤æ“ä½œä¸­ï¼Œåˆ™éœ€è¦è€ƒè™‘4ä¸­æƒ…å†µï¼Œå®ƒä¸Žä¸Šé¢çš„ä¸‰ç§æƒ…å†µæœ‰äº›ä¸åŒã€‚</p><ul><li><ol type="a"><li>è‹¥zçš„å·¦å­©å­ä¸ºç©ºï¼Œé‚£ä¹ˆç”¨å…¶å³å­©å­æ¥æ›¿æ¢zï¼Œè¿™ä¸ªå³å­©å­å¯ä»¥æ˜¯NILã€‚ä¸ºNILæ—¶å¯¹åº”ä¸Šé¢çš„ç¬¬ä¸€ç§æƒ…å†µï¼›ä¸ä¸ºNILæ—¶å¯¹åº”ç¬¬äºŒç§æƒ…å†µã€‚</li></ol></li><li><ol start="2" type="a"><li>è‹¥zçš„å³å­©å­ä¸ºç©ºï¼Œé‚£ä¹ˆç”¨å…¶å·¦å­©å­æ¥æ›¿æ¢zã€‚</li></ol><p>å¦åˆ™ï¼Œzæ—¢æœ‰å·¦å­©å­åˆæœ‰å³å­©å­ã€‚éœ€è¦æŸ¥æ‰¾zçš„åŽç»§èŠ‚ç‚¹yï¼ˆè¿™ä¸ªåŽç»§ä½äºŽzçš„å³å­æ ‘ä¸­å¹¶ä¸”æ²¡æœ‰å·¦å­©å­ï¼‰ã€‚</p></li><li><ol start="3" type="a"><li>è‹¥yæ˜¯zçš„å³å­©å­ï¼Œé‚£ä¹ˆç”¨yæ›¿æ¢zï¼Œå¹¶ä»…ç•™ä¸‹yçš„å³å­©å­ã€‚</li></ol></li><li><ol start="4" type="a"><li>è‹¥yä½äºŽzçš„å³å­æ ‘ä¸­ä½†å¹¶ä¸æ˜¯zçš„å³å­©å­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…ˆç”¨yçš„å³å­©å­æ›¿æ¢yï¼Œç„¶åŽå†ç”¨yæ›¿æ¢zã€‚</li></ol></li></ul><p><img src="/uploads/image/introduction-to-algorithms/binary-search-tree-delete.png" title="åˆ é™¤ç»“ç‚¹çš„4ç§æƒ…å†µ"></p><p>ä¸ºäº†åœ¨äºŒå‰æœç´¢æ ‘å†…ç§»åŠ¨å­æ ‘ï¼Œå®šä¹‰ä¸€ä¸ªå­è¿‡ç¨‹TRANSPLANTã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TRANSPLANT(T, u, v):        <span class="comment"># ç”¨æ ¹èŠ‚ç‚¹ä¸ºvçš„å­æ ‘æ›¿æ¢æ ¹èŠ‚ç‚¹ä¸ºuçš„å­æ ‘</span></span><br><span class="line">    <span class="keyword">if</span> u.p == NIL:          <span class="comment"># è‹¥uä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™å­æ ‘çš„æ›¿æ¢å®žé™…ä¸Šå°±æ˜¯æ•´æ£µæ ‘çš„æ›¿æ¢</span></span><br><span class="line">        T.root = v          <span class="comment"># å› è€Œï¼Œåªéœ€ä¿®æ”¹æ ‘çš„rootå±žæ€§</span></span><br><span class="line">    <span class="keyword">elif</span> u == u.p.left:     <span class="comment"># è‹¥uæ˜¯å·¦å­©å­</span></span><br><span class="line">        u.p.left = v        <span class="comment"># ä¿®æ”¹çˆ¶èŠ‚ç‚¹å·¦å­©å­æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        u.p.right = v       <span class="comment"># å¦åˆ™ä¿®æ”¹å³å­©å­æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">if</span> v != NIL:            <span class="comment"># è‹¥vä¸ä¸ºç©ºï¼Œä¿®æ”¹vçš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">        v.p = u.p</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ï¼ŒTRANSPLANTå¹¶æ²¡æœ‰å¤„ç†v.leftå’Œv.rightçš„æ›´æ–°ï¼Œè¿™äº›æ›´æ–°éƒ½ç”±TRANSPLANTçš„è°ƒç”¨è€…æ¥è´Ÿè´£ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TREE-DELETE(T, z):</span><br><span class="line">    <span class="keyword">if</span> z.left == NIL:                  <span class="comment"># æƒ…å†µ(a)ï¼šå·¦å­©å­ä¸ºç©º</span></span><br><span class="line">        TRANSPLANT(T, z, z.right)      <span class="comment"># ç”¨å³å­©å­æ›¿æ¢</span></span><br><span class="line">    <span class="keyword">elif</span> z.right == NIL:               <span class="comment"># æƒ…å†µ(b):å³å­©å­ä¸ºç©º</span></span><br><span class="line">        TRANSPLANT(T, z, z.left)       <span class="comment"># ç”¨å·¦å­©å­æ›¿æ¢</span></span><br><span class="line">    <span class="keyword">else</span>:                              <span class="comment"># æ—¢æœ‰å·¦å­©å­åˆæœ‰å³å­©å­</span></span><br><span class="line">        y = TREE-MINIMUM(z.right)      <span class="comment"># æŸ¥æ‰¾zçš„åŽç»§y</span></span><br><span class="line">        <span class="keyword">if</span> y.p != z:                   <span class="comment"># æƒ…å†µ(d)ï¼šå¦‚æžœyä¸æ˜¯zçš„å³å­©å­</span></span><br><span class="line">            TRANSPLANT(T, y, y.right)  <span class="comment"># ç”¨yçš„å³å­©å­æ›¿æ¢y</span></span><br><span class="line">            y.right = z.right          <span class="comment"># ä¿®æ”¹yçš„å³å­©å­æŒ‡é’ˆ</span></span><br><span class="line">            y.right.p = y              <span class="comment"># å°†åŽŸæ¥zçš„å­©å­ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘y</span></span><br><span class="line">        TRANSPLANT(T, z, y)            <span class="comment"># æƒ…å†µ(c)ï¼šyæ˜¯zçš„å­èŠ‚ç‚¹ï¼Œç”¨yæ›¿æ¢zï¼Œä¹Ÿæ˜¯(d)çš„ç¬¬äºŒæ­¥æ›¿æ¢</span></span><br><span class="line">        y.left = z.left                <span class="comment"># ä¿®æ”¹yçš„æŒ‡é’ˆå±žæ€§</span></span><br><span class="line">        y.left.p = y</span><br></pre></td></tr></table></figure><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> data_structure.binary_tree <span class="keyword">import</span> BinaryTree, Node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinarySearchTree</span><span class="params">(BinaryTree)</span>:</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(x, k)</span>:</span></span><br><span class="line">        <span class="string">"""åœ¨æ ¹èŠ‚ç‚¹ä¸ºxçš„å­æ ‘ä¸­è¿­ä»£æŸ¥æ‰¾é”®å€¼ä¸ºkçš„ç»“ç‚¹"""</span></span><br><span class="line">        <span class="keyword">while</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> k != x.key:</span><br><span class="line">            <span class="keyword">if</span> k &lt; x.key:</span><br><span class="line">                x = x.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = x.right</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minimum</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žä»¥xä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘ä¸­é”®å€¼æœ€å°çš„ç»“ç‚¹ï¼Œxä¸ºç©ºæ—¶è¿”å›žNone"""</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">while</span> x.left <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                x = x.left</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maximum</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="string">""""è¿”å›žå­æ ‘ä¸­é”®å€¼æœ€å¤§çš„ç»“ç‚¹"""</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">while</span> x.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                x = x.right</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">successor</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žç»“ç‚¹xçš„åŽç»§ç»“ç‚¹"""</span></span><br><span class="line">        <span class="keyword">if</span> x.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self.minimum(x.right)</span><br><span class="line">        y = x.p</span><br><span class="line">        <span class="keyword">while</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> x == y.right:</span><br><span class="line">            x, y = y, y.p</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predecessor</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žå‰é©±"""</span></span><br><span class="line">        <span class="keyword">if</span> x.left <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self.maximum(x.left)</span><br><span class="line">        y = x.p</span><br><span class="line">        <span class="keyword">while</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> x == y.left:</span><br><span class="line">            x, y = y, y.p</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        <span class="string">"""æ’å…¥ç»“ç‚¹z"""</span></span><br><span class="line">        y, x = <span class="literal">None</span>, self.root</span><br><span class="line">        <span class="keyword">while</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            y = x</span><br><span class="line">            <span class="keyword">if</span> z.key &lt; x.key:</span><br><span class="line">                x = x.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = x.right</span><br><span class="line">        z.p = y</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.root = z</span><br><span class="line">        <span class="keyword">elif</span> z.key &lt; y.key:</span><br><span class="line">            y.left = z</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y.right = z</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">transplant</span><span class="params">(self, u, v)</span>:</span></span><br><span class="line">        <span class="string">"""ç”¨væ›¿æ¢u"""</span></span><br><span class="line">        <span class="keyword">if</span> u.p <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.root = v</span><br><span class="line">        <span class="keyword">elif</span> u == u.p.left:</span><br><span class="line">            u.p.left = v</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            u.p.right = v</span><br><span class="line">        <span class="keyword">if</span> v <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            v.p = u.p</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, z)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ é™¤ç»“ç‚¹z"""</span></span><br><span class="line">        <span class="keyword">if</span> z.left <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.transplant(z, z.right)</span><br><span class="line">        <span class="keyword">elif</span> z.right <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.transplant(z, z.left)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = self.minimum(z.right)</span><br><span class="line">            <span class="keyword">if</span> y.p != z:</span><br><span class="line">                self.transplant(y, y.right)</span><br><span class="line">                y.right, y.right.p = z.right, y</span><br><span class="line">            self.transplant(z, y)</span><br><span class="line">            y.left, y.left.p = z.left, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    key = [<span class="number">12</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">19</span>, <span class="number">17</span>, <span class="number">3</span>, <span class="number">21</span>]</span><br><span class="line">    n = &#123;i: Node(i) <span class="keyword">for</span> i <span class="keyword">in</span> key&#125;</span><br><span class="line">    bst = BinarySearchTree()</span><br><span class="line">    [bst.insert(n[i]) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">    print(<span class="string">'åˆå§‹    '</span>, bst)</span><br><span class="line">    print(<span class="string">'æŸ¥æ‰¾ 8  '</span>, bst.search(bst.root, <span class="number">8</span>))  <span class="comment"># åœ¨æ•´æ£µæ ‘ä¸­æœç´¢</span></span><br><span class="line">    print(<span class="string">'æŸ¥æ‰¾ 9  '</span>, bst.search(bst.root, <span class="number">9</span>))</span><br><span class="line">    print(<span class="string">'12çš„å‰é©±'</span>, bst.predecessor(n[<span class="number">12</span>]))  <span class="comment"># å‰é©±</span></span><br><span class="line">    print(<span class="string">'12çš„åŽç»§'</span>, bst.successor(n[<span class="number">12</span>]))  <span class="comment"># åŽç»§</span></span><br><span class="line">    n[<span class="number">8</span>] = Node(<span class="number">8</span>)</span><br><span class="line">    bst.insert(n[<span class="number">8</span>])  <span class="comment"># æ’å…¥</span></span><br><span class="line">    print(<span class="string">'æ’å…¥ 8åŽ'</span>, bst)</span><br><span class="line">    bst.delete(n[<span class="number">3</span>])  <span class="comment"># æƒ…å†µ(a)ï¼Œåªæœ‰å³å­©å­</span></span><br><span class="line">    print(<span class="string">'åˆ é™¤ 3åŽ'</span>, bst)</span><br><span class="line">    bst.delete(n[<span class="number">8</span>])  <span class="comment"># æƒ…å†µ(a)ï¼Œåªæœ‰å·¦å­©å­</span></span><br><span class="line">    print(<span class="string">'åˆ é™¤ 8åŽ'</span>, bst)</span><br><span class="line">    bst.delete(n[<span class="number">18</span>])  <span class="comment"># æƒ…å†µ(c)ï¼Œæœ‰å³å­©å­ç»“ç‚¹19ï¼Œä¸”å³å­©å­æ˜¯å…¶åŽç»§ç»“ç‚¹</span></span><br><span class="line">    print(<span class="string">'åˆ é™¤18åŽ'</span>, bst)</span><br><span class="line">    bst.delete(n[<span class="number">12</span>])  <span class="comment"># æƒ…å†µ(d)ï¼ŒåŽç»§ç»“ç‚¹æ˜¯15</span></span><br><span class="line">    print(<span class="string">'åˆ é™¤12åŽ'</span>, bst)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åˆå§‹     &#123;12: [&#123;5: [&#123;2: [None, 3]&#125;, 9]&#125;, &#123;18: [&#123;15: [None, 17]&#125;, &#123;19: [None, 21]&#125;]&#125;]&#125;</span><br><span class="line">æŸ¥æ‰¾ 8   None</span><br><span class="line">æŸ¥æ‰¾ 9   9</span><br><span class="line">12çš„å‰é©± 9</span><br><span class="line">12çš„åŽç»§ 15</span><br><span class="line">æ’å…¥ 8åŽ &#123;12: [&#123;5: [&#123;2: [None, 3]&#125;, &#123;9: [8, None]&#125;]&#125;, &#123;18: [&#123;15: [None, 17]&#125;, &#123;19: [None, 21]&#125;]&#125;]&#125;</span><br><span class="line">åˆ é™¤ 3åŽ &#123;12: [&#123;5: [2, &#123;9: [8, None]&#125;]&#125;, &#123;18: [&#123;15: [None, 17]&#125;, &#123;19: [None, 21]&#125;]&#125;]&#125;</span><br><span class="line">åˆ é™¤ 8åŽ &#123;12: [&#123;5: [2, 9]&#125;, &#123;18: [&#123;15: [None, 17]&#125;, &#123;19: [None, 21]&#125;]&#125;]&#125;</span><br><span class="line">åˆ é™¤18åŽ &#123;12: [&#123;5: [2, 9]&#125;, &#123;19: [&#123;15: [None, 17]&#125;, 21]&#125;]&#125;</span><br><span class="line">åˆ é™¤12åŽ &#123;15: [&#123;5: [2, 9]&#125;, &#123;19: [17, 21]&#125;]&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> data structures </tag>
            
            <tag> binary tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰æ ¹æ ‘</title>
      <link href="/notes/introduction-to-algorithms/rooted-trees/"/>
      <url>/notes/introduction-to-algorithms/rooted-trees/</url>
      
        <content type="html"><![CDATA[<h1 id="æœ‰æ ¹æ ‘">æœ‰æ ¹æ ‘</h1><p>è¡¨ç¤ºé“¾è¡¨çš„æ–¹æ³•å¯ä»¥æŽ¨å¹¿åˆ°ä»»æ„åŒæž„çš„æ•°æ®ç»“æž„ä¸Šã€‚æ ‘çš„ç»“ç‚¹ç”¨å¯¹è±¡è¡¨ç¤ºã€‚ä¸Žé“¾è¡¨ç±»ä¼¼ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½å«æœ‰ä¸€ä¸ªå…³é”®å­—keyã€‚å…¶ä½™çš„å±žæ€§åŒ…æ‹¬æŒ‡å‘å…¶ä»–ç»“ç‚¹çš„æŒ‡é’ˆï¼Œå®ƒä»¬éšæ ‘çš„ç§ç±»ä¸åŒä¼šæœ‰æ‰€å˜åŒ–ã€‚</p><p>é“¾è¡¨çš„ç»“ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Node:</span><br><span class="line">    key       <span class="comment"># ç»“ç‚¹è‡ªèº«çš„é”®å€¼</span></span><br><span class="line">    previous  <span class="comment"># å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">    next      <span class="comment"># åŽç»§ç»“ç‚¹</span></span><br></pre></td></tr></table></figure><h1 id="äºŒå‰æ ‘">äºŒå‰æ ‘</h1><p>äºŒå‰æ ‘çš„ç»“ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Node:</span><br><span class="line">    key    <span class="comment"># é”®å€¼</span></span><br><span class="line">    p      <span class="comment"># çˆ¶èŠ‚ç‚¹ï¼Œåªæœ‰æ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºNIL</span></span><br><span class="line">    left   <span class="comment"># å·¦å­©å­ï¼Œè‹¥æ²¡æœ‰å·¦å­©å­ï¼Œåˆ™è¯¥å±žæ€§ä¸ºNIL</span></span><br><span class="line">    right  <span class="comment"># å³å­©å­ï¼Œè‹¥æ²¡æœ‰å³å­©å­ï¼Œåˆ™è¯¥å±žæ€§ä¸ºNIL</span></span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="/uploads/image/introduction-to-algorithms/binary-tree.png" title="äºŒå‰æ ‘çš„è¡¨ç¤ºæ–¹æ³•"></p><h2 id="ä»£ç ">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.p = self.left = self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_left</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.left, n.p = n, self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_right</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.right, n.p = n, self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.values(self.root))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">values</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="string">"""é€’å½’å¾—åˆ°ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘ä¸­æ‰€æœ‰ç»“ç‚¹çš„å€¼"""</span></span><br><span class="line">        v, c = [], <span class="number">0</span>  <span class="comment"># cï¼šå­©å­ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">if</span> node.left <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            v.append(self.values(node.left))</span><br><span class="line">            c += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v.append(<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> node.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            v.append(self.values(node.right))</span><br><span class="line">            c += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v.append(<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> c &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;node.key: v&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> node.key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    key = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line">    n = [Node(i) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">    t = BinaryTree()</span><br><span class="line">    t.root = n[<span class="number">0</span>]</span><br><span class="line">    n[<span class="number">0</span>].set_left(n[<span class="number">1</span>])</span><br><span class="line">    n[<span class="number">0</span>].set_right(n[<span class="number">2</span>])</span><br><span class="line">    n[<span class="number">1</span>].set_right(n[<span class="number">3</span>])</span><br><span class="line">    n[<span class="number">2</span>].set_left(n[<span class="number">4</span>])</span><br><span class="line">    n[<span class="number">2</span>].set_right(n[<span class="number">5</span>])</span><br><span class="line">    n[<span class="number">3</span>].set_left(n[<span class="number">6</span>])</span><br><span class="line">    n[<span class="number">3</span>].set_right(n[<span class="number">7</span>])</span><br><span class="line">    n[<span class="number">4</span>].set_right(n[<span class="number">8</span>])</span><br><span class="line">    n[<span class="number">5</span>].set_left(n[<span class="number">9</span>])</span><br><span class="line">    n[<span class="number">8</span>].set_left(n[<span class="number">10</span>])</span><br><span class="line">    print(t)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">0</span>: [&#123;<span class="number">1</span>: [<span class="literal">None</span>, &#123;<span class="number">3</span>: [<span class="number">6</span>, <span class="number">7</span>]&#125;]&#125;, &#123;<span class="number">2</span>: [&#123;<span class="number">4</span>: [<span class="literal">None</span>, &#123;<span class="number">8</span>: [<span class="number">10</span>, <span class="literal">None</span>]&#125;]&#125;, &#123;<span class="number">5</span>: [<span class="number">9</span>, <span class="literal">None</span>]&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ†æ”¯æ— é™åˆ¶çš„æœ‰æ ¹æ ‘">åˆ†æ”¯æ— é™åˆ¶çš„æœ‰æ ¹æ ‘</h1><p>äºŒå‰æ ‘çš„è¡¨ç¤ºæ–¹æ³•å¯ä»¥æŽ¨å¹¿åˆ°æ¯ä¸ªç»“ç‚¹çš„å­©å­æ•°è‡³å¤šä¸ºå¸¸æ•°kçš„ä»»æ„ç±»åž‹çš„æ ‘ï¼šåªéœ€è¦å°†leftå’Œrightå±žæ€§ç”¨<code>child1ï¼Œchild2ï¼Œ...ï¼Œchildk</code>ä»£æ›¿ã€‚ç¼ºç‚¹æ˜¯ï¼Œè‹¥å¤§éƒ¨åˆ†ç»“ç‚¹åªæœ‰å°‘é‡çš„å­©å­ï¼Œåˆ™ä¼šæµªè´¹å¤§é‡å­˜å‚¨ç©ºé—´ï¼ˆå¤§é‡æ— æ„ä¹‰çš„å­©å­æŒ‡é’ˆï¼‰ã€‚æ­¤å¤–ï¼Œè‹¥å­©å­çš„ç»“ç‚¹æ•°æ— é™åˆ¶æ—¶ï¼Œæ­¤æ–¹æ³•å¤±æ•ˆã€‚æ‰€å¹¸çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªå·§å¦™åœ°æ–¹æ³•å¯ä»¥ç”¨æ¥è¡¨ç¤ºå­©å­æ•°ä»»æ„çš„æ ‘ã€‚</p><p><strong>å·¦å­©å­å³å…„å¼Ÿè¡¨ç¤ºæ³•</strong>ï¼ˆleft-child, right-sibling representationï¼‰ï¼šå¯¹ä»»æ„nä¸ªç»“ç‚¹çš„æœ‰æ ¹æ ‘ï¼Œåªéœ€è¦O(n)çš„å­˜å‚¨ç©ºé—´ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Node:</span><br><span class="line">    key              <span class="comment"># é”®å€¼</span></span><br><span class="line">    p                <span class="comment"># çˆ¶èŠ‚ç‚¹ï¼Œè‹¥ä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™ä¸ºNIL</span></span><br><span class="line">    left-child       <span class="comment"># æœ€å·¦è¾¹çš„å­©å­ç»“ç‚¹ï¼Œè‹¥æ²¡æœ‰å­©å­ç»“ç‚¹ï¼Œåˆ™ä¸ºNIL</span></span><br><span class="line">    right-sibling    <span class="comment"># å³ä¾§ç›¸é‚»çš„å…„å¼Ÿç»“ç‚¹ï¼Œè‹¥æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„æœ€å³å­©å­ï¼Œåˆ™ä¸ºNIL</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/tree-with-unbounded-branching.png" title="ä¸é™åˆ†æ”¯æ•°çš„æœ‰æ ¹æ ‘çš„è¡¨ç¤ºæ–¹æ³•"></p><h2 id="ä»£ç -1">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> data_structure.binary_tree <span class="keyword">import</span> Node <span class="keyword">as</span> Ne</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(Ne)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_child</span><span class="params">(self, c)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.left <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.set_left(c)  <span class="comment"># æ·»åŠ ç¬¬ä¸€ä¸ªå­©å­</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># è¿½åŠ å­©å­</span></span><br><span class="line">            x = self.left</span><br><span class="line">            <span class="keyword">while</span> x.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># å¯»æ‰¾è¿½åŠ ä½ç½®</span></span><br><span class="line">                x = x.right</span><br><span class="line">            x.right, c.p = c, self  <span class="comment"># æ·»åŠ æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, root)</span>:</span></span><br><span class="line">        self.root = root</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.values(self.root))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">values</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node.left <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># æ²¡æœ‰å­©å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">return</span> node.key</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c = node.left</span><br><span class="line">            v = [self.values(c)]  <span class="comment"># æ‰€æœ‰å­©å­ç»„æˆçš„åˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">while</span> c.right <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                v.append(self.values(c.right))</span><br><span class="line">                c = c.right</span><br><span class="line">            <span class="keyword">return</span> &#123;node.key: v&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    key = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]</span><br><span class="line">    n = [Node(i) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">    t = Tree(n[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        n[<span class="number">0</span>].add_child(n[i])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">6</span>):</span><br><span class="line">        n[<span class="number">1</span>].add_child(n[i])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>, <span class="number">10</span>):</span><br><span class="line">        n[<span class="number">2</span>].add_child(n[i])</span><br><span class="line">    n[<span class="number">3</span>].add_child(n[<span class="number">10</span>])</span><br><span class="line">    n[<span class="number">5</span>].add_child(n[<span class="number">11</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">12</span>, <span class="number">14</span>):</span><br><span class="line">        n[<span class="number">8</span>].add_child(n[i])</span><br><span class="line">    print(t)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;0: [&#123;1: [4, &#123;5: [11]&#125;]&#125;, &#123;2: [6, 7, &#123;8: [12, 13]&#125;, 9]&#125;, &#123;3: [10]&#125;]&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> data structures </tag>
            
            <tag> binary tree </tag>
            
            <tag> tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é“¾è¡¨</title>
      <link href="/notes/introduction-to-algorithms/linked-lists/"/>
      <url>/notes/introduction-to-algorithms/linked-lists/</url>
      
        <content type="html"><![CDATA[<h1 id="é“¾è¡¨">é“¾è¡¨</h1><p>é“¾è¡¨ï¼ˆlinked listï¼‰ä¸­çš„å„å…ƒç´ æŒ‰çº¿æ€§é¡ºåºæŽ’åˆ—ã€‚æ•°æ®çš„çº¿æ€§é¡ºåºæ˜¯ç”±æ•°ç»„ä¸‹æ ‡å†³å®šçš„ï¼Œç„¶è€Œä¸Žæ•°ç»„ä¸åŒçš„æ˜¯ï¼Œé“¾è¡¨çš„é¡ºåºæ˜¯ç”±å„ä¸ªå¯¹è±¡é‡Œçš„æŒ‡é’ˆå†³å®šçš„ã€‚é“¾è¡¨ä¸ºåŠ¨æ€é›†åˆæä¾›äº†ä¸€ç§ç®€å•è€Œçµæ´»çš„è¡¨ç¤ºæ–¹æ³•ã€‚</p><h1 id="ç§ç±»">ç§ç±»</h1><p>é“¾è¡¨å¯ä»¥æœ‰å¤šç§å½¢å¼ã€‚å®ƒå¯ä»¥æ˜¯å•é“¾æŽ¥çš„æˆ–åŒé“¾æŽ¥çš„ï¼Œå¯ä»¥æ˜¯å·²æŽ’åºçš„æˆ–æœªæŽ’åºçš„ï¼Œå¯ä»¥æ˜¯å¾ªçŽ¯çš„æˆ–éžå¾ªçŽ¯çš„ã€‚</p><ul><li><p>åŒå‘é“¾è¡¨ï¼ˆdoubly linked listï¼‰Lçš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå…³é”®å­—kå’Œä¸¤ä¸ªæŒ‡é’ˆï¼šnextå’Œprevã€‚å¯¹è±¡ä¸­è¿˜å¯ä»¥åŒ…å«å…¶ä»–è¾…åŠ©æ•°æ®ï¼ˆæˆ–ç§°ä¸ºå«æ˜Ÿæ•°æ®ï¼‰ã€‚è®¾xä¸ºé“¾è¡¨çš„ä¸€ä¸ªå…ƒç´ ï¼Œx.nextæŒ‡å‘å®ƒåœ¨é“¾è¡¨ä¸­çš„åŽç»§å…ƒç´ ï¼Œx.prevåˆ™æŒ‡å‘å®ƒçš„å‰é©±å…ƒç´ ã€‚å¦‚æžœx.prev=NILï¼Œåˆ™å…ƒç´ xæ²¡æœ‰å‰é©±ï¼Œå› æ­¤æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³é“¾è¡¨çš„å¤´ï¼ˆheadï¼‰ã€‚å¦‚æžœx.next=NILï¼Œåˆ™å…ƒç´ xæ²¡æœ‰åŽç»§ï¼Œå› æ­¤æ˜¯é“¾è¡¨çš„æœ€åŽä¸€ä¸ªå…ƒç´ ï¼Œå³é“¾è¡¨çš„å°¾ï¼ˆtailï¼‰ã€‚å±žæ€§L.headæŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æžœL.head=NILï¼Œåˆ™é“¾è¡¨ä¸ºç©ºã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/linked-list.png" title="é“¾è¡¨"></p></li><li><p>å•é“¾æŽ¥çš„ï¼ˆsingle linkedï¼‰ï¼šçœç•¥æ¯ä¸ªå…ƒç´ ä¸­çš„prevæŒ‡é’ˆã€‚</p></li></ul><a id="more"></a><ul><li>å·²æŽ’åºï¼ˆsortedï¼‰çš„ï¼šé“¾è¡¨çš„çº¿æ€§é¡ºåºä¸Žé“¾è¡¨å…ƒç´ ä¸­å…³é”®å­—çš„çº¿æ€§é¡ºåºä¸€è‡´ã€‚æ®æ­¤ï¼Œæœ€å°çš„å…ƒç´ å°±æ˜¯è¡¨å¤´å…ƒç´ ï¼Œè€Œæœ€å¤§çš„å…ƒç´ åˆ™æ˜¯è¡¨å°¾å…ƒç´ ã€‚</li><li><p>æœªæŽ’åºï¼ˆunsortedï¼‰çš„ï¼šé“¾è¡¨çš„å„å…ƒç´ å¯ä»¥ä»¥ä»»ä½•é¡ºåºå‡ºçŽ°ã€‚</p></li><li><p>å¾ªçŽ¯é“¾è¡¨ï¼ˆcircular listï¼‰ï¼šè¡¨å¤´å…ƒç´ çš„prevæŒ‡é’ˆæŒ‡å‘è¡¨å°¾å…ƒç´ ï¼Œè€Œè¡¨å°¾å…ƒç´ çš„nextæŒ‡é’ˆåˆ™æŒ‡å‘è¡¨å¤´å…ƒç´ ã€‚å¯ä»¥å°†å¾ªçŽ¯é“¾è¡¨æƒ³è±¡æˆä¸€ä¸ªå„å…ƒç´ ç»„æˆçš„åœ†çŽ¯ã€‚</p></li></ul><h1 id="æ“ä½œ">æ“ä½œ</h1><h2 id="æœç´¢">æœç´¢</h2><p>è¿‡ç¨‹LIST-SEARCHé‡‡ç”¨ç®€å•çš„çº¿æ€§æœç´¢æ–¹æ³•ï¼Œç”¨äºŽæŸ¥æ‰¾é“¾è¡¨Lä¸­ç¬¬ä¸€ä¸ªå…³é”®å­—ä¸ºkçš„å…ƒç´ ï¼Œå¹¶è¿”å›žæŒ‡å‘è¯¥å…ƒç´ çš„æŒ‡é’ˆã€‚å¦‚æžœé“¾è¡¨ä¸­æ²¡æœ‰å…³é”®å­—ä¸ºkçš„å¯¹è±¡ï¼Œåˆ™è¿”å›žNILã€‚è¦æœç´¢ä¸€ä¸ªæœ‰nä¸ªå¯¹è±¡çš„é“¾è¡¨ï¼Œè¿‡ç¨‹LIST-SEARCHåœ¨æœ€åæƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(n)\)</span>ï¼Œå› ä¸ºå¯èƒ½éœ€è¦æœç´¢æ•´ä¸ªé“¾è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LIST-SEARCH(L, k):</span><br><span class="line">    x = L.head</span><br><span class="line">    <span class="keyword">while</span> x != NIL <span class="keyword">and</span> x.key != k:</span><br><span class="line">        x = x.next</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥">æ’å…¥</h2><p>ç»™å®šä¸€ä¸ªå…ƒç´ xï¼Œè¿‡ç¨‹LIST-INSERTå°†xâ€è¿žæŽ¥å…¥â€œåˆ°é“¾è¡¨çš„å‰ç«¯ã€‚åœ¨ä¸€ä¸ªå«nä¸ªå…ƒç´ çš„é“¾è¡¨ä¸Šæ‰§è¡ŒLIST-INSERTçš„è¿è¡Œæ—¶é—´æ˜¯<span class="math inline">\(\Theta(1)\)</span>ã€‚ä¾‹å¦‚ï¼Œåœ¨(a)æ‰€ç¤ºçš„é“¾è¡¨ä¸­æ’å…¥é”®å€¼ä¸º25çš„å…ƒç´ ã€‚æ’å…¥åŽçš„é“¾è¡¨å¦‚(b)æ‰€ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LIST-INSERT(L, x):</span><br><span class="line">    x.next = L.head      <span class="comment"># å°†xçš„åŽç»§å…ƒç´ æŒ‡å‘å½“å‰head</span></span><br><span class="line">    <span class="keyword">if</span> L.head != NIL:    <span class="comment"># è‹¥å½“å‰headä¸ä¸ºNIL</span></span><br><span class="line">        L.head.prev = x  <span class="comment"># ä¿®æ”¹headçš„å‰é©±å…ƒç´ ä¸ºx</span></span><br><span class="line">    L.head = x           <span class="comment"># æ›´æ”¹é“¾è¡¨çš„è¡¨å¤´å…ƒç´ </span></span><br><span class="line">    x.prev = NIL         <span class="comment"># ä¿®æ”¹xçš„å‰é©±å…ƒç´ ä¸ºNIL</span></span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤">åˆ é™¤</h2><p>è¿‡ç¨‹LIST-DELETEå°†ä¸€ä¸ªå…ƒç´ xä»Žé“¾è¡¨Lä¸­ç§»é™¤ã€‚é€šè¿‡ä¿®æ”¹ä¸€äº›æŒ‡é’ˆï¼Œå°†xâ€œåˆ é™¤å‡ºâ€è¯¥é“¾è¡¨ã€‚å¦‚æžœè¦åˆ é™¤å…·æœ‰ç»™å®šå…³é”®å­—å€¼çš„å…ƒç´ ï¼Œåˆ™å¿…é¡»å…ˆè°ƒç”¨LIST-SEARCHæ‰¾åˆ°è¯¥å…ƒç´ ã€‚LIST-DELETEçš„è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(1)\)</span>ã€‚ä¾‹å¦‚ï¼Œåœ¨(b)æ‰€ç¤ºçš„é“¾è¡¨ä¸­åˆ é™¤é”®å€¼ä¸º4çš„å…ƒç´ ï¼Œåˆ é™¤åŽçš„é“¾è¡¨å¦‚(c)æ‰€ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LIST-DELETE(L, x):</span><br><span class="line">    <span class="keyword">if</span> x.prev != NIL:          <span class="comment"># å¦‚æžœxä¸æ˜¯è¡¨å¤´å…ƒç´ </span></span><br><span class="line">        x.prev.next = x.next   <span class="comment"># ä¿®æ”¹xçš„å‰é©±ä¸­çš„åŽç»§æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">else</span>:                      <span class="comment"># å¦‚æžœxæ˜¯è¡¨å¤´å…ƒç´ ï¼Œåˆ™xæ²¡æœ‰å‰é©±</span></span><br><span class="line">        L.head = x.next        <span class="comment"># ç›´æŽ¥ä¿®æ”¹è¡¨å¤´æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">if</span> x.next != NIL:          <span class="comment"># å¦‚æžœxæœ‰åŽç»§å…ƒç´ </span></span><br><span class="line">        x.next.prev = x.prev   <span class="comment"># ä¿®æ”¹åŽç»§å…ƒç´ çš„å‰é©±æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure><h2 id="å“¨å…µ">å“¨å…µ</h2><p>å“¨å…µï¼ˆsentinelï¼‰æ˜¯ä¸€ä¸ªå“‘å¯¹è±¡ï¼Œå…¶ä½œç”¨æ˜¯ç®€åŒ–è¾¹ç•Œæ¡ä»¶çš„å¤„ç†ã€‚åœ¨é“¾è¡¨Lä¸­è®¾ç½®ä¸€ä¸ªå“¨å…µL.nilï¼Œå¯¹äºŽé“¾è¡¨ä»£ç ä¸­å‡ºçŽ°çš„æ¯ä¸€å¤„ï¼ˆè¡¨å¤´å’Œè¡¨å°¾ï¼‰å¯¹NILçš„å¼•ç”¨ï¼Œéƒ½ä»£ä¹‹ä»¥å¯¹å“¨å…µL.nilçš„å¼•ç”¨ï¼Œå³è¡¨å¤´å…ƒç´ çš„prevæŒ‡é’ˆå’Œè¡¨å°¾çš„nextæŒ‡é’ˆå‡æŒ‡å‘L.nilã€‚è¿™æ ·çš„è°ƒæ•´å°†ä¸€ä¸ªå¸¸è§„çš„åŒå‘é“¾è¡¨è½¬å˜ä¸ºä¸€ä¸ª<strong>æœ‰å“¨å…µçš„åŒå‘å¾ªçŽ¯é“¾è¡¨</strong>ï¼ˆcircular, doubly linked list with a sentinelï¼‰ï¼Œå“¨å…µä½äºŽè¡¨å¤´å’Œè¡¨å°¾ä¹‹é—´ã€‚å±žæ€§L.nil.nextæŒ‡å‘è¡¨å¤´ï¼ŒL.nil.prevæŒ‡å‘è¡¨å°¾ã€‚ä¸€ä¸ªç©ºé“¾è¡¨åªç”±ä¸€ä¸ªå“¨å…µæž„æˆï¼ŒL.nil.nextå’ŒL.nil.prevåŒæ—¶æŒ‡å‘L.nilã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/circular-doubly-linked-list-with-a-sentinel.png" title="æœ‰å“¨å…µçš„åŒå‘å¾ªçŽ¯é“¾è¡¨"></p><p>åº”å½“æ…Žç”¨å“¨å…µã€‚å‡å¦‚æœ‰è®¸å¤šä¸ªå¾ˆçŸ­çš„é“¾è¡¨ï¼Œå®ƒä»¬çš„å“¨å…µæ‰€å ç”¨çš„é¢å¤–çš„å­˜å‚¨ç©ºé—´ä¼šé€ æˆä¸¥é‡çš„å­˜å‚¨æµªè´¹ã€‚</p><p>å¼•å…¥å“¨å…µåŽï¼Œæœç´¢ã€æ’å…¥å’Œåˆ é™¤çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LIST-SEARCH<span class="string">'(L, k):</span></span><br><span class="line"><span class="string">    x = L.nil.next   # åˆå§‹xæŒ‡å‘è¡¨å¤´å…ƒç´ </span></span><br><span class="line"><span class="string">    while x != L.nil and x.key != k:</span></span><br><span class="line"><span class="string">        x = x.next</span></span><br><span class="line"><span class="string">    return x</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">LIST-INSERT'</span>(L, X):</span><br><span class="line">    x.next = L.nil.next</span><br><span class="line">    L.nil.next.prev = x</span><br><span class="line">    L.nil.next = x</span><br><span class="line">    x.prev = L.nil</span><br><span class="line"></span><br><span class="line">LIST-DELETE<span class="string">'(L, x):</span></span><br><span class="line"><span class="string">    x.prev.next = x.next</span></span><br><span class="line"><span class="string">    x.next.prev = x.prev</span></span><br></pre></td></tr></table></figure><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.prev = self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>:</span></span><br><span class="line">    <span class="string">"""åŒå‘å¾ªçŽ¯é“¾è¡¨"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""ç©ºé“¾è¡¨"""</span></span><br><span class="line">        self.nil, self.size = Element(<span class="literal">None</span>), <span class="number">0</span></span><br><span class="line">        self.nil.prev = self.nil.next = self.nil  <span class="comment"># å“¨å…µï¼ˆsentinelï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str([x.key <span class="keyword">for</span> x <span class="keyword">in</span> self])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter(self.to_list())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_list</span><span class="params">(self)</span>:</span></span><br><span class="line">        x, values = self.head(), []</span><br><span class="line">        <span class="keyword">while</span> x != self.nil:</span><br><span class="line">            values.append(x)</span><br><span class="line">            x = x.next</span><br><span class="line">        <span class="keyword">return</span> values</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ é™¤å…ƒç´ x"""</span></span><br><span class="line">        x.prev.next, x.next.prev = x.next, x.prev</span><br><span class="line">        self.size -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        <span class="string">"""æŸ¥æ‰¾é”®å€¼ä¸ºkçš„å…ƒç´ """</span></span><br><span class="line">        x = self.head()</span><br><span class="line">        <span class="keyword">while</span> x != self.nil <span class="keyword">and</span> x.key != k:  <span class="comment"># æ‰¾ä¸åˆ°æ—¶xé‡æ–°æŒ‡å‘nil</span></span><br><span class="line">            x = x.next</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""æ’å…¥å…ƒç´ xï¼Œxä½œä¸ºæ–°çš„è¡¨å¤´"""</span></span><br><span class="line">        x.next, self.head().prev = self.head(), x  <span class="comment"># é“¾æŽ¥xä¸Žç¬¬1ä¸ªå…ƒç´ </span></span><br><span class="line">        self.nil.next, x.prev = x, self.nil  <span class="comment"># é“¾æŽ¥å“¨å…µä¸Žx</span></span><br><span class="line">        self.size += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">head</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žè¡¨å¤´å…ƒç´ """</span></span><br><span class="line">        <span class="keyword">return</span> self.nil.next</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tail</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žè¡¨å°¾å…ƒç´ """</span></span><br><span class="line">        <span class="keyword">return</span> self.nil.prev</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(y, z)</span>:</span></span><br><span class="line">    <span class="string">"""åˆå¹¶é“¾è¡¨yå’Œzä¸ºä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œyå’Œzä¼šè¢«é”€æ¯"""</span></span><br><span class="line">    x = LinkedList()</span><br><span class="line">    x.nil.next, y.head().prev = y.head(), x.nil  <span class="comment"># é“¾æŽ¥x.nilä¸Žyçš„å¤´éƒ¨</span></span><br><span class="line">    x.nil.prev, z.tail().next = z.tail(), x.nil  <span class="comment"># é“¾æŽ¥x.nilä¸Žzçš„å°¾éƒ¨</span></span><br><span class="line">    y.tail().next, z.head().prev = z.head(), y.tail()  <span class="comment"># é“¾æŽ¥yçš„å°¾éƒ¨ä¸Žzçš„å¤´éƒ¨</span></span><br><span class="line">    y = z = <span class="literal">None</span>  <span class="comment"># é”€æ¯yå’Œz</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    l = LinkedList()</span><br><span class="line">    l.insert(Element(<span class="number">1</span>))</span><br><span class="line">    l.insert(Element(<span class="number">2</span>))</span><br><span class="line">    l.insert(Element(<span class="number">3</span>))</span><br><span class="line">    l.insert(Element(<span class="number">4</span>))</span><br><span class="line">    l.insert(Element(<span class="number">5</span>))</span><br><span class="line">    l.insert(Element(<span class="number">6</span>))</span><br><span class="line">    print(l)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[6, 5, 4, 3, 2, 1]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> data structures </tag>
            
            <tag> list </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tex Commands</title>
      <link href="/documentation/tex-commands/"/>
      <url>/documentation/tex-commands/</url>
      
        <content type="html"><![CDATA[<h1 id="å¸Œè…Šå­—æ¯">å¸Œè…Šå­—æ¯</h1><table><thead><tr class="header"><th>Notation</th><th>Commands</th><th>Notation</th><th>Commands</th></tr></thead><tbody><tr class="odd"><td><span class="math inline">\(\alpha\)</span></td><td><code>\alpha</code></td><td><span class="math inline">\(\beta\)</span></td><td><code>\beta</code></td></tr><tr class="even"><td><span class="math inline">\(\gamma\)</span> <span class="math inline">\(\Gamma\)</span></td><td><code>\gamma \Gamma</code></td><td><span class="math inline">\(\delta\)</span> <span class="math inline">\(\Delta\)</span></td><td><code>\delta \Delta</code></td></tr><tr class="odd"><td><span class="math inline">\(\varepsilon\)</span></td><td><code>\varepsilon</code></td><td><span class="math inline">\(\epsilon\)</span></td><td><code>\epsilon</code></td></tr><tr class="even"><td><span class="math inline">\(\zeta\)</span></td><td><code>\zeta</code></td><td><span class="math inline">\(\eta\)</span></td><td><code>\eta</code></td></tr><tr class="odd"><td><span class="math inline">\(\theta\)</span> <span class="math inline">\(\Theta\)</span></td><td><code>\theta \Theta</code></td><td><span class="math inline">\(\vartheta\)</span></td><td><code>\vartheta</code></td></tr><tr class="even"><td><span class="math inline">\(\iota\)</span></td><td><code>\iota</code></td><td><span class="math inline">\(\kappa\)</span></td><td><code>\kappa</code></td></tr><tr class="odd"><td><span class="math inline">\(\lambda\)</span> <span class="math inline">\(\Lambda\)</span></td><td><code>\lambda \Lambda</code></td><td><span class="math inline">\(\mu\)</span></td><td><code>\mu</code></td></tr><tr class="even"><td><span class="math inline">\(\nu\)</span></td><td><code>\nu</code></td><td><span class="math inline">\(\xi\)</span> <span class="math inline">\(\Xi\)</span></td><td><code>\xi \Xi</code></td></tr><tr class="odd"><td><span class="math inline">\(\omicron\)</span></td><td><code>\omicron</code></td><td><span class="math inline">\(\pi\)</span> <span class="math inline">\(\Pi\)</span></td><td><code>\pi \Pi</code></td></tr><tr class="even"><td><span class="math inline">\(\varpi\)</span></td><td><code>\varpi</code></td><td><span class="math inline">\(\rho\)</span></td><td><code>\rho</code></td></tr><tr class="odd"><td><span class="math inline">\(\varrho\)</span></td><td><code>\varrho</code></td><td><span class="math inline">\(\sigma\)</span> <span class="math inline">\(\Sigma\)</span></td><td><code>\sigma \Sigma</code></td></tr><tr class="even"><td><span class="math inline">\(\varsigma\)</span></td><td><code>\varsigma</code></td><td><span class="math inline">\(\tau\)</span></td><td><code>\tau</code></td></tr><tr class="odd"><td><span class="math inline">\(\upsilon\)</span> <span class="math inline">\(\Upsilon\)</span></td><td><code>\upsilon \Upsilon</code></td><td><span class="math inline">\(\varphi\)</span></td><td><code>\varphi</code></td></tr><tr class="even"><td><span class="math inline">\(\phi\)</span> <span class="math inline">\(\Phi\)</span></td><td><code>\phi \Phi</code></td><td><span class="math inline">\(\chi\)</span></td><td><code>\chi</code></td></tr><tr class="odd"><td><span class="math inline">\(\psi\)</span> <span class="math inline">\(\Psi\)</span></td><td><code>\psi \Psi</code></td><td><span class="math inline">\(\omega\)</span> <span class="math inline">\(\Omega\)</span></td><td><code>\omega \Omega</code></td></tr></tbody></table><a id="more"></a><h1 id="æ‹¬å·">æ‹¬å·</h1><table><thead><tr class="header"><th>Notation</th><th>Commands</th><th>Notation</th><th>Commands</th></tr></thead><tbody><tr class="odd"><td><span class="math inline">\(\lbrace\)</span> <span class="math inline">\(\rbrace\)</span></td><td><code>\lbrace \rbrace</code></td><td><span class="math inline">\(\langle\)</span> <span class="math inline">\(\rangle\)</span></td><td><code>\langle \rangle</code></td></tr></tbody></table><h1 id="è¿ç®—ç¬¦å·">è¿ç®—ç¬¦å·</h1><table><thead><tr class="header"><th>Notation</th><th>Commands</th><th>Notation</th><th>Commands</th></tr></thead><tbody><tr class="odd"><td><span class="math inline">\(\times\)</span></td><td><code>$\times$</code></td><td><span class="math inline">\(\div\)</span></td><td><code>$\div$</code></td></tr><tr class="even"><td><span class="math inline">\(\frac{a}{b}\)</span></td><td><code>$\frac{a}{b}$</code></td><td><span class="math inline">\(\pm\)</span></td><td><code>$\pm$</code></td></tr><tr class="odd"><td><span class="math inline">\(\sum\)</span></td><td><code>\sum</code></td><td><span class="math inline">\(\prod\)</span></td><td><code>\prod</code></td></tr><tr class="even"><td><span class="math inline">\(\lceil\)</span> <span class="math inline">\(\rceil\)</span></td><td><code>$\lceil$ $\rceil$</code></td><td><span class="math inline">\(\lfloor\)</span> <span class="math inline">\(\rfloor\)</span></td><td><code>$\lfloor$ $\rfloor$</code></td></tr></tbody></table><h1 id="è§’æ ‡">è§’æ ‡</h1><table><thead><tr class="header"><th>Notation</th><th>Commands</th><th>Notation</th><th>Commands</th></tr></thead><tbody><tr class="odd"><td><span class="math inline">\(\hat a\)</span></td><td><code>\hat a</code></td><td><span class="math inline">\(\dot a\)</span></td><td><code>$\dot a$</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mathjax </tag>
            
            <tag> tex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–æ³¢é‚£å¥‘å †</title>
      <link href="/notes/introduction-to-algorithms/fibonacci-heaps/"/>
      <url>/notes/introduction-to-algorithms/fibonacci-heaps/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–æ³¢é‚£å¥‘å †">æ–æ³¢é‚£å¥‘å †</h1><p>æ–æ³¢é‚£å¥‘å †æ•°æ®ç»“æž„æœ‰ä¸¤ç§ç”¨é€”ï¼š</p><ul><li>å®ƒæ”¯æŒä¸€äº›åˆ—æ“ä½œï¼Œè¿™äº›æ“ä½œæž„æˆäº†æ‰€è°“çš„â€œå¯åˆå¹¶å †â€ã€‚</li><li>æ–æ³¢é‚£å¥‘å †çš„ä¸€äº›æ“ä½œï¼ˆINSERT/UNION/DECREASE-KEYï¼‰å¯ä»¥åœ¨å¸¸æ•°æ‘Šè¿˜æ—¶é—´å†…å®Œæˆï¼Œéžå¸¸é€‚ç”¨äºŽéœ€è¦é¢‘ç¹ä½¿ç”¨è¿™äº›æ“ä½œçš„åº”ç”¨ã€‚</li></ul><table><thead><tr class="header"><th>æ“ä½œ</th><th>äºŒé¡¹å †ï¼ˆæœ€åæƒ…å½¢ï¼‰</th><th>æ–æ³¢é‚£å¥‘å †ï¼ˆæ‘Šè¿˜ï¼‰</th></tr></thead><tbody><tr class="odd"><td>MAKE-HEAP()ï¼šåˆ›å»ºç©ºå †</td><td><span class="math inline">\(\Theta(1)\)</span></td><td><span class="math inline">\(\Theta(1)\)</span></td></tr><tr class="even"><td>INSERT(H, x)ï¼šæ’å…¥å…ƒç´ x</td><td><span class="math inline">\(\Theta(\lg{n})\)</span></td><td><span class="math inline">\(\Theta(1)\)</span></td></tr><tr class="odd"><td>MINIMUM()ï¼šæå–æœ€å°å…ƒç´ </td><td><span class="math inline">\(\Theta(1)\)</span></td><td><span class="math inline">\(\Theta(1)\)</span></td></tr><tr class="even"><td>EXTRACT-MIN()ï¼šåˆ é™¤å¹¶è¿”å›žæœ€å°å…ƒç´ </td><td><span class="math inline">\(\Theta(\lg{n})\)</span></td><td><span class="math inline">\(O(\lg{n})\)</span></td></tr><tr class="odd"><td>UNION(H1, H2)ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«H1å’ŒH2ä¸­æ‰€æœ‰å…ƒç´ çš„æ–°å †</td><td><span class="math inline">\(\Theta(n)\)</span></td><td><span class="math inline">\(\Theta(1)\)</span></td></tr><tr class="even"><td>DECREASE-KEY(H, x, k)ï¼šå°†å…ƒç´ xçš„å…³é”®å­—èµ‹äºˆæ–°å€¼k</td><td><span class="math inline">\(\Theta(\lg{n})\)</span></td><td><span class="math inline">\(\Theta(1)\)</span></td></tr><tr class="odd"><td>DELETE(H, x)ï¼šåˆ é™¤å…ƒç´ x</td><td><span class="math inline">\(\Theta(\lg{n})\)</span></td><td><span class="math inline">\(O(\lg{n})\)</span></td></tr></tbody></table><ul><li>ä»Žç†è®ºä¸Šçœ‹ï¼Œå½“EXTRACT-MINå’ŒDELETEæ•°ç›®ç›¸æ¯”äºŽå…¶ä»–æ“ä½œå°å¾—å¤šçš„æ—¶å€™ï¼Œæ–æ³¢é‚£å¥‘å †å°¤ä¸ºåˆé€‚ã€‚ä¾‹å¦‚ï¼Œä¸€äº›å›¾é—®é¢˜ç®—æ³•å¯èƒ½æ¯æ¡è¾¹è°ƒç”¨ä¸€æ¬¡DECREASE-KEYã€‚å¯¹äºŽæœ‰å¾ˆå¤šè¾¹çš„ç¨ å¯†å›¾ï¼Œæ¯æ¬¡è°ƒç”¨DECREASE-KEYéœ€è¦<span class="math inline">\(\Theta(1)\)</span>æ‘Šè¿˜æ—¶é—´ï¼Œç›¸æ¯”èµ·äºŒå‰å †æœ€åæƒ…å†µæ—¶é—´<span class="math inline">\(\Theta(\lg{n})\)</span>ï¼Œå…¶ç§¯ç´¯èµ·æ¥æ˜¯ä¸ªå¾ˆå¤§çš„æ”¹è¿›ã€‚å¦‚æœ€å°ç”Ÿæˆæ ‘å’Œå¯»æ‰¾å•æºæœ€çŸ­è·¯å¾„çš„å¿«é€Ÿç®—æ³•å¿…ä¸å¯å°‘åœ°è¦ç”¨åˆ°æ–æ³¢é‚£å¥‘å †ã€‚</li><li>ä»Žå®žé™…ä¸Šçœ‹ï¼Œé™¤äº†æŸäº›éœ€è¦ç®¡ç†å¤§é‡æ•°æ®çš„åº”ç”¨å¤–ï¼Œå¯¹äºŽå¤§å¤šæ•°åº”ç”¨ï¼Œæ–æ³¢é‚£å¥‘å †çš„å¸¸æ•°å› å­å’Œç¼–ç¨‹å¤æ‚æ€§ä½¿å¾—å®ƒæ¯”èµ·æ™®é€šäºŒé¡¹ï¼ˆæˆ–ké¡¹ï¼‰å †å¹¶ä¸é‚£ä¹ˆé€‚ç”¨ã€‚å› æ­¤å¯¹æ–æ³¢é‚£å¥‘å †çš„ç ”ç©¶ä¸»è¦å‡ºäºŽç†è®ºç ”ç©¶ã€‚</li></ul><a id="more"></a><h1 id="ç»“æž„">ç»“æž„</h1><p>ä¸€ä¸ªæ–æ³¢é‚£å¥‘å †ï¼ˆFibonacci heapï¼‰ä¸€ç³»åˆ—å…·æœ‰æœ€å°å †åºï¼ˆmin-heap orderedï¼‰çš„æœ‰æ ¹æ ‘çš„é›†åˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ£µæ ‘å‡éµå®ˆæœ€å°å †æ€§è´¨ï¼ˆmin-heap propertyï¼‰ï¼šæ¯ä¸ªç»“ç‚¹çš„å…³é”®å­—å¤§äºŽæˆ–ç­‰äºŽå®ƒçš„çˆ¶ç»“ç‚¹çš„å…³é”®å­—ã€‚</p><p>æ–æ³¢é‚£å¥‘å †çš„æ¯ä¸ªç»“ç‚¹xåŒ…å«ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    int     key      <span class="comment"># å€¼</span></span><br><span class="line">    int     degree   <span class="comment"># åº¦ï¼Œå­©å­æ•°ç›®</span></span><br><span class="line">    Node    left     <span class="comment"># å·¦å…„å¼Ÿ</span></span><br><span class="line">    Node    right    <span class="comment"># å³å…„å¼Ÿ</span></span><br><span class="line">    Node    p        <span class="comment"># çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    Node    child    <span class="comment"># ä»»æ„ä¸€ä¸ªå­©å­</span></span><br><span class="line">    bool    marked   <span class="comment"># æ˜¯å¦ç¬¬ä¸€æ¬¡è¢«åˆ é™¤æŸä¸ªå­©å­</span></span><br></pre></td></tr></table></figure><p>xçš„æ‰€æœ‰å­©å­è¢«é“¾æŽ¥æˆä¸€ä¸ªçŽ¯å½¢çš„åŒå‘é“¾è¡¨ï¼ˆå¦‚ä¸‹å›¾(b)æ‰€ç¤ºï¼Œé€šå¸¸æƒ…å†µä¸‹çœç•¥äº†æŒ‡é’ˆï¼Œå°†å›¾ç”»æˆ(a)çš„æ ·å­ï¼Œå› ä¸ºå¾ˆå®¹æ˜“ä»Ž(a)ä¸­æŽ¨æ–­å‡ºæŒ‡é’ˆæŒ‡å‘ï¼‰ï¼Œç§°ä¸ºxçš„å­©å­é“¾è¡¨ï¼ˆchild listï¼‰ã€‚</p><p>æ–æ³¢é‚£å¥‘å †HåŒ…å«ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FiboHeap</span>:</span></span><br><span class="line">    Node        min        <span class="comment"># å †ä¸­æœ€å°ç»“ç‚¹ï¼ˆminimum nodeï¼‰</span></span><br><span class="line">    LinkedList  root_list  <span class="comment"># åŒ…å«æ‰€æœ‰æ ¹ç»“ç‚¹çš„åŒå‘çŽ¯å½¢é“¾è¡¨</span></span><br><span class="line">    int         n          <span class="comment"># å †ä¸­æ‰€æœ‰ç»“ç‚¹æ•°ç›®</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/fibonacci-heap.png" title="æ–æ³¢é‚£å¥‘å †"></p><h1 id="å¯åˆå¹¶å †">å¯åˆå¹¶å †</h1><h2 id="åˆ›å»ºä¸€ä¸ªæ–°çš„æ–æ³¢é‚£å¥‘å †">åˆ›å»ºä¸€ä¸ªæ–°çš„æ–æ³¢é‚£å¥‘å †</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MAKE-FIB-HEAP():</span><br><span class="line">    H = FiboHeap()</span><br><span class="line">    H.n         = <span class="number">0</span>                 <span class="comment"># ç»“ç‚¹æ•°ç›®ä¸º0</span></span><br><span class="line">    H.min       = NIL               <span class="comment"># æœ€å°ç»“ç‚¹ä¸ºNIL</span></span><br><span class="line">    H.root_list = new LinkedList()  <span class="comment"># æ ¹é“¾è¡¨åˆå§‹ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">return</span> H</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥ä¸€ä¸ªç»“ç‚¹">æ’å…¥ä¸€ä¸ªç»“ç‚¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIB-HEAP-INSERT(H, x):</span><br><span class="line">    x.degree    = <span class="number">0</span>                        <span class="comment"># åˆå§‹åŒ–xçš„å±žæ€§</span></span><br><span class="line">    x.p         = NIL</span><br><span class="line">    x.child     = NIL</span><br><span class="line">    x.mark      = <span class="literal">False</span></span><br><span class="line">    H.root_list.insert(x)                  <span class="comment"># å°†xæ’å…¥Hçš„æ ¹é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">if</span> H.min == NIL <span class="keyword">or</span> x.key &lt; H.min.key:  <span class="comment"># æ›´æ–°H.min</span></span><br><span class="line">        H.min = x</span><br><span class="line">    H.n = H.n + <span class="number">1</span>                          <span class="comment"># æ›´æ–°ç»“ç‚¹æ•°ç›®</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸€ä¸ªæ–æ³¢é‚£å¥‘å †ä¸­æ’å…¥é”®å€¼ä¸º21çš„ç»“ç‚¹ï¼š</p><p><img src="/uploads/image/introduction-to-algorithms/fib-heap-insert.png" title="æ’å…¥"></p><p>å›¾ä¸­æ’å…¥ä½ç½®ä¸ºH.minçš„å‰é©±ï¼Œå®žé™…çš„æ’å…¥ä½ç½®æ²¡æœ‰å½±å“ã€‚</p><h2 id="ä¸¤ä¸ªæ–æ³¢é‚£å¥‘å †çš„åˆå¹¶">ä¸¤ä¸ªæ–æ³¢é‚£å¥‘å †çš„åˆå¹¶</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIB-HEAP-UNION(H1, H2):</span><br><span class="line">    H = MAKE-FIB-HEAP()</span><br><span class="line">    H.root_list = concatenate(H1.root_list, H2.root_list) <span class="comment"># åˆå¹¶æ ¹é“¾è¡¨</span></span><br><span class="line">    H.min = H1.min      <span class="comment"># åˆ¤æ–­åˆå¹¶åŽå †çš„æœ€å°ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> H1.min == NIL <span class="keyword">or</span> (H2.min != NIL <span class="keyword">and</span> H2.min.key &lt; H1.min.key):</span><br><span class="line">        H.min = H2.min</span><br><span class="line">    H.n = H1.n + H2.n   <span class="comment"># æ›´æ–°ç»“ç‚¹æ•°ç›®</span></span><br><span class="line">    <span class="keyword">return</span> H</span><br></pre></td></tr></table></figure><h2 id="æŠ½å–æœ€å°ç»“ç‚¹">æŠ½å–æœ€å°ç»“ç‚¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIB-HEAP-EXTRACT-MIN(H):</span><br><span class="line">    z = H.min</span><br><span class="line">    <span class="keyword">if</span> z != NIL:</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> z.child:           <span class="comment"># å°†minçš„æ‰€æœ‰å­©å­ç»“ç‚¹ç§»åŠ¨åˆ°æ ¹é“¾è¡¨</span></span><br><span class="line">            H.root_list.insert(x)   <span class="comment"># æ›´æ–°leftå’Œright</span></span><br><span class="line">            x.p = NIL               <span class="comment"># æ›´æ–°çˆ¶èŠ‚ç‚¹ï¼Œä¸æ›´æ–°childæ„å‘³ç€å­©å­ç»“ç‚¹xçš„å­©å­ç»“ç‚¹ä¸å˜</span></span><br><span class="line">        H.root_list.delete(z)       <span class="comment"># åˆ é™¤æœ€å°ç»“ç‚¹min</span></span><br><span class="line">        H.min = NIL</span><br><span class="line">        CONSOLIDATE(H)              <span class="comment"># å­è¿‡ç¨‹</span></span><br><span class="line">        H.n = H.n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> z</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å­è¿‡ç¨‹CONSOLIDATE(H)ç”¨æ¥æŠŠå…·æœ‰ç›¸åŒåº¦æ•°çš„æ ¹èŠ‚ç‚¹åˆå¹¶ï¼ˆconsolidatingï¼‰ï¼Œç›´åˆ°æ¯ä¸ªåº¦æ•°è‡³å¤šåªæœ‰ä¸€ä¸ªæ ¹ã€‚è¯¥è¿‡ç¨‹ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©æ•°ç»„<code>A[0...D(H.n)]</code>æ¥è®°å½•æ ¹èŠ‚ç‚¹å¯¹ç”¨çš„åº¦æ•°çš„è½¨è¿¹ï¼Œå…¶ä¸­D(H.n)è¡¨ç¤ºä¸€ä¸ªnä¸ªç»“ç‚¹çš„æ–æ³¢é‚£å¥‘å †ä¸­ä»»ä½•ç»“ç‚¹çš„æœ€å¤§åº¦æ•°ä¸Šç•Œï¼ˆ<span class="math inline">\(D(n)=O(\lg{n})\)</span>ï¼‰ã€‚å¦‚æžœA[i]=yï¼Œé‚£ä¹ˆå½“å‰çš„yæ˜¯ä¸€ä¸ªå…·æœ‰y.degree=içš„æ ¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CONSOLIDATE(H):</span><br><span class="line">    let A[<span class="number">0.</span>.D(H.n)] be a new array</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span> to D(H.n):  <span class="comment"># åˆå§‹åŒ–A</span></span><br><span class="line">        A[i] = NIL</span><br><span class="line">    <span class="keyword">for</span> each node w <span class="keyword">in</span> the root list of H:</span><br><span class="line">        x = w</span><br><span class="line">        d = x.degree</span><br><span class="line">        <span class="keyword">while</span> A[d] != NIL:</span><br><span class="line">            y = A[d]      <span class="comment"># å¦ä¸€ä¸ªå…·æœ‰ç›¸åŒåº¦æ•°dçš„ç»“ç‚¹y</span></span><br><span class="line">            <span class="keyword">if</span> x.key &gt; y.key:</span><br><span class="line">                exchange x <span class="keyword">with</span> y   <span class="comment"># å§‹ç»ˆä¿è¯x.key &lt; y.key</span></span><br><span class="line">            FIB-HEAP-LINK(H, y, x)  <span class="comment"># å­è¿‡ç¨‹ï¼šå°†yé“¾æŽ¥ä¸ºxçš„å­©å­ç»“ç‚¹</span></span><br><span class="line">            A[d] = NIL              <span class="comment"># åˆå¹¶åŽå…·æœ‰åº¦æ•°dçš„ç»“ç‚¹ä¸å­˜åœ¨äº†</span></span><br><span class="line">            d = d + <span class="number">1</span>               <span class="comment"># åˆå¹¶åŽxçš„åº¦æ•°ï¼Œé€šè¿‡whileå¾ªçŽ¯å†æ¬¡å¯»æ‰¾å…·æœ‰ç›¸åŒåº¦æ•°çš„ç»“ç‚¹y</span></span><br><span class="line">        A[d] = x                    <span class="comment"># ä¸å­˜åœ¨ç›¸åŒåº¦æ•°dçš„yï¼Œè®°å½•xçš„åº¦æ•°ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> H.min == NIL <span class="keyword">or</span> x.key &lt; H.min.key:  <span class="comment"># æ›´æ–°minç»“ç‚¹</span></span><br><span class="line">            H.min = x</span><br><span class="line"></span><br><span class="line">FIB-HEAP-LINK(H, y, x):</span><br><span class="line">    H.root_list.delete(y)    <span class="comment"># ä»ŽHçš„æ ¹é“¾è¡¨ä¸­ç§»é™¤y</span></span><br><span class="line">    x.child.insert(y)        <span class="comment"># å°†yæ·»åŠ åˆ°xçš„å­©å­ç»“ç‚¹ä¸­</span></span><br><span class="line">    x.degree = x.degree + <span class="number">1</span>  <span class="comment"># æ›´æ–°xçš„åº¦</span></span><br><span class="line">    y.mark = <span class="literal">False</span>           <span class="comment"># æ¸…é™¤yä¸Šçš„æ ‡è®°</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/fib-heap-extract-min.png" title="æå–æœ€å°çš„å…ƒç´ "></p><ul><li><span class="math inline">\((a)\)</span> ä»Žå½“å‰çš„æ–æ³¢é‚£å¥‘å †ä¸­æå–æœ€å°ç»“ç‚¹H.minã€‚ä»¥åŽæŠŠâ€œé”®å€¼ä¸ºxçš„ç»“ç‚¹â€çœç•¥ç§°ä¸ºâ€œç»“ç‚¹xâ€œã€‚</li><li><span class="math inline">\((a)\rightarrow(b)\)</span> å°†ç»“ç‚¹3çš„æ‰€æœ‰å­èŠ‚ç‚¹ç§»åŠ¨åˆ°æ ¹é“¾è¡¨ã€‚H.minæŒ‡é’ˆå³ç§»ä¸€ä½ã€‚æ­¤æ—¶ä¸ä¸€å®šæŒ‡å‘æœ€å°å…ƒç´ ï¼Œåœ¨åŽç»­æ“ä½œä¸­ä¼šè°ƒæ•´ã€‚</li><li><span class="math inline">\((b)\rightarrow(c)\)</span> åˆ›å»ºä¸€ä¸ªè¾…åŠ©æ•°ç»„Aï¼ŒéåŽ†æ ¹é“¾è¡¨ã€‚å½“å‰ç»“ç‚¹çš„åº¦æ•°ä¸º1ï¼ŒA[1]ä¸ºç©ºï¼Œå°†A[1]æŒ‡å‘å½“å‰ç»“ç‚¹ã€‚ç»§ç»­ä¸‹ä¸€ä½ã€‚</li><li><span class="math inline">\((d)\rightarrow(e)\)</span> è¿‡ç¨‹ç±»ä¼¼ã€‚ç»“æžœæ˜¯A[2]æŒ‡å‘åº¦æ•°ä¸º2çš„ç»“ç‚¹24ï¼›A[0]æŒ‡å‘åº¦æ•°ä¸º0çš„ç»“ç‚¹23ã€‚</li><li><span class="math inline">\((e)\rightarrow(f)\)</span> ç»“ç‚¹7çš„åº¦æ•°ä¸º0ï¼Œä½†A[0]ä¸ä¸ºç©ºï¼Œå°†ç»“ç‚¹7ä¸ŽA[0]æŒ‡å‘çš„ç»“ç‚¹23åˆå¹¶ï¼šé”®å€¼è¾ƒå¤§çš„ç»“ç‚¹23ç§»åŠ¨åˆ°ç»“ç‚¹7çš„å­èŠ‚ç‚¹é“¾è¡¨ä¸­ã€‚ç§»åŠ¨åŽï¼Œæ¸…é™¤A[0]ã€‚</li><li><span class="math inline">\((f)\rightarrow(g)\)</span> ç»“ç‚¹7çš„åº¦æ•°ä¸º1ï¼ŒA[1]ä¸ä¸ºç©ºä¸”æŒ‡å‘ç»“ç‚¹17ã€‚äºŽæ˜¯å°†ç»“ç‚¹17ç§»åŠ¨åˆ°ç»“ç‚¹7çš„å­ç»“ç‚¹é“¾è¡¨ä¸­ã€‚æ¸…é™¤A[1]ã€‚</li><li><span class="math inline">\((g)\rightarrow(h)\)</span> ç»“ç‚¹7çš„åº¦æ•°ä¸º2ï¼ŒA[2]ä¸ä¸ºç©ºä¸”æŒ‡å‘24ã€‚åˆå¹¶ç»“ç‚¹7ä¸Žç»“ç‚¹24ã€‚æ¸…é™¤A[2]ã€‚æ­¤æ—¶ç»“ç‚¹7çš„åº¦æ•°ä¸º3ï¼Œè€ŒA[3]ä¸ºç©ºï¼Œä»¤A[3]æŒ‡å‘ç»“ç‚¹ç»“ç‚¹7ã€‚ç»§ç»­ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚</li><li><span class="math inline">\((i)\rightarrow(j)\)</span> A[0]æŒ‡å‘ç»“ç‚¹21ï¼›A[1]æŒ‡å‘ç»“ç‚¹18ã€‚</li><li><span class="math inline">\((j)\rightarrow(k)\)</span> ç»“ç‚¹52åº¦æ•°ä¸º0ï¼ŒA[0]ä¸ä¸ºç©ºä¸”æŒ‡å‘21ã€‚åˆå¹¶ç»“ç‚¹21ä¸Žç»“ç‚¹52ã€‚æ¸…é™¤A[0]ï¼›åˆå¹¶åŽç»“ç‚¹21çš„åº¦æ•°ä¸º1ï¼ŒA[1]æŒ‡å‘ç»“ç‚¹18ã€‚åˆå¹¶ç»“ç‚¹21ä¸Žç»“ç‚¹18ã€‚æ¸…é™¤A[1]ï¼›åˆå¹¶åŽç»“ç‚¹18åº¦æ•°ä¸º2ï¼ŒA[2]ä¸ºç©ºï¼Œä»¤A[2]æŒ‡å‘ç»“ç‚¹18ã€‚ç»§ç»­ä¸‹ä¸€ç»“ç‚¹ã€‚</li><li><span class="math inline">\((k)\rightarrow(l)\)</span> ç»“ç‚¹38çš„åº¦æ•°ä¸º1ï¼ŒA[1]ä¸ºç©ºã€‚ä»¤A[1]æŒ‡å‘ç»“ç‚¹38ã€‚ç»§ç»­ä¸‹ä¸€èŠ‚ç‚¹ã€‚</li><li><span class="math inline">\((m)\)</span> æ‰€æœ‰ç»“ç‚¹éåŽ†å®Œæ¯•ã€‚æ›´æ–°H.minã€‚</li></ul><h1 id="å‡å€¼å’Œåˆ é™¤">å‡å€¼å’Œåˆ é™¤</h1><h2 id="å…³é”®å­—å‡å€¼">å…³é”®å­—å‡å€¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIB-HEAP-DECREASE-KEY(H, x, k):</span><br><span class="line">    <span class="keyword">if</span> k &gt; x.key:</span><br><span class="line">        error <span class="string">"new key is greater than current key"</span></span><br><span class="line">    x.key = k</span><br><span class="line">    y = x.p</span><br><span class="line">    <span class="keyword">if</span> y != NIL <span class="keyword">and</span> x.key &lt; y.key:  <span class="comment"># å¦‚æžœæ›´æ–°åŽxçš„å€¼å°äºŽçˆ¶èŠ‚ç‚¹çš„å€¼ï¼Œè°ƒæ•´å †</span></span><br><span class="line">        CUT(H, x, y)                <span class="comment"># å­è¿‡ç¨‹ï¼šåˆ‡æ–­xä¸Žå…¶çˆ¶èŠ‚ç‚¹yä¹‹é—´çš„é“¾æŽ¥</span></span><br><span class="line">        CASCADING-CUT(H, y)         <span class="comment"># å­è¿‡ç¨‹ï¼šçº§è”åˆ‡æ–­</span></span><br><span class="line">    <span class="keyword">if</span> x.key &lt; H.min.key:           <span class="comment"># æ›´æ–°minç»“ç‚¹</span></span><br><span class="line">        H.min = x</span><br><span class="line"></span><br><span class="line">CUT(H, x, y):                <span class="comment"># åˆ‡æ–­xä¸Žå…¶çˆ¶èŠ‚ç‚¹yä¹‹é—´çš„é“¾æŽ¥ï¼Œå¹¶å°†xæ·»åŠ åˆ°æ ¹é“¾è¡¨</span></span><br><span class="line">    y.child.delete(x)        <span class="comment"># remove x from the child list of y</span></span><br><span class="line">    y.degree = y.degree - <span class="number">1</span>  <span class="comment"># decrementint y.degree</span></span><br><span class="line">    H.root_list.insert(x)    <span class="comment"># add x to the root list of H</span></span><br><span class="line">    x.p = NIL</span><br><span class="line">    x.mark = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">CASCADING-CUT(H, y):            <span class="comment"># çº§è”åˆ‡æ–­</span></span><br><span class="line">    z = y.p</span><br><span class="line">    <span class="keyword">if</span> z != NIL:</span><br><span class="line">        <span class="keyword">if</span> y.mark == <span class="literal">False</span>:     <span class="comment"># å¦‚æžœmarkä¸ºfalseï¼Œé‚£ä¹ˆä¸Šæ¬¡CUTä¸­ï¼Œæ˜¯ç»“ç‚¹yç¬¬ä¸€æ¬¡å¤±åŽ»å­©å­</span></span><br><span class="line">            y.mark == <span class="literal">True</span>      <span class="comment"># ç¬¬ä¸€æ¬¡å¤±åŽ»å­©å­ï¼Œmarkç½®ä¸ºTrue</span></span><br><span class="line">        <span class="keyword">else</span>:                   <span class="comment"># å¦‚æžœmarkä¸ºTrueï¼Œé‚£ä¹ˆä¸Šæ¬¡CUTä¹‹å‰ï¼Œyå·²ç»å¤±åŽ»è¿‡å­©å­</span></span><br><span class="line">            CUT(H, y, z)</span><br><span class="line">            CASCADING-CUT(H, Z) <span class="comment"># å‘ä¸Šé€’å½’ï¼Œç›´åˆ°é‡åˆ°æ ¹èŠ‚ç‚¹æˆ–è€…ä¸€ä¸ªæœªè¢«æ ‡è®°çš„ç»“ç‚¹ï¼ˆmark=Falseï¼‰</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/fib-heap-decrease-key.png" title="å‡å°å…ƒç´ çš„å€¼"></p><ul><li><span class="math inline">\((a)\)</span> åˆå§‹æ–æ³¢é‚£å¥‘å †ã€‚å°†ç»“ç‚¹46çš„é”®å€¼é™ä½Žä¸º15ã€‚</li><li><p><span class="math inline">\((a)\rightarrow(b)\)</span> ä¿®æ”¹é”®å€¼ã€‚å°†ä¿®æ”¹åŽçš„ç»“ç‚¹15ç§»åŠ¨åˆ°æ ¹é“¾è¡¨ï¼ˆåˆ‡æ–­ï¼‰ã€‚å…¶çˆ¶èŠ‚ç‚¹24ï¼Œä¹‹å‰æœªè¢«æ ‡è®°ã€‚çŽ°åœ¨å¤±åŽ»äº†ä¸€ä¸ªå­©å­ï¼Œæ ‡è®°å®ƒã€‚</p></li><li><p><span class="math inline">\((b)\)</span> åœ¨æ­¤æ–æ³¢é‚£å¥‘å †ä¸Šï¼Œå°†ç»“ç‚¹35çš„é”®å€¼é™ä½Žä¸º5ã€‚</p></li><li><span class="math inline">\((b)\rightarrow(c)\)</span> ä¿®æ”¹é”®å€¼ï¼Œå°†ä¿®æ”¹åŽçš„ç»“ç‚¹5ç§»åŠ¨åˆ°æ ¹é“¾è¡¨ï¼ˆåˆ‡æ–­ï¼‰ã€‚</li><li><span class="math inline">\((c)\rightarrow(d)\)</span> ç»“ç‚¹5çš„åŽŸæ¥çš„çˆ¶èŠ‚ç‚¹26æ˜¯è¢«æ ‡è®°çš„ï¼Œè§¦å‘çº§è”åˆ‡æ–­çš„æ¡ä»¶ï¼šåˆ‡æ–­ç»“ç‚¹26ä¸Žå…¶çˆ¶èŠ‚ç‚¹ï¼Œå°†ç»“ç‚¹26ç§»åŠ¨åˆ°æ ¹é“¾è¡¨ï¼Œæ¸…é™¤å…¶æ ‡è®°ã€‚ä¹‹åŽå¯¹ç»“ç‚¹26çš„åŽŸæ¥çš„çˆ¶èŠ‚ç‚¹24é€’å½’åœ°è°ƒç”¨çº§è”åˆ‡æ–­è¿‡ç¨‹ã€‚</li><li><span class="math inline">\((d)\rightarrow(e)\)</span> ç»“ç‚¹24åŒæ ·æ˜¯è¢«æ ‡è®°çš„ï¼Œåˆ‡æ–­ç»“ç‚¹24ä¸Žå…¶çˆ¶èŠ‚ç‚¹7ã€‚æœ€åŽå¯¹ç»“ç‚¹24çš„åŽŸæ¥çš„çˆ¶èŠ‚ç‚¹7é€’å½’åœ°è°ƒç”¨çº§è”åˆ‡æ–­ã€‚</li><li><p>ç»“ç‚¹7æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œçº§è”åˆ‡æ–­ä¸å¤„ç†æ­¤ç±»ç»“ç‚¹ã€‚</p></li></ul><h2 id="åˆ é™¤ä¸€ä¸ªç»“ç‚¹">åˆ é™¤ä¸€ä¸ªç»“ç‚¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">FIB-HEAP-DELETE(H, x):</span><br><span class="line">    FIB-HEAP-DECREASE-KEY(H, x, -infinty)</span><br><span class="line">    FIB-HEAP-EXTRACT-MIN(H)</span><br></pre></td></tr></table></figure><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> data_structure.linked_list <span class="keyword">import</span> Element, LinkedList, union <span class="keyword">as</span> union_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(Element)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, k)</span>:</span></span><br><span class="line">        Element.__init__(self, k)</span><br><span class="line">        self.degree, self.mark = <span class="number">0</span>, <span class="literal">False</span>  <span class="comment"># markï¼šç¬¬1æ¬¡å¤±åŽ»å­©å­åŽä¸ºTrueã€ç¬¬2æ¬¡åŽä¸ºFalse</span></span><br><span class="line">        self.p = self.child = self.prev = self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.value())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">value</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.child <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> len(self.child) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> self.key</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;self.key: [c.value() <span class="keyword">for</span> c <span class="keyword">in</span> self.child]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FibHeap</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n, self.min = <span class="number">0</span>, <span class="literal">None</span>  <span class="comment"># å †ä¸­ç»“ç‚¹æ•°ç›®, å †ä¸­æœ€å°ç»“ç‚¹</span></span><br><span class="line">        self.root_list = LinkedList()  <span class="comment"># æ ¹é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        s = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> self.root_list:</span><br><span class="line">            s.append(str(x))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">', '</span>.join(s)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x.degree, x.mark = <span class="number">0</span>, <span class="literal">False</span></span><br><span class="line">        x.p = x.child = <span class="literal">None</span></span><br><span class="line">        self.root_list.insert(x)  <span class="comment"># æ’å…¥æ ¹é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> self.min <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> x.key &lt; self.min.key:</span><br><span class="line">            self.min = x</span><br><span class="line">        self.n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">        z = self.min</span><br><span class="line">        <span class="keyword">if</span> z <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> z.child <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># å°†æ‰€æœ‰å­èŠ‚ç‚¹æ’å…¥åˆ°æ ¹é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> z.child:</span><br><span class="line">                    self.root_list.insert(x)</span><br><span class="line">                    x.p = <span class="literal">None</span></span><br><span class="line">            self.min = <span class="literal">None</span></span><br><span class="line">            self.root_list.delete(z)  <span class="comment"># ä»Žæ ¹é“¾è¡¨ä¸­ç§»é™¤</span></span><br><span class="line">            self.consolidate()  <span class="comment"># åˆå¹¶åº¦æ•°ç›¸åŒçš„ç»“ç‚¹</span></span><br><span class="line">            self.n -= <span class="number">1</span>  <span class="comment"># æ€»ç»“ç‚¹æ•°ç›®å‡1</span></span><br><span class="line">            z.child = <span class="literal">None</span>  <span class="comment"># æ¸…é™¤æŒ‡é’ˆï¼Œä¸æ¸…é™¤å¯¹æ–æ³¢é‚£å¥‘å †ä¹Ÿæ²¡ä»€ä¹ˆå½±å“</span></span><br><span class="line">        <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">consolidate</span><span class="params">(self)</span>:</span></span><br><span class="line">        degree = &#123;&#125;  <span class="comment"># degree[i]=yï¼Œé‚£ä¹ˆy.degree=i</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> self.root_list:  <span class="comment"># åœ¨link()ä¸­å¯èƒ½è¢«åˆ é™¤çš„å…ƒç´ å·²ç»è®¿é—®è¿‡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨</span></span><br><span class="line">            d = x.degree</span><br><span class="line">            <span class="keyword">while</span> d <span class="keyword">in</span> degree:</span><br><span class="line">                y = degree.pop(d)  <span class="comment"># another node with the same degree as x</span></span><br><span class="line">                <span class="keyword">if</span> x.key &gt; y.key:</span><br><span class="line">                    x, y = y, x</span><br><span class="line">                self.link(y, x)</span><br><span class="line">                d = d + <span class="number">1</span></span><br><span class="line">            degree[d] = x</span><br><span class="line">            <span class="keyword">if</span> self.min <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> self.min.key &gt; x.key:</span><br><span class="line">                self.min = x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">link</span><span class="params">(self, y, x)</span>:</span></span><br><span class="line">        self.root_list.delete(y)</span><br><span class="line">        y.p = x</span><br><span class="line">        <span class="keyword">if</span> x.child <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            x.child = LinkedList()</span><br><span class="line">        x.child.insert(y)</span><br><span class="line">        x.degree += <span class="number">1</span></span><br><span class="line">        y.mark = <span class="literal">False</span>  <span class="comment"># yæˆä¸ºå­©å­ç»“ç‚¹æ—¶ï¼Œmarkç½®ä¸ºFalse</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrease_key</span><span class="params">(self, x, k)</span>:</span> <span class="comment"># æ²¡æœ‰å¯¹ç»“ç‚¹xæ˜¯å¦åœ¨å †ä¸­è¿›è¡Œåˆ¤æ–­ï¼Œheap.minå¯èƒ½ä¼šæŒ‡å‘å †å¤–ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> k &gt; x.key:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'new key is greater than current key'</span>)</span><br><span class="line">        x.key, y = k, x.p</span><br><span class="line">        <span class="keyword">if</span> y <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> x.key &lt; y.key:  <span class="comment"># å½“æ›´æ–°åŽçš„å€¼å°äºŽçˆ¶èŠ‚ç‚¹æ—¶è°ƒæ•´å †</span></span><br><span class="line">            self.cut(x, y)  <span class="comment"># åˆ‡æ–­xä¸Žy</span></span><br><span class="line">            self.cascading_cut(y)</span><br><span class="line">        <span class="keyword">if</span> x.key &lt; self.min.key:</span><br><span class="line">            self.min = x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cut</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        y.child.delete(x)  <span class="comment"># åˆ†ç¦»xä¸Žå…¶çˆ¶èŠ‚ç‚¹y</span></span><br><span class="line">        self.root_list.insert(x)  <span class="comment"># ä½¿xæˆä¸ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        y.degree -= <span class="number">1</span></span><br><span class="line">        x.p, x.mark = <span class="literal">None</span>, <span class="literal">False</span>  <span class="comment"># xæˆä¸ºæ ¹ç»“ç‚¹æ—¶ï¼Œmarkç½®ä¸ºFalse</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cascading_cut</span><span class="params">(self, y)</span>:</span></span><br><span class="line">        z = y.p</span><br><span class="line">        <span class="keyword">if</span> z <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> y.mark <span class="keyword">is</span> <span class="literal">False</span>:  <span class="comment"># mark=Falseï¼Œæ˜¯ç¬¬ä¸€æ¬¡å¤±åŽ»å­©å­</span></span><br><span class="line">                y.mark = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># mark=True,æ˜¯ç¬¬äºŒæ¬¡å¤±åŽ»å­©å­</span></span><br><span class="line">                self.cut(y, z)</span><br><span class="line">                self.cascading_cut(z)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.decrease_key(x, float(<span class="string">'-inf'</span>))</span><br><span class="line">        self.pop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(h1, h2)</span>:</span></span><br><span class="line">    h = FibHeap()  <span class="comment"># åˆå§‹åŒ–æ–°å †</span></span><br><span class="line">    h.root_list = union_list(h1.root_list, h2.root_list)  <span class="comment"># åˆå¹¶æ ¹é“¾è¡¨ï¼Œh1å’Œh2çš„æ ¹é“¾è¡¨ä¼šè¢«é”€æ¯</span></span><br><span class="line">    h.min = h1.min  <span class="comment"># æ¯”è¾ƒæœ€å°ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> h1.min <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> (h2.min <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> h2.min.key &lt; h1.min.key):</span><br><span class="line">        h.min = h2.min</span><br><span class="line">    h.n = h1.n + h2.n  <span class="comment"># ç»“ç‚¹æ•°ç›®ç›¸åŠ </span></span><br><span class="line">    <span class="keyword">return</span> h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    h1, h2 = FibHeap(), FibHeap()</span><br><span class="line">    key1, key2 = [<span class="number">23</span>, <span class="number">7</span>, <span class="number">21</span>, <span class="number">3</span>, <span class="number">17</span>, <span class="number">24</span>, <span class="number">18</span>], [<span class="number">52</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">26</span>, <span class="number">46</span>, <span class="number">39</span>, <span class="number">41</span>, <span class="number">35</span>]</span><br><span class="line">    [h1.insert(Node(i)) <span class="keyword">for</span> i <span class="keyword">in</span> key1]</span><br><span class="line">    [h2.insert(Node(i)) <span class="keyword">for</span> i <span class="keyword">in</span> key2]</span><br><span class="line">    print(<span class="string">'h1:'</span>, h1)</span><br><span class="line">    print(<span class="string">'h2:'</span>, h2)</span><br><span class="line">    h = union(h1, h2)  <span class="comment"># unionï¼Œåˆå¹¶æ ¹é“¾è¡¨</span></span><br><span class="line">    print(<span class="string">'h:'</span>, h)</span><br><span class="line">    print(<span class="string">'&#123;0:&lt;3s&#125; &#123;1:&lt;6s&#125;'</span>.format(<span class="string">'pop'</span>, <span class="string">'h'</span>))</span><br><span class="line">    <span class="keyword">while</span> h.n &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">'&#123;0:&lt;3d&#125; &#123;1:&lt;6s&#125;'</span>.format(h.pop().key, str(h)))</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">h1: 18, 24, 17, 3, 21, 7, 23</span><br><span class="line">h2: 35, 41, 39, 46, 26, 30, 38, 52</span><br><span class="line">h: 18, 24, 17, 3, 21, 7, 23, 35, 41, 39, 46, 26, 30, 38, 52</span><br><span class="line">pop h</span><br><span class="line">3   &#123;7: [&#123;17: [&#123;18: [24]&#125;, 21]&#125;, &#123;35: [41]&#125;, 23]&#125;, &#123;26: [&#123;39: [46]&#125;, 30]&#125;, &#123;38: [52]&#125;</span><br><span class="line">7   23, &#123;35: [&#123;38: [52]&#125;, 41]&#125;, &#123;17: [&#123;26: [&#123;39: [46]&#125;, 30]&#125;, &#123;18: [24]&#125;, 21]&#125;</span><br><span class="line">17  &#123;18: [&#123;26: [&#123;39: [46]&#125;, 30]&#125;, &#123;21: [23]&#125;, 24]&#125;, &#123;35: [&#123;38: [52]&#125;, 41]&#125;</span><br><span class="line">18  24, &#123;21: [23]&#125;, &#123;26: [&#123;35: [&#123;38: [52]&#125;, 41]&#125;, &#123;39: [46]&#125;, 30]&#125;</span><br><span class="line">21  &#123;23: [24]&#125;, &#123;26: [&#123;35: [&#123;38: [52]&#125;, 41]&#125;, &#123;39: [46]&#125;, 30]&#125;</span><br><span class="line">23  24, &#123;26: [&#123;35: [&#123;38: [52]&#125;, 41]&#125;, &#123;39: [46]&#125;, 30]&#125;</span><br><span class="line">24  &#123;26: [&#123;35: [&#123;38: [52]&#125;, 41]&#125;, &#123;39: [46]&#125;, 30]&#125;</span><br><span class="line">26  30, &#123;39: [46]&#125;, &#123;35: [&#123;38: [52]&#125;, 41]&#125;</span><br><span class="line">30  &#123;39: [46]&#125;, &#123;35: [&#123;38: [52]&#125;, 41]&#125;</span><br><span class="line">35  41, &#123;38: [&#123;39: [46]&#125;, 52]&#125;</span><br><span class="line">38  &#123;39: [&#123;41: [52]&#125;, 46]&#125;</span><br><span class="line">39  46, &#123;41: [52]&#125;</span><br><span class="line">41  &#123;46: [52]&#125;</span><br><span class="line">46  52</span><br><span class="line">52</span><br></pre></td></tr></table></figure><h1 id="åº”ç”¨">åº”ç”¨</h1><ul><li>Dijkstraç®—æ³•</li><li>Primç®—æ³•</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> data structures </tag>
            
            <tag> heap </tag>
            
            <tag> fibonacci heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–¯ç‰¹çµè¿‘ä¼¼å…¬å¼</title>
      <link href="/further-mathematics/stirling-s-approximation/"/>
      <url>/further-mathematics/stirling-s-approximation/</url>
      
        <content type="html"><![CDATA[<p><a href="https://zh.wikipedia.org/wiki/%E6%96%AF%E7%89%B9%E9%9D%88%E5%85%AC%E5%BC%8F" target="_blank" rel="noopener">æ–¯ç‰¹çµå…¬å¼</a>ï¼ˆStirling's approximation or Stirling's formulaï¼‰æ˜¯ä¸€æ¡ç”¨æ¥å–né˜¶ä¹˜è¿‘ä¼¼å€¼çš„æ•°å­¦å…¬å¼ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“nå¾ˆå¤§çš„æ—¶å€™ï¼Œné˜¶ä¹˜çš„è®¡ç®—é‡ååˆ†å¤§ï¼Œæ‰€ä»¥æ–¯ç‰¹çµå…¬å¼ååˆ†å¥½ç”¨ã€‚è€Œä¸”ï¼Œå³ä½¿åœ¨nå¾ˆå°çš„æ—¶å€™ï¼Œæ–¯ç‰¹çµå…¬å¼çš„å–å€¼å·²ç»ååˆ†å‡†ç¡®ã€‚</p><p><span class="math display">\[n! \approx \sqrt{2\pi{n}}(\frac{n}{e})^n\]</span></p>]]></content>
      
      
      <categories>
          
          <category> é«˜ç­‰æ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> formula </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€ŸæŽ’åº</title>
      <link href="/notes/introduction-to-algorithms/quicksort/"/>
      <url>/notes/introduction-to-algorithms/quicksort/</url>
      
        <content type="html"><![CDATA[<h1 id="å¿«é€ŸæŽ’åº">å¿«é€ŸæŽ’åº</h1><p>å¿«é€ŸæŽ’åºï¼ˆQuicksortï¼‰æ˜¯ä¸€ç§é«˜æ•ˆçš„æ¯”è¾ƒåž‹æŽ’åºç®—æ³•ï¼ŒäºŽ1961å¹´ç”±ç‘žå…¸ç§‘å­¦å®¶<a href="https://en.wikipedia.org/wiki/Tony_Hoare" target="_blank" rel="noopener">Tony Hoare</a>å‘è¡¨ã€‚ä¸Ž<a href="/algorithm/Merge-sort">å½’å¹¶æŽ’åº</a>ç±»ä¼¼ï¼Œå¿«é€ŸæŽ’åºä¹Ÿæ˜¯ä¸€ç§åˆ†æ²»ç®—æ³•ã€‚å¿«é€ŸæŽ’åºæ˜¯å¸¸ç”¨çš„æŽ’åºç®—æ³•ï¼Œä¸€ä¸ªå¥½çš„å¿«é€ŸæŽ’åºçš„å®žçŽ°ï¼Œç”šè‡³å¯ä»¥æ¯”å½’å¹¶æŽ’åºå’Œå †æŽ’åºå¿«ä¸¤åˆ°ä¸‰å€ã€‚å¿«é€ŸæŽ’åºä¸æ˜¯ç¨³å®šæŽ’åºï¼Œä½†å®ƒæ˜¯åŽŸå€æŽ’åºã€‚æŽ’åºnä¸ªæ•°çš„<strong>å¹³å‡</strong>æ—¶é—´ä»£ä»·æ˜¯<span class="math inline">\(O(n\log{n})\)</span>ã€‚æœ€åæƒ…å†µä¸‹ï¼Œå®ƒçš„æ—¶é—´ä»£ä»·æ˜¯<span class="math inline">\(O(n^2)\)</span>ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘å‡ºçŽ°ã€‚å¿«é€ŸæŽ’åºçš„ç¤ºä¾‹å›¾ï¼ˆæ¥è‡ª<a href="https://en.wikipedia.org/wiki/Quicksort" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘ï¼šQuicksort</a>ï¼‰å¦‚ä¸‹ï¼š</p><p><img src="/uploads/image/introduction-to-algorithms/sorting-quicksort-anim.gif" title="å¿«é€ŸæŽ’åºåŠ¨æ€è¿‡ç¨‹"></p><a id="more"></a><h1 id="å®žçŽ°">å®žçŽ°</h1><p>å¿«é€ŸæŽ’åºåŒæ ·éµå¾ªåˆ†æ²»æ¨¡å¼ï¼Œæ¯å±‚é€’å½’æ˜¯æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆ†è§£ï¼ˆDivideï¼‰ï¼šæ•°ç»„<code>A[p...r]</code>è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªï¼ˆå¯èƒ½ä¸ºç©ºï¼‰å­æ•°ç»„<code>A[p...q-1]</code>å’Œ<code>A[q+1...r]</code>ï¼Œä½¿å¾—<span class="math inline">\(A[i]\le{A[q]}\le{A[j]}, i\in[p,q-1], j\in[q+1,r]\)</span>ã€‚å…¶ä¸­ï¼Œè®¡ç®—ä¸‹æ ‡qä¹Ÿæ˜¯åˆ’åˆ†è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</li><li>è§£å†³ï¼ˆConquerï¼‰ï¼šé€šè¿‡é€’å½’è°ƒç”¨å¿«é€ŸæŽ’åºï¼Œå¯¹å­æ•°ç»„<code>A[p...q-1]</code>å’Œ<code>A[q+1...r]</code>è¿›è¡ŒæŽ’åºã€‚</li><li>åˆå¹¶ï¼ˆCombineï¼‰ï¼šå¿«é€ŸæŽ’åºä¸éœ€è¦åˆå¹¶æ“ä½œï¼Œæ•°ç»„<code>A[p...r]</code>å·²ç»æœ‰åºã€‚</li></ul><p>ä¸Žå½’å¹¶æŽ’åºä¸åŒï¼Œå¿«é€ŸæŽ’åºçš„æ¯”è¾ƒè¿‡ç¨‹å‘ç”Ÿåœ¨åˆ†è§£é˜¶æ®µï¼Œä¸”å¿«é€ŸæŽ’åºæ˜¯åŽŸå€æŽ’åºï¼Œæ‰€ä»¥å¿«é€ŸæŽ’åºä¸éœ€è¦åˆå¹¶æ“ä½œã€‚</p><p>å®žçŽ°å¿«é€ŸæŽ’åºçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">quicksort(A, p, r):</span><br><span class="line">    <span class="keyword">if</span> p &lt; r:</span><br><span class="line">        q = partition(A, p, r)</span><br><span class="line">        quicksort(A, p, q - <span class="number">1</span>)</span><br><span class="line">        quicksort(A, q + <span class="number">1</span>, r)</span><br></pre></td></tr></table></figure><p>å¿«é€ŸæŽ’åºçš„å…³é”®éƒ¨åˆ†æ˜¯partitionè¿‡ç¨‹ï¼Œå®ƒå®žçŽ°äº†å¯¹å­æ•°ç»„<code>A[p...r]</code>çš„åŽŸå€æŽ’åºã€‚</p><h2 id="lomutoåˆ’åˆ†">Lomutoåˆ’åˆ†</h2><p>Lomutoåˆ’åˆ†çš„æ•ˆçŽ‡ä¸é«˜ï¼Œä½†å®ƒæ˜“äºŽç†è§£ã€‚å®ƒé€šå¸¸é€‰æ‹©æœ€åŽä¸€ä¸ªå…ƒç´ x=A[r]ä½œä¸º<strong>ä¸»å…ƒ</strong>ï¼ˆpivotï¼‰ï¼Œå¹¶å›´ç»•å®ƒæ¥åˆ’åˆ†å­æ•°ç»„<code>A[p...r]</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lomuto_partition(A, p, r):</span><br><span class="line">    x = A[r]</span><br><span class="line">    i = p - <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j = p to r - <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> A[j] &lt;= x</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">            exchange A[i] <span class="keyword">with</span> A[j]</span><br><span class="line">    exchange A[i+<span class="number">1</span>] <span class="keyword">with</span> A[r]</span><br><span class="line">    <span class="keyword">return</span> i+<span class="number">1</span>        // qçš„æœ€ç»ˆä½ç½®</span><br></pre></td></tr></table></figure><p>éšç€åˆ’åˆ†è¿‡ç¨‹çš„è¿›è¡Œï¼Œæ•°ç»„è¢«åˆ’åˆ†æˆ4ä¸ªï¼ˆå¯èƒ½æœ‰ç©ºçš„ï¼‰åŒºåŸŸã€‚åˆ†åˆ«ä¸ºå°äºŽç­‰äºŽxçš„éƒ¨åˆ†ï¼Œå¤§äºŽxçš„éƒ¨åˆ†ï¼Œæœªæ¯”è¾ƒéƒ¨åˆ†ï¼Œå’Œä¸»å…ƒxã€‚å°†è¿™äº›æ€§è´¨ä½œä¸ºå¾ªçŽ¯ä¸å˜é‡ï¼š</p><blockquote><p>åœ¨å¾ªçŽ¯ä½“çš„æ¯ä¸€è½®è¿­ä»£å¼€å§‹æ—¶ï¼Œå¯¹ä»»æ„æ•°ç»„ä¸‹æ ‡kï¼Œæœ‰ï¼š</p><ol type="1"><li>å°äºŽxçš„éƒ¨åˆ†ï¼šè‹¥<span class="math inline">\(p\le{k}\le{i}\)</span>ï¼Œåˆ™<span class="math inline">\(A[k]\le{x}\)</span>ã€‚</li><li>å¤§äºŽxçš„éƒ¨åˆ†ï¼šè‹¥<span class="math inline">\(i+1\le{k}\le{j-1}\)</span>ï¼Œåˆ™<span class="math inline">\(A[k]\ge{x}\)</span>ã€‚</li><li>ç­‰äºŽxçš„éƒ¨åˆ†ï¼šè‹¥k=rï¼Œåˆ™A[k]=xã€‚</li></ol></blockquote><p>ä¸Šè¿°åæ ‡ä¹‹å¤–çš„åŒºåŸŸ<code>A[j...r-1]</code>å¯¹åº”ä¸ºæ¯”è¾ƒéƒ¨åˆ†ã€‚Lomutoåˆ’åˆ†çš„ä¸€ä¸ªç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p>æ•°ç»„çš„å››ä¸ªéƒ¨åˆ†åˆ†åˆ«æ˜¯ (å°äºŽä¸»å…ƒçš„å…ƒç´ ) (å¤§äºŽç­‰äºŽä¸»å…ƒçš„å…ƒç´ ) (æœªåˆ’åˆ†å…ƒç´ ) (ä¸»å…ƒ)ã€‚</p><table><thead><tr class="header"><th><code>array[p...r]</code></th><th>A[i]</th><th>A[j]</th></tr></thead><tbody><tr class="odd"><td>() () (2871356) (4)</td><td>nullï¼ˆi=p-1ï¼‰</td><td>2</td></tr><tr class="even"><td>x=array[r]=4</td><td></td><td>2&lt;4ï¼Œi=i+1; exchange 2 with 2; j=j+1</td></tr><tr class="odd"><td>(2) () (871356) (4)</td><td>2</td><td>8</td></tr><tr class="even"><td></td><td></td><td>8&gt;=4ï¼Œj=j+1</td></tr><tr class="odd"><td>(2) (8) (71356) (4)</td><td>2</td><td>7</td></tr><tr class="even"><td></td><td></td><td>7&gt;=4ï¼Œj=j+1</td></tr><tr class="odd"><td>(2) (87) (1356) (4)</td><td>2</td><td>1</td></tr><tr class="even"><td></td><td></td><td>1&lt;4ï¼Œi=i+1; exchange 8 with 1; j=j+1</td></tr><tr class="odd"><td>(21) (78) (356) (4)</td><td>1</td><td>3</td></tr><tr class="even"><td></td><td></td><td>3&lt;4ï¼Œi=i+1; exchange 7 with 3; j=j+1</td></tr><tr class="odd"><td>(213) (87) (56) (4)</td><td>3</td><td>5</td></tr><tr class="even"><td></td><td></td><td>5&gt;=4ï¼Œj=j+1</td></tr><tr class="odd"><td>(213) (875) (6) (4)</td><td>3</td><td>6</td></tr><tr class="even"><td></td><td></td><td>6&gt;=4ï¼Œj=j+1</td></tr><tr class="odd"><td>(213) (8756) () (4)</td><td>3</td><td>4</td></tr><tr class="even"><td></td><td></td><td>j==rï¼Œé€€å‡ºå¾ªçŽ¯ï¼Œexchange 8 with 4</td></tr><tr class="odd"><td>213 4 7568</td><td>3</td><td>return i+1ï¼Œæ˜¯ä¸»å…ƒä½ç½®</td></tr></tbody></table><h2 id="hoareåˆ’åˆ†">Hoareåˆ’åˆ†</h2><p>Hoareåˆ’åˆ†æ¯”Lomutoåˆ’åˆ†æ›´åŠ é«˜æ•ˆã€‚åœ¨é€‰æ‹©äº†ä¸»å…ƒä¹‹åŽï¼Œå®ƒä½¿ç”¨ä¸¤ä¸ªä¸‹æ ‡iå’Œjï¼Œiä»Žå‰å¾€åŽã€jä»ŽåŽå¾€å‰ç§»åŠ¨ã€‚å½“æ‰¾åˆ°<span class="math inline">\(A[i]\ge{x}\)</span>ã€<span class="math inline">\(A[j]\le{x}\)</span>ä¸”i&lt;jçš„ä¸¤ä¸ªåæ ‡iå’Œjä¹‹åŽï¼Œäº¤æ¢å®ƒä»¬çš„å…ƒç´ ã€‚å½“iå’Œjç›¸é‡ï¼ˆ<span class="math inline">\(i\ge{j}\)</span>ï¼‰åŽï¼Œåˆ’åˆ†è¿‡ç¨‹åœæ­¢ã€‚å¹³å‡æƒ…å†µä¸‹ï¼ŒHoareåˆ’åˆ†æ¯”Lomutoåˆ’åˆ†å°‘3æ¬¡äº¤æ¢æ¬¡æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hoare_partition(A, p, r):</span><br><span class="line">    x = A[r]                           <span class="comment"># æœ€åŽä¸€ä¸ªå…ƒç´ ä½œä¸ºä¸»å…ƒ</span></span><br><span class="line">    i = p</span><br><span class="line">    j = r - <span class="number">1</span>                          <span class="comment"># æœ€åŽä¸€ä½æ˜¯ä¸»å…ƒ</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">while</span> i &lt; r <span class="keyword">and</span> A[i] &lt;= x:     <span class="comment"># æ‰¾åˆ°å¤§äºŽä¸»å…ƒçš„å…ƒç´ æˆ–i=rï¼ˆä¸»å…ƒçš„ä½ç½®ï¼‰æ—¶åœæ­¢</span></span><br><span class="line">            i = i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> j &gt;= p <span class="keyword">and</span> A[j] &gt;=x:     <span class="comment"># æ‰¾åˆ°å°äºŽä¸»å…ƒçš„å…ƒç´ æˆ–j&lt;pï¼ˆè¶…å‡ºäº†è¾¹ç•Œï¼‰æ—¶åœæ­¢</span></span><br><span class="line">            j = j<span class="number">-1</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; j:                      <span class="comment"># iä¸Žjç›¸é‡ï¼Œiæ˜¯ä¸»å…ƒåº”å¤„çš„ä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> i != r:</span><br><span class="line">                swap A[i] <span class="keyword">with</span> A[r]</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        swap A[i] <span class="keyword">with</span> A[j]</span><br></pre></td></tr></table></figure><p>Hoareåˆ’åˆ†çš„ä¸€ä¸ªç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p>æ•°ç»„çš„å››ä¸ªéƒ¨åˆ†åˆ†åˆ«æ˜¯ (å°äºŽç­‰äºŽä¸»å…ƒçš„å…ƒç´ ) (æœªåˆ’åˆ†å…ƒç´ ) (å¤§äºŽç­‰äºŽä¸»å…ƒçš„å…ƒç´ ) (ä¸»å…ƒ)ã€‚</p><table><thead><tr class="header"><th></th><th><code>array[p...r]</code></th><th>A[i]</th><th>A[j]</th></tr></thead><tbody><tr class="odd"><td>åˆå§‹</td><td>() (2871356) () (4)</td><td>2</td><td>6</td></tr><tr class="even"><td>å¯»æ‰¾ä¸‹ä¸€å¯¹äº¤æ¢å…ƒç´ </td><td>ä¸»å…ƒx=4</td><td>8</td><td>3ï¼Œäº¤æ¢</td></tr><tr class="odd"><td>ç»§ç»­å¯»æ‰¾</td><td>(23) (71) (856) (4)</td><td>7</td><td>1ï¼Œäº¤æ¢</td></tr><tr class="even"><td>ç»§ç»­å¯»æ‰¾</td><td>(231) () (7856) (4)</td><td>7</td><td>1ï¼Œç›¸é‡ï¼Œäº¤æ¢A[i]ä¸Žä¸»å…ƒï¼Œreturn i</td></tr><tr class="odd"><td></td><td>231 4 8567</td><td>4</td><td>7</td></tr></tbody></table><h2 id="ä¸»å…ƒçš„é€‰æ‹©">ä¸»å…ƒçš„é€‰æ‹©</h2><p>ä¸è®ºLomutoåˆ’åˆ†è¿˜æ˜¯Hoareåˆ’åˆ†ï¼Œä¸»å…ƒçš„é€‰æ‹©æ–¹å¼éƒ½ä¼šç›´æŽ¥å½±å“åˆ°åˆ’åˆ†ç»“æžœã€‚ä¾‹å¦‚ä¸Šè¿°Hoareåˆ’åˆ†è¿‡ç¨‹çš„ç¤ºä¾‹ï¼Œè‹¥é€‰æ‹©ä¸»å…ƒx=1ï¼Œæ­£å¥½æ˜¯æ•°ç»„ä¸­æœ€å°çš„å…ƒç´ ï¼Œåˆ’åˆ†è¿‡ç¨‹å¾ˆå¿«å°±ç»“æŸï¼Œå¹¶äº§ç”Ÿäº†ä¸¤ä¸ªé•¿åº¦ç›¸å·®è¾ƒå¤§çš„å­æ•°ç»„[1]å’Œ[2, 8, 7, 2, 3, 5, 6, 4]ã€‚åŒç†è‹¥æ­£å¥½é€‰æ‹©äº†æœ€å¤§çš„å…ƒç´ ï¼Œä¹Ÿä¼šäº§ç”Ÿç±»ä¼¼çš„ç»“æžœã€‚ç§°è¿™ç§åˆ’åˆ†ä¸ºä¸å¹³è¡¡åˆ’åˆ†ï¼ˆUnbalanced partitioningï¼‰ã€‚</p><p>åœ¨Lomutoåˆ’åˆ†ä¸­ï¼Œæ€»æ˜¯é€‰æ‹©æœ€å³ä¾§å…ƒç´ ä½œä¸ºä¸»å…ƒã€‚è‹¥è¾“å…¥æ•°ç»„æ˜¯å·²æŽ’åºçš„ï¼ŒæŽ’åºç®—æ³•å°†æ€»æ˜¯äº§ç”Ÿä¸å¹³è¡¡åˆ’åˆ†ï¼Œè§¦å‘æœ€åæƒ…å†µã€‚å¹¸è¿çš„æ˜¯ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›ç­–ç•¥æ¥ä¼˜åŒ–ï¼Œä½¿å¾—å¯¹ä»»ä½•è¾“å…¥éƒ½æ¯”è¾ƒå¥½ã€‚ä¾‹å¦‚éšæœºé€‰æ‹©ï¼ŒåŽæ–‡å°†åˆ†æžéšæœºé€‰æ‹©ä¸»å…ƒçš„å¿«é€ŸæŽ’åºçš„æœŸæœ›è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(O(n\log{n})\)</span>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">random(A, left, right):</span><br><span class="line">    select an integer i <span class="keyword">in</span> [left, right] randomly</span><br><span class="line">    <span class="keyword">if</span> i != right:</span><br><span class="line">        swap A[i] <span class="keyword">with</span> A[right]</span><br><span class="line">    <span class="keyword">return</span> A[right]</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ¨¡å¼ï¼šé€‰æ‹©å·¦ä¸­å³å…ƒç´ çš„ä¸­ä½æ•°ï¼ˆMedian-of-threeï¼Œmo3ï¼‰ã€‚éšæœºé€‰æ‹©æ¨¡å¼ä¸‹ï¼Œå¿«é€ŸæŽ’åºçš„æ¯”è¾ƒæ¬¡æ•°çš„æœŸæœ›æ˜¯<span class="math inline">\(1.386n\log{n}\)</span>ï¼Œmo3æ¨¡å¼ä¸‹ï¼ŒæœŸæœ›å¯ä¸‹é™è‡³<span class="math inline">\(1.188n\log{n}\)</span>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">median_of_three(A, left, right):</span><br><span class="line">    mid = (left + right) / <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> A[mid] &lt; A[left]:</span><br><span class="line">        swap A[left] <span class="keyword">with</span> A[mid]    <span class="comment"># A[left] &lt;= A[mid]</span></span><br><span class="line">    <span class="keyword">if</span> A[right] &lt; A[left]:</span><br><span class="line">        swap A[left] <span class="keyword">with</span> A[right]  <span class="comment"># A[left] &lt;= A[right]</span></span><br><span class="line">    <span class="keyword">if</span> A[mid] &lt; A[right]:</span><br><span class="line">        swap A[mid] <span class="keyword">with</span> A[right]   <span class="comment"># A[right] &lt;= A[mid]</span></span><br><span class="line">    pivot = A[right]</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œä½¿å¾—<span class="math inline">\(A[mid]\ge{A[right]}\ge{A[left]}\)</span>ï¼Œæ­¤æ—¶å†é€‰æ‹©æœ€å³ä¾§å…ƒç´ ï¼Œå®žé™…ä¸Šæ˜¯å·¦ä¸­å³å…ƒç´ çš„ä¸­ä½æ•°ã€‚å½“è¾“å…¥æ•°ç»„çš„æŽ’åºæƒ…å†µæœªçŸ¥æ—¶ï¼Œç›¸æ¯”æ€»æ˜¯ç›´æŽ¥é€‰æ‹©å·¦å³ä¾§å…ƒç´ ï¼Œè¯¥æ–¹æ³•æ€§èƒ½æ›´å¥½ã€‚å¯¹äºŽæ›´é•¿çš„æ•°ç»„ï¼Œå¯ä»¥æ‰©å±•mo3è§„åˆ™è‡³æ›´å¼ºçš„nintherã€‚</p><p><code>ninther(A)=middle(mo3(first 1/3 of A), mo3(middle 1/3 of A), mo3(final 1/3 of A))</code></p><p><strong>æ³¨æ„</strong>ï¼šmid = (left + right) / 2å¯èƒ½ä¼šå‘ç”Ÿè¶Šç•Œæƒ…å†µï¼ˆæ²¡æžæ‡‚ï¼‰ï¼Œå¯ä»¥ç”¨mid = left + (right - left) / 2æ¥ä»£æ›¿ã€‚</p><h1 id="åˆ†æž">åˆ†æž</h1><h2 id="æœ€åæƒ…å†µ">æœ€åæƒ…å†µ</h2><p>ä»¥Lomutoåˆ’åˆ†ä¸ºä¾‹ï¼Œå½“åˆ’åˆ†æ“ä½œæ€»æ˜¯å¾—åˆ°ä¸€ä¸ªå¤§å°ä¸º0ã€å¦ä¸€ä¸ªå¤§å°ä¸ºn-1çš„æ•°ç»„æ—¶ï¼ˆè¿˜æœ‰ä¸€ä¸ªå…ƒç´ æ˜¯ä¸»å…ƒï¼‰ï¼Œå‡è®¾T(n)æ˜¯quicksortåœ¨è¾“å…¥è§„æ¨¡ä¸ºnçš„æ•°æ®é›†åˆä¸Šæ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œåˆ™æœ‰é€’å½’å¼ï¼š</p><p><span class="math display">\[T(n)=T(0)+T(n-1)+\Theta(n)\]</span></p><p>é€’å½’æ ‘æ·±åº¦ä¸ºnï¼Œå®¹æ˜“å¾—åˆ°<span class="math inline">\(T(n)=O(n^2)\)</span>ã€‚</p><p>åˆ©ç”¨ä»£å…¥æ³•è¯æ˜Žï¼š</p><p><span class="math display">\[T(n)=\max_{0\le{q}\le{n-1}}(T(q)+T(n-q-1)+\Theta(n))\]</span></p><p>qå’Œn-q-1åˆ†åˆ«æ˜¯ä¸¤ä¸ªå­æ•°ç»„çš„è§„æ¨¡ã€‚è®¾<span class="math inline">\(T(n)\le{cn^2}\)</span>æˆç«‹ï¼Œå°†å…¶å¸¦å…¥ä¸Šå¼ <span class="math display">\[\begin{aligned}T(n)&amp;\le{\max_{0\le{q}\le{n-1}}(cq^2+c(n-q-1)^2)+\Theta(n)}\\&amp;=c\max_{0\le{q}\le{n-1}}(q^2+(n-q-1)^2)+\Theta(n)\end{aligned}\]</span></p><p><span class="math inline">\(q^2+(n-q-1)^2\le(n-1)^2=n^2-2n+1\)</span>ï¼ˆåœ¨ç«¯ç‚¹å¤„å–å¾—æœ€å¤§å€¼ï¼‰ï¼Œå°†å…¶å¸¦å…¥ä¸Šå¼ï¼Œå¾—åˆ°</p><p><span class="math display">\[T(n)\le{cn^2-c(2n-1)+\Theta(n)}\le{cn^2}\]</span></p><p><span class="math inline">\(\therefore{T(n)=O(n^2)}\)</span>ã€‚</p><h2 id="æœ€ä½³æƒ…å†µ">æœ€ä½³æƒ…å†µ</h2><p>è‹¥åˆ’åˆ†æ“ä½œæ€»æ˜¯å¾—åˆ°ä¸¤ä¸ªè§„æ¨¡ç›¸ç­‰çš„å­æ•°ç»„æ—¶ï¼Œè§¦å‘æœ€ä½³æƒ…å†µã€‚</p><p><span class="math display">\[T(n)=2T(\frac{n}{2})+\Theta(n)\]</span></p><p>é€’å½’æ ‘æ·±åº¦ä¸º<span class="math inline">\(\log_2{n}\)</span>ï¼Œå¯å¾—<span class="math inline">\(T(n)=O(n\log(n))\)</span>ã€‚</p><h2 id="å¹³å‡æƒ…å†µ">å¹³å‡æƒ…å†µ</h2><p>å¯¹äºŽè§„æ¨¡ä¸ºnçš„æ— é‡å¤å…ƒç´ çš„æ•°ç»„ï¼Œè‹¥ä¸»å…ƒçš„é€‰æ‹©æ˜¯ç‹¬ç«‹ä¸”éšæœºçš„ï¼Œåˆ™å¿«é€ŸæŽ’åºçš„æœŸæœ›è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(O(n\log(n))\)</span>ã€‚</p><p>è¯æ˜Žï¼š</p><p>è€ƒè™‘è¾“å…¥æ•°ç»„çš„ä¸€ä¸ªéšæœºåºåˆ—<span class="math inline">\((x_1,x_2,...,x_n)\)</span>ï¼Œå®šä¹‰Cè¡¨ç¤ºæ¯”è¾ƒæ¬¡æ•°ï¼Œ<span class="math inline">\(c_{ij}\)</span>ä¸ºæŒ‡ç¤ºå™¨éšæœºå˜é‡ã€‚æœ‰</p><p><span class="math display">\[c_{ij}=\begin{cases}1&amp;x_iä¸Žx_jå‘ç”Ÿæ¯”è¾ƒ\\0&amp;x_iä¸Žx_jä¸å‘ç”Ÿæ¯”è¾ƒ&amp;&amp;\end{cases}C=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}c_{i,j}\]</span></p><p>å¯¹Cå–æœŸæœ›ï¼Œæœ‰</p><p><span class="math display">\[E[C]=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}E(c_{ij})=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}Pr(c_{ij})\]</span></p><p>åœ¨åˆ’åˆ†æ“ä½œä¸­ï¼Œåªæœ‰ä¸»å…ƒä¼šä¸Žå…¶ä»–å…ƒç´ å‘ç”Ÿæ¯”è¾ƒï¼Œå› æ­¤</p><p><span class="math display">\[Pr(c_{ij})=Pr(x_i\text{æˆ–}x_j\text{è¢«é€‰ä¸ºä¸»å…ƒ)}\]</span></p><p>åœ¨ä¸€æ¬¡åˆ’åˆ†ä¸­ï¼Œ<span class="math inline">\(x_i\)</span>ä¸Ž<span class="math inline">\(x_j\)</span>ä¸å¯èƒ½åŒæ—¶è¢«é€‰ä¸ºä¸»å…ƒï¼Œä¸”ä¸»å…ƒçš„é€‰æ‹©æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤</p><p><span class="math display">\[Pr(c_{ij})=2*Pr(x_iè¢«é€‰ä¸ºä¸»å…ƒ)=\frac{2}{j-i+1}\]</span></p><p>ä»¤<span class="math inline">\(k=j-i\)</span>ï¼Œä»£å…¥<span class="math inline">\(E[C]\)</span>å¾—</p><p><span class="math display">\[\begin{aligned}E[C]&amp;=\sum_{i=1}^{n-1}\sum_{j=i+1}^{n}\frac{2}{j-i+1}\\&amp;=\sum_{i=1}^{n-1}\sum_{k=1}^{n-i}\frac{2}{k+1}\\&amp;&lt;\sum_{i=1}^{n-1}\sum_{k=1}^{n}\frac{2}{k}\\&amp;=\sum_{i=1}^{n-1}O(\log{n})\\&amp;=O(n\log{n})\end{aligned}\]</span></p><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exchange</span><span class="params">(a, i, j)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> i != j:</span><br><span class="line">        a[i], a[j] = a[j], a[i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">median_of_three</span><span class="params">(a, left, right)</span>:</span></span><br><span class="line">    <span class="string">"""é€‰æ‹©å·¦ä¸­å³ä¸‰å…ƒç´ çš„ä¸­ä½æ•°ä½œä¸ºpivot"""</span></span><br><span class="line">    mid = left + (right - left) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> a[mid] &lt; a[left]:</span><br><span class="line">        exchange(a, left, mid)  <span class="comment"># now: a[left] &lt;= a[mid]</span></span><br><span class="line">    <span class="keyword">if</span> a[right] &lt; a[left]:</span><br><span class="line">        exchange(a, left, right)  <span class="comment"># now: a[left] &lt;= a[right]</span></span><br><span class="line">    <span class="keyword">if</span> a[mid] &lt; a[right]:</span><br><span class="line">        exchange(a, mid, right)  <span class="comment"># now: a[right] &lt;= a[mid]</span></span><br><span class="line">    <span class="comment"># now: a[left&#125; &lt;= a[right] &lt;= a[mid]</span></span><br><span class="line">    <span class="keyword">return</span> right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hoare_partition</span><span class="params">(a, left, right)</span>:</span></span><br><span class="line">    <span class="string">"""Hoare's scheme is more efficient than Lomuto's partition scheme</span></span><br><span class="line"><span class="string">    because it does three times fewer swaps on average."""</span></span><br><span class="line">    pivot, i, j = a[right], left, right - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">while</span> i &lt; right <span class="keyword">and</span> a[i] &lt;= pivot:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> j &gt;= left <span class="keyword">and</span> a[j] &gt;= pivot:</span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; j:  <span class="comment"># i, j ç›¸é‡</span></span><br><span class="line">            exchange(a, i, right)</span><br><span class="line">            <span class="keyword">return</span> i  <span class="comment"># pivotä½ç½®</span></span><br><span class="line">        exchange(a, i, j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lomuto_partition</span><span class="params">(a, left, right)</span>:</span></span><br><span class="line">    pivot, i = a[right], left</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(left, right):</span><br><span class="line">        <span class="keyword">if</span> a[j] &lt; pivot:  <span class="comment"># å°äºŽpivotçš„å…ƒç´ è¢«åˆ’åˆ†åˆ°å·¦è¾¹ï¼Œå¤§äºŽç­‰äºŽpivotçš„å…ƒç´ è¢«åˆ’åˆ†åˆ°å³è¾¹</span></span><br><span class="line">            exchange(a, i, j)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">    exchange(a, i, right)</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">q_sort</span><span class="params">(a, left, right)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> left &lt; right:</span><br><span class="line">        p_idx = random.randint(left, right)  <span class="comment"># éšæœºé€‰æ‹©pivot</span></span><br><span class="line">        <span class="comment"># p_idx = median_of_three(a, left, right)  # é€‰æ‹©å·¦ä¸­å³å…ƒç´ çš„ä¸­ä½æ•°</span></span><br><span class="line">        q = partition(a, left, right, p_idx)</span><br><span class="line">        q_sort(a, left, q - <span class="number">1</span>)</span><br><span class="line">        q_sort(a, q + <span class="number">1</span>, right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(a, left, right, p_idx)</span>:</span>  <span class="comment"># å¢žåŠ å‚æ•°ï¼Œp_idxæŒ‡ç¤ºæ‰€ç”¨ä¸»å…ƒåœ¨æ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> p_idx &lt; left <span class="keyword">or</span> p_idx &gt; right:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"ä¸»å…ƒä½ç½®è¶Šç•Œ"</span>)</span><br><span class="line">    exchange(a, p_idx, right)</span><br><span class="line">    <span class="keyword">return</span> hoare_partition(a, left, right)</span><br><span class="line">    <span class="comment"># return lomuto_partition(a, left, right)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quick_sort</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="string">"""æŽ’åºæ•´ä¸ªåˆ—è¡¨"""</span></span><br><span class="line">    q_sort(a, <span class="number">0</span>, len(a) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">16</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">15</span>]</span><br><span class="line">    quick_sort(arr)</span><br><span class="line">    print(arr)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> sort </tag>
            
            <tag> algorithms </tag>
            
            <tag> comparison sort </tag>
            
            <tag> divide and conquer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½’å¹¶æŽ’åº</title>
      <link href="/notes/introduction-to-algorithms/merge-sort/"/>
      <url>/notes/introduction-to-algorithms/merge-sort/</url>
      
        <content type="html"><![CDATA[<h1 id="å½’å¹¶æŽ’åº">å½’å¹¶æŽ’åº</h1><p>å½’å¹¶æŽ’åºï¼ˆMerge sortï¼‰æ˜¯ä¸€ç§æ¯”è¾ƒé«˜æ•ˆçš„æ¯”è¾ƒåž‹æŽ’åºç®—æ³•ï¼Œç”±<a href="https://en.wikipedia.org/wiki/John_von_Neumann" target="_blank" rel="noopener">John von Neumann</a>äºŽ1945å¹´æå‡ºã€‚å½’å¹¶æŽ’åºç®—æ³•æ˜¯è¿ç”¨åˆ†æ²»ç­–ç•¥ï¼ˆDivide-and-conquerï¼‰çš„å…¸åž‹ç®—æ³•ï¼Œå®ƒæœ‰è®¸å¤šä¸­ä¸åŒçš„å®žçŽ°ï¼Œä¸”å¤§å¤šæ•°å®žçŽ°æ˜¯ç¨³å®šæŽ’åºã€‚å½’å¹¶æŽ’åºçš„ç¤ºæ„å›¾ï¼ˆå‡ºè‡ª<a href="https://en.wikipedia.org/wiki/Merge_sort#Top-down_implementation_using_lists" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘ï¼šMerge sort</a>ï¼‰å¦‚ä¸‹ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Merge-sort-example-300px.gif/220px-Merge-sort-example-300px.gif" title="å½’å¹¶æŽ’åºåŠ¨æ€ç¤ºæ„å›¾"></p><a id="more"></a><h1 id="å®žçŽ°">å®žçŽ°</h1><p>å½’å¹¶æŽ’åºåœ¨æ¯å±‚é€’å½’æ—¶æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼ˆéµå¾ªåˆ†æ²»æ¨¡å¼ï¼‰ï¼š</p><ul><li><p>åˆ†è§£ï¼ˆDivideï¼‰ï¼šåˆ†è§£å¾…æŽ’åºçš„nä¸ªå…ƒç´ çš„åºåˆ—æˆå„å±€n/2ä¸ªå…ƒç´ çš„ä¸¤ä¸ªå­åºåˆ—ã€‚</p></li><li><p>è§£å†³ï¼ˆConquerï¼‰ï¼šä½¿ç”¨å½’å¹¶æŽ’åºé€’å½’åœ°æŽ’åºä¸¤ä¸ªå­åºåˆ—ã€‚</p></li><li><p>åˆå¹¶ï¼ˆCombineï¼‰ï¼šåˆå¹¶ä¸¤ä¸ªå·²æŽ’åºçš„å­åºåˆ—ä»¥äº§ç”Ÿå·²æŽ’åºçš„ç­”æ¡ˆã€‚</p></li></ul><h2 id="åˆå¹¶">åˆå¹¶</h2><p>åˆå¹¶è¿‡ç¨‹æ˜¯å½’å¹¶æŽ’åºçš„å…³é”®æ“ä½œã€‚é€šè¿‡è°ƒç”¨ä¸€ä¸ªè¾…åŠ©è¿‡ç¨‹merge(A, p, q, r)æ¥å®Œæˆï¼Œå…¶ä¸­Aæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œpã€qå’Œræ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œæ»¡è¶³<span class="math inline">\(p\le{q}&lt;r\)</span>ã€‚å‡è®¾å­æ•°ç»„<code>A[p...q]</code>å’Œ<code>A[q+1...r]</code>éƒ½å·²ç»æŽ’å¥½åºã€‚è¯¥è¿‡ç¨‹åˆå¹¶è¿™ä¸¤ä¸ªå­æ•°ç»„å½¢æˆå•ä¸€çš„å·²æŽ’å¥½åºçš„æ•°ç»„æ¥ä»£æ›¿å½“å‰çš„æ•°ç»„<code>A[p...r]</code>ã€‚</p><p>åˆå¹¶æ—¶éœ€è¦æ³¨æ„è¦æ—¶åˆ»åˆ¤æ–­ä¸¤ä¸ªå­æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œå½“æŸä¸ªå­æ•°ç»„ä¸ºç©ºæ—¶ï¼Œåˆ™æ— éœ€æ¯”è¾ƒï¼Œåªéœ€è¦å°†å¦ä¸€ä¸ªå­æ•°ç»„ä¸­çš„å…ƒç´ å–å‡ºå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">merge(A, p, q, r):</span><br><span class="line">    åˆ›å»ºæ–°æ•°ç»„B[<span class="number">0.</span>.r-p]</span><br><span class="line">    å°†A[p..r]å¤åˆ¶åˆ°B[<span class="number">0.</span>.r-p]</span><br><span class="line">    i = p</span><br><span class="line">    j = q</span><br><span class="line">    <span class="keyword">for</span> k = p to r:</span><br><span class="line">        <span class="keyword">if</span> i &lt; q <span class="keyword">and</span> (j &gt;= r <span class="keyword">or</span> B[i] &lt;= B[j]):  <span class="comment"># ç”¨ i &lt; q å’Œ j &gt;=r æ—¶åˆ»åˆ¤æ–­éžç©º</span></span><br><span class="line">            A[k] = B[i]</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            A[k] = B[j]</span><br><span class="line">            j = j + <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…æ¯æ¬¡æ£€æŸ¥éžç©ºä»¥ç®€åŒ–ä»£ç ï¼Œå¯ä»¥é€šè¿‡åœ¨å­æ•°ç»„æœ«å°¾æ”¾ç½®ä¸€ä¸ªå“¨å…µï¼ˆsentinelï¼‰å…ƒç´ ã€‚ä½¿ç”¨<span class="math inline">\(\infty\)</span>ä½œä¸ºå“¨å…µå…ƒç´ çš„å€¼ã€‚å½“æœ‰æ•ˆæ•°ç»„å…ƒç´ ä¸ºç©ºæ—¶ï¼Œå“¨å…µå…ƒç´ æ˜¾éœ²å‡ºæ¥ï¼Œå®ƒä¸å¯èƒ½å°äºŽå…¶ä»–éžå“¨å…µå…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">merge(A, p, q, r):</span><br><span class="line">    <span class="comment"># --------å‡†å¤‡å·¥ä½œ-------------</span></span><br><span class="line">    åˆ›å»ºä¸¤ä¸ªæ–°æ•°ç»„L[<span class="number">0.</span>.p-q+<span class="number">1</span>]å’ŒR[<span class="number">0.</span>.r-q]</span><br><span class="line">    å°†A[p..q]å¤åˆ¶åˆ°L[<span class="number">0.</span>.p-q]</span><br><span class="line">    å°†B[q+<span class="number">1.</span>.r]å¤åˆ¶åˆ°R[<span class="number">0.</span>.r-q<span class="number">-1</span>]</span><br><span class="line">    L[p-q+<span class="number">1</span>] = inf</span><br><span class="line">    R[r-q] = inf</span><br><span class="line">    <span class="comment"># -----------end--------------------</span></span><br><span class="line">    <span class="comment"># ---------æ¯”è¾ƒ------------</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k = p to r:</span><br><span class="line">        <span class="keyword">if</span> L[i] &lt; R[j]:</span><br><span class="line">            A[k] = L[i]</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            A[k] = R[j]</span><br><span class="line">            j = j + <span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="è‡ªé¡¶å‘ä¸‹çš„å®žçŽ°">è‡ªé¡¶å‘ä¸‹çš„å®žçŽ°</h2><p>è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æŽ’åºé€’å½’åœ°å°†åºåˆ—åˆ†è§£æˆå­åºåˆ—ï¼Œç›´åˆ°å­åºåˆ—åªæœ‰1ä¸ªå…ƒç´ ã€‚å½“å¾…æŽ’åºçš„åºåˆ—é•¿åº¦ä¸º1æ—¶ï¼Œé€’å½’â€œå¼€å§‹å›žå‡â€ï¼Œæ­¤æ—¶æ— éœ€åˆå¹¶ï¼Œå› ä¸ºé•¿åº¦ä¸º1çš„æ¯ä¸ªåºåˆ—æ˜¯å·²æŽ’åºçš„ã€‚ä¹‹åŽåˆå¹¶è¿™äº›å­åºåˆ—ç”Ÿæˆå·²æŽ’åºçš„åºåˆ—ã€‚ä¸Šè¿°ç¤ºæ„å›¾æè¿°çš„å°±æ˜¯è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æŽ’åºç®—æ³•çš„æŽ’åºè¿‡ç¨‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">merge_sort_top_down(A, p, r):</span><br><span class="line">    <span class="keyword">if</span> p &lt; r:    <span class="comment"># å½“å…ƒç´ ä¸ªæ•°å¤§äºŽ1æ—¶</span></span><br><span class="line">        q = (p + q) / <span class="number">2</span></span><br><span class="line">        merge_sort_top_down(A, p, q)</span><br><span class="line">        merge_sort_top_down(A, q + <span class="number">1</span>, r)</span><br><span class="line">        merge(A, p, q, r)</span><br></pre></td></tr></table></figure><h2 id="è‡ªåº•å‘ä¸Šçš„å®žçŽ°">è‡ªåº•å‘ä¸Šçš„å®žçŽ°</h2><p>è‡ªåº•å‘ä¸Šçš„å½’å¹¶æŽ’åºå°†åŽŸæ•°ç»„è§†ä¸ºnä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„ï¼Œç„¶åŽä¾æ¬¡åˆå¹¶ä¸¤ä¸ªç›¸é‚»å­æ•°ç»„ï¼Œå¾—åˆ°é•¿åº¦ä¸º2ï¼Œ4ï¼Œ6.â€¦çš„å·²æŽ’åºæ•°ç»„ï¼Œç›´åˆ°æ•´ä¸ªæ•°ç»„ã€‚è‡ªåº•å‘ä¸Šçš„å½’å¹¶æŽ’åºçš„æŽ’åºè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">input:  6  5  3  1  8  7  2  4</span><br><span class="line">1st:    56  31  78  24</span><br><span class="line">2nd:    1356  2478</span><br><span class="line">3rd:    12345678</span><br></pre></td></tr></table></figure><hr><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">merge_sort_bottom_up(A):</span><br><span class="line">    n = A.length</span><br><span class="line">    <span class="keyword">for</span> (width = <span class="number">1</span>; width &lt; n; width = <span class="number">2</span> * width):</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i = i + <span class="number">2</span> * width):</span><br><span class="line">            merge(A, i, min(i + width, n) - <span class="number">1</span>, min(i + <span class="number">2</span> * width, n) - <span class="number">1</span>)  <span class="comment"># åˆå¹¶ç›¸é‚»æ•°ç»„</span></span><br></pre></td></tr></table></figure><h1 id="è‡ªç„¶å½’å¹¶æŽ’åº">è‡ªç„¶å½’å¹¶æŽ’åº</h1><p>è‡ªç„¶å½’å¹¶æŽ’åºï¼ˆNatural merge sortï¼‰ç±»ä¼¼äºŽè‡ªåº•å‘ä¸Šçš„å½’å¹¶æŽ’åºã€‚è‡ªåº•å‘ä¸Šçš„å½’å¹¶æŽ’åºçš„å‡ºå‘ç‚¹æ˜¯1ï¼ˆå°†é•¿åº¦ä¸ºnçš„æ•°ç»„è§†ä¸ºnä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„ï¼Œè¿™nä¸ªå­æ•°ç»„æ˜¯å·²æŽ’åºçš„ï¼‰ã€‚è€Œè¾“å…¥æ•°ç»„å¯èƒ½åŒ…å«å·²æŽ’åºçš„å­æ•°ç»„ï¼Œè¿™äº›å­æ•°ç»„å¯é€šè¿‡ä¸€ééåŽ†æ‰¾å‡ºã€‚è‡ªç„¶å½’å¹¶æŽ’åºå°†ä¾æ¬¡åˆå¹¶è¿™äº›å­æ•°ç»„ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Start:          3421758906</span><br><span class="line">Select runs:    34  2  17  589  06</span><br><span class="line">Merge:          234  15789  06</span><br><span class="line">Merge:          12345789  06</span><br><span class="line">Merge:          0123456789</span><br></pre></td></tr></table></figure><h1 id="åˆ†æž">åˆ†æž</h1><p>åˆå¹¶è¿‡ç¨‹åªéœ€è¦ä¸€æ¬¡éåŽ†å³å¯å®Œæˆï¼Œè¿è¡Œæ—¶é—´æ˜¯<span class="math inline">\(\Theta(n)\)</span>ï¼Œnæ˜¯åˆå¹¶åŽæ•°ç»„çš„é•¿åº¦ã€‚å½’å¹¶æŽ’åºçš„<strong>å¹³å‡</strong>å’Œ<strong>æœ€å</strong>æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯<span class="math inline">\(O(n\lg{n})\)</span>ã€‚</p><p>è®¾T(n)ä¸ºå½’å¹¶æŽ’åºå¯¹é•¿åº¦ä¸ºnçš„æ•°ç»„è¿›è¡ŒæŽ’åºçš„è¿è¡Œæ—¶é—´ï¼Œåˆ™å½’å¹¶æŽ’åºçš„æ—¶é—´å¤æ‚åº¦å¯ä»¥æè¿°ä¸º<span class="math inline">\(T(n)=2T(n/2)+\Theta(n)\)</span>ã€‚å¯è§£å¾—<span class="math inline">\(T(n)=O(n\lg{n})\)</span>ã€‚</p><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_sort_top_down</span><span class="params">(array, p, r)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> p &lt; r:</span><br><span class="line">        q = (p + r) // <span class="number">2</span></span><br><span class="line">        merge_sort_top_down(array, p, q)  <span class="comment"># é€’å½’è°ƒç”¨</span></span><br><span class="line">        merge_sort_top_down(array, q + <span class="number">1</span>, r)  <span class="comment"># é€’å½’è°ƒç”¨</span></span><br><span class="line">        merge(array, p, q, r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge_sort_bottom_up</span><span class="params">(array)</span>:</span></span><br><span class="line">    width, n = <span class="number">1</span>, len(array)</span><br><span class="line">    <span class="keyword">while</span> width &lt; n:</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; n:</span><br><span class="line">            merge(array, i, min(i + width, n) - <span class="number">1</span>, min(i + (width &lt;&lt; <span class="number">1</span>), n) - <span class="number">1</span>)</span><br><span class="line">            i += (width &lt;&lt; <span class="number">1</span>)</span><br><span class="line">        width = width &lt;&lt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(array, p, q, r)</span>:</span></span><br><span class="line">    <span class="string">"""åˆå¹¶array[p..q]ä¸Žarray[q+1..r]"""</span></span><br><span class="line">    left, right = array[p:q + <span class="number">1</span>], array[q + <span class="number">1</span>:r + <span class="number">1</span>]</span><br><span class="line">    left.append(float(<span class="string">"inf"</span>))</span><br><span class="line">    right.append(float(<span class="string">"inf"</span>))</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(p, r + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> left[i] &lt;= right[j]:</span><br><span class="line">            array[k] = left[i]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            array[k] = right[j]</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    arr = [<span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">16</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">7</span>]</span><br><span class="line">    merge_sort_top_down(arr, <span class="number">0</span>, len(arr) - <span class="number">1</span>)</span><br><span class="line">    print(arr)</span><br><span class="line">    arr = [<span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">16</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">7</span>]</span><br><span class="line">    merge_sort_bottom_up(arr)</span><br><span class="line">    print(arr)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1, 2, 3, 4, 7, 8, 9, 10, 14, 16]</span><br><span class="line">[1, 2, 3, 4, 7, 8, 9, 10, 14, 16]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> sort </tag>
            
            <tag> algorithms </tag>
            
            <tag> comparison sort </tag>
            
            <tag> divide and conquer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python åˆ—è¡¨æŽ¨å¯¼</title>
      <link href="/programming/python-list-comprehensions/"/>
      <url>/programming/python-list-comprehensions/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ—è¡¨æŽ¨å¯¼">åˆ—è¡¨æŽ¨å¯¼</h1><p>åˆ—è¡¨æŽ¨å¯¼ï¼ˆList comprehensionsï¼‰æä¾›äº†ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼æ¥åˆ›å»ºé›†åˆã€‚ä¾‹å¦‚åˆ›å»ºä¸€ä¸ªå¹³æ–¹å’Œçš„åˆ—è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>squares = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line"><span class="meta">... </span>    squares.append(x**<span class="number">2</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>squares</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br><span class="line"><span class="comment"># åœ¨å¾ªçŽ¯ç»“æŸåŽï¼Œx ä»ç„¶å­˜åœ¨ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line"><span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨åŒ¿åæ–¹æ³•æ‘†è„±è¿™ç§å‰¯ä½œç”¨ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>squares = list(map(<span class="keyword">lambda</span> y: y**<span class="number">2</span>, range(<span class="number">10</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨åˆ—è¡¨æŽ¨å¯¼ï¼Œä»£ç æ›´åŠ ç®€æ´ï¼Œå¯è¯»æ€§ä¹Ÿæ›´å¥½ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>squares = [z**<span class="number">2</span> <span class="keyword">for</span> z <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br></pre></td></tr></table></figure><h1 id="æ‰©å±•">æ‰©å±•</h1><p>ä¸€ä¸ªåˆ—è¡¨æŽ¨å¯¼è¯­å¥è‡³å°‘è¦æœ‰ä¸€å¯¹å†…å« <code>for</code> è¯­å¥çš„æ‹¬å·ï¼ˆä¾‹å¦‚ <code>[x for x in range(9)]</code>ï¼‰ï¼Œ<code>for</code> è¯­å¥åŽé¢å¯ä»¥è·Ÿå…¶ä»– <code>for</code> æˆ– <code>if</code> è¯­å¥ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[(x, y) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>] <span class="keyword">if</span> x != y]</span><br><span class="line">[(<span class="number">1</span>, <span class="number">4</span>), (<span class="number">1</span>, <span class="number">5</span>), (<span class="number">1</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">5</span>), (<span class="number">2</span>, <span class="number">6</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† for å’Œ if è¯­å¥æŒ‰åºæ‹†å¼€ï¼Œä¸Šè¿°è¯­å¥ç­‰ä»·äºŽ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>combs = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]:</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">if</span> x != y:</span><br><span class="line"><span class="meta">... </span>                    combs.append((x, y))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>combs</span><br><span class="line">[(<span class="number">1</span>, <span class="number">4</span>), (<span class="number">1</span>, <span class="number">5</span>), (<span class="number">1</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">5</span>), (<span class="number">2</span>, <span class="number">6</span>), (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)]</span><br></pre></td></tr></table></figure><h1 id="åµŒå¥—">åµŒå¥—</h1><p>åˆ—è¡¨æŽ¨å¯¼è‡ªèº«å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªå¤šç»´åˆ—è¡¨ã€‚ä¸‹é¢æ˜¯æ±‚è½¬ç½®çŸ©é˜µçš„ä¾‹å­ã€‚</p><a id="more"></a><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">matrix = [</span><br><span class="line">    [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>],</span><br><span class="line">    [<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•1ï¼šä¸¤ä¸ªcomprehensionsåµŒå¥—</span></span><br><span class="line">transposed = [[row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šä¸€ä¸ªcomprehension</span></span><br><span class="line">transposed = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    transposed.append([row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3ï¼šåŽŸç”Ÿ</span></span><br><span class="line">transposed = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    transposed_row = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> matrix:</span><br><span class="line">        transposed_row.append(row[i])</span><br><span class="line">    transposed.append(transposed_row)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®žé™…ä½¿ç”¨æ—¶ï¼Œæ›´å€¾å‘äºŽå†…å»ºæ–¹æ³•ã€‚å¦‚ zip() æ–¹æ³•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>list(zip(*matrix))</span><br><span class="line">[(<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>), (<span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>), (<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>), (<span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>)]</span><br></pre></td></tr></table></figure><h1 id="åˆ›å»ºé›†åˆå’Œå­—å…¸">åˆ›å»ºé›†åˆå’Œå­—å…¸</h1><p>ç±»ä¼¼çš„æ“ä½œåŒæ ·é€‚ç”¨äºŽåˆ›å»ºé›†åˆå’Œå­—å…¸ã€‚å¯ä»¥ç§°ä¹‹ä¸ºé›†åˆæŽ¨å¯¼ï¼ˆSet comprehensionsï¼‰å’Œå­—å…¸æŽ¨å¯¼ï¼ˆDictionary comprehensionsï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;s <span class="keyword">for</span> s <span class="keyword">in</span> <span class="string">'hello world'</span>&#125;</span><br><span class="line">&#123;<span class="string">'w'</span>, <span class="string">'o'</span>, <span class="string">'r'</span>, <span class="string">'h'</span>, <span class="string">'l'</span>, <span class="string">' '</span>, <span class="string">'d'</span>, <span class="string">'e'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;k:v <span class="keyword">for</span> k, v <span class="keyword">in</span> enumerate([<span class="string">'zero'</span>, <span class="string">'first'</span>, <span class="string">'second'</span>])&#125;</span><br><span class="line">&#123;<span class="number">0</span>: <span class="string">'zero'</span>, <span class="number">1</span>: <span class="string">'first'</span>, <span class="number">2</span>: <span class="string">'second'</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> zip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python å¾ªçŽ¯æŠ€å·§</title>
      <link href="/programming/python-looping-techniques/"/>
      <url>/programming/python-looping-techniques/</url>
      
        <content type="html"><![CDATA[<h1 id="åŒæ—¶éåŽ†-key-å’Œ-value">åŒæ—¶éåŽ† key å’Œ value</h1><p>ä½¿ç”¨ <code>items()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dic = &#123;<span class="string">'name'</span>: <span class="string">'chen'</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> dic.items():</span><br><span class="line"><span class="meta">... </span>    print(k, v)</span><br><span class="line">...</span><br><span class="line">name chen  </span><br><span class="line">gender male</span><br></pre></td></tr></table></figure><h1 id="åŒæ—¶éåŽ†-index-å’Œ-value">åŒæ—¶éåŽ† index å’Œ value</h1><p>ä½¿ç”¨ <code>enumerate()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate([<span class="string">'zero'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>]):</span><br><span class="line"><span class="meta">... </span>    print(i, v)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> zero</span><br><span class="line"><span class="number">1</span> one</span><br><span class="line"><span class="number">2</span> two</span><br><span class="line"><span class="number">3</span> three</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="åŒæ—¶éåŽ†å¤šä¸ªæ•°ç»„">åŒæ—¶éåŽ†å¤šä¸ªæ•°ç»„</h1><p>ä½¿ç”¨ <code>zip()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>eng = [<span class="string">'zero'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> n, e <span class="keyword">in</span> zip(nums, eng):</span><br><span class="line"><span class="meta">... </span>    print(n, e)</span><br><span class="line">...</span><br><span class="line"><span class="number">0</span> zero</span><br><span class="line"><span class="number">1</span> one</span><br><span class="line"><span class="number">2</span> two</span><br></pre></td></tr></table></figure><h1 id="ååºéåŽ†">ååºéåŽ†</h1><p>ä½¿ç”¨ <code>reversed()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(<span class="number">2</span>, <span class="number">11</span>, <span class="number">2</span>)):</span><br><span class="line"><span class="meta">... </span>    print(i, end=<span class="string">' '</span>)</span><br><span class="line">...</span><br><span class="line"><span class="number">10</span> <span class="number">8</span> <span class="number">6</span> <span class="number">4</span> <span class="number">2</span> &gt;&gt;&gt;</span><br></pre></td></tr></table></figure><h1 id="æŽ’åºå’ŒåŽ»é‡">æŽ’åºå’ŒåŽ»é‡</h1><p>ä½¿ç”¨ <code>sorted()</code> å’Œ <code>set()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>basket = [<span class="string">'apple'</span>, <span class="string">'orange'</span>, <span class="string">'apple'</span>, <span class="string">'banana'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> sorted(set(basket)):</span><br><span class="line"><span class="meta">... </span>    print(f)</span><br><span class="line">...</span><br><span class="line">apple</span><br><span class="line">banana</span><br><span class="line">orange</span><br></pre></td></tr></table></figure><h1 id="å¾ªçŽ¯é‡Œé¢çš„-else">å¾ªçŽ¯é‡Œé¢çš„ else</h1><p>é€€å‡ºå¾ªçŽ¯æ—¶æ‰§è¡Œ <code>else</code> å—ä¸­ä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">10</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">if</span> n % x == <span class="number">0</span>:</span><br><span class="line"><span class="meta">... </span>                    print(n, <span class="string">'equals'</span>, x, <span class="string">'*'</span>, n//x)</span><br><span class="line"><span class="meta">... </span>                    <span class="keyword">break</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>            print(n, <span class="string">'is a prime number'</span>)</span><br><span class="line">...</span><br><span class="line"><span class="number">2</span> <span class="keyword">is</span> a prime number</span><br><span class="line"><span class="number">3</span> <span class="keyword">is</span> a prime number</span><br><span class="line"><span class="number">4</span> equals <span class="number">2</span> * <span class="number">2</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">is</span> a prime number</span><br><span class="line"><span class="number">6</span> equals <span class="number">2</span> * <span class="number">3</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">is</span> a prime number</span><br><span class="line"><span class="number">8</span> equals <span class="number">2</span> * <span class="number">4</span></span><br><span class="line"><span class="number">9</span> equals <span class="number">3</span> * <span class="number">3</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ€§æ—¶é—´æŽ’åº</title>
      <link href="/notes/introduction-to-algorithms/sorting-in-linear-time/"/>
      <url>/notes/introduction-to-algorithms/sorting-in-linear-time/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¡æ•°æŽ’åº">è®¡æ•°æŽ’åº</h1><p>è®¡æ•°æŽ’åºäºŽ 1954 å¹´ç”± Harold H. Seward æå‡ºï¼Œæ˜¯ä¸€ç§çº¿æ€§æ—¶é—´æŽ’åºç®—æ³•ã€‚å®ƒæ˜¯ç¨³å®šæŽ’åºç®—æ³•ï¼Œè¿™ä¸ªæ€§è´¨å¾ˆé‡è¦ï¼Œæ˜¯å®ƒå¯ä»¥ä½œä¸ºåŸºæ•°æŽ’åºå­è¿‡ç¨‹çš„å‰æã€‚ä½†ä¸æ˜¯åŽŸå€æŽ’åºç®—æ³•ï¼Œå³éœ€è¦é¢å¤–çš„éšè¾“å…¥è§„æ¨¡å¢žå¤§çš„è¾…åŠ©ç©ºé—´ã€‚è®¡æ•°æŽ’åºä¸æ˜¯æ¯”è¾ƒæŽ’åºï¼Œæ‘†è„±äº†æ¯”è¾ƒæŽ’åºçš„ä¸‹ç•Œ <span class="math inline">\(\Omega(n\lg{n})\)</span>ï¼Œå¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…å®ŒæˆæŽ’åºã€‚</p><p>è®¡æ•°æŽ’åºå…ˆâ€œæ•°â€å‡ºä¸åŒå…ƒç´ å€¼çš„ä¸ªæ•°ï¼Œä¹‹åŽé€šè¿‡ç®—æ•°è¿ç®—æ±‚å‡ºä¸åŒå…ƒç´ å€¼æŽ’åºåŽçš„ä½ç½®ã€‚å®ƒçš„è¿è¡Œæ—¶é—´æ˜¯ <span class="math inline">\(O(max-min)\)</span>ã€‚è®¡æ•°æŽ’åºæ¯”è¾ƒé€‚ç”¨äºŽï¼Œè¾“å…¥æ•°ç»„ä¸­æœ€å¤§å€¼å’Œæœ€å°å€¼çš„å·®ä¸ç‰¹åˆ«å¤§äºŽå…ƒç´ ä¸ªæ•°çš„æƒ…å†µã€‚ä½†è®¡æ•°æŽ’åºå¯ä»¥ç”¨ä½œåˆ«çš„æŽ’åºçš„å­è¿‡ç¨‹ï¼Œä¾‹å¦‚ <a href="/notes/introduction-to-algorithms/sorting-in-linear-time/" title="çº¿æ€§æ—¶é—´æŽ’åº">çº¿æ€§æ—¶é—´æŽ’åº</a>åŸºæ•°æŽ’åºï¼ŒåŸºæ•°æŽ’åºå¯ä»¥å¾ˆå¥½çš„å¤„ç†ä¸Šè¿°æƒ…å†µã€‚</p><h2 id="å®žçŽ°">å®žçŽ°</h2><p>è®¡æ•°æŽ’åºå‡è®¾ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä¸€ç»„ä»Ž 0 å¼€å§‹ï¼Œæœ€å¤§å€¼ä¸è¶…è¿‡ kï¼ˆå³å°äºŽç­‰äºŽ kï¼‰çš„æ•´åž‹æ•°ç»„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œk å¯èƒ½å·²çŸ¥ï¼Œæ¯”å¦‚åè¿›åˆ¶æ•°çš„åŸºæ•°æŽ’åºä¸­ <code>k = 9</code>ã€‚åœ¨æœªçŸ¥çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡éåŽ†æ•°ç»„ï¼Œå¾—å‡º k çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">counting_sort(A, B, k):   <span class="comment"># Aï¼šè¾“å…¥ï¼›Bï¼šè¾“å‡º ï¼›kï¼šAä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line">    C = new array[k+<span class="number">1</span>]    <span class="comment"># Cï¼šè¾…åŠ©æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span> to A.length - <span class="number">1</span>:</span><br><span class="line">        C[A[i]] = C[A[i]] + <span class="number">1</span>   <span class="comment"># C[i] = n: æœ‰nä¸ªå…ƒç´ çš„ç­‰äºŽi</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span> to k:</span><br><span class="line">        C[i] = C[i] + C[i + <span class="number">1</span>]  <span class="comment"># C[i] = n: æœ‰nä¸ªå…ƒç´ çš„å€¼å°äºŽç­‰äºŽi</span></span><br><span class="line">    <span class="keyword">for</span> j = A.length - <span class="number">1</span> to <span class="number">0</span>:</span><br><span class="line">        B[C[A[i]] - <span class="number">1</span>] = A[i]</span><br><span class="line">        C[A[i]] = C[A[i]] - <span class="number">1</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>Q: ä¸ºä»€ä¹ˆä¸åœ¨ç¬¬ä¸€ä¸ªå¾ªçŽ¯ä¹‹åŽå€ŸåŠ©æ•°ç»„Cç›´æŽ¥è¾“å‡ºæŽ’åºåŽçš„æ•°ç»„ï¼Ÿ</p><p>A: ä¿è¯è®¡æ•°æŽ’åºç®—æ³•çš„ç¨³å®šæ€§ï¼ˆå¦‚æžœä¸è¦æ±‚æŽ’åºç»“æžœçš„ç¨³å®šæ€§å¯ä»¥è¿™æ ·åšï¼‰ã€‚åœ¨ä¸‹é¢çš„åŸºæ•°æŽ’åºç®—æ³•ä¸­ï¼Œè®¡æ•°æŽ’åºé€šå¸¸ä½œä¸ºå­æŽ’åºè¿‡ç¨‹å‡ºçŽ°ï¼Œè€Œä¸”ä¸ºäº†ä¿è¯åŸºæ•°æŽ’åºæ˜¯æ­£ç¡®çš„ï¼Œå­æŽ’åºè¿‡ç¨‹å¿…é¡»æ˜¯ç¨³å®šçš„ã€‚</p><h2 id="åˆ†æž">åˆ†æž</h2><p>è®¡æ•°æŽ’åºçš„ä»£ç åªæœ‰ä¸‰ä¸ªå¾ªçŽ¯ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå¾ªçŽ¯æ‰§è¡Œ n æ¬¡ï¼Œç¬¬äºŒä¸ªå¾ªçŽ¯æ‰§è¡Œ k æ¬¡ï¼Œæ¯ä¸ªå¾ªçŽ¯çš„å•æ¬¡è¿è¡Œæ—¶é—´éƒ½æ˜¯ <span class="math inline">\(\Theta(1)\)</span>ã€‚æ‰€ä»¥æ€»è¿è¡Œæ—¶é—´æ˜¯ <span class="math inline">\(T(n)=2\Theta(n)+\Theta(k)=\Theta(k+n)\)</span>ã€‚å½“ <span class="math inline">\(k=\Theta(n)\)</span> çš„æ—¶å€™ï¼Œå³æ•°ç»„ä¸­çš„æœ€å¤§å€¼éšæ•°ç»„å¤§å°çº¿æ€§å˜åŒ–æ—¶ï¼Œ<span class="math inline">\(T(n)=\Theta(n)\)</span>ï¼Œè®¡æ•°æŽ’åºå¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…å®ŒæˆæŽ’åºã€‚</p><h2 id="ä»£ç ">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counting_sort</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    c = [<span class="number">0</span>] * (max(a) + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        c[a[i]] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(c)):</span><br><span class="line">        c[i] += c[i - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a) - <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">        b[c[a[i]] - <span class="number">1</span>] = a[i]</span><br><span class="line">        c[a[i]] -= <span class="number">1</span></span><br></pre></td></tr></table></figure><h1 id="åŸºæ•°æŽ’åº">åŸºæ•°æŽ’åº</h1><p>åŸºæ•°æŽ’åºæ˜¯ä¸€ç§éžæ¯”è¾ƒåž‹æ•´æ•°æŽ’åºç®—æ³•ï¼Œå…¶åŽŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼ˆä½æ•°ä¸è¶³çš„æ•°å­—é«˜ä½è¡¥é›¶ï¼‰ï¼Œç„¶åŽæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚åŸºæ•°æŽ’åºæœ€åˆæ˜¯åº”ç”¨åœ¨å¡ç‰‡æŽ’åºæœºä¸Šçš„ç®—æ³•ï¼Œå¯ä»¥è¢«â€œæœºæ¢°ç¼–ç¨‹â€ã€‚</p><h2 id="å®žçŽ°-1">å®žçŽ°</h2><p>åŸºæ•°æŽ’åºçš„æ–¹å¼å¯ä»¥é‡‡ç”¨ LSDï¼ˆLeast significant digitalï¼‰æˆ– MSDï¼ˆMost significant digitalï¼‰ã€‚LSD å³ä»Žæœ€ä½Žä½å¼€å§‹æ¯”è¾ƒï¼ŒMSD ç›¸åï¼Œä»Žæœ€é«˜ä½å¼€å§‹æ¯”è¾ƒã€‚</p><ul><li><p>MSD çš„æŽ’åºè¿‡ç¨‹ï¼šæŒ‰æœ€é«˜æœ‰æ•ˆä½è¿›è¡ŒæŽ’åºï¼ŒæŒ‰æœ€é«˜ä½åˆ†åˆ«æ”¾å…¥â€œå®¹å™¨ 0-9â€ï¼Œç„¶åŽæŒ‰ä¸‹ä¸€ä¸ªæœ€é«˜ä½é€’å½’çš„å¯¹æ¯ä¸ªå®¹å™¨ä¸­çš„æ•°è¿›è¡ŒæŽ’åºã€‚</p><p>ä½¿ç”¨ MSD æŽ’åºä¸€ç»„æ•°çš„ä¾‹å­å¦‚ä¸‹ï¼Œè¡¨ä¸­çœç•¥äº†æ²¡æœ‰æ•°çš„å®¹å™¨ï¼ˆæ²¡æœ‰è¢«ç©ºè¡Œéš”å¼€çš„æ•°ä½äºŽåŒä¸€ä¸ªå®¹å™¨å†…ï¼‰ï¼š</p></li></ul><table><colgroup><col style="width: 20%"><col style="width: 20%"><col style="width: 20%"><col style="width: 20%"><col style="width: 20%"></colgroup><thead><tr class="header"><th>è¾“å…¥æ•°ç»„</th><th>æŒ‰ç¬¬ä¸€é«˜ä½æŽ’åºåŽ</th><th>æŒ‰ç¬¬äºŒé«˜ä½é€’å½’æŽ’åº</th><th>æŒ‰ç¬¬ä¸‰é«˜ä½é€’å½’æŽ’åºå®¹å™¨</th><th>æŒ‰åºæ”¶é›†</th></tr></thead><tbody><tr class="odd"><td><code>004</code><br><code>178</code><br><code>045</code><br><code>009</code><br><code>135</code><br></td><td><code>004</code><br><code>045</code><br><code>009</code><br><br><code>178</code><br><code>135</code></td><td><code>004</code><br><code>009</code><br><br><code>045</code><br><br><code>135</code><br><br><code>178</code></td><td><code>004</code><br><br><code>009</code><br><br><code>045</code><br><br><code>135</code><br><br><code>178</code></td><td><code>004</code><br><code>009</code><br><code>045</code><br><code>135</code><br><code>178</code></td></tr></tbody></table><ul><li><p>LSD çš„æŽ’åºè¿‡ç¨‹ï¼šæŒ‰æœ€ä½Žæœ‰æ•ˆä½è¿›è¡ŒæŽ’åºï¼Œå°†æŽ’åºç»“æžœæ”¾å…¥åŒä¸€ä¸ªâ€å®¹å™¨â€œï¼Œç„¶åŽæŒ‰ä¸‹ä¸€ä¸ªæœ€ä½Žä½é‡å¤æŽ’åºï¼Œå†æ”¶é›†ï¼Œç›´è‡³æœ€é«˜ä½æŽ’åºå®Œæˆã€‚</p><p>åŒæ ·çš„è¾“å…¥ï¼Œä½¿ç”¨ LSD æŽ’åºçš„ä¾‹å­å¦‚ä¸‹ï¼š</p></li></ul><table><colgroup><col style="width: 27%"><col style="width: 22%"><col style="width: 27%"><col style="width: 22%"></colgroup><thead><tr class="header"><th>è¾“å…¥æ•°ç»„</th><th>æŒ‰ç¬¬ä¸€ä½Žä½æŽ’åºåŽ</th><th>ç¬¬äºŒä½Žä½</th><th>ç¬¬ä¸‰ä½Žä½</th></tr></thead><tbody><tr class="odd"><td><code>004</code><br><code>178</code><br><code>045</code><br><code>009</code><br><code>135</code><br></td><td><code>004</code><br><code>045</code><br><code>135</code><br><code>178</code><br><code>009</code></td><td><code>004</code><br><code>009</code><br><code>135</code><br><code>045</code><br><code>178</code></td><td><code>004</code><br><code>009</code><br><code>045</code><br><code>135</code><br><code>178</code></td></tr></tbody></table><hr><p>åœ¨ MSD æŽ’åºä¸­ï¼Œæ¯æ¬¡é€’å½’éƒ½éœ€è¦é¢å¤–å‡†å¤‡ 10 ä¸ªâ€œå®¹å™¨â€ç”¨æ¥ä¿å­˜æŽ’åºç»“æžœã€‚å¦‚æžœé€’å½’æ·±åº¦æ¯”è¾ƒå¤§ï¼ŒMSD ä¼šå ç”¨éžå¸¸å¤šçš„ç©ºé—´ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒLSD åªéœ€è¦ 10 ä¸ªâ€œå®¹å™¨â€ï¼Œåœ¨ä¸‹ä¸€æ¬¡å¾ªçŽ¯å¼€å§‹å‰ï¼Œâ€œå®¹å™¨â€ä¸­çš„æ•°è¢«æ”¶é›†èµ·æ¥ï¼Œâ€œå®¹å™¨â€å¯ä»¥é‡å¤ä½¿ç”¨ã€‚</p><p>å› æ­¤åŸºæ•°æŽ’åºé‡‡ç”¨ LSD è¿›è¡ŒæŽ’åºï¼Œä¹Ÿå› æ­¤è¦æ±‚å­è¿‡ç¨‹å¿…é¡»æ˜¯ç¨³å®šçš„ã€‚å³é«˜ä½çš„æ¯”è¾ƒç»“æžœä¸èƒ½ç ´åä½Žä½çš„æ¯”è¾ƒç»“æžœã€‚</p><p>ä¾‹å¦‚004å’Œ009ï¼š</p><p>æŒ‰ç…§ç¬¬ä¸€ä½Žä½æŽ’åºåŽï¼Œ004 åœ¨ 009 ä¹‹å‰ã€‚äºŒè€…çš„ç¬¬äºŒä½Žä½éƒ½ä¸º 0ï¼Œæ­¤æ—¶å®ƒä»¬çš„å¤§å°å°±ç”±ç¬¬ä¸€ä½Žä½å†³å®šã€‚å› æ­¤éœ€è¦ä¿è¯åœ¨æŒ‰ç¬¬äºŒä½Žä½æŽ’åºæ—¶ï¼ŒäºŒè€…çš„å‰åŽé¡ºåºä¸èƒ½æ”¹å˜ï¼Œå³æŽ’åºå¿…é¡»æ˜¯ç¨³å®šçš„ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">radix_sort(A, d):</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span> to d:  <span class="comment"># d æ˜¯æœ‰æ•ˆä½æ•°</span></span><br><span class="line">        use a stable sort to sort array A on i</span><br></pre></td></tr></table></figure><p>å¯¹äºŽåè¿›åˆ¶æ•°å­—æ¥è¯´ï¼Œæ¯ä¸€ä½åªä¼šå‡ºçŽ° 10 ç§æ•°å­—ï¼ˆ0-9ï¼‰ï¼Œå› æ­¤è®¡æ•°æŽ’åºæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</p><h2 id="åˆ†æž-1">åˆ†æž</h2><p>åŸºæ•°æŽ’åºçš„æ—¶é—´ä»£ä»·ä¾èµ–äºŽæ‰€ä½¿ç”¨çš„ç¨³å®šçš„æŽ’åºç®—æ³•ã€‚å¦‚æžœå­è¿‡ç¨‹æ˜¯è®¡æ•°æŽ’åºçš„è¯ï¼Œåˆ™åŸºæ•°æŽ’åºçš„æ—¶é—´å¤æ‚åº¦å¯ä»¥æè¿°ä¸º <span class="math inline">\(d\Theta(n+k)=\Theta(d(n+k))\)</span>ã€‚å½“ d ä¸ºå¸¸æ•°ï¼ˆä½æ•°å›ºå®šï¼‰ä¸” <code>k=O(n)</code>ï¼ˆæ¯ä½æ•°å­—éƒ½åœ¨ 0 åˆ° k-1 åŒºé—´å†…ï¼‰æ—¶ï¼ŒåŸºæ•°æŽ’åºå…·æœ‰çº¿æ€§æ—¶é—´ä»£ä»·ã€‚</p><h2 id="ä»£ç -1">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">radix_sort</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="string">"""åè¿›åˆ¶æ•°çš„åŸºæ•°æŽ’åºç®—æ³•"""</span></span><br><span class="line">    c, b = [], [<span class="literal">None</span>] * len(a)  <span class="comment"># bæ˜¯ä¸€ä¸ªè¾…åŠ©æ•°ç»„</span></span><br><span class="line">    digit, _max = <span class="number">1</span>, max(a)</span><br><span class="line">    <span class="keyword">while</span> _max // digit &gt; <span class="number">0</span>:</span><br><span class="line">        c = [<span class="number">0</span>] * <span class="number">10</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">            c[(a[i] // digit) % <span class="number">10</span>] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(c)):</span><br><span class="line">            c[i] += c[i - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> reversed(range(len(a))):</span><br><span class="line">            target = (a[i] // digit) % <span class="number">10</span></span><br><span class="line">            b[c[target] - <span class="number">1</span>] = a[i]</span><br><span class="line">            c[target] -= <span class="number">1</span></span><br><span class="line">        a[:] = b[:]</span><br><span class="line">        digit *= <span class="number">10</span></span><br></pre></td></tr></table></figure><h1 id="æ¡¶æŽ’åº">æ¡¶æŽ’åº</h1><p>æ¡¶æŽ’åºï¼ˆBucket sortï¼‰æˆ–ç®±æŽ’åºï¼Œå·¥ä½œåŽŸç†æ˜¯å°†æ•°ç»„åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶é‡Œã€‚æ¯ä¸ªæ¡¶å†ä¸ªåˆ«æŽ’åºã€‚</p><p>è®¡æ•°æŽ’åºå‡è®¾è¾“å…¥æ•°æ®éƒ½å±žäºŽä¸€ä¸ªå°åŒºé—´å†…çš„æ•´æ•°ï¼Œæ¡¶æŽ’åºä¹Ÿå¯¹è¾“å…¥ä½œäº†æŸç§å‡è®¾ã€‚æ¡¶æŽ’åºå‡è®¾è¾“å…¥æœä»Žå‡åŒ€åˆ†å¸ƒï¼Œå¹³å‡æƒ…å†µä¸‹æ—¶é—´ä»£ä»·ä¸º <code>O(n)</code>ã€‚</p><h2 id="å®žçŽ°-2">å®žçŽ°</h2><p>æ¡¶æŽ’åºå°† <code>[0,1)</code> åŒºé—´åˆ’åˆ†ä¸º k ä¸ªå¤§å°ç›¸åŒçš„å­åŒºé—´ï¼Œæˆ–ç§°ä¸ºæ¡¶ã€‚ç„¶åŽï¼Œå°† n ä¸ªè¾“å…¥æ•°åˆ†åˆ«æ”¾åˆ°å„ä¸ªæ¡¶ä¸­ã€‚å¯¹æ¯ä¸ªæ¡¶ä¸­çš„æ•°è¿›è¡ŒæŽ’åºï¼Œç„¶åŽéåŽ†æ¯ä¸ªæ¡¶ï¼ŒæŒ‰ç…§æ¬¡åºæŠŠå„ä¸ªæ¡¶ä¸­çš„å…ƒç´ åˆ—å‡ºæ¥å³å¯ã€‚å› ä¸ºè¾“å…¥æ˜¯å‡åŒ€ã€ç‹¬ç«‹åœ°åˆ†å¸ƒåœ¨ <code>[0,1)</code> åŒºé—´ä¸Šï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‡ºçŽ°å¾ˆå¤šæ•°è½åœ¨åŒä¸€ä¸ªæ¡¶ä¸­çš„æƒ…å†µã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bucket_sort(A):</span><br><span class="line">    n = A.length</span><br><span class="line">    B = new array[k]</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span> to k - <span class="number">1</span>:</span><br><span class="line">        make B[i] an empty list        <span class="comment"># make k buckets</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span> to n - <span class="number">1</span>:</span><br><span class="line">        insert A[i] into list B[floor(k * A[i])]</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span> to k - <span class="number">1</span>:</span><br><span class="line">        sort list B[i] <span class="keyword">with</span> insertion sort</span><br><span class="line">    concatenate the lists B[<span class="number">0</span>], B[<span class="number">1</span>],...,B[k<span class="number">-1</span>] together <span class="keyword">in</span> order</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ k=10 æ—¶ï¼ŒæŽ’åºä¸€ç»„æ•°çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><table><thead><tr class="header"><th>è¾“å…¥</th><th>æ‰€å±žæ¡¶ï¼ˆ<code>floor(k * A[i])</code></th><th>æ¡¶åºå·</th><th>æ¡¶ä¸­å…ƒç´ </th><th>æŽ’åºåŽæ¡¶ä¸­å…ƒç´ </th></tr></thead><tbody><tr class="odd"><td>0.78</td><td>7</td><td>0</td><td></td><td></td></tr><tr class="even"><td>0.17</td><td>1</td><td>1</td><td>0.17ã€0.12</td><td>0.12ã€0.17</td></tr><tr class="odd"><td>0.39</td><td>3</td><td>2</td><td>0.26ã€0.21ã€0.23</td><td>0.21ã€0.23ã€0.26</td></tr><tr class="even"><td>0.26</td><td>2</td><td>3</td><td>0.39</td><td>0.39</td></tr><tr class="odd"><td>0.72</td><td>7</td><td>4</td><td></td><td></td></tr><tr class="even"><td>0.94</td><td>9</td><td>5</td><td></td><td></td></tr><tr class="odd"><td>0.21</td><td>2</td><td>6</td><td>0.68</td><td>0.68</td></tr><tr class="even"><td>0.12</td><td>1</td><td>7</td><td>0.78ã€0.72</td><td>0.72ã€0.78</td></tr><tr class="odd"><td>0.23</td><td>2</td><td>8</td><td></td><td></td></tr><tr class="even"><td>0.68</td><td>6</td><td>9</td><td>0.94</td><td>0.94</td></tr></tbody></table><p>éåŽ†æ¡¶ä¸­å…ƒç´ å³å¯å¾—åˆ°æŽ’åºç»“æžœã€‚</p><h2 id="åˆ†æž-2">åˆ†æž</h2><p>é™¤åŽ»è°ƒç”¨æ’å…¥æŽ’åºçš„ä»£ç ï¼Œå…¶ä»–ä»£ç å¯ä»¥åœ¨ <span class="math inline">\(\Theta(1)\)</span> æ—¶é—´å†…å®Œæˆã€‚å·²çŸ¥æ’å…¥æŽ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º <span class="math inline">\(O(n^2)\)</span>ï¼Œn ä¸ºå…ƒç´ ä¸ªæ•°ã€‚æ¡¶æŽ’åºå¯¹æ¯ä¸ªæ¡¶éƒ½è°ƒç”¨äº†æ’å…¥æŽ’åºï¼Œæ¡¶ä¸­æœ‰å¤šå°‘å…ƒç´ ç›´æŽ¥å½±å“åˆ°æ—¶é—´ä»£ä»·ã€‚è®¾æ¡¶ i ä¸­çš„å…ƒç´ ä¸ªæ•°ä¸º <span class="math inline">\(n_i\)</span>ï¼Œåˆ™æ¡¶æŽ’åºçš„æ—¶é—´ä»£ä»·å¯ä»¥æè¿°ä¸ºï¼š</p><p><span class="math display">\[T(n)=\Theta(n)+\sum_{i=0}^{k-1}{O(n_i^2)}\]</span></p><p>è™½ç„¶æ— æ³•å‡†ç¡®ç›´åˆ°æ¯ä¸ªæ¡¶ä¸­å…ƒç´ ä¸ªæ•°ï¼Œä»Žè€Œæ— æ³•è®¡ç®—ä¸Šè¿°æ—¶é—´ä»£ä»·ã€‚ä½†å¯ä»¥è®¡ç®—å…¶æœŸæœ›ã€‚é€šè¿‡å¯¹ä¸Šå¼æ±‚æœŸæœ›ï¼š</p><p><span class="math display">\[\begin{aligned}E[T(n)]&amp;=E[\Theta(n)+\sum_{i=0}^{k-1}{O(n_i^2)}]\\&amp;=\Theta(n)+\sum_{i=0}^{k-1}{E[O(n_i^2)]}\\&amp;=\Theta(n)+\sum_{i=0}^{k-1}{O(E[n_i^2])}\end{aligned}\]</span></p><p>æ¡¶æŽ’åºå‡è®¾è¾“å…¥æœä»Žå‡åŒ€åˆ†å¸ƒï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºå…ƒç´ è½åˆ°æ¯ä¸ªæ¡¶çš„æ¦‚çŽ‡æ˜¯ç›¸åŒçš„ï¼Œä¸º 1/kã€‚n ä¸ªå…ƒç´ åˆ†åˆ° k ä¸ªæ¡¶ï¼ˆè®¾ä¸ºéšæœºå˜é‡ Xï¼‰ï¼ŒX æœä»Žå‚æ•°ä¸º n å’Œ 1/k çš„äºŒé¡¹åˆ†å¸ƒï¼Œ<span class="math inline">\(X\sim{b(n,1/k)}\)</span>ã€‚é€šè¿‡äºŒé¡¹åˆ†å¸ƒçš„æœŸæœ›å’Œæ–¹å·®å¯ä»¥å¿«é€Ÿè®¡ç®—å‡º <span class="math inline">\(E(n_i^2)\)</span>ã€‚</p><p><span class="math display">\[\begin{aligned}E(n_i^2)&amp;=E(X^2)\\&amp;=V(X)+(E(X))^2\\&amp;=n\frac{1}{k}(1-\frac{1}{k})+(n\frac{1}{k})^2\\&amp;=\frac{n^2+nk-n}{k^2}\end{aligned}\]</span></p><p>ç”±æ­¤å¯ä»¥å¾—å‡ºæ¡¶æŽ’åºçš„æœŸæœ›æ—¶é—´ä»£ä»·ä¸º</p><p><span class="math display">\[\begin{aligned}E[T(n)]&amp;=\Theta(n)+\sum_{i=0}^{k-1}{O(E[n_i^2])}\\&amp;=\Theta(n)+kO(\frac{n^2+nk-n}{k^2})\\&amp;=\Theta(n)+O(\frac{n^2}{k}+n)\end{aligned}\]</span></p><p>å¦‚æžœæ¡¶çš„ä¸ªæ•° <span class="math inline">\(k=\Theta(n)\)</span>ï¼Œåˆ™ä¸Šå¼ç­‰äºŽ <code>O(n)</code>ï¼Œæ¡¶æŽ’åºå¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…ç»“æŸã€‚å¦‚æžœ k=nï¼Œåˆ™æ¡¶æŽ’åºè¿‘ä¼¼ç­‰ä»·äºŽè®¡æ•°æŽ’åºã€‚</p><p>æ€»ç»“ï¼šè™½ç„¶æ’å…¥æŽ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ <span class="math inline">\(O(n^2)\)</span>ï¼Œä½†åœ¨ n æ¯”è¾ƒå°çš„æ—¶å€™åŒå…¶ä»–æ¯”è¾ƒæŽ’åºçš„å·®è·å¹¶ä¸æ˜Žæ˜¾ã€‚æ¡¶æŽ’åºå°±æ˜¯å°†åŽŸæ•°ç»„åˆ†åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œä½¿å¾—å„ä¸ªæ¡¶ä¸­çš„å…ƒç´ ä¸ªæ•°æ¯”è¾ƒå°ä¸”æ¡¶ä¹‹é—´æ»¡è¶³æ¬¡åºå…³ç³»ï¼Œå†å¯¹æ¡¶ä¸­å…ƒç´ ä½¿ç”¨æ’å…¥æŽ’åºã€‚</p><h2 id="ä»£ç -2">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> insertion_sort <span class="keyword">import</span> insertion_sort</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bucket_sort</span><span class="params">(a)</span>:</span></span><br><span class="line">    b = [[] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a))]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        b[math.floor(len(a) * a[i])].append(a[i])</span><br><span class="line">    a.clear()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(b)):</span><br><span class="line">        insertion_sort(b[i])</span><br><span class="line">        a.extend(b[i])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> sort </tag>
            
            <tag> algorithms </tag>
            
            <tag> non-comparison sort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’å…¥æŽ’åºã€é€‰æ‹©æŽ’åºå’Œå†’æ³¡æŽ’åº</title>
      <link href="/notes/introduction-to-algorithms/insertion-sort-selection-sort-and-bubble-sort/"/>
      <url>/notes/introduction-to-algorithms/insertion-sort-selection-sort-and-bubble-sort/</url>
      
        <content type="html"><![CDATA[<h1 id="æ’å…¥æŽ’åº">æ’å…¥æŽ’åº</h1><p>å¯¹äºŽå°‘é‡å…ƒç´ çš„æŽ’åºï¼Œæ’å…¥æŽ’åºï¼ˆInsertion sortï¼‰æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç®—æ³•ã€‚æ’å…¥æŽ’åºçš„å·¥ä½œæ–¹å¼åƒè®¸å¤šäººæŽ’åºä¸€æ‰‹æ‰‘å…‹ç‰Œã€‚å¼€å§‹æ—¶å·¦æ‰‹ä¸ºç©ºï¼Œæ¯æ¬¡ä»Žæ¡Œå­ä¸Šæ‹¿èµ°ä¸€å¼ ç‰Œå¹¶å°†å®ƒæ’å…¥å·¦æ‰‹ä¸­æ­£ç¡®çš„ä½ç½®ã€‚æ’å…¥æŽ’åºå°†è¾“å…¥æ•°ç»„åˆ†æˆæœªæŽ’åºéƒ¨åˆ†å’Œå·²æŽ’åºéƒ¨åˆ†ä¸¤ä¸ªå­æ•°ç»„ï¼Œåˆå§‹æ—¶å·²æŽ’åºéƒ¨åˆ†ä¸ºç©ºï¼ˆæˆ–è€…æœ‰ä¸€ä¸ªï¼Œå› ä¸ºä¸€ä¸ªæ•°çš„æ•°ç»„æ˜¯å·²æŽ’åºçš„ï¼‰ï¼Œæ¯æ¬¡è¿­ä»£ä»ŽæœªæŽ’åºæ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œå°†å…¶æ”¾å…¥å·²æŽ’åºæ•°ç»„ä¸­çš„åˆé€‚ä½ç½®ã€‚</p><p>æ’å…¥æŽ’åºç¤ºæ„å›¾ï¼ˆå‡ºè‡ª<a href="https://en.wikipedia.org/wiki/Insertion_sort" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘ï¼šInsertion sort</a>ï¼‰ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/0/0f/Insertion-sort-example-300px.gif" title="æ’å…¥æŽ’åºåŠ¨æ€ç¤ºæ„å›¾"></p><h2 id="å®žçŽ°">å®žçŽ°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">insertion_sort(A):</span><br><span class="line">    <span class="keyword">for</span> j = <span class="number">1</span> to A.length - <span class="number">1</span>:</span><br><span class="line">        key = A[j]</span><br><span class="line">        <span class="comment"># Insert A[j] into the sorted sequence A[1...j-1]</span></span><br><span class="line">        i = j - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &gt;= <span class="number">0</span> <span class="keyword">and</span> A[i] &gt; key:</span><br><span class="line">            A[i + <span class="number">1</span>] = A[i]</span><br><span class="line">            i = i - <span class="number">1</span></span><br><span class="line">        A[i + <span class="number">1</span>] = key</span><br></pre></td></tr></table></figure><a id="more"></a><p>å¾ªçŽ¯ä¸å˜å¼ï¼ˆ<a href="https://en.wikipedia.org/wiki/Loop_variant" title="Loop variant" target="_blank" rel="noopener">Loop variant</a>ï¼‰ç”¨æ¥å¸®åŠ©ç†è§£ç®—æ³•çš„æ­£ç¡®æ€§ã€‚å…³äºŽå¾ªçŽ¯ä¸å˜å¼ï¼Œå¿…é¡»è¯æ˜Žä¸‰æ¡æ€§è´¨ã€‚</p><ul><li>åˆå§‹åŒ–ï¼šå¾ªçŽ¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£å‰ï¼Œå®ƒä¸ºçœŸã€‚</li><li>ä¿æŒï¼šå¦‚æžœå¾ªçŽ¯çš„æŸæ¬¡è¿­ä»£å‰å®ƒä¸ºçœŸï¼Œé‚£ä¹ˆä¸‹æ¬¡è¿­ä»£å‰å®ƒä»ä¸ºçœŸã€‚</li><li>ç»ˆæ­¢ï¼šåœ¨å¾ªçŽ¯ç»ˆæ­¢æ—¶ï¼Œä¸å˜å¼æä¾›ä¸€ä¸ªæœ‰ç”¨çš„æ€§è´¨ï¼Œè¯¥æ€§è´¨æœ‰åŠ©äºŽè¯æ˜Žç®—æ³•æ˜¯æ­£ç¡®çš„ã€‚</li></ul><p>ï¼ˆç±»ä¼¼äºŽæ•°å­¦å½’çº³æ³•ï¼‰</p><p>ç”¨ä¸‹é¢çš„å¾ªçŽ¯ä¸å˜å¼è¯æ˜Žæ’å…¥æŽ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚</p><blockquote><p>åœ¨forå¾ªçŽ¯çš„æ¯æ¬¡è¿­ä»£å¼€å§‹å‰ï¼Œå­æ•°ç»„<code>A[0...(j-1)]</code>ç”±åŽŸæ¥åœ¨<code>A[0...(j-1)]</code>ä¸­çš„å…ƒç´ ç»„æˆï¼Œä½†å·²æŒ‰åºæŽ’åˆ—ã€‚</p></blockquote><ul><li>åˆå§‹åŒ–ï¼šå¾ªçŽ¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£å‰ï¼Œj=1ï¼Œå­æ•°ç»„åªåŒ…å«A[0]ï¼Œå®ƒä¸ºçœŸã€‚</li><li>ä¿æŒï¼šforå¾ªçŽ¯é‡Œé¢åµŒå¥—äº†ä¸€ä¸ªwhileå¾ªçŽ¯ï¼ŒåŒæ ·å¯ä»¥ç”¨å¦ä¸€ä¸ªå¾ªçŽ¯ä¸å˜å¼è¯æ˜Žå®ƒã€‚ä½†å¯¹äºŽç®€å•çš„å¾ªçŽ¯ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡éžå½¢å¼åŒ–çš„åˆ†æžè¯æ˜Žå…¶æ­£ç¡®æ€§ã€‚éžå½¢å¼åŒ–åœ°ï¼Œwhileå¾ªçŽ¯å°† A[j-1], A[j-2]ç­‰å‘å³ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°A[j]çš„é€‚å½“ä½ç½®ã€‚æœ€åŽå°†A[j]æ’å…¥è¯¥ä½ç½®ã€‚æ­¤æ—¶ï¼Œå­æ•°ç»„<code>A[0...(j)]</code>ç”±åŽŸæ¥åœ¨ <code>A[0...(j)]</code>ä¸­çš„å…ƒç´ ç»„æˆï¼Œä½†å·²æŒ‰åºæŽ’åˆ—ã€‚é‚£ä¹ˆä¸‹ä¸€æ¬¡è¿­ä»£å¢žåŠ jï¼Œä¸Šè¿°å¾ªçŽ¯ä¸å˜å¼ä¸ºçœŸã€‚</li><li>ç»ˆæ­¢ï¼šå¾ªçŽ¯ç»ˆæ­¢æ—¶j=A.lengthï¼Œåˆ™æ ¹æ®å¾ªçŽ¯ä¸å˜å¼å­æ•°ç»„<code>A[0...(A.length-1)]</code>ç”±åŽŸæ¥åœ¨<code>A[0...(A.length-1)]</code>ä¸­çš„å…ƒç´ ç»„æˆï¼Œä½†å·²æŒ‰åºæŽ’åˆ—ã€‚æ­¤æ—¶<code>A[0...(A.length-1)]</code>å°±æ˜¯æ•´ä¸ªæ•°ç»„ã€‚å› æ­¤è¯¥ç®—æ³•æ­£ç¡®ã€‚</li></ul><h2 id="åˆ†æž">åˆ†æž</h2><p>åœ¨forå¾ªçŽ¯å†…éƒ¨ï¼Œé™¤åŽ»whileå¾ªçŽ¯çš„è¯­å¥æ‰§è¡Œæ—¶é—´å‡ä¸º<span class="math inline">\(\Theta(1)\)</span>ï¼ˆå³å¸¸æ•°æ—¶é—´å†…ï¼‰ï¼Œforå¾ªçŽ¯æ‰§è¡Œn-1æ¬¡ã€‚whileå¾ªçŽ¯çš„è¿è¡Œæ—¶é—´ä¸Žæ•°ç»„çš„å·²æŽ’åºç¨‹åº¦æœ‰å…³ç³»ã€‚è‹¥è¾“å…¥æ•°ç»„å·²æŒ‰é€’å¢žåºæŽ’å¥½ï¼Œåˆ™å¯¼è‡´æœ€ä½³æƒ…å†µã€‚è‹¥è¾“å…¥æ•°ç»„å·²åå‘æŽ’åºï¼Œå³æŒ‰é€’å‡åºæŽ’å¥½ï¼Œåˆ™å¯¼è‡´æœ€åæƒ…å†µã€‚åœ¨whileå¾ªçŽ¯å¤„ï¼Œå¿…é¡»å°†æ¯ä¸ªå…ƒç´  A[j]ä¸Žæ•´ä¸ªå·²æŽ’åºå­æ•°ç»„<code>A[0...(j-1)]</code>ä¸­æ¯ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚</p><table><thead><tr class="header"><th>j</th><th>æœ€ä½³æ—¶æ¯”è¾ƒå…ƒç´ </th><th>æ¯”è¾ƒæ¬¡æ•°</th><th>æœ€åæ—¶æ¯”è¾ƒå…ƒç´ </th><th>æ¯”è¾ƒæ¬¡æ•°</th></tr></thead><tbody><tr class="odd"><td>1</td><td>A[0]</td><td>1</td><td>A[0]</td><td>1</td></tr><tr class="even"><td>2</td><td>A[1]</td><td>1</td><td>A[0, 1]</td><td>2</td></tr><tr class="odd"><td><span class="math inline">\(\vdots\)</span></td><td><span class="math inline">\(\vdots\)</span></td><td><span class="math inline">\(\vdots\)</span></td><td><span class="math inline">\(\vdots\)</span></td><td><span class="math inline">\(\vdots\)</span></td></tr><tr class="even"><td>n-1</td><td>A[n-2]</td><td>1</td><td><code>A[0...(n-2)]</code></td><td>n-1</td></tr></tbody></table><p>æœ€ä½³æƒ…å†µä¸‹ï¼Œwhileå¾ªçŽ¯çš„æ‰§è¡Œæ—¶é—´ä¸º<span class="math inline">\(\sum_{n=1}^{n-1}1=n-1\)</span>ã€‚</p><p>æœ€ä½³è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(T(n)=(n-1)\Theta(1)+n-1=\Theta(n)\)</span>ã€‚å®ƒæ˜¯nçš„çº¿æ€§å‡½æ•°ã€‚</p><p>æœ€åæƒ…å†µä¸‹ï¼Œwhileå¾ªçŽ¯çš„æ‰§è¡Œæ—¶é—´ä¸º<span class="math inline">\(\sum_{n=1}^{n-1}n=\frac{n(n-1)}{2}\)</span>ã€‚</p><p>æ‰€ä»¥ï¼Œæ’å…¥æŽ’åºçš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(T(n)=(n-1)\Theta(1)+\frac{n(n-1)}{2}\le{n^2}=O(n^2)\)</span>ã€‚æ­¤æ—¶å®ƒæ˜¯nçš„äºŒæ¬¡å‡½æ•°ã€‚</p><h2 id="ä»£ç ">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insertion_sort</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len(a)):</span><br><span class="line">        key = a[j]</span><br><span class="line">        i = j - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> i &gt;= <span class="number">0</span> <span class="keyword">and</span> a[i] &gt; key:</span><br><span class="line">            a[i + <span class="number">1</span>] = a[i]</span><br><span class="line">            i -= <span class="number">1</span></span><br><span class="line">        a[i + <span class="number">1</span>] = key</span><br></pre></td></tr></table></figure><h2 id="æœ€åæœ€ä½³ä¸Žå¹³å‡æƒ…å†µ">æœ€åã€æœ€ä½³ä¸Žå¹³å‡æƒ…å†µ</h2><p>æœ€åæƒ…å†µæ¯”æœ€ä½³æƒ…å†µæ›´åŠ æœ‰ç”¨ï¼Œç®—æ³•å¯¼è®ºç»™å‡ºäº†ä¸‰ç‚¹ç†ç”±ã€‚</p><ul><li>ä¸€ä¸ªç®—æ³•çš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´ç»™å‡ºäº†ä»»ä½•è¾“å…¥çš„è¿è¡Œæ—¶é—´çš„ä¸€ä¸ªä¸Šç•Œã€‚çŸ¥é“äº†è¿™ä¸ªç•Œï¼Œå°±èƒ½ç¡®ä¿è¯¥ç®—æ³•ç»ä¸éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚</li><li>å¯¹æŸäº›ç®—æ³•ï¼Œæœ€åæƒ…å†µç»å¸¸å‡ºçŽ°ã€‚ä¾‹å¦‚ï¼Œå½“æ•°æ®åº“ä¸­æ£€ç´¢ä¸€æ¡ç‰¹å®šä¿¡æ¯æ—¶ï¼Œè‹¥è¯¥ä¿¡æ¯ä¸åœ¨æ•°æ®åº“ä¸­å‡ºçŽ°ï¼Œåˆ™æ£€ç´¢ç®—æ³•çš„æœ€åæƒ…å†µä¼šå‡ºçŽ°ã€‚åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œå¯¹ç¼ºå¤±ä¿¡æ¯çš„æ£€ç´¢å¯èƒ½æ˜¯é¢‘ç¹çš„ã€‚</li><li>â€œå¹³å‡æƒ…å†µâ€å¾€å¾€ä¸Žæœ€åæƒ…å†µå¤§è‡´ä¸€è‡´ã€‚å‡å®šéšæœºé€‰æ‹©nä¸ªæ•°å¹¶åº”ç”¨æ’å…¥æŽ’åºã€‚å¹³å‡æ¥è¯´ï¼Œ<code>A[0...(j-1)]</code>ä¸­çš„ä¸€èˆ¬å…ƒç´ å°äºŽA[j]ï¼Œä¸€åŠå…ƒç´ å¤§äºŽA[j]ã€‚æ‰€ä»¥ï¼Œå¹³å‡æ¥è¯´ï¼Œæ¯æ¬¡whileå¾ªçŽ¯çš„æ¯”è¾ƒæ¬¡æ•°å¤§çº¦ä¸ºj/2ã€‚å¯¼è‡´å¹³å‡æƒ…å†µè¿è¡Œæ—¶é—´ç»“æžœåƒæœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¸€æ ·ï¼Œä¹Ÿæ˜¯è¾“å…¥è§„æ¨¡çš„ä¸€ä¸ªäºŒæ¬¡å‡½æ•°ã€‚</li></ul><p>åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œä¼šå¯¹ä¸€ä¸ªç®—æ³•çš„å¹³å‡æƒ…å†µè¿è¡Œæ—¶é—´æ„Ÿå…´è¶£ã€‚å¹³å‡æƒ…å†µåˆ†æžçš„èŒƒå›´æœ‰é™ï¼Œå› ä¸ºå¯¹äºŽç‰¹å®šçš„é—®é¢˜ï¼Œä»€ä¹ˆæž„æˆä¸€ç§â€œå¹³å‡â€è¾“å…¥å¹¶ä¸æ˜Žæ˜¾ã€‚</p><h1 id="é€‰æ‹©æŽ’åº">é€‰æ‹©æŽ’åº</h1><p>å¦‚æžœè¯´æ’å…¥æŽ’åºæ˜¯æ‹¿ä¸€å¼ ç‰ŒåŽ»æ‰¾åœ¨å·¦æ‰‹ä¸­çš„ä½ç½®ï¼Œé‚£ä¹ˆé€‰æ‹©æŽ’åºå°±æ˜¯æ‰¾å‡ºæœ€å°çš„ç‰Œï¼Œæ”¾åˆ°å·¦æ‰‹çš„æœ«ä½ï¼ˆæˆ–è€…æ‰¾æœ€å¤§çš„ç‰Œï¼Œæ”¾åˆ°å·¦æ‰‹çš„é¦–ä½ï¼‰ã€‚ä¸Žæ’å…¥æŽ’åºç±»ä¼¼ï¼Œé€‰æ‹©æŽ’åºä¹Ÿå°†è¾“å…¥æ•°ç»„åˆ†æˆå·²æŽ’åºå’ŒæœªæŽ’åºä¸¤ä¸ªå­æ•°ç»„ï¼Œæ¯æ¬¡è¿­ä»£é€‰æ‹©æœªæŽ’åºæ•°ç»„ä¸­æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼Œå–å†³äºŽæŽ’åºè§„åˆ™ï¼‰çš„å…ƒç´ ï¼Œå°†å…¶ä¸ŽæœªæŽ’åºå­æ•°ç»„çš„ç¬¬ä¸€ä½å…ƒç´ äº¤æ¢ï¼Œç„¶åŽæ‰©å±•å·²æŽ’åºæ•°ç»„çš„è¾¹ç•ŒåŠ ä¸€ã€‚</p><p>é€‰æ‹©æŽ’åºç¤ºæ„å›¾ï¼ˆå‡ºè‡ª<a href="https://en.wikipedia.org/wiki/Selection_sort" title="Selection sort" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘ï¼šSelection sort</a>ï¼‰ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/9/94/Selection-Sort-Animation.gif" title="é€‰æ‹©æŽ’åºåŠ¨æ€ç¤ºæ„å›¾"></p><h2 id="å®žçŽ°-1">å®žçŽ°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">selection_sort(A):</span><br><span class="line">    <span class="keyword">for</span> j = <span class="number">0</span> to A.length - <span class="number">2</span>:</span><br><span class="line">        i_min = j</span><br><span class="line">        <span class="keyword">for</span> i = j + <span class="number">1</span> to A.length - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> A[i] &lt; A[i_min]:</span><br><span class="line">                i_min = i</span><br><span class="line">        <span class="keyword">if</span> i_min != j:</span><br><span class="line">            exchange A[i_min] <span class="keyword">with</span> A[j]</span><br></pre></td></tr></table></figure><h2 id="åˆ†æž-1">åˆ†æž</h2><p>å¤–å±‚å¾ªçŽ¯æ‰§è¡Œn-1æ¬¡ï¼Œå•æ¬¡è¿è¡Œæ—¶é—´ä¸º<span class="math inline">\(\Theta(1)\)</span>ã€‚å†…å±‚å¾ªçŽ¯å¯»æ‰¾ä¸‹ä¸€ä¸ªæœ€å°çš„æ•°æ‰§è¡Œn-1-jæ¬¡ï¼Œå•æ¬¡è¿è¡Œæ—¶é—´ä¹Ÿæ˜¯<span class="math inline">\(\Theta(1)\)</span>ã€‚</p><p>æ€»è¿è¡Œæ—¶é—´ä¸ºï¼š</p><p><span class="math display">\[\begin{aligned}T(n)&amp;=n-1+\sum_{j=0}^{n-2}n-i-j \\&amp;=n-1+\sum_{i=1}^{n-1}n-i \\&amp;=n-1+\frac{n(n-1)}{2} \\&amp;=O(n^2)\end{aligned}\]</span></p><h2 id="ä»£ç -1">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">selection_sort</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, len(a) - <span class="number">1</span>):</span><br><span class="line">        i_min = j</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(j + <span class="number">1</span>, len(a)):</span><br><span class="line">            <span class="keyword">if</span> a[i] &lt; a[i_min]:</span><br><span class="line">                i_min = i</span><br><span class="line">        <span class="keyword">if</span> i_min != j:</span><br><span class="line">            a[i_min], a[j] = a[j], a[i_min]</span><br></pre></td></tr></table></figure><h1 id="å†’æ³¡æŽ’åº">å†’æ³¡æŽ’åº</h1><p>å†’æ³¡æŽ’åºï¼ˆBubble sortï¼‰é€šè¿‡ä¾æ¬¡æ¯”è¾ƒä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ï¼Œå¦‚æžœå®ƒä»¬çš„é¡ºåºå…³ç³»æ˜¯é”™è¯¯çš„ï¼Œå°±äº¤æ¢å®ƒä»¬ã€‚æ­£å¦‚å®ƒçš„å‘½åä¸€æ ·ï¼Œæ¯”è¾ƒå¤§çš„å…ƒç´ å…ˆæµ®åˆ°æ•°ç»„é¡¶ç«¯ã€‚</p><p>å†’æ³¡æŽ’åºç¤ºæ„å›¾ï¼ˆå‡ºè‡ª<a href="https://en.wikipedia.org/wiki/Bubble_sort" title="å†’æ³¡æŽ’åº" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘ï¼šBubble sort</a>ï¼‰ï¼š</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/c/c8/Bubble-sort-example-300px.gif" title="å†’æ³¡æŽ’åºåŠ¨æ€ç¤ºæ„å›¾"></p><h2 id="å®žçŽ°-2">å®žçŽ°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bubble_sort(A):</span><br><span class="line">    n = A.length</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">0</span> to n - <span class="number">1</span>:       <span class="comment"># æ¯æ¬¡å¾ªçŽ¯å°†ä¸‹ä¸€ä¸ªæœ€å¤§å…ƒç´ å†’æ³¡åˆ°æ­£ç¡®ä½ç½®</span></span><br><span class="line">        swapped = false</span><br><span class="line">        <span class="keyword">for</span> j = <span class="number">1</span> to n - i:   <span class="comment"># åŽiä½å…ƒç´ å¤§äºŽä¹‹å‰çš„å…ƒç´ ä¸”å·²ç»æŽ’å¥½åº</span></span><br><span class="line">            <span class="keyword">if</span> A[j - <span class="number">1</span>] &gt; A[j]:</span><br><span class="line">                exchange A[j] <span class="keyword">with</span> A[j - <span class="number">1</span>]</span><br><span class="line">                swapped = true</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> swapped:       <span class="comment"># ç»“æŸæŽ’åº</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–">ä¼˜åŒ–</h3><p>ä¸Žå…¶è®°å½•swapped=true or falseï¼Œä¸å¦‚è®°å½•ä¸‹æœ€åŽå‘ç”Ÿäº¤æ¢çš„ä½ç½®iï¼Œä¹‹åŽæ²¡æœ‰å‘ç”Ÿäº¤æ¢æ„å‘³ç€iä¹‹åŽçš„å…ƒç´ å…¨éƒ¨å¤§äºŽiä¹‹å‰çš„å…ƒç´ ä¸”å·²ç»æŒ‰åºæŽ’å¥½ã€‚é‚£ä¹ˆåœ¨ä¸‹æ¬¡å†’æ³¡å‰ï¼Œç»“æŸä½ç½®å¯ä»¥ç›´æŽ¥è·³åˆ°iã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bubble_sort(A):</span><br><span class="line">    target = A.length</span><br><span class="line">    <span class="keyword">while</span> target &gt; <span class="number">1</span>:</span><br><span class="line">        last_swap = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j = <span class="number">1</span> to target - <span class="number">1</span>:   <span class="comment"># targetåŠtargetä¹‹åŽçš„å…ƒç´ å¤§äºŽä¹‹å‰çš„å…ƒç´ ä¸”å·²ç»æŽ’å¥½åº</span></span><br><span class="line">            <span class="keyword">if</span> A[j - <span class="number">1</span>] &gt; A[j]:</span><br><span class="line">                exchange A[j] <span class="keyword">with</span> A[j - <span class="number">1</span>]</span><br><span class="line">                last_swap = j</span><br><span class="line">        target = last_swap</span><br></pre></td></tr></table></figure><h2 id="åˆ†æž-2">åˆ†æž</h2><p>å†’æ³¡æŽ’åºçš„å¹³å‡æ—¶é—´å’Œæœ€åæ—¶é—´å¤æ‚åº¦ä¸º<span class="math inline">\(O(n^2)\)</span>ã€‚åœ¨å®žé™…åº”ç”¨ä¸­ï¼Œæ—¶é—´å¤æ‚åº¦åŒæ ·æ˜¯<span class="math inline">\(O(n^2)\)</span>çš„æ’å…¥æŽ’åºä¸€èˆ¬æ¯”å†’æ³¡æŽ’åºè¦å¿«ï¼Œæ›´ä¸ç”¨è¯´è¿˜æœ‰å…¶ä»–æ›´å¿«çš„æŽ’åºç®—æ³•ã€‚</p><p>å†’æ³¡æŽ’åºå¯ä»¥ç”¨æ¥æ£€æµ‹ä¸€ä¸ªæ•°ç»„æ˜¯å¦å·²ç»æŽ’å¥½åºï¼Œå³å†’æ³¡æŽ’åºçš„æœ€ä½³æƒ…å†µè¿è¡Œæ—¶é—´O(n)ã€‚æ’å…¥æŽ’åºåŒæ ·å¯ä»¥åœ¨O(n)æ—¶é—´å†…æ£€æµ‹ä¸€ä¸ªæ•°ç»„æ˜¯å¦æŽ’å¥½åºï¼Œä¸”æ¯”å†’æ³¡æŽ’åºå¥½ã€‚</p><h2 id="ä»£ç -2">ä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble_sort</span><span class="params">(a)</span>:</span></span><br><span class="line">    target = len(a)</span><br><span class="line">    <span class="keyword">while</span> target &gt; <span class="number">1</span>:</span><br><span class="line">        last_swapped = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, target):</span><br><span class="line">            <span class="keyword">if</span> a[j - <span class="number">1</span>] &gt; a[j]:</span><br><span class="line">                a[j - <span class="number">1</span>], a[j] = a[j], a[j - <span class="number">1</span>]</span><br><span class="line">                last_swapped = j</span><br><span class="line">        target = last_swapped</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> sort </tag>
            
            <tag> algorithms </tag>
            
            <tag> comparison sort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †å’Œå †æŽ’åº</title>
      <link href="/notes/introduction-to-algorithms/heaps-and-heapsort/"/>
      <url>/notes/introduction-to-algorithms/heaps-and-heapsort/</url>
      
        <content type="html"><![CDATA[<h1 id="å †">å †</h1><p>å †ï¼ˆHeapï¼‰å§‹äºŽ<a href="https://en.wikipedia.org/wiki/J._W._J._Williams" target="_blank" rel="noopener">J. W. J. Williams</a>åœ¨ 1964 å¹´å‘è¡¨çš„å †æŽ’åºï¼ˆheap sortï¼‰ã€‚</p><p>å †æ˜¯ä¸€ç§åŸºäºŽæ ‘çš„æ•°æ®ç»“æž„ï¼Œä¸€æ£µæ»¡è¶³ä»¥ä¸‹æ€§è´¨çš„å®Œå…¨æ ‘å¯ç§°ä¸ºå †ã€‚</p><blockquote><p>ç»™å®šå †ä¸­ä»»æ„èŠ‚ç‚¹ <code>P</code> å’Œ <code>C</code>ï¼Œè‹¥ <code>P</code> æ˜¯ <code>C</code> çš„æ¯èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ <code>P</code> çš„å€¼å°äºŽç­‰äºŽï¼ˆæˆ–å¤§äºŽç­‰äºŽï¼‰<code>C</code> çš„å€¼ã€‚</p><ol type="1"><li>è‹¥ <code>P</code> çš„å€¼å°äºŽç­‰äºŽ <code>C</code> çš„å€¼ï¼Œç§°ä¸ºæœ€å°å †ï¼ˆmin heapï¼‰ã€‚</li><li>è‹¥ <code>P</code> çš„å€¼å¤§äºŽç­‰äºŽ <code>C</code> çš„å€¼ï¼Œç§°ä¸ºæœ€å¤§å †ï¼ˆmax heapï¼‰ã€‚</li></ol></blockquote><p>åœ¨å †ä¸­æœ€é¡¶ç«¯çš„èŠ‚ç‚¹ç§°ä¸ºæ ¹èŠ‚ç‚¹ï¼ˆroot nodeï¼‰ï¼Œæ ¹èŠ‚ç‚¹æœ¬èº«æ²¡æœ‰æ¯èŠ‚ç‚¹ï¼ˆparent nodeï¼‰ã€‚</p><p>å¸¸è§çš„å †æœ‰äºŒå‰å †ã€æ–æ³¢é‚£å¥‘å †ç­‰ã€‚</p><a id="more"></a><h1 id="æ“ä½œ">æ“ä½œ</h1><p>ä¸€ä¸ªå †åº”è¯¥æ”¯æŒä»¥ä¸‹å¸¸è§æ“ä½œï¼ˆå‚è€ƒäº†<a href="https://en.wikipedia.org/wiki/Heap_(data_structure)" title="Heap" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a>ï¼‰ã€‚</p><ul><li><code>peek()</code>ï¼šè¿”å›žå †é¡¶å…ƒç´ ã€‚</li><li><code>pop()</code>ï¼šè¿”å›žå¹¶ç§»é™¤å †é¡¶å…ƒç´ ï¼Œéœ€è¦è°ƒæ•´å †ã€‚</li><li><code>append(x)</code>ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ â€‹ï¼Œéœ€è¦è°ƒæ•´å †ä»¥æ»¡è¶³å †çš„æ€§è´¨ã€‚</li><li><code>replace()</code>ï¼šç›¸å½“äºŽä¸€æ¬¡ <code>pop</code> ä¹‹åŽ <code>append</code>ã€‚ä½†æ¯”åˆ†åˆ«æ‰§è¡Œæ›´æ•ˆçŽ‡ï¼Œå› ä¸ºåªéœ€è¦è°ƒæ•´ä¸€æ¬¡å †ã€‚</li></ul><hr><ul><li><code>heapify()</code>ï¼šåˆ›å»ºä¸€ä¸ªå †ã€‚åªéœ€è¦è°ƒç”¨ä¸€æ¬¡ã€‚</li><li><code>merge(other)</code>ï¼šåˆå¹¶ other ä¸­çš„å…ƒç´ åˆ°å †ã€‚</li></ul><hr><ul><li><code>size()</code>ï¼šè¿”å›žå †ä¸­å…ƒç´ ä¸ªæ•°ã€‚</li><li><code>is_empty()</code>ï¼šè¿”å›žæ˜¯å¦æ˜¯ç©ºå †ã€‚</li></ul><hr><ul><li><code>increase_key(i, x)</code>ï¼šå¢žå¤§å…ƒç´ çš„å€¼ã€‚</li><li><code>decrease_key(i, x)</code>ï¼šå‡å°å…ƒç´ çš„å€¼ã€‚</li><li><code>delete(i)</code>ï¼šåˆ é™¤æŒ‡å®šçš„ä¸€ä¸ªå…ƒç´ ã€‚</li><li><code>sift_up(i)</code>ï¼šä¸æ–­ä¸Šç§»å…ƒç´ ï¼Œç›´åˆ°æ»¡è¶³æœ€å°å †çš„æ€§è´¨ã€‚</li><li><code>sift_down(i)</code>ï¼šä¸æ–­ä¸‹ç§»å…ƒç´ ï¼Œç›´åˆ°æ»¡è¶³æœ€å¤§å †çš„æ€§è´¨ã€‚</li></ul><h1 id="å®žçŽ°">å®žçŽ°</h1><p>å †é€šå¸¸ç”¨æ•°ç»„ï¼ˆé™æ€æˆ–åŠ¨æ€ï¼‰å®žçŽ°ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¿å­˜æŒ‡é’ˆã€‚</p><p>æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯ <code>A[0]</code>ï¼Œç»™å®šä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹æ ‡ <code>i</code>ï¼Œé€šè¿‡è®¡ç®—å¯ä»¥å¾—åˆ°å®ƒçš„æ¯èŠ‚ç‚¹ã€å·¦å­©å­å’Œå³å­©å­èŠ‚ç‚¹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">parent(i):</span><br><span class="line">    <span class="keyword">return</span> floor((i<span class="number">-1</span>) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">left_child(i):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">right_child(i):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * i + <span class="number">2</span></span><br></pre></td></tr></table></figure><p><img src="/uploads/image/introduction-to-algorithms/heap-and-array.png"></p><h2 id="ç»´æŠ¤å †çš„æ€§è´¨">ç»´æŠ¤å †çš„æ€§è´¨</h2><p>ä»¥æœ€å¤§å †ä¸ºä¾‹ï¼Œå¦‚ä½•ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ä½¿ä¹‹æ»¡è¶³æœ€å¤§å †æ€§è´¨ã€‚è€ƒè™‘ä¸‹é¢è¿™ç§æƒ…å†µã€‚</p><ul><li>å‰ææ¡ä»¶ï¼š<strong>æ ¹èŠ‚ç‚¹</strong>ä¸º <code>left_child(i)</code> å’Œ <code>right_child(i)</code> çš„äºŒå‰æ ‘éƒ½æ˜¯æœ€å¤§å †ã€‚</li></ul><p><code>A[i]</code> æœ‰å¯èƒ½å°äºŽå…¶å­©å­èŠ‚ç‚¹ï¼Œè¿™è¿èƒŒäº†æœ€å¤§å †çš„æ€§è´¨ã€‚<code>sift_down()</code> æ–¹æ³•é€šè¿‡è®© <code>A[i]</code> åœ¨æœ€å¤§å †ä¸­â€œé€çº§ä¸‹é™â€ï¼Œä»Žè€Œä½¿ä¸‹æ ‡ä¸º <code>i</code> çš„å­æ ‘é‡æ–°éµå¾ªæœ€å¤§å †çš„æ€§è´¨ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/heap-sift-down.png"></p><p>å…³äºŽé€çº§ä¸‹é™æ­£ç¡®æ€§çš„æ€è€ƒï¼šæ»¡è¶³å‰ææ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œ</p><p>å‡è®¾æ ¹èŠ‚ç‚¹ <code>i</code> æœ‰å­èŠ‚ç‚¹ <code>x, y</code>ï¼Œå…¶ä¸­å€¼æœ€å¤§çš„æ˜¯å­èŠ‚ç‚¹ <code>x</code>ã€‚äº¤æ¢ <code>i</code> ä¸Ž <code>x</code> çš„å€¼ï¼ŒçŽ°åœ¨ <code>A[i] &gt; A[x]</code>ï¼Œæ»¡è¶³æœ€å¤§å †çš„æ€§è´¨ã€‚ä½† <code>x</code> çš„å€¼ç›¸æ¯”äº¤æ¢å‰å˜å°äº†ï¼Œæ‰€ä»¥å¯èƒ½å°äºŽå…¶å­èŠ‚ç‚¹çš„å€¼ã€‚</p><p>çŽ°åœ¨èŠ‚ç‚¹ <code>x</code> å¯èƒ½å°äºŽå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œå…¶å­èŠ‚ç‚¹å‡å¤§äºŽæˆ–ç­‰äºŽä¸‹ä¸€å±‚å­èŠ‚ç‚¹çš„å€¼ã€‚ç¬¦åˆå‰ææ¡ä»¶ï¼Œæ‰€ä»¥å¯¹ <code>x</code> é€’å½’è°ƒç”¨ <code>sift_down</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sift_down(A, i):</span><br><span class="line">    l = left_child(i)</span><br><span class="line">    r = right_child(i)</span><br><span class="line">    <span class="keyword">if</span> l &lt; size() <span class="keyword">and</span> A[l] &gt; A[i]:  <span class="comment"># æ‰¾æœ€å¤§å€¼</span></span><br><span class="line">        largest = l</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        largest = i</span><br><span class="line">    <span class="keyword">if</span> r &lt; size() <span class="keyword">and</span> A[r] &gt; A[largest]:</span><br><span class="line">        largest = r</span><br><span class="line">    <span class="keyword">if</span> largest != i:              <span class="comment"># è¿åæœ€å¤§å †æ€§è´¨</span></span><br><span class="line">        exchange A[i] <span class="keyword">with</span> A[largest]</span><br><span class="line">        sift_down(A, largest)     <span class="comment"># é€’å½’</span></span><br></pre></td></tr></table></figure><p><code>sift_down</code> çš„æ—¶é—´å¤æ‚åº¦ï¼š</p><p>åœ¨ä¸€æ£µå¤§å°ä¸º <code>n</code> â€‹çš„å­æ ‘ä¸Šï¼Œè¿è¡Œ <code>sift_down</code> çš„æ—¶é—´ <code>T(n)</code> åŒ…æ‹¬ï¼šæ¯”è¾ƒä¸‰ä¸ªèŠ‚ç‚¹å¤§å°å…³ç³»ä»¥åŠäº¤æ¢å€¼çš„æ—¶é—´ä»£ä»· <span class="math inline">\(\Theta(1)\)</span>ï¼ŒåŠ ä¸Šåœ¨ä¸€æ£µå­æ ‘ä¸Šè¿è¡Œ <code>sift_down</code> çš„æ—¶é—´ã€‚å­æ ‘çš„å¤§å°è‡³å¤šä¸º <code>2n/3</code>ï¼ˆæœ€åº•å±‚æ­£å¥½åŠæ»¡çš„æ—¶å€™ï¼Œå³æœ€åŽä¸€å±‚å·¦å­æ ‘èŠ‚ç‚¹å¡«æ»¡ï¼Œå³å­æ ‘èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼‰ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°åˆ»ç”»ç¨‹åºè¿è¡Œæ—¶é—´çš„é€’å½’å¼ï¼š<span class="math inline">\(T(n)\le\Theta(1)+T(2n/3)\)</span>ã€‚è§£å¾— <span class="math inline">\(T(n)=O(\lg{n})\)</span>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽä¸€æ£µæ ‘é«˜ä¸º <code>h</code> çš„èŠ‚ç‚¹æ¥è¯´ï¼Œ<code>sift_down</code> çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <span class="math inline">\(O(h)\)</span>ã€‚</p><p>å…³äºŽä¸€æ£µå­æ ‘çš„å¤§å°è‡³å¤šä¸º <code>2n/3</code> çš„ç”±æ¥ã€‚</p><p>é¦–å…ˆæ˜Žç¡®å…³äºŽæ ‘çš„ä¸¤ä¸ªæ€§è´¨ï¼š</p><ol type="1"><li>å¦‚æžœä»¥æŸä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘æ˜¯å®Œå…¨æ ‘ï¼Œé‚£ä¹ˆå®ƒçš„å·¦å­æ ‘å¤§å°å¤§äºŽç­‰äºŽå³å­æ ‘å¤§å°ã€‚å› ä¸ºå®Œå…¨æ ‘çš„æœ€åŽä¸€å±‚æ˜¯ä»Žå·¦åˆ°å³å¡«å…¥çš„ã€‚</li><li>å¦‚æžœä¸€æ£µæ»¡äºŒå‰æ ‘çš„æœ€åŽä¸€å±‚èŠ‚ç‚¹æ•°ç›®ä¸º <code>n</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‘çš„å¤§å°ä¸º <code>2n-1</code>ã€‚å› ä¸ºæ»¡äºŒå‰æ ‘ç¬¬ <code>i(i&gt;=0)</code> å±‚èŠ‚ç‚¹æ•°é‡æ˜¯ <span class="math inline">\(2^i\)</span>ã€‚</li></ol><p>æ ¹æ®æ€§è´¨ 1ï¼Œåªéœ€è¦è€ƒè™‘å·¦å­æ ‘æœ€å¤šä¸ºæ¯æ ‘çš„å‡ åˆ†ä¹‹å‡ å³å¯ã€‚</p><p>å‡è®¾ä¸€ä¸ªå®Œå…¨æ ‘çš„å¤§å°ä¸º <code>n</code>ï¼Œå®ƒçš„å·¦å­æ ‘å¤§å°ä¸º <code>i</code>ï¼Œæ¯”å€¼ <code>i/n</code> æ ¹æ®æœ€åº•å±‚èŠ‚ç‚¹æ•°ç›®è€Œå˜åŠ¨ã€‚è§‚å¯Ÿæœ€åº•å±‚èŠ‚ç‚¹æ•°ç›®ä»Ž 0 é€æ¸å¢žé•¿æ—¶è¯¥æ¯”å€¼çš„å˜åŒ–æƒ…å†µã€‚</p><ul><li><p>å½“æ–°å¢žèŠ‚ç‚¹å±žäºŽå·¦å­æ ‘æ—¶ï¼Œæ¯”å€¼ç”± <code>i/n</code> å˜æˆ <code>(i+1)/(n+1)</code>ï¼Œæ¯”å€¼å¢žå¤§ã€‚</p></li><li><p>å½“æ–°å¢žèŠ‚ç‚¹å±žäºŽå³å­æ ‘æ—¶ï¼Œæ¯”å€¼ç”± <code>i/n</code> å˜æˆ <code>i/(n+1)</code>ï¼Œæ¯”å€¼å‡å°ã€‚</p></li></ul><p>å› æ­¤å½“å·¦å­æ ‘æ°å¥½å¡«æ»¡ï¼ˆæœ€åº•å±‚æ°å¥½åŠæ»¡ï¼‰æ—¶ï¼Œæ¯”å€¼æœ€å¤§ã€‚</p><p>è®¾æ­¤æ—¶æœ€ä½Žå±‚èŠ‚ç‚¹ä¸ªæ•°ä¸º <code>x</code>ï¼Œæ³¨æ„è¿™ <code>x</code> ä¸ªèŠ‚ç‚¹æ­£å¥½å¡«æ»¡å·¦å­æ ‘æœ€åº•å±‚ï¼Œåˆ™æ ¹æ®æ€§è´¨ 2ï¼Œ<code>i=2x-1</code>ï¼Œ<span class="math inline">\(n=2*i+1-x=3x-1\)</span>ã€‚</p><p>æ‰€ä»¥å¾—åˆ° <span class="math inline">\(i/n=(2x-1)/(3x-1)\le2/3\)</span>ã€‚å³å¤§å°ä¸º <code>n</code> çš„æ ‘ä¸­ï¼Œå­æ ‘çš„å¤§å°è‡³å¤šä¸º <code>2n/3</code>ã€‚</p><h2 id="å»ºå †">å»ºå †</h2><p>åŒæ ·ä»¥æœ€å¤§å †ä¸ºä¾‹ï¼Œå¯ä»¥ç”¨<strong>è‡ªåº•å‘ä¸Š</strong>çš„æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ <code>sift_down</code>ï¼Œå°†ä¸€ä¸ªæ•°ç»„è½¬æ¢ä¸ºæœ€å¤§å †ã€‚è¿‡ç¨‹ <code>heapify</code> å¯¹æ ‘ä¸­éžå¶å­èŠ‚ç‚¹éƒ½è°ƒç”¨ä¸€æ¬¡ <code>sift_down</code>ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">heapify(A):</span><br><span class="line">    <span class="keyword">for</span> i = parent(size()<span class="number">-1</span>) downto <span class="number">0</span>:</span><br><span class="line">        sift_down(A, i)</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å¾ªçŽ¯ä¸å˜é‡éªŒè¯è¯¥è¿‡ç¨‹çš„æ­£ç¡®æ€§ã€‚</p><blockquote><p>æ¯ä¸€æ¬¡ <code>for</code> å¾ªçŽ¯å¼€å§‹å‰ï¼ŒèŠ‚ç‚¹ <code>i, i+1, ..., size()</code> éƒ½æ˜¯ä¸€ä¸ªæœ€å¤§å †çš„æ ¹èŠ‚ç‚¹ã€‚</p></blockquote><p>éœ€è¦è¯æ˜Žæ­¤å¾ªçŽ¯ä¸å˜é‡åœ¨å¾ªçŽ¯å¼€å§‹å‰ï¼Œè¿­ä»£æ—¶ä»¥åŠç»“æŸåŽéƒ½æˆç«‹ã€‚</p><ul><li>åˆå§‹åŒ–ï¼šç¬¬ä¸€æ¬¡è¿­ä»£å‰ï¼Œ<code>i</code> ä¹‹åŽçš„èŠ‚ç‚¹éƒ½æ˜¯å¶èŠ‚ç‚¹ï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯æœ€å¤§å †çš„æ ¹èŠ‚ç‚¹ã€‚</li><li>ä¿æŒï¼šæ³¨æ„åˆ°èŠ‚ç‚¹ <code>i+1</code>â€‹ å§‹ç»ˆæ¯”iå…ˆè°ƒç”¨ <code>sift_down</code> è¿‡ç¨‹ï¼Œæ ¹æ®å¾ªçŽ¯ä¸å˜é‡ï¼Œå®ƒä»¬éƒ½æ˜¯æœ€å¤§å †çš„æ ¹èŠ‚ç‚¹ã€‚</li><li>ç»ˆæ­¢ï¼šç»ˆæ­¢æ—¶ <code>i=-1â€‹</code>ï¼Œæ ¹æ®å¾ªçŽ¯ä¸å˜é‡èŠ‚ç‚¹ <code>0,1,...,size()</code> éƒ½æ˜¯æœ€å¤§å †çš„æ ¹èŠ‚ç‚¹ï¼Œç‰¹åˆ«çš„ï¼Œ0 æ˜¯å †çš„é¡¶ç‚¹ã€‚</li></ul><p>ä¹‹å‰åˆ†æžäº† <code>sift_down(A, i)</code> çš„è¿è¡Œæ—¶é—´ä¸ŽèŠ‚ç‚¹ <code>i</code> æ‰€å¤„é«˜åº¦æœ‰å…³ï¼Œåœ¨å»ºå †è¿‡ç¨‹ä¸­ï¼Œä¸åŒçš„èŠ‚ç‚¹æ‰€å¤„é«˜åº¦å¯èƒ½ä¸åŒï¼Œæƒ³å‡†ç¡®è®¡ç®—å»ºå †çš„æ—¶é—´å¤æ‚åº¦åˆ©ç”¨äº†ä¸‹é¢æ‰€ç¤ºçš„æ ‘çš„ç‰¹æ€§ã€‚</p><ul><li>ä¸€æ£µå«æœ‰ <code>n</code> ä¸ªå…ƒç´ çš„å®Œå…¨æ ‘ï¼Œåœ¨é«˜åº¦ <code>h</code> å¤„ï¼Œæœ€å¤šæœ‰ <span class="math inline">\(\lceil{n/2^{h+1}}\rceil\)</span> ä¸ªå…ƒç´ ã€‚æ ¹èŠ‚ç‚¹æ‰€å¤„é«˜åº¦ä¸º 0ã€‚</li></ul><p>æ ¹æ®è¿™æ¡æ€§è´¨ï¼Œè¿è¡Œæ—¶é—´å¯ä»¥åˆ»ç”»ä¸º</p><p><span class="math display">\[\begin{aligned}T(n)&amp;=\sum_{h=0}^{\lfloor\log_{2}n\rfloor}\lceil{n/2^{h+1}}\rceil*O(h)\\&amp;=O(n\sum_{h=0}^{\lfloor\log_{2}n\rfloor}\frac{h}{2^h})\end{aligned}\\\begin{aligned}\because&amp;\sum_{k=0}^{\infty}kx^k=\frac{x}{(1-x)^2}(|x|\le1)\\\therefore&amp;\sum_{h=0}^{\infty}\frac{h}{2^h}=\frac{1/2}{(1-\frac{1}{2})^2}=2\end{aligned}\]</span></p><p>å°†å…¶å¸¦å…¥å¯å¾—</p><p><span class="math display">\[\begin{aligned}T(n)&amp;=O(n\sum_{h=0}^{\infty}\frac{h}{2^h})\\&amp;=O(n)\end{aligned}\]</span> ç”±æ­¤å¯å¾—å‡ºç»“è®ºï¼Œ<code>heapify</code> å¯ä»¥åœ¨çº¿æ€§æ—¶é—´å†…å°†ä¸€ä¸ªæ•°ç»„è½¬æ¢æˆä¸€ä¸ªå †ã€‚</p><h2 id="å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•</h2><ul><li><code>sift_up</code>ï¼šä¸Ž <code>sift_down</code> ç›¸åï¼Œå½“èŠ‚ç‚¹ <code>i</code> çš„å€¼å¤§äºŽå…¶æ¯èŠ‚ç‚¹çš„å€¼ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹å‡æ»¡è¶³å †çš„æ€§è´¨æ—¶ï¼Œé€šè¿‡æ­¤è¿‡ç¨‹å°†èŠ‚ç‚¹iä¸æ–­ä¸Šç§»ï¼Œç›´åˆ°æ»¡è¶³å †çš„æ€§è´¨ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sift_up(A, i):</span><br><span class="line">    <span class="keyword">while</span> i&gt;<span class="number">1</span> <span class="keyword">and</span> A[parent(i)] &lt; A[i]:</span><br><span class="line">        exchange A[parent(i)] <span class="keyword">with</span> A[i]</span><br><span class="line">        i = parent(i)</span><br></pre></td></tr></table></figure><ul><li><code>increase_key</code>ï¼šå½“å †ä¸­æŸä¸ªèŠ‚ç‚¹çš„å€¼å˜å¤§æ—¶ï¼Œå¯èƒ½å¤§äºŽå…¶æ¯èŠ‚ç‚¹ï¼Œä¸Žä¸Šè¿°æƒ…å†µç›¸åŒã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">increase_key(A, i):</span><br><span class="line">    sift_up(A, i)</span><br></pre></td></tr></table></figure><ul><li><code>decrease_key</code>ï¼šä¸Ž<code>sift_down</code>çš„æƒ…å†µç›¸åŒã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">decrease_key(A, i):</span><br><span class="line">    sift_down(A, i)</span><br></pre></td></tr></table></figure><ul><li><code>replace</code>ï¼šæ›´æ–°åŽçš„å€¼å¤§äºŽåŽŸæ¥çš„å€¼ï¼Œè°ƒç”¨ <code>increase_key</code>ï¼›å°äºŽåŽŸæ¥çš„å€¼ï¼Œè°ƒç”¨ <code>decrease_key</code>ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">replace(A, i, x):</span><br><span class="line">    <span class="keyword">if</span> A[i] &lt; x:</span><br><span class="line">        increase_key(A, i)</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> A[i] &gt; x:</span><br><span class="line">        decrease_key(A, i)</span><br></pre></td></tr></table></figure><ul><li><code>append</code>ï¼šå…ˆæ·»åŠ ä¸€ä¸ªå€¼ä¸ºæ— ç©·å°çš„å…ƒç´ åˆ°å †çš„æœ«å°¾ï¼Œç„¶åŽè°ƒç”¨ <code>increase_key</code> ä¿®æ”¹å€¼ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">append(A, x):</span><br><span class="line">    A.heap_size = A.heap_size + <span class="number">1</span></span><br><span class="line">    A[A.heap_size - <span class="number">1</span>] = -inf</span><br><span class="line">    increase_key(A, A.heap_size - <span class="number">1</span>, x)</span><br></pre></td></tr></table></figure><hr><ul><li><code>peek</code>ï¼šç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯å †é¡¶å…ƒç´ ï¼Œç›´æŽ¥è¿”å›žå³å¯ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">peek():</span><br><span class="line">    <span class="keyword">return</span> A[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><ul><li><code>pop</code>ï¼šå°†å †é¡¶å…ƒç´ ä¿å­˜ï¼Œç„¶åŽç”¨æœ€åŽä¸€ä¸ªå…ƒç´ æ›¿æ¢å †é¡¶å…ƒç´ ï¼Œåˆ é™¤æœ€åŽä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ—¶å †é¡¶å…ƒç´ å¯èƒ½è¿èƒŒå †çš„æ€§è´¨ï¼Œå¯¹å…¶è°ƒç”¨ <code>sift_down</code>ã€‚æˆ–è€…è°ƒç”¨ <code>decrease_key</code> å°†å †é¡¶å…ƒç´ çš„å€¼å‡å°åˆ°æœ€åŽä¸€ä¸ªå…ƒç´ å€¼ï¼Œä¸¤è€…è°ƒç”¨çš„è¿‡ç¨‹æ—¶ä¸€æ ·çš„ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pop():</span><br><span class="line">    r = A[<span class="number">0</span>]</span><br><span class="line">    A[<span class="number">0</span>] = A[A.lenght - <span class="number">1</span>]</span><br><span class="line">    A.heap_size = A.heap_size - <span class="number">1</span></span><br><span class="line">    sift_down(A, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure><ul><li><code>delete</code>ï¼šä¸Ž <code>pop</code> è¿‡ç¨‹ç›¸åŒï¼Œ<code>pop</code> å°±æ˜¯ç‰¹æ®Šçš„ <code>delete</code> è¿‡ç¨‹ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">delete(A, i):</span><br><span class="line">    A[i] = A[A.lenght - <span class="number">1</span>]</span><br><span class="line">    A.heap_size = A.heap_size - <span class="number">1</span></span><br><span class="line">    sift_down(A, i)</span><br></pre></td></tr></table></figure><hr><ul><li><code>merge</code>ï¼šé€æ¬¡è°ƒç”¨ <code>append</code> æ·»åŠ å¦ä¸€ä¸ªå †ä¸­çš„å…ƒç´ ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">merge(A, o):</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> o:</span><br><span class="line">        append(A, e)</span><br></pre></td></tr></table></figure><ul><li><code>meld</code>ï¼šå–å‡ºä¸¤ä¸ªå †ä¸­çš„å…ƒç´ ï¼Œåˆå¹¶æˆæ–°çš„åˆ—è¡¨ï¼Œè°ƒç”¨ <code>heapify</code> åˆ›å»ºå †ã€‚</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">meld(A, B, C):</span><br><span class="line">    C = A + B</span><br><span class="line">    heapify(C)</span><br></pre></td></tr></table></figure><h1 id="ä»£ç ">ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parent</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="string">"""è®¡ç®—å…ƒç´ içš„æ¯èŠ‚ç‚¹ä½ç½®"""</span></span><br><span class="line">    <span class="keyword">return</span> math.floor((i - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">left_child</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="string">"""è®¡ç®—å…ƒç´ içš„å·¦å­©å­èŠ‚ç‚¹ä½ç½®"""</span></span><br><span class="line">    <span class="keyword">return</span> (i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">right_child</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="string">"""è®¡ç®—å…ƒç´ içš„å³å­©å­èŠ‚ç‚¹ä½ç½®"""</span></span><br><span class="line">    <span class="keyword">return</span> (i &lt;&lt; <span class="number">1</span>) + <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exchange</span><span class="params">(a, i, j)</span>:</span></span><br><span class="line">    <span class="string">"""äº¤æ¢å…ƒç´ iå’Œjçš„å€¼"""</span></span><br><span class="line">    a[i], a[j] = a[j], a[i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heap</span>:</span></span><br><span class="line">    <span class="string">"""æœ€å°å †"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žå †é¡¶å…ƒç´ """</span></span><br><span class="line">        <span class="keyword">return</span> self.value[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ é™¤å¹¶è¿”å›žå †é¡¶å…ƒç´ """</span></span><br><span class="line">        <span class="keyword">if</span> self.size() &gt; <span class="number">1</span>:  <span class="comment"># å †ä¸­å…ƒç´ å¤šäºŽ2ä¸ªæ—¶ï¼Œpop()ä¹‹åŽéœ€è¦è°ƒæ•´å †</span></span><br><span class="line">            m = self.value[<span class="number">0</span>]</span><br><span class="line">            self.value[<span class="number">0</span>] = self.value.pop(self.size() - <span class="number">1</span>)  <span class="comment"># å°†å †å°¾å…ƒç´ ç§»åŠ¨åˆ°å †é¡¶</span></span><br><span class="line">            self.sift_down(<span class="number">0</span>)  <span class="comment"># è°ƒæ•´å †</span></span><br><span class="line">            <span class="keyword">return</span> m</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å †ä¸­å…ƒç´ å°‘äºŽ2ä¸ªæ—¶ï¼Œç›´æŽ¥è°ƒç”¨listçš„pop()æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> self.value.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""æ·»åŠ å…ƒç´ """</span></span><br><span class="line">        self.value.append(x)</span><br><span class="line">        self.decrease_key(self.size() - <span class="number">1</span>, x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replace</span><span class="params">(self, i, x)</span>:</span></span><br><span class="line">        <span class="string">"""æ›¿æ¢å…ƒç´ çš„å€¼ï¼Œæ›¿æ¢å †é¡¶å…ƒç´ æ—¶æŒ‡å®ši=0"""</span></span><br><span class="line">        <span class="keyword">if</span> self.value[i] &lt; x:</span><br><span class="line">            self.increase_key(i, x)</span><br><span class="line">        <span class="keyword">elif</span> self.value[i] &gt; x:</span><br><span class="line">            self.decrease_key(i, x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">heapify</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""å»ºå †"""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(parent(self.size() - <span class="number">1</span>), <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            self.sift_down(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå¹¶å †"""</span></span><br><span class="line">        self.value.extend(other)</span><br><span class="line">        self.heapify()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¿”å›žå †çš„å¤§å°"""</span></span><br><span class="line">        <span class="keyword">return</span> len(self.value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºå †"""</span></span><br><span class="line">        <span class="keyword">return</span> self.size() == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">increase_key</span><span class="params">(self, i, x)</span>:</span></span><br><span class="line">        <span class="string">"""å¢žåŠ å…ƒç´ çš„å€¼"""</span></span><br><span class="line">        self.value[i] = x</span><br><span class="line">        self.sift_down(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrease_key</span><span class="params">(self, i, x)</span>:</span></span><br><span class="line">        <span class="string">"""å‡å°å…ƒç´ çš„å€¼"""</span></span><br><span class="line">        self.value[i] = x</span><br><span class="line">        self.sift_up(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">"""åˆ é™¤å…ƒç´ """</span></span><br><span class="line">        last = self.value.pop(self.size() - <span class="number">1</span>)  <span class="comment"># popå †å°¾å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> i &lt; self.size():  <span class="comment"># é˜²æ­¢åˆ é™¤å †ä¸­å”¯ä¸€å…ƒç´ æ—¶è¶Šç•Œ</span></span><br><span class="line">            self.decrease_key(i, last)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sift_up</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">"""ä¸Šæ»¤ï¼Œå°†å…ƒç´ æ”¾åˆ°æ­£ç¡®ä½ç½®"""</span></span><br><span class="line">        <span class="keyword">while</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> self.value[parent(i)] &gt; self.value[i]:</span><br><span class="line">            exchange(self.value, parent(i), i)</span><br><span class="line">            i = parent(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sift_down</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">"""ä¸‹æ»¤ï¼Œå°†å…ƒç´ æ”¾åˆ°æ­£ç¡®ä½ç½®"""</span></span><br><span class="line">        l, r = left_child(i), right_child(i)</span><br><span class="line">        <span class="keyword">if</span> l &lt; self.size() <span class="keyword">and</span> self.value[l] &lt; self.value[i]:</span><br><span class="line">            smallest = l</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            smallest = i</span><br><span class="line">        <span class="keyword">if</span> r &lt; self.size() <span class="keyword">and</span> self.value[r] &lt; self.value[smallest]:</span><br><span class="line">            smallest = r</span><br><span class="line">        <span class="keyword">if</span> smallest != i:</span><br><span class="line">            exchange(self.value, i, smallest)</span><br><span class="line">            self.sift_down(smallest)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxHeap</span><span class="params">(Heap)</span>:</span></span><br><span class="line">    <span class="string">"""æœ€å¤§å †"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.append(x)</span><br><span class="line">        self.increase_key(self.size() - <span class="number">1</span>, x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">increase_key</span><span class="params">(self, i, x)</span>:</span></span><br><span class="line">        self.value[i] = x</span><br><span class="line">        self.sift_up(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrease_key</span><span class="params">(self, i, x)</span>:</span></span><br><span class="line">        self.value[i] = x</span><br><span class="line">        self.sift_down(i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sift_down</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        l, r = left_child(i), right_child(i)</span><br><span class="line">        <span class="keyword">if</span> l &lt; self.size() <span class="keyword">and</span> self.value[l] &gt; self.value[i]:</span><br><span class="line">            largest = l</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            largest = i</span><br><span class="line">        <span class="keyword">if</span> r &lt; self.size() <span class="keyword">and</span> self.value[r] &gt; self.value[largest]:</span><br><span class="line">            largest = r</span><br><span class="line">        <span class="keyword">if</span> largest != i:</span><br><span class="line">            exchange(self.value, i, largest)</span><br><span class="line">            self.sift_down(largest)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sift_up</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> self.value[self.value.parent(i)] &lt; self.value[i]:</span><br><span class="line">            exchange(self.value, parent(i), i)</span><br><span class="line">            i = parent(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    min_heap = Heap([<span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">16</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">7</span>])</span><br><span class="line">    min_heap.heapify()</span><br><span class="line">    print(<span class="string">'min heap'</span>, min_heap.value)</span><br><span class="line"></span><br><span class="line">    max_heap = MaxHeap([<span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">16</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">7</span>])</span><br><span class="line">    max_heap.heapify()</span><br><span class="line">    print(<span class="string">'max heap'</span>, max_heap.value)</span><br></pre></td></tr></table></figure><p>ç»“æžœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">min heap [1, 2, 3, 4, 7, 9, 10, 14, 8, 16]</span><br><span class="line">max heap [16, 14, 10, 8, 7, 9, 3, 2, 4, 1]</span><br></pre></td></tr></table></figure><h1 id="åº”ç”¨">åº”ç”¨</h1><ul><li>å †æŽ’åº</li><li>ä¼˜å…ˆé˜Ÿåˆ—</li></ul><h1 id="å †æŽ’åº">å †æŽ’åº</h1><p>å †æŽ’åºï¼ˆHeapsortï¼‰æ˜¯ä¸€ç§æ¯”è¾ƒæŽ’åºç®—æ³•ã€‚å †æŽ’åºåœ¨ 1964 å¹´é¦–æ¬¡è¢«<a href="https://en.wikipedia.org/wiki/J._W._J._Williams" target="_blank" rel="noopener">J. W. J. Williams</a>æå‡ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯å †è¿™ç§æ•°æ®ç»“æž„é¦–æ¬¡å‡ºçŽ°ã€‚å †æŽ’åºæ˜¯ä¸€ç§åŽŸå€ï¼ˆIn-placeï¼‰ã€éžç¨³å®šï¼ˆNOT stableï¼‰æŽ’åºç®—æ³•ã€‚</p><p>å †æŽ’åºå¯ä»¥çœ‹ä½œæ˜¯é€‰æ‹©æŽ’åºçš„ä¼˜åŒ–ç‰ˆæœ¬ã€‚å †æŽ’åºä¸Žé€‰æ‹©æŽ’åºç±»ä¼¼ï¼Œå°†æ•°ç»„åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼ŒæœªæŽ’åºéƒ¨åˆ†å’Œå·²æŽ’åºéƒ¨åˆ†ã€‚ç®—æ³•æ¯æ¬¡ä»ŽæœªæŽ’åºéƒ¨åˆ†æå–æœ€å¤§å€¼æ”¾å…¥å·²æŽ’åºéƒ¨åˆ†ï¼Œå½“æœªæŽ’åºéƒ¨åˆ†ä¸ºç©ºæ—¶ï¼ŒæŽ’åºç»“æŸã€‚</p><p>é€‰æ‹©æŽ’åºé€šè¿‡ä¸€æ¬¡æ•°ç»„éåŽ†ï¼ˆæ—¶é—´å¤æ‚åº¦ <span class="math inline">\(\Theta(n)\)</span> èŽ·å–æœ€å¤§å€¼ã€‚è€Œå †æŽ’åºé€šè¿‡å †è¿™ç§æ•°æ®ç»“æž„å¿«é€ŸèŽ·å–æœ€å¤§å€¼ã€‚èŽ·å–çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <span class="math inline">\(\Theta(1)\)</span>ï¼Œä½†èŽ·å–ä¹‹åŽè¦èŠ±è´¹ <span class="math inline">\(\Theta(\lg{n})\)</span> æ—¶é—´è°ƒæ•´å †ï¼Œå› æ­¤æ€»è¿è¡Œæ—¶é—´ä¸º <span class="math inline">\(\Theta(1)+\Theta(\lg{n})=\Theta(\lg{n})\)</span>ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡ºå †æŽ’åºç›¸æ¯”äºŽé€‰æ‹©æŽ’åºæ”¹è¿›çš„ç‚¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€å¹…å…³äºŽå †æŽ’åºçš„ç¤ºæ„å›¾ï¼ˆå‡ºè‡ª<a href="https://en.wikipedia.org/wiki/Heapsort" title="Heapsort" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a>ï¼‰ã€‚</p><p><img src="/uploads/image/introduction-to-algorithms/sorting-heapsort-anim.gif"></p><h2 id="å®žçŽ°-1">å®žçŽ°</h2><p>æœ‰äº†å †å’Œå †æ”¯æŒçš„ä¸€äº›åŸºç¡€æ“ä½œåŽï¼Œå¯å®šä¹‰å †æŽ’åºçš„è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">heapsort(A):</span><br><span class="line">    heapify(A)                         <span class="comment"># Build a max heap with array A</span></span><br><span class="line">    <span class="keyword">for</span> i=A.length<span class="number">-1</span> downto <span class="number">1</span>:</span><br><span class="line">        exchange A[<span class="number">0</span>] <span class="keyword">with</span> A[i]</span><br><span class="line">        A.heap_size = A.heap_size - <span class="number">1</span></span><br><span class="line">        sift_down(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>åœ¨å…³äºŽå †çš„ä»‹ç»ä¸­ï¼Œæ‰€æœ‰åœ¨ <code>heap.data</code> ä¸­çš„æ•°éƒ½è¢«è®¤ä¸ºæ˜¯å †ä¸­çš„å…ƒç´ ï¼Œä½†æ˜¯å †æŽ’åºç®—æ³•ä¸ºäº†èŠ‚çœç©ºé—´è¢«è®¾è®¡æˆåŽŸå€ç®—æ³•ï¼Œ<code>heap.data</code> ä¸­éœ€è¦åŒæ—¶å­˜å‚¨å †ï¼ˆæœªæŽ’åºéƒ¨åˆ†ï¼‰å’Œéžå †ï¼ˆå·²æŽ’åºéƒ¨åˆ†ï¼‰ï¼Œå› æ­¤éœ€è¦åšç‚¹å°ä¿®æ”¹ï¼Œä¿è¯ <code>size()</code> å‡½æ•°è¿”å›žå †çš„è¾¹ç•Œï¼Œå½“è¶…å‡ºè¾¹ç•Œæ—¶ï¼Œå³ä½¿å­˜åœ¨å¯¹åº”æ•°æ®ä¹Ÿä¸è¢«è®¤ä¸ºæ˜¯å †ä¸­å…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">size():</span><br><span class="line">    <span class="keyword">return</span> heap_size</span><br></pre></td></tr></table></figure><p>å †æŽ’åºçš„è¿è¡Œæ—¶é—´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå»ºå †çš„æ—¶é—´ <span class="math inline">\(O(n)\)</span> å’Œ <code>n-1</code> æ¬¡è°ƒæ•´å †çš„æ—¶é—´ <span class="math inline">\(O(\lg{n})\)</span>ã€‚æ‰€ä»¥æ€»çš„è¿è¡Œæ—¶é—´æ˜¯</p><p><span class="math inline">\(T(n)=O(n)+(n-1)O(\lg{n})=O(n\lg{n})\)</span>ã€‚</p><h2 id="ä»£ç -1">ä»£ç </h2><p>ç»§æ‰¿å¹¶é‡å†™äº†å †çš„ä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> data_structure.heap <span class="keyword">import</span> MaxHeap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span><span class="params">(MaxHeap)</span>:</span></span><br><span class="line">    <span class="string">"""åŸºäºŽæœ€å¤§å †çš„å †æŽ’åºå®žçŽ°ï¼Œå®ƒæ˜¯åŽŸå€æŽ’åº"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, a)</span>:</span></span><br><span class="line">        MaxHeap.__init__(self, a)</span><br><span class="line">        self.heap_size = len(a)  <span class="comment"># å¢žåŠ heap_sizeå˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""é‡å†™æ–¹æ³•"""</span></span><br><span class="line">        <span class="keyword">return</span> self.heap_size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">heap_sort</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""æŽ’åºè¿‡ç¨‹ä¸»ä½“"""</span></span><br><span class="line">        self.heapify()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size() - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            self.value[<span class="number">0</span>], self.value[i] = self.value[i], self.value[<span class="number">0</span>]</span><br><span class="line">            self.heap_size -= <span class="number">1</span></span><br><span class="line">            self.sift_down(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [16, 14, 8, 10, 4, 7, 9, 3, 2, 1]</span><br><span class="line">Output: [1, 2, 3, 4, 7, 8, 9, 10, 14, 16]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Introduction to Algorithms </tag>
            
            <tag> sort </tag>
            
            <tag> data structures </tag>
            
            <tag> binary tree </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
