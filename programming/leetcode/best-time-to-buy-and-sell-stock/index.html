<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/uploads/icon/drop/128x128.png"><link rel="icon" type="image/png" sizes="32x32" href="/uploads/icon/drop/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/uploads/icon/drop/16x16.png"><link rel="mask-icon" href="/uploads/icon/drop/drop.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"cwscn.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1,width:240},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"manual"},fancybox:!1,mediumzoom:!0,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"fadeIn"}},path:"search.xml"}</script><meta name="description" content="At most 1 transaction Say you have an array for which the i-th element is the price of a given stock on day i. If you were only permitted to complete at most one transaction (i.e., buy one and sell on"><meta name="keywords" content="dynamic programming,leetcode"><meta property="og:type" content="article"><meta property="og:title" content="Best Time to Buy and Sell Stock"><meta property="og:url" content="https://cwscn.github.io/programming/leetcode/best-time-to-buy-and-sell-stock/index.html"><meta property="og:site_name" content="水滴"><meta property="og:description" content="At most 1 transaction Say you have an array for which the i-th element is the price of a given stock on day i. If you were only permitted to complete at most one transaction (i.e., buy one and sell on"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cwscn.github.io/uploads/image/leetcode/maximum_profit_graph.png"><meta property="og:updated_time" content="2020-07-16T13:33:31.641Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Best Time to Buy and Sell Stock"><meta name="twitter:description" content="At most 1 transaction Say you have an array for which the i-th element is the price of a given stock on day i. If you were only permitted to complete at most one transaction (i.e., buy one and sell on"><meta name="twitter:image" content="https://cwscn.github.io/uploads/image/leetcode/maximum_profit_graph.png"><link rel="canonical" href="https://cwscn.github.io/programming/leetcode/best-time-to-buy-and-sell-stock/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css"><link rel="stylesheet" href="//unpkg.com/video.js/dist/video-js.min.css"><link rel="stylesheet" href="/css/videojs-bilibili.css"><style>.aplayer.aplayer-arrow .aplayer-icon-loop,.aplayer.aplayer-arrow .aplayer-icon-order{display:inline-block}</style><title>Best Time to Buy and Sell Stock | 水滴</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">水滴</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">愿你走出半生 归来仍是少年</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">162</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">11</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">165</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-收藏"><a href="/favlist/" rel="section"><i class="fa fa-star fa-fw"></i> 收藏</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><meting-js server="netease" type="playlist" id="67155774" theme="#ff5555" loop="all" order="list" preload="none" volume="" mutex="" list-folded="NaN" fixed="true"></meting-js></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://cwscn.github.io/programming/leetcode/best-time-to-buy-and-sell-stock/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar/nekosensei.png"><meta itemprop="name" content="菜农陈文生"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="水滴"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Best Time to Buy and Sell Stock</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-07-16 21:33:31" itemprop="dateModified" datetime="2020-07-16T21:33:31+08:00">2020-07-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/programming/leetcode/best-time-to-buy-and-sell-stock/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/programming/leetcode/best-time-to-buy-and-sell-stock/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="at-most-1-transaction">At most 1 transaction</h1><p>Say you have an array for which the <code>i</code>-th element is the price of a given stock on day <code>i</code>.</p><p>If you were only permitted to complete at most one transaction (i.e., buy one and sell one share of the stock), design an algorithm to find the maximum profit.</p><p>Not that you cannnot sell a stock before you buy one.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [7,1,5,3,6,4]</span><br><span class="line">Output: 5</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [7,6,4,3,1]</span><br><span class="line">Output: 0</span><br></pre></td></tr></table></figure><h2 id="broute-force">Broute Force</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> sell <span class="keyword">in</span> range(<span class="number">1</span>, len(prices)):</span><br><span class="line">            <span class="comment"># range(sell + 1) also works.</span></span><br><span class="line">            <span class="comment"># prices[sell] is the minimum price by far,</span></span><br><span class="line">            <span class="comment"># prices[sell] - prices[min_price] = 0,</span></span><br><span class="line">            <span class="comment"># hence, res = max(res, 0)</span></span><br><span class="line">            min_price = min(prices[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(sell))</span><br><span class="line">            res = max(res, prices[sell] - prices[min_price])</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>We can use a variable to save the minimum price by far instead of computing repetitively.</p><a id="more"></a><h2 id="one-pass">One Pass</h2><p>Say the given array is <code>[7,1,5,3,6,4]</code>. If we plot the numbers of the given array on a graph, we get:</p><p><img src="/uploads/image/leetcode/maximum_profit_graph.png"></p><p><strong>The points of interest are the peaks and valleys in the given graph. We need to find the largest peak following the smallest valley.</strong> We can maintain two variables - <code>minprice</code> and <code>maxprofit</code> corresponding to the smallest valley and maximum profit obtained so far respectively.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        min_price, max_profit = float(<span class="string">'inf'</span>), <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            min_price = min(min_price, p)</span><br><span class="line">            max_profit = max(max_profit, p - min_price)</span><br><span class="line">        <span class="keyword">return</span> max_profit</span><br></pre></td></tr></table></figure><h2 id="maximum-subarray">Maximum Subarray</h2><p>We can transform the problem to the Maximum Subarray problem. Here gives the Dynamic Programming solution of the Maximum Subarray problem, see <a href="/programming/leetcode/maximum-subarray/" title="Maximum Subarray">Maximum Subarray</a> for other solutions.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        cur = res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(prices)):</span><br><span class="line">            cur = max(cur, <span class="number">0</span>) + prices[i] - prices[i - <span class="number">1</span>]</span><br><span class="line">            res = max(res, cur)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="at-most-2-transactions">At most 2 transactions</h1><p>Design an algorithm to find the maximum profit. You may complete at most two transactions.</p><p><strong>Note:</strong> You may not engage in multiple transactions at the same time (i.e., you must sell the stock before you buy again).</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [3,3,5,0,0,3,1,4]</span><br><span class="line">Output: 6</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,4,5]</span><br><span class="line">Output: 4</span><br></pre></td></tr></table></figure><p>Example 3:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [7,6,4,3,1]</span><br><span class="line">Output: 0</span><br></pre></td></tr></table></figure><h2 id="one-pass-1">One Pass</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Variation 1</span></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        profit1 = profit2 = <span class="number">0</span></span><br><span class="line">        min_price1 = min_price2 = float(<span class="string">'inf'</span>)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            profit2 = max(profit2, p - min_price2)</span><br><span class="line">            min_price2 = min(min_price2, p - profit1)</span><br><span class="line">            profit1 = max(profit1, p - min_price1)</span><br><span class="line">            min_price1 = min(min_price1, p)</span><br><span class="line">        <span class="keyword">return</span> profit2</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Variation 2</span></span><br><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        profit1 = profit2 = <span class="number">0</span></span><br><span class="line">        min_price1 = min_price2 = float(<span class="string">'inf'</span>)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            min_price1 = min(min_price1, p)</span><br><span class="line">            profit1 = max(profit1, p - min_price1)</span><br><span class="line">            <span class="comment"># considering how much we can earned if we have `profit1`</span></span><br><span class="line">            min_price2 = min(min_price2, p - profit1)</span><br><span class="line">            profit2 = max(profit2, p - min_price2)</span><br><span class="line">        <span class="keyword">return</span> profit2</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">e.g. prices = [1, 2, 0, 3, 1, 2, 0, 4]</span><br><span class="line">                     ^  ^        ^  ^</span><br><span class="line"></span><br><span class="line"> p                 1   2   0   3   1   2   0   4</span><br><span class="line">m1=min(m1, p)      1   1   0   0   0   0   0   0  &lt;- minimum price by far</span><br><span class="line">p1=max(p1, p-m1)   0   1   1   3   3   3   3   4  &lt;- maximum profit by far</span><br><span class="line">           p-p1    1   1  -1   0  -2  -1  -3   0  &lt;- the price we buy a stock if we&apos;ve earned p1</span><br><span class="line">m2=min(m2, p-p1)   1   1  -1  -1  -2  -2  -3  -3  &lt;- minimum price if we&apos;ve earned p1</span><br><span class="line">p2=max(p2, p-m2)   0   1   1   4   4   4   4   7  &lt;- total profit</span><br></pre></td></tr></table></figure><h1 id="at-most-k-transactions">At most k transactions</h1><p>Design an algorithm to find the maximum profit. You may complete at most <strong>k</strong> transactions.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [2,4,1], k = 2</span><br><span class="line">Output: 2</span><br></pre></td></tr></table></figure><p>Example 2:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [3,2,6,5,0,3], k = 2</span><br><span class="line">Output: 7</span><br></pre></td></tr></table></figure><h2 id="dynamic-programming">Dynamic Programming</h2><p>Let <code>dp[k][n]</code> be the maximum profit completing at most <code>k</code> transactions on <code>n</code>-th day. <code>n</code> start from 1. Hence, <code>n</code>-th day's price is <code>prices[n - 1]</code>.</p><p>Base case: <code>dp[0][n] = dp[k][0] = 0</code>. Say <code>prices = [1,2,0,3]</code>, the base case is:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">prices      1   2   0   3</span><br><span class="line">       d0  d1  d2  d3  d4</span><br><span class="line">   t0   0   0   0   0   0</span><br><span class="line">   t1   0</span><br><span class="line">   t2   0</span><br></pre></td></tr></table></figure><p>Induction rules:</p><p>For filling in the entry of <code>dp[i][j]</code>,</p><ul><li>If we don't sell a stock on <code>j</code>-th day, <code>dp[i][j] = dp[i][j - 1]</code>.</li><li>If we sell a stock on <code>j</code>-th day, we must buy a stock on <code>x</code>-th day where <code>1 &lt;= x &lt; j</code>, <code>dp[i][j] = max(dp[i - 1][x - 1] - prices[x - 1] + prices[j - 1] | 1 &lt;= x &lt; j)</code>. <strong>If <code>x = j</code>, means we buy and sell a stock on one day, which is effectively trading nothing.</strong> So, <code>1 &lt;= x &lt;= j</code> also works well. This helps when we reduce the time complexity later.</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dp[i][j] = max(dp[i][j - 1],</span><br><span class="line">               max(dp[i - 1][x - 1] - prices[x - 1] | 1 &lt;= x &lt;= j) + prices[j - 1])</span><br><span class="line">                                      ^ buy on x-th day              ^ sell on j-th day</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn^2)</span></span><br><span class="line"><span class="comment"># Space: O(kn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, k: int, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n = len(prices)</span><br><span class="line">        dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(k + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, k + <span class="number">1</span>):  <span class="comment"># O(k), add an outer loop, dealing with transactions</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):  <span class="comment"># O(n)</span></span><br><span class="line">                val = max(dp[i - <span class="number">1</span>][x] - prices[x] <span class="keyword">for</span> x <span class="keyword">in</span> range(j))  <span class="comment"># O(n), 0 &lt;= x &lt;= j - 1</span></span><br><span class="line">                dp[i][j] = max(dp[i][j - <span class="number">1</span>], val + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[k][n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn)</span></span><br><span class="line"><span class="comment"># Space: O(kn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, k: int, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n = len(prices)</span><br><span class="line">        dp = [[<span class="number">0</span>] * (n + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(k + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, k + <span class="number">1</span>):  <span class="comment"># O(k)</span></span><br><span class="line">            val = float(<span class="string">'-inf'</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):  <span class="comment"># O(n)</span></span><br><span class="line">                val = max(val, dp[i - <span class="number">1</span>][j - <span class="number">1</span>] - prices[j - <span class="number">1</span>])  <span class="comment"># O(1)</span></span><br><span class="line">                dp[i][j] = max(dp[i][j - <span class="number">1</span>], val + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[k][n]</span><br></pre></td></tr></table></figure><h1 id="from-dp-to-one-pass">From DP to One Pass</h1><ul><li>Exchange the two <code>for</code> loop. <code>val</code> is different with different <code>i</code>, so we need a vector to store values separately.</li><li>Transpose array <code>dp</code>.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn)</span></span><br><span class="line"><span class="comment"># Space: O(kn)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n, k = len(prices), <span class="number">2</span></span><br><span class="line">        dp = [[<span class="number">0</span>] * (k + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(n + <span class="number">1</span>)]  <span class="comment"># transposed</span></span><br><span class="line">        val = [float(<span class="string">'-inf'</span>)] * (k + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):  <span class="comment"># on j-th day</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, k + <span class="number">1</span>):</span><br><span class="line">                val[i] = max(val[i], dp[j - <span class="number">1</span>][i - <span class="number">1</span>] - prices[j - <span class="number">1</span>])</span><br><span class="line">                dp[j][i] = max(dp[j - <span class="number">1</span>][i], val[i] + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[n][k]</span><br></pre></td></tr></table></figure><h2 id="loop-backward">Loop backward</h2><p>It seems like <code>dp[j][i]</code> is dependent on <code>dp[j - 1][i]</code> and <code>dp[j - 1][i - 1]</code>. So, if we want to use a vector to instead array, we need to loop backwards from <code>k</code> to 1.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(kn)</span></span><br><span class="line"><span class="comment"># Space: O(k)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n, k = len(prices), <span class="number">2</span></span><br><span class="line">        dp = [<span class="number">0</span>] * (k + <span class="number">1</span>)  <span class="comment"># using vector</span></span><br><span class="line">        val = [float(<span class="string">'-inf'</span>)] * (k + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(k, <span class="number">0</span>, <span class="number">-1</span>):  <span class="comment"># backward</span></span><br><span class="line">                val[i] = max(val[i], dp[i - <span class="number">1</span>] - prices[j - <span class="number">1</span>])</span><br><span class="line">                dp[i] = max(dp[i], val[i] + prices[j - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[k]</span><br></pre></td></tr></table></figure><p>Let <code>dp = [sell_0, sell_1, sell_2]</code> and <code>val = [buy_0, buy_1, buy_2]</code>, we can reduce the space complexity further.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        buy_1 = buy_2 = float(<span class="string">'-inf'</span>)</span><br><span class="line">        sell_1 = sell_2 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            buy_2 = max(buy_2, sell_1 - p)  <span class="comment"># buy_2 &lt;- val[2]</span></span><br><span class="line">            sell_2 = max(sell_2, buy_2 + p)</span><br><span class="line">            buy_1 = max(buy_1, -p)</span><br><span class="line">            sell_1 = max(sell_1, buy_1 + p)</span><br><span class="line">        <span class="keyword">return</span> sell_2</span><br></pre></td></tr></table></figure><h2 id="loop-forward">Loop forward</h2><p>Actually, loop forwards from 1 to k is also feasible. <strong>Because even if <code>dp[j - 1][i - 1]</code> is updated to <code>dp[j][i - 1]</code>, <code>var[i]</code> has the same value.</strong></p><p><code>dp[j][i - 1]</code> can be larger than or equal to <code>dp[j - 1][i - 1]</code>.</p><ul><li>If <code>dp[j][i - 1] = dp[j - 1][i - 1]</code>, obviously <code>var[i]</code> won't change.</li><li>If <code>dp[j][i - 1] &gt; dp[j - 1][i - 1]</code>, means we have sold a stock on <code>j</code>-th day. Since <code>var[i] = max(var[i], dp[j][i - 1] - price[j - 1])</code>, buy and sell a stock on one day is effectively trading noting.</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        buy_1 = buy_2 = float(<span class="string">'-inf'</span>)</span><br><span class="line">        sell_1 = sell_2 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            buy_1 = max(buy_1, -p)</span><br><span class="line">            sell_1 = max(sell_1, buy_1 + p)</span><br><span class="line">            buy_2 = max(buy_2, sell_1 - p)</span><br><span class="line">            sell_2 = max(sell_2, buy_2 + p)</span><br><span class="line">        <span class="keyword">return</span> sell_2</span><br></pre></td></tr></table></figure><h1 id="with-cooldown">with Cooldown</h1><p>Design an algorithm to find the maximum profit. You may complete as many transactions as you like (ie, buy one and sell one share of the stock multiple times) with the following restrictions:</p><ul><li>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</li><li>After you sell your stock, you cannot buy stock on next day. (ie, cooldown 1 day)</li></ul><p>Example:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Input: [1,2,3,0,2]</span><br><span class="line">Output: 3</span><br><span class="line">Explanation: transactions = [buy, sell, cooldown, buy, sell]</span><br></pre></td></tr></table></figure><h2 id="one-pass-2">One Pass</h2><p>Let <code>dp[i]</code> represents the maximum profit on the <code>i</code>-th day.</p><p>Base case: <code>dp[0] = 0</code>.</p><p>Induction rules:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dp[i] = max(dp[i - 1],</span><br><span class="line">            max(dp[j - 2] - prices[j - 1] | 1 &lt;= j &lt;= i) + prices[i - 1])</span><br><span class="line">                ^           ^ buy on j-th day                     ^ sell on i-th day</span><br><span class="line">       max profit on (j-2)-th day</span><br></pre></td></tr></table></figure><p>When <code>j = 1</code>, <code>dp[j - 2] = dp[-1]</code> should be 0.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n^2)</span></span><br><span class="line"><span class="comment"># Space: O(n)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        n = len(prices)</span><br><span class="line">        dp = [<span class="number">0</span>] * (n + <span class="number">1</span>)  <span class="comment"># dp[-1] = dp[n] = 0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">            val = max(dp[j - <span class="number">1</span>] - prices[j] <span class="keyword">for</span> j <span class="keyword">in</span> range(i))</span><br><span class="line">            dp[i] = max(dp[i - <span class="number">1</span>], val + prices[i - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Time: O(n)</span></span><br><span class="line"><span class="comment"># Space: O(1)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices: list)</span> -&gt; int:</span></span><br><span class="line">        prev1 = prev2 = <span class="number">0</span>  <span class="comment"># maximum profits</span></span><br><span class="line">        val = float(<span class="string">'-inf'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prices:</span><br><span class="line">            val = max(val, prev2 - p)</span><br><span class="line">            prev2 = prev1</span><br><span class="line">            prev1 = max(prev1, val + p)</span><br><span class="line">        <span class="keyword">return</span> prev1</span><br></pre></td></tr></table></figure></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/programming/leetcode/climbing-stairs/" rel="bookmark">Climbing Stairs</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/programming/leetcode/coin-change/" rel="bookmark">Coin Change</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/programming/leetcode/decode-ways/" rel="bookmark">Decode Ways</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/programming/leetcode/edit-distance/" rel="bookmark">Edit Distance</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/programming/leetcode/house-robber/" rel="bookmark">House Robber</a></div></li></ul><footer class="post-footer"><div class="post-tags"> <a href="/tags/dynamic-programming/" rel="tag"># dynamic programming</a> <a href="/tags/leetcode/" rel="tag"># leetcode</a></div><div class="post-nav"><div class="post-nav-item"><a href="/programming/leetcode/triangle/" rel="prev" title="Triangle"><i class="fa fa-chevron-left"></i> Triangle</a></div><div class="post-nav-item"> <a href="/programming/leetcode/word-break/" rel="next" title="Word Break">Word Break<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#at-most-1-transaction"><span class="nav-number">1.</span> <span class="nav-text">At most 1 transaction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#broute-force"><span class="nav-number">1.1.</span> <span class="nav-text">Broute Force</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#one-pass"><span class="nav-number">1.2.</span> <span class="nav-text">One Pass</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#maximum-subarray"><span class="nav-number">1.3.</span> <span class="nav-text">Maximum Subarray</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#at-most-2-transactions"><span class="nav-number">2.</span> <span class="nav-text">At most 2 transactions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#one-pass-1"><span class="nav-number">2.1.</span> <span class="nav-text">One Pass</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#at-most-k-transactions"><span class="nav-number">3.</span> <span class="nav-text">At most k transactions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dynamic-programming"><span class="nav-number">3.1.</span> <span class="nav-text">Dynamic Programming</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#from-dp-to-one-pass"><span class="nav-number">4.</span> <span class="nav-text">From DP to One Pass</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#loop-backward"><span class="nav-number">4.1.</span> <span class="nav-text">Loop backward</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loop-forward"><span class="nav-number">4.2.</span> <span class="nav-text">Loop forward</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#with-cooldown"><span class="nav-number">5.</span> <span class="nav-text">with Cooldown</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#one-pass-2"><span class="nav-number">5.1.</span> <span class="nav-text">One Pass</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="菜农陈文生" src="/uploads/avatar/nekosensei.png"><p class="site-author-name" itemprop="name">菜农陈文生</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">162</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">165</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/cncws" title="GitHub → https://github.com/cncws" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a></span><span class="links-of-author-item"><a href="mailto:1031616423@qq.com" title="E-Mail → mailto:1031616423@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">菜农陈文生</span></div><script src="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><script src="/js/aplayer-el.js"></script><script src="//unpkg.com/video.js/dist/video.min.js"></script><script src="/js/videojs-bilibili.js"></script><script src="/js/videojs-bilibili-el.js"></script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script src="/js/local-search.js"></script><div id="pjax"><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Axl15EIRi5o5AatKaxXxV4Oq-gzGzoHsz',
      appKey     : 'E0qm04UjsP0qQN1l8ME3GQ25',
      placeholder: "Just go go",
      avatar     : 'identicon',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></div></body></html>