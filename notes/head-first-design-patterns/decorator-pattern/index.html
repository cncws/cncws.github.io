<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/uploads/icon/drop/128x128.png"><link rel="icon" type="image/png" sizes="32x32" href="/uploads/icon/drop/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/uploads/icon/drop/16x16.png"><link rel="mask-icon" href="/uploads/icon/drop/drop.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"cwscn.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1,width:240},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"manual"},fancybox:!1,mediumzoom:!0,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"fadeIn"}},path:"search.xml"}</script><meta name="description" content="本章可以成为 “给爱用继承的人一个全新的设计眼界”。我们即将再度探讨典型的继承滥用问题。你将在本章学到如何使用对象组合的方式，做到在运行时装饰类。一旦你熟悉了装饰的技巧，你将能够在不修改任何底层代码的情况下，给你的（或别人的）对象赋予新的职责。 导入：星巴兹咖啡 星巴兹（Starbuzz）是以扩张速度最快而闻名的咖啡连锁店。因为扩张速度实在太快了，他们准备更新订单系统，以合乎他们的饮料供应系统。他"><meta name="keywords" content="Head First 设计模式"><meta property="og:type" content="article"><meta property="og:title" content="装饰者模式"><meta property="og:url" content="https://cwscn.github.io/notes/head-first-design-patterns/decorator-pattern/index.html"><meta property="og:site_name" content="春夏秋冬"><meta property="og:description" content="本章可以成为 “给爱用继承的人一个全新的设计眼界”。我们即将再度探讨典型的继承滥用问题。你将在本章学到如何使用对象组合的方式，做到在运行时装饰类。一旦你熟悉了装饰的技巧，你将能够在不修改任何底层代码的情况下，给你的（或别人的）对象赋予新的职责。 导入：星巴兹咖啡 星巴兹（Starbuzz）是以扩张速度最快而闻名的咖啡连锁店。因为扩张速度实在太快了，他们准备更新订单系统，以合乎他们的饮料供应系统。他"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/ROyn2i90403xUyMMMaW-O1KYMFk3osKrmSGBjwSWCM2XXRrQYBNO2uBu6z7a6oPgeeR0DZV3xR2kvo1W4Eef11ZOg9YR4-4fuIFZDcd5XGOJ9wZu025Y00wIK5weFJdANWFKrXSqcXcAYdyn24dwpGBKhdHYC0nuBC_twpRPhzBrCTqjakqbEMrkyqCsB6R2vqJGbMD2qyUHysf-zXJMuchOavnqhKJ1-tMYGw528ldlojlQirRhfriHPRBAyrg55Q4d"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/RL5DIyD04BtdLyonHThYiUYfLF3YHG-Ujvkn2KswOMUhb1WGr4EleX75YpTFHH4KwT-fIVqNJbgprk1fvhqt7szsFTz5m30oOmWnxA5sl8AHlfO1Eg97HWjfe8F7g4KV8NO0N2If_SZuQiWez8C11rBZ0YZf2OuddXznwAFf_XRNwan9HQPMXnXQBLXC7_FfRJOvonucY-VpBBtBxo_ci_UlgnT872xs1Etn-6KZeR4vymTgND9bMbGN-ssv1QmSigDI-CaPn24QJxb9uURpycq-IzbAVlt4FhBq8tkzSH971e88TjM8i1FWq5s-mUeCgtQ57kmhGMPDv1ircf4UmcQptOODe564khaIj_X0sunI7FqtTOSYZKJghsR_OlkqqLZpLH6ifIfVRAjmvQ9l"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/jPF1IiD048RlUOezwg7qBY9OlNlmQ3sawMWgxQPi5qLg8OZ1jbRZGOk8YhKKH4LRn5fDnNVHP9EU-Wfk6aoY5XN1Io3_plx_DpE9d4e2WaoMhg8CP1901DbLf1IHqY28YHmbeaJHb9B9AXWmHNa1eVoxNk2NgAma9qT6XyanJ_PU2YWQHPRMDeqggpwmstsX84XfCPVZvbWYGE5ZIDZvbtO-xZH82X6fGluJrm-P7AG4z2j4p6Q1G78ciVHD8nXMOY2Booc5_34uzdqmVm8V1i-PfIA5lyqqS1zVYqI-xkfpWGyNFWZhOuZTw6RdmgbhlKRJKRKNzOWTbSoEoiKNzJYE-zsYLT7ukQVrkoNRs32DzgkwBWIR_O0JxEB7YfY05Gee3GiKAGjV6nf3NfgbtvX6mzhUjxUkpATdU--ytwt4CIjMERDpTkdpkwntz-ouuLMvb8C4abgK1n6XreDBMilQhLZN9_PECuxjmmssqx3qUfILdvnMpMuPlirdqA3Li9q7MpurEsLMRNA_E7Pg5RFpw0vJF-Xjwb5lfNoQhlMGZpWont_z9E3vYI53UmC0"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/XL8zJy9G5DtxA-w8CO2wWHy3ChYukAf3QI-qeUqZhmyJWqs8WKGZnaKOZ2uQ4gCccXWHKuq_njBYv5_mbK91FkBstZddzfnx-XHLHa2zmFP1Hps3L51yH5AffA4WPan6HOb12lUGYZc4aW0WeobHjS1KOl1R3bbw24JcE5GQp5aW4PC5c8vC8R85yJXqgYt7RhYNnzxvhNTHSHjlxdDTi0H94qqJDaZHn9I6XjnpwtzXmAP5cjyYeib6I2W1HLQa1Yp64ebbiBWwZBvE35dLqU0f9K95HcXlCjmeqpzmR58Q6Sfybu4MLY7Zs_nPTQA8GUHD8YdYJDFn5M9B2p0V2c817PZDTb2r_3y6qyT3_Sf1D3hI_1WHbZw6JnOs8fZA9w5JgtPlgawxxBJlkjVt_FpTVEgMgr_bGs7Al-hv-FlD9lrwXQ3aw3P_lZ8Qksl1Z44OWePP1YGRbfC4pwuuTgjpzkZOpSvftJjvS3u--MFyUQ_j6EvHWySPZUP7Vdbrhvg1YYVz1G00"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/TPAnJiCm48PtFuNLFPNeY10I5KAgL24aHiJW99V6Qc8gsnaYCJ2GXPKdG8WT5XYglas1y1OaSHIvyNcB__y_t_dBfJm62lb6bpI7F0H9qbQ9k8mo82nKMh98quNO5FfQIs0v4NSQQ0Q9FgO_Jxlwu-Lt-xZVVf8eOqhH2vw1dJPgS-1YDI-I1AJhpaiDPrAoqhQ6tisD-h2gcq3oLJgCKBzMVs_lzKFLttXLg3HaqHhfrSq0iUkSCyrSTSa5N1Oj6Tkplkd9VH0uptO2FW9E48M1zHj1SHGJn4XueXWQJtJCoXF3uOrOqU2csRaOnEsfbv97jqjHRfXe5tbsQ_9TVUrtpsQn9vGfAeuEd67VZ3bptZITjYM-iOsB3jTRxg_ed1aPaUzL57Jl8HjWd7y0"><meta property="og:updated_time" content="2020-08-02T23:48:59.512Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="装饰者模式"><meta name="twitter:description" content="本章可以成为 “给爱用继承的人一个全新的设计眼界”。我们即将再度探讨典型的继承滥用问题。你将在本章学到如何使用对象组合的方式，做到在运行时装饰类。一旦你熟悉了装饰的技巧，你将能够在不修改任何底层代码的情况下，给你的（或别人的）对象赋予新的职责。 导入：星巴兹咖啡 星巴兹（Starbuzz）是以扩张速度最快而闻名的咖啡连锁店。因为扩张速度实在太快了，他们准备更新订单系统，以合乎他们的饮料供应系统。他"><meta name="twitter:image" content="http://www.plantuml.com/plantuml/svg/ROyn2i90403xUyMMMaW-O1KYMFk3osKrmSGBjwSWCM2XXRrQYBNO2uBu6z7a6oPgeeR0DZV3xR2kvo1W4Eef11ZOg9YR4-4fuIFZDcd5XGOJ9wZu025Y00wIK5weFJdANWFKrXSqcXcAYdyn24dwpGBKhdHYC0nuBC_twpRPhzBrCTqjakqbEMrkyqCsB6R2vqJGbMD2qyUHysf-zXJMuchOavnqhKJ1-tMYGw528ldlojlQirRhfriHPRBAyrg55Q4d"><link rel="canonical" href="https://cwscn.github.io/notes/head-first-design-patterns/decorator-pattern/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css"><link rel="stylesheet" href="//unpkg.com/video.js/dist/video-js.min.css"><link rel="stylesheet" href="/css/videojs-bilibili.css"><style>.aplayer.aplayer-arrow .aplayer-icon-loop,.aplayer.aplayer-arrow .aplayer-icon-order{display:inline-block}</style><title>装饰者模式 | 春夏秋冬</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">春夏秋冬</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">愿你走出半生 归来仍是少年</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">239</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">13</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">159</span></a></li><li class="menu-item menu-item-收藏"><a href="/favlist/" rel="section"><i class="fa fa-star fa-fw"></i> 收藏</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><meting-js server="netease" type="playlist" id="67155774" theme="#ff5555" loop="all" order="list" preload="none" volume="" mutex="" list-folded="NaN" fixed="true"></meting-js></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://cwscn.github.io/notes/head-first-design-patterns/decorator-pattern/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar/nekosensei.png"><meta itemprop="name" content="菜农陈文生"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="春夏秋冬"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 装饰者模式</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-08-03 07:48:59" itemprop="dateModified" datetime="2020-08-03T07:48:59+08:00">2020-08-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/notes/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span></span><span id="/notes/head-first-design-patterns/decorator-pattern/" class="post-meta-item leancloud_visitors" data-flag-title="装饰者模式" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/notes/head-first-design-patterns/decorator-pattern/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/notes/head-first-design-patterns/decorator-pattern/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>本章可以成为 <strong>“给爱用继承的人一个全新的设计眼界”。</strong>我们即将再度探讨典型的继承滥用问题。你将在本章学到如何使用对象组合的方式，做到在运行时装饰类。一旦你熟悉了装饰的技巧，你将能够在不修改任何底层代码的情况下，给你的（或别人的）对象赋予新的职责。</p><h1 id="导入星巴兹咖啡">导入：星巴兹咖啡</h1><p>星巴兹（Starbuzz）是以扩张速度最快而闻名的咖啡连锁店。因为扩张速度实在太快了，他们准备更新订单系统，以合乎他们的饮料供应系统。他们原先的类设计是这样的……</p> <img src="http://www.plantuml.com/plantuml/svg/ROyn2i90403xUyMMMaW-O1KYMFk3osKrmSGBjwSWCM2XXRrQYBNO2uBu6z7a6oPgeeR0DZV3xR2kvo1W4Eef11ZOg9YR4-4fuIFZDcd5XGOJ9wZu025Y00wIK5weFJdANWFKrXSqcXcAYdyn24dwpGBKhdHYC0nuBC_twpRPhzBrCTqjakqbEMrkyqCsB6R2vqJGbMD2qyUHysf-zXJMuchOavnqhKJ1-tMYGw528ldlojlQirRhfriHPRBAyrg55Q4d"><p>购买咖啡时，也可以要求在其中加入各种调料，例如：蒸奶（Steamed Milk）、豆浆（Soy）、摩卡（Mocha，也就是巧克力风味或覆盖奶泡（Whip）。星巴兹会根据所加入的调料收取不同的费用。所以订单系统必须考虑到这些调料部分。</p><p>利用实例变量和继承，追踪这些调料。</p> <img src="http://www.plantuml.com/plantuml/svg/RL5DIyD04BtdLyonHThYiUYfLF3YHG-Ujvkn2KswOMUhb1WGr4EleX75YpTFHH4KwT-fIVqNJbgprk1fvhqt7szsFTz5m30oOmWnxA5sl8AHlfO1Eg97HWjfe8F7g4KV8NO0N2If_SZuQiWez8C11rBZ0YZf2OuddXznwAFf_XRNwan9HQPMXnXQBLXC7_FfRJOvonucY-VpBBtBxo_ci_UlgnT872xs1Etn-6KZeR4vymTgND9bMbGN-ssv1QmSigDI-CaPn24QJxb9uURpycq-IzbAVlt4FhBq8tkzSH971e88TjM8i1FWq5s-mUeCgtQ57kmhGMPDv1ircf4UmcQptOODe564khaIj_X0sunI7FqtTOSYZKJghsR_OlkqqLZpLH6ifIfVRAjmvQ9l"><p>当哪些需求或因素改变时会影响这个设计？</p><ul><li>调料价钱的改变会使我们更改现有代码。（这个比较好解决，增加设置调料价格的 <code>setter</code> 方法即可）</li><li>一旦出现新的调料，我们就需要加上新的方法，并改变超类中的 <code>cost()</code> 方法。（无解）</li><li>以后可能会开发处新饮料，对这些饮料而言（例如，冰茶），某些调料可能并不合适，但是在这个设计方式中，Tea 子类仍将继承哪些不适合的方法，例如：<code>hasWhip()</code>。</li><li>万一顾客想要双倍摩卡咖啡，怎么办？（这个也比较好解决，将 <code>soy</code> 的类型设置为 <code>int</code>）</li></ul><a id="more"></a><h1 id="开放-关闭原则">开放-关闭原则</h1><blockquote><p>类应该对扩展开放，对修改关闭。</p></blockquote><p>我们的目标是允许类容易扩展，在不修改现有代码的情况下，就可搭配新的行为。如果实现这样的目标，有什么好处呢？这样的设计具有弹性可以应对改变，可以接受新的功能来应对改变的需求。</p><p><strong>问</strong>：我如何让设计的每个部分都遵循开放-关闭原则？</p><p><strong>答</strong>：通常，你办不到。遵循开放-关闭原则，通常会引入新的抽象层次，增加代码的复杂度。你需要把注意力集中在设计中最有可能改变的地方，然后应用开放-关闭原则。</p><h1 id="定义装饰者模式">定义装饰者模式</h1><p>装饰者模式动态地将责任附加到对象上。若要扩展功能，装饰者提供了比继承更有弹性的替代方案。</p> <img src="http://www.plantuml.com/plantuml/svg/jPF1IiD048RlUOezwg7qBY9OlNlmQ3sawMWgxQPi5qLg8OZ1jbRZGOk8YhKKH4LRn5fDnNVHP9EU-Wfk6aoY5XN1Io3_plx_DpE9d4e2WaoMhg8CP1901DbLf1IHqY28YHmbeaJHb9B9AXWmHNa1eVoxNk2NgAma9qT6XyanJ_PU2YWQHPRMDeqggpwmstsX84XfCPVZvbWYGE5ZIDZvbtO-xZH82X6fGluJrm-P7AG4z2j4p6Q1G78ciVHD8nXMOY2Booc5_34uzdqmVm8V1i-PfIA5lyqqS1zVYqI-xkfpWGyNFWZhOuZTw6RdmgbhlKRJKRKNzOWTbSoEoiKNzJYE-zsYLT7ukQVrkoNRs32DzgkwBWIR_O0JxEB7YfY05Gee3GiKAGjV6nf3NfgbtvX6mzhUjxUkpATdU--ytwt4CIjMERDpTkdpkwntz-ouuLMvb8C4abgK1n6XreDBMilQhLZN9_PECuxjmmssqx3qUfILdvnMpMuPlirdqA3Li9q7MpurEsLMRNA_E7Pg5RFpw0vJF-Xjwb5lfNoQhlMGZpWont_z9E3vYI53UmC0"><h1 id="装饰我们的饮料">装饰我们的饮料</h1><p>装饰者模式完全遵循开放-关闭原则：我们以饮料为主体，然后在运行时以调料来”装饰“（decorate）饮料。比方说，如果顾客想要摩卡和奶泡深焙咖啡，那么，要做的是：</p><ol type="1"><li>拿一个深焙咖啡（DarkRoast）对象</li><li>以摩卡（Mocha）对象装饰它</li><li>以奶泡（Whip）对象装饰它</li><li>调用 <code>cost()</code> 方法，并依赖委托（delegate）将调料的价钱加上去</li></ol> <img src="http://www.plantuml.com/plantuml/svg/XL8zJy9G5DtxA-w8CO2wWHy3ChYukAf3QI-qeUqZhmyJWqs8WKGZnaKOZ2uQ4gCccXWHKuq_njBYv5_mbK91FkBstZddzfnx-XHLHa2zmFP1Hps3L51yH5AffA4WPan6HOb12lUGYZc4aW0WeobHjS1KOl1R3bbw24JcE5GQp5aW4PC5c8vC8R85yJXqgYt7RhYNnzxvhNTHSHjlxdDTi0H94qqJDaZHn9I6XjnpwtzXmAP5cjyYeib6I2W1HLQa1Yp64ebbiBWwZBvE35dLqU0f9K95HcXlCjmeqpzmR58Q6Sfybu4MLY7Zs_nPTQA8GUHD8YdYJDFn5M9B2p0V2c817PZDTb2r_3y6qyT3_Sf1D3hI_1WHbZw6JnOs8fZA9w5JgtPlgawxxBJlkjVt_FpTVEgMgr_bGs7Al-hv-FlD9lrwXQ3aw3P_lZ8Qksl1Z44OWePP1YGRbfC4pwuuTgjpzkZOpSvftJjvS3u--MFyUQ_j6EvHWySPZUP7Vdbrhvg1YYVz1G00"><p>如果有一张单子点的是：“双倍摩卡豆浆奶泡拿铁咖啡”，它的价钱是？</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">beverage = <span class="keyword">new</span> HouseBlend();</span><br><span class="line">beverage = <span class="keyword">new</span> Mocha(beverage); <span class="comment">// 用摩卡装饰</span></span><br><span class="line">beverage = <span class="keyword">new</span> Mocha(beverage); <span class="comment">// 用第二个摩卡装饰</span></span><br><span class="line">beverage = <span class="keyword">new</span> Soy(beverage);   <span class="comment">// 用豆浆装饰</span></span><br><span class="line">beverage = <span class="keyword">new</span> Whip(beverage);  <span class="comment">// 用奶泡装饰</span></span><br><span class="line">System.out.println(<span class="string">"$"</span> + beverage.cost());  <span class="comment">// 饮料的价格</span></span><br></pre></td></tr></table></figure><p>CondimentDecorator 扩展自 Beverage 类，这用到了继承。这么做的终点在于，<strong>装饰者和被装饰者必须是一样的类型</strong>，也就是有共同的超类，这相当关键的地方，因为装饰者必须能取代被装饰者。在这里，我们利用继承达到“类型匹配”，而不是利用继承获得“行为”。行为来自装饰者和基础组件，或与其他装饰者之间的组合关系。正是因为使用对象组合，可以把所有饮料和调料有弹性地加以混合。</p><h1 id="真实世界的装饰者java-io">真实世界的装饰者：Java I/O</h1> <img src="http://www.plantuml.com/plantuml/svg/TPAnJiCm48PtFuNLFPNeY10I5KAgL24aHiJW99V6Qc8gsnaYCJ2GXPKdG8WT5XYglas1y1OaSHIvyNcB__y_t_dBfJm62lb6bpI7F0H9qbQ9k8mo82nKMh98quNO5FfQIs0v4NSQQ0Q9FgO_Jxlwu-Lt-xZVVf8eOqhH2vw1dJPgS-1YDI-I1AJhpaiDPrAoqhQ6tisD-h2gcq3oLJgCKBzMVs_lzKFLttXLg3HaqHhfrSq0iUkSCyrSTSa5N1Oj6Tkplkd9VH0uptO2FW9E48M1zHj1SHGJn4XueXWQJtJCoXF3uOrOqU2csRaOnEsfbv97jqjHRfXe5tbsQ_9TVUrtpsQn9vGfAeuEd67VZ3bptZITjYM-iOsB3jTRxg_ed1aPaUzL57Jl8HjWd7y0"><p>和星巴兹的设计相比，<code>java.io</code> 其实没有多大的差异。你会发现“输出”流的设计也是一样的。你可能还会发现 Reader/Writter 流（作为基于字符数据的输入和输出）和输入流/输出流的类相当类似（虽然有一些小差异和不一致之处，但是相当雷同，所以你应该可以了解这些类）。</p><p>Java I/O 也引出装饰者模式的一个“缺点”：利用装饰者模式，常常造成设计中有大量的小类，数量实在太多，可能会造成使用此 API 程序员的困扰。但是，现在你已经了解了装饰者的工作原理，以后当使用别人的大量装饰的 API 时，就可以很容易地辨别出他们的装饰者类是如何组织的，以方便用包装方式取得想要的行为。</p><h2 id="编写自己的-java-io-装饰者">编写自己的 Java I/O 装饰者</h2><p>编写一个装饰者，把输入流内的所有大写字符转成小写。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 首先，扩展FilterInputStream</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LowerCaseInputStream</span> <span class="keyword">extends</span> <span class="title">FilterInputStream</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LowerCaseInputStream</span><span class="params">(InputStream in)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 针对字节的 read() 方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c = <span class="keyword">super</span>.read();</span><br><span class="line">        <span class="keyword">return</span> (c == -<span class="number">1</span> ? c : Character.toLowerCase((<span class="keyword">char</span>) c));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 针对字节数组的 read() 方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> offset, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="keyword">super</span>.read(b, offset, len);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = offset; i &lt; offset + result; i++) &#123;</span><br><span class="line">            b[i] = (<span class="keyword">byte</span>)Character.toLowerCase((<span class="keyword">char</span>)b[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InputTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in =</span><br><span class="line">                <span class="keyword">new</span> LowerCaseInputStream(</span><br><span class="line">                    <span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">                        <span class="keyword">new</span> FileInputStream(<span class="string">"test.txt"</span>)));</span><br><span class="line">            <span class="keyword">while</span> ((c = in.read()) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println((<span class="keyword">char</span>)c);</span><br><span class="line">            &#125;</span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="要点">要点</h1><ul><li>继承属于扩展形式之一，但不见得是达到弹性设计的最佳方案。</li><li>组合和委托可用于在运行时动态地加上新的行为。</li><li>装饰者模式意味着一群装饰者类，这些类用来包装具体组件。</li><li>装饰者类反映出被装饰的组件类型（事实上，他们具有相同的类型，都经过接口或继承实现）。</li><li>装饰者可以在被装饰者的行为前面与/或后面加上自己的行为，甚至将被装饰者的行为整个取代掉，而达到特定的目的。</li><li>可以用无数个装饰者包装一个组件。</li><li>装饰者一般对组件的客户是透明的，除非客户依赖于组件的具体类型。</li><li>装饰者会导致设计中出现许多小对象，如果过度使用，会让程序变得很复杂。</li></ul></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/command-pattern/" rel="bookmark">命令模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/compound-pattern/" rel="bookmark">复合模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/adapter-pattern-and-facade-pattern/" rel="bookmark">适配器模式与外观模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/factory-pattern/" rel="bookmark">工厂模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/iterator-pattern-and-composite-pattern/" rel="bookmark">迭代器模式和组合模式</a></div></li></ul><footer class="post-footer"><div class="post-tags"> <a href="/tags/head-first-design-patterns/" rel="tag"># Head First 设计模式</a></div><div class="post-nav"><div class="post-nav-item"><a href="/notes/head-first-design-patterns/observer-pattern/" rel="prev" title="观察者模式"><i class="fa fa-chevron-left"></i> 观察者模式</a></div><div class="post-nav-item"> <a href="/notes/head-first-design-patterns/factory-pattern/" rel="next" title="工厂模式">工厂模式<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#导入星巴兹咖啡"><span class="nav-number">1.</span> <span class="nav-text">导入：星巴兹咖啡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开放-关闭原则"><span class="nav-number">2.</span> <span class="nav-text">开放-关闭原则</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#定义装饰者模式"><span class="nav-number">3.</span> <span class="nav-text">定义装饰者模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#装饰我们的饮料"><span class="nav-number">4.</span> <span class="nav-text">装饰我们的饮料</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#真实世界的装饰者java-io"><span class="nav-number">5.</span> <span class="nav-text">真实世界的装饰者：Java I/O</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#编写自己的-java-io-装饰者"><span class="nav-number">5.1.</span> <span class="nav-text">编写自己的 Java I/O 装饰者</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#要点"><span class="nav-number">6.</span> <span class="nav-text">要点</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="菜农陈文生" src="/uploads/avatar/nekosensei.png"><p class="site-author-name" itemprop="name">菜农陈文生</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">239</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">159</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/cncws" title="GitHub → https://github.com/cncws" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a></span><span class="links-of-author-item"><a href="mailto:1031616423@qq.com" title="E-Mail → mailto:1031616423@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">菜农陈文生</span></div><script src="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><script src="/js/aplayer-el.js"></script><script src="//unpkg.com/video.js/dist/video.min.js"></script><script src="/js/videojs-bilibili.js"></script><script src="/js/videojs-bilibili-el.js"></script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script src="/js/local-search.js"></script><div id="pjax"><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Axl15EIRi5o5AatKaxXxV4Oq-gzGzoHsz',
      appKey     : 'E0qm04UjsP0qQN1l8ME3GQ25',
      placeholder: "Just go go",
      avatar     : 'identicon',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></div></body></html>