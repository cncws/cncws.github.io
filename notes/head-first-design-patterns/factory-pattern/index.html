<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/uploads/icon/drop/128x128.png"><link rel="icon" type="image/png" sizes="32x32" href="/uploads/icon/drop/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/uploads/icon/drop/16x16.png"><link rel="mask-icon" href="/uploads/icon/drop/drop.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"cwscn.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1,width:240},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"manual"},fancybox:!1,mediumzoom:!0,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"fadeIn"}},path:"search.xml"}</script><meta name="description" content="导入：比萨店 身为比萨店的主人，你的代码可能这么写： Pizza orderPizza() &amp;#123;    Pizza pizza = new Pizza();    pizza.prepare();    pizza.bake();    pizza.cut();    pizza.box();    return pizza;&amp;#125; 当看到 &amp;quot;new&amp;quot;，就会想到具"><meta name="keywords" content="Head First Design Patterns"><meta property="og:type" content="article"><meta property="og:title" content="工厂模式"><meta property="og:url" content="https://cwscn.github.io/notes/head-first-design-patterns/factory-pattern/index.html"><meta property="og:site_name" content="水滴"><meta property="og:description" content="导入：比萨店 身为比萨店的主人，你的代码可能这么写： Pizza orderPizza() &amp;#123;    Pizza pizza = new Pizza();    pizza.prepare();    pizza.bake();    pizza.cut();    pizza.box();    return pizza;&amp;#125; 当看到 &amp;quot;new&amp;quot;，就会想到具"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/RO_13e8m44Jl_Oezwe4_C5vCz4fYuhsK4HgeD4jD1FNVBPJ49U7Kvitix6njIn2S3mCvk0AiweaOowQ5CgtkUyhjEEfhw1ZqLaHNwtoB6PwrYNYWUtgZs749dhNTNdsNW8s9ASWmTC3Vh8i-SDJJmjdY6LupeanKw2Pzp3CaqBt4abCDz2bj8JTKbLsH2mED13cy1tSFcw2uD3jkr5ORbqIZ6AR39yjMNGIMXGGMhGHTL_i1"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/ZLAzRi8m4Dxz53VIWLTWGUfOLMBgU357OzMkeukH-2dlZeaXiPshO4hq_UdkyxLcIq2k2qTmv1fYrTuGRLXRKjfYtyEdEPrm4pmJd1N0nhZEqW2-euxm4NRf6qdFM-A1MxofoptWuwjGtq8q4mQgXUlMQFpshwhHcftdNuDF3TZqWIEVTXaa7LE7J946QF0d_UXzI80_5FElMw8-vKsOHPSZz-7dqWTHwyVn1Sl4ZQxi6PRBLLLgpGfDpYHYVQfODWh_LgaqbMsSm_Er9LPqIWNy8v3yrLcbKl8kPS5Og7HjMNTvqZFfb2dVPDbtaVoIuP5_1G00"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/ZP6z3i8m38HtFuL76Fe6Y0M94I5rOdI3eH6DKhb1eloyEst3Jqg2O6frzyNodKkzPMHJknODcu85obvHMbJ5G4NZX9J3jJwVANTM62-0c6jJLpo8oywsqkBEVplJofPby2PJk86gg6bmjSbT-tZodfD45wLMjBT_ywlDQ96UKyBa-ClWd_GuzO3KmZK9TpPYGGV_euxE2_OqMcTHCZT-tbkho8JAOvSOVHelFgXWTisokCc8I1S8yGcoRFxH7dmfloSJzS4eR4TTvxuq21A7SXmxvQPUVbpPhnxMbmPUDQQE7wGA9_r2dpFl"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/fL513e8m4Bpt5NlKGtzWk7Wt9fuyBdKZn1B8KXD1-RkK0bPQ4usNjZixdSvEi_n4G4Lb6YYeI8b5PX6Liz8aCAqDepAmpziM3wPaWhi0Lq9brxug-KGyGAjrNzwdMnqe9ZJqQbLC5J8DvnGlxg2knW7bhTyxeJJMDUoE1zDe-kNXvMjEU1BSPhd2S_ctwkYxMuGp2FqqtpOZgftm2zDO-CXeEgHEZPdlZRHvI1dc5p3YWOWtOo3b8t432i-T3uSMOztOpV2BfKmMmNpap8D_-5TBYwJt1JiMgUqFvHC0"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/POux3i8m38RtdC8Z3Br1jyu8hk0wHedK99LZXghaxYrIWo1TBFdx7xRpbe73h0i43YEBSHz2NcXYWsDMGL9uIB8lKaCJvWn3YYIiNEdNDWYZ9e7L0AoL5dZkCyboOtN9NgwxYF4-iw3w5FUzDBs_DMsscECgzE-kExrIet_Y0KrZXlvasG00"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONAmHaLbKbSkNbbwGg56McPvHOAJpPD_V5rcbFTlKzwsnuDgVp-QoMP-kdl9YmukdwdIysBdo_foScx-di1Kzsx7gwhldvx2tF-fO-xPZzTFUk5_jdFjar6rdjuuOcBh3v2hgwTWf-aSuPgQd5gH0RaSN3KjFJCp74dJCoanFJyx5hWaeYwGG0"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA0HaLbKb1fVa5wLovUMNf2eKPQPdb5WfFDatzyNMQKzsD3pPiUfPrzuN6nS-txWRJHSNGg-2hguTig22JOskhe9Vf7D6QcfnAZQ9dCHS367dZCpanFHy79fWiZ2T0000"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/RP8zJWCn48NxFSLSm3T0D45qaH2aGnGJPxIsuf_8zXOiuG9fgP5eu12HE4uKZW74krcFeTmte_dUUrwbLmHaD-aHBDabXKRzAb87QQZ1PKm1POAPGHkdppliP36zybshYcL55AdPe5nZIt3SVnxt7_3K04Y3CS9reAZonL6QOz0E0-R3exfGsir25rC6ZF8jjQr6vmVEyvdqjNizxDuEB-yCvdjod7PZEhlm5fF_mvFhVu1pt_SOo1Wy8qy7uM8hH1c7gHFtHCao3reCQa-L5n1YUpaKpMif9xoPF1airndOS8e0ulxd1rYHUn1r_SnwkLUzHv6ykiRAhGANgxNNRm00"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/dLJFI-D05BxFN_7mf8TKzggo5sN1mow2NiJTmvYEJTXc8fFfGMj1PRMu-6F18ee7MN2t8EoXfzPMxHzZ9gad_mMJcOZfR9E5FOMyzxtllU_BHooxI80uwtm37EAi4eQik6BQp2mJX5Szph39OH5NpDJhd5ifMSWiOy-3ZvZP53Ei8AgsPDbqbbKydWOkb2lEakjWxcfGysiAQrDEs1es2IpOcvjudfOOATg4yW_HOfTjG1K1L5ylgO792EP4pevFZ6h9PL6hbYpyj2o9H_BgPACPPgEJSSdzVvetMwCH8aSonAwfPmIGR52K7e7w7k197qTebcpZ4r25oKa86otnvqVOwWr-xuUNPr3JBunWoPx2K7qw1KsE_mkQr6De3MM8c36Kq2aGpKPmS2xQlyJnRjYuyhjDSNmLd5qWPOHXl4-YzVQkigBqpcmPXfQtL4FFbt9CjlIG3RVIKSsIi5KeP2Ld2i9UCpZe1z_l1wsVIbmkJrv-K5OyOo-qM_EWGov55qgp_SvssFiczjh-_Mdi_UaEoiroJAIx-iy1tMlgSW9ZVgVxjDCNUqVYya5StmpwzQ3TzczRptU7d-cWV_5KFnGdDs6Z9-fTlxllTwx3vf4An-FsxXXW3-Wxf7538Ivcsi3iaiLNelzPaT0lHhxj-R8qfdJqz9uyx0K0"><meta property="og:image" content="http://www.plantuml.com/plantuml/svg/bLEzJiCm4Dxz53V2a4Zs25Mak18pEs98dIk9b9_ACKELHW89dg3iZ3m22CJRfEfh4DeaJMCdb26oxZv_ttVdkmIXZu3nGYqXndY6aWI_6H5A4I7nPfcIdb1mBLF_NYWN9fCmKIZdda37qN3UmqNaPLbBPiSnfpsy5tD6MYrmQwUhwalbyjW7SWAGDyKK82Hw2XlPi_CHb5TeKVjEqwJ25DOUT2Thq3fLWFr3e7t9QHHYedRCVi_p_MdGXBm1xJvq2ON1SOZ0zuI2QEzjrPMHka3BSjf16N8kEQpCoh8wEs3EKt9OeKwUiu4yrIjSsROsmfDkCQ9DljiT7OLTUW7RbzVoywtyUDX-FMsUtyllTHLkrez4MuWkaOt2t5IL3Ey2TLFzeJucjzQVVJ2DeKzdu0R_0G00"><meta property="og:updated_time" content="2020-06-09T00:24:26.092Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="工厂模式"><meta name="twitter:description" content="导入：比萨店 身为比萨店的主人，你的代码可能这么写： Pizza orderPizza() &amp;#123;    Pizza pizza = new Pizza();    pizza.prepare();    pizza.bake();    pizza.cut();    pizza.box();    return pizza;&amp;#125; 当看到 &amp;quot;new&amp;quot;，就会想到具"><meta name="twitter:image" content="http://www.plantuml.com/plantuml/svg/RO_13e8m44Jl_Oezwe4_C5vCz4fYuhsK4HgeD4jD1FNVBPJ49U7Kvitix6njIn2S3mCvk0AiweaOowQ5CgtkUyhjEEfhw1ZqLaHNwtoB6PwrYNYWUtgZs749dhNTNdsNW8s9ASWmTC3Vh8i-SDJJmjdY6LupeanKw2Pzp3CaqBt4abCDz2bj8JTKbLsH2mED13cy1tSFcw2uD3jkr5ORbqIZ6AR39yjMNGIMXGGMhGHTL_i1"><link rel="canonical" href="https://cwscn.github.io/notes/head-first-design-patterns/factory-pattern/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css"><link rel="stylesheet" href="//unpkg.com/video.js/dist/video-js.min.css"><link rel="stylesheet" href="/css/videojs-bilibili.css"><style>.aplayer.aplayer-arrow .aplayer-icon-loop,.aplayer.aplayer-arrow .aplayer-icon-order{display:inline-block}</style><title>工厂模式 | 水滴</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">水滴</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">愿你走出半生 归来仍是少年</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">121</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">11</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">129</span></a></li><li class="menu-item menu-item-收藏"><a href="/favlist/" rel="section"><i class="fa fa-star fa-fw"></i> 收藏</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><meting-js server="netease" type="playlist" id="67155774" theme="#ffafc9" loop="all" order="list" preload="none" volume="" list-folded="NaN" fixed="true"></meting-js></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://cwscn.github.io/notes/head-first-design-patterns/factory-pattern/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/uploads/avatar/nekosensei.png"><meta itemprop="name" content="Chen"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="水滴"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 工厂模式</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-09 08:24:26" itemprop="dateModified" datetime="2020-06-09T08:24:26+08:00">2020-06-09</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/notes/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/notes/head-first-design-patterns/factory-pattern/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/notes/head-first-design-patterns/factory-pattern/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="导入比萨店">导入：比萨店</h1><p>身为比萨店的主人，你的代码可能这么写：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Pizza <span class="title">orderPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Pizza pizza = <span class="keyword">new</span> Pizza();</span><br><span class="line"></span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">    pizza.cut();</span><br><span class="line">    pizza.box();</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="当看到-new就会想到具体">当看到 &quot;new&quot;，就会想到具体</h2><p>是的，当使用 &quot;new&quot; 时，你的确是在实例化一个具体类，所以用的的确是实现，而不是接口。</p><p>当你需要更多比萨类型时，通常会写出这样的代码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Pizza <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza;</span><br><span class="line">    <span class="comment">// 这是变化的部分，随着时间过去，比萨菜单改变，这里必须一改再改</span></span><br><span class="line">    <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"greek"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> GreekPizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"pepperoni"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> PepperoniPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里是不变的部分</span></span><br><span class="line">    pizza.prepare();</span><br><span class="line">    pizza.bake();</span><br><span class="line">    pizza.cut();</span><br><span class="line">    pizza.box();</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当代码使用大量的具体类时，等于是自找麻烦，因为一旦加入新的具体类，就必须修改代码。也就是说，你的代码并非“对修改关闭”。</p><a id="more"></a><h2 id="简单工厂">简单工厂</h2> <img src="http://www.plantuml.com/plantuml/svg/RO_13e8m44Jl_Oezwe4_C5vCz4fYuhsK4HgeD4jD1FNVBPJ49U7Kvitix6njIn2S3mCvk0AiweaOowQ5CgtkUyhjEEfhw1ZqLaHNwtoB6PwrYNYWUtgZs749dhNTNdsNW8s9ASWmTC3Vh8i-SDJJmjdY6LupeanKw2Pzp3CaqBt4abCDz2bj8JTKbLsH2mED13cy1tSFcw2uD3jkr5ORbqIZ6AR39yjMNGIMXGGMhGHTL_i1"><p><strong>问</strong>：这样做有什么好处？似乎只是把问题搬到另一个对象罢了，问题依然存在。</p><p><strong>答</strong>：<code>SimplePizzaFactory</code> 可以有许多的客户。虽然目前只看到 <code>orderPizza()</code> 方法是它的客户。我们也正把具体实例化的过程，从客户的代码中删除。当以后实现改变时，只需修改这个工厂类即可。</p><p><strong>问</strong>：我曾看过一个类似的设计方式，把工厂定义成一个静态的方法，这有何差别？</p><p><strong>答</strong>：利用静态方法定义一个简单的工厂，这是很常见的技巧，常被称为静态工厂。但请记住，这也有缺点，不能通过继承来改变创建方法的行为。</p><p><strong>简单工厂其实不是一个设计模式，反而比较像是一种编程习惯。</strong>有些开发人员的确是把这个编程习惯误认为是“工厂模式”（Factory Pattern）。</p><h1 id="加盟比萨店">加盟比萨店</h1><p>身为加盟公司经营者，你希望确保加盟店营运的质量，所以希望这些店都是用你那些经过时间考验的代码（<code>PizzaStore</code>）。</p><p>但是区域的差异呢？每家加盟店都可能想要提供不同风味的比萨（比如说纽约、芝加哥、加州），这受到了开店地点及该地区比萨美食家口味的影响。</p><h2 id="多个简单工厂">多个简单工厂</h2><p>如果利用 <code>SimplePizzaFactory</code>，写出三种不同的工厂，分别是 <code>NYPizzaFactory</code>、<code>ChicagoPizzaFactory</code>、<code>CaliforniaPizzaFactory</code>，那么各地加盟店都有合适的工厂可以使用，这是一种做法。</p> <img src="http://www.plantuml.com/plantuml/svg/ZLAzRi8m4Dxz53VIWLTWGUfOLMBgU357OzMkeukH-2dlZeaXiPshO4hq_UdkyxLcIq2k2qTmv1fYrTuGRLXRKjfYtyEdEPrm4pmJd1N0nhZEqW2-euxm4NRf6qdFM-A1MxofoptWuwjGtq8q4mQgXUlMQFpshwhHcftdNuDF3TZqWIEVTXaa7LE7J946QF0d_UXzI80_5FElMw8-vKsOHPSZz-7dqWTHwyVn1Sl4ZQxi6PRBLLLgpGfDpYHYVQfODWh_LgaqbMsSm_Er9LPqIWNy8v3yrLcbKl8kPS5Og7HjMNTvqZFfb2dVPDbtaVoIuP5_1G00"><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">NYPizzaFactory nyFactory = <span class="keyword">new</span> NYPizzaFactory();  <span class="comment">// 创建一个工厂</span></span><br><span class="line">PizzaStore nyStore = <span class="keyword">new</span> PizzaStore(nyFactory);   <span class="comment">// 建立一个比萨店，将纽约工厂的引用作为参数</span></span><br><span class="line">nyStore.orderPizza(<span class="string">"Cheese"</span>);  <span class="comment">// 制造纽约风味的比萨</span></span><br></pre></td></tr></table></figure><h2 id="更具弹性的设计">更具弹性的设计</h2><p>在推广 <code>SimpleFactory</code> 时，你发现加盟店的确是采用你的工厂创建比萨，但是其他部分，却开始采用他们自创的流程：烘烤的做法有些差异、不要切片、使用其他厂商的盒子。你希望能够给建立一个框架，把加盟店和创建比萨捆绑在一起的同时又保持一定的弹性。</p><p>我们先解决第一个问题：让你的加盟店可以采用各自的流程。很简单，提取出一个抽象比萨店即可。</p> <img src="http://www.plantuml.com/plantuml/svg/ZP6z3i8m38HtFuL76Fe6Y0M94I5rOdI3eH6DKhb1eloyEst3Jqg2O6frzyNodKkzPMHJknODcu85obvHMbJ5G4NZX9J3jJwVANTM62-0c6jJLpo8oywsqkBEVplJofPby2PJk86gg6bmjSbT-tZodfD45wLMjBT_ywlDQ96UKyBa-ClWd_GuzO3KmZK9TpPYGGV_euxE2_OqMcTHCZT-tbkho8JAOvSOVHelFgXWTisokCc8I1S8yGcoRFxH7dmfloSJzS4eR4TTvxuq21A7SXmxvQPUVbpPhnxMbmPUDQQE7wGA9_r2dpFl"><p>解决我们的第二个问题：把加盟店和创建比萨捆绑在一起。做法是在比萨店中使用一个抽象的方法代替原来的工厂对象。</p> <img src="http://www.plantuml.com/plantuml/svg/fL513e8m4Bpt5NlKGtzWk7Wt9fuyBdKZn1B8KXD1-RkK0bPQ4usNjZixdSvEi_n4G4Lb6YYeI8b5PX6Liz8aCAqDepAmpziM3wPaWhi0Lq9brxug-KGyGAjrNzwdMnqe9ZJqQbLC5J8DvnGlxg2knW7bhTyxeJJMDUoE1zDe-kNXvMjEU1BSPhd2S_ctwkYxMuGp2FqqtpOZgftm2zDO-CXeEgHEZPdlZRHvI1dc5p3YWOWtOo3b8t432i-T3uSMOztOpV2BfKmMmNpap8D_-5TBYwJt1JiMgUqFvHC0"><p><code>NYStylePizzaStore</code> 的工厂方法应该像这样：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    Pizza pizza;</span><br><span class="line">    <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> NYCheesePizza();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"clam"</span>)) &#123;</span><br><span class="line">        pizza = <span class="keyword">new</span> NYClamPizza();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pizza;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="定义工厂方法">定义工厂方法</h2><blockquote><p><strong>工厂方法模式</strong>定义了一个创建对象的接口，但由子类决定要实例化的类是哪一个。工厂方法让类把实例化推迟到子类。</p></blockquote><p>所谓的“决定”，并不是指模式允许子类本身在运行时做决定（工厂子类能生产的产品在编写时就已经固定了），而是指在编写创建者 <code>Creator</code> 类时，不需要知道实际创建的产品是哪一个。选择了使用哪个子类，自然就决定了实际创建的产品是什么。</p> <img src="http://www.plantuml.com/plantuml/svg/POux3i8m38RtdC8Z3Br1jyu8hk0wHedK99LZXghaxYrIWo1TBFdx7xRpbe73h0i43YEBSHz2NcXYWsDMGL9uIB8lKaCJvWn3YYIiNEdNDWYZ9e7L0AoL5dZkCyboOtN9NgwxYF4-iw3w5FUzDBs_DMsscECgzE-kExrIet_Y0KrZXlvasG00"><p><strong>问</strong>：当只有一个 <code>ConcreteCreator</code> 的时候，工厂方法模式有什么优点？</p><p><strong>答</strong>：尽管只有一个具体创建者，工厂方法模式依然很有用，因为它<strong>帮助我们将产品的“实现”从“使用”中解耦</strong>。如果增加产品或者改变产品的实现，<code>Creator</code> 并不会受到影响（因为 <code>Creator</code> 与任何 <code>ConcreteCreator</code> 之间都不是紧耦合）。</p><p><strong>问</strong>：如果说纽约和芝加哥的商店是利用简单工厂创建的，这样的说法是否正确？看起来倒是很像。</p><p><strong>答</strong>：他们很类似，但用法不同。<strong>在工厂方法中，工厂是一个抽象的方法，由每个子类自行负责方法的行为。在简单工厂中，工厂是另一个对象。</strong></p><h1 id="一个很依赖的比萨店">一个很依赖的比萨店</h1><p>假设你从未听过 OO 工厂。下面是一个不使用工厂模式的比萨店版本。数一数，这个类所以来的具体比萨对象有几种。如果又加了一种加州风味比萨到这个比萨店中，那么届时又会依赖几个对象？</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DependentPizzaStore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String style, String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (style.equals(<span class="string">"NY"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> NYCheesePizza();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"veggie"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> NYVeggiePizza();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (style.equals(<span class="string">"Chicago"</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (type.equals(<span class="string">"cheese"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> ChicagoCheesePizza();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">"veggie"</span>)) &#123;</span><br><span class="line">                pizza = <span class="keyword">new</span> ChicagoVeggiePizza();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Error: invalid type of pizza"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当你直接实例化一个对象时，就是在依赖它的具体类。如果把这个版本的比萨店和它依赖的对象画成一张图，看起来是这样的：</p> <img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYNd91ONAmHaLbKbSkNbbwGg56McPvHOAJpPD_V5rcbFTlKzwsnuDgVp-QoMP-kdl9YmukdwdIysBdo_foScx-di1Kzsx7gwhldvx2tF-fO-xPZzTFUk5_jdFjar6rdjuuOcBh3v2hgwTWf-aSuPgQd5gH0RaSN3KjFJCp74dJCoanFJyx5hWaeYwGG0"><h2 id="依赖倒置原则">依赖倒置原则</h2><blockquote><p>要依赖抽象，不要依赖具体类。</p></blockquote><p>首先，这个原则听起来很像是“针对接口编程，不针对实现编程”，不是吗？的确很相似，然而<strong>这里更强调“抽象”。</strong>这个原则说明了：不能让高层组件依赖低层组件，而且，不管高层或低层组件，“两者”都应该依赖于抽象。</p><p><code>PizzaStore</code> 是“高层组件”，而比萨实现是“低层组件”。非常依赖比萨店的主要问题在于：它依赖每个比萨类型。因为它是在自己的 <code>orderPizza()</code> 方法中，实例化这些具体类型的。</p><p>虽然我们创建了一个抽象，也就是 <code>Pizza</code>，但我们仍然在代码中，实际地创建了具体的 Pizza，所以，这个抽象没什么影响力。</p><p>如何在 <code>orderPizza()</code> 方法中，将这些实例化对象的代码独立出来？工厂方法刚好能派上用场。</p> <img src="http://www.plantuml.com/plantuml/svg/oyXCILL8pIqegLJ8JSrDIYtYoW2996SM9UUaSYKc5PSK9IQNA0HaLbKb1fVa5wLovUMNf2eKPQPdb5WfFDatzyNMQKzsD3pPiUfPrzuN6nS-txWRJHSNGg-2hguTig22JOskhe9Vf7D6QcfnAZQ9dCHS367dZCpanFHy79fWiZ2T0000"><p>在应用工厂方法之后，高层组件（<code>PizzaStore</code>）和低层组件（也就是这些比萨）都依赖了 <code>Pizza</code> 抽象。想要遵循依赖倒置原则，工厂方法并非是唯一的技巧，但却是最有威力的技巧之一。</p><h2 id="指导方针">指导方针</h2><p>下面的指导方针，能帮你避免在 OO 设计中违反依赖倒置原则：</p><ul><li>变量不可以持有具体类的引用。如果使用 <code>new</code>，就会持有具体类的引用。你可以改用工厂方法来避开这样的做法。</li><li>不要让类派生自具体类。如果派生自具体类，你就会依赖具体类。请派生自一个抽象（接口或抽象类）。</li><li>不要覆盖基类中已实现的方法。如果覆盖基类已实现的方法，那么你的基类就不是一个真正适合被继承的抽象。基类中已实现的方法，应该由所有的子类共享。</li></ul><p>要完全遵守这些指导方针不太可能，正如同我们的许多原则一样，应该尽量达到这个原则，而不是随时都要遵循这个原则。</p><p>如果你深入体验这些方针，将这些方针化成你思考的一部分，那么在设计时，你将知道何时有足够的理由违反这样的原则。比方说，如果有一个不像是会改变的类，那么在代码中直接实例化具体类也就没什么大碍。想想看，我们平常还不是在程序中不假思索地就实例化字符串对象吗？就没有违反这个原则？当然有！可以这么做吗？可以！为什么？因为字符串不可能改变。</p><p>另一方面，如果有个类可能改变，你可以采用一些好技巧（例如工厂方法）来封装改变。</p><h1 id="确保原料的一致">确保原料的一致</h1><p>比萨店成功的关键在于新鲜、高质量的原料，而且通过导入新的框架，加盟店将遵循你的流程，但是有一些加盟店，使用低价原料来增加利润。你必须采取一些手段，以免长此以往毁掉了比萨店的品牌。</p><p>你打算建造一家生产原料的工厂，并将原料运送到各家加盟店。对于这个做法，现在还剩下了一个问题：加盟店坐落在不同的区域，纽约的红酱料和芝加哥的红酱料是不一样的。</p><h2 id="原料家族">原料家族</h2><p>纽约使用一组原料，而芝加哥使用另一组原料。可能不久之后加州就有加盟店了，到时候又需要运送另一组区域的原料。想要行得通，必须先清楚如何处理原料家族。</p> <img src="http://www.plantuml.com/plantuml/svg/RP8zJWCn48NxFSLSm3T0D45qaH2aGnGJPxIsuf_8zXOiuG9fgP5eu12HE4uKZW74krcFeTmte_dUUrwbLmHaD-aHBDabXKRzAb87QQZ1PKm1POAPGHkdppliP36zybshYcL55AdPe5nZIt3SVnxt7_3K04Y3CS9reAZonL6QOz0E0-R3exfGsir25rC6ZF8jjQr6vmVEyvdqjNizxDuEB-yCvdjod7PZEhlm5fF_mvFhVu1pt_SOo1Wy8qy7uM8hH1c7gHFtHCao3reCQa-L5n1YUpaKpMif9xoPF1airndOS8e0ulxd1rYHUn1r_SnwkLUzHv6ykiRAhGANgxNNRm00"><h2 id="建造原料工厂">建造原料工厂</h2><p>我们要建造一个工厂来生产原料，这个工厂将负责创建原来家族中的每一种原料。也就是说，工厂将需要生产面团、酱料、芝士等。开始先为工厂定义一个接口，这个接口负责创建所有的原料。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dough <span class="title">createDough</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cheese <span class="title">createCheese</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Clams <span class="title">createClam</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> Veggies[] createVeggies();    <span class="comment">// 这里还有新的原料</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pepperoni <span class="title">createPepperoni</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来要做的事情是：</p><ol type="1"><li>为每个区域建造一个工厂。你需要创建一个继承自 <code>PizzaIngredientFactory</code> 的子类来实现每一个创建方法。</li><li>实现一组原料类功工厂使用。这些类可以在合适的区域间共享。</li><li>然后你仍然需要将这一切组织起来，将新的原料工厂整合进旧的 <code>PizzaStore</code> 代码中。</li></ol> <img src="http://www.plantuml.com/plantuml/svg/dLJFI-D05BxFN_7mf8TKzggo5sN1mow2NiJTmvYEJTXc8fFfGMj1PRMu-6F18ee7MN2t8EoXfzPMxHzZ9gad_mMJcOZfR9E5FOMyzxtllU_BHooxI80uwtm37EAi4eQik6BQp2mJX5Szph39OH5NpDJhd5ifMSWiOy-3ZvZP53Ei8AgsPDbqbbKydWOkb2lEakjWxcfGysiAQrDEs1es2IpOcvjudfOOATg4yW_HOfTjG1K1L5ylgO792EP4pevFZ6h9PL6hbYpyj2o9H_BgPACPPgEJSSdzVvetMwCH8aSonAwfPmIGR52K7e7w7k197qTebcpZ4r25oKa86otnvqVOwWr-xuUNPr3JBunWoPx2K7qw1KsE_mkQr6De3MM8c36Kq2aGpKPmS2xQlyJnRjYuyhjDSNmLd5qWPOHXl4-YzVQkigBqpcmPXfQtL4FFbt9CjlIG3RVIKSsIi5KeP2Ld2i9UCpZe1z_l1wsVIbmkJrv-K5OyOo-qM_EWGov55qgp_SvssFiczjh-_Mdi_UaEoiroJAIx-iy1tMlgSW9ZVgVxjDCNUqVYya5StmpwzQ3TzczRptU7d-cWV_5KFnGdDs6Z9-fTlxllTwx3vf4An-FsxXXW3-Wxf7538Ivcsi3iaiLNelzPaT0lHhxj-R8qfdJqz9uyx0K0"><h2 id="定义抽象工厂">定义抽象工厂</h2><blockquote><p><strong>抽象工厂模式</strong>提供一个接口，用于创建相关或依赖对象的<strong>家族</strong>，而不需要明确指定具体类。</p></blockquote><p>抽象工厂允许客户使用抽象的接口来创建一组相关的产品，而不需要知道实际产出的具体产品是什么。这样一来，客户就从具体的产品中被解耦。</p> <img src="http://www.plantuml.com/plantuml/svg/bLEzJiCm4Dxz53V2a4Zs25Mak18pEs98dIk9b9_ACKELHW89dg3iZ3m22CJRfEfh4DeaJMCdb26oxZv_ttVdkmIXZu3nGYqXndY6aWI_6H5A4I7nPfcIdb1mBLF_NYWN9fCmKIZdda37qN3UmqNaPLbBPiSnfpsy5tD6MYrmQwUhwalbyjW7SWAGDyKK82Hw2XlPi_CHb5TeKVjEqwJ25DOUT2Thq3fLWFr3e7t9QHHYedRCVi_p_MdGXBm1xJvq2ON1SOZ0zuI2QEzjrPMHka3BSjf16N8kEQpCoh8wEs3EKt9OeKwUiu4yrIjSsROsmfDkCQ9DljiT7OLTUW7RbzVoywtyUDX-FMsUtyllTHLkrez4MuWkaOt2t5IL3Ey2TLFzeJucjzQVVJ2DeKzdu0R_0G00"><h2 id="工厂方法潜伏在抽象工厂里面">工厂方法潜伏在抽象工厂里面</h2><p>是的，抽象工厂的方法经常以工厂方法的方式实现。抽象工厂的任务是定义一个负责<strong>创建一组产品的接口</strong>（<code>createProductA</code>、<code>createProductB</code>）。这个接口内的<strong>每个方法</strong>都负责创建一个具体产品，同时我们利用抽象工厂的子类来提供这些具体的做法。所以，在抽象工厂中利用工厂方法实现生产方法是相当自然的做法。</p><h1 id="要点">要点</h1><ul><li>所有的工厂都是用来封装对象的创建。</li><li>简单工厂，虽然不是真正的设计模式，但仍不失为一个简单的方法，可以将客户程序从具体类中解耦。</li><li><strong>工厂方法使用继承：把对象的创建委托给子类，子类实现工厂方法来创建对象。</strong></li><li><strong>抽象工厂使用对象组合：对象的创建被是现在工厂接口所暴露出来的方法中。</strong></li><li>工厂方法允许类将实例化延迟到子类进行。</li><li>抽象工厂创建相关的对象家族，而不需要依赖它们的具体类。</li><li>依赖倒置原则，知道我们避免依赖具体类型，而要尽量依赖抽象类型。</li></ul></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/decorator-pattern/" rel="bookmark">装饰者模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/singleton-pattern/" rel="bookmark">单件模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/observer-pattern/" rel="bookmark">观察者模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/notes/head-first-design-patterns/strategy-pattern/" rel="bookmark">策略模式</a></div></li></ul><footer class="post-footer"><div class="post-tags"> <a href="/tags/Head-First-Design-Patterns/" rel="tag"># Head First Design Patterns</a></div><div class="post-nav"><div class="post-nav-item"><a href="/notes/head-first-design-patterns/decorator-pattern/" rel="prev" title="装饰者模式"><i class="fa fa-chevron-left"></i> 装饰者模式</a></div><div class="post-nav-item"> <a href="/notes/head-first-design-patterns/singleton-pattern/" rel="next" title="单件模式">单件模式<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#导入比萨店"><span class="nav-number">1.</span> <span class="nav-text">导入：比萨店</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#当看到-new就会想到具体"><span class="nav-number">1.1.</span> <span class="nav-text">当看到 &quot;new&quot;，就会想到具体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单工厂"><span class="nav-number">1.2.</span> <span class="nav-text">简单工厂</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#加盟比萨店"><span class="nav-number">2.</span> <span class="nav-text">加盟比萨店</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#多个简单工厂"><span class="nav-number">2.1.</span> <span class="nav-text">多个简单工厂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更具弹性的设计"><span class="nav-number">2.2.</span> <span class="nav-text">更具弹性的设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义工厂方法"><span class="nav-number">2.3.</span> <span class="nav-text">定义工厂方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一个很依赖的比萨店"><span class="nav-number">3.</span> <span class="nav-text">一个很依赖的比萨店</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#依赖倒置原则"><span class="nav-number">3.1.</span> <span class="nav-text">依赖倒置原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指导方针"><span class="nav-number">3.2.</span> <span class="nav-text">指导方针</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#确保原料的一致"><span class="nav-number">4.</span> <span class="nav-text">确保原料的一致</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#原料家族"><span class="nav-number">4.1.</span> <span class="nav-text">原料家族</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#建造原料工厂"><span class="nav-number">4.2.</span> <span class="nav-text">建造原料工厂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义抽象工厂"><span class="nav-number">4.3.</span> <span class="nav-text">定义抽象工厂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工厂方法潜伏在抽象工厂里面"><span class="nav-number">4.4.</span> <span class="nav-text">工厂方法潜伏在抽象工厂里面</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#要点"><span class="nav-number">5.</span> <span class="nav-text">要点</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Chen" src="/uploads/avatar/nekosensei.png"><p class="site-author-name" itemprop="name">Chen</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">121</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">129</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2019 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Chen</span></div><script src="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><script src="/js/aplayer-el.js"></script><script src="//unpkg.com/video.js/dist/video.min.js"></script><script src="/js/videojs-bilibili.js"></script><script src="/js/videojs-bilibili-el.js"></script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script src="/js/local-search.js"></script><div id="pjax"><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Axl15EIRi5o5AatKaxXxV4Oq-gzGzoHsz',
      appKey     : 'E0qm04UjsP0qQN1l8ME3GQ25',
      placeholder: "Just go go",
      avatar     : 'identicon',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></div></body></html>