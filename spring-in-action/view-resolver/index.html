<!DOCTYPE html><html lang="zh-CN,en,default"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/uploads/icon/drop/128x128.png"><link rel="icon" type="image/png" sizes="32x32" href="/uploads/icon/drop/32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/uploads/icon/drop/16x16.png"><link rel="mask-icon" href="/uploads/icon/drop/drop.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="NKt2iJb3Hnl6-Sm7LB-fTT7LRyi9cg5yZrB-zd0ohtk"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"cwscn.github.io",root:"/",scheme:"Mist",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"fadeIn"}},path:"search.xml"}</script><meta name="description" content="理解视图解析 控制器的方法会返回一个 String 类型的值，这个值是视图的逻辑名称。 将控制器中请求处理的逻辑和视图中渲染实现解耦是 Spring MVC 的一个重要特性。控制器方法和视图的实现会在模型内容上达成一致，这是两者的最大关联，除此之外，两者应该保持足够的距离。 Spring MVC 定义了一个名为 ViewResolver 的接口： // 接收视图名和 Locale 对象，返回一个"><meta name="keywords" content="blog"><meta property="og:type" content="article"><meta property="og:title" content="渲染 Web 视图"><meta property="og:url" content="https://cwscn.github.io/spring-in-action/view-resolver/index.html"><meta property="og:site_name" content="编程之路"><meta property="og:description" content="理解视图解析 控制器的方法会返回一个 String 类型的值，这个值是视图的逻辑名称。 将控制器中请求处理的逻辑和视图中渲染实现解耦是 Spring MVC 的一个重要特性。控制器方法和视图的实现会在模型内容上达成一致，这是两者的最大关联，除此之外，两者应该保持足够的距离。 Spring MVC 定义了一个名为 ViewResolver 的接口： // 接收视图名和 Locale 对象，返回一个"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cwscn.github.io/uploads/image/spring-in-action/InternalResourceViewResolver.png"><meta property="og:updated_time" content="2020-09-17T06:33:50.766Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="渲染 Web 视图"><meta name="twitter:description" content="理解视图解析 控制器的方法会返回一个 String 类型的值，这个值是视图的逻辑名称。 将控制器中请求处理的逻辑和视图中渲染实现解耦是 Spring MVC 的一个重要特性。控制器方法和视图的实现会在模型内容上达成一致，这是两者的最大关联，除此之外，两者应该保持足够的距离。 Spring MVC 定义了一个名为 ViewResolver 的接口： // 接收视图名和 Locale 对象，返回一个"><meta name="twitter:image" content="https://cwscn.github.io/uploads/image/spring-in-action/InternalResourceViewResolver.png"><link rel="canonical" href="https://cwscn.github.io/spring-in-action/view-resolver/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css"><style>.aplayer.aplayer-arrow .aplayer-icon-loop,.aplayer.aplayer-arrow .aplayer-icon-order{display:inline-block}.aplayer ol li.aplayer-list-light .aplayer-list-author,.aplayer ol li.aplayer-list-light .aplayer-list-index,.aplayer ol li.aplayer-list-light .aplayer-list-title{color:coral}.pace .pace-progress{background:coral}</style><title>渲染 Web 视图 | 编程之路</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">编程之路</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><meting-js server="netease" type="playlist" id="67155774" theme="#ff7f50" loop="all" order="list" preload="none" volume="" mutex="" list-folded="NaN" fixed="true"></meting-js></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://cwscn.github.io/spring-in-action/view-resolver/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="CNCWS"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="编程之路"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 渲染 Web 视图</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-17 14:33:50" itemprop="dateModified" datetime="2020-09-17T14:33:50+08:00">2020-09-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/books/" itemprop="url" rel="index"><span itemprop="name">书籍</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/books/spring-in-action/" itemprop="url" rel="index"><span itemprop="name">Spring 实战</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="理解视图解析">理解视图解析</h1><p>控制器的方法会返回一个 String 类型的值，这个值是视图的逻辑名称。</p><p>将控制器中请求处理的逻辑和视图中渲染实现解耦是 Spring MVC 的一个重要特性。控制器方法和视图的实现会<strong>在模型内容上达成一致，这是两者的最大关联</strong>，除此之外，两者应该保持足够的距离。</p><p>Spring MVC 定义了一个名为 <code>ViewResolver</code> 的接口：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 接收视图名和 Locale 对象，返回一个 View 实例</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ViewResolver</span> </span>&#123;</span><br><span class="line">    <span class="function">View <span class="title">resolveViewName</span><span class="params">(String var1, Locale var2)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收模型以及 Servlet 的 request 和 response 对象，并将输出结果渲染到 response 中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">(Map&lt;String, ?&gt; var1,</span></span></span><br><span class="line"><span class="function"><span class="params">                HttpServletRequest var2,</span></span></span><br><span class="line"><span class="function"><span class="params">                HttpServletResponse var3)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们所需要做的就是编写 ViewResolver 和 View 的实现，将要渲染的内容放到 response 中。</p><p>尽管我们可以编写 ViewResolver 和 View 的实现，但是一般来讲，我们并不需要关心这些接口。Spring 提供了多个内置的实现，它们能够适应大多数的场景。在大多数应用中，只会用到其中很少的一部分。</p><table><colgroup><col style="width:25%"><col style="width:75%"></colgroup><thead><tr class="header"><th>视图解析器</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>BeanNameViewResolver</code></td><td>将视图解析为 Spring 应用上下文中的 bean，其中 bean 的 ID 与视图的名字相同</td></tr><tr class="even"><td><code>ContentNegotiatingViewResolver</code></td><td>通过考虑客户端需要的内容类型来解析视图，委托给另外一个能够产生对应内容类型的视图解析器</td></tr><tr class="odd"><td><code>FreeMarkerViewResolver</code></td><td>将视图解析为 FreeMarker 模板</td></tr><tr class="even"><td><code>InternalResourceViewResolver</code></td><td>将视图解析为 Web 应用的内部资源（一般是 JSP）</td></tr><tr class="odd"><td><code>JasperReportsViewResolver</code></td><td>将视图解析为 JasperReports 定义</td></tr><tr class="even"><td><code>ResourceBundleViewResolver</code></td><td>将视图解析为资源 bundle（一般为属性文件）</td></tr><tr class="odd"><td><code>TilesViewResolver</code></td><td>将视图解析为 Apache Tile 定义，其中 tile ID 与视图名称相同。有两个不同的 <code>TilesViewResolver</code> 实现，分别对应于 Tiles 2.0 和 Tile 3.0</td></tr><tr class="even"><td><code>UrlBasedViewResolver</code></td><td>直接根据视图的名称解析视图，视图的名称会匹配一个物理视图的定义</td></tr><tr class="odd"><td><code>VelocityLayoutViewResolver</code></td><td>将视图解析为 Velocity 布局，从不同的 Velocity 模板中组合页面</td></tr><tr class="even"><td><code>VelocityViewResolver</code></td><td>将视图解析为 Velocity 模板</td></tr><tr class="odd"><td><code>XmlViewResolver</code></td><td>将视图解析为特定 XML 文件中的 bean 定义。类似于 <code>BeanNameViewResolver</code></td></tr><tr class="even"><td><code>XsltViewResolver</code></td><td>将视图解析为 XSLT 转换后的结果</td></tr></tbody></table><a id="more"></a><h1 id="创建-jsp-视图">创建 JSP 视图</h1><p>有一些视图解析器，如 <code>ResourceBundleViewResolver</code> 会直接将逻辑视图名映射为特定的 View 接口实现，而 <code>InternalResourceViewResolver</code> 所采取的方式并不那么直接。它遵循一种约定，会在视图名上添加前缀和后缀，进而确定一个 Web 应用中视图资源的物理路径。</p><p><img src="/uploads/image/spring-in-action/InternalResourceViewResolver.png"></p><p>创建视图解析器 bean：</p><ol type="1"><li><p>使用注解</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    InternalResourceViewResolver resolver =</span><br><span class="line">            <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">    resolver.setPrefix(<span class="string">"/WEB-INF/views/"</span>);</span><br><span class="line">    resolver.setSuffix(<span class="string">".jsp"</span>);</span><br><span class="line">    <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li><li><p>使用 XML</p><p></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:prefix</span>=<span class="string">"/WEB-INF/views/"</span> <span class="attr">p:suffix</span>=<span class="string">".jsp"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p></p></li></ol><h2 id="解析-jstl-视图">解析 JSTL 视图</h2><p>到目前为止，<code>InternalResourceViewResolver</code> 的配置很简单，它最终会将逻辑视图名解析为 <code>InternalResourceView</code> 实例，这个实例会引用 JSP 文件。但是，如果 JSP 使用 JSTL（JSP Standard Tag Library） 标签来<strong>处理格式化和信息</strong>的话，那么我们希望 <code>InternalResourceViewResolver</code> 将视图解析为 <code>JstlView</code>。</p><p><strong>JSTL 的格式化标签需要一个 Locale 对象，以便于恰当地格式化地域相关的值，如日期和货币</strong>。</p><p>如果想让 <code>InternalResourceViewResolver</code> 将视图解析为 <code>JstlView</code>，我们只需设置它的 ViewClass 属性即可：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    InternalResourceViewResolver resolver =</span><br><span class="line">            <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">    resolver.setPrefix(<span class="string">"/WEB-INF/views/"</span>);</span><br><span class="line">    resolver.setSuffix(<span class="string">".jsp"</span>);</span><br><span class="line">    resolver.setViewClass(</span><br><span class="line">            org.springframework.web.servlet.view.JstlView.class);</span><br><span class="line">    <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用-spring-的-jsp-库">使用 Spring 的 JSP 库</h2><p>当为 JSP 添加功能时，标签库是一种很强大的方式，能够避免在脚本块中直接编写 Java 代码。</p><p>Spring 提供了两个 JSP 标签库，用来帮助定义 Spring MVC Web 的视图。<strong>其中一个标签库会用来渲染 HTML 表单标签，这些标签可以绑定 model 中的某个属性</strong>。另外一个标签库包含了一些工具类标签。</p><h3 id="将表单绑定到模型上">将表单绑定到模型上</h3><p>Spring 的表单绑定 JSP 标签库包含 14 个标签，它们中的大多数都用来渲染 HTML 中的表单标签。<strong>它们与原生 HTML 标签的区别在于它们会绑定模型中的一个对象，能够根据模型中对象的属性填充值</strong>。标签库中还包含了一个<strong>为用户展现错误的标签</strong>，它会将错误信息渲染到最终的 HTML 之中。</p><p>为了使用表单绑定库，需要在 JSP 页面中对其进行声明：<code>&lt;%@ taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;sf&quot; %&gt;</code>。可以选择任意喜欢的前缀，<code>&quot;sf&quot;</code> 是一个很好的选择，它很简洁、易于输入。</p><table><thead><tr class="header"><th>JSP 标签</th><th>描述</th></tr></thead><tbody><tr class="odd"><td><code>&lt;sf:checkbox&gt;</code></td><td>渲染成一个 <code>&lt;input type=&quot;checkbox&quot;&gt;</code> 标签</td></tr><tr class="even"><td><code>&lt;sf:checkboxes&gt;</code></td><td>渲染成多个 <code>&lt;input type=&quot;checkbox&quot;&gt;</code> 标签</td></tr><tr class="odd"><td><code>&lt;sf:errors&gt;</code></td><td>在一个 <code>&lt;span&gt;</code> 中渲染输入域的错误</td></tr><tr class="even"><td><code>&lt;sf:form&gt;</code></td><td>渲染成一个 <code>&lt;form&gt;</code> 标签</td></tr><tr class="odd"><td><code>&lt;sf:hidden&gt;</code></td><td><code>&lt;input type=&quot;hidden&quot;&gt;</code></td></tr><tr class="even"><td><code>&lt;sf:input&gt;</code></td><td><code>&lt;input type=&quot;text&quot;&gt;</code></td></tr><tr class="odd"><td><code>&lt;sf:label&gt;</code></td><td><code>&lt;label&gt;</code></td></tr><tr class="even"><td><code>&lt;sf:option&gt;</code></td><td><code>&lt;option&gt;</code></td></tr><tr class="odd"><td><code>&lt;sf:options&gt;</code></td><td>多个 <code>&lt;option&gt;</code></td></tr><tr class="even"><td><code>&lt;sf:password&gt;</code></td><td><code>&lt;input type=&quot;password&quot;&gt;</code></td></tr><tr class="odd"><td><code>&lt;sf:radiobutton&gt;</code></td><td>一个 <code>&lt;input type=&quot;radio&quot;&gt;</code></td></tr><tr class="even"><td><code>&lt;sf:rediobuttons&gt;</code></td><td>多个 <code>&lt;input type=&quot;radio&quot;&gt;</code></td></tr><tr class="odd"><td><code>&lt;sf:select&gt;</code></td><td><code>&lt;select&gt;</code></td></tr><tr class="even"><td><code>&lt;sf:textarea&gt;</code></td><td><code>&lt;textarea&gt;</code></td></tr></tbody></table><p>使用示例：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">commandName</span>=<span class="string">"spitter"</span>&gt;</span>       <span class="comment">&lt;!-- 绑定到模型对象 spitter --&gt;</span></span><br><span class="line">  First Name: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"firstName"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span>   <span class="comment">&lt;!-- 值会绑定到 spitter.firstName 属性 --&gt;</span></span><br><span class="line">  Last Name: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"lastName"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  Email: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"email"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  Username <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  Password <span class="tag">&lt;<span class="name">sf:password</span> <span class="attr">path</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Register"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们设置了 <code>commandName=&quot;spitter&quot;</code>，因此在模型中必须要有一个 key 为 spitter 的对象，否则表单不能正常渲染。我们要修改一下控制器中对应的方法，确保模型中存在以 spitter 为 key 的 Spitter 对象：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/register"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">showRegistrationForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">    model.addAttribute(<span class="keyword">new</span> Spitter());                  <span class="comment">// 默认名为 类名首字母小写</span></span><br><span class="line">    <span class="comment">// model.addAttribute("spitter", new Spitter());    // 或者显式指定</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"registerForm"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从 Spring 3.1 开始，<code>&lt;sf:input&gt;</code> 标签能够允许我们指定 type 属性，这样的话，除了其他可选的类型外，还能指定 HTML 5 特定类型的文本域，如 data、range 和 email。例如，我们可以按照如下的方式指定 email 域：<code>&lt;sf:input path=&quot;email&quot; type=&quot;email&quot; /&gt;</code>。</p><h3 id="展现错误">展现错误</h3><p>如果存在校验错误的话，请求中会包含错误的详细信息，这些信息是与模型数据放到一起的。我们所需要做的就是到模型中将这些数据抽取出来，并展现给用户。<code>&lt;sf:errors&gt;</code> 能够让这项任务变得很简答：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">commandName</span>=<span class="string">"spitter"</span>&gt;</span></span><br><span class="line">  First Name: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"firstName"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">sf:errors</span> <span class="attr">path</span>=<span class="string">"firstName"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span>  <span class="comment">&lt;!-- 显示 firstName 属性的错误（如果有校验错误的话） --&gt;</span></span><br><span class="line">  Last Name: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"lastName"</span> /&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">sf:errors</span> <span class="attr">path</span>=<span class="string">"lastName"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>设置 css class</strong>：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:errors</span> <span class="attr">path</span>=<span class="string">"lastName"</span> <span class="attr">cssClass</span>=<span class="string">"error"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><strong>显示所有错误：</strong></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">commandName</span>=<span class="string">"spitter"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">sf:errors</span> <span class="attr">path</span>=<span class="string">"*"</span> <span class="attr">element</span>=<span class="string">"div"</span> /&gt;</span></span><br><span class="line">  First Name: <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"firstName"</span> /&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>path 被设置成了 <code>&quot;*&quot;</code>，这是一个通配符选择器，会告诉 <code>&lt;sf:errors&gt;</code> 展现所有属性的所有错误。还设置了 <code>element=&quot;div&quot;</code>。默认情况下，错误都会渲染在一个 <code>&lt;span&gt;</code> 标签中，如果只显示一个错误的话，这是不错的选择。但是，如果要渲染所有输入域的错误的话，很可能要展示不止一个错误，这时候使用像 <code>&lt;div&gt;</code> 这样的块级元素会更为合适。</p><p><strong>着重显示需要修正的输入域</strong>：</p><p>可以为每个输入域设置 cssErrorClass 属性，也可以将每个 label 都替换成 <code>&lt;sf:label&gt;</code> 并设置它的 cssErrorClass 属性。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sf:form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">commandName</span>=<span class="string">"spitter"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">sf:label</span> <span class="attr">path</span>=<span class="string">"firstName"</span> <span class="attr">cssErrorClass</span>=<span class="string">"error"</span>&gt;</span>First Name<span class="tag">&lt;/<span class="name">sf:label</span>&gt;</span>:</span><br><span class="line">  <span class="tag">&lt;<span class="name">sf:input</span> <span class="attr">path</span>=<span class="string">"firstName"</span> <span class="attr">cssErrorClass</span>=<span class="string">"error"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">sf:form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;sf:label&gt;</code> 也使用 <code>path</code> 绑定某个属性，如果绑定的属性没有校验错误的话，它将会渲染为 <code>&lt;label for=&quot;firstName&quot;&gt;First Name&lt;/label&gt;</code>；如果有错误的话，在渲染得到的 <code>&lt;label&gt;</code> 元素中，class 属性将会被设置为 <code>error</code>：<code>&lt;label for=&quot;firstName&quot; class=&quot;error&quot;&gt;First Name&lt;/label&gt;</code>。</p><p><strong>将错误信息抽取到属性文件中</strong>：</p><p>我们可以在校验注解上设置 message 属性，使其引用对用户更为友好的信息：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="meta">@Size</span>(min=<span class="number">5</span>, max=<span class="number">16</span>, message=<span class="string">"&#123;username.size&#125;"</span>)    <span class="comment">// 使用 &#123;&#125; 占位符，properties 中也使用到了</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><figure class="highlight plain"><figcaption><span>VaildationMessages.properties</span></figcaption><table><tr><td class="code"><pre><span class="line">username.size=Username must be between &#123;min&#125; and &#123;max&#125; characters long.</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><p>将这些错误信息抽取到属性文件还会带来一个好处，那就是我们<strong>可以通过创建地域相关的属性文件，为用户展现特定语言和地域的信息</strong>。</p><h3 id="spring-通用的标签库">Spring 通用的标签库</h3><p>除了表单绑定的标签库之外，Spring 还提供了更为通用的 JSP 标签库。</p><p>要使用 Spring 通用的标签库，必须要在页面上对其进行声明：<code>&lt;%@ tablib uri=&quot;http&quot;//www.springframework.org/tags&quot; prefix=&quot;s&quot; %&gt;</code>。</p><p>下面只重点介绍几个标签。</p><p><strong>展现国际化信息</strong>：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcom to Spitter!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>     <span class="comment">&lt;!-- 使用 &lt;s:message&gt; 替换硬编码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">s:message</span> <span class="attr">code</span>=<span class="string">"spittr.welcome"</span> /&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>按照上述方式，<code>&lt;s:message&gt;</code> 将会根据 key 为 <code>spittr.welcom</code> 的信息源来渲染文本。因此，需要配置一个这样的信息源：</p><p>Spring 有多个信息源的类，它们都实现了 MessageSource 接口。</p><ul><li><p>使用 <code>ResourceBundleMessageSource</code></p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ResourceBundleMessageSource messageSource =</span><br><span class="line">            <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">    messageSource.setBasename(<span class="string">"message"</span>);       <span class="comment">// 设置基础名称（加载 message.properties 文件）</span></span><br><span class="line">    <span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li><li><p>使用 <code>ReloadableResourceBundleMessageSource</code></p><p><code>ReloadableResourceBundleMessageSource</code> 与上一个类似，但是它能够重新加载信息属性，而不必重新编译或重启应用。</p><p>这里的关键区别在于 <strong><code>basename</code> 属性设置为在应用的外部查找</strong>。<code>basename</code> 属性可以设置为在**类路径下（以 <code>&quot;classpath:&quot;</code> 作为前缀）、文件系统中（以 <code>&quot;file:&quot;</code> 作为前缀）或 Web 应用的根路径下（没有前缀）查找属性。</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ReloadableResourceBundleMessageSource messageSource =</span><br><span class="line">            <span class="keyword">new</span> ReloadableResourceBundleMessageSource();</span><br><span class="line">    messageSource.setBasename(<span class="string">"file:///etc/spittr/message"</span>);</span><br><span class="line">    messageSource.setCacheSeconds(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> messageSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li></ul><p>最后，创建对应的文件：</p><figure class="highlight plain"><figcaption><span>/path/to/message.properties</span></figcaption><table><tr><td class="code"><pre><span class="line">spittr.welcom=Welcome to Spittr!</span><br></pre></td></tr></table></figure><p><strong>创建 URL</strong>：</p><p><code>&lt;s:url&gt;</code> 是 JSTL 中 <code>&lt;c:url&gt;</code> 标签的替代者，但是它具备几项特殊的技巧。</p><p><code>&lt;s:url&gt;</code> 会接受一个<strong>相对于 Servlet 上下文的 URL，并在渲染的时候，预先添加上 Servlet 上下文路径</strong>。例如，如果应用的 Servlet 上下文名为 spittr：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;s:url href="</span>/<span class="attr">spitter</span>/<span class="attr">register</span>" /&gt;</span>"&gt;Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将渲染为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/spittr/spitter/register"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样，我们在创建 URL 的时候，就不必再担心 Servlet 上下文路径是什么了。</p><p>另外，我们还可以使用 <code>&lt;s:url&gt;</code> 创建 URL，并将其赋值给一个变量供模板在稍后使用：</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">"/spitter/register"</span> <span class="attr">var</span>=<span class="string">"registerUrl"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;registerUrl&#125;"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改作用域（默认情况下，在页面作用域内创建 URL）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">"/spitter/register"</span> <span class="attr">var</span>=<span class="string">"registerUrl"</span> <span class="attr">scope</span>=<span class="string">"request"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 添加参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">"/spitter/register"</span> <span class="attr">var</span>=<span class="string">"registerUrl"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"max"</span> <span class="attr">value</span>=<span class="string">"60"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 带有路径参数的 URL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">"/spitter/&#123;username&#125;"</span> <span class="attr">var</span>=<span class="string">"spitterUrl"</span>&gt;</span>  <span class="comment">&lt;!-- 使用占位符 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"jbauer"</span> /&gt;</span>  <span class="comment">&lt;!-- 匹配的参数，插入到占位符的位置中 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"max"</span> <span class="attr">value</span>=<span class="string">"60"</span> /&gt;</span>  <span class="comment">&lt;!-- 无法匹配任何占位符，将作为查询参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 显示 URL 内容（而不是作为超链接），应对其进行 HTML 转义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:url</span> <span class="attr">href</span>=<span class="string">"/spitter/register"</span> <span class="attr">var</span>=<span class="string">"registerUrl"</span> <span class="attr">javaScriptEscape</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"max"</span> <span class="attr">value</span>=<span class="string">"60"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:url</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>转义内容</strong>：</p><p><code>&lt;s:escapeBody&gt;</code> 标签是一个通用的转义标签。它会渲染标签体中内嵌的内容，并且在必要的时候进行转义。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:escapeBody</span> <span class="attr">htmlEscape</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:escapeBody</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 上面一段将渲染成 --&gt;</span></span><br><span class="line">&amp;lt;h1&amp;gt;Hello&amp;lt;/h1&amp;gt;</span><br></pre></td></tr></table></figure><p><code>&lt;s:escapeBody&gt;</code> 只会渲染内容，并不能将内容设置为变量。</p><h1 id="使用-apache-tiles-视图定义布局">使用 Apache Tiles 视图定义布局</h1><p>每个 JSP 完全负责定义自身的布局，扩展性不好，难以维护。更好的方式是使用布局引擎，如 Apache Tiles，定义适用于所有页面的通用页面布局。</p><h2 id="配置-tiles-视图解析器">配置 Tiles 视图解析器</h2><ol type="1"><li><p>配置 <code>TilesConfigurer</code> 来解析 Tiles 定义。</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TilesConfigurer <span class="title">tilesConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TilesConfigurer tiles = <span class="keyword">new</span> TilesConfigurer();</span><br><span class="line">    tiles.setDefinitions(<span class="keyword">new</span> String[]&#123;<span class="string">"/WEB-INF/layout/tiles.xml"</span>&#125;);</span><br><span class="line">    tiles.setCheckRefresh(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> tiles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>配置 <code>TilesConfigurer</code> 时，最重要的属性是 definitions，这个属性接受一个 String 类型数组，每个条目都指定一个 Tile 定义的 XML 文件。</p><p>还可以使用通配符：<code>tiles.setDefinitions(new String[]{&quot;/WEB-INF/**/tiles.xml&quot;});</code></p></li><li><p>配置 <code>TilesViewResolver</code>：</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TilesViewResolver();     <span class="comment">// 没有要设置的属性</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li><li><p>定义 Tiles</p><p>Apache Tiles 提供了一个文档类型定义（document type definition，DTD），用来在 XML 文件中指定 Tile 的定义。</p><p></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="iso-8859-1" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE tiles-definitions PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Apache Software Foundation//DTD Tiles Configuration 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://tiles.apache.org/dtds/tiles-config_3_0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tiles-definitions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">"base"</span> <span class="attr">template</span>=<span class="string">"/WEB-INF/layout/page.jsp"</span>&gt;</span>     <span class="comment">&lt;!-- 供其他的 Tile 定义扩展 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">"header"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/layout/header.jsp"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">"footer"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/layout/footer.jsp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">"home"</span> <span class="attr">extends</span>=<span class="string">"base"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">"body"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/home.jsp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">definition</span> <span class="attr">name</span>=<span class="string">"registerForm"</span> <span class="attr">extends</span>=<span class="string">"base"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">put-attribute</span> <span class="attr">name</span>=<span class="string">"body"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/registerForm.jsp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">definition</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ... ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">tiles-definitions</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p><strong>主布局模板：引用其他模板来创建视图</strong></p><p></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://www.springframework.org/tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://tiles.apache.org/tags-tiles"</span> <span class="attr">prefix</span>=<span class="string">"t"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spittr<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">t:insertAttribute</span> <span class="attr">name</span>=<span class="string">"header"</span> /&gt;</span>     <span class="comment">&lt;!-- 插入头部 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">t:insertAttribute</span> <span class="attr">name</span>=<span class="string">"body"</span> /&gt;</span>       <span class="comment">&lt;!-- 插入主体内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"footer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">t:insertAttribute</span> <span class="attr">name</span>=<span class="string">"footer"</span> /&gt;</span>     <span class="comment">&lt;!-- 插入底部 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p></li></ol><h1 id="使用-thymeleaf">使用 Thymeleaf</h1><p>JSP 最明显的问题在于它看起来像 HTML 或 XML，但它其实并不是。大多数的 JSP 模板都是采用 HTML 的形式，但又掺杂上了各种 JSP 标签库的标签，使其变得很混乱。</p><p>同时，JSP 规范是与 Servlet 规范紧密耦合的。这意味着它只能用在基于 Servlet 的 Web 应用之中。JSP 模板不能作为通用的模板（如格式化 Email），也不能用于非 Servlet 的 Web 应用。</p><p>Thymeleaf 是一种用来替代 JSP 的技术，Thymeleaf 模板是原生的，不依赖于标签库。它能在接受原始 HTML 的地方进行编辑和渲染。也没有与 Servlet 规范耦合，能够进入 JSP 所无法涉足的领域。</p><p>在 Spring MVC 中使用 Thymeleaf。</p><ol type="1"><li><p>配置 Thymeleaf 视图解析器，需要配置三个启用 Thymeleaf 与 Spring 集成的 bean：</p><ul><li>ThymeleafViewResolver：将逻辑视图名称解析为 Thymeleaf 模板视图</li><li>SpringTemplateEngine：处理模板并渲染结果</li><li>TemplateResolver：加载 Thymeleaf 模板</li></ul><p></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SpringResourceTemplateResolver <span class="title">templateResolver</span><span class="params">()</span></span>&#123;  <span class="comment">// 模板解析器</span></span><br><span class="line">    SpringResourceTemplateResolver templateResolver = <span class="keyword">new</span> SpringResourceTemplateResolver();</span><br><span class="line">    templateResolver.setPrefix(<span class="string">"/WEB-INF/templates/"</span>);</span><br><span class="line">    templateResolver.setSuffix(<span class="string">".html"</span>);</span><br><span class="line">    templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">    templateResolver.setCacheable(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> templateResolver;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SpringTemplateEngine <span class="title">templateEngine</span><span class="params">()</span></span>&#123;               <span class="comment">// 模板引擎</span></span><br><span class="line">    SpringTemplateEngine templateEngine = <span class="keyword">new</span> SpringTemplateEngine();</span><br><span class="line">    templateEngine.setTemplateResolver(templateResolver());</span><br><span class="line">    templateEngine.setEnableSpringELCompiler(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> templateEngine;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">(SpringTemplateEngine templateEngine)</span> </span>&#123; <span class="comment">// 视图解析器</span></span><br><span class="line">    ThymeleafViewResolver viewResolver = <span class="keyword">new</span> ThymeleafViewResolver();</span><br><span class="line">    viewResolver.setTemplateEngine(templateEngine);</span><br><span class="line">    <span class="keyword">return</span> viewResolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></li><li><p>定义 Thymeleaf 模板</p><p>Thymeleaf 在很大程度上就是 HTML 文件，它没有什么特殊的标签或者库。Thymeleaf 之所以能发挥作用，是因为它通过自定义的命名空间，为标准的 HTML 标签集合添加 Thymeleaf 属性。</p><p></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Spittr<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to Spitter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- @&#123;&#125; 用来计算相对于 URL 的路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:herf</span>=<span class="string">"@&#123;/spittles&#125;"</span>&gt;</span>Spittles<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/spitter/register&#125;"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>模板只使用了 <code>th:href</code> 属性，它的特殊之处在于它的值可以包含 Thymeleaf 表达式，用来计算动态的值，它会渲染成一个标准的 href 属性。这是 Thymeleaf 命名空间中很多属性的运行方式：<strong>它们对应标准的 HTML 属性，并且具有相同的名称，但是会渲染一些计算后得到的值</strong>。</p></li><li><p>借助 Thymeleaf 实现表单绑定</p><p></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- $&#123;&#125; 是变量表达式，在使用 Spring 时，它是 SpEL 表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;spitter&#125;"</span>&gt;</span>     <span class="comment">&lt;!-- 绑定 spitter 对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"errors"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;#fields.hasErrors('*')&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">"err : $&#123;#fields.errors('*')&#125;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">th:text</span>=<span class="string">"$&#123;err&#125;"</span>&gt;</span>Input is incorrect<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:class</span>=<span class="string">"$&#123;#fields.hasErrors('firstName')&#125;? 'error'"</span>&gt;</span></span><br><span class="line">        FirstName<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:</span><br><span class="line">    <span class="comment">&lt;!-- *&#123;&#125; 是选择表达式：表示填充到所绑定对象的 firstName 属性上，即：spitter.firstName --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">th:field</span>=<span class="string">"*&#123;firstName&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">th:class</span>=<span class="string">"$&#123;#fields.hasErrors('firstName')&#125;? 'error'"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    ... ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p></li></ol></div><footer class="post-footer"></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#理解视图解析"><span class="nav-number">1.</span> <span class="nav-text">理解视图解析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建-jsp-视图"><span class="nav-number">2.</span> <span class="nav-text">创建 JSP 视图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#解析-jstl-视图"><span class="nav-number">2.1.</span> <span class="nav-text">解析 JSTL 视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-spring-的-jsp-库"><span class="nav-number">2.2.</span> <span class="nav-text">使用 Spring 的 JSP 库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将表单绑定到模型上"><span class="nav-number">2.2.1.</span> <span class="nav-text">将表单绑定到模型上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#展现错误"><span class="nav-number">2.2.2.</span> <span class="nav-text">展现错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring-通用的标签库"><span class="nav-number">2.2.3.</span> <span class="nav-text">Spring 通用的标签库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-apache-tiles-视图定义布局"><span class="nav-number">3.</span> <span class="nav-text">使用 Apache Tiles 视图定义布局</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置-tiles-视图解析器"><span class="nav-number">3.1.</span> <span class="nav-text">配置 Tiles 视图解析器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用-thymeleaf"><span class="nav-number">4.</span> <span class="nav-text">使用 Thymeleaf</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">CNCWS</p><div class="site-description" itemprop="description"></div></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/cncws" title="GitHub → https://github.com/cncws" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:1031616423@qq.com" title="E-Mail → mailto:1031616423@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">CNCWS</span></div><script src="//cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><script src="/js/aplayer-el.js"></script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script><script src="/js/local-search.js"></script><div id="pjax"><script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script></div></body></html>